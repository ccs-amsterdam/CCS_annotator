{"version":3,"sources":["../node_modules/react-semantic-ui-datepickers/dist/locales sync /^/.//.*/.json$","util/tokens.js","apis/dexie.js","components/Download.js","actions/index.js","components/Reset.js","apis/storemanager.js","components/Persist.js","components/CodebookSidebar.js","components/HeaderMenu.js","apis/demodata.js","components/Welcome.js","components/AuthRoute.js","components/SelectionTable.js","components/CreateCodingjob.js","components/DeleteCodingjob.js","components/CodingjobSelector.js","components/DocumentTable.js","components/JobDetails.js","components/UploadDocuments.js","components/UploadRaw.js","components/CodeTreeTable.js","components/CodeBook.js","components/CodingJobs.js","util/tokenDesign.js","components/CodeSelector.js","components/Token.js","components/Tokens.js","components/SpanAnnotationsDB.js","components/SpanAnnotationsNavigation.js","components/SpanAnnotationsMenu.js","components/spanAnnotations.js","components/AnnotationText.js","components/Annotate.js","App.js","reducers/index.js","index.js"],"names":["map","webpackContext","req","id","webpackContextResolve","__webpack_require__","o","e","Error","code","keys","Object","resolve","module","exports","nlp","extend","paragraphs","parseTokens","text_fields","tokens","token","paragraph","sentence","tokenIndex","t","text","text_field","section","name","value","tokenize","json","offset","par","length","sent","sentences","sent2","term","terms","push","start","index","pre","post","importTokens","totalLength","i","alert","space","repeat","Math","max","includes","importTokenAnnotations","codes","annotations","codeTracker","annotationDict","annotation","prevTokenPost","group","key","values","AnnotationDB","this","idb","Dexie","version","stores","meta","apis","codingjobs","documents","a","isWelcome","add","welcome","get","api","put","refresh_token","expiration_date","delete","job_id","hash","Date","now","toString","codingjob","where","equals","toArray","test","codebook","console","log","modify","JSON","stringify","append","getCodingjob","cj","parse","codeMap","reduce","obj","parent","parentMap","newcode","safeNewCode","writeCodebook","documentList","silent","Set","primaryKeys","ids","duplicates","preparedDocuments","result","document","doc_id","has","message","writeCodes","bulkAdd","documentIds","bulkDelete","limit","count","ndocs","oldCode","newCode","getDocument","doc","writeAnnotations","clear","slice","db","progressCallback","totalRows","completedRows","Download","useState","open","setOpen","onDownload","exportDB","filter","table","prettyJson","blob","fileDownload","error","Modal","closeIcon","trigger","Menu","Item","icon","style","color","onClose","onOpen","Header","content","Content","Actions","Button","primary","onClick","blockEvents","block","type","payload","selectCodingjob","setCodingjobs","setCurrentToken","toggleTokenSelection","triggerCodeselector","from","toggleAnnotations","spanAnnotation","setCodeMap","appendCodeHistory","n","setShowSidebar","show","Reset","homepage","dispatch","useDispatch","history","useHistory","deleteDB","Icon","initStoragePersistence","tryPersistWithoutPromtingUser","persist","navigator","storage","undefined","isStoragePersisted","persisted","permissions","query","permission","state","Persist","setPersisted","useEffect","then","CodebookSidebar","showSidebar","useSelector","withRouter","items","location","useLocation","menuItems","item","as","Link","to","path","header","disabled","active","pathname","label","fixed","inverted","position","demo_codebook","settings","can_edit_codes","relations","code_annotations","coding_unit","context_unit","paragraph_window","sentence_window","word_window","sampling","max_per_document","random_documents","random_order","tasks","codes_parent","instruction","options","relation_annotations","demo_articles","document_id","create_demo_job","createCodingjob","job","createDocuments","Welcome","loggin","addDemo","checkWelcome","Grid","textAlign","height","verticalAlign","Column","maxWidth","Segment","border","AuthRoute","Component","componentProps","loading","setLoading","hasdb","setHasdb","connect","render","props","GlobalFilter","preGlobalFilteredRows","globalFilter","setGlobalFilter","onChange","target","placeholder","SelectionTable","columns","data","selectedRow","setSelectedRow","width","defaultSize","ROW_ID","activeRow","setActiveRow","useTable","initialState","pageSize","useGlobalFilter","useSortBy","usePagination","getTableProps","getTableBodyProps","headerGroups","prepareRow","page","pageCount","gotoPage","pageIndex","createHeader","headerGroup","headers","column","TableHeaderCell","className","headerClass","getHeaderProps","getSortByToggleProps","isSorted","isSortedDesc","Table","compact","unstackable","singleLine","selectable","TableHeader","TableRow","getHeaderGroupProps","TableBody","row","onRowSelect","getRowProps","cells","cell","TableCell","title","getCellProps","createBody","Footer","Row","HeaderCell","colSpan","Pagination","floated","size","firstItem","lastItem","nextItem","prevItem","boundaryRange","ellipsisItem","activePage","totalPages","onPageChange","event","CreateCodingjob","status","setStatus","codingjobName","setCodingjobName","onSubmit","preventDefault","trim","listCodingjobs","Form","Group","Input","required","d","Dimmer","Loader","DeleteCodingjob","deleteCodingjob","setCodingjob","getCodingjobs","setSelectedCodingjob","cjs","CodingjobSelector","indices","selectedCodingjob","widths","Container","marginTop","overflow","accessor","Dropdown","inline","search","findIndex","onDropdownSelect","fetchFromDb","setPages","setData","setColumns","getJobDocumentCount","ceil","newdata","getJobDocumentsBatch","getColumns","newcolumns","s","tf","DocumentTable","pages","createRowCells","rowObj","find","Cell","pageChange","celled","colname","createHeaderRow","Body","createBodyRows","siblingRange","pointing","secondary","defaultActivePage","JobDetails","UploadTextsCsv","setActive","multiple","defaults","annotations_json","renderTextForms","fields","setFields","renderForm","UploadTokensCsv","int","end","renderTokenForms","UploadCsv","fileRef","useRef","ref","nodrag","onFileLoad","addRemoveButton","onRemoveFile","SubmitForm","setOptions","newfields","col","def","csvToJson","fieldIndices","field","subfield","k","datarow","original","fieldindex","v","parseInt","uploadData","preparedData","tokensToDocumentList","current","removeFile","Field","control","allDone","clearable","selection","minWidth","PreviewTable","singleline","display","createRows","align","DocumentForms","fieldValues","setFieldValues","newFieldValues","TextArea","UploadRaw","onCreate","submitData","toISOString","resultRenderer","codeTrail","join","changeCodeColor","setCodes","updatedCodes","ucode","loadCodes","setSettings","cb","EditCodePopup","children","popupContent","setPopupContent","buttonContent","ButtonGroup","basic","addCodePopup","rmCodePopup","moveCodePopup","root","Popup","flowing","hoverable","wide","mouseLeaveDelay","padding","AddCodePopup","textInput","setTextInput","addCode","margin","autoFocus","circular","link","RmCodePopup","rmCode","keepChildren","getAllChildren","fluid","MoveCodePopup","newParent","setNewParent","parentOptions","getAllParentOptions","mvCode","renameAnnotations","selectOnNavigation","minCharacters","autoComplete","child","getCodeTreeArray","showColors","parents","codeTreeArray","fillCodeTreeArray","object","newcodeTrail","level","randomColor","seed","luminosity","codeTrailSpan","marginLeft","marginRight","borderRadius","background","prepareCodeMap","tree","getParentTree","reverse","CodeTreeTable","typeDelay","results","setResults","setValue","setCodeTreeArray","changeColor","setChangeColor","React","cta","timer","setTimeout","clearTimeout","timeoutRef","handleSearchChange","useCallback","re","RegExp","replace","scrollIntoView","Search","showNoResults","onResultSelect","onSearchChange","selectFirstResult","fontWeight","fontSize","cursor","CodeBook","CodingJobs","activeItem","setActiveItem","stackable","renderSwitch","getColor","annotationCode","arrowKeys","CodeSelector","memo","currentCode","newSelection","codeHistory","setCurrent","hasOpened","setHasOpened","updateAnnotations","CurrentCodePage","annotationCodes","getOptions","canDelete","callback","NewCodePage","textInputRef","focusOnButtons","setFocusOnButtons","onKeydown","activeElement","keyCode","click","window","addEventListener","removeEventListener","Ref","innerRef","searchQuery","ButtonSelection","selected","setSelected","nbuttons","option","backgroundColor","onMouseOver","borderColor","ann","oldAnnotation","span","newAnnotations","newAnnotation","Token","forwardRef","tokenSelection","tokenClass","tokenindex","AnnotatedToken","spanAnnotations","csTrigger","codeSelectorTrigger","tokenSpan","annotatedTokenClass","onContextMenu","allLeft","allRight","tokenCodes","colors","some","anyLeft","anyRight","Tokens","tokenComponents","setTokenComponents","prepareTokens","writeTokens","renderText","paragraph_nr","sentence_nr","renderSentence","renderParagraph","createRef","renderToken","lineHeight","exportAnnotations","uniqueAnnotations","un_ann","annotationTokens","ann_obj","at","matchAnnotations","importedAnnotations","prepareAnnotations","trackAnnotations","matchedAnnotations","findMatches","codeCounter","annArray","matchedAnnotation","addAnnotations","topCodes","sort","b","startKey","endKey","SpanAnnotationsDB","writable","arrowkeys","KeyEvents","currentToken","setMover","setHoldSpace","setHoldArrow","onKeyDown","onKeyUp","annotationFromSelection","startposition","ntokens","counter","MouseEvents","holdMouseLeft","setHoldMouseLeft","onMouseDown","onMouseMove","onMouseUp","which","getSelection","empty","storeMouseSelection","currentNode","getToken","button","stopPropagation","lastSection","movePosition","mover","newPosition","moveSentence","down","next","direction","getBoundingClientRect","y","x","nextsent","getTokenAttributes","tokenNode","getAttribute","originalTarget","parentNode","SpanAnnotationsNavigation","eventsBlocked","HoldSpace","holdArrow","delay","COLWIDTHS","annotationRows","rows","AnnotationRow","infocus","cref","SpanAnnotationsMenu","role","arioa-labelledby","gridStyleTop","gridStyleBottom","overflowY","SpanInstructions","List","ListItem","SpanAnnotations","gridStyle","AnnotationText","container","documentPagination","delayedActivePage","nDocuments","setActivePage","setDelayedActivePage","min","setupCodingjob","setDoc","setNDocuments","documentSelector","codeMapHash","openExternalJob","jobURL","setReady","axios","response","details","ready","substring","Breadcrumb","BreadcrumbSection","Divider","App","Sidebar","Pushable","animation","visible","Pusher","exact","toggleSelection","annList","rm","rootReducer","combineReducers","action","codingjobSettings","tokenIndices","newstate","unshift","store","createStore","ReactDOM","StrictMode","querySelector"],"mappings":"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","file":"static/js/main.13932245.chunk.js","sourcesContent":["var map = {\n\t\"./bg-BG.json\": 310,\n\t\"./ca-ES.json\": 311,\n\t\"./cs-CZ.json\": 312,\n\t\"./de-DE.json\": 313,\n\t\"./en-US.json\": 208,\n\t\"./es-ES.json\": 314,\n\t\"./et-EE.json\": 315,\n\t\"./fi-FI.json\": 316,\n\t\"./fr-FR.json\": 317,\n\t\"./he-IL.json\": 318,\n\t\"./it-IT.json\": 319,\n\t\"./ja-JP.json\": 320,\n\t\"./ko-KR.json\": 321,\n\t\"./nb-NO.json\": 322,\n\t\"./nn-NO.json\": 323,\n\t\"./pl-PL.json\": 324,\n\t\"./pt-BR.json\": 325,\n\t\"./ru-RU.json\": 326,\n\t\"./sv-SE.json\": 327,\n\t\"./tr-TR.json\": 328,\n\t\"./zh-CN.json\": 329\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 309;","import nlp from \"compromise\";\nimport paragraphs from \"compromise-paragraphs\";\nnlp.extend(paragraphs);\n\nexport const parseTokens = (text_fields) => {\n  // map to single array.\n  // for some reason there's an extra array layer between sents and pars...\n  // I've only found cases where lenght is 1, but I'll map it just in case\n  const tokens = [];\n  let token = null;\n  let paragraph = 0;\n  let sentence = 0;\n  let tokenIndex = 0;\n  let t = null;\n  let text = null;\n  for (let text_field of text_fields) {\n    let section = text_field.name;\n    text = text_field.value;\n    t = nlp.tokenize(text).paragraphs().json({ offset: true });\n    for (let par = 0; par < t.length; par++) {\n      for (let sent = 0; sent < t[par].sentences.length; sent++) {\n        for (let sent2 = 0; sent2 < t[par].sentences[sent].length; sent2++) {\n          for (let term = 0; term < t[par].sentences[sent][sent2].terms.length; term++) {\n            token = t[par].sentences[sent][sent2].terms[term];\n            tokens.push({\n              section: section,\n              offset: token.offset.start,\n              length: token.offset.length,\n              paragraph: paragraph,\n              sentence: sentence,\n              index: tokenIndex,\n              text: token.text,\n              pre: token.pre,\n              post: token.post,\n            });\n            tokenIndex++;\n          }\n        }\n        sentence++;\n      }\n      paragraph++;\n    }\n  }\n  return tokens;\n};\n\nexport const importTokens = (tokens) => {\n  //const indexFrom1 = tokens[0].offset && tokens[0].offset === 1;\n  let paragraph = 0;\n\n  let offset = 0;\n  let totalLength = 0;\n  for (let i = 0; i < tokens.length; i++) {\n    if (tokens[i].text == null) {\n      if (tokens[i].token != null) {\n        tokens[i].text = tokens[i].token;\n      } else {\n        alert(\"Invalid token data:\\n\\nimported tokens must have 'text' or 'token' field\");\n        return null;\n      }\n    }\n    if (tokens[i].offset == null && tokens[i].start != null) tokens[i].offset = tokens[i].start;\n    if (tokens[i].length == null) tokens[i].length = tokens[i].text.length;\n\n    if (tokens[i].pre == null) tokens[i].pre = \"\";\n    if (tokens[i].post == null && tokens[i].space != null) tokens[i].post = tokens[i].space;\n    if (tokens[i].post == null) {\n      if (tokens[i].offset != null && tokens[i].length != null) {\n        tokens[i].post =\n          i < tokens[i].length - 1\n            ? \" \".repeat(Math.max(0, tokens[i + 1].offset - tokens[i].offset - tokens[i].length))\n            : \"\";\n      } else {\n        tokens[i].post = \" \";\n      }\n    }\n\n    totalLength = tokens[i].length + tokens[i].pre.length + tokens[i].post.length;\n\n    if (tokens[i].offset == null) {\n      tokens[i].offset = offset;\n      offset = offset + totalLength;\n    }\n\n    if (i < tokens.length - 1 && tokens[i + 1].offset < tokens[i].offset + totalLength) {\n      alert(\n        `Invalid token position data. The length of \"${\n          tokens[i].pre + tokens[i].text + tokens[i].post\n        }\" on position ${tokens[i].offset} exeeds the offset/start position of the next token`\n      );\n      return null;\n    }\n\n    if (tokens[i].paragraph == null) tokens[i].paragraph = paragraph;\n    if (tokens[i].text.includes(\"\\n\") || tokens[i].post.includes(\"\\n\")) paragraph++;\n    if (tokens[i].section == null) tokens[i].section = \"text\";\n    tokens[i].index = i;\n  }\n\n  return tokens;\n};\n\nexport const importTokenAnnotations = (tokens, codes) => {\n  let annotations = [];\n  let codeTracker = {};\n  for (let i = 0; i < tokens.length; i++) {\n    if (!tokens[i].annotations) {\n      for (let annotation of Object.values(codeTracker)) annotations.push(annotation);\n      codeTracker = {};\n      continue;\n    }\n\n    let annotationDict = {};\n    for (let annotation of tokens[i].annotations) {\n      if (!codes[annotation.value]) {\n        codes[annotation.value] = [annotation.name];\n      } else {\n        if (!codes[annotation.value].includes(annotation.name))\n          codes[annotation].push(annotation.name);\n      }\n\n      annotationDict[annotation.name] = annotation.value;\n\n      const prevTokenPost = i > 0 ? tokens[i - 1].post : \"\";\n      if (codeTracker[annotation.name] == null)\n        codeTracker[annotation.name] = {\n          index: i,\n          code: annotation.value,\n          offset: tokens[i].offset,\n          text: tokens[i].text,\n          section: tokens[i].section,\n          length: tokens[i].length,\n        };\n      if (codeTracker[annotation.name].group === annotation.value) {\n        codeTracker[annotation.name].length =\n          tokens[i].offset + tokens[i].length - codeTracker[annotation.name].offset;\n        codeTracker[annotation.name].text += prevTokenPost + tokens[i].pre + tokens[i].post;\n      }\n    }\n\n    for (let key of Object.keys(codeTracker)) {\n      if (annotationDict[key] == null) {\n        annotations.push(...codeTracker[key]);\n        codeTracker[key] = null;\n        continue;\n      }\n      if (annotationDict[key] !== codeTracker[key]) {\n        annotations.push(codeTracker[key]);\n        codeTracker[key] = {\n          index: i,\n          code: annotationDict[key],\n          offset: tokens[i].offset,\n          text: tokens[i].text,\n          section: tokens[i].section,\n          length: tokens[i].length,\n        };\n      }\n    }\n  }\n\n  return annotations;\n};\n","import Dexie from \"dexie\";\nimport hash from \"object-hash\";\nimport { importTokens, importTokenAnnotations } from \"../util/tokens.js\";\n\nclass AnnotationDB {\n  constructor() {\n    this.idb = new Dexie(\"AmCAT_Annotator\");\n    this.idb.version(2).stores({\n      meta: \"welcome\", // this just serves to keep track of whether db was 'created' via the welcome component\n      apis: \"api\", // unindexed fields: token, refresh_token, expiration_date,\n      codingjobs: \"job_id, name\", // unindexed fields: jobcreator, codingscheme, codebook, codebookEdit, returnAddress\n      documents: \"doc_id, job_id\", // unindexed fields: title, text, meta, tokens, annotations\n    });\n  }\n\n  // META\n  async welcome() {\n    if (!(await this.isWelcome())) this.idb.meta.add({ welcome: 1 });\n    return null;\n  }\n  async isWelcome() {\n    return this.idb.meta.get(1);\n  }\n\n  // API TOKENS\n  async addToken(api, token) {\n    return this.idb.apis.put({\n      api,\n      token: token.token,\n      refresh_token: token.refresh_token,\n      expiration_date: token.expiration_date,\n    });\n  }\n  async deleteToken(api) {\n    return this.idb.apis.delete(api);\n  }\n  async getToken(api) {\n    return this.idb.apis.get(api);\n  }\n\n  // CODINGJOBS\n  async createCodingjob(name, job_id = null) {\n    if (!job_id) job_id = hash([name, Date.now().toString()]);\n    this.idb.codingjobs.add({\n      job_id,\n      name,\n    });\n    return { job_id, name };\n  }\n  async deleteCodingjob(codingjob) {\n    await this.idb.documents.where(\"job_id\").equals(codingjob.job_id).delete();\n    return this.idb.codingjobs.delete(codingjob.job_id);\n  }\n  async listCodingjobs() {\n    const test = await this.idb.codingjobs.toArray();\n    return test;\n  }\n  async getCodingjob(codingjob) {\n    return this.idb.codingjobs.get(codingjob.job_id);\n  }\n  async writeCodebook(codingjob, codebook) {\n    console.log(\"writing to db\");\n    return this.idb.codingjobs\n      .where(\"job_id\")\n      .equals(codingjob.job_id)\n      .modify({ codebook: JSON.stringify(codebook, null, 2) });\n  }\n\n  async writeCodes(codingjob, codes, append = false) {\n    const cj = await this.getCodingjob(codingjob);\n    const codebook = cj.codebook ? JSON.parse(cj.codebook) : {};\n\n    if (!append) {\n      codebook.codes = codes;\n    } else {\n      if (!codebook.codes) codebook.codes = [];\n      const codeMap = codebook.codes.reduce((obj, code, i) => {\n        obj[code.code] = { parent: code.parent, index: i };\n        return obj;\n      }, {});\n      const parentMap = codebook.codes.reduce((obj, code, i) => {\n        obj[code.parent] = true;\n        return obj;\n      }, {});\n      for (let code of codes) {\n        if (codeMap[code.code]) {\n          if (code.parent === codeMap[code.code].parent) continue;\n          const newcode = safeNewCode(code.code + \" (\" + code.parent + \")\", codeMap, parentMap, 2);\n          codebook.codes[codeMap[code].index].code = newcode;\n          codebook.codes.push({ code: newcode, parent: code.parent });\n        } else {\n          const newcode = safeNewCode(code.code, codeMap, parentMap, 2);\n          codebook.codes.push({ code: newcode, parent: code.parent });\n        }\n      }\n    }\n    return await this.writeCodebook(codingjob, codebook);\n  }\n\n  // DOCUMENTS\n  async createDocuments(codingjob, documentList, silent = false) {\n    let ids = new Set(\n      await this.idb.documents.where(\"job_id\").equals(codingjob.job_id).primaryKeys()\n    );\n\n    let duplicates = 0;\n    let codes = {};\n    const preparedDocuments = documentList.reduce((result, document) => {\n      const doc_id = hash([document, codingjob]); // codingjob included for doc_id hash\n      if (!ids.has(doc_id)) {\n        ids.add(doc_id);\n        if (document.annotations && document.annotations.length > 0) {\n          try {\n            JSON.parse(document.annotations);\n          } catch (e) {\n            alert(\"Annotations field contains invalid JSON\");\n            throw new Error(\"JSON parse error\");\n          }\n        }\n        if (document.tokens) {\n          document.tokens = importTokens(document.tokens);\n          document.annotations = importTokenAnnotations(document.tokens, codes); // also fills codes\n        }\n        result.push({\n          doc_id: doc_id,\n          job_id: codingjob.job_id,\n          ...document,\n        });\n      } else {\n        duplicates++;\n      }\n      return result;\n    }, []);\n\n    if (!silent) {\n      let message = `Created ${documentList.length - duplicates} new documents in codingjob ${\n        codingjob.name\n      }.`;\n      if (duplicates > 0) message = message + ` Ignored ${duplicates} duplicates`;\n      alert(message);\n    }\n\n    codes = Object.keys(codes).reduce((a, code) => {\n      for (let parent of codes[code]) a.push({ code, parent });\n      return a;\n    }, []);\n    this.writeCodes(codingjob, codes, true);\n\n    return this.idb.documents.bulkAdd(preparedDocuments);\n  }\n\n  async deleteDocuments(documents) {\n    const documentIds = documents.map((document) => document.doc_id);\n    return this.idb.documents.bulkDelete(documentIds);\n  }\n\n  async getJobDocumentsBatch(codingjob, offset, limit) {\n    if (offset < 0) return null;\n    const documents = await this.idb.documents.where(\"job_id\").equals(codingjob.job_id);\n    const ndocs = await documents.count();\n    if (offset > ndocs - 1) return null;\n    return documents.offset(offset).limit(limit).toArray();\n  }\n\n  async getJobDocumentCount(codingjob) {\n    return this.idb.documents.where(\"job_id\").equals(codingjob.job_id).count();\n  }\n\n  async getDocument(doc_id) {\n    return this.idb.documents.get(doc_id);\n  }\n\n  async writeTokens(document, tokens) {\n    return this.idb.documents.where(\"doc_id\").equals(document.doc_id).modify({ tokens: tokens });\n  }\n\n  async writeAnnotations(document, annotations) {\n    console.log(\"writing annotations\");\n    console.log(document);\n    console.log(annotations);\n    return this.idb.documents\n      .where(\"doc_id\")\n      .equals(document.doc_id)\n      .modify({ annotations: annotations });\n  }\n  async renameAnnotations(codingjob, oldCode, newCode) {\n    let ids = new Set(\n      await this.idb.documents.where(\"job_id\").equals(codingjob.job_id).primaryKeys()\n    );\n    for (let id of ids) {\n      let doc = await this.getDocument(id);\n      let annotations = doc.annotations.map((annotation) => {\n        if (annotation.code === oldCode) annotation.code = newCode;\n        return annotation;\n      });\n      await this.writeAnnotations(doc, annotations);\n    }\n  }\n\n  // CLEANUP\n  async deleteDB() {\n    await this.idb.meta.clear();\n    await this.idb.apis.clear();\n    await this.idb.codingjobs.clear();\n    await this.idb.documents.clear();\n  }\n}\n\nconst safeNewCode = (code, codeMap, parentMap, i) => {\n  // for preventing overlapping code names\n  if (!codeMap[code] && !parentMap[code]) return code;\n  if (i > 2) code = code.slice(0, code.length - code.toString().length);\n  code += \" \" + i;\n  safeNewCode(code, codeMap, i + 1);\n};\n\nconst db = new AnnotationDB();\nexport default db;\n","import React, { useState } from \"react\";\n\nimport { Modal, Menu, Header, Button } from \"semantic-ui-react\";\nimport { exportDB } from \"dexie-export-import\";\nimport fileDownload from \"js-file-download\";\nimport db from \"../apis/dexie\";\n\nconst Download = () => {\n  const [open, setOpen] = useState(false);\n\n  const onDownload = async () => {\n    try {\n      const blob = await exportDB(db.idb, {\n        filter: (table, value, key) => table === \"codingjobs\" || table === \"documents\",\n        prettyJson: true,\n        progressCallback,\n      });\n      fileDownload(blob, \"AmCAT_Annotator.json\");\n    } catch (error) {\n      console.error(\"\" + error);\n    }\n  };\n\n  return (\n    <Modal\n      closeIcon\n      open={open}\n      trigger={<Menu.Item icon=\"download\" name=\"Download\" style={{ color: \"lightgreen\" }} />}\n      onClose={() => setOpen(false)}\n      onOpen={() => setOpen(true)}\n    >\n      <Header icon=\"download\" content=\"Download everything\" />\n      <Modal.Content>\n        <p>Download all data as a single JSON dump</p>\n      </Modal.Content>\n      <Modal.Actions>\n        <Button primary onClick={onDownload}>\n          Download\n        </Button>\n      </Modal.Actions>\n    </Modal>\n  );\n};\n\nfunction progressCallback({ totalRows, completedRows }) {\n  console.log(`Progress: ${completedRows} of ${totalRows} rows completed`);\n}\n\nexport default Download;\n","export const resetDB = () => {\n  return {\n    type: \"RESET_DB\",\n  };\n};\n\nexport const blockEvents = (block) => {\n  return {\n    type: \"BLOCK_EVENTS\",\n    payload: block,\n  };\n};\n\nexport const selectCodingjob = (codingjob) => {\n  return {\n    type: \"SELECT_CODINGJOB\",\n    payload: codingjob,\n  };\n};\n\nexport const setCodingjobs = (codingjobs) => {\n  return {\n    type: \"SET_CODINGJOBS\",\n    payload: codingjobs,\n  };\n};\n\nexport const setCodingjobSettings = (codingjobSettings) => {\n  return {\n    type: \"SET_CODINGJOB_SETTINGS\",\n    payload: codingjobSettings,\n  };\n};\n\nexport const setTokenIndices = (tokenIndices) => {\n  return {\n    type: \"SET_TOKEN_INDICES\",\n    payload: tokenIndices,\n  };\n};\n\nexport const setCurrentToken = (index) => {\n  return {\n    type: \"SET_CURRENT_TOKEN\",\n    payload: index,\n  };\n};\n\nexport const toggleTokenSelection = (tokens, index, add) => {\n  return {\n    type: \"TOGGLE_TOKEN_SELECTION\",\n    payload: { tokens, index, add },\n  };\n};\n\nexport const setTokenSelection = (tokenSelection) => {\n  return {\n    type: \"SET_TOKEN_SELECTION\",\n    payload: tokenSelection,\n  };\n};\n\nexport const clearTokenSelection = () => {\n  return {\n    type: \"CLEAR_TOKEN_SELECTION\",\n  };\n};\n\nexport const triggerCodeselector = (from, tokenIndex, code) => {\n  return {\n    type: \"TRIGGER_CODESELECTOR\",\n    from: from,\n    index: tokenIndex,\n    code: code,\n  };\n};\n\nexport const setAnnotations = (spanAnnotation) => {\n  return {\n    type: \"SET_ANNOTATIONS\",\n    payload: spanAnnotation,\n  };\n};\n\nexport const toggleAnnotations = (spanAnnotation) => {\n  return {\n    type: \"TOGGLE_ANNOTATIONS\",\n    payload: spanAnnotation,\n  };\n};\n\nexport const rmAnnotations = (spanAnnotation) => {\n  return {\n    type: \"RM_ANNOTATIONS\",\n    payload: spanAnnotation,\n  };\n};\n\nexport const clearSpanAnnotations = () => {\n  return {\n    type: \"CLEAR_SPAN_ANNOTATIONS\",\n  };\n};\n\nexport const setCodeMap = (codes) => {\n  return {\n    type: \"SET_CODE_MAP\",\n    payload: codes,\n  };\n};\n\nexport const resetCodeHistory = () => {\n  return {\n    type: \"RESET_CODE_HISTORY\",\n  };\n};\n\nexport const appendCodeHistory = (code, n = 20) => {\n  return {\n    type: \"APPEND_CODE_HISTORY\",\n    payload: { code: code, n: n },\n  };\n};\n\nexport const setShowSidebar = (show) => {\n  return {\n    type: \"SET_SHOW_SIDEBAR\",\n    payload: show,\n  };\n};\n","import React, { useState } from \"react\";\nimport { useDispatch } from \"react-redux\";\nimport { resetDB } from \"../actions\";\nimport { Menu, Button, Header, Icon, Modal } from \"semantic-ui-react\";\nimport { useHistory } from \"react-router-dom\";\nimport db from \"../apis/dexie\";\n\nconst Reset = ({ homepage }) => {\n  const dispatch = useDispatch();\n  const [open, setOpen] = useState(false);\n  const history = useHistory();\n\n  const onClick = async () => {\n    try {\n      await db.deleteDB();\n      dispatch(resetDB());\n      setOpen(false);\n      history.push(homepage);\n    } catch (e) {\n      console.log(e);\n    }\n  };\n\n  return (\n    <Modal\n      closeIcon\n      open={open}\n      trigger={\n        <Menu.Item icon=\"rocket\" name=\"Reset\" style={{ color: \"#d7a3a3\" }} />\n      }\n      onClose={() => setOpen(false)}\n      onOpen={() => setOpen(true)}\n    >\n      <Header icon=\"power off\" content=\"Reset Annotator Database\" />\n      <Modal.Content>\n        <p>\n          This will remove all document and annotation data from your browser.\n          Any annotations that have not been saved/synchronized will be lost.\n          Are you absolutely sure?\n        </p>\n      </Modal.Content>\n      <Modal.Actions>\n        <Button\n          color=\"red\"\n          onClick={() => {\n            setOpen(false);\n          }}\n        >\n          <Icon name=\"remove\" /> No\n        </Button>\n        <Button color=\"green\" onClick={onClick}>\n          <Icon name=\"checkmark\" /> Yes\n        </Button>\n      </Modal.Actions>\n    </Modal>\n  );\n};\n\nexport default Reset;\n","// this contains functions for setting indexedDB to persistent\n// taken from: https://dexie.org/docs/StorageManager\n\n/** Check if storage is persisted already.\n  @returns {Promise<boolean>} Promise resolved with true if current origin is\n  using persistent storage, false if not, and undefined if the API is not\n  present.\n*/\n\nexport async function initStoragePersistence() {\n  const persist = await tryPersistWithoutPromtingUser();\n  switch (persist) {\n    case \"never\":\n      console.log(\"Not possible to persist storage\");\n      break;\n    case \"persisted\":\n      console.log(\"Successfully persisted storage silently\");\n      break;\n    case \"prompt\":\n      console.log(\"Not persisted, but we may prompt user when we want to.\");\n      break;\n    default:\n      console.log(\"compiler desperately wanted a default\");\n  }\n}\n\n/** Tries to convert to persisted storage.\n  @returns {Promise<boolean>} Promise resolved with true if successfully\n  persisted the storage, false if not, and undefined if the API is not present.\n*/\nexport async function persist() {\n  return (await navigator.storage) && navigator.storage.persist\n    ? navigator.storage.persist()\n    : undefined;\n}\n\nexport async function isStoragePersisted() {\n  return (await navigator.storage) && navigator.storage.persisted\n    ? navigator.storage.persisted()\n    : undefined;\n}\n\n/** Queries available disk quota.\n  @see https://developer.mozilla.org/en-US/docs/Web/API/StorageEstimate\n  @returns {Promise<{quota: number, usage: number}>} Promise resolved with\n  {quota: number, usage: number} or undefined.\n*/\n// async function showEstimatedQuota() {\n//   return (await navigator.storage) && navigator.storage.estimate\n//     ? navigator.storage.estimate()\n//     : undefined;\n// }\n\n/** Tries to persist storage without ever prompting user.\n  @returns {Promise<string>}\n    \"never\" In case persisting is not ever possible. Caller don't bother\n      asking user for permission.\n    \"prompt\" In case persisting would be possible if prompting user first.\n    \"persisted\" In case this call successfully silently persisted the storage,\n      or if it was already persisted.\n*/\nasync function tryPersistWithoutPromtingUser() {\n  if (!navigator.storage || !navigator.storage.persisted) {\n    return \"never\";\n  }\n  let persisted = await navigator.storage.persisted();\n  if (persisted) {\n    return \"persisted\";\n  }\n  if (!navigator.permissions || !navigator.permissions.query) {\n    return \"prompt\"; // It MAY be successful to prompt. Don't know.\n  }\n  const permission = await navigator.permissions.query({\n    name: \"persistent-storage\",\n  });\n  if (permission.state === \"granted\") {\n    persisted = await navigator.storage.persist();\n    if (persisted) {\n      return \"persisted\";\n    } else {\n      throw new Error(\"Failed to persist\");\n    }\n  }\n  if (permission.state === \"prompt\") {\n    return \"prompt\";\n  }\n  return \"never\";\n}\n","import React, { useEffect, useState } from \"react\";\nimport { Menu, Button, Header, Icon, Modal } from \"semantic-ui-react\";\nimport { persist, isStoragePersisted } from \"../apis/storemanager\";\n\nconst Persist = () => {\n  const [open, setOpen] = useState(false);\n  const [persisted, setPersisted] = useState(false);\n\n  useEffect(() => {\n    if (!persisted) {\n      isStoragePersisted().then(setPersisted);\n    }\n  }, [persisted]);\n\n  const onClick = async () => {\n    await persist();\n    const ispersisted = await isStoragePersisted();\n    if (ispersisted) {\n      setPersisted(true);\n      alert(\"indexedDB set to persistent for AmCAT Annotator\");\n    } else {\n      alert(\"Failed to set indexedDB to persistent\");\n    }\n  };\n\n  if (persisted) return null;\n\n  return (\n    <Modal\n      closeIcon\n      open={open}\n      trigger={\n        <Menu.Item\n          icon=\"database\"\n          name=\"Enable persitance\"\n          style={{ color: \"#d7a3a3\" }}\n        />\n      }\n      onClose={() => setOpen(false)}\n      onOpen={() => setOpen(true)}\n    >\n      <Header icon=\"database\" content=\"Set database persistence\" />\n      <Modal.Content>\n        <p>\n          We did not have permission to automatically make the data storage for\n          this website persistent. This means that the data could be removed\n          automatically by your browser if it needs to free up space for another\n          website. You can try to set this manually here, but not all browsers\n          support this (yet).\n        </p>\n        <p>\n          If the database is not persistent the app can still be used, but you\n          need to be more carefull in making sure that data is regularly backed\n          up, either by manually downloading data or syncing with some backend\n          (work in progress).\n        </p>\n      </Modal.Content>\n      <Modal.Actions>\n        <Button onClick={onClick}>\n          <Icon name=\"checkmark\" /> Yes\n        </Button>\n      </Modal.Actions>\n    </Modal>\n  );\n};\n\nexport default Persist;\n","import React, { useEffect } from \"react\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { Menu } from \"semantic-ui-react\";\nimport { setShowSidebar } from \"../actions\";\n\nconst CodebookSidebar = () => {\n  const showSidebar = useSelector((state) => state.showSidebar);\n  const dispatch = useDispatch();\n\n  useEffect(() => {\n    return () => {\n      dispatch(setShowSidebar(false));\n    };\n  }, [dispatch]);\n\n  return (\n    <Menu.Item\n      name={`${showSidebar ? \"Hide\" : \"Show\"} codebook`}\n      onClick={() => dispatch(setShowSidebar(!showSidebar))}\n    />\n  );\n};\n\nexport default CodebookSidebar;\n","import React from \"react\";\nimport { Menu } from \"semantic-ui-react\";\nimport { Link, withRouter, useLocation } from \"react-router-dom\";\nimport db from \"../apis/dexie\";\n\nimport Download from \"./Download\";\nimport Reset from \"./Reset\";\nimport Persist from \"./Persist\";\nimport CodebookSidebar from \"./CodebookSidebar\";\n\nconst HeaderMenu = ({ items, homepage }) => {\n  const location = useLocation();\n\n  const menuItems = items.map((item, index) => {\n    return (\n      <Menu.Item\n        key={\"item-\" + index}\n        index={index}\n        as={Link}\n        to={item.path}\n        header={index === 0}\n        disabled={!db}\n        active={item.path === location.pathname}\n      >\n        {item.label}\n      </Menu.Item>\n    );\n  });\n\n  return (\n    <Menu fixed=\"top\" inverted>\n      {menuItems}\n      <Menu.Menu position=\"right\">\n        {location.pathname.includes(\"annotate\") ? (\n          <CodebookSidebar />\n        ) : (\n          <>\n            <Download />\n            <Persist />\n            <Reset homepage={homepage} />\n          </>\n        )}\n      </Menu.Menu>\n    </Menu>\n  );\n};\n\nexport default withRouter(HeaderMenu);\n","export const demo_codebook = {\n  settings: {\n    can_edit_codes: true,\n  },\n  codes: [\n    { code: \"VVD\", parent: \"Actor\" },\n    { code: \"D66\", parent: \"Actor\" },\n    { code: \"Groenlinks\", parent: \"Actor\" },\n    { code: \"Mark Rutte\", parent: \"VVD\" },\n    { code: \"Sigrid Kaag\", parent: \"D66\" },\n    { code: \"Jesse Klaver\", parent: \"Groenlinks\" },\n    { code: \"Climate change\", parent: \"Issue\" },\n  ],\n  relations: [],\n\n  code_annotations: {\n    coding_unit: \"code\", // code, relation\n    context_unit: {\n      paragraph_window: [0, 0],\n      sentence_window: [1, 1],\n      word_window: [20, 20],\n    },\n    sampling: {\n      max_per_document: null,\n      random_documents: true,\n      random_order: true,\n    },\n\n    tasks: [\n      {\n        header: \"Issue identification\",\n        codes_parent: \"Issue\",\n        instruction: 'Does \"[text]\" refer to the issue \"[code]\"?',\n        options: [\"yes\", \"no\"],\n      },\n    ],\n  },\n\n  relation_annotations: {},\n};\n\nexport const demo_articles = [\n  {\n    document_id: \"Some document ID\",\n    text_fields: [\n      {\n        name: \"title\",\n        value: `GL en PvdA hebben goed gesprek met informateur, maar wantrouwen Rutte`,\n      },\n      {\n        name: \"text\",\n        value: `PvdA-leider Lilianne Ploumen en GroenLinks-leider Jesse Klaver hadden vrijdag een goed gesprek met informateur Herman Tjeenk Willink, zeiden ze zelf. De twee benadrukten dat, hoewel er inhoudelijke stappen zijn gezet, hun vertrouwen in VVD-leider Mark Rutte nog niet is hersteld.\n\n    Informateur Willink zette zich vrijdag aan zijn taak. Eerste punt op de agenda zijn gesprekken met de lijsttrekkers van de acht grootste partijen.\n    \n    Een week nadat een groot deel van de partijleiders bekendmaakte niet meer met Rutte verder te willen onderhandelen over een nieuwe coalitie, wordt gekeken waarover partijen het inhoudelijk eens zijn.\n    \n    \"Het was een prettig gesprek langs de lijnen van de inhoud\", zei PvdA-leider Lilianne Ploumen na afloop. Ze heeft haar zorgen over de ongelijkheid in Nederland en over de zorg gedeeld.\n    \n    Ook Jesse Klaver (GroenLinks), die een uur eerder op gesprek kwam bij de informateur, benadrukte dat het ging over de problemen die opgelost moeten worden.\n    \n    Situatie niet veranderd in een week\n\nWat betreft de positie ten opzichte van Rutte is echter niets veranderd. Vorige week ondertekenden Ploumen en Klaver net als alle andere oppositiepartijen een motie van wantrouwen, vanwege Ruttes betrokkenheid bij de notitie over CDA-Kamerlid Pieter Omtzigt.\n\n\"Als het aan ons ligt, was Rutte geen premier meer\", zei Ploumen. Hoe Tjeenk Willink dat gedeukte vertrouwen kan herstellen, weet ze niet. \"We wachten de voorstellen van de informateur af.\"\n\n\"De vertrouwensbreuk is niet hersteld na n gesprek met de fractievoorzitters\", zei ook Klaver. \"Mijn mening over Rutte is niet veranderd.\"\n\nSP'er Lilian Marijnissen sprak zich al eerder expliciet uit tegen samenwerking met Rutte.\n\nDe partijleiders hekelen het gebrek aan openheid en transparantie waar Rutte in hun ogen voor staat. \"Als je een fout maakt, dan moet je dat toegeven en er niet over liegen\", zei Klaver. Ploumen: \"Het probleem is dat Mark Rutte heeft gelogen. Wij hebben het vertrouwen in hem opgezegd.\"\n\nWat de vervolgstappen moeten zijn, laten ze volledig over aan Tjeenk Willink. \"Ik ga geen lijstjes maken met wat er moet gebeuren\", zei Ploumen.\n\nDe informateur ontvangt later op vrijdag nog de partijleiders Wopke Hoekstra (CDA) en Sigrid Kaag (D66), en Rutte zelf.\n\nTjeenk Willink denkt niet dat Rutte zomaar door kan\n\nTjeenk Willink suggereerde woensdag op een persconferentie dat hij Rutte niet per se een sta-in-de-weg voor een verandering van de bestuursstijl in Den Haag vindt. Toen daarover vervolgens berichten in de media verschenen, voelde de informateur zich vrijdag genoodzaakt die boodschap bij te sturen.\n\nDe conclusie dat Rutte geen belemmering vormt voor de formatie, kan hij niet voor zijn rekening nemen, luidt een schriftelijke verklaring.\n\nTjeenk Willink heeft namelijk ook de opdracht om te onderzoeken \"of en zo ja onder welke voorwaarden er voldoende vertrouwen tussen partijen bestaat of weer kan ontstaan\".`,\n      },\n    ],\n  },\n  {\n    document_id: \"Another document ID\",\n    text_fields: [\n      {\n        name: \"title\",\n        value: `CU-leider Segers vindt dat uitspraak over Rutte te veel op de man was gespeeld`,\n      },\n      {\n        name: \"text\",\n        value: `Partijleider Gert-Jan Segers van de ChristenUnie (CU) vindt dat hij te veel op de man heeft gespeeld door coalitiedeelname uit te sluiten als VVD-leider Mark Rutte opnieuw premier zou worden. Terugblikkend zegt hij dat het niet om n persoon moet gaan, maar om \"een ongezonde politieke cultuur en een genadeloze overheid\". Daar moet volgens hem verandering in komen, zo zei hij zaterdag tijdens een congres van de partij.\n\n    \n    Segers deed zijn uitspraak over Rutte na het debat over de notitie \"functie elders\" voor CDA-Kamerlid Pieter Omtzigt. Binnen de CU is verdeeldheid ontstaan over het besluit van de fractie, erkent Segers.\n    \n    Naast steun is er ook kritiek van veel leden, die zeggen dat hij \"te veel op de man heeft gespeeld en te weinig de bal\". \"Te veel Rutte, te weinig ons allemaal. En als dat de perceptie van veel mensen is, dan moet ik me dat aantrekken\", aldus Segers tijdens het congres.\n    \n    \n    Volgens de CU-leider staat \"de politieke cultuur in Den Haag natuurlijk niet los van Mark Rutte, zeker niet\".\n    \n    \"Maar die oude cultuur staat of valt niet met n man. Ook wijzelf maken er deel van uit. Ik wil niet genadeloos zijn voor personen, maar ik wil wel hard en helder zijn over een cultuur die niet deugt en een genadeloze overheid. Daar moet cht een omslag in komen\", zei Segers.\n    \n    \n    De ChristenUnie heeft vijf zetels in de Tweede Kamer. Op het congres werden vier oude Kamerleden uitgezwaaid en trad Ankie van Tatenhove aan als nieuwe partijvoorzitter.`,\n      },\n    ],\n  },\n];\n","import React, { useEffect } from \"react\";\n\nimport db from \"../apis/dexie\";\nimport { useHistory } from \"react-router-dom\";\nimport { Grid, Button, Header, Segment } from \"semantic-ui-react\";\nimport { initStoragePersistence } from \"../apis/storemanager\";\nimport { demo_articles, demo_codebook } from \"../apis/demodata\";\n\nconst Welcome = ({ items }) => {\n  const history = useHistory();\n\n  const loggin = async (addDemo, checkWelcome) => {\n    if (checkWelcome) {\n      const iswelcome = await db.isWelcome();\n      if (!iswelcome) return null;\n    }\n    try {\n      if (addDemo) await create_demo_job(db);\n      await db.welcome();\n      await initStoragePersistence();\n      history.push(items[0].path);\n    } catch (e) {}\n  };\n\n  useEffect(() => {\n    loggin(false, true);\n  });\n\n  return (\n    <Grid inverted textAlign=\"center\" style={{ height: \"100vh\" }} verticalAlign=\"middle\">\n      <Grid.Column style={{ maxWidth: 450 }}>\n        <Segment style={{ border: 0 }}>\n          <Header as=\"h2\" textAlign=\"center\">\n            Welcome to the AmCAT annotator\n          </Header>\n          <p>\n            This is the (early development version of the) AmCAT annotator. The fact that you see\n            this message means that you're either here for the first time, or your local annotation\n            database was reset (by you or your browser).\n          </p>\n          <p>\n            The annotator stores your codingjobs and annotations on your local computer in your\n            browser's IndexedDB. Your data will only actually touch the internet when you\n            synchronize your data.\n          </p>\n          <Button primary onClick={() => loggin(true, false)}>\n            Yes, off course I trust you\n          </Button>\n        </Segment>\n      </Grid.Column>\n    </Grid>\n  );\n};\n\nconst create_demo_job = async (db) => {\n  try {\n    const job = await db.createCodingjob(\"Demo codingjob\");\n    await db.createDocuments(job, demo_articles, true);\n    await db.writeCodebook(job, demo_codebook);\n    return null;\n  } catch (e) {\n    console.log(e);\n  }\n};\n\nexport default Welcome;\n","import React, { useState } from \"react\";\nimport { Route, Redirect } from \"react-router\";\nimport db from \"../apis/dexie\";\n\nconst AuthRoute = ({ Component, homepage, ...componentProps }) => {\n  const [loading, setLoading] = useState(true);\n  const [hasdb, setHasdb] = useState(false);\n  // the trick for passing on componentProps is basically\n  // redundant now that we use Redux, but leaving it intact just in case\n\n  const connect = async () => {\n    if (await db.isWelcome()) {\n      setHasdb(true);\n    } else {\n      setHasdb(false);\n    }\n    setLoading(false);\n  };\n\n  connect();\n\n  return (\n    <Route\n      {...componentProps}\n      render={(props) =>\n        loading ? (\n          <div>loading...</div>\n        ) : hasdb ? (\n          <Component {...componentProps} {...props} />\n        ) : (\n          <Redirect to={homepage} />\n        )\n      }\n    />\n  );\n};\n\nexport default AuthRoute;\n","import React, { useEffect, useState } from \"react\";\nimport { useTable, useSortBy, usePagination, useGlobalFilter } from \"react-table\";\nimport {\n  Table,\n  TableHeader,\n  TableBody,\n  TableRow,\n  TableHeaderCell,\n  TableCell,\n  Pagination,\n  Icon,\n} from \"semantic-ui-react\";\n\n// Uses react-table with semantic ui. The columns and data arguments are lists of objects\n// The 'columns' argument specifies column names (Header) and the names of the keys to get from data.\n//\n// const columns = [\n//   { Header: \"ID\", accessor: \"id\", headerClass: \"one wide\" },\n//   { Header: \"Name\", accessor: \"text\", headerClass: \"one wide\" },\n// ]\n//\n// Note that headerClass is custom, and enables setting the header cell class,\n// which is used in semantic ui to specify the width (one wide, ten wide, etc).\n\nconst SelectionTable = ({\n  columns,\n  data,\n  selectedRow,\n  setSelectedRow,\n  width = null,\n  defaultSize = 15,\n}) => {\n  const [activeRow, setActiveRow] = useState(selectedRow ? selectedRow.ROW_ID : null);\n  const {\n    getTableProps,\n    getTableBodyProps,\n    headerGroups,\n    prepareRow,\n    page,\n    pageCount,\n    gotoPage,\n    preGlobalFilteredRows,\n    setGlobalFilter,\n    state: { pageIndex, globalFilter },\n  } = useTable(\n    {\n      columns,\n      data,\n      initialState: { pageSize: defaultSize, globalFilter: \"\" },\n    },\n\n    useGlobalFilter,\n    useSortBy,\n    usePagination\n  );\n\n  useEffect(() => {\n    if (selectedRow) {\n      setActiveRow(selectedRow.ROW_ID);\n    } else {\n      setActiveRow(null);\n    }\n  }, [selectedRow]);\n\n  const onRowSelect = (row) => {\n    if (activeRow && activeRow === row.id) {\n      setSelectedRow(null);\n      setActiveRow(null);\n    } else {\n      setSelectedRow({ ...data[row.id], ROW_ID: row.id });\n      setActiveRow(row.id);\n    }\n  };\n\n  const createHeader = (headerGroup) => {\n    return headerGroup.headers.map((column) => {\n      return (\n        <TableHeaderCell\n          className={column.headerClass}\n          {...column.getHeaderProps(column.getSortByToggleProps())}\n        >\n          {column.render(\"Header\")}\n          <span>{column.isSorted ? (column.isSortedDesc ? \" \" : \" \") : \"\"}</span>\n        </TableHeaderCell>\n      );\n    });\n  };\n\n  const createBody = (page) => {\n    return page.map((row, i) => {\n      prepareRow(row);\n      return (\n        <TableRow\n          active={activeRow ? activeRow === row.id : false}\n          onClick={() => onRowSelect(row)}\n          {...row.getRowProps()}\n        >\n          {row.cells.map((cell) => {\n            return (\n              <TableCell title={cell.value} {...cell.getCellProps()}>\n                {cell.render(\"Cell\")}\n              </TableCell>\n            );\n          })}\n        </TableRow>\n      );\n    });\n  };\n\n  if (data.length === 0) return null;\n\n  return (\n    <div style={{ width: width }}>\n      <GlobalFilter\n        preGlobalFilteredRows={preGlobalFilteredRows}\n        globalFilter={globalFilter}\n        setGlobalFilter={setGlobalFilter}\n      />\n      <Table compact unstackable fixed singleLine selectable {...getTableProps()}>\n        <TableHeader>\n          {headerGroups.map((headerGroup) => (\n            <TableRow {...headerGroup.getHeaderGroupProps()}>{createHeader(headerGroup)}</TableRow>\n          ))}\n        </TableHeader>\n        <TableBody {...getTableBodyProps()}>{createBody(page)}</TableBody>\n        <Table.Footer>\n          <Table.Row>\n            <Table.HeaderCell colSpan={columns.length}>\n              {data.length > defaultSize ? (\n                <Pagination\n                  floated=\"right\"\n                  style={{ border: \"0\" }}\n                  size=\"mini\"\n                  firstItem={false}\n                  lastItem={false}\n                  nextItem={false}\n                  prevItem={false}\n                  boundaryRange={1}\n                  ellipsisItem={{\n                    content: <Icon name=\"ellipsis horizontal\" />,\n                    icon: true,\n                  }}\n                  activePage={pageIndex + 1}\n                  totalPages={pageCount}\n                  onPageChange={(event, data) => {\n                    gotoPage(data.activePage - 1);\n                  }}\n                />\n              ) : null}\n            </Table.HeaderCell>\n          </Table.Row>\n        </Table.Footer>\n      </Table>\n    </div>\n  );\n};\n\nconst GlobalFilter = ({ preGlobalFilteredRows, globalFilter, setGlobalFilter }) => {\n  //const count = preGlobalFilteredRows && preGlobalFilteredRows.length;\n\n  return (\n    <span>\n      <input\n        value={globalFilter || \"\"}\n        onChange={(e) => {\n          setGlobalFilter(e.target.value || undefined); // Set undefined to remove the filter entirely\n        }}\n        placeholder={`Enter search term`}\n        style={{\n          border: \"0\",\n        }}\n      />\n    </span>\n  );\n};\n\nexport default SelectionTable;\n","import React, { useState } from \"react\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport { selectCodingjob, setCodingjobs } from \"../actions\";\nimport { Header, Button, Modal, Form, Loader, Dimmer, Icon } from \"semantic-ui-react\";\nimport db from \"../apis/dexie\";\n\nconst CreateCodingjob = () => {\n  const codingjobs = useSelector((state) => state.codingjobs);\n  const dispatch = useDispatch();\n\n  const [status, setStatus] = useState(\"inactive\");\n  const [codingjobName, setCodingjobName] = useState(\"\");\n\n  const onSubmit = async (event) => {\n    event.preventDefault();\n\n    setCodingjobName(codingjobName.trim());\n    setStatus(\"pending\");\n\n    try {\n      await db.createCodingjob(codingjobName);\n      const codingjobs = await db.listCodingjobs();\n      dispatch(selectCodingjob(null));\n      dispatch(setCodingjobs(codingjobs));\n      setStatus(\"inactive\");\n    } catch (e) {\n      console.log(e);\n      setStatus(\"error\");\n    }\n  };\n\n  if (!codingjobs) return null;\n\n  return (\n    <Modal\n      as={Form}\n      trigger={\n        <Button>\n          <Icon name=\"plus\" />\n          Create job\n        </Button>\n      }\n      onSubmit={(e) => onSubmit(e)}\n      open={status !== \"inactive\"}\n      onClose={() => setStatus(\"inactive\")}\n      onOpen={() => {\n        setCodingjobName(\"\");\n        setStatus(\"awaiting input\");\n      }}\n      size=\"tiny\"\n    >\n      <Header icon=\"pencil\" content=\"Create new Codingjob\" as=\"h2\" />\n      <Modal.Content>\n        <Form.Group>\n          <Form.Input\n            width={12}\n            label=\"Name\"\n            required\n            type=\"text\"\n            value={codingjobName}\n            onChange={(e, d) => {\n              setStatus(\"awaiting input\");\n              setCodingjobName(d.value);\n            }}\n            placeholder=\"Enter name\"\n          />\n        </Form.Group>\n      </Modal.Content>\n      <Modal.Actions>\n        {status === \"error\" ? (\n          <div>\n            Could not create codingjob for a reason not yet covered in the error handling...\n          </div>\n        ) : null}\n        {status === \"pending\" ? (\n          <Dimmer active inverted>\n            <Loader content=\"Creating codingjob\" />\n          </Dimmer>\n        ) : (\n          <Button type=\"submit\" color=\"green\" icon=\"save\" content=\"Create\" />\n        )}\n      </Modal.Actions>\n    </Modal>\n  );\n};\n\nexport default CreateCodingjob;\n","import React, { useState } from \"react\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport { selectCodingjob, setCodingjobs } from \"../actions\";\nimport { Button, Header, Icon, Modal, Dimmer, Loader } from \"semantic-ui-react\";\nimport db from \"../apis/dexie\";\n\nconst DeleteCodingjob = () => {\n  const codingjob = useSelector((state) => state.codingjob);\n  const dispatch = useDispatch();\n\n  const [status, setStatus] = useState(\"inactive\");\n\n  const onSubmit = async (event) => {\n    setStatus(\"pending\");\n    try {\n      await db.deleteCodingjob(codingjob);\n      const codingjobs = await db.listCodingjobs();\n\n      dispatch(selectCodingjob(null));\n      dispatch(setCodingjobs(codingjobs));\n\n      setStatus(\"inactive\");\n    } catch (e) {\n      console.log(e);\n      setStatus(\"error\");\n    }\n  };\n\n  if (!codingjob) return null;\n\n  return (\n    <Modal\n      closeIcon\n      open={status !== \"inactive\"}\n      trigger={\n        <Button compact>\n          <Icon name=\"minus\" /> Delete job\n        </Button>\n      }\n      onClose={() => {\n        setStatus(\"inactive\");\n      }}\n      onOpen={() => {\n        setStatus(\"awaiting input\");\n      }}\n    >\n      <Header icon=\"trash\" content={`Delete codingjob ${codingjob.name}`} />\n      <Modal.Content>\n        <p>Do you really want to delete this codingjob?</p>\n      </Modal.Content>\n      <Modal.Actions>\n        {status === \"error\" ? (\n          <div>\n            Could not delete codingjob for a reason not yet covered in the error handling...\n          </div>\n        ) : null}\n        {status === \"pending\" ? (\n          <Dimmer active inverted>\n            <Loader content=\"Deleting codingjob\" />\n          </Dimmer>\n        ) : (\n          <>\n            <Button\n              color=\"red\"\n              onClick={() => {\n                setStatus(\"inactive\");\n              }}\n            >\n              <Icon name=\"remove\" /> No\n            </Button>\n            <Button color=\"green\" onClick={onSubmit}>\n              <Icon name=\"checkmark\" /> Yes\n            </Button>\n          </>\n        )}\n      </Modal.Actions>\n    </Modal>\n  );\n};\n\nexport default DeleteCodingjob;\n","import React, { useState, useEffect } from \"react\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport { Button, Segment, Dropdown, Container } from \"semantic-ui-react\";\nimport { selectCodingjob, setCodingjobs } from \"../actions\";\n\nimport SelectionTable from \"./SelectionTable\";\nimport CreateCodingjob from \"./CreateCodingjob\";\nimport DeleteCodingjob from \"./DeleteCodingjob\";\nimport db from \"../apis/dexie\";\n\nconst CodingjobSelector = ({ type = \"table\" }) => {\n  const codingjobs = useSelector((state) => state.codingjobs);\n  const codingjob = useSelector((state) => state.codingjob);\n  const dispatch = useDispatch();\n\n  const [selectedCodingjob, setSelectedCodingjob] = useState(codingjob);\n\n  useEffect(() => {\n    setCodingjob(dispatch, selectedCodingjob);\n  }, [selectedCodingjob, dispatch]);\n\n  useEffect(() => {\n    if (!codingjob) setSelectedCodingjob(null);\n  }, [codingjob, dispatch]);\n\n  useEffect(() => {\n    if (codingjobs.length === 0) {\n      getCodingjobs(dispatch, setSelectedCodingjob);\n    }\n  }, [codingjobs, dispatch]);\n\n  if (type === \"table\") {\n    const tableColumns = [\n      {\n        Header: \"Coding job\",\n        accessor: \"name\",\n        headerClass: \"thirteen wide\",\n      },\n    ];\n\n    return (\n      <Segment style={{ border: \"0\" }}>\n        <Button.Group widths=\"2\">\n          <CreateCodingjob />\n          <DeleteCodingjob />\n        </Button.Group>\n\n        <Container style={{ marginTop: \"30px\", overflow: \"auto\", width: \"800px\" }}>\n          <SelectionTable\n            columns={tableColumns}\n            data={codingjobs ? codingjobs : []}\n            selectedRow={selectedCodingjob}\n            setSelectedRow={setSelectedCodingjob}\n            defaultSize={15}\n          />\n        </Container>\n      </Segment>\n    );\n  }\n\n  if (type === \"dropdown\") {\n    const asDropdownItems = (indices) => {\n      return indices.map((index) => {\n        return { key: index.job_id, text: index.name, value: index.name };\n      });\n    };\n\n    const onDropdownSelect = (value) => {\n      if (value && codingjobs.length > 0) {\n        const i = codingjobs.findIndex((row) => row.name === value);\n        setSelectedCodingjob({ ...codingjobs[i], ROW_ID: i.toString() });\n      } else {\n        setSelectedCodingjob(null);\n      }\n    };\n\n    return (\n      <Dropdown\n        inline\n        search\n        options={asDropdownItems(codingjobs)}\n        value={codingjob ? codingjob.name : null}\n        onChange={(e, d) => onDropdownSelect(d.value)}\n      />\n    );\n  }\n\n  return null;\n};\n\nconst setCodingjob = async (dispatch, codingjob) => {\n  if (!codingjob) {\n    dispatch(selectCodingjob(null));\n    return;\n  }\n  const ROW_ID = codingjob.ROW_ID;\n  const cj = await db.getCodingjob(codingjob);\n  if (cj) {\n    cj.ROW_ID = ROW_ID;\n    dispatch(selectCodingjob(cj));\n  }\n};\n\nconst getCodingjobs = async (dispatch, setSelectedCodingjob) => {\n  // the exists check is super annoying, but if db is included in useEffect, it somehow\n  // rerenders non-stop, and if this check is not here then a new DB will be created immediately\n  // when reset is called.\n  //const exists = await Dexie.exists(\"AmCAT_Annotator\");\n  //if (!exists) return null;\n  if (!db.isWelcome()) return null;\n  try {\n    const cjs = await db.listCodingjobs();\n    if (cjs.length > 0) {\n      dispatch(setCodingjobs(cjs));\n      setSelectedCodingjob({ ...cjs[0], ROW_ID: \"0\" });\n    }\n  } catch (e) {\n    console.log(e);\n  }\n};\n\nexport default CodingjobSelector;\n","import React, { useEffect, useState } from \"react\";\nimport { useSelector } from \"react-redux\";\nimport { Container, Pagination, Table, Icon } from \"semantic-ui-react\";\nimport db from \"../apis/dexie\";\n\nconst PAGESIZE = 10;\n\nconst DocumentTable = () => {\n  const codingjob = useSelector((state) => state.codingjob);\n  const [data, setData] = useState([]);\n  const [pages, setPages] = useState(1);\n  const [columns, setColumns] = useState([]);\n\n  useEffect(() => {\n    if (!codingjob) {\n      setData([]);\n      setColumns([]);\n      return null;\n    }\n    fetchFromDb(codingjob, PAGESIZE, setPages, setData, setColumns);\n  }, [codingjob]);\n\n  const createHeaderRow = (data, columns) => {\n    return columns.map((colname, i) => {\n      return (\n        <Table.HeaderCell key={i}>\n          <span title={colname}>{colname}</span>\n        </Table.HeaderCell>\n      );\n    });\n  };\n\n  const createBodyRows = (data) => {\n    return data.map((rowObj, i) => {\n      return <Table.Row key={i}>{createRowCells(rowObj)}</Table.Row>;\n    });\n  };\n\n  const tokensToText = (tokens, section) => {\n    return tokens.reduce((text, token) => {\n      if (token.section === section) text = text + token.pre + token.token + token.post;\n      return text;\n    }, \"\");\n  };\n\n  const createRowCells = (rowObj) => {\n    return columns.map((key, i) => {\n      let content = null;\n      if (key === \"document_id\") {\n        content = rowObj.document_id;\n      } else {\n        if (rowObj.text_fields) {\n          content = rowObj.text_fields.find((tf) => tf.name === key);\n          if (content) content = content.value;\n        }\n        if (!content && !rowObj.text_fields && rowObj.tokens) {\n          content = tokensToText(rowObj.tokens, key);\n        }\n      }\n\n      return (\n        <Table.Cell key={i}>\n          <span title={content}>{content}</span>\n        </Table.Cell>\n      );\n    });\n  };\n\n  const pageChange = async (event, data) => {\n    const offset = (data.activePage - 1) * PAGESIZE;\n    const newdata = await db.getJobDocumentsBatch(codingjob, offset, PAGESIZE);\n    setData(newdata);\n    setColumns(getColumns(newdata));\n  };\n\n  if (data.length < 1) return null;\n\n  return (\n    <Container style={{ marginTop: \"2em\" }}>\n      <Table fixed compact celled singleLine>\n        <Table.Header>\n          <Table.Row>{createHeaderRow(data, columns)}</Table.Row>\n        </Table.Header>\n        <Table.Body>{createBodyRows(data)}</Table.Body>\n        <Table.Footer>\n          <Table.Row>\n            <Table.HeaderCell colSpan={columns.length}>\n              {pages > 1 ? (\n                <Pagination\n                  floated=\"right\"\n                  boundaryRange={1}\n                  siblingRange={1}\n                  ellipsisItem={{\n                    content: <Icon name=\"ellipsis horizontal\" />,\n                    icon: true,\n                  }}\n                  firstItem={{\n                    content: <Icon name=\"angle double left\" />,\n                    icon: true,\n                  }}\n                  lastItem={{\n                    content: <Icon name=\"angle double right\" />,\n                    icon: true,\n                  }}\n                  prevItem={{ content: <Icon name=\"angle left\" />, icon: true }}\n                  nextItem={{\n                    content: <Icon name=\"angle right\" />,\n                    icon: true,\n                  }}\n                  pointing\n                  secondary\n                  defaultActivePage={1}\n                  totalPages={pages}\n                  onPageChange={pageChange}\n                ></Pagination>\n              ) : null}\n            </Table.HeaderCell>\n          </Table.Row>\n        </Table.Footer>\n      </Table>\n    </Container>\n  );\n};\n\nconst fetchFromDb = async (codingjob, pageSize, setPages, setData, setColumns) => {\n  const n = await db.getJobDocumentCount(codingjob);\n  setPages(Math.ceil(n / pageSize));\n  let newdata = [];\n  if (n > 0) newdata = await db.getJobDocumentsBatch(codingjob, 0, pageSize);\n\n  setData(newdata);\n  setColumns(getColumns(newdata));\n};\n\nconst getColumns = (newdata) => {\n  let newcolumns = [];\n  if (newdata.length > 0) {\n    newcolumns = newdata.reduce((s, row) => {\n      if (row.text_fields) {\n        for (let tf of row.text_fields) s.add(tf.name);\n      } else {\n        for (let i = 0; i < row.tokens.length; i++) s.add(row.tokens[i].section);\n      }\n      return s;\n    }, new Set());\n  }\n  return [\"document_id\", ...newcolumns];\n};\n\nexport default DocumentTable;\n","import React from \"react\";\nimport { Container } from \"semantic-ui-react\";\nimport DocumentTable from \"./DocumentTable\";\n\nconst JobDetails = () => {\n  return (\n    <Container style={{ marginTop: \"30px\", overflow: \"auto\" }}>\n      <DocumentTable />\n    </Container>\n  );\n};\n\nexport default JobDetails;\n","import React, { useRef, useEffect, useState } from \"react\";\nimport { Container, Header, Table, Grid, Form, Button, Icon, Dropdown } from \"semantic-ui-react\";\nimport { useSelector } from \"react-redux\";\n\n//import CSVReader from \"react-csv-reader\";\n//import Papa from \"papaparse\";\nimport { CSVReader } from \"react-papaparse\";\nimport db from \"../apis/dexie\";\n\nexport const UploadTextsCsv = ({ setActive }) => {\n  const columns = {\n    document_id: { required: true, multiple: false, defaults: [\"doc_id\", \"document_id\"] },\n    annotations_json: { required: false, multiple: false, defaults: [\"annotations_json\"] },\n    text_fields: {\n      required: true,\n      multiple: true,\n      defaults: [\"title\", \"headline\", \"body\", \"message\", \"text\"],\n    },\n  };\n  return <UploadCsv type=\"texts\" columns={columns} setActive={setActive} />;\n};\n\nconst renderTextForms = (columns, options, fields, setFields) => {\n  return (\n    <>\n      <Form.Group widths=\"equal\">\n        {renderForm(\"document id\", \"document_id\", columns, options, fields, setFields)}\n        {renderForm(\"annotations (json)\", \"annotations_json\", columns, options, fields, setFields)}\n      </Form.Group>\n      <Form.Group widths=\"equal\">\n        {renderForm(\"text fields\", \"text_fields\", columns, options, fields, setFields)}\n      </Form.Group>\n    </>\n  );\n};\n\nexport const UploadTokensCsv = ({ setActive }) => {\n  const columns = {\n    document_id: { required: true, multiple: false, defaults: [\"doc_id\", \"document_id\"] },\n    token: { required: true, multiple: false, defaults: [\"token\", \"text\"] },\n    sentence: {\n      required: false,\n      multiple: false,\n      defaults: [\"sentence\", \"sentence_nr\", \"sentence_id\"],\n    },\n    paragraph: {\n      required: false,\n      multiple: false,\n      defaults: [\"paragraph\", \"paragraph_nr\", \"paragraph_id\"],\n    },\n    offset: { required: false, int: true, multiple: false, defaults: [\"offset\", \"start\"] },\n    end: { required: false, int: true, multiple: false, defaults: [\"end\"] },\n    post: { required: false, multiple: false, defaults: [\"post\", \"space\"] },\n    section: { required: false, multiple: false, defaults: [\"section\"] },\n    annotations: { required: false, multiple: true, defaults: [\"annotation\"] },\n  };\n  return <UploadCsv type=\"tokens\" columns={columns} setActive={setActive} />;\n};\n\nconst renderTokenForms = (columns, options, fields, setFields) => {\n  return (\n    <>\n      <Form.Group widths=\"equal\">\n        {renderForm(\"document id\", \"document_id\", columns, options, fields, setFields)}\n        {renderForm(\"token\", \"token\", columns, options, fields, setFields)}\n        {renderForm(\"paragraph\", \"paragraph\", columns, options, fields, setFields)}\n        {renderForm(\"sentence\", \"sentence\", columns, options, fields, setFields)}\n      </Form.Group>\n      <Form.Group widths=\"equal\">\n        {renderForm(\"start / offset\", \"offset\", columns, options, fields, setFields)}\n        {renderForm(\"end\", \"end\", columns, options, fields, setFields)}\n        {renderForm(\"space / post\", \"post\", columns, options, fields, setFields)}\n        {renderForm(\"section (title, text..)\", \"section\", columns, options, fields, setFields)}\n      </Form.Group>\n      <Form.Group widths=\"equal\">\n        {renderForm(\"annotation columns\", \"annotations\", columns, options, fields, setFields, true)}\n      </Form.Group>\n    </>\n  );\n};\n\nconst UploadCsv = ({ type = \"text\", columns, setActive }) => {\n  const codingjob = useSelector((state) => state.codingjob);\n  const [data, setData] = useState([]);\n  const fileRef = useRef();\n\n  return (\n    <Container>\n      <Grid>\n        <Grid.Column width={5}>\n          <CSVReader\n            ref={fileRef}\n            nodrag\n            onFileLoad={(data) => setData(data)}\n            addRemoveButton\n            onRemoveFile={() => setData([])}\n          >\n            <span>Click to upload</span>\n          </CSVReader>\n        </Grid.Column>\n        <Grid.Column floated=\"right\" width={11}>\n          <SubmitForm\n            type={type}\n            data={data}\n            codingjob={codingjob}\n            fileRef={fileRef}\n            columns={columns}\n          />\n        </Grid.Column>\n      </Grid>\n      <PreviewTable data={data} />\n    </Container>\n  );\n};\n\nconst SubmitForm = ({ type, data, codingjob, fileRef, columns }) => {\n  const [options, setOptions] = useState([]);\n  const [fields, setFields] = useState({});\n  const [loading, setLoading] = useState(false);\n\n  useEffect(() => {\n    if (data.length <= 1) {\n      setFields({});\n      setOptions([]);\n      return;\n    }\n\n    setOptions(\n      data[0].data.map((colname) => {\n        return { key: colname, value: colname, text: colname };\n      })\n    );\n\n    let newfields = {};\n    for (let col of Object.keys(columns)) {\n      newfields[col] = columns[col].multiple ? [] : null;\n      for (let def of columns[col].defaults) {\n        if (data[0].data.includes(def)) {\n          if (columns[col].multiple) {\n            newfields[col].push(def);\n          } else newfields[col] = def;\n        }\n      }\n    }\n    setFields(newfields);\n  }, [data, columns]);\n\n  const csvToJson = (data, fields) => {\n    const keys = data[0].data;\n\n    // first get indices from header row\n    // more efficient than lookup for each row\n    const fieldIndices = { ...fields };\n    for (let field of Object.keys(fields)) {\n      if (columns[field].multiple) {\n        fieldIndices[field] = {};\n        for (let subfield of fields[field]) {\n          fieldIndices[field][subfield] = keys.findIndex((k) => k === subfield);\n        }\n      } else {\n        fieldIndices[field] = keys.findIndex((k) => k === fields[field]);\n      }\n    }\n\n    return data.slice(1).map((row) => {\n      const datarow = { original: row.data };\n\n      for (let field of Object.keys(fields)) {\n        if (columns[field].multiple) {\n          datarow[field] = [];\n          for (let subfield of fields[field]) {\n            const fieldindex = fieldIndices[field][subfield];\n            if (fieldindex < 0) continue;\n            let v = row.data[fieldindex];\n            if (columns[field].int) v = parseInt(v);\n            datarow[field].push({ name: keys[fieldindex], value: v });\n          }\n        } else {\n          const fieldindex = fieldIndices[field];\n          if (fieldindex < 0) continue;\n          let v = row.data[fieldindex];\n          datarow[field] = columns[field].int ? parseInt(v) : v;\n        }\n      }\n      return datarow;\n    });\n  };\n\n  const uploadData = async () => {\n    try {\n      setLoading(true);\n      let preparedData = csvToJson(data, fields);\n      if (type === \"tokens\") preparedData = tokensToDocumentList(preparedData);\n      await db.createDocuments(codingjob, preparedData);\n      fileRef.current.removeFile();\n      //dispatch(selectCodingjob(codingjob));\n      setLoading(false);\n    } catch (e) {\n      setLoading(false);\n    }\n  };\n\n  const allDone = () => {\n    for (let col of Object.keys(columns)) {\n      if (columns[col].multiple) {\n        if (columns[col].required && fields[col].length === 0) return false;\n      } else {\n        if (columns[col].required && !fields[col]) return false;\n      }\n    }\n    return true;\n  };\n\n  //if (data.length <= 1) return null;\n\n  return (\n    <>\n      <Form loading={loading}>\n        {type === \"texts\" ? renderTextForms(columns, options, fields, setFields) : null}\n        {type === \"tokens\" ? renderTokenForms(columns, options, fields, setFields) : null}\n        <Form.Group>\n          <Form.Field control={Button} onClick={uploadData} disabled={!allDone()}>\n            <Icon name=\"upload\" />\n            Upload\n          </Form.Field>\n        </Form.Group>\n      </Form>\n    </>\n  );\n};\n\nconst tokensToDocumentList = (data) => {\n  const documents = [];\n  let tokens = [data[0]];\n  for (let i = 1; i < data.length; i++) {\n    if (data[i].document_id !== data[i - 1].document_id) {\n      documents.push({ document_id: data[i - 1].document_id, tokens });\n      tokens = [];\n    }\n    tokens.push(data[i]);\n  }\n  return documents;\n};\n\nconst renderForm = (label, column, columns, options, fields, setFields) => {\n  return (\n    <Form.Field\n      control={Dropdown}\n      clearable\n      selection\n      multiple={columns[column].multiple ? true : false}\n      label={label}\n      required={columns[column].required}\n      options={options}\n      value={fields[column]}\n      onChange={(e, d) => {\n        const newfields = { ...fields };\n        newfields[column] = d.value;\n        setFields(newfields);\n      }}\n      style={{ minWidth: \"3em\" }}\n    />\n  );\n};\n\nconst PreviewTable = ({ data }) => {\n  const n = 5;\n\n  const createHeader = (data) => {\n    return data[0].data.map((colname) => {\n      return (\n        <Table.HeaderCell>\n          <span title={colname}>{colname}</span>\n        </Table.HeaderCell>\n      );\n    });\n  };\n\n  const createRows = (data, n) => {\n    const previewdata = data.slice(0, n + 1);\n    return previewdata.slice(1).map((row) => {\n      return <Table.Row>{createRowCells(row.data)}</Table.Row>;\n    });\n  };\n\n  const createRowCells = (row) => {\n    return row.map((cell) => {\n      return (\n        <Table.Cell>\n          <span title={cell}>{cell}</span>\n        </Table.Cell>\n      );\n    });\n  };\n\n  if (data.length <= 1) return null;\n\n  return (\n    <div\n      style={{\n        marginTop: \"3em\",\n        overflow: \"auto\",\n        width: \"85vh\",\n        border: \"solid 1px\",\n      }}\n    >\n      <Table singleline style={{ display: \"block\", width: \"100%\", border: \"solid 0px\" }}>\n        <Table.Header>\n          <Table.Row>{createHeader(data)}</Table.Row>\n        </Table.Header>\n        <Table.Body>{createRows(data, n)}</Table.Body>\n      </Table>\n      {data.length > n ? <Header align=\"center\">{data.length - 1 - n} more rows</Header> : null}\n    </div>\n  );\n};\n","import React, { useState } from \"react\";\nimport { Form, Button } from \"semantic-ui-react\";\nimport { useSelector } from \"react-redux\";\n\nimport SemanticDatepicker from \"react-semantic-ui-datepickers\";\nimport \"react-semantic-ui-datepickers/dist/react-semantic-ui-datepickers.css\";\nimport db from \"../apis/dexie\";\n\nconst UploadRaw = () => {\n  const codingjob = useSelector((state) => state.codingjob);\n\n  const [fieldValues, setFieldValues] = useState({});\n\n  const documentFields = {\n    title: \"text\",\n    text: \"text\",\n    annotations: \"text\",\n  };\n\n  const onCreate = async () => {\n    let submitData = { ...fieldValues };\n\n    for (const key of Object.keys(submitData)) {\n      if (key === \"date\" || /_date$/.test(key)) {\n        submitData[key] = submitData[key].toISOString();\n      }\n    }\n\n    try {\n      await db.createDocuments(codingjob, [submitData]);\n      setFieldValues({});\n    } catch (e) {\n      console.log(e);\n    }\n  };\n\n  if (!codingjob) return null;\n\n  return (\n    <Form style={{ marginTop: \"3em\" }}>\n      <DocumentForms\n        fields={documentFields}\n        fieldValues={fieldValues}\n        setFieldValues={setFieldValues}\n      />\n      {!codingjob ? null : (\n        <Button primary onClick={onCreate}>\n          Create document\n        </Button>\n      )}\n    </Form>\n  );\n};\n\nconst DocumentForms = function ({ fields, fieldValues, setFieldValues }) {\n  const onSubmit = (key, value) => {\n    const newFieldValues = { ...fieldValues };\n    newFieldValues[key] = value;\n    setFieldValues(newFieldValues);\n  };\n\n  if (!fields) return null;\n\n  return Object.keys(fields).map((key) => {\n    if (fields[key] === \"text\") {\n      return (\n        <Form.TextArea\n          key={key}\n          value={fieldValues[key] ? fieldValues[key] : \"\"}\n          onChange={(e, d) => onSubmit(key, d.value)}\n          label={key}\n        />\n      );\n    }\n    if (fields[key] === \"date\") {\n      return (\n        <Form.Field>\n          <SemanticDatepicker\n            key={key}\n            label={key}\n            value={fieldValues[key] ? fieldValues[key] : \"\"}\n            onChange={(e, d) => onSubmit(key, d.value)}\n          />\n        </Form.Field>\n      );\n    }\n    if (fields[key] === \"keyword\") {\n      return (\n        <Form.Field key={key}>\n          <label>{key}</label>\n          <input\n            value={fieldValues[key] ? fieldValues[key] : \"\"}\n            onChange={(e) => onSubmit(key, e.target.value)}\n          />\n        </Form.Field>\n      );\n    }\n    return null;\n  });\n};\n\nexport default UploadRaw;\n","import React, { useEffect, useState } from \"react\";\nimport {\n  Button,\n  ButtonGroup,\n  Dropdown,\n  Form,\n  Icon,\n  Input,\n  Popup,\n  Search,\n  Table,\n} from \"semantic-ui-react\";\nimport { randomColor } from \"randomcolor\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { blockEvents, setCodeMap } from \"../actions\";\nimport db from \"../apis/dexie\";\n\nconst resultRenderer = ({ code, codeTrail }) => (\n  <div key=\"content\" className=\"content\">\n    <div className=\"title\">{code}</div>\n    <div className=\"description\">{codeTrail.join(\" -> \")}</div>\n  </div>\n);\n\nconst CodeTreeTable = ({ showColors = true, typeDelay = 0, height = \"30vh\" }) => {\n  const codingjob = useSelector((state) => state.codingjob);\n  const dispatch = useDispatch();\n\n  const [loading, setLoading] = useState(false);\n  const [results, setResults] = useState([]);\n  const [value, setValue] = useState(\"\");\n\n  const [codeTreeArray, setCodeTreeArray] = useState([]);\n  const [settings, setSettings] = useState(null);\n  const [activeRow, setActiveRow] = useState(-1);\n  const [codes, setCodes] = useState([]);\n  const [changeColor, setChangeColor] = useState(null);\n  const ref = React.useRef();\n\n  useEffect(() => {\n    if (!codingjob) return null;\n    loadCodes(codingjob, setCodes, setSettings);\n  }, [codingjob, dispatch]);\n\n  useEffect(() => {\n    if (!codes || codes.length === 0) {\n      setCodeTreeArray([]);\n      dispatch(setCodeMap({}));\n      return;\n    }\n    const codeMap = prepareCodeMap(codes);\n    const cta = getCodeTreeArray(codeMap, showColors);\n    setCodeTreeArray(cta);\n    dispatch(setCodeMap(codeMap));\n  }, [codes, showColors, dispatch]);\n\n  useEffect(() => {\n    const timer = setTimeout(() => {\n      if (changeColor)\n        changeCodeColor(codingjob, changeColor.code, changeColor.color, codes, setCodes);\n      setChangeColor(null);\n    }, 500);\n    return () => clearTimeout(timer);\n  }, [codingjob, codes, setCodes, changeColor, setChangeColor]);\n\n  const timeoutRef = React.useRef();\n  const handleSearchChange = React.useCallback(\n    (e, data, codeTreeArray) => {\n      clearTimeout(timeoutRef.current);\n      setLoading(true);\n      setValue(data.value);\n\n      timeoutRef.current = setTimeout(() => {\n        if (data.value.length === 0) {\n          setLoading(false);\n          setResults(false);\n          return;\n        }\n\n        const re = new RegExp(data.value.replace(/[-/\\\\^$*+?.()|[\\]{}]/g, \"\\\\$&\"), \"i\");\n        const isMatch = (code) => re.test(code.code);\n\n        setLoading(false);\n        setResults(codeTreeArray.filter(isMatch));\n      }, typeDelay);\n    },\n    [typeDelay]\n  );\n\n  useEffect(() => {\n    if (ref.current)\n      ref.current.scrollIntoView(false, {\n        block: \"center\",\n      });\n  }, [ref, activeRow]);\n\n  React.useEffect(() => {\n    return () => {\n      clearTimeout(timeoutRef.current);\n    };\n  }, []);\n\n  const formatCode = (level) => {\n    if (level === 0) return { fontWeight: \"bold\", fontSize: \"15px\", cursor: \"pointer\" };\n    if (level === 1) return { fontSize: \"15px\", cursor: \"pointer\" };\n    if (level === 2) return { fontSize: \"14px\", cursor: \"pointer\" };\n    return { fontSize: \"13px\", cursor: \"pointer\" };\n  };\n\n  return (\n    <>\n      <Table singleLine>\n        <Table.Header className=\"codes-thead\">\n          <Table.Row>\n            <Table.HeaderCell>\n              <Search\n                showNoResults={false}\n                loading={loading}\n                onResultSelect={(e, d) => {\n                  setValue(d.result.code);\n                  setActiveRow(d.result.i);\n                }}\n                onSearchChange={(e, d) => {\n                  if (d.results.length > 0) {\n                    setActiveRow(d.results[[0]].i);\n                  } else {\n                    setActiveRow(-1);\n                  }\n                  handleSearchChange(e, d, codeTreeArray);\n                }}\n                resultRenderer={resultRenderer}\n                results={results}\n                value={value}\n                selectFirstResult={true}\n              ></Search>\n            </Table.HeaderCell>\n          </Table.Row>\n        </Table.Header>\n        <Table.Body style={{ height: height }} className=\"codes-tbody\">\n          {[...codeTreeArray, \"\"].map((code, i) => {\n            return (\n              <Table.Row className=\"codes-tr\" active={i === activeRow} key={i}>\n                <Table.Cell className=\"codes-td\">\n                  {code.code ? (\n                    <Button\n                      as={\"Input\"}\n                      style={{\n                        marginLeft: `${1.5 * code.level}em`,\n                        marginRight: \"0.8em\",\n                        padding: \"0\",\n                        width: \"1em\",\n                        height: \"1em\",\n                        color: code.color ? code.color : \"white\",\n                      }}\n                      onChange={(e) => setChangeColor({ code: code.code, color: e.target.value })}\n                      type=\"color\"\n                      value={code.color}\n                    />\n                  ) : null}\n                  <EditCodePopup\n                    codingjob={codingjob}\n                    code={code}\n                    codes={codes}\n                    setCodes={setCodes}\n                    settings={settings}\n                  >\n                    <span ref={i === activeRow ? ref : null} style={formatCode(code.level)}>\n                      {code.code}\n                    </span>\n                  </EditCodePopup>\n                </Table.Cell>\n              </Table.Row>\n            );\n          })}\n        </Table.Body>\n      </Table>\n    </>\n  );\n};\n\nconst changeCodeColor = async (codingjob, code, color, codes, setCodes) => {\n  let updatedCodes = codes.map((ucode) => {\n    if (ucode.code === code) ucode.color = color;\n    return ucode;\n  });\n  await db.writeCodes(codingjob, updatedCodes);\n  setCodes(updatedCodes);\n};\n\nconst loadCodes = async (codingjob, setCodes, setSettings) => {\n  const cj = await db.getCodingjob(codingjob);\n  if (cj.codebook) {\n    const cb = JSON.parse(cj.codebook);\n    if (cb && cb.codes && cb.codes.length > 0) {\n      setCodes(cb.codes);\n    } else {\n      setCodes([]);\n    }\n    if (cb && cb.settings) {\n      setSettings(cb.settings);\n    }\n  } else {\n    setCodes([]);\n    setSettings(null);\n  }\n};\n\nconst EditCodePopup = ({ children, codingjob, code, codes, setCodes, settings }) => {\n  const [open, setOpen] = useState(false);\n  const [popupContent, setPopupContent] = useState(null);\n\n  const buttonContent = () => {\n    return (\n      <ButtonGroup basic>\n        <Button icon=\"plus\" compact size=\"mini\" onClick={() => addCodePopup(false)} />\n        <Button icon=\"minus\" compact size=\"mini\" onClick={rmCodePopup} />\n        <Button icon=\"shuffle\" compact size=\"mini\" onClick={moveCodePopup} />\n      </ButtonGroup>\n    );\n  };\n\n  const addCodePopup = (root) => {\n    setPopupContent(\n      <AddCodePopup\n        codingjob={codingjob}\n        code={root ? \"\" : code.code}\n        codes={codes}\n        setOpen={setOpen}\n        setCodes={setCodes}\n      />\n    );\n  };\n\n  const rmCodePopup = () => {\n    setPopupContent(\n      <RmCodePopup\n        codingjob={codingjob}\n        code={code.code}\n        codes={codes}\n        setOpen={setOpen}\n        setCodes={setCodes}\n      />\n    );\n  };\n\n  const moveCodePopup = () => {\n    setPopupContent(\n      <MoveCodePopup\n        codingjob={codingjob}\n        code={code.code}\n        codes={codes}\n        setOpen={setOpen}\n        setCodes={setCodes}\n      />\n    );\n  };\n\n  if (settings && !settings.can_edit_codes) {\n    return children;\n  }\n\n  return (\n    <Popup\n      flowing\n      hoverable\n      wide\n      position=\"bottom center\"\n      onClose={() => {\n        setPopupContent(buttonContent());\n        setOpen(false);\n      }}\n      open={open}\n      mouseLeaveDelay={10000000} // just don't use mouse leave\n      style={{ padding: \"0px\" }}\n      trigger={\n        code === \"\" ? (\n          <Button\n            onClick={() => {\n              addCodePopup(true);\n              setOpen(true);\n            }}\n            style={{ marginTop: \"1em\" }}\n            compact\n            size=\"mini\"\n          >\n            Create new root\n          </Button>\n        ) : (\n          <span\n            onClick={() => {\n              setPopupContent(buttonContent);\n              setOpen(true);\n            }}\n          >\n            {children}\n          </span>\n        )\n      }\n    >\n      {popupContent}{\" \"}\n    </Popup>\n  );\n};\n\nconst AddCodePopup = ({ codingjob, code, codes, setOpen, setCodes }) => {\n  const codeMap = useSelector((state) => state.codeMap);\n  const dispatch = useDispatch();\n  const [textInput, setTextInput] = useState(\"\");\n\n  useEffect(() => {\n    dispatch(blockEvents(true));\n    return () => {\n      dispatch(blockEvents(false));\n    };\n  }, [dispatch]);\n\n  const addCode = async (newCode) => {\n    if (newCode === \"\") return null;\n    if (codeMap[newCode]) return null;\n    const updatedCodes = [...codes];\n    updatedCodes.push({ code: newCode, parent: code });\n    await db.writeCodes(codingjob, updatedCodes);\n    setCodes(updatedCodes);\n    setOpen(false);\n  };\n\n  return (\n    <div style={{ margin: \"1em\" }}>\n      <p>\n        Add code under <b>{code === \"\" ? \"Root\" : code}</b>\n        <Button floated=\"right\" compact size=\"mini\" icon=\"delete\" onClick={() => setOpen(false)} />\n      </p>\n      <Form onSubmit={() => addCode(textInput)}>\n        <Input\n          autoFocus\n          onChange={(e, d) => {\n            setTextInput(d.value);\n          }}\n          value={textInput}\n          icon={<Icon name=\"plus\" inverted circular link onClick={() => addCode(textInput)} />}\n          placeholder=\"new code\"\n        />\n      </Form>\n    </div>\n  );\n};\n\nconst RmCodePopup = ({ codingjob, code, codes, setOpen, setCodes }) => {\n  const codeMap = useSelector((state) => state.codeMap);\n  const dispatch = useDispatch();\n\n  useEffect(() => {\n    dispatch(blockEvents(true));\n    return () => {\n      dispatch(blockEvents(false));\n    };\n  }, [dispatch]);\n\n  const rmCode = async (keepChildren) => {\n    let updatedCodes = codes.filter((ucode) => ucode.code !== code);\n\n    if (!keepChildren) {\n      const children = [];\n      getAllChildren(codeMap, code, children);\n      updatedCodes = updatedCodes.filter((ucode) => !children.includes(ucode.code));\n    } else {\n      updatedCodes = updatedCodes.map((ucode) => {\n        if (codeMap[code].children.includes(ucode.code)) ucode.parent = codeMap[code].parent;\n        return ucode;\n      });\n    }\n\n    await db.writeCodes(codingjob, updatedCodes);\n    setCodes(updatedCodes);\n    setOpen(false);\n  };\n\n  return (\n    <div style={{ margin: \"1em\" }}>\n      <p>\n        Delete <b>{code}</b>?\n      </p>\n      <ButtonGroup fluid>\n        {codeMap[code].children.length > 0 ? (\n          <>\n            <Button color=\"red\" onClick={() => rmCode(false)}>\n              Yes\n            </Button>\n            <Button color=\"red\" onClick={() => rmCode(true)}>\n              Yes, but keep children\n            </Button>\n          </>\n        ) : (\n          <Button color=\"red\" onClick={() => rmCode(true)}>\n            Yes\n          </Button>\n        )}\n        <Button onClick={() => setOpen(false)}>Cancel</Button>\n      </ButtonGroup>\n    </div>\n  );\n};\n\nconst MoveCodePopup = ({ codingjob, code, codes, setOpen, setCodes }) => {\n  const codeMap = useSelector((state) => state.codeMap);\n  const dispatch = useDispatch();\n  const [newParent, setNewParent] = useState(codeMap[code].parent);\n  const [textInput, setTextInput] = useState(code);\n\n  const parentOptions = getAllParentOptions(codeMap, code); // fills parents array\n\n  useEffect(() => {\n    dispatch(blockEvents(true));\n    return () => {\n      dispatch(blockEvents(false));\n    };\n  }, [dispatch]);\n\n  const mvCode = async (newCode, newParent) => {\n    if (newCode !== code) {\n      if (newCode === \"\") return null;\n      if (codeMap[newCode]) return null;\n    }\n    let updatedCodes = codes.map((ucode) => {\n      if (ucode.code === code) {\n        ucode.code = newCode;\n        ucode.parent = newParent;\n      }\n      if (ucode.parent === code) {\n        ucode.parent = newCode;\n      }\n      return ucode;\n    });\n\n    await db.writeCodes(codingjob, updatedCodes);\n    await db.renameAnnotations(codingjob, code, newCode);\n    setCodes(updatedCodes);\n    setOpen(false);\n  };\n\n  return (\n    <div style={{ margin: \"1em\" }}>\n      <p>\n        Change parent and/or label\n        <Button floated=\"right\" compact size=\"mini\" icon=\"delete\" onClick={() => setOpen(false)} />\n      </p>\n\n      <Form onSubmit={() => mvCode(textInput, newParent)}>\n        <Form.Field inline>\n          <label>Parent:</label>\n          <Dropdown\n            value={newParent}\n            style={{ minWidth: \"10em\" }}\n            options={parentOptions.map((parent, i) => {\n              return {\n                key: parent,\n                value: parent,\n                text: parent,\n              };\n            })}\n            search\n            selectOnNavigation={false}\n            minCharacters={0}\n            autoComplete={\"on\"}\n            onChange={(e, d) => {\n              setNewParent(d.value);\n            }}\n          />\n        </Form.Field>\n        <Form.Field inline>\n          <label>Code:</label>\n          <Input\n            autoFocus\n            onChange={(e, d) => {\n              setTextInput(d.value);\n            }}\n            value={textInput}\n            placeholder=\"new code\"\n          />\n        </Form.Field>\n        <Button fluid onClick={() => mvCode(textInput, newParent)}>\n          Change\n        </Button>\n      </Form>\n    </div>\n  );\n};\n\nconst getAllChildren = (codeMap, code, children) => {\n  for (const child of codeMap[code].children) {\n    children.push(child);\n    getAllChildren(codeMap, child, children);\n  }\n};\n\nconst getAllParentOptions = (codeMap, code) => {\n  const children = [];\n  getAllChildren(codeMap, code, children);\n  return Object.keys(codeMap).filter((parent) => !children.includes(parent) && parent !== code);\n};\n\nconst getCodeTreeArray = (codeMap, showColors) => {\n  let parents = Object.keys(codeMap).filter(\n    (code) => !codeMap[code].parent || codeMap[code].parent === \"\"\n  );\n  const codeTreeArray = [];\n  fillCodeTreeArray(codeMap, parents, codeTreeArray, [], showColors);\n  return codeTreeArray.map((object, i) => ({ ...object, i: i }));\n};\n\nconst fillCodeTreeArray = (codeMap, parents, codeTreeArray, codeTrail, showColors) => {\n  for (const code of parents) {\n    let newcodeTrail = [...codeTrail];\n    newcodeTrail.push(code);\n\n    codeTreeArray.push({\n      code: code,\n      codeTrail: codeTrail,\n      level: codeTrail.length,\n      color: randomColor({ seed: code, luminosity: \"light\" }),\n      codeTrailSpan: codeTrailSpan(code, codeTrail, showColors),\n    });\n\n    if (codeMap[code].children) {\n      fillCodeTreeArray(codeMap, codeMap[code].children, codeTreeArray, newcodeTrail, showColors);\n    }\n  }\n};\n\nconst codeTrailSpan = (code, codeTrail, showColors) => {\n  return (\n    <span\n      style={{\n        display: \"inline-block\",\n        marginLeft: `${1 * codeTrail.length}em`,\n        marginRight: \"0.5em\",\n        height: \"0.7em\",\n        width: \"0.7em\",\n        borderRadius: \"50%\",\n        background: showColors ? randomColor({ seed: code, luminosity: \"light\" }) : \"grey\",\n        border: \"1px solid black\",\n      }}\n    ></span>\n  );\n};\n\nconst prepareCodeMap = (codes) => {\n  // the payload is an array of objects, but for efficients operations\n  // in the annotator we convert it to an object with the codes as keys\n  const codeMap = codes.reduce((result, code) => {\n    result[code.code] = { ...code, children: [] };\n    return result;\n  }, {});\n\n  // If there are codes of which the parent doesn't exist, add the parent\n  const originalKeys = Object.keys(codeMap);\n  for (const key of originalKeys) {\n    if (codeMap[key].parent !== \"\" && !codeMap[codeMap[key].parent])\n      codeMap[codeMap[key].parent] = { code: codeMap[key].parent, parent: \"\", children: [] };\n  }\n\n  for (const code of Object.keys(codeMap)) {\n    if (!codeMap[code].color)\n      codeMap[code].color = randomColor({ seed: code, luminosity: \"light\" });\n    codeMap[code].tree = getParentTree(codeMap, code);\n\n    if (codeMap[codeMap[code].parent]) codeMap[codeMap[code].parent].children.push(code);\n  }\n  return codeMap;\n};\n\nconst getParentTree = (codes, code) => {\n  const parents = [];\n  let parent = codes[code].parent;\n  while (parent) {\n    parents.push(parent);\n    parent = codes[parent].parent;\n  }\n  return parents.reverse();\n};\n\nexport default CodeTreeTable;\n","import React from \"react\";\nimport { Grid, Header } from \"semantic-ui-react\";\nimport { useSelector } from \"react-redux\";\n\nimport CodeTreeTable from \"./CodeTreeTable\";\n\nconst CodeBook = () => {\n  const codingjob = useSelector((state) => state.codingjob);\n\n  if (!codingjob) return null;\n\n  return (\n    <Grid>\n      <Grid.Column width={8}></Grid.Column>\n      <Grid.Column width={8} style={{ display: \"block\", overflow: \"auto\", height: \"90vh\" }}>\n        <Header as=\"h4\" textAlign=\"center\">\n          Codes\n        </Header>\n\n        <CodeTreeTable />\n      </Grid.Column>\n    </Grid>\n  );\n};\n\nexport default CodeBook;\n","import React, { useState } from \"react\";\nimport { Dropdown, Grid, Menu, Segment } from \"semantic-ui-react\";\n\nimport CodingjobSelector from \"./CodingjobSelector\";\nimport JobDetails from \"./JobDetails\";\nimport { UploadTextsCsv, UploadTokensCsv } from \"./UploadDocuments\";\nimport UploadRaw from \"./UploadRaw\";\nimport CodeBook from \"./CodeBook\";\nimport { useSelector } from \"react-redux\";\n\nconst CodingJobs = () => {\n  const codingjob = useSelector((state) => state.codingjob);\n  const [activeItem, setActiveItem] = useState(\"details\");\n\n  const renderSwitch = (activeItem) => {\n    switch (activeItem) {\n      case \"details\":\n        return <JobDetails />;\n      case \"codebook\":\n        return <CodeBook />;\n      case \"upload texts CSV\":\n        return <UploadTextsCsv />;\n      case \"upload tokens CSV\":\n        return <UploadTokensCsv />;\n      case \"upload Raw\":\n        return <UploadRaw />;\n      default:\n        return null;\n    }\n  };\n\n  return (\n    <Grid stackable>\n      <Grid.Column floated=\"left\" width={5}>\n        <CodingjobSelector type=\"table\" />\n      </Grid.Column>\n      <Grid.Column width={11}>\n        <Segment style={{ border: 0 }}>\n          <Menu pointing secondary>\n            <Menu.Item\n              name=\"details\"\n              active={activeItem === \"details\"}\n              onClick={(e, d) => setActiveItem(d.name)}\n            />\n\n            <Menu.Item\n              name=\"codebook\"\n              active={activeItem === \"codebook\"}\n              onClick={(e, d) => setActiveItem(d.name)}\n            />\n            <Dropdown as={Menu.Item} active={activeItem.includes(\"upload\")} text=\"Upload Documents\">\n              <Dropdown.Menu>\n                <Dropdown.Item\n                  text=\"Texts CSV\"\n                  onClick={(e, d) => setActiveItem(\"upload texts CSV\")}\n                />\n                <Dropdown.Item\n                  text=\"Tokens CSV\"\n                  onClick={(e, d) => setActiveItem(\"upload tokens CSV\")}\n                />\n              </Dropdown.Menu>\n            </Dropdown>\n          </Menu>\n          {!codingjob ? (\n            <div style={{ height: \"20em\" }}>\n              <i>No codingjob selected</i>\n            </div>\n          ) : (\n            renderSwitch(activeItem)\n          )}\n        </Segment>\n      </Grid.Column>\n    </Grid>\n  );\n};\n\nexport default CodingJobs;\n","export const getColor = (annotationCode, codeMap) => {\n  if (codeMap[annotationCode]) {\n    return codeMap[annotationCode].color + \"50\";\n  } else {\n    return \"white\";\n  }\n};\n","import React, { useState, useEffect, useRef } from \"react\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport { Button, Dropdown, Grid, Popup, Ref } from \"semantic-ui-react\";\nimport {\n  appendCodeHistory,\n  toggleAnnotations,\n  rmAnnotations,\n  blockEvents,\n  triggerCodeselector,\n} from \"../actions\";\nimport { getColor } from \"../util/tokenDesign\";\n\nconst arrowKeys = [\"ArrowRight\", \"ArrowLeft\", \"ArrowUp\", \"ArrowDown\"];\n\nconst CodeSelector = React.memo(({ children, annotations, currentCode, newSelection }) => {\n  const codingjob = useSelector((state) => state.codingjob);\n  const codeMap = useSelector((state) => state.codeMap);\n  const codeHistory = useSelector((state) => state.codeHistory);\n\n  const [current, setCurrent] = useState(newSelection ? \"UNASSIGNED\" : currentCode);\n  const [hasOpened, setHasOpened] = useState(false);\n\n  // Placeholder: should be managed in state\n  const dispatch = useDispatch();\n\n  useEffect(() => {\n    dispatch(blockEvents(true));\n    return () => {\n      dispatch(blockEvents(false));\n    };\n  }, [dispatch]);\n\n  return (\n    <Popup\n      trigger={children}\n      flowing\n      hoverable\n      wide\n      open\n      mouseLeaveDelay={10000000} // just don't use mouse leave\n      onOpen={() => setHasOpened(true)}\n      onClose={() => {\n        if (hasOpened) {\n          if (current === \"UNASSIGNED\")\n            updateAnnotations(annotations, current, current, setCurrent, dispatch);\n          // calling dispatch directly causes a memory leak warning, because it unmounts\n          // the component. The very minor async timeout fixes this.\n          setTimeout(() => dispatch(triggerCodeselector(null)), 10);\n        }\n      }}\n      position=\"top left\"\n      style={{ padding: \"0px\" }}\n    >\n      <div\n        style={{\n          minWidth: \"12em\",\n          textAlign: \"center\",\n          height: \"1.9em\",\n          background: \"lightgrey\",\n          border: \"1px solid\",\n        }}\n      >\n        {!current ? (\n          <b>Edit which code?</b>\n        ) : current === \"UNASSIGNED\" ? (\n          <b>Create new code</b>\n        ) : (\n          <>\n            Edit <b>{current}</b>\n          </>\n        )}\n        <Button\n          compact\n          floated=\"right\"\n          icon=\"delete\"\n          size=\"mini\"\n          style={{ background: \"#80808000\", margin: \"0px\" }}\n          onClick={() => {\n            if (current === \"UNASSIGNED\")\n              updateAnnotations(annotations, current, current, setCurrent, dispatch);\n            dispatch(triggerCodeselector(null));\n          }}\n        />\n      </div>\n      <div style={{ margin: \"1em\", border: \"0px\" }}>\n        <CurrentCodePage\n          current={current}\n          annotations={annotations}\n          codeMap={codeMap}\n          setCurrent={setCurrent}\n        />\n        <NewCodePage\n          codeHistory={codeHistory}\n          codingjob={codingjob}\n          codeMap={codeMap}\n          annotations={annotations}\n          current={current}\n          setCurrent={setCurrent}\n        />\n      </div>\n    </Popup>\n  );\n});\n\nconst CurrentCodePage = ({ current, annotations, codeMap, setCurrent }) => {\n  const annotationCodes = Object.keys(annotations);\n\n  const onButtonSelect = (value) => {\n    setCurrent(value);\n  };\n\n  const getOptions = (annotationCodes) => {\n    return annotationCodes.map((code) => ({ label: code, color: getColor(code, codeMap) }));\n  };\n\n  if (annotationCodes.length === 1) setCurrent(annotationCodes[0]);\n\n  if (current) return null;\n  return (\n    <div>\n      <ButtonSelection\n        key={\"currentCodePageButtons\"}\n        active={true}\n        options={getOptions(annotationCodes)}\n        canDelete={false}\n        callback={onButtonSelect}\n      />\n    </div>\n  );\n};\n\nconst NewCodePage = ({ codeHistory, codeMap, annotations, current, setCurrent }) => {\n  const textInputRef = useRef(null);\n  const dispatch = useDispatch();\n  const [focusOnButtons, setFocusOnButtons] = useState(true);\n\n  const onKeydown = React.useCallback(\n    (event) => {\n      const focusOnTextInput = textInputRef?.current?.children[0] === document.activeElement;\n      if (!focusOnTextInput) setFocusOnButtons(true);\n\n      if (event.keyCode === 27) dispatch(triggerCodeselector(null));\n      if (arrowKeys.includes(event.key)) return null;\n      if (event.keyCode <= 46 || event.keyCode >= 106) return null;\n      textInputRef.current.click();\n      setFocusOnButtons(false);\n    },\n    [textInputRef, dispatch]\n  );\n\n  useEffect(() => {\n    window.addEventListener(\"keydown\", onKeydown);\n    return () => {\n      window.removeEventListener(\"keydown\", onKeydown);\n    };\n  });\n\n  const onButtonSelect = (value) => {\n    if (value === null) {\n      // value is null means delete, so in that case update annotations with current value (to toggle it off)\n      updateAnnotations(annotations, current, current, setCurrent, dispatch);\n    } else {\n      updateAnnotations(annotations, current, value, setCurrent, dispatch);\n    }\n  };\n\n  const getOptions = (codeHistory, n) => {\n    return codeHistory.reduce((options, code) => {\n      if (!annotations[code] && options.length <= n)\n        options.push({ label: code, color: getColor(code, codeMap) });\n      return options;\n    }, []);\n  };\n\n  if (!current) return null;\n  return (\n    <>\n      <Grid>\n        <Grid.Column width={13} floated=\"left\">\n          <Ref innerRef={textInputRef}>\n            <Dropdown\n              fluid\n              placeholder={\"<type to search>\"}\n              style={{ minWidth: \"12em\" }}\n              options={Object.keys(codeMap).reduce((options, code) => {\n                if (!annotations[code]) {\n                  let tree = codeMap[code].tree.join(\" - \");\n                  if (tree === \"\") tree = \"Root\";\n                  options.push({\n                    key: code,\n                    value: code,\n                    text: code + \" \" + tree,\n                    content: (\n                      <>\n                        {code}\n                        <br />\n                        <span style={{ color: \"grey\" }}>{tree}</span>\n                      </>\n                    ),\n                  });\n                }\n                return options;\n              }, [])}\n              open={!focusOnButtons}\n              search\n              selection\n              compact\n              selectOnNavigation={false}\n              minCharacters={0}\n              autoComplete={\"on\"}\n              onClick={() => setFocusOnButtons(false)}\n              onSearchChange={(e, d) => {\n                if (d.searchQuery === \"\") setFocusOnButtons(true);\n              }}\n              onClose={() => setFocusOnButtons(true)}\n              onChange={(e, d) => {\n                if (codeMap[d.value])\n                  updateAnnotations(annotations, current, d.value, setCurrent, dispatch);\n              }}\n            />\n          </Ref>\n        </Grid.Column>\n      </Grid>\n      <br />\n      <ButtonSelection\n        key={\"newCodePageButtons\"}\n        active={focusOnButtons}\n        options={getOptions(codeHistory, 5)}\n        canDelete={true}\n        callback={onButtonSelect}\n      />\n      &nbsp;&nbsp;\n    </>\n  );\n};\n\nconst ButtonSelection = ({ active, options, canDelete, callback }) => {\n  // render buttons for options (an array of objects with keys 'label' and 'color')\n  // On selection perform callback function with the button label as input\n  // if canDelete is TRUE, also contains a delete button, which passes null to callback\n  const [selected, setSelected] = useState(0);\n\n  const onKeydown = React.useCallback(\n    (event) => {\n      const nbuttons = canDelete ? options.length + 1 : options.length;\n\n      // any arrowkey\n      if (arrowKeys.includes(event.key)) {\n        event.preventDefault();\n\n        if (event.key === \"ArrowRight\") {\n          if (selected < nbuttons - 1) setSelected(selected + 1);\n        }\n\n        if (event.key === \"ArrowLeft\") {\n          if (selected > 0) setSelected(selected - 1);\n        }\n\n        return;\n      }\n\n      // delete\n      if (event.keyCode === 46) callback(null);\n\n      // space or enter\n      if (event.keyCode === 32 || event.keyCode === 13) {\n        if (selected === options.length) {\n          callback(null); // this means delete button was selected\n        } else {\n          callback(options[selected].label);\n        }\n      }\n    },\n    [selected, callback, options, canDelete]\n  );\n\n  useEffect(() => {\n    if (active) {\n      window.addEventListener(\"keydown\", onKeydown);\n    } else {\n      window.removeEventListener(\"keydown\", onKeydown);\n    }\n    return () => {\n      window.removeEventListener(\"keydown\", onKeydown);\n    };\n  }, [active, onKeydown]);\n\n  const mapButtons = () => {\n    return options.map((option, i) => {\n      return (\n        <Button\n          style={{ backgroundColor: option.color }}\n          key={option.label}\n          value={option.label}\n          compact\n          size=\"mini\"\n          active={i === selected}\n          onMouseOver={() => setSelected(i)}\n          onClick={(e, d) => callback(d.value)}\n        >\n          {option.label}\n        </Button>\n      );\n    });\n  };\n\n  const deleteButton = () => {\n    if (!canDelete) return null;\n    return (\n      <Button\n        icon=\"trash\"\n        size=\"mini\"\n        floated=\"right\"\n        active={selected === options.length}\n        compact\n        style={{ backgroundColor: \"red\", borderColor: \"black\" }}\n        onMouseOver={() => setSelected(options.length)}\n        onClick={(e, d) => callback(null)}\n      />\n    );\n  };\n\n  return (\n    <span>\n      {mapButtons()}\n      {deleteButton()}\n    </span>\n  );\n};\n\nconst updateAnnotations = (annotations, current, value, setCurrent, dispatch) => {\n  if (!annotations) return null;\n\n  let ann = { ...annotations[current] };\n  ann.group = current;\n\n  let oldAnnotation = { ...ann };\n  oldAnnotation.span = [oldAnnotation.index, oldAnnotation.index];\n  dispatch(rmAnnotations([oldAnnotation]));\n\n  if (value === current) {\n    dispatch(triggerCodeselector(null, null, null));\n    return null;\n  }\n\n  let newAnnotations = [];\n  for (let i = ann.span[0]; i <= ann.span[1]; i++) {\n    let newAnnotation = { ...ann };\n    newAnnotation.group = value;\n    newAnnotation.index = i;\n    newAnnotations.push(newAnnotation);\n  }\n  dispatch(toggleAnnotations(newAnnotations));\n  dispatch(appendCodeHistory(value));\n\n  // if (Object.keys(annotations).includes(null)) {\n  //   setCurrent(null);\n  // } else {\n  //   setCurrent(value);\n  // }\n\n  dispatch(triggerCodeselector(null, null, null));\n};\n\nexport default CodeSelector;\n","import React from \"react\";\nimport { useDispatch, useSelector } from \"react-redux\";\n\nimport \"./style.css\";\nimport CodeSelector from \"./CodeSelector\";\nimport { triggerCodeselector } from \"../actions\";\nimport { getColor } from \"../util/tokenDesign\";\n\nconst Token = React.forwardRef(({ token }, ref) => {\n  const selected = useSelector((state) => {\n    if (state.tokenSelection.length === 0) return false;\n\n    let [from, to] = state.tokenSelection;\n    if (from > to) [to, from] = [from, to];\n    return token.index >= from && token.index <= to;\n  });\n\n  let tokenClass = \"token\";\n  if (selected) tokenClass = tokenClass + \" selected\";\n\n  return (\n    <span ref={ref} className={tokenClass} tokenindex={token.index}>\n      <AnnotatedToken token={token} selected={selected} />\n    </span>\n  );\n});\n\nconst AnnotatedToken = ({ token, selected }) => {\n  // If we specifically ask for the annotations for the current token within the\n  // useSelector function, rerender is only triggered if this value has changed\n  const annotations = useSelector((state) => state.spanAnnotations[token.index]);\n  const csTrigger = useSelector((state) => {\n    if (state.codeSelectorTrigger.index !== token.index) return null;\n    return state.codeSelectorTrigger;\n  });\n  const codeMap = useSelector((state) => state.codeMap);\n  const dispatch = useDispatch();\n\n  // This is a trick required to render if at least something within this token's\n  // annotations changed (somehow 'annotations' doesn't trigger this)\n  useSelector((state) => JSON.stringify(state.spanAnnotations[token.index]));\n\n  // if there are no annotation codes, our life is easy\n  if (!annotations) return <>{token.pre + token.text + token.post}</>;\n\n  const tokenSpan = (annotatedTokenClass, color) => {\n    return (\n      <span\n        className={annotatedTokenClass}\n        onContextMenu={(e) => {\n          e.preventDefault();\n          dispatch(triggerCodeselector(\"right_click\", token.index, null));\n        }}\n        style={color ? { background: color } : null}\n      >\n        {allLeft && allRight ? token.text : null}\n        {allLeft && !allRight ? token.text + token.post : null}\n        {allRight && !allLeft ? token.pre + token.text : null}\n        {!allLeft && !allRight ? token.pre + token.text + token.post : null}\n      </span>\n    );\n  };\n\n  let tokenCodes = Object.keys(annotations);\n  let color = null;\n  if (tokenCodes.length === 1) {\n    color = getColor(tokenCodes[0], codeMap);\n  } else {\n    let colors = tokenCodes.map((code) => getColor(code, codeMap));\n    color = `linear-gradient(${colors.join(\", \")})`;\n  }\n\n  // Set specific classes for nice css to show the start/end of codes\n  const allLeft = !Object.values(annotations).some((code) => code.span[0] !== code.index);\n  const allRight = !Object.values(annotations).some((code) => code.span[1] !== code.index);\n  const anyLeft = Object.values(annotations).some((code) => code.span[0] === code.index);\n  const anyRight = Object.values(annotations).some((code) => code.span[1] === code.index);\n\n  let annotatedTokenClass = \"annotatedToken\";\n  if (allLeft) annotatedTokenClass = annotatedTokenClass + \" allLeft\";\n  if (anyLeft & !allLeft) annotatedTokenClass = annotatedTokenClass + \" anyLeft\";\n  if (allRight) annotatedTokenClass = annotatedTokenClass + \" allRight\";\n  if (anyRight & !allRight) annotatedTokenClass = annotatedTokenClass + \" anyRight\";\n\n  if (selected) {\n    color = null;\n    annotatedTokenClass = annotatedTokenClass + \" selected\";\n  }\n\n  return (\n    <>\n      {allLeft ? token.pre : null}\n\n      {csTrigger ? (\n        <CodeSelector\n          annotations={annotations}\n          currentCode={csTrigger.code}\n          newSelection={csTrigger.from === \"new_selection\"}\n        >\n          {tokenSpan(annotatedTokenClass, color)}\n        </CodeSelector>\n      ) : (\n        tokenSpan(annotatedTokenClass, color)\n      )}\n\n      {allRight ? token.post : null}\n    </>\n  );\n};\n\nexport default React.memo(Token);\n","import React, { useEffect, useState } from \"react\";\nimport { Container } from \"semantic-ui-react\";\nimport Token from \"./Token\";\nimport db from \"../apis/dexie\";\n\nimport { parseTokens } from \"../util/tokens\";\n\nconst Tokens = ({ doc }) => {\n  // It's imporant that the annotations to not pass by this component\n  // but are loaded into Token from redux. This prevents rerendering\n  // all the parsing stuff\n  const [tokenComponents, setTokenComponents] = useState(null);\n\n  useEffect(() => {\n    prepareTokens(doc, setTokenComponents);\n  }, [doc]);\n\n  if (doc === null) return null;\n\n  return <Container textAlign=\"justified\">{tokenComponents}</Container>;\n};\n\nconst prepareTokens = async (doc, setTokenComponents) => {\n  let tokens = doc.tokens;\n\n  if (!tokens) {\n    tokens = parseTokens(doc.text_fields);\n    await db.writeTokens(doc, tokens);\n  }\n  if (!tokens) return null;\n  setTokenComponents(renderText(tokens));\n  doc.tokens = tokens;\n};\n\nconst renderText = (tokens) => {\n  const text = [];\n  let paragraph = [];\n  let sentence = [];\n  let paragraph_nr = tokens[0].paragraph;\n  let sentence_nr = tokens[0].sentence;\n  let section = tokens[0].section;\n  for (let i = 0; i < tokens.length; i++) {\n    if (tokens[i].paragraph !== paragraph_nr) {\n      paragraph.push(renderSentence(section + sentence_nr, sentence));\n      text.push(renderParagraph(section + paragraph_nr, paragraph, section));\n      paragraph = [];\n      sentence = [];\n      paragraph_nr = tokens[i].paragraph;\n      sentence_nr = tokens[i].sentence;\n      section = tokens[i].section;\n    }\n    if (tokens[i].sentence !== sentence_nr) {\n      paragraph.push(renderSentence(section + sentence_nr, sentence));\n      sentence = [];\n      sentence_nr = tokens[i].sentence;\n    }\n\n    tokens[i].index = i;\n    tokens[i].ref = React.createRef();\n    sentence.push(renderToken(tokens[i]));\n  }\n  paragraph.push(renderSentence(section + sentence_nr, sentence));\n  text.push(renderParagraph(section + paragraph_nr, paragraph, section));\n\n  return text;\n};\n\nconst renderParagraph = (paragraph_nr, sentences, section) => {\n  return (\n    // uses span behaving like p, because p is not allowed due to nested div (for Label)\n    <span style={{ marginTop: \"1em\", display: \"table\", lineHeight: 1.65 }} key={paragraph_nr}>\n      {section === \"title\" ? <h2>{sentences}</h2> : sentences}\n    </span>\n  );\n};\n\nconst renderSentence = (sentence_nr, tokens) => {\n  return (\n    <span className=\"sentence\" key={sentence_nr}>\n      {tokens}\n    </span>\n  );\n};\n\nconst renderToken = (token) => {\n  return <Token ref={token.ref} key={token.index} token={token} />;\n};\n\nexport default React.memo(Tokens);\n","import React, { useEffect } from \"react\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport { appendCodeHistory, resetCodeHistory, setAnnotations } from \"../actions\";\nimport db from \"../apis/dexie\";\n\n// this component generates no content, but manages writing and reading of annotations\n\nconst SpanAnnotationsDB = ({ doc }) => {\n  let annotations = useSelector((state) => state.spanAnnotations);\n  const dispatch = useDispatch();\n\n  useEffect(() => {\n    if (doc.writable) exportAnnotations(doc, annotations);\n  }, [doc, annotations]);\n\n  useEffect(() => {\n    if (doc.writable || doc.tokens.length === 0) return;\n    matchAnnotations(doc, dispatch);\n    doc.writable = true; // this ensures that each new doc first does the matching step\n  }, [doc, dispatch]);\n\n  return <div></div>;\n};\n\nconst exportAnnotations = async (doc, annotations) => {\n  const uniqueAnnotations = Object.values(annotations).reduce((un_ann, ann) => {\n    for (let key of Object.keys(ann)) {\n      if (ann[key].index !== ann[key].span[0]) continue;\n      const annotationTokens = doc.tokens.slice(ann[key].span[0], ann[key].span[1] + 1);\n      const text = annotationTokens\n        .map((at, i) => {\n          const pre = i > 0 ? at.pre : \"\";\n          const post = i < annotationTokens.length - 1 ? at.post : \"\";\n          return pre + at.text + post;\n        })\n        .join(\"\");\n      const ann_obj = {\n        code: key,\n        text: text,\n        section: ann[key].section,\n        offset: ann[key].offset,\n        index: ann[key].index,\n        length: ann[key].length,\n      };\n      un_ann.push(ann_obj);\n    }\n    return un_ann;\n  }, []);\n\n  await db.writeAnnotations({ doc_id: doc.doc_id }, uniqueAnnotations);\n};\n\nconst matchAnnotations = (doc, dispatch) => {\n  console.log(\"matching annotations\");\n  console.log(doc.annotations);\n  const importedAnnotations = prepareAnnotations(doc.annotations);\n  let trackAnnotations = {};\n  let matchedAnnotations = [];\n\n  for (let token of doc.tokens) {\n    findMatches(token, importedAnnotations, trackAnnotations, matchedAnnotations);\n  }\n\n  const codeCounter = {};\n  const annArray = [];\n  for (let matchedAnnotation of matchedAnnotations) {\n    if (!codeCounter[matchedAnnotation.group]) codeCounter[matchedAnnotation.group] = 0;\n    codeCounter[matchedAnnotation.group]++;\n    annArray.push(matchedAnnotation);\n  }\n  addAnnotations(annArray, dispatch);\n\n  let topCodes = Object.keys(codeCounter).sort(function (a, b) {\n    return codeCounter[a] - codeCounter[b];\n  });\n  dispatch(resetCodeHistory());\n  for (const code of topCodes.slice(-5)) {\n    if (code === \"UNASSIGNED\") continue;\n    dispatch(appendCodeHistory(code));\n  }\n};\n\nconst findMatches = (token, importedAnnotations, trackAnnotations, matchedAnnotations) => {\n  const start = token.offset;\n  const end = token.offset + token.length;\n\n  for (let i = start; i <= end; i++) {\n    const key = `${token.section}-${i}`;\n\n    if (importedAnnotations[key]) {\n      for (let code of importedAnnotations[key].start) {\n        trackAnnotations[code] = { ...token };\n        trackAnnotations[code].group = code;\n        trackAnnotations[code].offset = start;\n        trackAnnotations[code].length = null;\n        trackAnnotations[code].span = [token.index];\n      }\n\n      for (let code of importedAnnotations[key].end) {\n        if (!trackAnnotations[code]) continue;\n        trackAnnotations[code].span.push(token.index);\n        trackAnnotations[code].length = token.offset + token.length - trackAnnotations[code].offset;\n        matchedAnnotations.push(trackAnnotations[code]);\n        delete trackAnnotations[code];\n      }\n    }\n  }\n};\n\nconst prepareAnnotations = (annotations) => {\n  if (!annotations || annotations === \"\") return {};\n\n  // create an object where the key is a section+offset, and the\n  // value is an array that tells which codes start and end there\n  // used in Tokens for matching to token indices\n  // (switching to tokenindices keeps the annotation nice and fast. in time\n  //  we might also move the internal storage to tokenindices instead of\n  //  converting back and fro spans, but for now it helps ensure they're aligned)\n  return annotations.reduce((obj, ann) => {\n    const startKey = `${ann.section}-${ann.offset}`;\n    const endKey = `${ann.section}-${ann.offset + ann.length}`;\n    if (!obj[startKey]) obj[startKey] = { start: [], end: [] };\n    if (!obj[endKey]) obj[endKey] = { start: [], end: [] };\n    obj[startKey].start.push(ann.code);\n    obj[endKey].end.push(ann.code);\n    return obj;\n  }, {});\n};\n\nconst addAnnotations = (annArray, dispatch) => {\n  let newAnnotations = [];\n  for (let ann of annArray) {\n    for (let i = ann.span[0]; i <= ann.span[1]; i++) {\n      let newAnnotation = { ...ann };\n      newAnnotation.index = i;\n      newAnnotations.push(newAnnotation);\n    }\n  }\n\n  dispatch(setAnnotations(newAnnotations));\n};\n\nexport default SpanAnnotationsDB;\n","import React, { useEffect, useState } from \"react\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport {\n  toggleTokenSelection,\n  setCurrentToken,\n  clearTokenSelection,\n  triggerCodeselector,\n} from \"../actions\";\nimport { toggleAnnotations } from \"../actions\";\n\n// This component generates no content, but manages navigation for span level annotations\n\nconst arrowkeys = [\"ArrowRight\", \"ArrowLeft\", \"ArrowUp\", \"ArrowDown\"];\n\nconst SpanAnnotationsNavigation = ({ tokens }) => {\n  const currentToken = useSelector((state) => state.currentToken);\n  const tokenSelection = useSelector((state) => state.tokenSelection);\n  const eventsBlocked = useSelector((state) => state.eventsBlocked);\n\n  const [mover, setMover] = useState(null);\n  const [HoldSpace, setHoldSpace] = useState(false);\n  const [holdArrow, setHoldArrow] = useState(null);\n\n  const dispatch = useDispatch();\n\n  useEffect(() => {\n    if (eventsBlocked) {\n      setHoldArrow(false);\n      setHoldSpace(false);\n    }\n  }, [setHoldArrow, setHoldSpace, eventsBlocked]);\n\n  useEffect(() => {\n    // When arrow key is held, walk through tokens with increasing speed\n    // this loops itself by updating mover (an object with position information)\n    // this is like setIntervall, but allows custom time intervalls,\n    if (!mover || !holdArrow) return;\n\n    let position = movePosition(tokens, holdArrow, mover, HoldSpace, dispatch);\n\n    let delay = Math.max(5, 100 / Math.ceil(mover.counter / 5));\n    if (mover.counter === 1) delay = 150;\n    setTimeout(() => {\n      setMover({\n        position: position,\n        startposition: mover.startposition,\n        ntokens: mover.ntokens,\n        counter: mover.counter + 1,\n      });\n    }, delay);\n  }, [tokens, mover, holdArrow, HoldSpace, dispatch]);\n\n  if (!tokens) return null;\n\n  // this prevents rendering the components that manage the key and mouse events\n  if (eventsBlocked) return null;\n\n  return (\n    <>\n      <KeyEvents\n        tokenSelection={tokenSelection}\n        currentToken={currentToken}\n        tokens={tokens}\n        setMover={setMover}\n        setHoldSpace={setHoldSpace}\n        setHoldArrow={setHoldArrow}\n      />\n      <MouseEvents tokenSelection={tokenSelection} tokens={tokens} />\n    </>\n  );\n};\n\nconst KeyEvents = ({\n  tokenSelection,\n  currentToken,\n  tokens,\n  setMover,\n  setHoldSpace,\n  setHoldArrow,\n}) => {\n  const dispatch = useDispatch();\n\n  // This blocks event listeners when the eventsBlocked state (in redux) is true.\n  // This lets us block the key activities in the text (selecting tokens) when\n  // the CodeSelector popup is open\n  useEffect(() => {\n    window.addEventListener(\"keydown\", onKeyDown);\n    window.addEventListener(\"keyup\", onKeyUp);\n\n    return () => {\n      window.removeEventListener(\"keydown\", onKeyDown);\n      window.removeEventListener(\"keyup\", onKeyUp);\n    };\n  });\n\n  // (see useEffect with 'eventsBlocked' for details on useCallback)\n  const onKeyUp = (event) => {\n    // keep track of which buttons are pressed in the state\n    if (event.keyCode === 32 || event.key === \"Shift\") {\n      setHoldSpace(false);\n      if (tokenSelection.length > 0) annotationFromSelection(tokens, tokenSelection, dispatch);\n      return;\n    }\n    if (arrowkeys.includes(event.key)) {\n      setHoldArrow(false);\n      setMover(null);\n    }\n  };\n\n  // (see useEffect with 'eventsBlocked' for details on useCallback)\n  const onKeyDown = (event) => {\n    // key presses, and key holding (see onKeyUp)\n    if (event.keyCode === 32 || event.key === \"Shift\") {\n      event.preventDefault();\n      if (event.repeat) return;\n      setHoldSpace(true);\n      return;\n    }\n    if (arrowkeys.includes(event.key)) {\n      event.preventDefault();\n      if (event.repeat) return;\n      setMover({\n        position: currentToken,\n        startposition: currentToken,\n        ntokens: tokens.length,\n        counter: 1,\n      });\n      setHoldArrow(event.key);\n    }\n\n    if (tokenSelection.length > 0) {\n      if (tokenSelection[0] === tokenSelection[1]) {\n        // enter key\n        if (event.keyCode === 13) {\n          dispatch(triggerCodeselector(\"enter_key\", tokenSelection[0], null));\n        }\n      }\n    }\n  };\n\n  return <></>;\n};\n\nconst MouseEvents = ({ tokenSelection, tokens }) => {\n  const [holdMouseLeft, setHoldMouseLeft] = useState(false);\n  const dispatch = useDispatch();\n\n  useEffect(() => {\n    window.addEventListener(\"mousedown\", onMouseDown);\n    window.addEventListener(\"mousemove\", onMouseMove);\n    window.addEventListener(\"mouseup\", onMouseUp);\n    window.addEventListener(\"contextmenu\", onContextMenu);\n    return () => {\n      window.removeEventListener(\"mousedown\", onMouseDown);\n      window.removeEventListener(\"mousemove\", onMouseMove);\n      window.removeEventListener(\"mouseup\", onMouseUp);\n      window.removeEventListener(\"contextmenu\", onContextMenu);\n    };\n  });\n\n  const onMouseDown = (event) => {\n    // When left button pressed, start new selection\n    if (event.which === 1) {\n      //event.preventDefault();\n      setHoldMouseLeft(true);\n      dispatch(clearTokenSelection());\n    }\n  };\n\n  const onMouseMove = (event) => {\n    // When selection started (mousedown), select tokens hovered over\n    if (holdMouseLeft) {\n      if (event.which !== 1) return null;\n      window.getSelection().empty();\n      storeMouseSelection(event);\n    } else {\n      let currentNode = getToken(tokens, event);\n      if (currentNode) {\n        dispatch(setCurrentToken(currentNode.index));\n        dispatch(toggleTokenSelection(tokens, currentNode.index, false));\n      }\n    }\n  };\n\n  const onMouseUp = (event) => {\n    // When left mouse key is released, create the annotation\n    // note that in case of a single click, the token has not been selected (this happens on move)\n    // so this way a click can still be used to open\n    if (event.which !== 1) return null;\n    const currentNode = storeMouseSelection(event);\n    window.getSelection().empty();\n    setHoldMouseLeft(false);\n\n    if (currentNode === null) return null;\n\n    // storeMouseSelection does save position to tokenSelection state, but this isn't\n    // yet updated within this scope. This results in single clicks (without mousemove)\n    // not registering. So if there is no current selection, directly use currentNode as position.\n    if (tokenSelection.length > 0) {\n      annotationFromSelection(tokens, tokenSelection, dispatch);\n    } else {\n      if (currentNode !== null) {\n        annotationFromSelection(tokens, [currentNode, currentNode], dispatch);\n      }\n    }\n  };\n\n  const onContextMenu = (event) => {\n    if (event.button === 2) return null;\n    event.preventDefault();\n    event.stopPropagation();\n  };\n\n  const storeMouseSelection = (event) => {\n    // select tokens that the mouse/touch is currently pointing at\n    let currentNode = getToken(tokens, event);\n    if (!currentNode) return null;\n\n    dispatch(setCurrentToken(currentNode.index));\n    dispatch(toggleTokenSelection(tokens, currentNode.index, true));\n    return currentNode.index;\n  };\n\n  return <></>;\n};\n\nconst annotationFromSelection = (tokens, selection, dispatch) => {\n  let [from, to] = selection;\n  if (from > to) [from, to] = [to, from];\n\n  const annotations = [];\n  let lastSection = tokens[from].section;\n  for (let i = from; i <= to; i++) {\n    if (tokens[i].section !== lastSection) {\n      from = i;\n      lastSection = tokens[i].section;\n    }\n    annotations.push({\n      index: i,\n      group: \"UNASSIGNED\",\n      length: tokens[to].length + tokens[to].offset - tokens[from].offset,\n      span: [from, to],\n      section: tokens[i].section,\n      offset: tokens[from].offset,\n    });\n  }\n  dispatch(toggleAnnotations(annotations));\n  dispatch(clearTokenSelection());\n  dispatch(triggerCodeselector(null, null, null));\n  dispatch(triggerCodeselector(\"new_selection\", to, null));\n};\n\nconst movePosition = (tokens, key, mover, space, dispatch) => {\n  let newPosition = mover.position;\n  if (key === \"ArrowRight\") newPosition++;\n  if (key === \"ArrowLeft\") newPosition--;\n  if (key === \"ArrowUp\") newPosition = moveSentence(tokens, mover, \"up\");\n  if (key === \"ArrowDown\") newPosition = moveSentence(tokens, mover, \"down\");\n\n  if (newPosition > mover.ntokens) newPosition = mover.ntokens;\n  if (newPosition < 0) newPosition = 0;\n\n  if (space) {\n    // limit selection to current section\n    if (tokens[mover.position].section !== tokens[newPosition].section) {\n      if (newPosition > mover.position) {\n        for (let i = newPosition; i >= mover.position; i--)\n          if (tokens[i].section === tokens[mover.position].section) {\n            newPosition = i;\n            break;\n          }\n      } else {\n        for (let i = newPosition; i <= mover.position; i++) {\n          if (tokens[i].section === tokens[mover.position].section) {\n            newPosition = i;\n            break;\n          }\n        }\n      }\n    }\n  }\n\n  if (mover.position !== newPosition) {\n    dispatch(setCurrentToken(newPosition));\n    dispatch(toggleTokenSelection(tokens, newPosition, space));\n\n    const down = key === \"ArrowRight\" || key === \"ArrowDown\";\n    tokens[newPosition].ref.current.scrollIntoView(false, {\n      block: down ? \"start\" : \"end\",\n    });\n  }\n  return newPosition;\n};\n\nconst moveSentence = (tokens, mover, direction = \"up\") => {\n  // moving sentences is a bit tricky, but we can do it via the refs to the\n  // token spans, that provide information about the x and y values\n  const current = tokens[mover.position].ref.current.getBoundingClientRect();\n  const start = tokens[mover.startposition].ref.current.getBoundingClientRect();\n  let next;\n\n  if (direction === \"up\") {\n    for (let i = mover.position; i >= 0; i--) {\n      next = tokens[i].ref.current.getBoundingClientRect();\n      if (next.y < current.y && next.x <= start.x) {\n        return i;\n      }\n    }\n    return 0;\n  }\n  if (direction === \"down\") {\n    let nextsent = null;\n    for (let i = mover.position; i < tokens.length; i++) {\n      next = tokens[i].ref.current.getBoundingClientRect();\n      if (!nextsent && next.y > current.y) nextsent = next.y;\n      if (nextsent && next.y > nextsent) return i - 1;\n      if (next.y > current.y && next.x >= start.x) return i;\n    }\n    return tokens.length - 1;\n  }\n};\n\nconst getTokenAttributes = (tokens, tokenNode) => {\n  const tokenindex = parseInt(tokenNode.getAttribute(\"tokenindex\"));\n\n  return {\n    index: tokenindex,\n    offset: tokens[tokenindex].offset,\n    length: tokens[tokenindex].length,\n  };\n};\n\nconst getToken = (tokens, e) => {\n  try {\n    // sometimes e is Restricted, and I have no clue why,\n    // nor how to check this in a condition. hence the try clause\n    if (e.originalTarget) {\n      if (e.originalTarget.className === \"token\" || e.originalTarget.className === \"token selected\")\n        return getTokenAttributes(tokens, e.originalTarget);\n      if (e.originalTarget.parentNode) {\n        if (\n          e.originalTarget.parentNode.className === \"token\" ||\n          e.originalTarget.parentNode.className === \"token selected\"\n        )\n          return getTokenAttributes(tokens, e.originalTarget.parentNode);\n      }\n    }\n    if (e.path[0].className === \"token\" || e.path[0].className === \"token selected\") {\n      return getTokenAttributes(tokens, e.path[0]);\n    }\n\n    return null;\n  } catch (e) {\n    return null;\n  }\n};\n\nexport default SpanAnnotationsNavigation;\n","import React, { useEffect, useRef } from \"react\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { Ref, Table } from \"semantic-ui-react\";\nimport { triggerCodeselector } from \"../actions\";\nimport { getColor } from \"../util/tokenDesign\";\nimport \"./spanAnnotationsStyle.css\";\n\nconst COLWIDTHS = [4, 2, 2]; // for offset and text\n\nconst SpanAnnotationsMenu = ({ tokens }) => {\n  const annotations = useSelector((state) => state.spanAnnotations);\n\n  if (!tokens || tokens.length === 0) return null;\n\n  return (\n    <Table\n      style={{ fontSize: \"10px\" }}\n      fixed\n      role=\"grid\"\n      arioa-labelledby=\"header\"\n      selectable\n      unstackable\n      singleLine\n      compact=\"very\"\n      size=\"small\"\n    >\n      <Table.Header className=\"annotations-thead\">\n        <Table.Row>\n          <Table.HeaderCell width={COLWIDTHS[0]}>Code</Table.HeaderCell>\n          <Table.HeaderCell width={COLWIDTHS[1]}>Section</Table.HeaderCell>\n          <Table.HeaderCell width={COLWIDTHS[2]}>Span</Table.HeaderCell>\n          <Table.HeaderCell>Text</Table.HeaderCell>\n        </Table.Row>\n      </Table.Header>\n      <Table.Body className=\"annotations-tbody\">{annotationRows(tokens, annotations)}</Table.Body>\n    </Table>\n  );\n};\n\nconst annotationRows = (tokens, annotations) => {\n  const rows = [];\n  let text = null;\n  let token = null;\n\n  for (const tokenIndex of Object.keys(annotations)) {\n    for (const code of Object.keys(annotations[tokenIndex])) {\n      token = annotations[tokenIndex][code];\n      if (token.index !== token.span[0]) continue;\n\n      const annotationTokens = tokens.slice(token.span[0], token.span[1] + 1);\n      text = annotationTokens\n        .map((at, i) => {\n          const pre = i > 0 ? at.pre : \"\";\n          const post = i < annotationTokens.length - 1 ? at.post : \"\";\n          return pre + at.text + post;\n        })\n        .join(\"\");\n\n      const row = (\n        <AnnotationRow\n          key={tokenIndex + code}\n          tokens={tokens}\n          token={token}\n          code={code}\n          text={text}\n        />\n      );\n      rows.push(row);\n    }\n  }\n  return rows;\n};\n\nconst AnnotationRow = ({ tokens, token, code, text }) => {\n  const codeMap = useSelector((state) => state.codeMap);\n  const infocus = useSelector((state) => {\n    return state.currentToken >= token.span[0] && state.currentToken <= token.span[1];\n  });\n\n  const ref = useRef();\n  const dispatch = useDispatch();\n\n  useEffect(() => {\n    if (infocus) {\n      if (ref.current) {\n        ref.current.style.backgroundColor = \"grey\";\n        ref.current.scrollIntoView(false, {\n          block: \"nearest\",\n        });\n      }\n    } else {\n      if (ref.current) ref.current.style.backgroundColor = null;\n    }\n  }, [infocus]);\n\n  const color = getColor(code, codeMap);\n\n  return (\n    <Ref innerRef={ref}>\n      <Table.Row\n        className=\"annotations-tr\"\n        onClick={() => {\n          tokens[token.index].ref.current.scrollIntoView(false, { block: \"center\" });\n          dispatch(triggerCodeselector(null, null, null));\n          dispatch(triggerCodeselector(\"menu\", token.index, code));\n        }}\n        onMouseOver={() => {\n          //dispatch(setTokenSelection(token.span));\n          //tokens[token.index].ref.current.scrollIntoView(false);\n        }}\n      >\n        <Table.Cell width={COLWIDTHS[0]} style={color ? { background: color } : null}>\n          <span title={code}>{code}</span>\n        </Table.Cell>\n        <Table.Cell width={COLWIDTHS[1]}>{token.section}</Table.Cell>\n        <Table.Cell width={COLWIDTHS[2]} cref={ref}>\n          {`${token.offset}-${token.offset + token.length}`}\n        </Table.Cell>\n        <Table.Cell>\n          <span title={text}>{text}</span>\n        </Table.Cell>\n      </Table.Row>\n    </Ref>\n  );\n};\n\nexport default SpanAnnotationsMenu;\n","import React from \"react\";\nimport { Container, Grid, Header, List, ListItem, Table } from \"semantic-ui-react\";\nimport SpanAnnotationsDB from \"./SpanAnnotationsDB\";\nimport SpanAnnotationsNavigation from \"./SpanAnnotationsNavigation\";\nimport SpanAnnotationsMenu from \"./SpanAnnotationsMenu\";\n\nconst gridStyleTop = { height: \"35vh\" };\nconst gridStyleBottom = { overflowY: \"auto\", height: \"45vh\" };\n\nconst SpanAnnotations = ({ doc }) => {\n  // note that tokens is actually an object with doc included: {doc, tokens}\n  // passing the states separately caused race issues\n  if (!doc.tokens) return null;\n  return (\n    <>\n      <Grid.Row style={gridStyleTop}>\n        <SpanAnnotationsMenu tokens={doc.tokens} />\n      </Grid.Row>\n      <Grid.Row style={gridStyleBottom}>\n        <SpanInstructions />\n      </Grid.Row>\n      <SpanAnnotationsNavigation tokens={doc.tokens} />\n      <SpanAnnotationsDB doc={doc} />\n    </>\n  );\n};\n\nconst SpanInstructions = () => {\n  return (\n    <Container>\n      <Header as=\"h2\" align=\"center\">\n        Span annotations\n      </Header>\n      <p align=\"center\">Assign codes to words or phrases. A word can have multiple codes.</p>\n      <Table compact size=\"small\">\n        <Table.Header>\n          <Table.Row>\n            <Table.HeaderCell></Table.HeaderCell>\n            <Table.HeaderCell>Keyboard</Table.HeaderCell>\n            <Table.HeaderCell>Mouse</Table.HeaderCell>\n          </Table.Row>\n        </Table.Header>\n        <Table.Body>\n          <Table.Row>\n            <Table.Cell>\n              <strong>Navigate</strong>\n            </Table.Cell>\n            <Table.Cell>\n              <i>Arrow keys</i>\n            </Table.Cell>\n            <Table.Cell></Table.Cell>\n          </Table.Row>\n          <Table.Row>\n            <Table.Cell>\n              <strong>Select words</strong>\n            </Table.Cell>\n            <Table.Cell>\n              <i>shift</i> or <i>spacebar</i>\n              <br />\n              Hold to select mutiple\n            </Table.Cell>\n            <Table.Cell>\n              <i>Left-click</i>\n              <br />\n              Hold to select multiple\n            </Table.Cell>\n          </Table.Row>\n          <Table.Row>\n            <Table.Cell>\n              <strong>Edit code</strong>\n            </Table.Cell>\n            <Table.Cell>\n              <i>Enter</i> when cursor on annotation\n            </Table.Cell>\n            <Table.Cell>\n              <i>Right-click</i> annotation\n            </Table.Cell>\n          </Table.Row>\n        </Table.Body>\n        <Table.Footer>\n          <Table.Row>\n            <Table.HeaderCell>\n              <strong>Quick keys</strong> <br />\n              in popup\n            </Table.HeaderCell>\n            <Table.HeaderCell colSpan=\"2\">\n              <List as=\"ul\">\n                <ListItem as=\"li\">\n                  <i>text input</i> automatically opens dropdown{\" \"}\n                </ListItem>\n                <ListItem as=\"li\">\n                  select recent codes with <i>arrow keys</i> and <i>Enter</i>\n                </ListItem>\n                <ListItem as=\"li\">\n                  use <i>escape</i> to close popup and <i>delete</i> to remove code\n                </ListItem>\n              </List>\n            </Table.HeaderCell>\n          </Table.Row>\n        </Table.Footer>\n      </Table>\n    </Container>\n  );\n};\n\nexport default SpanAnnotations;\n","import React from \"react\";\nimport { Grid } from \"semantic-ui-react\";\n\nimport Tokens from \"./Tokens\";\nimport SpanAnnotations from \"./spanAnnotations\";\n\nconst gridStyle = { overflowY: \"auto\", height: \"75vh\" };\n\nconst AnnotationText = ({ doc }) => {\n  if (!doc) return null;\n\n  // Note that <Tokens> also adds overwrites doc.tokens with the\n  // prepared tokens (and included Refs)\n  return (\n    <Grid container columns={2}>\n      <Grid.Column width={8} style={gridStyle}>\n        <Tokens doc={doc} />\n      </Grid.Column>\n      <Grid.Column width={8}>\n        <SpanAnnotations doc={doc} />\n      </Grid.Column>\n    </Grid>\n  );\n};\n\nexport default AnnotationText;\n\n// title is optional. If empty, just show text nr in breadcrumb\n// annotations can be document, paragraph, sentence or token level\n// these are stored in separate keys in the annotations\n// For paragraph, sentence and token level, the specific texts are also exported with the annotations\n","import React, { useEffect, useState } from \"react\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { useLocation } from \"react-router-dom\";\nimport { Breadcrumb, BreadcrumbSection, Grid, Input, Pagination } from \"semantic-ui-react\";\n\nimport axios from \"axios\";\nimport hash from \"object-hash\";\n\nimport CodingjobSelector from \"./CodingjobSelector\";\nimport AnnotationText from \"./AnnotationText\";\nimport db from \"../apis/dexie\";\nimport { selectCodingjob, setCodingjobs } from \"../actions\";\n\nconst Annotate = () => {\n  const codingjob = useSelector((state) => state.codingjob);\n  const codeMap = useSelector((state) => state.codeMap);\n  const dispatch = useDispatch();\n\n  const location = useLocation();\n\n  const [doc, setDoc] = useState(null);\n  const [nDocuments, setNDocuments] = useState(0);\n  const [activePage, setActivePage] = useState(1);\n  const [delayedActivePage, setDelayedActivePage] = useState(1);\n  const [ready, setReady] = useState(false);\n\n  useEffect(() => {\n    if (location.search) {\n      const jobURL = location.search.substring(1);\n      openExternalJob(jobURL, dispatch, setReady);\n    } else {\n      setReady(true);\n    }\n  }, [location, dispatch]);\n\n  useEffect(() => {\n    if (!codingjob) return null;\n    if (!ready) return null;\n    setActivePage(1);\n    setupCodingjob(codingjob, setDoc, setNDocuments, dispatch);\n  }, [codingjob, ready, dispatch]);\n\n  useEffect(() => {\n    if (!ready) return null;\n    documentSelector(codingjob, activePage - 1, setDoc, hash(codeMap), dispatch);\n    setDelayedActivePage(activePage);\n  }, [codingjob, activePage, codeMap, ready, dispatch]);\n\n  useEffect(() => {\n    const timer = setTimeout(() => {\n      setActivePage(delayedActivePage);\n    }, 500);\n    return () => clearTimeout(timer);\n  }, [codingjob, delayedActivePage]);\n\n  return (\n    <Grid container columns={2}>\n      <Grid.Row>\n        <Grid.Column width={10}>\n          <Breadcrumb>\n            <BreadcrumbSection link style={{ minWidth: \"5em\" }}>\n              <CodingjobSelector type=\"dropdown\" />\n            </BreadcrumbSection>\n            <Breadcrumb.Divider />\n            <BreadcrumbSection>{doc?.document_id ? doc.document_id : activePage}</BreadcrumbSection>\n          </Breadcrumb>\n        </Grid.Column>\n        <Grid.Column align=\"center\" floated=\"right\" width={4}>\n          {documentPagination(\n            activePage,\n            delayedActivePage,\n            nDocuments,\n            setActivePage,\n            setDelayedActivePage\n          )}\n        </Grid.Column>\n      </Grid.Row>\n      <Grid.Row>\n        <AnnotationText doc={doc ? doc : null} />\n      </Grid.Row>\n    </Grid>\n  );\n};\n\nconst documentPagination = (\n  activePage,\n  delayedActivePage,\n  nDocuments,\n  setActivePage,\n  setDelayedActivePage\n) => {\n  return (\n    <>\n      <Grid.Row>\n        <Input\n          min={1}\n          max={nDocuments}\n          onChange={(e, d) => setDelayedActivePage(d.value)}\n          type=\"range\"\n          value={delayedActivePage}\n        />\n      </Grid.Row>\n      <Grid.Row>\n        <Pagination\n          activePage={delayedActivePage}\n          size={\"mini\"}\n          firstItem={null}\n          lastItem={null}\n          siblingRange={0}\n          boundaryRange={0}\n          ellipsisItem={null}\n          totalPages={nDocuments}\n          onPageChange={(e, d) => setActivePage(d.activePage)}\n        />\n      </Grid.Row>\n    </>\n  );\n};\n\nconst setupCodingjob = async (codingjob, setDoc, setNDocuments, dispatch) => {\n  const n = await db.getJobDocumentCount(codingjob);\n  setNDocuments(n);\n  if (n > 0) {\n    documentSelector(codingjob, 0, setDoc, \"\", dispatch);\n  } else {\n    setDoc(null);\n  }\n};\n\nconst documentSelector = async (codingjob, i, setDoc, codeMapHash, dispatch) => {\n  if (!codingjob) return null;\n  let doc = await db.getJobDocumentsBatch(codingjob, i, 1);\n  doc[0].codeMapHash = codeMapHash;\n  doc[0].writable = false;\n  if (doc) setDoc(doc[0]);\n};\n\nconst openExternalJob = async (jobURL, dispatch, setReady) => {\n  const response = await axios.get(jobURL);\n  const data = response.data;\n  let job = { name: data.details.name, job_id: hash(data) };\n  job = await db.getCodingjob(job);\n  if (!job) {\n    await db.createCodingjob(data.details.name, hash(data));\n    await db.createDocuments(job, data.documents, true);\n    await db.writeCodebook(job, data.codebook);\n  }\n  const codingjobs = await db.listCodingjobs();\n  const cj = await db.getCodingjob(job);\n  dispatch(selectCodingjob(cj));\n  dispatch(setCodingjobs(codingjobs));\n  setReady(true);\n};\n\nexport default Annotate;\n","import React from \"react\";\nimport { BrowserRouter, Route, Switch } from \"react-router-dom\";\nimport HeaderMenu from \"./components/HeaderMenu\";\nimport { Divider, Container, Sidebar } from \"semantic-ui-react\";\n\n// login and authenticated route\nimport Welcome from \"./components/Welcome\";\nimport AuthRoute from \"./components/AuthRoute\";\n\n// Main pages. Use below in items to include in header menu\nimport CodingJobs from \"./components/CodingJobs\";\nimport Annotate from \"./components/Annotate\";\nimport CodeTreeTable from \"./components/CodeTreeTable\";\nimport { useSelector } from \"react-redux\";\n\n// Change to add new components to the header\n// The first item will be the opening page after login\nconst homepage = \"/amcat4annotator\";\nconst items = [\n  {\n    label: \"Coding Jobs\",\n    path: homepage + \"/codingjobs\",\n    Component: CodingJobs,\n  },\n  { label: \"Annotate\", path: homepage + \"/annotate\", Component: Annotate },\n];\n\nconst App = () => {\n  const showSidebar = useSelector((state) => state.showSidebar);\n\n  const createNavigation = (items) => {\n    return items.map((item) => {\n      return (\n        <AuthRoute\n          key={item.path}\n          path={item.path}\n          homepage={homepage}\n          Component={item.Component}\n        />\n      );\n    });\n  };\n\n  return (\n    <BrowserRouter>\n      <HeaderMenu items={items} homepage={homepage} />\n      <Divider />\n      <Sidebar.Pushable>\n        <Sidebar\n          animation=\"overlay\"\n          visible={showSidebar}\n          direction={\"right\"}\n          width=\"wide\"\n          style={{ backgroundColor: \"white\" }}\n        >\n          <CodeTreeTable height=\"80vh\" showColors />\n        </Sidebar>\n        <Sidebar.Pusher>\n          <Container style={{ marginTop: \"3em\" }}>\n            <Switch>\n              <Route exact path={homepage} render={() => <Welcome items={items} />} />\n              {createNavigation(items)}\n            </Switch>\n          </Container>\n        </Sidebar.Pusher>\n      </Sidebar.Pushable>\n    </BrowserRouter>\n  );\n};\n\nexport default App;\n","import { combineReducers } from \"redux\";\n\nconst db = (state = null, action) => {\n  switch (action.type) {\n    case \"SET_DB\":\n      return action.payload;\n    case \"RESET_DB\":\n      return null;\n    default:\n      return state;\n  }\n};\n\nconst eventsBlocked = (state = false, action) => {\n  switch (action.type) {\n    case \"BLOCK_EVENTS\":\n      return action.payload;\n    default:\n      return state;\n  }\n};\n\nconst codingjob = (state = null, action) => {\n  switch (action.type) {\n    case \"SELECT_CODINGJOB\":\n      return action.payload;\n    case \"RESET_DB\":\n      return null;\n    default:\n      return state;\n  }\n};\n\nconst codingjobs = (state = [], action) => {\n  switch (action.type) {\n    case \"SET_CODINGJOBS\":\n      return action.payload;\n    case \"RESET_DB\":\n      return [];\n    default:\n      return state;\n  }\n};\n\nconst codingjobSettings = (state = {}, action) => {\n  switch (action.type) {\n    case \"SET_CODINGJOB_SETTINGS\":\n      return action.payload;\n    case \"RESET_DB\":\n      return {};\n    default:\n      return state;\n  }\n};\n\nconst tokenIndices = (state = [], action) => {\n  switch (action.type) {\n    case \"SET_TOKEN_INDICES\":\n      return action.payload;\n    case \"SELECT_DOCUMENT\":\n      return [];\n    case \"RESET_DB\":\n      return [];\n    default:\n      return state;\n  }\n};\n\nconst currentToken = (state = 0, action) => {\n  switch (action.type) {\n    case \"SET_CURRENT_TOKEN\":\n      return action.payload;\n    case \"SELECT_DOCUMENT\":\n      return 0;\n    case \"RESET_DB\":\n      return 0;\n    default:\n      return state;\n  }\n};\n\nconst tokenSelection = (state = [], action) => {\n  // an array of length 2, giving the start and end of the selection\n  switch (action.type) {\n    case \"TOGGLE_TOKEN_SELECTION\":\n      return toggleSelection(\n        state,\n        action.payload.tokens,\n        action.payload.index,\n        action.payload.add\n      );\n    case \"SET_TOKEN_SELECTION\":\n      return action.payload;\n    case \"CLEAR_TOKEN_SELECTION\":\n      return [];\n    case \"RESET_DB\":\n      return [];\n    default:\n      return state;\n  }\n};\n\nconst codeSelectorTrigger = (state = { from: null, index: null, code: null }, action) => {\n  switch (action.type) {\n    case \"TRIGGER_CODESELECTOR\":\n      return { from: action.from, index: action.index, code: action.code };\n    default:\n      return state;\n  }\n};\n\nconst toggleSelection = (selection, tokens, index, add) => {\n  if (!add || selection.length === 0) return [index, index];\n  //if (selection[1] === index) return selection;\n\n  if (tokens[selection[0]].section === tokens[index].section) return [selection[0], index];\n\n  if (index > selection[0]) {\n    for (let i = index; i >= selection[0]; i--) {\n      if (tokens[selection[0]].section === tokens[i].section) return [selection[0], i];\n    }\n  } else {\n    for (let i = index; i <= selection[0]; i++) {\n      if (tokens[selection[0]].section === tokens[i].section) return [selection[0], i];\n    }\n  }\n  return selection;\n};\n\nconst spanAnnotations = (state = {}, action) => {\n  switch (action.type) {\n    case \"SET_ANNOTATIONS\":\n      return toggleAnnotations({}, action.payload, false);\n    case \"TOGGLE_ANNOTATIONS\":\n      return toggleAnnotations({ ...state }, action.payload, false);\n    case \"RM_ANNOTATIONS\":\n      return toggleAnnotations({ ...state }, action.payload, true);\n    case \"CLEAR_SPAN_ANNOTATIONS\":\n      return {};\n    case \"RESET_DB\":\n      return {};\n    default:\n      return state;\n  }\n};\n\nconst toggleAnnotations = (annotations, annList, rm) => {\n  for (let item in annList) {\n    let a = annList[item];\n\n    // if group in annotations, remove it\n    if (annotations[a.index]) {\n      if (annotations[a.index][a.group]) {\n        const span = annotations[a.index][a.group].span;\n        for (let i = span[0]; i <= span[1]; i++) {\n          if (annotations[i]) {\n            if (annotations[i][a.group]) {\n              delete annotations[i][a.group];\n              if (Object.keys(annotations[i]).length === 0) {\n                delete annotations[i];\n              }\n            }\n          }\n        }\n        // if selection was one token (which is probably a click),\n        // just remove the annotation. But if it was a multi-token selection,\n        // we do add the new selection\n        if (a.span[0] === a.span[1]) continue;\n      }\n    }\n\n    if (!rm) {\n      if (!annotations[a.index]) annotations[a.index] = {};\n      annotations[a.index][a.group] = {\n        index: a.index,\n        span: [a.span[0], a.span[1]],\n        length: a.length,\n        section: a.section,\n        offset: a.offset,\n      };\n    }\n  }\n  return annotations;\n};\n\nconst codeMap = (state = {}, action) => {\n  switch (action.type) {\n    case \"SET_CODE_MAP\":\n      return action.payload;\n    case \"RESET_DB\":\n      return {};\n    default:\n      return state;\n  }\n};\n\nconst codeHistory = (state = [], action) => {\n  switch (action.type) {\n    case \"RESET_CODE_HISTORY\":\n      return [];\n    case \"APPEND_CODE_HISTORY\":\n      let newstate = state.filter((v) => v !== action.payload.code).slice(0, action.payload.n - 1);\n      newstate.unshift(action.payload.code);\n      return newstate;\n    case \"RESET_DB\":\n      return [];\n    default:\n      return state;\n  }\n};\n\nconst showSidebar = (state = false, action) => {\n  switch (action.type) {\n    case \"SET_SHOW_SIDEBAR\":\n      return action.payload;\n    default:\n      return state;\n  }\n};\n\nconst rootReducer = combineReducers({\n  db,\n  eventsBlocked,\n  codingjob,\n  codingjobs,\n  codingjobSettings,\n  tokenIndices,\n  currentToken,\n  codeSelectorTrigger,\n  tokenSelection,\n  spanAnnotations,\n  codeMap,\n  codeHistory,\n  showSidebar,\n});\n\nexport default rootReducer;\n","import \"semantic-ui-css/semantic.min.css\";\nimport React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport App from \"./App\";\nimport { createStore } from \"redux\";\nimport rootReducer from \"./reducers\";\nimport { Provider } from \"react-redux\";\n\nconst store = createStore(rootReducer);\n\nReactDOM.render(\n  <React.StrictMode>\n    <Provider store={store}>\n      <App />\n    </Provider>\n  </React.StrictMode>,\n  document.querySelector(\"#root\")\n);\n"],"sourceRoot":""}