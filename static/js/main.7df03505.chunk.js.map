{"version":3,"sources":["util/tokens.js","util/annotations.js","util/createDocuments.js","apis/dexie.js","components/HeaderMenu/Reset.js","apis/storemanager.js","components/HeaderMenu/Persist.js","apis/amcat.js","components/HeaderMenu/Amcat.js","components/HeaderMenu/UserName.js","components/HeaderMenu/HeaderMenu.js","components/CodingjobManager/subcomponents/SelectionTable.js","apis/demodata.js","components/CodingjobManager/1_CodingjobSelector.js","components/CodingjobManager/subcomponents/UploadForms.js","components/CodingjobManager/subcomponents/UploadDocuments.js","components/CodingjobManager/subcomponents/DocumentTable.js","components/CodingjobManager/2_ManageDocuments.js","components/CodingjobManager/subcomponents/Help.js","util/codebook.js","actions/index.js","components/CodingjobManager/subcomponents/EditCodePopup.js","components/CodingjobManager/subcomponents/CodesEditor.js","components/CodingjobManager/subcomponents/UnitSettings.js","util/refNavigation.js","components/Document/subcomponents/AnnotationEvents.js","util/scroll.js","util/tokenDesign.js","components/Document/subcomponents/AnnotateNavigation.js","components/Document/subcomponents/Tokens.js","components/Document/subcomponents/useCodeSelector.js","components/Document/subcomponents/useUnit.js","components/Document/subcomponents/SelectVariable.js","components/Document/Document.js","util/sample.js","hooks/useUnits.js","util/selectTokens.js","util/standardizeUnits.js","components/CodingjobManager/3_ManageCodingUnits.js","components/CodingjobManager/subcomponents/VariableMenu.js","components/CodingjobManager/subcomponents/QuestionTaskSettings.js","components/CodingjobManager/subcomponents/AnnotateTaskSettings.js","components/CodingjobManager/subcomponents/TaskSettings.js","components/Annotator/subcomponents/IndexController.js","components/Annotator/subcomponents/AnnotateTable.js","components/Annotator/AnnotateTask.js","components/Annotator/subcomponents/AnswerForms.js","components/Annotator/subcomponents/QuestionForm.js","components/Annotator/QuestionTask.js","components/CodingjobManager/4_ManageTask.js","components/CodingjobManager/subcomponents/DeploySettings.js","components/CodingjobManager/subcomponents/DeployedJobs.js","components/CodingjobManager/5_DeployCodingjob.js","components/CodingjobManager/CodingjobManager.js","components/Annotator/subcomponents/DownloadAnnotations.js","components/Annotator/subcomponents/FullScreenFix.js","components/Annotator/AnnotatorScreen.js","components/Annotator/JobServerClass.js","components/Annotator/Annotator.js","components/LocalJobs/LocalJobTable.js","components/LocalJobs/LocalJobs.js","App.js","reducers/index.js","index.js"],"names":["nlp","extend","paragraphs","parseTokens","text_fields","tokens","token","paragraph","sentence","tokenIndex","t","text","has_unit_start","unit_start","unit_started","unit_ended","text_field","section","name","offset","value","tokenize","json","par","length","sent","sentences","sent2","term","terms","start","unit_end","tokenobj","index","pre","post","codingUnit","push","importTokens","last_paragraph","last_sentence","totalLength","i","alert","space","repeat","Math","max","includes","importTokenAnnotations","codes","annotations","codeTracker","annotationDict","annotation","prevTokenPost","Object","keys","key","code","values","importSpanAnnotations","annotationsArray","currentAnnotations","importedAnnotations","prepareSpanAnnotations","trackAnnotations","matchedAnnotations","findMatches","codeCounter","annArray","matchedAnnotation","variable","addAnnotations","ann","span","newAnnotation","toggleSpanAnnotation","rm","console","log","a","reduce","obj","end","sectionAnnotations","prepareDocumentBatch","documentList","existingUids","job_id","silent","ids","Set","duplicates","preparedDocuments","result","document","doc_uid","hash","has","add","prepareDocument","message","parent","active","doc","n_paragraphs","n_sentences","tokenAnnotations","dbName","idbStores","codingjobs","documents","tasks","deployedJobs","localJobs","localAnnotations","AnnotationDB","this","idb","Dexie","version","stores","e","delete","Date","now","toString","codingjob","where","equals","docs","count","prop","get","cj","settings","modify","codebook","append","maps","codeMap","parentMap","newcode","safeNewCode","filter","writeCodebook","primaryKeys","writeCodes","bulkAdd","documentIds","map","bulkDelete","limit","ndocs","toArray","title","url","created","codingjobPackage","id","last_modified","unit_id","put","slice","db","Reset","homepage","useState","open","setOpen","history","useHistory","onClick","deleteDB","Modal","closeIcon","trigger","Menu","Item","icon","style","color","onClose","onOpen","Header","content","Content","Actions","Button","Icon","persist","navigator","storage","undefined","isStoragePersisted","persisted","Persist","setPersisted","useEffect","then","getToken","host","email","password","Axios","auth","username","response","data","newAmcatSession","Amcat","api","create","baseURL","headers","Authorization","units","provenance","rules","AmcatLogin","setCookie","setHost","setEmail","setPassword","status","setStatus","submitForm","JSON","stringify","path","Grid","inverted","textAlign","height","verticalAlign","Column","maxWidth","as","Form","size","Segment","stacked","Input","fluid","error","onChange","iconPosition","placeholder","type","Message","useCookies","cookies","amcat","UserName","setName","setCookies","storeName","width","onSubmit","d","autoFocus","primary","disabled","withRouter","items","children","location","useLocation","menuItems","item","menu","Link","to","header","pathname","label","Sidebar","Pushable","animation","visible","direction","position","Pusher","GlobalFilter","preGlobalFilteredRows","globalFilter","setGlobalFilter","target","border","SelectionTable","columns","selectedRow","setSelectedRow","defaultSize","ROW_ID","activeRow","setActiveRow","useTable","initialState","pageIndex","floor","Number","pageSize","useGlobalFilter","useSortBy","usePagination","getTableProps","getTableBodyProps","headerGroups","prepareRow","page","pageCount","gotoPage","state","createHeader","headerGroup","column","TableHeaderCell","className","headerClass","getHeaderProps","getSortByToggleProps","render","isSorted","isSortedDesc","Table","compact","unstackable","fixed","singleLine","selectable","fontSize","overflowY","TableHeader","TableRow","getHeaderGroupProps","TableBody","row","onRowSelect","getRowProps","cells","cell","TableCell","getCellProps","createBody","Footer","Row","HeaderCell","colSpan","Pagination","floated","firstItem","lastItem","nextItem","prevItem","boundaryRange","ellipsisItem","activePage","totalPages","onPageChange","event","demo_codebook","demo_articles","document_id","CodingjobSelector","setSelectedCodingjob","useLiveQuery","tableColumns","accessor","centered","stackable","background","Group","widths","setCodingjob","Container","marginTop","overflow","createDemoJob","createCodingjob","job","createDocuments","CreateCodingjob","codingjobName","setCodingjobName","preventDefault","trim","required","Dimmer","Loader","DeleteCodingjob","deleteCodingjob","React","memo","UploadTextsCsv","multiple","defaults","renderTextForms","options","fields","setFields","renderForm","UploadTokensCsv","int","renderTokenForms","UploadCsv","setData","fileRef","useRef","ref","nodrag","onFileLoad","addRemoveButton","onRemoveFile","SubmitForm","setOptions","loading","setLoading","colname","newfields","col","def","csvToJson","fieldIndices","field","subfield","findIndex","k","datarow","original","fieldindex","v","parseInt","uploadData","preparedData","tokensToDocumentList","setCodingjobProp","current","removeFile","Field","control","allDone","Dropdown","clearable","selection","minWidth","PreviewTable","createRowCells","Cell","Body","n","createRows","align","UploadDocuments","activeItem","setActiveItem","attached","tabular","renderSwitch","fetchFromDb","setPages","setColumns","getJobDocumentCount","ceil","newdata","getJobDocuments","getColumns","newcolumns","s","tf","DocumentTable","pages","rowObj","find","pageChange","createHeaderRow","createBodyRows","siblingRange","pointing","secondary","defaultActivePage","ManageDocuments","paddingLeft","Help","texts","Popup","wide","circular","marginLeft","paddingRight","paddingTop","paddingBottom","getCodebook","taskSettings","standardizeCodes","tree","makes_irrelevant","randomColor","seed","luminosity","codeBookEdgesToMap","totalChildren","totalActiveChildren","parentData","activeParent","foldToParent","getCodeTreeArray","showColors","parents","codeTreeArray","fillCodeTreeArray","object","codeTrail","newcodeTrail","level","folded","reverse","textToCodes","root","updatedCodes","parentLevel","lines","split","line","spaces","search","newCode","flag","newCodeObj","findParent","irrelevantString","standardizeColor","pspaces","str","ctx","createElement","getContext","fillStyle","blockEvents","block","setFullScreenNode","node","movePosition","setCodes","c","b","codeParent","newCodes","temp","AddCodePopup","alreadyExists","setAlreadyExists","textInput","setTextInput","addCode","margin","TextArea","join","RmCodePopup","rmCode","keepChildren","ucode","getAllChildren","ButtonGroup","MoveCodePopup","newParent","setNewParent","parentOptions","getAllParentOptions","mvCode","codeIsNew","inline","selectOnNavigation","minCharacters","autoComplete","child","EditCodePopup","toggleActiveCode","setChangeColor","dispatch","useDispatch","popupContent","setPopupContent","buttonStyle","padding","borderRadius","minHeight","changeColorPopup","onInput","addCodePopup","rmCodePopup","moveCodePopup","changePosition","flowing","hoverable","mouseLeaveDelay","makesIrrelevantHeader","questions","makesIrrelevantDropdown","makesIrrelevantOptions","renderLabel","renderMakesIrrelevantLabel","description","boxShadow","PlainTextEditor","cta","indentSpaces","paramOffset","txt","Array","addSpace","ctaToText","on","overflowX","rows","fontFamily","positive","changeCodeColor","selectedCode","toggleFoldCode","CodesEditor","setCodeMap","setCodeTreeArray","changeColor","cm","timer","setTimeout","clearTimeout","formatCode","fontWeight","onChangeMakesIrrelevant","nc","borderRight","borderTop","cursor","defaultUnitSettings","textUnit","unitSelection","contextUnit","contextWindow","ordered","balanceDocuments","balanceAnnotations","validCodes","highlightAnnotation","UnitSettings","unitSettings","setUnitSettings","us","float","SampleForm","CodingUnitForm","totalUnits","radioButton","annotated","jump","checked","Radio","grouped","ContextUnitForm","setContextWindow","delayed","setDelayed","pct","setPct","round","setWithoutDelay","min","step","valueN","Checkbox","toggle","ContextWindow","labelPosition","SelectValidCodes","moveUp","arr","selected","currentPos","getPosition","correctRow","prevColOverlap","nextPos","sameRow","colOverlap","calcColOverlap","left","right","moveDown","lowestTop","top","bottom","rightestLeft","leftestRight","pctA","pctB","getBoundingClientRect","arrowkeys","KeyEvents","tokenSelection","currentToken","HoldSpace","setMover","setHoldSpace","setHoldArrow","triggerCodePopup","window","addEventListener","onKeyDown","onKeyUp","removeEventListener","keyCode","annotationFromSelection","startposition","ntokens","counter","MouseEvents","setCurrentToken","setTokenSelection","selectionStarted","tapped","istouch","maxTouchPoints","msMaxTouchPoints","onMouseDown","onMouseMove","onMouseUp","onTouchDown","onContextMenu","currentNode","storeMouseSelection","updateSelection","which","getSelection","empty","button","stopPropagation","from","mover","newPosition","moveSentence","firstUnit","firstAfterUnit","lastIndexOf","scrollTokenToMiddle","getNode","getTokenAttributes","originalTarget","touches","elementFromPoint","clientX","clientY","parentNode","tokenNode","getAttribute","parentBounding","clientBounding","parentTop","parentHeight","clientTop","needUp","scrollTop","keepInView","newSelection","AnnotationEvents","eventsBlocked","holdArrow","delay","getColor","annotationCode","foldTo","getColorGradient","colors","gradColors","showAnnotations","variableMap","allowedAnnotations","annotateToken","classList","contains","remove","setTokenColor","nLeft","nRight","allLeft","allRight","anyLeft","anyRight","cl","textColor","preColor","postColor","showSelection","arrayIndex","AnnotationPopup","fullScreenNode","variables","mountNode","context","basic","List","backgroundColor","AnnotateNavigation","disableAnnotations","Tokens","centerVertical","setReady","setText","containerRef","firstTextUnitToken","topToCenter","scrollToMiddle","renderText","display","alignItems","Ref","innerRef","flex","maxHeight","section_name","paragraph_nr","sentence_nr","renderSentence","renderParagraph","renderSection","createRef","renderToken","fontstyle","lineHeight","tokenindex","arrowKeys","CodeSelectorPopup","tokenRef","overwrites","hasOpened","setHasOpened","overwriteWarning","SelectVariablePage","setVariable","setOverwrites","canBeNew","setValue","annId","getOptions","canDelete","rowSize","callback","NewCodePage","codeHistory","setAnnotations","setCodeHistory","textInputRef","focusOnButtons","setFocusOnButtons","onKeydown","useCallback","searchBox","activeElement","click","onButtonSelect","updateAnnotations","buttonOptions","dropdownOptions","buttonMode","onSearchChange","searchQuery","dropdownSelection","ButtonSelection","setSelected","allOptions","setAllOptions","nbuttons","flexWrap","option","borderColor","onMouseOver","deleteCurrent","rmAnnotation","newstate","useCodeSelector","selectedVariable","setSelection","setTokenRef","setTokenAnnotations","fullVariableMap","setFullVariableMap","setVariableMap","vm","popup","useUnit","unit","safetyCheck","returnTokens","setTokens","annotationsChanged","SelectVariable","variableNames","move","shiftKey","newIndex","Document","onChangeAnnotations","useSelector","tokensReady","setTokensReady","codeSelectorOpen","un_ann","ann_obj","exportSpanAnnotations","drawRandom","array","replace","group","random","seedrandom","indices","ns","splitIndex","distributeN","out","j","getRandomSubarray","shuffled","groupOb","fill","full","remain","remainIndices","select","getUnits","setUnits","getUnitsFromDB","getGroup","cjIndices","statifyAnnotations","docIndex","allUnits","annotationUnits","done","annotationMix","noDuplicates","all","sampleN","addSample","nCodes","annSample","concat","orderUnits","getDocuments","minIndex","maxIndex","Infinity","useIndexWindow","indexWindow","each","unitIndex","parIndex","sentIndex","unique","useCode","itemId","sort","useUnits","Units","selectTokens","newTokens","tokenRange","tokenContext","getTokenRange","getContextRange","startValue","endValue","range","standardizeUnits","jobhash","getDocument","unparseTokens","meta","unit_index","date","getTableColumns","ManageCodingUnits","celled","stretched","PreviewUnits","jobItem","setJobItem","standardizedItem","setStandardizedItem","singleItemArray","previewItem","PreviewDocument","ChangeName","setVariables","delayedName","setDelayedName","uniqueName","setNewName","onFocus","onBlur","DeleteButton","setIndex","deleteOpen","setDeleteOpen","newVariables","MoveButtons","onMove","newName","uniqueNewName","existingNames","VariableMenu","newVariableDefaults","zIndex","questionDefaultSettings","question","QuestionForm","setTaskSettings","questionIndex","questionForm","setQuestionForm","newTaskSettings","newValue","QuestionFormSettings","warn","setWarn","newWarn","hasCodeRef","AnnotinderEditor","up","swipes","setSwipes","firstTime","swipe","directions","getSwipeCode","onSelect","QuestionTaskSettings","setQuestionIndex","variableDefaultSettings","AnnotateForm","variableIndex","annotateForm","annotate","setAnnotateForm","AnnotateTaskSettings","setVariableIndex","defaultTaskSettings","TaskSettings","Divider","TypeForm","IndexController","canGoForward","canGoBack","reached","canMove","setActivePage","delayedActivePage","setDelayedActivePage","leftMargin","pageItem","COLWIDTHS","annotationRows","notInUnit","span_i","annotationTokens","at","AnnotationRow","cref","AnnotateTable","role","AnnotateTask","Instructions","ListItem","SearchBoxDropdown","scrolling","upward","searchInput","flexDirection","justifyContent","flexBasis","Annotinder","swipeOptions","alignContent","DONE_COLOR","setUnitIndex","answerTransition","setAnswerTransition","answered","prepareAnnotations","prepareQuestion","flexFlow","currentAnswer","answer","makeIrrelevant","jobServer","postAnnotations","unitId","newQuestionIndex","makesIrrelevant","isNaN","createAnnotationObject","getCurrentAnswer","QuestionIndexStep","canSelect","setCanSelect","cs","newState","q","setColor","textOverflow","AnswerSegment","showCurrent","sections","lastToken","charspan","indexspan","unitStarted","unitEnded","length_tokens","length_paragraphs","length_sentences","sameQuestion","x","y","annotationObject","preparedQuestion","codeTag","markedString","regex","RegExp","prev","string","documentSettings","QuestionTask","setQuestions","refs","box","textReady","setTextReady","questionTaskSettings","splitHeight","textSize","setSettings","divref","prepareQuestions","transition","opacity","transform","setSwipe","textSwipe","useSwipeable","swipeControl","menuSwipe","SettingsPopup","doVertical","triggerdist","transitionTime","swipeConfig","delta","preventDefaultTouchmoveEvent","trackTouch","trackMouse","rotationAngle","getDeltas","deltaX","deltaY","abs","onSwiping","bgc","talign","innerText","onSwiped","ManageTask","cwidths","PreviewTask","standardizedUnit","setStandardizedUnit","setCodebook","singleUnitArray","previewUnit","PreviewQuestionTask","renderTaskPreview","PreviewAnnotateTask","defaultDeploySettings","medium","nCoders","pctOverlap","DeployForm","deploySettings","setDeploySettings","CoderDistribution","overlapSet","avgPerCoder","DeploySettings","deployedTableColumns","DeployedTable","jobKey","setJobKey","jobs","toDateString","resultsTableColumns","ResultsTable","getResultUrl","res","coder","DeployedJobs","setJobUrlQuery","container","encodeURI","linkAndQr","DownloadButton","setTitle","onDownload","cjSets","createCoderSets","zip","JSZip","file","fname","set","generateAsync","saveAs","maxLength","AmcatDeploy","removeCookie","deploy","postCodingjob","createDeployedJob","nOverlap","unitSet","unitSets","createCodingjobPackage","setCodingjobPackage","includeDocuments","cjpackage","DeployCodingjob","deployButton","viewDeployed","CodingjobManager","menuItem","setMenuItem","selectedCodingjob","catch","nDocuments","Step","completed","formatAnnotateTaskResults","localJobServer","formatQuestionsTaskResults","results","unitMap","getAllAnnotations","annotationsPerUnit","unitAnnotations","DownloadAnnotations","filename","coderName","DOMNodeProvider","setNode","FullScreenFix","handle","Finished","AskFullScreenModal","askFullscreen","setAskFullscreen","enter","exit","FullScreenButton","link","ExitButton","goBack","corner","Task","AnnotatorScreen","fsHandle","useFullScreenHandle","preparedUnit","setPreparedUnit","progressIndex","getUnit","JobServerRemote","axios","success","JobServerLocal","getUnitAnnotations","createLocalJobServer","setJobServer","init","createRemoteJobServer","parseQueryString","substring","part","decodeURIComponent","LocalJobTable","last_modified_str","progress","getExtension","parts","LocalJobs","uploadFile","fileReader","FileReader","fileblob","files","readAsText","onload","objectHash","createLocalJob","parse","newZip","loadAsync","zipped","forEach","relpath","async","accept","Component","queries","App","exact","rootReducer","combineReducers","action","store","createStore","ReactDOM","StrictMode","CookiesProvider","querySelector"],"mappings":"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","file":"static/js/main.7df03505.chunk.js","sourcesContent":["import nlp from \"compromise\";\nimport paragraphs from \"compromise-paragraphs\";\nnlp.extend(paragraphs);\n\n/**\n * Tokenize a document, but allowing for multiple text fields to be concatenated as different sections.\n * @param {*} text_fields  An array of objects, where each object has the structure {name, value}. 'name' becomes the name of the section, 'value' is the text\n *                         each item can also have an 'offset' key with an integer value, in case the value is a subset starting at the [offset] character (this is needed to get the correct positions in the original document)\n *                         each item can also have a 'unit_start' and 'unit_end' key, each with an integer value to indicate where in this text_field the codingUnit starts/ends.\n *                              If both unit_start and unit_end is omitted, the whole text is considered codingUnit.\n * @returns\n */\nexport const parseTokens = (text_fields) => {\n  const tokens = [];\n  let token = null;\n  let paragraph = 0; // offset can be used if position in original article is known\n  let sentence = 0;\n  let tokenIndex = 0;\n  let t = null;\n  let text = null;\n\n  let has_unit_start = false;\n  for (let text_field of text_fields) if (text_field.unit_start != null) has_unit_start = true;\n  let unit_started = !has_unit_start; // if unit start not specified, start from beginning\n  let unit_ended = false;\n\n  for (let text_field of text_fields) {\n    let section = text_field.name || \"text\";\n    let offset = text_field.offset || 0;\n\n    text = text_field.value;\n    t = nlp.tokenize(text).paragraphs().json({ offset: true });\n    // map to single array.\n    for (let par = 0; par < t.length; par++) {\n      for (let sent = 0; sent < t[par].sentences.length; sent++) {\n        for (let sent2 = 0; sent2 < t[par].sentences[sent].length; sent2++) {\n          // for some reason there's an extra array layer between sents and pars...\n          // I've only found cases where lenght is 1, but I'll map it just in case\n          for (let term = 0; term < t[par].sentences[sent][sent2].terms.length; term++) {\n            token = t[par].sentences[sent][sent2].terms[term];\n\n            if (\n              text_field.unit_start != null &&\n              token.offset.start + offset >= text_field.unit_start\n            )\n              unit_started = true;\n            if (text_field.unit_end != null && token.offset.start + offset > text_field.unit_end)\n              unit_ended = true;\n\n            const tokenobj = {\n              section: section,\n              offset: token.offset.start + offset,\n              length: token.offset.length,\n              paragraph: paragraph,\n              sentence: sentence,\n              index: tokenIndex,\n              text: token.text,\n              pre: token.pre,\n              post: token.post,\n              codingUnit: unit_started & !unit_ended,\n            };\n            tokens.push(tokenobj);\n            tokenIndex++;\n          }\n        }\n        sentence++;\n      }\n      paragraph++;\n    }\n  }\n  return tokens;\n};\n\nexport const importTokens = (tokens) => {\n  let paragraph = 0;\n  let last_paragraph = tokens[0].paragraph;\n\n  let sentence = 0;\n  let last_sentence = tokens[0].sentence;\n\n  let offset = 0;\n  let totalLength = 0;\n  for (let i = 0; i < tokens.length; i++) {\n    if (tokens[i].text == null) {\n      if (tokens[i].token != null) {\n        tokens[i].text = tokens[i].token;\n      } else {\n        alert(\"Invalid token data:\\n\\nimported tokens must have 'text' or 'token' field\");\n        return null;\n      }\n    }\n    if (tokens[i].offset == null && tokens[i].start != null) tokens[i].offset = tokens[i].start;\n    if (tokens[i].length == null) tokens[i].length = tokens[i].text.length;\n\n    if (tokens[i].pre == null) tokens[i].pre = \"\";\n    if (tokens[i].post == null && tokens[i].space != null) tokens[i].post = tokens[i].space;\n    if (tokens[i].post == null) {\n      if (tokens[i].offset != null && tokens[i].length != null) {\n        tokens[i].post =\n          i < tokens[i].length - 1\n            ? \" \".repeat(Math.max(0, tokens[i + 1].offset - tokens[i].offset - tokens[i].length))\n            : \"\";\n      } else {\n        tokens[i].post = \" \";\n      }\n    }\n\n    totalLength = tokens[i].length + tokens[i].post.length;\n    if (i < tokens.length - 1) totalLength = totalLength + tokens[i + 1].pre.length;\n\n    if (tokens[i].offset == null) {\n      tokens[i].offset = offset;\n      offset = offset + totalLength;\n    }\n\n    if (i < tokens.length - 1) {\n      if (tokens[i].section === tokens[i + 1].section) {\n        if (tokens[i + 1].offset < tokens[i].offset + totalLength) {\n          alert(\n            `Invalid token position data. The length of \"${\n              tokens[i].pre + tokens[i].text + tokens[i].post\n            }\" on position ${tokens[i].offset} exeeds the offset/start position of the next token`\n          );\n          return null;\n        }\n      }\n    }\n\n    // ensure sentence counter\n    // currently doesn't actually do sentence boundary detection (if people want that,\n    // they should include sentence in the input)\n    // if sentence exists, still overwrite with new counter to ensure that it adds up\n    // also increment sentence on new paragraph\n    if (tokens[i].sentence == null) {\n      tokens[i].sentence = sentence;\n      if (tokens[i].text.includes(\"\\n\") || tokens[i].post.includes(\"\\n\")) sentence++;\n    } else {\n      if (tokens[i].paragraph !== last_paragraph || tokens[i].sentence !== last_sentence) {\n        last_sentence = tokens[i].sentence;\n        sentence++;\n      }\n      tokens[i].sentence = sentence;\n    }\n\n    // ensure paragraph counter\n    // if paragraph exists, still overwrite with new counter to ensure that it adds up\n    if (tokens[i].paragraph == null) {\n      tokens[i].paragraph = paragraph;\n      if (tokens[i].text.includes(\"\\n\") || tokens[i].post.includes(\"\\n\")) paragraph++;\n    } else {\n      if (tokens[i].paragraph !== last_paragraph) {\n        last_paragraph = tokens[i].paragraph;\n        paragraph++;\n      }\n      tokens[i].paragraph = paragraph;\n    }\n\n    if (tokens[i].section == null) tokens[i].section = \"text\";\n    tokens[i].index = i;\n  }\n\n  return tokens;\n};\n\nexport const importTokenAnnotations = (tokens, codes) => {\n  // returns annotations, and also modifies the codes object\n  // codes keeps track of annotations to create a codebook\n  if (tokens.length === 0) return [];\n  let annotations = [];\n  let codeTracker = {};\n  let section = tokens[0].section;\n  for (let i = 0; i < tokens.length; i++) {\n    if (!tokens[i].annotations) {\n      for (let annotation of Object.values(codeTracker)) annotations.push(annotation);\n      codeTracker = {};\n      continue;\n    }\n\n    let annotationDict = {};\n    for (let annotation of tokens[i].annotations) {\n      if (annotation.value === \"NA\" || annotation.value === \"NaN\") continue; // Should be a checkbox when importing\n\n      if (!codes[annotation.name]) {\n        codes[annotation.name] = [\"\"];\n      }\n      if (!codes[annotation.value]) {\n        codes[annotation.value] = [annotation.name];\n      } else {\n        if (!codes[annotation.value].includes(annotation.name))\n          codes[annotation.value].push(annotation.name);\n      }\n\n      annotationDict[annotation.name] = annotation.value;\n\n      const prevTokenPost = i > 0 ? tokens[i - 1].post : \"\";\n      if (codeTracker[annotation.name] == null)\n        codeTracker[annotation.name] = {\n          index: i,\n          value: annotation.value,\n          offset: tokens[i].offset,\n          text: tokens[i].text,\n          section: tokens[i].section,\n          length: tokens[i].length,\n        };\n      if (codeTracker[annotation.name].value === annotation.value) {\n        codeTracker[annotation.name].length =\n          tokens[i].offset + tokens[i].length - codeTracker[annotation.name].offset;\n        codeTracker[annotation.name].text += prevTokenPost + tokens[i].pre + tokens[i].post;\n      }\n    }\n\n    for (let key of Object.keys(codeTracker)) {\n      if (annotationDict[key] == null) {\n        annotations.push(codeTracker[key]);\n        delete codeTracker[key];\n        continue;\n      }\n      if (annotationDict[key] !== codeTracker[key].value) {\n        annotations.push(codeTracker[key]);\n        codeTracker[key] = {\n          index: i,\n          code: annotationDict[key],\n          offset: tokens[i].offset,\n          text: tokens[i].text,\n          section: tokens[i].section,\n          length: tokens[i].length,\n        };\n      }\n    }\n\n    if (i < tokens.length - 1 && tokens[i + 1].section !== section) {\n      for (let annotation of Object.values(codeTracker)) annotations.push(annotation);\n      codeTracker = {};\n      section = tokens[i].section;\n      continue;\n    }\n  }\n  for (let annotation of Object.values(codeTracker)) annotations.push(annotation);\n\n  return annotations;\n};\n","export const exportSpanAnnotations = (annotations, tokens) => {\n  // export annotations from the object format (for fast use in the annotator) to array format\n  if (Object.keys(annotations).length === 0) return [];\n  const uniqueAnnotations = Object.keys(annotations).reduce((un_ann, index) => {\n    const ann = annotations[index];\n    for (let key of Object.keys(ann)) {\n      //const endIndex = if (index === 'unit' ? index : )\n\n      if (index !== \"unit\") if (ann[key].index !== ann[key].span[0]) continue;\n\n      const ann_obj = {\n        variable: key,\n        value: ann[key].value,\n        section: ann[key].section,\n        offset: ann[key].offset,\n        length: ann[key].length,\n      };\n      un_ann.push(ann_obj);\n    }\n    return un_ann;\n  }, []);\n  return uniqueAnnotations;\n};\n\nexport const importSpanAnnotations = (annotationsArray, tokens, currentAnnotations = {}) => {\n  if (annotationsArray.length === 0) return { ...currentAnnotations };\n  // import span annotations. Uses the offset to match annotations to tokens\n  const importedAnnotations = prepareSpanAnnotations(annotationsArray);\n  let trackAnnotations = {};\n  let matchedAnnotations = [];\n\n  for (let token of tokens) {\n    findMatches(token, importedAnnotations, trackAnnotations, matchedAnnotations);\n  }\n  const codeCounter = {};\n  const annArray = [];\n  for (let matchedAnnotation of matchedAnnotations) {\n    if (!codeCounter[matchedAnnotation.variable]) codeCounter[matchedAnnotation.variable] = 0;\n    codeCounter[matchedAnnotation.variable]++;\n    annArray.push(matchedAnnotation);\n  }\n\n  let addAnnotations = [];\n  for (let ann of annArray) {\n    for (let i = ann.span[0]; i <= ann.span[1]; i++) {\n      let newAnnotation = { ...ann };\n      newAnnotation.index = i;\n      addAnnotations.push(newAnnotation);\n    }\n  }\n\n  for (let ann of annArray) {\n    currentAnnotations = toggleSpanAnnotation(currentAnnotations, ann, false);\n  }\n\n  return currentAnnotations;\n};\n\nexport const toggleAnnotation = (annotations, unit, index, group, annotation) => {\n  if (!annotations[unit][index]) annotations[unit][index] = {};\n\n  if (annotation === null) {\n    delete annotations[unit][index][group];\n    if (Object.keys(annotations[unit][index]).length === 0) {\n      delete annotations[unit][index];\n    }\n  } else {\n    annotations[unit][index][group] = annotation;\n  }\n\n  return annotations;\n};\n\nexport const toggleSpanAnnotation = (annotations, newAnnotation, rm) => {\n  console.log(newAnnotation);\n  // Add span annotations in a way that prevents double assignments of the same group to a token\n\n  for (let index = newAnnotation.span[0]; index <= newAnnotation.span[1]; index++) {\n    let a = newAnnotation;\n\n    // if group in annotations, remove it\n    if (annotations[index]) {\n      if (annotations[index][a.variable]) {\n        const span = annotations[index][a.variable].span;\n        for (let i = span[0]; i <= span[1]; i++) {\n          console.log(i);\n          if (annotations[i]) {\n            if (annotations[i][a.variable]) {\n              delete annotations[i][a.variable];\n              if (Object.keys(annotations[i]).length === 0) {\n                delete annotations[i];\n              }\n            }\n          }\n        }\n      }\n    }\n\n    if (!rm) {\n      if (!annotations[index]) annotations[index] = {};\n      annotations[index][a.variable] = {\n        index: index,\n        span: [a.span[0], a.span[1]],\n        length: a.length,\n        value: a.value,\n        section: a.section,\n        offset: a.offset,\n      };\n    }\n  }\n\n  return annotations;\n};\n\nconst prepareSpanAnnotations = (annotations) => {\n  if (!annotations || annotations === \"\") return {};\n  // create an object where the key is a section+offset, and the\n  // value is an array that tells which variables start and end there\n  // used in Tokens for matching to token indices\n  return annotations.reduce((obj, ann) => {\n    if (!obj[ann.section]) obj[ann.section] = {};\n    if (!obj[ann.section][ann.offset]) obj[ann.section][ann.offset] = { start: [], end: [] };\n    if (!obj[ann.section][ann.offset + ann.length])\n      obj[ann.section][ann.offset + ann.length] = { start: [], end: [] };\n    obj[ann.section][ann.offset].start.push(ann); // for the starting point the full annotation is given, so that we have all the information\n    obj[ann.section][ann.offset + ann.length].end.push(ann.variable); // for the ending point we just need to know the variable\n    return obj;\n  }, {});\n};\n\nconst findMatches = (token, importedAnnotations, trackAnnotations, matchedAnnotations) => {\n  const start = token.offset;\n  const end = token.offset + token.length;\n  if (!importedAnnotations[token.section]) return;\n  const sectionAnnotations = importedAnnotations[token.section];\n\n  for (let i = start; i <= end; i++) {\n    //const key = `${token.section}-${i}`;\n\n    if (sectionAnnotations[i]) {\n      for (let annotation of sectionAnnotations[i].start) {\n        trackAnnotations[annotation.variable] = { ...token };\n        trackAnnotations[annotation.variable].variable = annotation.variable;\n        trackAnnotations[annotation.variable].value = annotation.value;\n        trackAnnotations[annotation.variable].offset = start;\n        trackAnnotations[annotation.variable].length = null;\n        trackAnnotations[annotation.variable].span = [token.index];\n      }\n\n      for (let variable of sectionAnnotations[i].end) {\n        if (!trackAnnotations[variable]) continue;\n        trackAnnotations[variable].span.push(token.index);\n        trackAnnotations[variable].length =\n          token.offset + token.length - trackAnnotations[variable].offset;\n        matchedAnnotations.push(trackAnnotations[variable]);\n        delete trackAnnotations[variable];\n      }\n    }\n  }\n};\n","import hash from \"object-hash\";\nimport { importTokens, importTokenAnnotations, parseTokens } from \"util/tokens\";\nimport { importSpanAnnotations } from \"util/annotations\";\n\n/**\n * Prepares a batch of documents. Returns [documents, codes], where codes contains the annotation codes used in the documents\n *\n * @param {*} documentList an Array with documents\n * @param {*} existingUids An (optional) array of existing unique (hash-based) ids, to ignore duplicate articles\n * @param {*} job_id       A unique job_id for which the document is intended. If not given, assumes it's a temp document (that won't be stored in indexedDB)\n * @param {*} silent       Whether or not to report if items have been created\n */\nexport const prepareDocumentBatch = (\n  documentList,\n  existingUids = [],\n  job_id = \"TEMP\",\n  silent = true\n) => {\n  let ids = new Set(existingUids);\n\n  let duplicates = 0;\n  let codes = {};\n  const preparedDocuments = documentList.reduce((result, document) => {\n    const doc_uid = hash([document, job_id]); // codingjob included for doc_uid (unique id) hash\n    if (!ids.has(doc_uid)) {\n      ids.add(doc_uid);\n\n      result.push({\n        doc_uid: doc_uid,\n        job_id: job_id,\n        ...prepareDocument(document, codes),\n      });\n    } else {\n      duplicates++;\n    }\n    return result;\n  }, []);\n\n  if (!silent) {\n    let message = `Created ${documentList.length - duplicates} new documents.`;\n    if (duplicates > 0) message = message + ` Ignored ${duplicates} duplicates`;\n    alert(message);\n  }\n\n  codes = Object.keys(codes).reduce((a, code) => {\n    if (codes[code].length === 1) {\n      if (codes[code][0] !== \"\") a.push({ code, parent: codes[code][0], active: true });\n    } else {\n      for (let parent of codes[code]) {\n        if (parent !== \"\") a.push({ code: `${code} (${parent})`, parent, active: true });\n      }\n    }\n    return a;\n  }, []);\n\n  return [preparedDocuments, codes];\n};\n\nexport const prepareDocument = (document, codes = {}) => {\n  const doc = { ...document };\n\n  if (doc.tokens) {\n    doc.tokens = importTokens(document.tokens);\n  } else {\n    if (!doc.text_fields && doc.text) doc.text_fields = [{ name: \"text\", value: doc.text }];\n    doc.tokens = parseTokens([...doc.text_fields]);\n  }\n  if (doc.tokens.length > 0) {\n    doc.n_paragraphs = doc.tokens[doc.tokens.length - 1].paragraph;\n    doc.n_sentences = doc.tokens[doc.tokens.length - 1].sentence;\n  } else {\n    doc.n_paragraphs = 0;\n    doc.n_sentences = 0;\n  }\n\n  if (doc.annotations) {\n    doc.annotations = importSpanAnnotations([...doc.annotations], doc.tokens);\n  } else doc.annotations = {};\n\n  const tokenAnnotations = importTokenAnnotations(doc.tokens, codes); // also fills codes\n  if (tokenAnnotations.length > 0)\n    doc.annotations.span = importSpanAnnotations(tokenAnnotations, doc.tokens, doc.annotations);\n\n  return doc;\n};\n","import Dexie from \"dexie\";\nimport hash from \"object-hash\";\n\nimport { prepareDocumentBatch } from \"util/createDocuments\";\n\nconst dbName = \"CSSannotator_V1\";\nconst idbStores = {\n  codingjobs: \"job_id, name\", // unindexed fields: jobcreator, codingscheme, codebook, codebookEdit, returnAddress\n  documents: \"doc_uid, job_id\", // unindexed fields: title, text, meta, tokens, annotations\n  tasks: \"[title+url], last_modified, url\", // unindexed fields:  codebook, items\n\n  deployedJobs: \"url\", // unindexed: title, created\n  localJobs: \"[title+id], last_modified, id\", // unindexed fields:  codebook, items\n  localAnnotations: \"[id+unit_id], id\",\n};\n\nclass AnnotationDB {\n  constructor() {\n    this.idb = new Dexie(dbName);\n\n    //for testing, clean db on refresh\n    // this.idb.delete();\n    // this.idb = new Dexie(dbName);\n    try {\n      this.idb.version(2).stores(idbStores);\n    } catch (e) {\n      // this is not a good idea for production, but for now it helps solve the problem\n      // that whenever the schemas are changed (in development), everything breaks\n      this.idb.delete();\n      this.idb = new Dexie(dbName);\n      this.idb.version(2).stores(idbStores);\n    }\n  }\n\n  // CODINGJOBS\n  async createCodingjob(name, job_id = null) {\n    if (!job_id) job_id = hash([name, Date.now().toString()]);\n    this.idb.codingjobs.add({\n      job_id,\n      name,\n    });\n    return { job_id, name };\n  }\n  async deleteCodingjob(codingjob) {\n    const docs = await this.idb.documents.where(\"job_id\").equals(codingjob.job_id);\n    const ndocs = await docs.count();\n    if (ndocs > 0) docs.delete();\n    return this.idb.codingjobs.delete(codingjob.job_id);\n  }\n\n  async getCodingjobProp(codingjob, prop) {\n    let cj = await this.idb.codingjobs.get(codingjob.job_id);\n    return cj[prop];\n  }\n  async setCodingjobProp(codingjob, prop, value) {\n    let cj = await this.idb.codingjobs.get(codingjob.job_id);\n    if (cj.settings == null) cj.settings = {};\n    return this.idb.codingjobs\n      .where(\"job_id\")\n      .equals(codingjob.job_id)\n      .modify({ [prop]: value });\n  }\n\n  async writeCodebook(codingjob, codebook) {\n    console.log(\"writing to db\");\n    return this.idb.codingjobs\n      .where(\"job_id\")\n      .equals(codingjob.job_id)\n      .modify({ codebook: codebook });\n  }\n\n  async writeCodes(codingjob, codes, append = false) {\n    const cj = await this.idb.codingjobs.get(codingjob.job_id);\n    const codebook = cj.codebook ? cj.codebook : {};\n\n    if (!codebook.codes || !append) codebook.codes = codes;\n    const maps = codebook.codes.reduce(\n      (obj, code, i) => {\n        obj.codeMap[code.code] = { parent: code.parent, index: i };\n        obj.parentMap[code.parent] = true;\n        return obj;\n      },\n      { codeMap: {}, parentMap: {} }\n    );\n\n    if (append) {\n      for (let code of codes) {\n        if (maps.codeMap[code.code]) {\n          if (code.parent === maps.codeMap[code.code].parent) continue;\n          const newcode = safeNewCode(\n            code.code + \" (\" + code.parent + \")\",\n            maps.codeMap,\n            maps.parentMap\n          );\n          codebook.codes[maps.codeMap[code].index].code = newcode;\n          codebook.codes.push({ ...code, code: newcode, parent: code.parent });\n        } else {\n          const newcode = safeNewCode(code.code, maps.codeMap, maps.parentMap, 2);\n          codebook.codes.push({ ...code, code: newcode, parent: code.parent });\n        }\n      }\n    }\n\n    // making absolutely sure no garbage is added\n    codebook.codes = codebook.codes.filter((code) => code.code !== \"\");\n\n    return await this.writeCodebook(codingjob, codebook);\n  }\n\n  // DOCUMENTS\n  async createDocuments(codingjob, documentList, silent = false) {\n    let ids = new Set(\n      await this.idb.documents.where(\"job_id\").equals(codingjob.job_id).primaryKeys()\n    );\n\n    const [preparedDocuments, codes] = prepareDocumentBatch(\n      documentList,\n      ids,\n      codingjob.job_id,\n      silent\n    );\n\n    this.writeCodes(codingjob, codes, true);\n\n    return this.idb.documents.bulkAdd(preparedDocuments);\n  }\n\n  async deleteDocuments(documents) {\n    const documentIds = documents.map((document) => document.doc_uid);\n    return this.idb.documents.bulkDelete(documentIds);\n  }\n\n  async getJobDocuments(codingjob, offset, limit) {\n    if (offset !== null && offset < 0) return null;\n    let documents = await this.idb.documents.where(\"job_id\").equals(codingjob.job_id);\n    const ndocs = await documents.count();\n    if (offset !== null && offset > ndocs - 1) return null;\n    if (limit !== null) documents = documents.offset(offset).limit(limit);\n    return documents.toArray();\n  }\n\n  async getJobDocumentCount(codingjob) {\n    return this.idb.documents.where(\"job_id\").equals(codingjob.job_id).count();\n  }\n\n  async getDocuments(codingjob) {\n    return this.idb.documents.where(\"job_id\").equals(codingjob.job_id);\n  }\n\n  async getDocument(doc_uid) {\n    return this.idb.documents.get(doc_uid);\n  }\n\n  async writeTokens(document, tokens) {\n    return this.idb.documents.where(\"doc_uid\").equals(document.doc_uid).modify({ tokens: tokens });\n  }\n\n  // async writeAnnotations(document, annotations) {\n  //   return this.idb.documents\n  //     .where(\"doc_uid\")\n  //     .equals(document.doc_uid)\n  //     .modify({ annotations: annotations });\n  // }\n\n  // DEPLOYED JOBS\n  async createDeployedJob(title, url) {\n    const exists = await this.idb.deployedJobs.get({ url });\n\n    if (!exists) {\n      this.idb.deployedJobs.add({\n        title,\n        url,\n        created: new Date(),\n      });\n    } else {\n      this.idb.deployedJobs.get({ url }).modify({ created: new Date() });\n    }\n  }\n\n  // LOCAL JOBS\n  async createLocalJob(codingjobPackage, id) {\n    const exists = await this.idb.localJobs.get({ id });\n\n    if (!exists) {\n      this.idb.localJobs.add({\n        ...codingjobPackage,\n        id,\n        last_modified: new Date(),\n      });\n    } else {\n      alert(\"This job has already been created before\");\n    }\n  }\n\n  // ANNOTATIONS\n  async getUnitAnnotations(job_id, unit_id) {\n    return this.idb.localAnnotations.get({ id: job_id, unit_id });\n  }\n  async getAllAnnotations(job_id) {\n    return this.idb.localAnnotations.where(\"id\").equals(job_id).toArray();\n  }\n  async postAnnotations(job_id, unit_id, annotations) {\n    return this.idb.localAnnotations.put({ unit_id, id: job_id, annotations }, [job_id, unit_id]);\n  }\n\n  // CLEANUP\n  async deleteDB() {\n    await this.idb.delete();\n    this.idb = new Dexie(dbName);\n    this.idb.version(2).stores(idbStores);\n  }\n}\n\nconst safeNewCode = (code, codeMap, parentMap, i) => {\n  // for preventing overlapping code names\n  if (!codeMap[code] && !parentMap[code]) return code;\n  if (i > 2) code = code.slice(0, code.length - code.toString().length);\n  code += \" \" + i;\n  safeNewCode(code, codeMap, i + 1);\n};\n\nconst db = new AnnotationDB();\nexport default db;\n","import React, { useState } from \"react\";\nimport { Menu, Button, Header, Icon, Modal } from \"semantic-ui-react\";\nimport { useHistory } from \"react-router-dom\";\nimport db from \"apis/dexie\";\n\nconst Reset = ({ homepage }) => {\n  const [open, setOpen] = useState(false);\n  const history = useHistory();\n\n  const onClick = async () => {\n    try {\n      await db.deleteDB();\n      setOpen(false);\n      history.push(homepage);\n    } catch (e) {\n      console.log(e);\n    }\n  };\n\n  return (\n    <Modal\n      closeIcon\n      open={open}\n      trigger={<Menu.Item icon=\"rocket\" name=\"Reset\" style={{ color: \"#d7a3a3\" }} />}\n      onClose={() => setOpen(false)}\n      onOpen={() => setOpen(true)}\n    >\n      <Header icon=\"power off\" content=\"Reset Annotator Database\" />\n      <Modal.Content>\n        <p>\n          This will remove all document and annotation data from your browser. Any annotations that\n          have not been saved/synchronized will be lost. Are you absolutely sure?\n        </p>\n      </Modal.Content>\n      <Modal.Actions>\n        <Button\n          color=\"red\"\n          onClick={() => {\n            setOpen(false);\n          }}\n        >\n          <Icon name=\"remove\" /> No\n        </Button>\n        <Button color=\"green\" onClick={onClick}>\n          <Icon name=\"checkmark\" /> Yes\n        </Button>\n      </Modal.Actions>\n    </Modal>\n  );\n};\n\nexport default Reset;\n","// this contains functions for setting indexedDB to persistent\n// taken from: https://dexie.org/docs/StorageManager\n\n/** Check if storage is persisted already.\n  @returns {Promise<boolean>} Promise resolved with true if current origin is\n  using persistent storage, false if not, and undefined if the API is not\n  present.\n*/\n\nexport async function initStoragePersistence() {\n  //const persist = tryPersistWithoutPromtingUser();\n  tryPersistWithoutPromtingUser()\n    .then(persist => {\n      switch (persist) {\n        case \"never\":\n          console.log(\"Not possible to persist storage\");\n          break;\n        case \"persisted\":\n          console.log(\"Successfully persisted storage silently\");\n          break;\n        case \"prompt\":\n          console.log(\"Not persisted, but we may prompt user when we want to.\");\n          break;\n        default:\n          console.log(\"compiler desperately wanted a default\");\n      }\n    })\n    .catch(e => {\n      console.log(\n        \"actually failed so hard it threw an error. Probably that persistent-storage is not (yet) a valid permission in the browser\"\n      );\n    });\n}\n\n/** Tries to convert to persisted storage.\n  @returns {Promise<boolean>} Promise resolved with true if successfully\n  persisted the storage, false if not, and undefined if the API is not present.\n*/\nexport async function persist() {\n  return (await navigator.storage) && navigator.storage.persist\n    ? navigator.storage.persist()\n    : undefined;\n}\n\nexport async function isStoragePersisted() {\n  return (await navigator.storage) && navigator.storage.persisted\n    ? navigator.storage.persisted()\n    : undefined;\n}\n\n/** Queries available disk quota.\n  @see https://developer.mozilla.org/en-US/docs/Web/API/StorageEstimate\n  @returns {Promise<{quota: number, usage: number}>} Promise resolved with\n  {quota: number, usage: number} or undefined.\n*/\n// async function showEstimatedQuota() {\n//   return (await navigator.storage) && navigator.storage.estimate\n//     ? navigator.storage.estimate()\n//     : undefined;\n// }\n\n/** Tries to persist storage without ever prompting user.\n  @returns {Promise<string>}\n    \"never\" In case persisting is not ever possible. Caller don't bother\n      asking user for permission.\n    \"prompt\" In case persisting would be possible if prompting user first.\n    \"persisted\" In case this call successfully silently persisted the storage,\n      or if it was already persisted.\n*/\nasync function tryPersistWithoutPromtingUser() {\n  if (!navigator.storage || !navigator.storage.persisted) {\n    return \"never\";\n  }\n  let persisted = await navigator.storage.persisted();\n  if (persisted) {\n    return \"persisted\";\n  }\n  if (!navigator.permissions || !navigator.permissions.query) {\n    return \"prompt\"; // It MAY be successful to prompt. Don't know.\n  }\n  const permission = await navigator.permissions.query({\n    name: \"persistent-storage\",\n  });\n  if (permission.state === \"granted\") {\n    persisted = await navigator.storage.persist();\n    if (persisted) {\n      return \"persisted\";\n    } else {\n      throw new Error(\"Failed to persist\");\n    }\n  }\n  if (permission.state === \"prompt\") {\n    return \"prompt\";\n  }\n  return \"never\";\n}\n","import React, { useEffect, useState } from \"react\";\nimport { Menu, Button, Header, Icon, Modal } from \"semantic-ui-react\";\nimport { persist, isStoragePersisted } from \"apis/storemanager\";\n\nconst Persist = () => {\n  const [open, setOpen] = useState(false);\n  const [persisted, setPersisted] = useState(false);\n\n  useEffect(() => {\n    if (!persisted) {\n      isStoragePersisted().then(setPersisted);\n    }\n  }, [persisted]);\n\n  const onClick = async () => {\n    await persist();\n    const ispersisted = await isStoragePersisted();\n    if (ispersisted) {\n      setPersisted(true);\n      alert(\"indexedDB set to persistent for AmCAT Annotator\");\n    } else {\n      alert(\"Failed to set indexedDB to persistent\");\n    }\n  };\n\n  if (persisted) return null;\n\n  return (\n    <Modal\n      closeIcon\n      open={open}\n      trigger={<Menu.Item icon=\"database\" name=\"Enable persitance\" style={{ color: \"#d7a3a3\" }} />}\n      onClose={() => setOpen(false)}\n      onOpen={() => setOpen(true)}\n    >\n      <Header icon=\"database\" content=\"Set database persistence\" />\n      <Modal.Content>\n        <p>\n          We did not have permission to automatically make the data storage for this website\n          persistent. This means that the data could be removed automatically by your browser if it\n          needs to free up space for another website. You can try to set this manually here, but not\n          all browsers support this (yet).\n        </p>\n        <p>\n          If the database is not persistent the app can still be used, but you need to be more\n          carefull in making sure that data is regularly backed up, either by manually downloading\n          data or syncing with some backend (work in progress).\n        </p>\n      </Modal.Content>\n      <Modal.Actions>\n        <Button onClick={onClick}>\n          <Icon name=\"checkmark\" /> Yes\n        </Button>\n      </Modal.Actions>\n    </Modal>\n  );\n};\n\nexport default Persist;\n","import Axios from \"axios\";\n\nexport async function getToken(host, email, password) {\n  const response = await Axios.get(`${host}/auth/token/`, {\n    auth: { username: email, password: password },\n  });\n  return response.data.token;\n}\n\nexport default function newAmcatSession(host, email, token) {\n  return new Amcat(host, email, token);\n}\n\nclass Amcat {\n  constructor(host, email, token) {\n    this.host = host;\n    this.email = email;\n    this.api = Axios.create({\n      baseURL: host,\n      headers: { Authorization: `Bearer ${token}` },\n    });\n  }\n\n  postCodingjob(codingjobPackage, title) {\n    codingjobPackage.title = title;\n\n    return this.api.post(`/codingjob`, {\n      title: title,\n      units: codingjobPackage.units,\n      codebook: codingjobPackage.codebook,\n      provenance: codingjobPackage.provenance,\n      rules: {},\n    });\n  }\n}\n","import React, { useState } from \"react\";\nimport { getToken } from \"apis/amcat\";\nimport { Button, Form, Grid, Header, Message, Segment, Menu, Modal } from \"semantic-ui-react\";\nimport { useCookies } from \"react-cookie\";\n\nconst Amcat = () => {\n  const [open, setOpen] = useState(false);\n  const [cookies, setCookie] = useCookies([\"amcat\"]);\n  console.log(cookies);\n\n  return (\n    <Modal\n      closeIcon\n      open={open}\n      trigger={\n        <Menu.Item\n          icon={cookies.amcat == null ? \"toggle off\" : \"toggle on\"}\n          name={\"AmCAT\"}\n          style={{ color: cookies.amcat == null ? \"red\" : \"green\" }}\n        />\n      }\n      onClose={() => setOpen(false)}\n      onOpen={() => setOpen(true)}\n    >\n      <Header icon=\"database\" content=\"Connect to AmCAT server\" />\n      <Modal.Content>\n        <AmcatLogin setOpen={setOpen} setCookie={setCookie} />\n      </Modal.Content>\n    </Modal>\n  );\n};\n\nconst color = \"blue\";\n\nconst AmcatLogin = ({ setOpen, setCookie }) => {\n  const [host, setHost] = useState(\"https://amcat4.labs.vu.nl/api\");\n  const [email, setEmail] = useState(\"admin\");\n  const [password, setPassword] = useState(\"admin\");\n  const [status, setStatus] = useState(\"idle\");\n\n  const submitForm = async () => {\n    setStatus(\"waiting\");\n    try {\n      const token = await getToken(host, email, password);\n      if (token) {\n        console.log(\"test\");\n        setCookie(\"amcat\", JSON.stringify({ host, email, token }), { path: \"/\" });\n        setStatus(\"success\");\n        setOpen(false);\n      } else setStatus(\"error\");\n    } catch (e) {\n      console.log(e);\n      setStatus(\"error\");\n    }\n  };\n\n  return (\n    <Grid inverted textAlign=\"center\" style={{ height: \"50%\" }} verticalAlign=\"middle\">\n      <Grid.Column style={{ maxWidth: 450 }}>\n        <Header as=\"h2\" color={color} textAlign=\"center\">\n          Connect to AmCAT server\n        </Header>\n        <Form size=\"large\">\n          <Segment stacked>\n            <Form.Input\n              fluid\n              error={status === \"error\"}\n              value={host}\n              onChange={(e, { value }) => {\n                setStatus(\"idle\");\n                setHost(value);\n              }}\n              icon=\"home\"\n              iconPosition=\"left\"\n              placeholder=\"Host\"\n            />\n            <Form.Input\n              fluid\n              error={status === \"error\"}\n              value={email}\n              onChange={(e, { value }) => {\n                setStatus(\"idle\");\n                setEmail(value);\n              }}\n              icon=\"user\"\n              iconPosition=\"left\"\n              placeholder=\"Email adress\"\n            />\n            <Form.Input\n              fluid\n              error={status === \"error\"}\n              value={password}\n              onChange={(e, { value }) => {\n                setStatus(\"idle\");\n                setPassword(value);\n              }}\n              icon=\"lock\"\n              iconPosition=\"left\"\n              placeholder=\"Password\"\n              type=\"password\"\n            />\n\n            <Button onClick={submitForm} color={color} fluid size=\"large\">\n              Login\n            </Button>\n          </Segment>\n        </Form>\n        <Message>Don't have an account? Too bad</Message>\n      </Grid.Column>\n    </Grid>\n  );\n};\n\nexport default Amcat;\n","import React, { useEffect, useState } from \"react\";\nimport { Menu, Header, Modal, Form, Button } from \"semantic-ui-react\";\nimport { useCookies } from \"react-cookie\";\n\nconst UserName = () => {\n  const [open, setOpen] = useState(false);\n  const [name, setName] = useState(\"\");\n  const [cookies, setCookies] = useCookies([\"name\"]);\n\n  console.log(cookies);\n  const storeName = () => {\n    if (name.length < 5) return;\n    setCookies(\"name\", name, { path: \"/\" });\n    setOpen(false);\n  };\n\n  useEffect(() => {\n    if (cookies.name) setName(cookies.name);\n  }, [cookies.name]);\n\n  return (\n    <Modal\n      closeIcon\n      open={open}\n      trigger={\n        <Menu.Item\n          icon={cookies.name == null ? \"toggle off\" : \"toggle on\"}\n          name={\"Name\"}\n          style={{ color: cookies.name == null ? \"red\" : \"green\" }}\n        />\n      }\n      style={{ width: \"23em\" }}\n      onClose={() => setOpen(false)}\n      onOpen={() => setOpen(true)}\n    >\n      <Header icon=\"user\" content=\"Set user name\" />\n      <Modal.Content>\n        <Form onSubmit={storeName}>\n          <Form.Input\n            placeholder=\"username\"\n            value={name}\n            onChange={(e, d) => {\n              if (d.value.length < 50) setName(d.value);\n            }}\n            autoFocus\n            style={{ width: \"18em\" }}\n          />\n        </Form>\n      </Modal.Content>\n      <Modal.Actions>\n        <Button primary disabled={name.length < 5} onClick={storeName}>\n          {name.length < 5 ? \"please use 5 characters or more\" : \"Set user name\"}\n        </Button>\n      </Modal.Actions>\n    </Modal>\n  );\n};\n\nexport default UserName;\n","import React from \"react\";\nimport { Menu, Sidebar } from \"semantic-ui-react\";\nimport { Link, withRouter, useLocation } from \"react-router-dom\";\n\nimport Reset from \"./Reset\";\nimport Persist from \"./Persist\";\nimport Amcat from \"./Amcat\";\nimport UserName from \"./UserName\";\n\n// This is the index file of HeaderMenu, but importing via index\n// breaks. Probably due to the withRouter()\n\nconst HeaderMenu = ({ items, homepage, children }) => {\n  const location = useLocation();\n  const menuItems = items.map((item, index) => {\n    if (!item.menu) return null;\n    return (\n      <Menu.Item\n        key={\"item-\" + index}\n        index={index}\n        as={Link}\n        to={item.path}\n        header={index === 0}\n        active={item.path === location.pathname}\n      >\n        {item.label}\n      </Menu.Item>\n    );\n  });\n\n  if (location.pathname === homepage + \"/annotator\") return children;\n  return (\n    <Sidebar.Pushable style={{ height: \"100vh\" }}>\n      <Sidebar as={Menu} inverted animation=\"push\" visible={true} direction={\"top\"} size=\"mini\">\n        {menuItems}\n        <Menu.Menu position=\"right\">\n          <UserName />\n          <Amcat />\n          <Persist />\n          <Reset homepage={homepage} />\n        </Menu.Menu>\n      </Sidebar>\n      <Sidebar.Pusher>{children}</Sidebar.Pusher>\n    </Sidebar.Pushable>\n  );\n};\n\nexport default withRouter(HeaderMenu);\n","import React, { useEffect, useState } from \"react\";\nimport { useTable, useSortBy, usePagination, useGlobalFilter } from \"react-table\";\nimport {\n  Table,\n  TableHeader,\n  TableBody,\n  TableRow,\n  TableHeaderCell,\n  TableCell,\n  Pagination,\n  Icon,\n} from \"semantic-ui-react\";\n\n// Uses react-table with semantic ui. The columns and data arguments are lists of objects\n// The 'columns' argument specifies column names (Header) and the names of the keys to get from data.\n//\n// const columns = [\n//   { Header: \"ID\", accessor: \"id\", headerClass: \"one wide\" },\n//   { Header: \"Name\", accessor: \"text\", headerClass: \"one wide\" },\n// ]\n//\n// Note that headerClass is custom, and enables setting the header cell class,\n// which is used in semantic ui to specify the width (one wide, ten wide, etc).\n\nconst SelectionTable = ({\n  columns,\n  data,\n  selectedRow,\n  setSelectedRow,\n  width = null,\n  defaultSize = 15,\n}) => {\n  const [activeRow, setActiveRow] = useState(selectedRow ? selectedRow.ROW_ID : null);\n\n  const {\n    getTableProps,\n    getTableBodyProps,\n    headerGroups,\n    prepareRow,\n    page,\n    pageCount,\n    gotoPage,\n    preGlobalFilteredRows,\n    setGlobalFilter,\n    state: { pageIndex, globalFilter },\n  } = useTable(\n    {\n      columns,\n      data,\n      initialState: {\n        pageIndex: selectedRow ? Math.floor(Number(selectedRow.ROW_ID) / defaultSize) : 0,\n        pageSize: defaultSize,\n        globalFilter: \"\",\n      },\n    },\n\n    useGlobalFilter,\n    useSortBy,\n    usePagination\n  );\n\n  useEffect(() => {\n    if (selectedRow) {\n      setActiveRow(selectedRow.ROW_ID);\n    } else {\n      setActiveRow(null);\n    }\n  }, [selectedRow]);\n\n  const onRowSelect = (row) => {\n    if (!setSelectedRow) return null;\n    if (!activeRow || activeRow !== row.id) {\n      setSelectedRow({ ...data[row.id], ROW_ID: row.id });\n      setActiveRow(row.id);\n    }\n  };\n\n  const createHeader = (headerGroup) => {\n    return headerGroup.headers.map((column) => {\n      return (\n        <TableHeaderCell\n          className={column.headerClass}\n          {...column.getHeaderProps(column.getSortByToggleProps())}\n        >\n          {column.render(\"Header\")}\n          <span>{column.isSorted ? (column.isSortedDesc ? \" \" : \" \") : \"\"}</span>\n        </TableHeaderCell>\n      );\n    });\n  };\n\n  const createBody = (page) => {\n    return page.map((row, i) => {\n      prepareRow(row);\n      return (\n        <TableRow\n          active={activeRow ? activeRow === row.id : false}\n          onClick={() => onRowSelect(row)}\n          {...row.getRowProps()}\n        >\n          {row.cells.map((cell) => {\n            return (\n              <TableCell title={cell.value} {...cell.getCellProps()}>\n                {cell.render(\"Cell\")}\n              </TableCell>\n            );\n          })}\n        </TableRow>\n      );\n    });\n  };\n\n  //if (data.length === 0) return null;\n\n  return (\n    <div style={{ width: width }}>\n      <GlobalFilter\n        preGlobalFilteredRows={preGlobalFilteredRows}\n        globalFilter={globalFilter}\n        setGlobalFilter={setGlobalFilter}\n      />\n      <Table\n        compact\n        unstackable\n        fixed\n        singleLine\n        selectable\n        {...getTableProps()}\n        size=\"small\"\n        style={{ fontSize: \"10px\", overflowY: \"auto\" }}\n      >\n        <TableHeader>\n          {headerGroups.map((headerGroup) => (\n            <TableRow {...headerGroup.getHeaderGroupProps()}>{createHeader(headerGroup)}</TableRow>\n          ))}\n        </TableHeader>\n        <TableBody {...getTableBodyProps()}>{createBody(page)}</TableBody>\n        <Table.Footer>\n          <Table.Row>\n            <Table.HeaderCell colSpan={columns.length}>\n              {data.length > defaultSize ? (\n                <Pagination\n                  floated=\"right\"\n                  style={{ border: \"0\" }}\n                  size=\"mini\"\n                  firstItem={false}\n                  lastItem={false}\n                  nextItem={false}\n                  prevItem={false}\n                  boundaryRange={1}\n                  ellipsisItem={{\n                    content: <Icon name=\"ellipsis horizontal\" />,\n                    icon: true,\n                  }}\n                  activePage={pageIndex + 1}\n                  totalPages={pageCount}\n                  onPageChange={(event, data) => {\n                    gotoPage(data.activePage - 1);\n                  }}\n                />\n              ) : null}\n            </Table.HeaderCell>\n          </Table.Row>\n        </Table.Footer>\n      </Table>\n    </div>\n  );\n};\n\nconst GlobalFilter = ({ preGlobalFilteredRows, globalFilter, setGlobalFilter }) => {\n  //const count = preGlobalFilteredRows && preGlobalFilteredRows.length;\n\n  return (\n    <span>\n      <input\n        value={globalFilter || \"\"}\n        onChange={(e) => {\n          setGlobalFilter(e.target.value || undefined); // Set undefined to remove the filter entirely\n        }}\n        placeholder={`Enter search term`}\n        style={{\n          border: \"0\",\n        }}\n      />\n    </span>\n  );\n};\n\nexport default SelectionTable;\n","export const demo_codebook = {\n  codes: [\n    { code: \"VVD\", parent: \"Actor\", active: true },\n    { code: \"D66\", parent: \"Actor\", active: true },\n    { code: \"Groenlinks\", parent: \"Actor\", active: true },\n    { code: \"Mark Rutte\", parent: \"VVD\", active: true },\n    { code: \"Sigrid Kaag\", parent: \"D66\", active: true },\n    { code: \"Jesse Klaver\", parent: \"Groenlinks\", active: true },\n    { code: \"Climate change\", parent: \"Issue\", active: true },\n  ],\n};\n\nexport const demo_articles = [\n  {\n    document_id: \"Some document ID\",\n    text_fields: [\n      {\n        name: \"title\",\n        value: `GL en PvdA hebben goed gesprek met informateur, maar wantrouwen Rutte`,\n      },\n      {\n        name: \"text\",\n        value: `PvdA-leider Lilianne Ploumen en GroenLinks-leider Jesse Klaver hadden vrijdag een goed gesprek met informateur Herman Tjeenk Willink, zeiden ze zelf. De twee benadrukten dat, hoewel er inhoudelijke stappen zijn gezet, hun vertrouwen in VVD-leider Mark Rutte nog niet is hersteld.\n\n    Informateur Willink zette zich vrijdag aan zijn taak. Eerste punt op de agenda zijn gesprekken met de lijsttrekkers van de acht grootste partijen.\n    \n    Een week nadat een groot deel van de partijleiders bekendmaakte niet meer met Rutte verder te willen onderhandelen over een nieuwe coalitie, wordt gekeken waarover partijen het inhoudelijk eens zijn.\n    \n    \"Het was een prettig gesprek langs de lijnen van de inhoud\", zei PvdA-leider Lilianne Ploumen na afloop. Ze heeft haar zorgen over de ongelijkheid in Nederland en over de zorg gedeeld.\n    \n    Ook Jesse Klaver (GroenLinks), die een uur eerder op gesprek kwam bij de informateur, benadrukte dat het ging over de problemen die opgelost moeten worden.\n    \n    Situatie niet veranderd in een week\n\nWat betreft de positie ten opzichte van Rutte is echter niets veranderd. Vorige week ondertekenden Ploumen en Klaver net als alle andere oppositiepartijen een motie van wantrouwen, vanwege Ruttes betrokkenheid bij de notitie over CDA-Kamerlid Pieter Omtzigt.\n\n\"Als het aan ons ligt, was Rutte geen premier meer\", zei Ploumen. Hoe Tjeenk Willink dat gedeukte vertrouwen kan herstellen, weet ze niet. \"We wachten de voorstellen van de informateur af.\"\n\n\"De vertrouwensbreuk is niet hersteld na n gesprek met de fractievoorzitters\", zei ook Klaver. \"Mijn mening over Rutte is niet veranderd.\"\n\nSP'er Lilian Marijnissen sprak zich al eerder expliciet uit tegen samenwerking met Rutte.\n\nDe partijleiders hekelen het gebrek aan openheid en transparantie waar Rutte in hun ogen voor staat. \"Als je een fout maakt, dan moet je dat toegeven en er niet over liegen\", zei Klaver. Ploumen: \"Het probleem is dat Mark Rutte heeft gelogen. Wij hebben het vertrouwen in hem opgezegd.\"\n\nWat de vervolgstappen moeten zijn, laten ze volledig over aan Tjeenk Willink. \"Ik ga geen lijstjes maken met wat er moet gebeuren\", zei Ploumen.\n\nDe informateur ontvangt later op vrijdag nog de partijleiders Wopke Hoekstra (CDA) en Sigrid Kaag (D66), en Rutte zelf.\n\nTjeenk Willink denkt niet dat Rutte zomaar door kan\n\nTjeenk Willink suggereerde woensdag op een persconferentie dat hij Rutte niet per se een sta-in-de-weg voor een verandering van de bestuursstijl in Den Haag vindt. Toen daarover vervolgens berichten in de media verschenen, voelde de informateur zich vrijdag genoodzaakt die boodschap bij te sturen.\n\nDe conclusie dat Rutte geen belemmering vormt voor de formatie, kan hij niet voor zijn rekening nemen, luidt een schriftelijke verklaring.\n\nTjeenk Willink heeft namelijk ook de opdracht om te onderzoeken \"of en zo ja onder welke voorwaarden er voldoende vertrouwen tussen partijen bestaat of weer kan ontstaan\".`,\n      },\n    ],\n  },\n  {\n    document_id: \"Another document ID\",\n    text_fields: [\n      {\n        name: \"title\",\n        value: `CU-leider Segers vindt dat uitspraak over Rutte te veel op de man was gespeeld`,\n      },\n      {\n        name: \"text\",\n        value: `Partijleider Gert-Jan Segers van de ChristenUnie (CU) vindt dat hij te veel op de man heeft gespeeld door coalitiedeelname uit te sluiten als VVD-leider Mark Rutte opnieuw premier zou worden. Terugblikkend zegt hij dat het niet om n persoon moet gaan, maar om \"een ongezonde politieke cultuur en een genadeloze overheid\". Daar moet volgens hem verandering in komen, zo zei hij zaterdag tijdens een congres van de partij.\n\n    \n    Segers deed zijn uitspraak over Rutte na het debat over de notitie \"functie elders\" voor CDA-Kamerlid Pieter Omtzigt. Binnen de CU is verdeeldheid ontstaan over het besluit van de fractie, erkent Segers.\n    \n    Naast steun is er ook kritiek van veel leden, die zeggen dat hij \"te veel op de man heeft gespeeld en te weinig de bal\". \"Te veel Rutte, te weinig ons allemaal. En als dat de perceptie van veel mensen is, dan moet ik me dat aantrekken\", aldus Segers tijdens het congres.\n    \n    \n    Volgens de CU-leider staat \"de politieke cultuur in Den Haag natuurlijk niet los van Mark Rutte, zeker niet\".\n    \n    \"Maar die oude cultuur staat of valt niet met n man. Ook wijzelf maken er deel van uit. Ik wil niet genadeloos zijn voor personen, maar ik wil wel hard en helder zijn over een cultuur die niet deugt en een genadeloze overheid. Daar moet cht een omslag in komen\", zei Segers.\n    \n    \n    De ChristenUnie heeft vijf zetels in de Tweede Kamer. Op het congres werden vier oude Kamerleden uitgezwaaid en trad Ankie van Tatenhove aan als nieuwe partijvoorzitter.`,\n      },\n    ],\n  },\n];\n","import React, { useEffect, useState } from \"react\";\nimport {\n  Header,\n  Button,\n  Modal,\n  Form,\n  Loader,\n  Dimmer,\n  Icon,\n  Segment,\n  Container,\n  Grid,\n} from \"semantic-ui-react\";\n\nimport SelectionTable from \"./subcomponents/SelectionTable\";\nimport db from \"apis/dexie\";\nimport { demo_articles, demo_codebook } from \"apis/demodata\";\nimport { useLiveQuery } from \"dexie-react-hooks\";\n\nconst CodingjobSelector = ({ codingjob, setSelectedCodingjob }) => {\n  const codingjobs = useLiveQuery(() => db.idb.codingjobs.toArray());\n\n  useEffect(() => {\n    if (!codingjob?.job_id && codingjobs) {\n      setSelectedCodingjob(codingjobs.length > 0 ? { ...codingjobs[0], ROW_ID: \"0\" } : null);\n    }\n  }, [codingjob, codingjobs, setSelectedCodingjob]);\n\n  const tableColumns = [\n    {\n      Header: \"Coding job\",\n      accessor: \"name\",\n      headerClass: \"thirteen wide\",\n    },\n  ];\n\n  const table = () => {\n    if (!codingjobs) return null;\n    if (codingjobs.length === 0)\n      return (\n        <div style={{ textAlign: \"center\" }}>\n          <Button primary onClick={() => createDemoJob()}>\n            Create Demo job\n          </Button>\n        </div>\n      );\n    return (\n      <SelectionTable\n        columns={tableColumns}\n        data={codingjobs ? codingjobs : []}\n        selectedRow={codingjob}\n        setSelectedRow={setSelectedCodingjob}\n        defaultSize={15}\n      />\n    );\n  };\n\n  return (\n    <Grid centered stackable columns={1}>\n      <Grid.Column width={6}>\n        <Header textAlign=\"center\" style={{ background: \"#1B1C1D\", color: \"white\" }}>\n          Select Codingjob\n        </Header>\n        <Segment style={{ border: \"0\" }}>\n          <Button.Group widths=\"2\" size=\"mini\">\n            <CreateCodingjob setSelectedCodingjob={setSelectedCodingjob} />\n            <DeleteCodingjob codingjob={codingjob} setCodingjob={setSelectedCodingjob} />\n          </Button.Group>\n\n          <Container style={{ marginTop: \"30px\", overflow: \"auto\", width: \"800px\" }}>\n            {table()}\n          </Container>\n        </Segment>\n      </Grid.Column>\n    </Grid>\n  );\n};\n\nconst createDemoJob = async () => {\n  try {\n    const exists = await db.idb.codingjobs.get({ name: \"Demo codingjob\" });\n    if (exists) return null;\n    const job = await db.createCodingjob(\"Demo codingjob\");\n    await db.createDocuments(job, demo_articles, true);\n    await db.writeCodebook(job, demo_codebook);\n    return null;\n  } catch (e) {\n    console.log(e);\n  }\n};\n\nconst CreateCodingjob = ({ setSelectedCodingjob }) => {\n  const [status, setStatus] = useState(\"inactive\");\n  const [codingjobName, setCodingjobName] = useState(\"\");\n\n  const onSubmit = async (event) => {\n    event.preventDefault();\n\n    setCodingjobName(codingjobName.trim());\n    setStatus(\"pending\");\n\n    try {\n      await db.createCodingjob(codingjobName);\n      setSelectedCodingjob(null);\n      setStatus(\"inactive\");\n    } catch (e) {\n      console.log(e);\n      setStatus(\"error\");\n    }\n  };\n\n  return (\n    <Modal\n      as={Form}\n      trigger={\n        <Button>\n          <Icon name=\"plus\" />\n          Create job\n        </Button>\n      }\n      onSubmit={(e) => onSubmit(e)}\n      open={status !== \"inactive\"}\n      onClose={() => setStatus(\"inactive\")}\n      onOpen={() => {\n        setCodingjobName(\"\");\n        setStatus(\"awaiting input\");\n      }}\n      size=\"tiny\"\n    >\n      <Header icon=\"pencil\" content=\"Create new Codingjob\" as=\"h2\" />\n      <Modal.Content>\n        <Form.Group>\n          <Form.Input\n            width={12}\n            label=\"Name\"\n            required\n            type=\"text\"\n            value={codingjobName}\n            onChange={(e, d) => {\n              setStatus(\"awaiting input\");\n              setCodingjobName(d.value);\n            }}\n            placeholder=\"Enter name\"\n          />\n        </Form.Group>\n      </Modal.Content>\n      <Modal.Actions>\n        {status === \"error\" ? (\n          <div>\n            Could not create codingjob for a reason not yet covered in the error handling...\n          </div>\n        ) : null}\n        {status === \"pending\" ? (\n          <Dimmer active inverted>\n            <Loader content=\"Creating codingjob\" />\n          </Dimmer>\n        ) : (\n          <Button type=\"submit\" color=\"green\" icon=\"save\" content=\"Create\" />\n        )}\n      </Modal.Actions>\n    </Modal>\n  );\n};\n\nconst DeleteCodingjob = ({ codingjob, setCodingjob }) => {\n  const [status, setStatus] = useState(\"inactive\");\n\n  const onSubmit = async (event) => {\n    setStatus(\"pending\");\n    try {\n      await db.deleteCodingjob(codingjob);\n      setCodingjob(null);\n\n      setStatus(\"inactive\");\n    } catch (e) {\n      setStatus(\"error\");\n    }\n  };\n\n  if (!codingjob?.job_id) return null;\n\n  return (\n    <Modal\n      closeIcon\n      open={status !== \"inactive\"}\n      trigger={\n        <Button compact>\n          <Icon name=\"minus\" /> Delete job\n        </Button>\n      }\n      onClose={() => {\n        setStatus(\"inactive\");\n      }}\n      onOpen={() => {\n        setStatus(\"awaiting input\");\n      }}\n    >\n      <Header icon=\"trash\" content={`Delete codingjob ${codingjob.name}`} />\n      <Modal.Content>\n        <p>Do you really want to delete this codingjob?</p>\n      </Modal.Content>\n      <Modal.Actions>\n        {status === \"error\" ? (\n          <div>\n            Could not delete codingjob for a reason not yet covered in the error handling...\n          </div>\n        ) : null}\n        {status === \"pending\" ? (\n          <Dimmer active inverted>\n            <Loader content=\"Deleting codingjob\" />\n          </Dimmer>\n        ) : (\n          <>\n            <Button\n              color=\"red\"\n              onClick={() => {\n                setStatus(\"inactive\");\n              }}\n            >\n              <Icon name=\"remove\" /> No\n            </Button>\n            <Button color=\"green\" onClick={onSubmit}>\n              <Icon name=\"checkmark\" /> Yes\n            </Button>\n          </>\n        )}\n      </Modal.Actions>\n    </Modal>\n  );\n};\n\nexport default React.memo(CodingjobSelector);\n","import React, { useRef, useEffect, useState } from \"react\";\nimport { Container, Header, Table, Grid, Form, Button, Icon, Dropdown } from \"semantic-ui-react\";\n\n//import CSVReader from \"react-csv-reader\";\n//import Papa from \"papaparse\";\nimport { CSVReader } from \"react-papaparse\";\nimport db from \"apis/dexie\";\n\nexport const UploadTextsCsv = ({ codingjob }) => {\n  const columns = {\n    document_id: { required: true, multiple: false, defaults: [\"doc_id\", \"document_id\"] },\n    text_fields: {\n      required: true,\n      multiple: true,\n      defaults: [\"title\", \"headline\", \"body\", \"message\", \"text\"],\n    },\n  };\n  return <UploadCsv codingjob={codingjob} type=\"texts\" columns={columns} />;\n};\n\nconst renderTextForms = (columns, options, fields, setFields) => {\n  return (\n    <>\n      <Form.Group widths=\"equal\">\n        {renderForm(\"document id\", \"document_id\", columns, options, fields, setFields)}\n\n        {renderForm(\"text fields\", \"text_fields\", columns, options, fields, setFields)}\n      </Form.Group>\n    </>\n  );\n};\n\nexport const UploadTokensCsv = ({ codingjob }) => {\n  const columns = {\n    document_id: { required: true, multiple: false, defaults: [\"doc_id\", \"document_id\"] },\n    token: { required: true, multiple: false, defaults: [\"token\", \"text\"] },\n    sentence: { required: false, multiple: false, defaults: [\"sentence\", \"sentence_id\"] },\n    paragraph: { required: false, multiple: false, defaults: [\"paragraph\", \"paragraph_id\"] },\n    offset: { required: false, int: true, multiple: false, defaults: [\"offset\", \"start\"] },\n    end: { required: false, int: true, multiple: false, defaults: [\"end\"] },\n    post: { required: false, multiple: false, defaults: [\"post\", \"space\"] },\n    section: { required: false, multiple: false, defaults: [\"section\"] },\n    annotations: { required: false, multiple: true, defaults: [] },\n  };\n  return <UploadCsv codingjob={codingjob} type=\"tokens\" columns={columns} />;\n};\n\nconst renderTokenForms = (columns, options, fields, setFields) => {\n  return (\n    <>\n      <Form.Group widths=\"equal\">\n        {renderForm(\"document id\", \"document_id\", columns, options, fields, setFields)}\n        {renderForm(\"token\", \"token\", columns, options, fields, setFields)}\n        {renderForm(\"paragraph\", \"paragraph\", columns, options, fields, setFields)}\n        {renderForm(\"sentence\", \"sentence\", columns, options, fields, setFields)}\n      </Form.Group>\n      <Form.Group widths=\"equal\">\n        {renderForm(\"start / offset\", \"offset\", columns, options, fields, setFields)}\n        {renderForm(\"end\", \"end\", columns, options, fields, setFields)}\n        {renderForm(\"space / post\", \"post\", columns, options, fields, setFields)}\n        {renderForm(\"section (title, text..)\", \"section\", columns, options, fields, setFields)}\n      </Form.Group>\n      <Form.Group widths=\"equal\">\n        {renderForm(\"annotation columns\", \"annotations\", columns, options, fields, setFields, true)}\n      </Form.Group>\n    </>\n  );\n};\n\nconst UploadCsv = ({ codingjob, type = \"text\", columns }) => {\n  const [data, setData] = useState([]);\n  const fileRef = useRef();\n\n  return (\n    <Container>\n      <Grid>\n        <Grid.Column width={5}>\n          <CSVReader\n            ref={fileRef}\n            nodrag\n            onFileLoad={data => setData(data)}\n            addRemoveButton\n            onRemoveFile={() => setData([])}\n          >\n            <span>Click to upload</span>\n          </CSVReader>\n        </Grid.Column>\n        <Grid.Column floated=\"right\" width={11}>\n          <SubmitForm\n            type={type}\n            data={data}\n            codingjob={codingjob}\n            fileRef={fileRef}\n            columns={columns}\n          />\n        </Grid.Column>\n      </Grid>\n      <PreviewTable data={data} />\n    </Container>\n  );\n};\n\nconst SubmitForm = ({ type, data, codingjob, fileRef, columns }) => {\n  const [options, setOptions] = useState([]);\n  const [fields, setFields] = useState({});\n  const [loading, setLoading] = useState(false);\n\n  useEffect(() => {\n    if (data.length <= 1) {\n      setFields({});\n      setOptions([]);\n      return;\n    }\n\n    setOptions(\n      data[0].data.map(colname => {\n        return { key: colname, value: colname, text: colname };\n      })\n    );\n\n    let newfields = {};\n    for (let col of Object.keys(columns)) {\n      newfields[col] = columns[col].multiple ? [] : null;\n      for (let def of columns[col].defaults) {\n        if (data[0].data.includes(def)) {\n          if (columns[col].multiple) {\n            newfields[col].push(def);\n          } else newfields[col] = def;\n        }\n      }\n    }\n    setFields(newfields);\n  }, [data, columns]);\n\n  const csvToJson = (data, fields) => {\n    const keys = data[0].data;\n\n    // first get indices from header row\n    // more efficient than lookup for each row\n    const fieldIndices = { ...fields };\n    for (let field of Object.keys(fields)) {\n      if (columns[field].multiple) {\n        fieldIndices[field] = {};\n        for (let subfield of fields[field]) {\n          fieldIndices[field][subfield] = keys.findIndex(k => k === subfield);\n        }\n      } else {\n        fieldIndices[field] = keys.findIndex(k => k === fields[field]);\n      }\n    }\n\n    return data.slice(1).map(row => {\n      const original = keys.map((key, i) => {\n        return { name: key, value: row.data[i] };\n      });\n      const datarow = { original };\n\n      for (let field of Object.keys(fields)) {\n        if (columns[field].multiple) {\n          datarow[field] = [];\n          for (let subfield of fields[field]) {\n            const fieldindex = fieldIndices[field][subfield];\n            if (fieldindex < 0) continue;\n            let v = row.data[fieldindex];\n            if (columns[field].int) v = parseInt(v);\n            datarow[field].push({ name: keys[fieldindex], value: v });\n          }\n        } else {\n          const fieldindex = fieldIndices[field];\n          if (fieldindex < 0) continue;\n          let v = row.data[fieldindex];\n          datarow[field] = columns[field].int ? parseInt(v) : v;\n        }\n      }\n      return datarow;\n    });\n  };\n\n  const uploadData = async () => {\n    try {\n      setLoading(true);\n      let preparedData = csvToJson(data, fields);\n      if (type === \"tokens\") preparedData = tokensToDocumentList(preparedData);\n      await db.createDocuments(codingjob, preparedData);\n      await db.setCodingjobProp(codingjob, \"codebook.unitSettings.n\", null);\n      fileRef.current.removeFile();\n      //dispatch(selectCodingjob(codingjob));\n      setLoading(false);\n    } catch (e) {\n      console.log(e);\n      setLoading(false);\n    }\n  };\n\n  const allDone = () => {\n    for (let col of Object.keys(columns)) {\n      if (columns[col].multiple) {\n        if (columns[col].required && fields[col].length === 0) return false;\n      } else {\n        if (columns[col].required && !fields[col]) return false;\n      }\n    }\n    return true;\n  };\n\n  //if (data.length <= 1) return null;\n\n  return (\n    <>\n      <Form loading={loading}>\n        {type === \"texts\" ? renderTextForms(columns, options, fields, setFields) : null}\n        {type === \"tokens\" ? renderTokenForms(columns, options, fields, setFields) : null}\n        <Form.Group>\n          <Form.Field control={Button} onClick={uploadData} disabled={!allDone()}>\n            <Icon name=\"upload\" />\n            Upload\n          </Form.Field>\n        </Form.Group>\n      </Form>\n    </>\n  );\n};\n\nconst tokensToDocumentList = data => {\n  const documents = [];\n  let tokens = [data[0]];\n  for (let i = 1; i < data.length; i++) {\n    if (data[i].document_id !== data[i - 1].document_id) {\n      documents.push({ document_id: data[i - 1].document_id, tokens });\n      tokens = [];\n    }\n    tokens.push(data[i]);\n  }\n  return documents;\n};\n\nconst renderForm = (label, column, columns, options, fields, setFields) => {\n  return (\n    <Form.Field\n      control={Dropdown}\n      clearable\n      selection\n      multiple={columns[column].multiple ? true : false}\n      label={{ children: label, style: { fontSize: \"10px\" } }}\n      required={columns[column].required}\n      options={options}\n      value={fields[column]}\n      onChange={(e, d) => {\n        const newfields = { ...fields };\n        newfields[column] = d.value;\n        setFields(newfields);\n      }}\n      style={{ minWidth: \"3em\", fontSize: \"10px\" }}\n    />\n  );\n};\n\nconst PreviewTable = ({ data }) => {\n  const n = 5;\n\n  const createHeader = data => {\n    return data[0].data.map(colname => {\n      return (\n        <Table.HeaderCell style={{ width: \"7em\" }}>\n          <span title={colname}>{colname}</span>\n        </Table.HeaderCell>\n      );\n    });\n  };\n\n  const createRows = (data, n) => {\n    const previewdata = data.slice(0, n + 1);\n    return previewdata.slice(1).map(row => {\n      return <Table.Row>{createRowCells(row.data)}</Table.Row>;\n    });\n  };\n\n  const createRowCells = row => {\n    return row.map(cell => {\n      return (\n        <Table.Cell>\n          <span title={cell}>{cell}</span>\n        </Table.Cell>\n      );\n    });\n  };\n\n  if (data.length <= 1) return null;\n\n  return (\n    <div\n      style={{\n        marginTop: \"3em\",\n        overflow: \"auto\",\n        width: \"100%\",\n        border: \"solid 1px\",\n      }}\n    >\n      <Table singleLine fixed size=\"small\" compact>\n        <Table.Header>\n          <Table.Row>{createHeader(data)}</Table.Row>\n        </Table.Header>\n        <Table.Body>{createRows(data, n)}</Table.Body>\n      </Table>\n      {data.length > n ? <Header align=\"center\">{data.length - 1 - n} more rows</Header> : null}\n    </div>\n  );\n};\n","import React, { useState } from \"react\";\nimport { Menu, Segment } from \"semantic-ui-react\";\n\nimport { UploadTextsCsv, UploadTokensCsv } from \"./UploadForms\";\n\nconst UploadDocuments = ({ codingjob }) => {\n  const [activeItem, setActiveItem] = useState(\"Documents CSV\");\n  const renderSwitch = (activeItem) => {\n    switch (activeItem) {\n      case \"Documents CSV\":\n        return <UploadTextsCsv codingjob={codingjob} />;\n      case \"Tokens CSV\":\n        return <UploadTokensCsv codingjob={codingjob} />;\n      default:\n        return null;\n    }\n  };\n\n  return (\n    <>\n      <Menu attached=\"top\" tabular>\n        <Menu.Item\n          name=\"Documents CSV\"\n          active={activeItem === \"Documents CSV\"}\n          onClick={(e, d) => setActiveItem(d.name)}\n        />\n        <Menu.Item\n          name=\"Tokens CSV\"\n          active={activeItem === \"Tokens CSV\"}\n          onClick={(e, d) => setActiveItem(d.name)}\n        />\n      </Menu>\n      <Segment attached=\"bottom\">{renderSwitch(activeItem)}</Segment>\n    </>\n  );\n};\n\nexport default UploadDocuments;\n","import React, { useEffect, useState } from \"react\";\nimport { Container, Pagination, Table, Icon } from \"semantic-ui-react\";\nimport db from \"apis/dexie\";\n\nconst PAGESIZE = 10;\n\nconst DocumentTable = ({ codingjob }) => {\n  const [data, setData] = useState([]);\n  const [pages, setPages] = useState(1);\n  const [columns, setColumns] = useState([]);\n\n  useEffect(() => {\n    if (!codingjob) {\n      setData([]);\n      setColumns([]);\n      return null;\n    }\n    fetchFromDb(codingjob, PAGESIZE, setPages, setData, setColumns);\n  }, [codingjob]);\n\n  const createHeaderRow = (data, columns) => {\n    return columns.map((colname, i) => {\n      return (\n        <Table.HeaderCell key={i} width={i === 0 ? 3 : null}>\n          <span title={colname}>{colname}</span>\n        </Table.HeaderCell>\n      );\n    });\n  };\n\n  const createBodyRows = (data) => {\n    return data.map((rowObj, i) => {\n      return <Table.Row key={i}>{createRowCells(rowObj)}</Table.Row>;\n    });\n  };\n\n  const tokensToText = (tokens, section) => {\n    return tokens.reduce((text, token) => {\n      if (token.section === section) text = text + token.pre + token.token + token.post;\n      return text;\n    }, \"\");\n  };\n\n  const createRowCells = (rowObj) => {\n    return columns.map((key, i) => {\n      let content = null;\n      if (key === \"document_id\") {\n        content = rowObj.document_id;\n      } else {\n        if (rowObj.text_fields) {\n          content = rowObj.text_fields.find((tf) => tf.name === key);\n          if (content) content = content.value;\n        }\n        if (!content && !rowObj.text_fields && rowObj.tokens) {\n          content = tokensToText(rowObj.tokens, key);\n        }\n      }\n\n      return (\n        <Table.Cell key={i}>\n          <span title={content}>{content}</span>\n        </Table.Cell>\n      );\n    });\n  };\n\n  const pageChange = async (event, data) => {\n    const offset = (data.activePage - 1) * PAGESIZE;\n    const newdata = await db.getJobDocuments(codingjob, offset, PAGESIZE);\n    setData(newdata);\n    setColumns(getColumns(newdata));\n  };\n\n  if (data.length < 1)\n    return (\n      <h3 style={{ marginTop: \"5em\", textAlign: \"center\" }}>\n        This codingjob does not yet have any documents\n      </h3>\n    );\n\n  return (\n    <Container style={{ marginTop: \"2em\" }}>\n      <Table\n        unstackable\n        selectable\n        fixed\n        compact\n        singleLine\n        size=\"small\"\n        style={{ fontSize: \"10px\" }}\n      >\n        <Table.Header>\n          <Table.Row>{createHeaderRow(data, columns)}</Table.Row>\n        </Table.Header>\n        <Table.Body>{createBodyRows(data)}</Table.Body>\n        <Table.Footer>\n          <Table.Row>\n            <Table.HeaderCell colSpan={columns.length}>\n              {pages > 1 ? (\n                <Pagination\n                  size=\"mini\"\n                  floated=\"right\"\n                  boundaryRange={1}\n                  siblingRange={1}\n                  ellipsisItem={{\n                    content: <Icon name=\"ellipsis horizontal\" />,\n                    icon: true,\n                  }}\n                  firstItem={{\n                    content: <Icon name=\"angle double left\" />,\n                    icon: true,\n                  }}\n                  lastItem={{\n                    content: <Icon name=\"angle double right\" />,\n                    icon: true,\n                  }}\n                  prevItem={{ content: <Icon name=\"angle left\" />, icon: true }}\n                  nextItem={{\n                    content: <Icon name=\"angle right\" />,\n                    icon: true,\n                  }}\n                  pointing\n                  secondary\n                  defaultActivePage={1}\n                  totalPages={pages}\n                  onPageChange={pageChange}\n                ></Pagination>\n              ) : null}\n            </Table.HeaderCell>\n          </Table.Row>\n        </Table.Footer>\n      </Table>\n    </Container>\n  );\n};\n\nconst fetchFromDb = async (codingjob, pageSize, setPages, setData, setColumns) => {\n  const n = await db.getJobDocumentCount(codingjob);\n  setPages(Math.ceil(n / pageSize));\n  let newdata = [];\n  if (n > 0) newdata = await db.getJobDocuments(codingjob, 0, pageSize);\n\n  setData(newdata);\n  setColumns(getColumns(newdata));\n};\n\nconst getColumns = (newdata) => {\n  let newcolumns = [];\n  if (newdata.length > 0) {\n    newcolumns = newdata.reduce((s, row) => {\n      if (row.text_fields) {\n        for (let tf of row.text_fields) s.add(tf.name);\n      } else {\n        for (let i = 0; i < row.tokens.length; i++) s.add(row.tokens[i].section);\n      }\n      return s;\n    }, new Set());\n  }\n  return [\"document_id\", ...newcolumns];\n};\n\nexport default DocumentTable;\n","import React from \"react\";\n\nimport { Grid, Header } from \"semantic-ui-react\";\nimport UploadDocuments from \"./subcomponents/UploadDocuments\";\nimport DocumentTable from \"./subcomponents/DocumentTable\";\n\nconst ManageDocuments = ({ codingjob }) => {\n  return (\n    <div style={{ paddingLeft: \"1em\" }}>\n      <Grid stackable columns={2}>\n        <Grid.Column width={8}>\n          <Header textAlign=\"center\" style={{ background: \"#1B1C1D\", color: \"white\" }}>\n            Upload Documents\n          </Header>\n          <UploadDocuments codingjob={codingjob} />\n        </Grid.Column>\n        <Grid.Column width={8}>\n          <Header textAlign=\"center\" style={{ background: \"#1B1C1D\", color: \"white\" }}>\n            Document list\n          </Header>\n\n          <DocumentTable codingjob={codingjob} />\n        </Grid.Column>\n      </Grid>\n    </div>\n  );\n};\n\nexport default React.memo(ManageDocuments);\n","import React from \"react\";\n\nimport { Button, Popup } from \"semantic-ui-react\";\n\nconst Help = ({ children, header, texts, type }) => {\n  // a simple question mark popup for help texts\n  // header should be a string\n  // texts an array of strings (for different paragraphs)\n\n  const questionMark = () => {\n    return (\n      <Button\n        circular\n        icon={type === \"warn\" ? \"exclamation\" : \"question\"}\n        size=\"mini\"\n        style={{\n          position: \"absolute\",\n          marginTop: \"-0.6em\",\n          marginLeft: \"0.2em\",\n          paddingLeft: \"0.1em\",\n          paddingRight: \"0.1em\",\n          paddingTop: \"0.2em\",\n          paddingBottom: \"0.2em\",\n          background: type === \"warn\" ? \"orange\" : \"white\",\n          color: \"black\",\n          border: \"1px solid grey\",\n        }}\n      />\n    );\n  };\n\n  return (\n    <Popup wide trigger={questionMark()}>\n      {header ? <h3>{header}</h3> : null}\n      {texts ? texts.map((text, i) => <p key={i}>{text}</p>) : null}\n      {children}\n    </Popup>\n  );\n};\n\nexport default Help;\n","import randomColor from \"randomcolor\";\n\n/**\n * Transform the taskSettings into the codebook. The difference is that taskSettings also contains information that's only relevant in the manager. The codebook contains only the information relevant for the annotator\n * @param {*} taskSettings\n */\nexport const getCodebook = (taskSettings) => {\n  const codebook = {\n    type: taskSettings.type,\n    ...taskSettings[taskSettings.type],\n  };\n\n  return codebook;\n};\n\nexport const standardizeCodes = (codes) => {\n  return codes.map((code, i) => {\n    if (typeof code !== \"object\") code = { code };\n    if (code.active == null) code.active = true;\n    if (code.tree == null) code.tree = [];\n    if (code.parent == null) code.parent = \"\";\n    if (code.makes_irrelevant == null) code.makes_irrelevant = [];\n    if (typeof code.makes_irrelevant !== \"object\") code.makes_irrelevant = [code.makes_irrelevant];\n    if (code.color == null) code.color = randomColor({ seed: code.code, luminosity: \"light\" });\n    return code;\n  });\n};\n\nexport const codeBookEdgesToMap = (codes) => {\n  const standardizedCodes = standardizeCodes(codes);\n  // the payload is an array of objects, but for efficients operations\n  // in the annotator we convert it to an object with the codes as keys\n  const codeMap = standardizedCodes.reduce((result, code) => {\n    result[code.code] = {\n      ...code,\n      children: [],\n      totalChildren: 0,\n      totalActiveChildren: 0,\n    };\n    return result;\n  }, {});\n\n  // If there are codes of which the parent doesn't exist, add the parent\n  const originalKeys = Object.keys(codeMap);\n  for (const key of originalKeys) {\n    if (codeMap[key].parent !== \"\" && !codeMap[codeMap[key].parent]) {\n      codeMap[codeMap[key].parent] = {\n        code: codeMap[key].parent,\n        parent: \"\",\n        children: [],\n        active: false,\n        totalChildren: 0,\n        totalActiveChildren: 0,\n      };\n    }\n  }\n\n  for (const code of Object.keys(codeMap)) {\n    [codeMap[code].tree, codeMap[code].activeParent, codeMap[code].foldToParent] = parentData(\n      codeMap,\n      code\n    );\n\n    if (codeMap[code].parent) codeMap[codeMap[code].parent].children.push(code);\n\n    for (const parent of codeMap[code].tree) {\n      codeMap[parent].totalChildren++;\n      if (codeMap[code].active && codeMap[code].activeParent) {\n        codeMap[parent].totalActiveChildren++;\n      }\n    }\n  }\n\n  return codeMap;\n};\n\nexport const getCodeTreeArray = (codeMap, showColors) => {\n  let parents = Object.keys(codeMap).filter(\n    (code) => !codeMap[code].parent || codeMap[code].parent === \"\"\n  );\n  const codeTreeArray = [];\n  fillCodeTreeArray(codeMap, parents, codeTreeArray, [], showColors);\n  return codeTreeArray.map((object, i) => ({ ...object, i: i }));\n};\n\nconst fillCodeTreeArray = (codeMap, parents, codeTreeArray, codeTrail, showColors) => {\n  for (const code of parents) {\n    let newcodeTrail = [...codeTrail];\n    newcodeTrail.push(code);\n\n    codeTreeArray.push({\n      ...codeMap[code],\n      code: code,\n      codeTrail: codeTrail,\n      level: codeTrail.length,\n      color: codeMap[code].color\n        ? codeMap[code].color\n        : randomColor({ seed: code, luminosity: \"light\" }),\n    });\n\n    if (codeMap[code].children) {\n      fillCodeTreeArray(codeMap, codeMap[code].children, codeTreeArray, newcodeTrail, showColors);\n    }\n  }\n};\n\nconst parentData = (codeMap, code) => {\n  // get array of parents from highest to lowers (tree)\n  // look at parents to see if one is not active (activeParent).\n  //    (this only matters if the same parent is folded, otherwise only the parent code itself is inactive)\n  // look if there are folded parents, and if so pick the highest (foldToParent)\n  const parents = [];\n  let activeParent = true;\n  let foldToParent = \"\";\n\n  let parent = codeMap[code].parent;\n  while (parent) {\n    parents.push(parent);\n    if (codeMap[parent].folded != null && codeMap[parent].folded) {\n      foldToParent = parent; // this ends up being the highest level folded parent\n\n      // code is inactive if only one of the folded parents is inactive\n      if (codeMap[parent].active != null && !codeMap[parent].active) activeParent = false;\n    }\n    parent = codeMap[parent].parent;\n  }\n  return [parents.reverse(), activeParent, foldToParent];\n};\n\nexport const ctaToText = (cta, indentSpaces = 2, paramOffset = 25) => {\n  let txt = \"\";\n  let line;\n  for (let code of cta) {\n    line = \"\";\n    line += Array(1 + code.level * indentSpaces).join(\" \");\n    line += code.code;\n\n    const addSpace = paramOffset - line.length;\n    if (addSpace > 0) line += Array(addSpace).join(\" \");\n    line += ` #color(${code.color})`;\n    if (!code.active) line += \" #disabled\";\n    if (code.folded) line += \" #folded\";\n    if (code.makes_irrelevant && code.makes_irrelevant.length > 0)\n      line += ` #irrelevant(${code.makes_irrelevant.join(\",\")})`;\n    txt += line + \"\\n\";\n  }\n  return txt;\n};\n\nexport const textToCodes = (text, root, codes) => {\n  const codeMap = codes.reduce((obj, code) => {\n    if (typeof code === \"object\") {\n      obj[code.code] = 1;\n      obj[code.parent] = 1;\n    } else obj[code] = 1;\n    return obj;\n  }, {});\n  const duplicates = [];\n  const updatedCodes = [...codes];\n  const parentLevel = {};\n  const lines = text.split(\"\\n\");\n  for (let line of lines) {\n    const spaces = line.search(/\\S/);\n\n    let newCode = line;\n    for (let flag of [\"color\", \"disabled\", \"folded\", \"irrelevant\"]) {\n      newCode = newCode.split(`#${flag}`)[0].trim();\n    }\n    if (newCode === \"\") continue;\n    if (codeMap[newCode]) duplicates.push(newCode);\n    codeMap[newCode] = 1;\n\n    const newCodeObj = {\n      code: newCode,\n      parent: findParent(parentLevel, root, newCode, spaces),\n      active: !line.includes(\"#disabled\"),\n      folded: line.includes(\"#folded\"),\n    };\n\n    if (line.includes(\"#irrelevant\")) {\n      const irrelevantString = line.split(\"#irrelevant(\")[1].split(\")\")[0];\n      newCodeObj.makes_irrelevant = irrelevantString.split(\",\");\n    }\n    if (line.includes(\"#color\")) {\n      let color = line.split(\"#color(\")[1].split(\")\")[0];\n      newCodeObj.color = standardizeColor(color);\n    }\n    updatedCodes.push(newCodeObj);\n  }\n  return [updatedCodes, duplicates];\n};\n\nconst findParent = (parentLevel, code, newCode, spaces) => {\n  // also updates parentLevel\n  let parent = code;\n  for (let pspaces of Object.keys(parentLevel)) {\n    pspaces = Number(pspaces);\n    if (spaces > pspaces) {\n      parent = parentLevel[pspaces];\n    } else {\n      delete parentLevel[pspaces];\n      parentLevel[spaces] = newCode;\n    }\n  }\n  parentLevel[spaces] = newCode;\n  return parent;\n};\n\nconst standardizeColor = (str) => {\n  if (!str) return \"#FFFFFF\";\n  // https://stackoverflow.com/questions/1573053/javascript-function-to-convert-color-names-to-hex-codes\n  const ctx = document.createElement(\"canvas\").getContext(\"2d\");\n  ctx.fillStyle = str.trim();\n  const color = ctx.fillStyle; // make lighter\n  return color;\n};\n","export const blockEvents = (block) => {\n  return {\n    type: \"BLOCK_EVENTS\",\n    block,\n  };\n};\n\nexport const setFullScreenNode = (node) => {\n  return {\n    type: \"SET_FULL_SCREEN_NODE\",\n    node,\n  };\n};\n","import React, { useEffect, useState } from \"react\";\nimport { useDispatch } from \"react-redux\";\nimport { blockEvents } from \"actions\";\nimport { textToCodes } from \"util/codebook\";\nimport { Button, ButtonGroup, Dropdown, Form, Input, Popup, TextArea } from \"semantic-ui-react\";\n\nconst EditCodePopup = ({ codeMap, code, codes, setCodes, toggleActiveCode, setChangeColor }) => {\n  const dispatch = useDispatch();\n  const [open, setOpen] = useState(false);\n  const [popupContent, setPopupContent] = useState(null);\n\n  useEffect(() => {\n    dispatch(blockEvents(open));\n    return () => {\n      dispatch(blockEvents(false));\n    };\n  }, [dispatch, open]);\n\n  const buttonStyle = {\n    padding: \"0\",\n    margin: \"0\",\n    width: \"15px\",\n    borderRadius: \"0\",\n    minHeight: \"10px\",\n  };\n\n  const buttonContent = () => {\n    if (code === \"\")\n      return (\n        <ButtonGroup fluid color=\"black\">\n          <Button content=\"Add codes\" onClick={() => addCodePopup(true)} style={buttonStyle} />;\n        </ButtonGroup>\n      );\n    return (\n      <ButtonGroup color=\"black\" attached fluid size=\"mini\" style={{ padding: \"0\", margin: \"0\" }}>\n        <Button\n          size=\"mini\"\n          icon={code.active && code.activeParent ? \"toggle on\" : \"toggle off\"}\n          onClick={() => toggleActiveCode(codes, code.code, !code.active, setCodes)}\n          style={{ ...buttonStyle, color: code.active && code.activeParent ? \"green\" : \"red\" }}\n        />\n        {changeColorPopup()}\n\n        <Button\n          icon=\"plus\"\n          compact\n          size=\"mini\"\n          onClick={() => addCodePopup(false)}\n          style={buttonStyle}\n        />\n        <Button icon=\"minus\" compact size=\"mini\" onClick={rmCodePopup} style={buttonStyle} />\n        <Button icon=\"edit\" compact size=\"mini\" onClick={moveCodePopup} style={buttonStyle} />\n\n        <Button\n          icon=\"arrow up\"\n          compact\n          size=\"mini\"\n          onClick={() => changePosition(\"up\")}\n          style={buttonStyle}\n        />\n        <Button\n          icon=\"arrow down\"\n          compact\n          size=\"mini\"\n          onClick={() => changePosition(\"down\")}\n          style={buttonStyle}\n        />\n      </ButtonGroup>\n    );\n  };\n\n  const changeColorPopup = () => {\n    if (!code.code && code.active == null) return null;\n\n    return (\n      <Button\n        size=\"mini\"\n        as={\"Input\"}\n        style={{\n          ...buttonStyle,\n          padding: \"10px 0px\",\n          background: code.color || \"white\",\n        }}\n        onInput={(e) => setChangeColor({ code: code.code, color: e.target.value })}\n        type=\"color\"\n        value={code.color || \"white\"}\n      />\n    );\n  };\n\n  const addCodePopup = (root) => {\n    setPopupContent(\n      <AddCodePopup\n        codeMap={codeMap}\n        code={root ? \"\" : code.code}\n        codes={codes}\n        setCodes={setCodes}\n        setOpen={setOpen}\n      />\n    );\n    setOpen(true);\n  };\n\n  const rmCodePopup = () => {\n    setPopupContent(\n      <RmCodePopup\n        codeMap={codeMap}\n        code={code.code}\n        codes={codes}\n        setCodes={setCodes}\n        setOpen={setOpen}\n      />\n    );\n    setOpen(true);\n  };\n\n  const moveCodePopup = () => {\n    setPopupContent(\n      <MoveCodePopup\n        codeMap={codeMap}\n        code={code.code}\n        codes={codes}\n        setCodes={setCodes}\n        setOpen={setOpen}\n      />\n    );\n    setOpen(true);\n  };\n\n  const changePosition = (direction) => {\n    movePosition(codes, code, direction, setCodes);\n    setOpen(false);\n  };\n\n  return (\n    <Popup\n      inverted\n      size=\"mini\"\n      flowing\n      hoverable\n      mouseLeaveDelay={99999999}\n      open={open}\n      onClose={() => setOpen(false)}\n      trigger={buttonContent()}\n      style={{ padding: \"0\", margin: \"0\" }}\n    >\n      {popupContent}\n    </Popup>\n  );\n};\n\nconst movePosition = (codes, code, direction, setCodes) => {\n  const a = codes.findIndex((c) => c.code === code.code); // position of selected code\n  let b = null; // position of switchSibling\n\n  const codeParent = codes[a].parent;\n  for (let i = 0; i < codes.length; i++) {\n    if (i === a) continue;\n    if (codes[i].parent !== codeParent) continue;\n\n    if (direction === \"down\") {\n      if (i > a && (b === null || b > i)) b = i;\n    }\n    if (direction === \"up\") {\n      if (i < a && (b === null || b < i)) b = i;\n    }\n  }\n  if (b === null) return null;\n\n  const newCodes = [...codes];\n  const temp = newCodes[a];\n  newCodes[a] = newCodes[b];\n  newCodes[b] = temp;\n\n  setCodes(newCodes);\n};\n\nconst AddCodePopup = ({ codeMap, code, codes, setCodes, setOpen }) => {\n  const [alreadyExists, setAlreadyExists] = useState([]);\n  const [textInput, setTextInput] = useState(\"\");\n\n  const addCode = (text) => {\n    if (text === \"\") return null;\n    const [updatedCodes, duplicates] = textToCodes(text, code, codes);\n    if (duplicates.length > 0) {\n      setAlreadyExists(duplicates);\n      return null;\n    }\n    setCodes(updatedCodes);\n    setOpen(false);\n  };\n\n  return (\n    <div style={{ margin: \"1em\", height: \"200px\" }}>\n      <p>\n        {code === \"\" ? (\n          \"Create new codes\"\n        ) : (\n          <>\n            Add codes under <b>{code}</b>\n          </>\n        )}\n        <Button floated=\"right\" compact size=\"mini\" icon=\"delete\" onClick={() => setOpen(false)} />\n      </p>\n      <Form onSubmit={() => addCode(textInput)}>\n        <Popup\n          open={alreadyExists.length > 0}\n          trigger={\n            <TextArea\n              autoFocus\n              onChange={(e, d) => {\n                setTextInput(d.value);\n                setAlreadyExists([]);\n              }}\n              value={textInput}\n              style={{ height: \"130px\" }}\n              placeholder=\"Every line becomes a new code\"\n            />\n          }\n        >\n          Duplicate labels: <br />\n          <b>{alreadyExists.join(\", \")}</b>\n        </Popup>\n        <Button fluid content=\"Create\" onClick={() => addCode(textInput)} />\n      </Form>\n    </div>\n  );\n};\n\nconst RmCodePopup = ({ codeMap, code, codes, setCodes, setOpen }) => {\n  const rmCode = (keepChildren) => {\n    let updatedCodes = codes.filter((ucode) => ucode.code !== code);\n\n    const children = [];\n    if (!keepChildren) {\n      getAllChildren(codeMap, code, children);\n      updatedCodes = updatedCodes.filter((ucode) => !children.includes(ucode.code));\n    } else {\n      updatedCodes = updatedCodes.map((ucode) => {\n        if (codeMap[code].children.includes(ucode.code)) ucode.parent = codeMap[code].parent;\n        return ucode;\n      });\n    }\n\n    //const removeCodes = [code, ...children];\n\n    setCodes(updatedCodes);\n    setOpen(false);\n  };\n\n  return (\n    <div style={{ margin: \"1em\" }}>\n      <p>\n        Delete <b>{code}</b>?\n      </p>\n      <ButtonGroup fluid>\n        {codeMap[code].children.length > 0 ? (\n          <>\n            <Button color=\"red\" onClick={() => rmCode(false)}>\n              Yes\n            </Button>\n            <Button color=\"red\" onClick={() => rmCode(true)}>\n              Yes, but keep children\n            </Button>\n          </>\n        ) : (\n          <Button color=\"red\" onClick={() => rmCode(true)}>\n            Yes\n          </Button>\n        )}\n        <Button onClick={() => setOpen(false)}>Cancel</Button>\n      </ButtonGroup>\n    </div>\n  );\n};\n\nconst MoveCodePopup = ({ codeMap, code, codes, setCodes, setOpen }) => {\n  const [newParent, setNewParent] = useState(codeMap[code].parent);\n  const [textInput, setTextInput] = useState(code);\n\n  const parentOptions = [\"ROOT\", ...getAllParentOptions(codeMap, code)]; // fills parents array\n\n  const mvCode = (newCode, newParent) => {\n    if (newCode !== code) {\n      if (newCode === \"\") return null;\n      if (codeMap[newCode]) return null;\n    }\n    let codeIsNew = true; // if code was only a parent, it isn't yet in the edgelist\n    let updatedCodes = codes.map((ucode) => {\n      if (ucode.code === code) {\n        ucode.code = newCode;\n        ucode.parent = newParent;\n        codeIsNew = false;\n      }\n      if (ucode.parent === code) {\n        ucode.parent = newCode;\n      }\n      return ucode;\n    });\n    if (codeIsNew) codes.push({ code: newCode, parent: newParent, active: true });\n    codes = codes.filter((code) => code.parent !== \"ROOT\");\n\n    setCodes(updatedCodes);\n    setOpen(false);\n  };\n\n  return (\n    <div style={{ margin: \"1em\" }}>\n      <p>\n        Change parent and/or label\n        <Button floated=\"right\" compact size=\"mini\" icon=\"delete\" onClick={() => setOpen(false)} />\n      </p>\n\n      <Form onSubmit={() => mvCode(textInput, newParent)}>\n        <Form.Field inline>\n          <label style={{ color: \"white\" }}>Parent:</label>\n          <Dropdown\n            value={newParent}\n            style={{ minWidth: \"10em\" }}\n            options={parentOptions.map((parent, i) => {\n              return {\n                key: parent,\n                value: parent,\n                text: parent,\n              };\n            })}\n            search\n            selectOnNavigation={false}\n            minCharacters={0}\n            autoComplete={\"on\"}\n            onChange={(e, d) => {\n              setNewParent(d.value);\n            }}\n          />\n        </Form.Field>\n        <Form.Field inline>\n          <label style={{ color: \"white\" }}>Code:</label>\n          <Input\n            autoFocus\n            onChange={(e, d) => {\n              setTextInput(d.value);\n            }}\n            value={textInput}\n            placeholder=\"new code\"\n          />\n        </Form.Field>\n        <Button fluid onClick={() => mvCode(textInput, newParent)}>\n          Change\n        </Button>\n      </Form>\n    </div>\n  );\n};\n\nconst getAllChildren = (codeMap, code, children) => {\n  for (const child of codeMap[code].children) {\n    children.push(child);\n    getAllChildren(codeMap, child, children);\n  }\n};\n\nconst getAllParentOptions = (codeMap, code) => {\n  const children = [];\n  getAllChildren(codeMap, code, children);\n  return Object.keys(codeMap).filter((parent) => !children.includes(parent) && parent !== code);\n};\n\nexport default EditCodePopup;\n","import React, { useEffect, useState } from \"react\";\nimport { Button, Icon, Table, Popup, Modal, TextArea, Dropdown } from \"semantic-ui-react\";\nimport { codeBookEdgesToMap, getCodeTreeArray } from \"util/codebook\";\nimport EditCodePopup from \"./EditCodePopup\";\nimport { textToCodes, ctaToText } from \"util/codebook\";\nimport Help from \"./Help\";\nimport { blockEvents } from \"actions\";\nimport { useDispatch } from \"react-redux\";\n\n// NOTE TO SELF: make toggle on/off and edit optional. Toggle on/off makes sense for\n// imported annotations. Edit for making a codebook\n// problem: how to deal with renaming existing codes. (maybe just freeze used codes from editing)\n\n/**\n * Display an editable codebook\n * @param {Array} codes an array of strings, or an array of objects with at least the key 'code'\n * @param {Function} setCodes the callback for setting codes state\n * @param {Array} questions Optional, an array with questions. This enables the 'makes irrelevant' column\n */\nconst CodesEditor = ({ codes, setCodes, questions, height = \"100%\" }) => {\n  const [codeMap, setCodeMap] = useState({});\n  const [codeTreeArray, setCodeTreeArray] = useState([]);\n  const [changeColor, setChangeColor] = useState(null);\n\n  const showColors = true;\n\n  useEffect(() => {\n    if (!codes || codes.length === 0) {\n      setCodeTreeArray([]);\n      return;\n    }\n    const cm = codeBookEdgesToMap(codes);\n    setCodeMap(cm);\n    setCodeTreeArray(getCodeTreeArray(cm, showColors));\n  }, [codes, setCodeTreeArray, setCodeMap, showColors]);\n\n  useEffect(() => {\n    const timer = setTimeout(() => {\n      if (changeColor) {\n        changeCodeColor(changeColor.code, changeColor.color, codes, setCodes);\n      }\n      setChangeColor(null);\n    }, 500);\n    return () => clearTimeout(timer);\n  }, [codes, setCodes, changeColor, setChangeColor]);\n\n  const formatCode = (code) => {\n    const color = code.active == null || code.active ? \"black\" : \"grey\";\n    if (code.level === 0) return { fontWeight: \"bold\", fontSize: \"15px\", color };\n    if (code.level === 1) return { fontSize: \"12px\", color };\n    if (code.level === 2) return { fontSize: \"12px\", color };\n    return { fontSize: \"10px\", color };\n  };\n\n  const onChangeMakesIrrelevant = (code, value) => {\n    const newCodes = [...codes];\n    newCodes.find((nc) => nc.code === code).makes_irrelevant = value;\n    setCodes(newCodes);\n  };\n\n  return (\n    <div>\n      <Table\n        singleLine\n        columns={3}\n        unstackable\n        textAlign=\"left\"\n        style={{ border: \"0\", boxShadow: \"0\", width: \"100%\" }}\n      >\n        <Table.Header className=\"codes-thead\"></Table.Header>\n        <Table.Body\n          style={{ height: height, margin: \"0\", overflow: \"visible\" }}\n          className=\"codes-tbody\"\n        >\n          <Table.Row className=\"codes-tr\">\n            <Table.HeaderCell textAlign=\"center\">\n              <Icon name=\"settings\" />\n            </Table.HeaderCell>\n            <Table.HeaderCell style={{ position: \"relative\", paddingLeft: \"0.5em\" }}>\n              Codebook\n            </Table.HeaderCell>\n            <Table.HeaderCell style={{ textAlign: \"right\" }}>\n              {makesIrrelevantHeader(questions)}\n            </Table.HeaderCell>\n          </Table.Row>\n          {[...codeTreeArray].map((code, i) => {\n            if (code.foldToParent) return null;\n\n            return (\n              <Table.Row className=\"codes-tr\" key={i} style={{}}>\n                <Table.Cell\n                  className=\"codes-td\"\n                  width={1}\n                  style={{\n                    border: \"1px solid black\",\n                    padding: \"0\",\n                    margin: \"0\",\n                    background: \"#1B1C1D\",\n\n                    borderRight: code.active == null ? null : \"1px solid black\",\n                  }}\n                >\n                  <EditCodePopup\n                    codeMap={codeMap}\n                    code={code}\n                    codes={codes}\n                    setCodes={setCodes}\n                    toggleActiveCode={toggleActiveCode}\n                    setChangeColor={setChangeColor}\n                  />\n                </Table.Cell>\n\n                <Table.Cell\n                  className=\"codes-td\"\n                  style={{\n                    paddingLeft: \"0.5em\",\n                    borderTop: code.level === 0 ? \"1px solid black\" : null,\n                    //borderBottom: code.level === 0 ? \"1px solid black\" : null,\n                  }}\n                >\n                  <span style={{ ...formatCode(code), marginLeft: `${1 * code.level}em` }}>\n                    {code.code}\n                    {code.totalChildren === 0 || code.active == null ? null : (\n                      <>\n                        <Icon\n                          style={{\n                            padding: \"0\",\n                            margin: \"0\",\n                            marginLeft: \"1em\",\n                            cursor: \"pointer\",\n                          }}\n                          onClick={() =>\n                            toggleFoldCode(\n                              codes,\n                              code.code,\n                              code.folded != null && code.folded,\n                              setCodes\n                            )\n                          }\n                          name={code.folded ? \"caret right\" : \"dropdown\"}\n                        />\n                        {!code.folded ? null : (\n                          <span\n                            style={{ color: \"grey\" }}\n                          >{`${code.totalActiveChildren}/${code.totalChildren}`}</span>\n                        )}\n                      </>\n                    )}\n                  </span>\n                </Table.Cell>\n                <Table.Cell\n                  className=\"codes-td\"\n                  style={{\n                    textAlign: \"right\",\n                    paddingLeft: \"0.5em\",\n                    borderTop: code.level === 0 ? \"1px solid black\" : null,\n                    //borderBottom: code.level === 0 ? \"1px solid black\" : null,\n                  }}\n                >\n                  {makesIrrelevantDropdown(questions, code, onChangeMakesIrrelevant)}\n                </Table.Cell>\n              </Table.Row>\n            );\n          })}\n          <EditCodePopup\n            codeMap={codeMap}\n            code={\"\"}\n            codes={codes}\n            setCodes={setCodes}\n            setChangeColor={setChangeColor}\n          >\n            <Icon name=\"cog\" style={{ marginLeft: \"0.7em\", cursor: \"pointer\" }} />\n          </EditCodePopup>\n          <PlainTextEditor codes={codes} codeTreeArray={codeTreeArray} setCodes={setCodes} />\n        </Table.Body>\n      </Table>\n    </div>\n  );\n};\n\nconst makesIrrelevantHeader = (questions) => {\n  if (!questions) return null;\n\n  return (\n    <>\n      Makes irrelevant\n      <Help\n        header=\"Make other questions conditional on this answer\"\n        texts={[\n          `Certain answers can make other questions irrelevant. \n           For example, you might first ask if a text is relevant (for your study). \n           If it isn't, you don't need your coder to waste time answering the remaining questions.\n           In this case, you can set \"makes irrelevant\" to \"remaining\". All remaning questions in the current\n           unit will then be annotated with the value IRRELEVANT`,\n          `You can also let an answer make specific other questions irrelevant. \n           This way you can implement simple branching patterns, where certain follow-up questions\n           are only asked if certain conditions are met.`,\n          `NOTE that specific other questions are referenced by the question number,\n            so be careful if you change the order of questions.`,\n        ]}\n      />\n    </>\n  );\n};\n\nconst makesIrrelevantDropdown = (questions, code, onChange) => {\n  if (!questions) return null;\n\n  return (\n    <Dropdown\n      multiple\n      header=\"Make which questions irrelevant?\"\n      direction=\"right\"\n      options={makesIrrelevantOptions(questions, code)}\n      value={code.makes_irrelevant}\n      renderLabel={renderMakesIrrelevantLabel}\n      onChange={(e, d) => {\n        let values = d.value;\n        //if (values.includes(\"remaining\")) values = [\"remaining\"];\n        onChange(code.code, values);\n      }}\n      style={{ paddingRight: \"0\" }}\n    />\n  );\n};\n\nconst makesIrrelevantOptions = (questions, code) => {\n  const options = [\n    {\n      key: \"remaining\",\n      text: \"remaining\",\n      value: \"remaining\",\n      description: \"All questions after the current\",\n    },\n  ];\n\n  // if 'all' is selected, don't show the other options\n  //if (code.makes_irrelevant.includes(\"remaining\")) return options;\n  const n = questions.length || 5;\n  for (let i = 0; i < n; i++)\n    options.push({\n      key: i + 1,\n      text: i + 1,\n      value: `${i}`, // question index starts at 0, only present i+1 to outside\n      description: `Q${i + 1} (${questions[i].name})`,\n    });\n\n  return options;\n};\n\nconst renderMakesIrrelevantLabel = (label) => ({\n  content: label.text,\n  style: { fontSize: \"12px\", padding: \"0\", background: \"white\", border: \"0\", boxShadow: \"none\" },\n});\n\nconst PlainTextEditor = ({ codes, codeTreeArray, setCodes }) => {\n  const dispatch = useDispatch();\n  const [open, setOpen] = useState(false);\n  const [textInput, setTextInput] = useState(\"\");\n  const [alreadyExists, setAlreadyExists] = useState([]);\n\n  useEffect(() => {\n    dispatch(blockEvents(open));\n    return () => {\n      dispatch(blockEvents(false));\n    };\n  }, [dispatch, open]);\n\n  useEffect(() => {\n    setTextInput(ctaToText(codeTreeArray, 2, 40));\n  }, [codeTreeArray]);\n\n  const onSave = () => {\n    const [updatedCodes, duplicates] = textToCodes(textInput, \"\", []);\n    if (duplicates.length > 0) {\n      setAlreadyExists(duplicates);\n      return null;\n    }\n    setCodes(updatedCodes);\n    setOpen(false);\n  };\n\n  return (\n    <Modal\n      on=\"click\"\n      open={open}\n      style={{ width: \"700px\", maxWidth: \"100%\", overflowX: \"auto\", padding: \"0.3em\" }}\n      trigger={\n        <Button\n          fluid\n          onClick={() => setOpen(true)}\n          style={{ padding: \"0.3em 1em\", borderRadius: \"0\" }}\n        >\n          Plain text editor\n        </Button>\n      }\n    >\n      <Popup\n        open={alreadyExists.length > 0}\n        trigger={\n          <TextArea\n            autoFocus\n            rows={20}\n            onChange={(e, d) => {\n              setTextInput(d.value);\n            }}\n            value={textInput}\n            style={{ fontFamily: \"monospace\", height: \"100%\", width: \"100%\" }}\n            placeholder=\"Every line is a code\\n\\nindent codes to make a tree, like\\nparent\\n  child\\n    grandchild\\n\\nAdd colors with:\\ncode   #color(red)\"\n          />\n        }\n      >\n        Duplicate labels: <br />\n        <b>{alreadyExists.join(\", \")}</b>\n      </Popup>\n\n      <Modal.Actions>\n        <Button color=\"black\" onClick={() => setOpen(false)}>\n          Cancel\n        </Button>\n        <Button content=\"Save changes\" onClick={onSave} positive />\n      </Modal.Actions>\n    </Modal>\n  );\n};\n\nconst changeCodeColor = (code, color, codes, setCodes) => {\n  let updatedCodes = codes.map((ucode) => {\n    if (ucode.code === code) ucode.color = color;\n    return ucode;\n  });\n  setCodes(updatedCodes);\n};\n\nconst toggleActiveCode = (codes, code, active, setCodes) => {\n  let updatedCodes = [...codes];\n\n  const selectedCode = updatedCodes.find((ucode) => ucode.code === code);\n\n  // there is a possibility that code.code does not exist, if it only existed as a parent\n  // this is ideally resolved upstream (when creating the codebook), but as a plan B it can be added here\n  if (selectedCode) {\n    selectedCode.active = active;\n  } else updatedCodes.push({ code: code, parent: \"\", active: true });\n\n  setCodes(updatedCodes);\n};\n\nconst toggleFoldCode = (codes, code, folded, setCodes) => {\n  let updatedCodes = [...codes];\n\n  const selectedCode = updatedCodes.find((ucode) => ucode.code === code);\n\n  // there is a possibility that code.code does not exist, if it only existed as a parent\n  // this is ideally resolved upstream (when creating the codebook), but as a plan B it can be added here\n  if (selectedCode) {\n    selectedCode.folded = !folded;\n  } else updatedCodes.push({ code: code, parent: \"\", active: true, folded: !folded });\n\n  setCodes(updatedCodes);\n};\n\nexport default CodesEditor;\n","import React, { useEffect, useState } from \"react\";\nimport {\n  Icon,\n  Form,\n  Radio,\n  Checkbox,\n  Input,\n  Dropdown,\n  Popup,\n  Button,\n  Grid,\n} from \"semantic-ui-react\";\nimport Help from \"./Help\";\nimport CodesEditor from \"./CodesEditor\";\nimport db from \"apis/dexie\";\n\nconst defaultUnitSettings = {\n  textUnit: null, // document, paragraph, sentence or span (span only if codingUnit is annotations)\n  unitSelection: \"allTextUnits\", // or: annotations\n  contextUnit: \"document\", // or: paragraph, sentence, no context\n  contextWindow: [1, 1],\n\n  n: null,\n  seed: 42,\n  ordered: false,\n  balanceDocuments: true,\n  balanceAnnotations: true,\n  validCodes: null,\n  highlightAnnotation: false,\n};\n\nconst UnitSettings = ({ codingjob }) => {\n  const unitSettings = codingjob?.unitSettings || defaultUnitSettings;\n  const setUnitSettings = (us) => {\n    db.setCodingjobProp(codingjob, \"unitSettings\", us);\n  };\n\n  if (!unitSettings) return null;\n  return (\n    <div style={{ verticalAlign: \"top\", float: \"top\", paddingLeft: \"1em\" }}>\n      <Grid style={{ paddingTop: \"1em\" }}>\n        <Grid.Column width={8}>\n          <CodingUnitForm unitSettings={unitSettings} setUnitSettings={setUnitSettings} />\n        </Grid.Column>\n        <Grid.Column width={8}>\n          <ContextUnitForm unitSettings={unitSettings} setUnitSettings={setUnitSettings} />\n        </Grid.Column>\n      </Grid>\n      <br />\n      <br />\n      <SampleForm unitSettings={unitSettings} setUnitSettings={setUnitSettings} />\n      <br />\n      <br />\n      <SelectValidCodes codingjob={codingjob} />\n    </div>\n  );\n};\n\nconst CodingUnitForm = ({ unitSettings, setUnitSettings }) => {\n  useEffect(() => {\n    if (unitSettings?.textUnit === null)\n      setUnitSettings({\n        ...unitSettings,\n        textUnit: \"document\",\n        value: \"allTextUnits\",\n        n: null,\n        totalUnits: null,\n      });\n  }, [unitSettings, setUnitSettings]);\n\n  const radioButton = (value, label, annotated, jump) => {\n    const unitSelection = annotated ? \"annotation\" : \"allTextUnits\";\n    let checked = unitSettings.textUnit === value && unitSettings.unitSelection === unitSelection;\n\n    return (\n      <Form.Field>\n        <Radio\n          value={value}\n          label={label}\n          checked={checked}\n          onChange={(e, d) =>\n            setUnitSettings({\n              ...unitSettings,\n              textUnit: value,\n              unitSelection: unitSelection,\n              n: null,\n              totalUnits: null,\n            })\n          }\n          style={{ marginLeft: jump ? \"1em\" : \"0em\" }}\n        />\n      </Form.Field>\n    );\n  };\n\n  return (\n    <Form>\n      <Form.Group>\n        <Icon name=\"setting\" />\n        <label>Coding unit</label>\n      </Form.Group>\n      <Form.Group grouped widths=\"equal\">\n        {radioButton(\"document\", \"Document\", false)}\n        {radioButton(\"paragraph\", \"Paragraph\", false)}\n        {radioButton(\"sentence\", \"Sentence\", false)}\n        {radioButton(\"span\", \"Span annotation\", true)}\n        {radioButton(\"document\", \"incl. document\", true, true)}\n        {radioButton(\"paragraph\", \"incl.  paragraph\", true, true)}\n        {radioButton(\"sentence\", \"incl.  sentence\", true, true)}\n      </Form.Group>\n    </Form>\n  );\n};\n\nconst ContextUnitForm = ({ unitSettings, setUnitSettings }) => {\n  const setContextWindow = (value) => {\n    setUnitSettings({\n      ...unitSettings,\n      contextWindow: value,\n    });\n  };\n\n  const radioButton = (value, label) => {\n    return (\n      <Form.Field>\n        <Radio\n          value={value}\n          label={label}\n          disabled={unitSettings.textUnit === \"document\"}\n          checked={unitSettings.contextUnit === value}\n          onChange={(e, d) =>\n            setUnitSettings({\n              ...unitSettings,\n              contextUnit: value,\n            })\n          }\n        />\n        {\"  \"}\n        {(value === \"paragraph\" || value === \"sentence\") && value === unitSettings.contextUnit ? (\n          <ContextWindow\n            contextUnit={unitSettings.contextUnit}\n            contextWindow={unitSettings.contextWindow}\n            setContextWindow={setContextWindow}\n          />\n        ) : null}\n      </Form.Field>\n    );\n  };\n\n  return (\n    <Form>\n      <Form.Group>\n        <Icon name=\"setting\" />\n        <label>Context unit</label>\n      </Form.Group>\n      <Form.Group grouped widths=\"equal\">\n        {radioButton(\"document\", \"Document\")}\n        {radioButton(\"paragraph\", \"Paragraph\")}\n        {radioButton(\"sentence\", \"Sentence\")}\n        {radioButton(\"none\", \"No context\")}\n      </Form.Group>\n    </Form>\n  );\n};\n\nconst SampleForm = React.memo(({ unitSettings, setUnitSettings }) => {\n  const [delayed, setDelayed] = useState(null); // delayed unitSettings\n  const [pct, setPct] = useState(100);\n  const totalUnits = unitSettings.totalUnits || 0;\n\n  useEffect(() => {\n    setPct(Math.round((100 * unitSettings.n) / totalUnits));\n    setDelayed(unitSettings);\n  }, [totalUnits, unitSettings, setDelayed]);\n\n  useEffect(() => {\n    if (delayed === unitSettings) return null;\n    const timer = setTimeout(() => {\n      setUnitSettings(delayed);\n    }, 300);\n    return () => clearTimeout(timer);\n  }, [delayed, unitSettings, setUnitSettings]);\n\n  const setWithoutDelay = (field, value) => {\n    setUnitSettings({ ...unitSettings, [field]: value });\n  };\n\n  // const onChangeMix = (e, d) => {\n  //   setDelayed((current) => ({ ...current, annotationMix: Number(d.value) }));\n  // };\n\n  const onChangeSeed = (e, d) => {\n    setDelayed((current) => ({ ...current, seed: Number(d.value) }));\n  };\n\n  const onChangeShuffle = (e, d) => {\n    setWithoutDelay(\"ordered\", !d.checked);\n  };\n\n  const onChangeBalanceDoc = (e, d) => {\n    setWithoutDelay(\"balanceDocuments\", d.checked);\n  };\n  const onChangeBalanceAnn = (e, d) => {\n    setWithoutDelay(\"balanceAnnotations\", d.checked);\n  };\n\n  const onChangeN = (e, d) => {\n    let value = Number(d.value);\n    //value = value > n ? Math.min(totalUnits, value + 4) : Math.max(0, value - 4);\n    setPct(Math.round((100 * value) / totalUnits));\n    setDelayed((current) => ({ ...current, n: value }));\n  };\n\n  const onChangePCT = (e, d) => {\n    let value = Number(d.value);\n    //value = value > pct ? Math.min(100, value + 4) : Math.max(0, value - 4);\n    let valueN = Math.ceil((value / 100) * totalUnits);\n    if (valueN >= 0) {\n      setPct(value);\n      setDelayed((current) => ({ ...current, n: valueN }));\n    }\n  };\n\n  if (delayed === null) return null;\n\n  return (\n    <Form>\n      <Form.Group>\n        <Icon name=\"setting\" />\n        <div>\n          <label>Sample settings</label>\n          <Help\n            header={\"Sampling and shuffling\"}\n            texts={[\n              \"If % < 100, a random sample will be drawn.\",\n              \"If shuffle is enabled, the order of the units will be randomized.\",\n              \"Seed initializes the random number generator. Simply put, using the same seed gives the same 'random' results if the data is the same.\",\n            ]}\n          />\n        </div>\n\n        {/* <Help header={\"test\"} texts={[\"test\", \"this\"]} /> */}\n      </Form.Group>\n\n      <Form.Group>\n        <Form.Field\n          width={8}\n          min={1}\n          max={totalUnits}\n          label=\"N\"\n          size=\"mini\"\n          control={Input}\n          type=\"number\"\n          value={delayed.n}\n          onChange={onChangeN}\n        />\n        <Form.Field\n          width={8}\n          min={0}\n          step={5}\n          max={100}\n          label=\"%\"\n          size=\"mini\"\n          control={Input}\n          type=\"number\"\n          value={pct}\n          onChange={onChangePCT}\n        />\n      </Form.Group>\n\n      <Form.Group>\n        <Form.Field width={8}>\n          <label>Shuffle</label>\n          <Checkbox toggle size=\"mini\" checked={!unitSettings.ordered} onChange={onChangeShuffle} />\n        </Form.Field>\n\n        <Form.Field width={8}>\n          <label>Seed</label>\n          <Input size=\"mini\" type=\"number\" min={1} value={delayed.seed} onChange={onChangeSeed} />\n        </Form.Field>\n      </Form.Group>\n\n      <Form.Group grouped widths=\"equal\">\n        <Form.Field>\n          <b>Balance</b>\n          <Help\n            header={\"Balanced sampling\"}\n            texts={[\n              \"Balance sampled Units evenly over groups. Uses a simple approach where unique groups are created (documents, codes, or documentsXcodes), and samples are drawn from these groups one by one\",\n              \"For documents: get an equal number of paragraphs, sentences or annotations per document\",\n              \"For codes: if units are annotations, get an equal number annotations for each unique code. (You can toggle which codes to include in the codebook, see top-right corner)\",\n            ]}\n          />\n        </Form.Field>\n        <Form.Field>\n          <Checkbox\n            size=\"mini\"\n            label=\"documents\"\n            checked={unitSettings.balanceDocuments}\n            onChange={onChangeBalanceDoc}\n          />\n        </Form.Field>\n        <Form.Field>\n          <Checkbox\n            disabled={unitSettings.unitSelection !== \"annotations\"}\n            size=\"mini\"\n            label=\"codes\"\n            checked={unitSettings.balanceAnnotations}\n            onChange={onChangeBalanceAnn}\n          />\n        </Form.Field>\n      </Form.Group>\n      <br />\n    </Form>\n  );\n});\n\n// at some point maybe implement document filters\n// like min paragraph and max tokens and such\n//\n// const DocumentFilters = () => {\n//   const onChangeUseMinUnitIndex = (e, d) => {\n//     setWithoutDelay(\"useMinUnitIndex\", d.checked);\n//   };\n//   const onChangeUseMaxUnitIndex = (e, d) => {\n//     setWithoutDelay(\"useMaxUnitIndex\", d.checked);\n//   };\n//   const onChangeMinUnitIndex = (e, d) => {\n//     let value = Number(d.value);\n//     setDelayed((current) => ({ ...current, minUnitIndex: value }));\n//   };\n//   const onChangeMaxUnitIndex = (e, d) => {\n//     let value = Number(d.value);\n//     setDelayed((current) => ({ ...current, maxUnitIndex: value }));\n//   };\n\n//   return (\n//     <Form>\n//       <Form.Group>\n//         <Form.Field width={8}>\n//           <label>Maximum {unitSettings.textUnit}</label>\n\n//           <Input\n//             width={5}\n//             min={0}\n//             label={\n//               <Checkbox\n//                 toggle\n//                 style={{ width: \"6em\" }}\n//                 disabled={unitSettings.textUnit === \"document\"}\n//                 checked={unitSettings.useMaxUnitIndex}\n//                 onChange={onChangeUseMaxUnitIndex}\n//               />\n//             }\n//             size=\"mini\"\n//             type=\"number\"\n//             value={unitSettings.maxUnitIndex}\n//             onChange={onChangeMaxUnitIndex}\n//           ></Input>\n//         </Form.Field>\n//       </Form.Group>\n//     </Form>\n//   );\n// };\n\nconst ContextWindow = ({ contextUnit, contextWindow, setContextWindow }) => {\n  if (contextUnit === \"document\") return null;\n\n  return (\n    <Popup\n      hoverable\n      trigger={\n        <Button\n          style={{\n            padding: \"0em 0.2em 0em 0.2em\",\n            background: \"white\",\n            border: \"1px solid\",\n          }}\n        >{`${contextWindow[0]} - ${contextWindow[1]}`}</Button>\n      }\n    >\n      <Dropdown.Menu>\n        <Dropdown.Header content={`Set ${contextUnit} window`} />\n        <Grid style={{ paddingTop: \"1em\", width: \"20em\" }}>\n          <Grid.Column width={8}>\n            <Input\n              size=\"mini\"\n              value={contextWindow[0]}\n              type=\"number\"\n              style={{ width: \"6em\" }}\n              label={\"before\"}\n              onChange={(e, d) => setContextWindow([Number(d.value), contextWindow[1]])}\n            />\n          </Grid.Column>\n          <Grid.Column width={5}>\n            <Input\n              size=\"mini\"\n              value={contextWindow[1]}\n              type=\"number\"\n              labelPosition=\"right\"\n              style={{ width: \"6em\" }}\n              label={\"after\"}\n              onChange={(e, d) => setContextWindow([contextWindow[0], Number(d.value)])}\n            />\n          </Grid.Column>\n        </Grid>\n      </Dropdown.Menu>\n    </Popup>\n  );\n};\n\nconst SelectValidCodes = ({ codingjob }) => {\n  if (!codingjob?.unitSettings) return null;\n  if (!codingjob.unitSettings.totalUnits) return null;\n  if (codingjob.unitSettings.textUnit !== \"span\") return null;\n\n  const unitSettings = codingjob.unitSettings;\n  // const setUnitSettings = (us) => {\n  //   db.setCodingjobProp(codingjob, \"unitSettings\", us);\n  // };\n\n  if (!unitSettings) return null;\n  return (\n    <Form>\n      <Form.Group>\n        <Icon name=\"setting\" />\n        <div>\n          <label>Manage annotation codes</label>\n          <Help\n            header={\"Annotation codes\"}\n            texts={[\n              \"Click on the gear icon to add, remove, move, rename and change the colors of codes\",\n              \"You can also toggle codes off if you just want to disable them in the current unit selection\",\n            ]}\n          />\n        </div>\n      </Form.Group>\n      <CodesEditor codingjob={codingjob} height=\"40%\" />\n    </Form>\n  );\n};\n\nexport default React.memo(UnitSettings);\n","/**\n *\n * @param {*} arr An array of objects that each has a .ref key\n * @param {*} selected\n */\nexport const moveUp = (arr, selected) => {\n  // given an array of refs for buttons (or any divs), and the current selected button,\n  // move to most overlapping button on previous row\n  // (basically, what you want to happen when you press 'up' in a grid of buttons)\n  const currentPos = getPosition(arr[selected].ref);\n  let correctRow = null;\n  let prevColOverlap = 0;\n  for (let i = selected - 1; i >= 0; i--) {\n    if (arr[i].ref == null || arr[i].ref.current === null) return i + 1;\n    const nextPos = getPosition(arr[i].ref);\n\n    if (correctRow === null) {\n      if (sameRow(currentPos, nextPos)) continue;\n      correctRow = nextPos; // set correct row once we reach a button on the next row\n    } else {\n      if (!sameRow(correctRow, nextPos)) return i + 1;\n    }\n\n    const colOverlap = calcColOverlap(currentPos, nextPos);\n    //if (colOverlap > 0.5) return i;\n    if (prevColOverlap > 0 && colOverlap < prevColOverlap) return i + 1;\n    if (currentPos.left > nextPos.right) return i;\n\n    prevColOverlap = colOverlap;\n  }\n\n  return 0;\n};\n\n/**\n *\n * @param {*} arr An array of objects that each has a .ref key\n * @param {*} selected\n */\nexport const moveDown = (arr, selected) => {\n  // like moveUp, but down\n  const currentPos = getPosition(arr[selected].ref);\n  let correctRow = null;\n  let prevColOverlap = 0;\n  for (let i = selected + 1; i < arr.length; i++) {\n    if (arr[i].ref == null || arr[i].ref.current === null) return i - 1;\n\n    const nextPos = getPosition(arr[i].ref);\n\n    if (correctRow === null) {\n      if (sameRow(currentPos, nextPos)) continue;\n      correctRow = nextPos; // set correct row once we reach a button on the next row\n    } else {\n      if (!sameRow(correctRow, nextPos)) return i - 1;\n    }\n\n    const colOverlap = calcColOverlap(currentPos, nextPos);\n    //if (colOverlap > 0.5) return i;\n    if (prevColOverlap > 0 && colOverlap < prevColOverlap) return i - 1;\n    if (currentPos.right < nextPos.left) return i;\n    prevColOverlap = colOverlap;\n  }\n\n  return arr.length - 1;\n};\n\nconst sameRow = (a, b) => {\n  // we can't just check if y positions are the same, because they fool around a bit\n  // so instead we look at how much buttons overlap on the y axis\n\n  const lowestTop = Math.max(a.top, b.top); // lowest top of two buttons on screen\n  const highestBottom = Math.min(a.bottom, b.bottom); // highest bottom of two buttons on screen\n\n  const overlap = highestBottom - lowestTop;\n  // if buttons overlap more than 50% of height of box a, say they overlap\n  // (really, boxes on the same row will overlap > 99%, so this is very safe)\n  return overlap > 0.5 * a.height;\n};\n\nconst calcColOverlap = (a, b) => {\n  const rightestLeft = Math.max(a.left, b.left);\n  const leftestRight = Math.min(a.right, b.right);\n\n  const pctA = (leftestRight - rightestLeft) / a.width;\n  const pctB = (leftestRight - rightestLeft) / b.width;\n  return Math.max(pctA, pctB);\n};\n\nconst getPosition = ref => {\n  if (!ref) return null;\n  return ref.current.getBoundingClientRect();\n};\n","import React, { useEffect, useState, useRef } from \"react\";\nimport { keepInView } from \"util/scroll\";\nimport { moveUp, moveDown } from \"util/refNavigation\";\n\n// This component generates no content, but manages navigation for span level annotations\n\nconst arrowkeys = [\"ArrowRight\", \"ArrowLeft\", \"ArrowUp\", \"ArrowDown\"];\n\n/**\n * This is a hugely elaborate component for managing navigation (key, mouse and touch events)\n * It doesn't acctually render anything, but its shaped as a component because useEffect is just really convenient here\n * You probably never want to read this. And if you do, don't expect my sympathies. Rather, just blame me\n * if anything in here breaks, or ask nicely if we need more features\n */\nconst AnnotationEvents = ({\n  tokens,\n  currentToken,\n  setCurrentToken,\n  tokenSelection,\n  setTokenSelection,\n  triggerCodePopup,\n  eventsBlocked,\n}) => {\n  // !! Keep in mind that positions are based on token.arrayIndex, not token.index\n  // arrayIndex is the actual tokens array, where token.index is the position of the token in the document\n  // (these can be different if the text/context does not start at token.index 0)\n\n  const [mover, setMover] = useState(null);\n  const [HoldSpace, setHoldSpace] = useState(false);\n  const [holdArrow, setHoldArrow] = useState(null);\n\n  useEffect(() => {\n    if (eventsBlocked) {\n      setHoldArrow(false);\n      setHoldSpace(false);\n    } else {\n      setTokenSelection([]);\n    }\n  }, [setHoldArrow, setHoldSpace, eventsBlocked, setTokenSelection]);\n\n  useEffect(() => {\n    // When arrow key is held, walk through tokens with increasing speed\n    // this loops itself by updating mover (an object with position information)\n    // this is like setIntervall, but allows custom time intervalls,\n    if (!mover || !holdArrow) return;\n\n    let position = movePosition(\n      tokens,\n      holdArrow,\n      mover,\n      HoldSpace,\n      setCurrentToken,\n      setTokenSelection\n    );\n\n    let delay = Math.max(5, 100 / Math.ceil(mover.counter / 5));\n    if (mover.counter === 1) delay = 150;\n    setTimeout(() => {\n      setMover({\n        position: position,\n        startposition: mover.startposition,\n        ntokens: mover.ntokens,\n        counter: mover.counter + 1,\n      });\n    }, delay);\n  }, [tokens, mover, holdArrow, HoldSpace, setCurrentToken, setTokenSelection]);\n\n  if (!tokens) return null;\n\n  // this prevents rendering the components that manage the key and mouse events\n  if (eventsBlocked) return null;\n\n  return (\n    <>\n      <KeyEvents\n        tokenSelection={tokenSelection}\n        currentToken={currentToken}\n        tokens={tokens}\n        HoldSpace={HoldSpace}\n        setMover={setMover}\n        setHoldSpace={setHoldSpace}\n        setHoldArrow={setHoldArrow}\n        triggerCodePopup={triggerCodePopup}\n      />\n      <MouseEvents\n        tokenSelection={tokenSelection}\n        tokens={tokens}\n        setCurrentToken={setCurrentToken}\n        setTokenSelection={setTokenSelection}\n        triggerCodePopup={triggerCodePopup}\n      />\n    </>\n  );\n};\n\nconst KeyEvents = ({\n  tokenSelection,\n  currentToken,\n  tokens,\n  HoldSpace,\n  setMover,\n  setHoldSpace,\n  setHoldArrow,\n  triggerCodePopup,\n}) => {\n  // This blocks event listeners when the eventsBlocked state (in redux) is true.\n  // This lets us block the key activities in the text (selecting tokens) when\n  // the CodeSelector popup is open\n  useEffect(() => {\n    window.addEventListener(\"keydown\", onKeyDown);\n    window.addEventListener(\"keyup\", onKeyUp);\n    return () => {\n      window.removeEventListener(\"keydown\", onKeyDown);\n      window.removeEventListener(\"keyup\", onKeyUp);\n    };\n  });\n\n  // (see useEffect with 'eventsBlocked' for details on useCallback)\n  const onKeyUp = (event) => {\n    // keep track of which buttons are pressed in the state\n    if (event.keyCode === 32 && HoldSpace) {\n      setHoldSpace(false);\n      if (tokenSelection.length > 0) {\n        annotationFromSelection(tokens, tokenSelection, triggerCodePopup);\n      }\n      return;\n    }\n    if (arrowkeys.includes(event.key)) {\n      setHoldArrow(false);\n      setMover(null);\n    }\n  };\n\n  // (see useEffect with 'eventsBlocked' for details on useCallback)\n  const onKeyDown = (event) => {\n    // key presses, and key holding (see onKeyUp)\n    if (event.keyCode === 32) {\n      event.preventDefault();\n      if (event.repeat) return;\n      setHoldSpace(true);\n      return;\n    }\n    if (arrowkeys.includes(event.key)) {\n      event.preventDefault();\n      if (event.repeat) return;\n      setMover({\n        position: currentToken,\n        startposition: currentToken,\n        ntokens: tokens.length,\n        counter: 1,\n      });\n      setHoldArrow(event.key);\n    }\n\n    // if (tokenSelection.length > 0) {\n    //   if (tokenSelection[0] === tokenSelection[1]) {\n    //     // enter key\n    //     if (event.keyCode === 13) {\n    //       triggerCodePopup(tokens[tokenSelection[0]].index, null, null);\n    //     }\n    //   }\n    // }\n  };\n\n  return <></>;\n};\n\nconst MouseEvents = ({\n  tokenSelection,\n  tokens,\n  setCurrentToken,\n  setTokenSelection,\n  triggerCodePopup,\n}) => {\n  const selectionStarted = useRef(false);\n  const tapped = useRef(null);\n  const istouch = useRef(\n    \"ontouchstart\" in window || navigator.maxTouchPoints > 0 || navigator.msMaxTouchPoints > 0\n  ); // hack to notice if device uses touch (because single touch somehow triggers mouseup)\n\n  useEffect(() => {\n    window.addEventListener(\"mousedown\", onMouseDown);\n    window.addEventListener(\"mousemove\", onMouseMove);\n    window.addEventListener(\"mouseup\", onMouseUp);\n    window.addEventListener(\"touchstart\", onTouchDown);\n    window.addEventListener(\"contextmenu\", onContextMenu);\n    return () => {\n      window.removeEventListener(\"mousedown\", onMouseDown);\n      window.removeEventListener(\"mousemove\", onMouseMove);\n      window.removeEventListener(\"mouseup\", onMouseUp);\n      window.removeEventListener(\"touchstart\", onTouchDown);\n      window.removeEventListener(\"contextmenu\", onContextMenu);\n    };\n  });\n\n  const onTouchDown = (event) => {\n    const token = getToken(tokens, event);\n    if (token?.index === null) {\n      tapped.current = null;\n      setTokenSelection((state) => (state.length === 0 ? state : []));\n      return;\n    }\n\n    // first check if there is a tokenselection (after double tab). If so, this completes the selection\n    if (tokenSelection.length > 0 && tokenSelection[0] === tapped.current) {\n      // if a single token, and an annotation already exists, open create/edit mode\n      const currentNode = storeMouseSelection(event);\n      setTokenSelection((state) => updateSelection(state, tokens, currentNode, true));\n\n      if (token?.annotated && currentNode === tokenSelection[0]) {\n        annotationFromSelection(tokens, [currentNode, currentNode], triggerCodePopup);\n      } else {\n        annotationFromSelection(tokens, [tokenSelection[0], currentNode], triggerCodePopup);\n      }\n      tapped.current = null;\n      return;\n    }\n\n    // otherwise, handle the double tab (on the same token) for starting the selection\n    if (tapped.current !== token.index) {\n      tapped.current = token.index;\n      setTokenSelection((state) => (state.length === 0 ? state : []));\n    } else {\n      setTokenSelection((state) => updateSelection(state, tokens, token.index, true));\n    }\n  };\n\n  const onMouseDown = (event) => {\n    if (istouch.current) return; // suppress mousedown triggered by quick tap\n    // When left button pressed, start new selection\n    if (event.which === 1) {\n      selectionStarted.current = true;\n      setTokenSelection((state) => (state.length === 0 ? state : []));\n    }\n  };\n\n  const onMouseMove = (event) => {\n    if (istouch.current) return;\n    // When selection started (mousedown), select tokens hovered over\n    if (selectionStarted.current) {\n      event.preventDefault();\n      if (event.which !== 1 && event.which !== 0) return null;\n\n      window.getSelection().empty();\n      storeMouseSelection(event);\n    } else {\n      let currentNode = getToken(tokens, event);\n      if (currentNode.index !== null) {\n        setCurrentToken((state) => (state === currentNode.index ? state : currentNode.index));\n        setTokenSelection((state) => updateSelection(state, tokens, currentNode.index, false));\n      } else setCurrentToken((state) => (state === currentNode.index ? state : currentNode.index));\n    }\n  };\n\n  const onMouseUp = (event) => {\n    if (istouch.current) return;\n    // When left mouse key is released, create the annotation\n    // note that in case of a single click, the token has not been selected (this happens on move)\n    // so this way a click can still be used to open\n    if (event.which !== 1 && event.which !== 0) return null;\n    const currentNode = storeMouseSelection(event);\n    window.getSelection().empty();\n    //setHoldMouseLeft(false);\n    selectionStarted.current = false;\n\n    // this worked before, but is not possible due to touchend not registering position\n    //if (currentNode === null) return null;\n\n    // storeMouseSelection does save position to tokenSelection state, but this isn't\n    // yet updated within this scope. This results in single clicks (without mousemove)\n    // not registering. So if there is no current selection, directly use currentNode as position.\n    if (tokenSelection.length > 0 && tokenSelection[0] !== null && tokenSelection[1] !== null) {\n      annotationFromSelection(tokens, tokenSelection, triggerCodePopup);\n    } else {\n      if (currentNode !== null) {\n        annotationFromSelection(\n          tokens,\n          [currentNode, currentNode],\n\n          triggerCodePopup\n        );\n      }\n    }\n  };\n\n  const onContextMenu = (event) => {\n    if (event.button === 2) return null;\n    event.preventDefault();\n    event.stopPropagation();\n  };\n\n  const storeMouseSelection = (event) => {\n    // select tokens that the mouse/touch is currently pointing at\n    let currentNode = getToken(tokens, event);\n    //if (currentNode == null || currentNode === null) return null;\n\n    setCurrentToken((state) => (state === currentNode.index ? state : currentNode.index));\n    setTokenSelection((state) => updateSelection(state, tokens, currentNode.index, true));\n    return currentNode.index;\n  };\n\n  return <></>;\n};\n\nconst annotationFromSelection = (tokens, selection, triggerCodePopup) => {\n  let [from, to] = selection;\n  if (from > to) [from, to] = [to, from];\n\n  const annotation = {\n    index: tokens[from].index,\n    length: tokens[to].length + tokens[to].offset - tokens[from].offset,\n    span: [tokens[from].index, tokens[to].index],\n    section: tokens[from].section,\n    offset: tokens[from].offset,\n  };\n  triggerCodePopup(tokens[to].index, annotation);\n};\n\nconst movePosition = (tokens, key, mover, space, setCurrentToken, setTokenSelection) => {\n  let newPosition = mover.position;\n  if (key === \"ArrowRight\") newPosition++;\n  if (key === \"ArrowLeft\") newPosition--;\n  if (key === \"ArrowUp\") newPosition = moveSentence(tokens, mover, \"up\");\n  if (key === \"ArrowDown\") newPosition = moveSentence(tokens, mover, \"down\");\n\n  if (newPosition > mover.ntokens) newPosition = mover.ntokens;\n  if (newPosition < 0) newPosition = 0;\n\n  if (tokens[newPosition]?.ref == null) {\n    if (key === \"ArrowRight\") {\n      const firstUnit = tokens.findIndex((token) => token.codingUnit);\n      if (firstUnit < 0) return mover.position;\n      newPosition = firstUnit;\n    }\n    if (key === \"ArrowLeft\") {\n      const firstAfterUnit = tokens.lastIndexOf((token) => token.codingUnit);\n      if (firstAfterUnit < 0) return mover.position;\n      newPosition = firstAfterUnit - 1;\n    }\n  }\n\n  if (space) {\n    // limit selection to current section\n    if (tokens[mover.position].section !== tokens[newPosition].section) {\n      if (newPosition > mover.position) {\n        for (let i = newPosition; i >= mover.position; i--)\n          if (tokens[i].section === tokens[mover.position].section) {\n            newPosition = i;\n            break;\n          }\n      } else {\n        for (let i = newPosition; i <= mover.position; i++) {\n          if (tokens[i].section === tokens[mover.position].section) {\n            newPosition = i;\n            break;\n          }\n        }\n      }\n    }\n  }\n\n  if (mover.position !== newPosition) {\n    setCurrentToken((state) => (state === newPosition ? state : newPosition));\n    setTokenSelection((state) => updateSelection(state, tokens, newPosition, space));\n    scrollTokenToMiddle(tokens[newPosition].ref.current);\n\n    // const down = key === \"ArrowRight\" || key === \"ArrowDown\";\n    // tokens[newPosition].ref.current.scrollIntoView(false, {\n    //   block: down ? \"start\" : \"end\",\n    // });\n  }\n  return newPosition;\n};\n\nconst moveSentence = (tokens, mover, direction = \"up\") => {\n  // moving sentences is a bit tricky, but we can do it via the refs to the\n  // token spans, that provide information about the x and y values\n\n  if (tokens[mover.position]?.ref == null || tokens[mover.startposition]?.ref == null) {\n    const firstUnit = tokens.findIndex((token) => token.codingUnit);\n    return firstUnit < 0 ? 0 : firstUnit;\n  }\n\n  if (direction === \"up\") {\n    return moveUp(tokens, mover.position);\n  }\n  if (direction === \"down\") {\n    return moveDown(tokens, mover.position);\n  }\n};\n\nconst getToken = (tokens, e) => {\n  const [n, annotated] = getNode(tokens, e);\n  if (n === null) return { index: null, annotated: false };\n  return { index: getTokenAttributes(tokens, n), annotated };\n};\n\nconst getNode = (tokens, e) => {\n  try {\n    // sometimes e is Restricted, and I have no clue why,\n    // nor how to check this in a condition. hence the try clause\n    let n;\n    if (e.type === \"mousemove\" || e.type === \"mouseup\") n = e.originalTarget || e.path[0];\n    if (e.type === \"touchmove\" || e.type === \"touchstart\") {\n      // stupid hack since someone decided touchmove target is always the starting target (weirdly inconsistent with mousemove)\n      // also, this still doesn't work for touchend, which is just arrrggg\n      let position = e.touches[0];\n      n = document.elementFromPoint(position.clientX, position.clientY);\n    }\n\n    if (n?.parentNode?.className === \"item\") {\n      return [null, false];\n    }\n\n    if (n) {\n      if (n.className.includes(\"token\")) {\n        return [n, false];\n      }\n      if (n.parentNode) {\n        if (n.parentNode.className.includes(\"token\")) return [n.parentNode, true];\n      }\n    }\n    return [null, false];\n  } catch (e) {\n    return [null, false];\n  }\n};\n\nconst getTokenAttributes = (tokens, tokenNode) => {\n  return parseInt(tokenNode.getAttribute(\"tokenindex\"));\n};\n\nconst scrollTokenToMiddle = (token) => {\n  // token->sentence->paragraph->paragraphFlexBox->section->textpart->box\n  // this should be stable, but it still looks terrible\n  const parentDiv = token.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode;\n  keepInView(parentDiv, token);\n};\n\nconst updateSelection = (selection, tokens, index, add) => {\n  if (index === null) return selection;\n  let newSelection = [...selection];\n\n  if (!add || newSelection.length === 0) return [index, index];\n  if (index === null) return [newSelection[0], null];\n\n  if (tokens[newSelection[0]].section === tokens[index].section) {\n    newSelection = [newSelection[0], index];\n  } else {\n    if (index > newSelection[0]) {\n      for (let i = index; i >= newSelection[0]; i--) {\n        if (tokens[newSelection[0]].section === tokens[i].section)\n          newSelection = [newSelection[0], i];\n      }\n    } else {\n      for (let i = index; i <= newSelection[0]; i++) {\n        if (tokens[newSelection[0]].section === tokens[i].section)\n          newSelection = [newSelection[0], i];\n      }\n    }\n  }\n  // if it hasn't changed, return old to prevent updating the state\n  if (\n    newSelection.length > 0 &&\n    selection[0] === newSelection[0] &&\n    selection[1] === newSelection[1]\n  ) {\n    return selection;\n  }\n  return newSelection;\n};\n\nexport default AnnotationEvents;\n","// custom scrollintoview\n\nexport const scrollToMiddle = (parent, child, position) => {\n  // scroll parent to position of child\n  // position should be value between 0 and 1 for relative position between top (0) and bottom (1)\n  const parentBounding = parent.getBoundingClientRect();\n  const clientBounding = child.getBoundingClientRect();\n\n  const parentTop = parentBounding.top;\n  const parentHeight = parentBounding.height;\n  const clientTop = clientBounding.top;\n  const topToCenter = parentHeight / (1 / position); // position 1/4 down from top\n\n  parent.scrollTop = parent.scrollTop + clientTop - (topToCenter + parentTop);\n};\n\nexport const keepInView = (parent, child) => {\n  // scroll parent to position of child\n  // position should be value between 0 and 1 for relative position between top (0) and bottom (1)\n\n  const parentBounding = parent.getBoundingClientRect();\n  const clientBounding = child.getBoundingClientRect();\n\n  const parentTop = parentBounding.top;\n  const parentHeight = parentBounding.height;\n  const clientTop = clientBounding.top;\n\n  const needUp = clientTop - parentTop < 50;\n  const needDown = clientTop > parentTop + parentHeight * 0.9;\n\n  //if (needUp > 0) parent.scrollTop = parent.scrollTop + needUp;\n  if (needDown) {\n    parent.scrollTop = parent.scrollTop + clientTop - (parentHeight * 0.9 + parentTop);\n  }\n  if (needUp) {\n    parent.scrollTop = parent.scrollTop + clientTop - (parentHeight * 0.1 + parentTop);\n  }\n};\n","export const getColor = (annotationCode, codeMap) => {\n  if (codeMap[annotationCode]) {\n    const foldTo = codeMap[annotationCode].foldToParent;\n    if (foldTo && codeMap[foldTo]) return codeMap[foldTo].color + \"50\";\n    return codeMap[annotationCode].color + \"50\";\n  } else {\n    return \"#ffffff50\";\n  }\n};\n\nexport const getColorGradient = (colors) => {\n  let color = null;\n\n  if (colors.length === 1) {\n    color = colors[0];\n  } else {\n    const pct = Math.floor(100 / colors.length);\n    const gradColors = colors.reduce((a, color, i) => {\n      if (i === 0) a.push(color + ` ${pct}%`);\n      if (i === colors.length - 1) a.push(color + ` ${100 - pct}%`);\n\n      if (i > 0 && i < colors.length - 1) {\n        a.push(color + ` ${pct * i}%`);\n        a.push(color + ` ${pct * (i + 1)}%`);\n      }\n      return a;\n    }, []);\n\n    color = `linear-gradient(to bottom, ${gradColors.join(\", \")})`;\n  }\n\n  return color;\n};\n","import React, { useState, useEffect } from \"react\";\nimport AnnotationEvents from \"./AnnotationEvents\";\nimport { Popup, List } from \"semantic-ui-react\";\nimport { getColor, getColorGradient } from \"util/tokenDesign\";\n\n/**\n * The NavigationEvents component handles all eventlisteners\n * AnnotateNavigation furthermore takes the position and selection information\n * from the navigation to highlight the tokens and show popups\n */\nconst AnnotateNavigation = ({\n  tokens,\n  variableMap,\n  annotations,\n  triggerCodePopup,\n  eventsBlocked,\n  fullScreenNode,\n  disableAnnotations,\n}) => {\n  const [currentToken, setCurrentToken] = useState(0);\n  const [tokenSelection, setTokenSelection] = useState([]);\n\n  useEffect(() => {\n    if (!variableMap) return null;\n    showAnnotations(tokens, annotations, variableMap);\n  }, [tokens, annotations, variableMap]);\n\n  useEffect(() => {\n    showSelection(tokens, tokenSelection);\n  }, [tokens, tokenSelection]);\n\n  return (\n    <>\n      <AnnotationPopup\n        tokens={tokens}\n        currentToken={currentToken}\n        annotations={annotations}\n        variableMap={variableMap}\n        fullScreenNode={fullScreenNode}\n      />\n      {disableAnnotations ? null : (\n        <AnnotationEvents\n          tokens={tokens}\n          currentToken={currentToken}\n          setCurrentToken={setCurrentToken}\n          tokenSelection={tokenSelection}\n          setTokenSelection={setTokenSelection}\n          triggerCodePopup={triggerCodePopup}\n          eventsBlocked={eventsBlocked}\n        />\n      )}\n    </>\n  );\n};\n\nconst showAnnotations = (tokens, annotations, variableMap) => {\n  console.log(variableMap);\n  for (let token of tokens) {\n    if (!token.ref?.current) continue;\n\n    let tokenAnnotations = allowedAnnotations(annotations?.[token.index], variableMap);\n\n    if (!tokenAnnotations || Object.keys(tokenAnnotations).length === 0) {\n      if (token.ref.current.classList.contains(\"annotated\")) {\n        token.ref.current.classList.remove(\"annotated\");\n        setTokenColor(token, null, null, null);\n      }\n      continue;\n    }\n    annotateToken(token, tokenAnnotations, variableMap);\n  }\n};\n\nconst allowedAnnotations = (annotations, variableMap) => {\n  if (!annotations) return null;\n\n  if (annotations && variableMap) {\n    annotations = { ...annotations };\n    for (let variable of Object.keys(annotations)) {\n      if (!variableMap[variable]) {\n        delete annotations[variable];\n        continue;\n      }\n      const codeMap = variableMap[variable].codeMap;\n      const code = annotations[variable].value;\n      if (!codeMap[code] || !codeMap[code].active || !codeMap[code].activeParent)\n        delete annotations[variable];\n    }\n  }\n  return annotations;\n};\n\nconst annotateToken = (token, annotations, variableMap) => {\n  // Set specific classes for nice css to show the start/end of codes\n  let nLeft = 0;\n  let nRight = 0;\n  const colors = { pre: [], text: [], post: [] };\n  for (let variable of Object.keys(variableMap)) {\n    if (!annotations[variable]) {\n      colors.text.push(\"#ffffff50\");\n      colors.pre.push(\"#ffffff50\");\n      colors.post.push(\"#ffffff50\");\n      continue;\n    }\n    const codeMap = variableMap[variable].codeMap;\n    const code = annotations[variable];\n    const color = getColor(code.value, codeMap);\n    colors.text.push(color);\n    if (code.span[0] === code.index) {\n      nLeft++;\n    } else colors.pre.push(color);\n    if (code.span[1] === code.index) {\n      nRight++;\n    } else colors.post.push(color);\n  }\n\n  const allLeft = nLeft === Object.values(annotations).length;\n  const allRight = nRight === Object.values(annotations).length;\n  const anyLeft = nLeft > 0;\n  const anyRight = nRight > 0;\n\n  const cl = token.ref.current.classList;\n  cl.add(\"annotated\");\n  allLeft ? cl.add(\"allLeft\") : cl.remove(\"allLeft\");\n  anyLeft & !allLeft ? cl.add(\"anyLeft\") : cl.remove(\"anyLeft\");\n  allRight ? cl.add(\"allRight\") : cl.remove(\"allRight\");\n  anyRight & !allRight ? cl.add(\"anyRight\") : cl.remove(\"anyRight\");\n\n  const textColor = getColorGradient(colors.text);\n  const preColor = allLeft ? \"white\" : getColorGradient(colors.pre);\n  const postColor = allRight ? \"white\" : getColorGradient(colors.post);\n  setTokenColor(token, preColor, textColor, postColor);\n  //setTokenLabels(token, [\"test\", \"this\"]);\n};\n\n// const setTokenLabels = (token, labels) => {\n//   token.ref.current.style.lineHeight = `${labels.length * 1}em`;\n//   token.ref.current.style.marginBottom = \"-1em\";\n// };\n\nconst setTokenColor = (token, pre, text, post) => {\n  const children = token.ref.current.children;\n  children[0].style.background = pre;\n  children[1].style.background = text;\n  children[2].style.background = post;\n};\n\nconst showSelection = (tokens, selection) => {\n  for (let token of tokens) {\n    if (!token.ref?.current) continue;\n    if (selection.length === 0 || selection[0] === null || selection[1] === null) {\n      token.ref.current.classList.remove(\"selected\");\n      continue;\n    }\n\n    let [from, to] = selection;\n    //if (to === null) return false;\n    if (from > to) [to, from] = [from, to];\n    let selected = token.arrayIndex >= from && token.arrayIndex <= to;\n    const cl = token.ref.current.classList;\n    if (selected && token.codingUnit) {\n      const left = from === token.arrayIndex;\n      const right = to === token.arrayIndex;\n      cl.add(\"selected\");\n      left ? cl.add(\"start\") : cl.remove(\"start\");\n      right ? cl.add(\"end\") : cl.remove(\"end\");\n    } else cl.remove(\"selected\");\n  }\n};\n\nconst AnnotationPopup = ({ tokens, currentToken, annotations, variableMap, fullScreenNode }) => {\n  if (!tokens?.[currentToken]?.ref) return null;\n  if (!annotations?.[tokens[currentToken].index]) return null;\n  if (!variableMap) return null;\n\n  const tokenAnnotations = annotations[tokens[currentToken].index];\n  const variables = Object.keys(tokenAnnotations);\n  const codes = variables.map((variable) => tokenAnnotations[variable].value);\n\n  return (\n    <Popup\n      mountNode={fullScreenNode || undefined}\n      context={tokens?.[currentToken]?.ref}\n      basic\n      hoverable={false}\n      position=\"top left\"\n      mouseLeaveDelay={1}\n      open={true}\n      style={{ margin: \"0\", padding: \"0\", border: \"1px solid\" }}\n    >\n      <List>\n        {variables.map((variable, i) => {\n          if (!variableMap[variable]) return null;\n          return (\n            <List.Item\n              key={i}\n              style={{\n                backgroundColor: getColor(codes[i], variableMap[variable].codeMap),\n                padding: \"0.3em\",\n              }}\n            >\n              <b>{variable}</b>\n              {\": \" + codes[i]}\n            </List.Item>\n          );\n        })}\n      </List>\n    </Popup>\n  );\n};\n\nexport default AnnotateNavigation;\n","import React, { useEffect, useRef, useState } from \"react\";\nimport { Ref } from \"semantic-ui-react\";\nimport { scrollToMiddle } from \"util/scroll\";\n\nimport \"components/Document/subcomponents/spanAnnotationsStyle.css\";\n\nconst Tokens = ({ tokens, centerVertical, setReady, height }) => {\n  const [text, setText] = useState({});\n  const containerRef = useRef(null);\n\n  useEffect(() => {\n    // immitates componentdidupdate to scroll to the textUnit after rendering tokens\n    const firstTextUnitToken = tokens.find((token) => token.codingUnit);\n    if (firstTextUnitToken?.ref?.current && containerRef.current) {\n      scrollToMiddle(containerRef.current, firstTextUnitToken.ref.current, 1 / 4);\n    }\n  });\n\n  useEffect(() => {\n    if (!tokens) return null;\n    setText(renderText(tokens));\n    if (setReady) setReady((current) => current + 1); // setReady is an optional property used to let parents know the text is ready.\n  }, [tokens, setReady]);\n\n  if (tokens === null) return null;\n\n  return (\n    <div\n      key=\"tokens\"\n      style={{\n        display: \"flex\",\n        alignItems: centerVertical ? \"center\" : null,\n        height: height,\n      }}\n    >\n      <Ref innerRef={containerRef}>\n        <div\n          style={{\n            flex: \"1 97%\",\n            width: \"100%\",\n            maxHeight: height,\n            overflowY: \"auto\",\n            textAlign: \"justify\",\n          }}\n        >\n          {/* <div style={{ height: \"10em\" }} /> */}\n          <div style={{ padding: \"20px\" }}>{text[\"text\"]}</div>\n          <div style={{ height: \"25px\" }} />\n        </div>\n      </Ref>\n    </div>\n  );\n};\n\nconst renderText = (tokens) => {\n  const text = { text: [] }; // yes, it would make sense to just make text an array, but for some reason React doesn't accept it\n  if (tokens.length === 0) return text;\n\n  let section = [];\n  let paragraph = [];\n  let sentence = [];\n  let codingUnit = tokens[0].codingUnit;\n  let section_name = tokens[0].section;\n  let paragraph_nr = tokens[0].paragraph;\n  let sentence_nr = tokens[0].sentence;\n\n  for (let i = 0; i < tokens.length; i++) {\n    tokens[i].arrayIndex = i;\n\n    if (tokens[i].sentence !== sentence_nr) {\n      if (sentence.length > 0) paragraph.push(renderSentence(i, sentence_nr, sentence));\n      sentence = [];\n    }\n    if (tokens[i].paragraph !== paragraph_nr) {\n      if (paragraph.length > 0) {\n        section.push(\n          renderParagraph(i, paragraph_nr, paragraph, tokens[i].paragraph !== paragraph_nr)\n        );\n      }\n      paragraph = [];\n    }\n\n    if (tokens[i].section !== section_name) {\n      if (section.length > 0)\n        text[\"text\"].push(renderSection(i + \"_\" + section_name, section, section_name));\n      section = [];\n    }\n\n    paragraph_nr = tokens[i].paragraph;\n    sentence_nr = tokens[i].sentence;\n    section_name = tokens[i].section;\n    codingUnit = tokens[i].codingUnit;\n\n    if (codingUnit) tokens[i].ref = React.createRef();\n    sentence.push(renderToken(tokens[i], codingUnit));\n  }\n\n  if (sentence.length > 0) paragraph.push(renderSentence(\"last\", sentence_nr, sentence));\n  if (paragraph.length > 0) section.push(renderParagraph(\"last\", paragraph_nr, paragraph, false));\n  if (section.length > 0)\n    text[\"text\"].push(renderSection(\"last_\" + section_name, section, section_name));\n  return text;\n};\n\nconst renderSection = (paragraph_nr, paragraphs, section) => {\n  const fontstyle = (paragraphs) => {\n    if (section === \"title\")\n      return (\n        <p style={{ fontSize: \"1.2em\", fontWeight: \"bold\" }} key={section + paragraph_nr}>\n          {paragraphs}\n        </p>\n      );\n    return paragraphs;\n  };\n\n  return (\n    // uses span behaving like p, because p is not allowed due to nested div (for Label)\n    <span className=\"section\" key={\"section\" + section}>\n      {fontstyle(paragraphs)}\n    </span>\n  );\n};\n\nconst renderParagraph = (position, paragraph_nr, sentences, end) => {\n  return (\n    // uses span behaving like p, because p is not allowed due to nested div (for Label)\n    <div style={{ display: \"flex\" }}>\n      {/* <div style={{ flex: \"1 2%\" }}>{paragraphAnnotateButton()}</div> */}\n      <span\n        key={\"par\" + paragraph_nr}\n        className=\"paragraph\"\n        style={{\n          flex: \"1 98%\",\n          paddingBottom: end ? \"1.5em\" : \"0em\",\n          display: \"table\",\n          paddingLeft: \"0.3em\",\n        }}\n      >\n        {sentences}\n      </span>\n    </div>\n  );\n};\n\nconst renderSentence = (position, sentence_nr, tokens) => {\n  return (\n    <span className=\"sentence\" key={\"sent\" + sentence_nr}>\n      {/* {sentenceAnnotateButton()} */}\n      {tokens}\n    </span>\n  );\n};\n\nconst renderToken = (token, codingUnit) => {\n  const style = codingUnit\n    ? { lineHeight: \"1.4em\", fontSize: \"1.5em\", position: \"relative\" }\n    : { color: \"#746363\", position: \"relative\" };\n\n  return (\n    <span\n      key={token.index}\n      ref={token.ref}\n      className={\"token\"}\n      tokenindex={token.arrayIndex}\n      style={style}\n    >\n      <span className=\"pre\">{token.pre}</span>\n      <span className=\"text\">{token.text}</span>\n      <span className=\"post\">{token.post}</span>\n      <div\n        className=\"variable\"\n        style={{ position: \"absolute\", top: \"-0.4em\", left: \"0\", fontSize: \"0.4em\" }}\n      ></div>\n    </span>\n  );\n};\n\nexport default React.memo(Tokens);\n","import React, { useState, useEffect, useRef } from \"react\";\nimport { Button, Dropdown, Grid, Popup, Ref } from \"semantic-ui-react\";\nimport { toggleSpanAnnotation } from \"util/annotations\";\nimport { codeBookEdgesToMap } from \"util/codebook\";\nimport { getColor } from \"util/tokenDesign\";\nimport { moveDown, moveUp } from \"util/refNavigation\";\n\nconst arrowKeys = [\"ArrowRight\", \"ArrowLeft\", \"ArrowUp\", \"ArrowDown\"];\n\nconst useCodeSelector = (\n  tokens,\n  variables,\n  selectedVariable,\n  annotations,\n  setAnnotations,\n  fullScreenNode\n) => {\n  const [open, setOpen] = useState(false);\n  const [selection, setSelection] = useState(null);\n  const [overwrites, setOverwrites] = useState([]);\n  const [variable, setVariable] = useState(null);\n  const [tokenRef, setTokenRef] = useState(null);\n  const [tokenAnnotations, setTokenAnnotations] = useState({});\n  const [codeHistory, setCodeHistory] = useState([]);\n\n  const [fullVariableMap, setFullVariableMap] = useState(null);\n  const [variableMap, setVariableMap] = useState(null);\n\n  useEffect(() => {\n    // creates fullVariableMap\n    if (!variables || variables.length === 0) return null;\n    const vm = {};\n    for (let variable of variables) {\n      let cm = codeBookEdgesToMap(variable.codes);\n      cm = Object.keys(cm).reduce((obj, key) => {\n        if (!cm[key].active || !cm[key].activeParent) return obj;\n        obj[key] = cm[key];\n        return obj;\n      }, {});\n      vm[variable.name] = { ...variable, codeMap: cm };\n    }\n    setFullVariableMap(vm);\n    setCodeHistory([]);\n  }, [variables, setFullVariableMap, setCodeHistory]);\n\n  useEffect(() => {\n    // creates the actually used variableMap from the fullVariableMap\n    // this lets us select specific variables without recreating full map\n    if (fullVariableMap === null) return;\n    if (selectedVariable === null || selectedVariable === \"ALL\") {\n      setVariableMap(fullVariableMap);\n      setVariable(null);\n    } else {\n      setVariableMap({ [selectedVariable]: fullVariableMap[selectedVariable] });\n      setVariable(selectedVariable);\n    }\n  }, [fullVariableMap, selectedVariable, setVariable, setVariableMap]);\n\n  useEffect(() => {\n    setOpen(false);\n  }, [tokens]);\n\n  useEffect(() => {\n    if (!open) setVariable(null);\n  }, [open]);\n\n  if (!variables) return [null, null, null, true];\n\n  const triggerFunction = (index, selection) => {\n    setTokenRef(tokens[index].ref);\n    setTokenAnnotations(annotations[index] || {});\n    setSelection(selection);\n    setOpen(true);\n  };\n\n  let popup = (\n    <CodeSelectorPopup\n      variable={variable}\n      fullScreenNode={fullScreenNode}\n      open={open}\n      setOpen={setOpen}\n      tokenRef={tokenRef}\n      overwrites={overwrites}\n    >\n      <SelectVariablePage // when editing existing annotation, choose which is the 'current' code to edit\n        variable={variable}\n        setVariable={setVariable}\n        setOverwrites={setOverwrites}\n        variableMap={variableMap}\n        annotations={annotations}\n        selection={selection}\n        setOpen={setOpen}\n        canBeNew={selection !== null} // if no selection is provided, can only edit existing codes\n      />\n\n      <NewCodePage // if current is known, select what the new code should be (or delete, or ignore)\n        variable={variable}\n        variableMap={variableMap}\n        overwrites={overwrites}\n        codeMap={variableMap?.[variable]?.codeMap}\n        settings={variableMap?.[variable]}\n        codeHistory={codeHistory}\n        annotations={tokenAnnotations}\n        setAnnotations={setAnnotations}\n        selection={selection}\n        setOpen={setOpen}\n        setCodeHistory={setCodeHistory}\n      />\n    </CodeSelectorPopup>\n  );\n  if (!variableMap || !tokens) popup = null;\n\n  return [popup, triggerFunction, variableMap, open];\n};\n\nconst CodeSelectorPopup = ({\n  children,\n  variable,\n  fullScreenNode,\n  open,\n  setOpen,\n  tokenRef,\n  overwrites,\n}) => {\n  const [hasOpened, setHasOpened] = useState(false);\n\n  const overwriteWarning = () => {\n    if (!variable || overwrites.length === 0) return;\n    let message =\n      overwrites.length === 1 ? `existing annotation` : `${overwrites.length} existing annotations`;\n    return (\n      <div style={{ margin: \"1em\", color: \"red\" }}>Warning: overwrites or deletes {message}</div>\n    );\n  };\n\n  return (\n    <Popup\n      mountNode={fullScreenNode || undefined}\n      context={tokenRef}\n      hoverable\n      open={open}\n      mouseLeaveDelay={10000000} // just don't use mouse leave\n      onOpen={() => setHasOpened(true)}\n      onClose={() => {\n        if (hasOpened) {\n          setOpen(false);\n        }\n      }}\n      style={{ padding: \"0px\" }}\n    >\n      <div\n        style={{\n          minWidth: \"12em\",\n          textAlign: \"center\",\n\n          background: \"#1B1C1D\",\n          color: \"white\",\n          border: \"1px solid\",\n        }}\n      >\n        {!variable ? (\n          <b>Select variable</b>\n        ) : (\n          <>\n            <b>{variable}</b>{\" \"}\n          </>\n        )}\n        <Button\n          compact\n          floated=\"right\"\n          icon=\"delete\"\n          size=\"mini\"\n          style={{ background: \"#80808000\", margin: \"0px\", color: \"white\" }}\n          onClick={() => {\n            setOpen(false);\n          }}\n        />\n      </div>\n      {overwriteWarning()}\n      <div style={{ margin: \"1em\", border: \"0px\" }}>{children}</div>\n    </Popup>\n  );\n};\n\nconst SelectVariablePage = ({\n  variable,\n  setVariable,\n  setOverwrites,\n  annotations,\n  selection,\n  canBeNew,\n  setOpen,\n  variableMap,\n}) => {\n  const setValue = (value) => {\n    const current = new Set();\n    for (let i = selection.span[0]; i <= selection.span[1]; i++) {\n      if (annotations?.[i]?.[value]) {\n        const annId = annotations?.[i]?.[value].span[0] + \"_\" + annotations?.[i]?.[value].value;\n        current.add(annId);\n      }\n    }\n\n    if (current.size > 0) {\n      setOverwrites(Array.from(current));\n    } else {\n      setOverwrites([]);\n    }\n    setVariable(value);\n  };\n\n  const getOptions = () => {\n    let variables = Object.keys(variableMap);\n    if (!canBeNew) variables = variables.filter((variable) => annotations[variable] != null);\n    return variables.map((variable) => ({ color: \"white\", label: variable, value: variable }));\n  };\n\n  if (variable) return null;\n\n  const options = getOptions();\n  if (options.length === 1) {\n    setValue(options[0].value);\n  }\n\n  return (\n    <div>\n      <ButtonSelection\n        key={\"currentCodePageButtons\"}\n        active={true}\n        canDelete={false}\n        settings={{ rowSize: 5 }}\n        options={options}\n        setOpen={setOpen}\n        callback={setValue}\n      />\n    </div>\n  );\n};\n\nconst NewCodePage = ({\n  variable,\n  variableMap,\n  codeHistory,\n  settings,\n  annotations,\n  setAnnotations,\n  selection,\n  overwrites,\n  setOpen,\n  setCodeHistory,\n}) => {\n  const textInputRef = useRef(null);\n  const [focusOnButtons, setFocusOnButtons] = useState(true);\n\n  const onKeydown = React.useCallback(\n    (event) => {\n      if (settings && !settings.searchBox) return null;\n      const focusOnTextInput = textInputRef?.current?.children[0] === document.activeElement;\n      if (!focusOnTextInput) setFocusOnButtons(true);\n      if (event.keyCode === 27) setOpen(false);\n      if (arrowKeys.includes(event.key)) return null;\n      if (event.keyCode <= 46 || event.keyCode >= 106) return null;\n      if (textInputRef.current) textInputRef.current.click();\n      setFocusOnButtons(false);\n    },\n    [textInputRef, setOpen, settings]\n  );\n\n  useEffect(() => {\n    window.addEventListener(\"keydown\", onKeydown);\n    return () => {\n      window.removeEventListener(\"keydown\", onKeydown);\n    };\n  });\n\n  const onButtonSelect = (value) => {\n    if (value === null) {\n      // value is null means delete, so in that case update annotations with current value (to toggle it off)\n      updateAnnotations(\n        annotations,\n        variable,\n        true,\n        value,\n        selection,\n        setAnnotations,\n        setOpen,\n        setCodeHistory\n      );\n    } else {\n      updateAnnotations(\n        annotations,\n        variable,\n        false,\n        value,\n        selection,\n        setAnnotations,\n        setOpen,\n        setCodeHistory\n      );\n    }\n  };\n\n  const getOptions = () => {\n    const buttonOptions = [];\n    const dropdownOptions = [];\n    const historyN = 5; // maybe make this a setting\n    const codeMap = variableMap?.[variable]?.codeMap;\n\n    for (let code of Object.keys(codeMap)) {\n      const singleSelection = selection === null || selection?.span[0] === selection?.span[1];\n      if (singleSelection && annotations[code]) continue;\n\n      if (settings && settings.buttonMode === \"all\")\n        buttonOptions.push({ key: code, label: code, value: code, color: getColor(code, codeMap) });\n\n      let tree = codeMap[code].tree.join(\" - \");\n      dropdownOptions.push({\n        key: code,\n        value: code,\n        text: code + \" \" + tree,\n        content: (\n          <>\n            {code}\n            <br />\n            <span style={{ color: \"grey\" }}>{tree}</span>\n          </>\n        ),\n      });\n    }\n\n    // use 'recent' mode if specified, or if settings are missing\n    if (!settings || settings.buttonMode === \"recent\") {\n      for (let code of codeHistory) {\n        if (buttonOptions.length > historyN) break;\n        buttonOptions.push({ key: code, label: code, value: code, color: getColor(code, codeMap) });\n      }\n    }\n    return [buttonOptions, dropdownOptions];\n  };\n\n  const buttonSelection = (options) => {\n    if (options.length === 0) return null;\n    return (\n      <ButtonSelection\n        key={\"newCodePageButtons\"}\n        active={focusOnButtons}\n        canDelete={overwrites.length > 0}\n        settings={settings}\n        options={options}\n        setOpen={setOpen}\n        callback={onButtonSelect}\n      />\n    );\n  };\n\n  const dropdownSelection = (options) => {\n    if (options.length === 0) return null;\n    const codeMap = variableMap?.[variable]?.codeMap;\n    if (!codeMap) return null;\n\n    // use searchBox if specified OR if settings are missing\n    if (settings && !settings.searchBox) return null;\n    return (\n      <>\n        <Grid>\n          <Grid.Column width={13} floated=\"left\">\n            <Ref innerRef={textInputRef}>\n              <Dropdown\n                fluid\n                placeholder={\"<type to search>\"}\n                style={{ minWidth: \"12em\" }}\n                options={Object.keys(codeMap).reduce((options, code) => {\n                  let tree = codeMap[code].tree.join(\" - \");\n                  //if (tree === \"\") tree = \"Root\";\n                  options.push({\n                    key: code,\n                    value: code,\n                    text: code + \" \" + tree,\n                    content: (\n                      <>\n                        {code}\n                        <br />\n                        <span style={{ color: \"grey\" }}>{tree}</span>\n                      </>\n                    ),\n                  });\n\n                  return options;\n                }, [])}\n                open={!focusOnButtons}\n                search\n                selection\n                compact\n                selectOnNavigation={false}\n                minCharacters={0}\n                autoComplete={\"on\"}\n                onClick={() => setFocusOnButtons(false)}\n                onSearchChange={(e, d) => {\n                  if (d.searchQuery === \"\") setFocusOnButtons(true);\n                }}\n                onClose={() => setFocusOnButtons(true)}\n                onChange={(e, d) => {\n                  if (codeMap[d.value])\n                    updateAnnotations(\n                      annotations,\n                      variable,\n                      false,\n                      d.value,\n                      selection,\n                      setAnnotations,\n                      setOpen,\n                      setCodeHistory\n                    );\n                }}\n              />\n            </Ref>\n          </Grid.Column>\n        </Grid>\n        <br />\n      </>\n    );\n  };\n\n  if (!variable) return null;\n\n  const [buttonOptions, dropdownOptions] = getOptions();\n\n  return (\n    <>\n      {dropdownSelection(dropdownOptions)}\n      {buttonSelection(buttonOptions)}\n    </>\n  );\n};\n\nconst ButtonSelection = ({ active, options, canDelete, settings, setOpen, callback }) => {\n  const [selected, setSelected] = useState(0);\n  const [allOptions, setAllOptions] = useState([]);\n\n  useEffect(() => {\n    let allOptions = [...options];\n    if (canDelete)\n      allOptions.push({ label: \"DELETE\", color: \"red\", value: null, textColor: \"white\" });\n    allOptions.push({ label: \"CANCEL\", color: \"grey\", value: \"CANCEL\", textColor: \"white\" });\n    for (let option of allOptions) option.ref = React.createRef();\n    setAllOptions(allOptions);\n  }, [options, canDelete, setAllOptions]);\n\n  const onKeydown = React.useCallback(\n    (event) => {\n      const nbuttons = allOptions.length;\n\n      // any arrowkey\n      if (arrowKeys.includes(event.key)) {\n        event.preventDefault();\n\n        if (event.key === \"ArrowRight\") {\n          if (selected < nbuttons - 1) setSelected(selected + 1);\n        }\n\n        if (event.key === \"ArrowDown\") {\n          setSelected(moveDown(allOptions, selected));\n        }\n\n        if (event.key === \"ArrowLeft\") {\n          if (selected > 0) setSelected(selected - 1);\n        }\n\n        if (event.key === \"ArrowUp\") {\n          setSelected(moveUp(allOptions, selected));\n        }\n\n        return;\n      }\n\n      // delete\n      if (event.keyCode === 46) callback(null);\n\n      // space or enter\n      if (event.keyCode === 32 || event.keyCode === 13) {\n        event.preventDefault();\n        event.stopPropagation();\n\n        let value = allOptions[selected].value;\n        if (value === \"CANCEL\") {\n          setOpen(false);\n        } else callback(value);\n      }\n    },\n    [selected, callback, allOptions, setOpen]\n  );\n\n  useEffect(() => {\n    if (active) {\n      window.addEventListener(\"keydown\", onKeydown);\n    } else {\n      window.removeEventListener(\"keydown\", onKeydown);\n    }\n    return () => {\n      window.removeEventListener(\"keydown\", onKeydown);\n    };\n  }, [active, onKeydown]);\n\n  const mapButtons = () => {\n    return allOptions.map((option, i) => {\n      return (\n        <Ref innerRef={option.ref}>\n          <Button\n            style={{\n              flex: `1 1 auto`,\n              backgroundColor: option.color,\n              color: option.textColor || \"black\",\n              border: \"3px solid\",\n              borderColor: i === selected ? \"black\" : \"lightgrey\",\n              margin: \"0\",\n            }}\n            key={option.label}\n            value={option.value}\n            compact\n            size=\"mini\"\n            //active={i === selected}\n            onMouseOver={() => setSelected(i)}\n            onClick={(e, d) => {\n              console.log(d.value);\n              if (d.value === \"CANCEL\") {\n                setOpen(false);\n              } else callback(d.value);\n            }}\n          >\n            {\" \" + option.label}\n          </Button>\n        </Ref>\n      );\n    });\n  };\n\n  return <div style={{ display: \"flex\", flexWrap: \"wrap\" }}>{mapButtons()}</div>;\n};\n\nconst updateAnnotations = (\n  annotations,\n  variable,\n  deleteCurrent,\n  value,\n  selection,\n  setAnnotations,\n  setOpen,\n  setCodeHistory\n) => {\n  if (!annotations) {\n    setOpen(false);\n    return null;\n  }\n\n  let rmAnnotation = { ...selection, variable };\n  if (deleteCurrent) {\n    setAnnotations((state) => toggleSpanAnnotation({ ...state }, rmAnnotation, true));\n    setOpen(false);\n    return null;\n  }\n\n  let newAnnotation = { ...selection, variable, value };\n  setAnnotations((state) => {\n    const newstate = toggleSpanAnnotation({ ...state }, rmAnnotation, true);\n    return toggleSpanAnnotation(newstate, newAnnotation, false);\n  });\n  setCodeHistory((state) => [value, ...state.filter((v) => v !== value)].slice(0, 5));\n  setOpen(false);\n};\n\nexport default useCodeSelector;\n","import { useState, useEffect } from \"react\";\nimport { prepareDocument } from \"util/createDocuments\";\nimport hash from \"object-hash\";\n\nconst useUnit = (unit, safetyCheck, returnTokens) => {\n  const [tokens, setTokens] = useState();\n  const [annotations, setAnnotations] = useState();\n\n  useEffect(() => {\n    if (!unit?.text && !unit.text_fields) return null;\n    const document = prepareDocument(unit);\n\n    safetyCheck.current = {\n      tokens: document.tokens,\n      annotationsChanged: false,\n      annotations: hash(document.annotations),\n    };\n    setTokens(document.tokens);\n    setAnnotations(document.annotations);\n    if (returnTokens) returnTokens(document.tokens);\n  }, [unit, returnTokens, safetyCheck]);\n\n  // if returnAnnotations is falsy (so not passed to Document), make setAnnotations\n  // falsy as well. This is used further down as a sign that annotations are disabled\n  return [tokens, annotations, setAnnotations];\n};\n\nexport default useUnit;\n","import React, { useEffect } from \"react\";\nimport { Button } from \"semantic-ui-react\";\n\nconst SelectVariable = ({ variables, variable, setVariable, height }) => {\n  let variableNames = [];\n  if (variables != null) {\n    variableNames = variables.map((v) => v.name);\n    variableNames.push(\"ALL\");\n  }\n\n  const onKeyDown = (e) => {\n    let move = 0;\n    if (e.keyCode === 9) {\n      e.preventDefault();\n      if (e.shiftKey) {\n        if (!e.repeat) {\n          move = -1;\n        }\n      } else {\n        if (!e.repeat) {\n          move = 1;\n        }\n      }\n    }\n\n    const currentIndex = variableNames.findIndex((name) => name === variable);\n    let newIndex = currentIndex + move;\n    if (newIndex > variableNames.length - 1) newIndex = 0;\n    if (newIndex < 0) newIndex = variableNames.length - 1;\n    setVariable(variableNames[newIndex]);\n  };\n\n  useEffect(() => {\n    window.addEventListener(\"keydown\", onKeyDown);\n    return () => {\n      window.removeEventListener(\"keydown\", onKeyDown);\n    };\n  });\n\n  if (!variables || variables.length === 1) return null;\n  const mapVariables = () => {\n    return variableNames.map((name) => {\n      return (\n        <Button\n          active={name === variable}\n          style={{ padding: \"0\" }}\n          onClick={() => setVariable(name)}\n        >\n          {name}\n        </Button>\n      );\n    });\n  };\n\n  if (variable === null) setVariable(variableNames[0]);\n\n  return (\n    <Button.Group fluid style={{ height }}>\n      {mapVariables()}\n    </Button.Group>\n  );\n};\n\nexport default SelectVariable;\n","import React, { useState, useEffect, useRef } from \"react\";\nimport AnnotateNavigation from \"./subcomponents/AnnotateNavigation\";\nimport Tokens from \"./subcomponents/Tokens\";\nimport useCodeSelector from \"./subcomponents/useCodeSelector\";\nimport { useSelector } from \"react-redux\";\nimport { exportSpanAnnotations } from \"util/annotations\";\nimport useUnit from \"./subcomponents/useUnit\";\nimport hash from \"object-hash\";\nimport SelectVariable from \"./subcomponents/SelectVariable\";\n\n/**\n * This is hopefully the only Component in this folder that you'll ever see. It should be fairly isolated\n * and easy to use, but behind the scenes it gets dark real fast.\n * @param {*} tokens An array with token objects, as created with importTokens or parseTokens\n * @param {*} codes    An array of codes, or an array of objects in which codes can have\n *                     more cool stuff (color, parent, tree). If not given, texts will be\n *                     shown, but users cannot make annotations.\n * @param {*} settings An object with settings. Currently supports:\n *                     - centerVertical: true/false      whether text is centered verticall\n *                     - buttonMode: \"all\"/\"recent\"      show all or only recent selected options as button\n *                     - rowSize: number                 number of buttons per row\n * @param {*} onChangeAnnotations An optional function for saving annotations.\n *                              If not given, users cannot make annotations\n * @param {*} returnTokens   An optional function for getting access to the tokens array\n * @param {*} setReady       A function for passing a boolean to the parent to indicate that the\n *                           text is ready (which is usefull if the parent wants to transition\n *                           to new texts nicely)\n * @param {*} blockEvents    boolean. If true, disable event listeners\n * @returns\n */\nconst Document = ({\n  unit,\n  variables, //codes,\n  settings,\n  onChangeAnnotations,\n  returnTokens,\n  setReady,\n  blockEvents,\n}) => {\n  const fullScreenNode = useSelector((state) => state.fullScreenNode);\n  const safetyCheck = useRef(null); // ensures only new annotations for the current unit are passed to onChangeAnnotations\n  const [variable, setVariable] = useState(null);\n\n  const [tokensReady, setTokensReady] = useState(0);\n  const [tokens, annotations, setAnnotations] = useUnit(unit, safetyCheck, returnTokens);\n  const [popup, triggerCodePopup, variableMap, codeSelectorOpen] = useCodeSelector(\n    tokens,\n    variables,\n    variable,\n    annotations,\n    setAnnotations,\n    fullScreenNode\n  );\n\n  useEffect(() => {\n    if (!annotations) return;\n\n    // check if same unit, to prevent annotations from spilling over due to race conditions\n    if (safetyCheck.current.tokens !== tokens) return;\n    // check if annotations changed since start.\n    if (!safetyCheck.current.annotationsChanged) {\n      if (safetyCheck.current.annotations === hash(annotations)) return;\n      safetyCheck.current.annotationsChanged = true;\n    }\n\n    onChangeAnnotations(exportSpanAnnotations(annotations, tokens));\n  }, [tokens, annotations, onChangeAnnotations]);\n\n  useEffect(() => {\n    if (setReady) setReady((current) => current + 1);\n    setAnnotations((state) => ({ ...state })); //trigger DOM update after token refs have been prepared\n  }, [tokensReady, setAnnotations, setReady]);\n\n  if (!tokens) return null;\n\n  return (\n    <>\n      <SelectVariable\n        variables={variables}\n        variable={variable}\n        setVariable={setVariable}\n        height={\"30px\"}\n      />\n      <Tokens\n        tokens={tokens}\n        centerVertical={settings.centerVertical}\n        setReady={setTokensReady}\n        height={variables && variables.length > 1 ? \"calc(100% - 30px)\" : \"100%\"}\n      />\n      <AnnotateNavigation\n        tokens={tokens}\n        variableMap={variableMap}\n        annotations={annotations}\n        triggerCodePopup={triggerCodePopup}\n        eventsBlocked={codeSelectorOpen || blockEvents}\n        fullScreenNode={fullScreenNode}\n        disableAnnotations={!onChangeAnnotations || !variableMap}\n      />\n\n      {popup || null}\n    </>\n  );\n};\n\nexport default React.memo(Document);\n","import seedrandom from \"seedrandom\";\n\nexport const drawRandom = (array, n, replace, seed, group) => {\n  const random = seedrandom(seed);\n\n  if (n == null || n === null) n = array.length;\n  if (!replace && n > array.length) n = array.length;\n  let index = [...Array(array.length).keys()];\n\n  let indices, ns;\n  if (group === null) {\n    indices = [index];\n    ns = [n];\n  } else {\n    indices = splitIndex(index, group);\n    ns = distributeN(indices, n);\n  }\n\n  let out = [];\n\n  for (let j = 0; j < indices.length; j++) {\n    if (replace) {\n      for (let i = 0; i < n; i++) {\n        out.push(indices[j][Math.floor(random() * indices[j].length)]);\n      }\n    } else {\n      indices[j] = getRandomSubarray(\n        indices[j],\n        ns[j] < indices[j].length ? ns[j] : indices[j].length,\n        random\n      );\n      for (let i of indices[j]) out.push(i);\n    }\n  }\n\n  return out.map((i) => array[i]);\n};\n\n//from: https://stackoverflow.com/questions/11935175/sampling-a-random-subset-from-an-array\nconst getRandomSubarray = (arr, size, random) => {\n  var shuffled = arr.slice(0),\n    i = arr.length,\n    min = i - size,\n    temp,\n    index;\n  while (i-- > min) {\n    index = Math.floor((i + 1) * random());\n    temp = shuffled[index];\n    shuffled[index] = shuffled[i];\n    shuffled[i] = temp;\n  }\n\n  return shuffled.slice(min);\n};\n\nconst splitIndex = (index, group) => {\n  // index and group must be of same length\n  const indices = [];\n  const groupOb = {};\n\n  for (let i = 0; i < index.length; i++) {\n    if (groupOb[group[i]] == null) {\n      groupOb[group[i]] = indices.length;\n      indices.push([]);\n    }\n    indices[groupOb[group[i]]].push(index[i]);\n  }\n  return indices;\n};\n\nconst distributeN = (indices, n) => {\n  const ns = new Array(indices.length).fill(0);\n  let full = new Array(indices.length).fill(0);\n  let remain = n;\n  let remainIndices = indices.length;\n  let i = -1;\n\n  while (remain > 0) {\n    i++;\n    let select = i % indices.length;\n    if (full[select] !== 1) {\n      ns[select]++;\n      remain--;\n      if (ns[select] === indices[select].length) {\n        full[select] = 1;\n        remainIndices--;\n      }\n    }\n    if (remainIndices === 0) break;\n  }\n  return ns;\n};\n","import db from \"apis/dexie\";\nimport { useEffect, useState } from \"react\";\nimport { drawRandom } from \"util/sample\";\n\n/**\n * Hook for getting the Units (using the current codingjob settings)\n * @param {} codingjob\n * @returns\n */\nconst useUnits = (codingjob) => {\n  const [Units, setUnits] = useState(null);\n\n  // When a new codingjob is loaded, set codingjobLoaded ref to false\n  // this prevents actually loading the data until unitSettings has loaded\n  // the unitSettings stored in the codingjob\n\n  useEffect(() => {\n    if (!codingjob?.unitSettings) return null;\n    setUnits(null);\n    getUnits(codingjob, setUnits);\n  }, [codingjob, setUnits]);\n\n  if (!codingjob) return null;\n\n  return Units;\n};\n\nconst getUnits = async (codingjob, setUnits) => {\n  let [totalUnits, units] = await getUnitsFromDB(codingjob);\n  setUnits(units);\n  if (\n    codingjob.unitSettings.n === null ||\n    codingjob.unitSettings.n == null ||\n    codingjob.unitSettings.totalUnits !== totalUnits\n  ) {\n    await db.setCodingjobProp(codingjob, \"unitSettings\", {\n      ...codingjob.unitSettings,\n      n: totalUnits,\n      totalUnits,\n    });\n  }\n};\n\nconst getUnitsFromDB = async (codingjob) => {\n  if (!codingjob?.unitSettings) return null;\n  const textUnit = codingjob.unitSettings.textUnit;\n  const unitSettings = codingjob.unitSettings;\n\n  let totalUnits = 0;\n\n  const getGroup = (cjIndices) => {\n    if (!unitSettings.balanceDocuments && !unitSettings.statifyAnnotations) return null; // if not balanced\n\n    return cjIndices.map((item) => {\n      let group = \"\";\n      if (unitSettings.balanceDocuments) group += item.docIndex;\n      if (item.annotation && unitSettings.balanceAnnotations)\n        group += \"_\" + item.annotation.variable;\n      return group;\n    });\n  };\n\n  let cjIndices;\n  let done;\n\n  if (unitSettings.unitSelection === \"allTextUnits\") {\n    cjIndices = await allUnits(codingjob, textUnit, new Set([]), true);\n    totalUnits = cjIndices.length;\n    cjIndices = drawRandom(\n      cjIndices,\n      unitSettings.n,\n      false,\n      unitSettings.seed,\n      getGroup(cjIndices)\n    );\n  }\n\n  if (unitSettings.unitSelection === \"annotations\") {\n    [cjIndices, done] = await annotationUnits(codingjob, textUnit, false, unitSettings.validCodes);\n    totalUnits = cjIndices.length;\n    cjIndices = drawRandom(\n      cjIndices,\n      unitSettings.n,\n      false,\n      unitSettings.seed,\n      getGroup(cjIndices)\n    );\n\n    if (unitSettings.annotationMix && unitSettings.annotationMix > 0) {\n      // Annotationmix is now disabled, but leaving it here because it might make a comeback someday\n      const noDuplicates = false;\n\n      const all = await allUnits(codingjob, textUnit, done, noDuplicates);\n      let sampleN = Math.ceil(cjIndices.length * (unitSettings.annotationMix / 100));\n      let addSample = drawRandom(\n        all,\n        sampleN,\n        !noDuplicates,\n        unitSettings.seed,\n        getGroup(cjIndices)\n      );\n\n      let nCodes = unitSettings.validCodes.length;\n      addSample = addSample.map((item, i) => {\n        // add random annotation to mix by drawing from the annotations in the cjIndices sample.\n        // this is random, and automatically gives approximately the same distribution of codes/groups\n        if (unitSettings.balanceAnnotations) {\n          item.variable = unitSettings.validCodes[i % nCodes];\n        } else {\n          const annSample = cjIndices[i % cjIndices.length];\n          if (annSample?.variable) item.variable = annSample.variable;\n        }\n        item.annotation = { i, group: item.variable };\n        return { ...item };\n      });\n      cjIndices = cjIndices.concat(addSample);\n    }\n  }\n\n  cjIndices = orderUnits(cjIndices, unitSettings);\n\n  return [totalUnits, cjIndices];\n};\n\nconst allUnits = async (codingjob, textUnit, done, noDuplicates) => {\n  let documents = await db.getDocuments(codingjob);\n\n  let minIndex = 0;\n  let maxIndex = Infinity;\n  if (codingjob.unitSettings.useIndexWindow) {\n    minIndex = codingjob.unitSettings.indexWindow[0];\n    maxIndex = codingjob.unitSettings.indexWindow[1];\n  }\n\n  const cjIndices = [];\n  let docIndex = -1;\n  await documents.each((e) => {\n    docIndex++;\n    if (textUnit === \"document\" && !done.has(e.doc_uid)) {\n      if (noDuplicates && done.has(e.doc_uid)) return;\n      cjIndices.push({\n        textUnit,\n        unitIndex: 0, // this is for consistency with paragraph and sentence\n        doc_uid: e.doc_uid,\n        document_id: e.document_id,\n        docIndex,\n      });\n    }\n\n    if (textUnit === \"paragraph\") {\n      const paragraphs = e.tokens[e.tokens.length - 1].paragraph;\n      for (let parIndex = minIndex; parIndex <= Math.min(maxIndex, paragraphs); parIndex++) {\n        if (noDuplicates && done.has(e.doc_uid + \"_\" + parIndex)) return;\n        cjIndices.push({\n          textUnit,\n          unitIndex: parIndex,\n          doc_uid: e.doc_uid,\n          document_id: e.document_id,\n          docIndex,\n          //parIndex,\n        });\n      }\n    }\n\n    if (textUnit === \"sentence\") {\n      const sentences = e.tokens[e.tokens.length - 1].sentence;\n      for (let sentIndex = minIndex; sentIndex <= Math.min(maxIndex, sentences); sentIndex++) {\n        if (noDuplicates && done.has(e.doc_uid + \"_\" + sentIndex)) return;\n        cjIndices.push({\n          textUnit,\n          unitIndex: sentIndex,\n          doc_uid: e.doc_uid,\n          document_id: e.document_id,\n          docIndex,\n          //sentIndex,\n        });\n      }\n    }\n  });\n  return cjIndices;\n};\n\nconst annotationUnits = async (codingjob, textUnit, unique, validCodes) => {\n  let documents = await db.getDocuments(codingjob);\n\n  let useCode = null;\n  if (validCodes)\n    useCode = validCodes.reduce((obj, code) => {\n      obj[code] = true;\n      return obj;\n    }, {});\n\n  const cjIndices = [];\n  const done = new Set([]);\n  let docIndex = -1;\n  await documents.each((e) => {\n    docIndex++;\n    if (e.annotations?.span) {\n      for (let i of Object.keys(e.annotations.span)) {\n        for (let group of Object.keys(e.annotations.span[i])) {\n          const span = e.annotations.span[i][group].span;\n          if (i > span[0]) {\n            if (textUnit === \"document\") continue;\n            if (textUnit === \"span\") continue;\n            // an annotation can cover multiple units, and each unit should only be included once\n            if (textUnit === \"paragraph\" && e.tokens[i].paragraph === e.tokens[i - 1].paragraph)\n              continue;\n            if (textUnit === \"sentence\" && e.tokens[i].sentence === e.tokens[i - 1].sentence)\n              continue;\n          }\n\n          if (useCode && useCode[group] == null) continue;\n\n          const item = {\n            textUnit,\n            doc_uid: e.doc_uid,\n            document_id: e.document_id,\n            docIndex,\n            group,\n          };\n\n          if (textUnit === \"document\" || textUnit === \"span\") item.unitIndex = Number(i);\n          if (textUnit === \"paragraph\") item.unitIndex = e.tokens[Number(i)].paragraph;\n          if (textUnit === \"sentence\") item.unitIndex = e.tokens[Number(i)].sentence;\n\n          if (unique) {\n            let itemId = item.doc_uid + \"_\" + item.textUnit + \"_\" + item.unitIndex;\n            if (done.has(itemId)) continue;\n            done.add(itemId);\n          } else {\n            item.annotation = { ...e.annotations.span[i][group], group };\n          }\n          cjIndices.push(item);\n        }\n      }\n    }\n  });\n  return [cjIndices, done];\n};\n\nconst orderUnits = (cjIndices, unitSettings) => {\n  if (!unitSettings.ordered) return cjIndices;\n  return cjIndices.sort(function (a, b) {\n    if (a.docIndex !== b.docIndex) return a.docIndex - b.docIndex;\n    if (a.unitIndex !== b.unitIndex) return a.unitIndex - b.unitIndex;\n    if (a.annotation != null && a.annotation.index !== b)\n      return a.annotation.index - b.annotation.index;\n    return 0;\n  });\n};\n\nexport default useUnits;\n","export const selectTokens = (tokens, item, contextUnit, contextWindow) => {\n  let newTokens = [];\n  if (tokens.length === 0) return newTokens;\n\n  let tokenRange = [0, tokens.length - 1];\n  let tokenContext = [0, tokens.length - 1];\n\n  if (item.textUnit === \"span\") {\n    tokenRange = item.annotation.span;\n  }\n\n  if (item.textUnit === \"paragraph\" || item.textUnit === \"sentence\") {\n    tokenRange = getTokenRange(tokens, item.textUnit, item.unitIndex, item.unitIndex);\n  }\n\n  if (contextUnit === \"paragraph\" || contextUnit === \"sentence\")\n    tokenContext = getContextRange(tokens, tokenRange, contextUnit, contextWindow);\n  if (contextUnit === \"none\") tokenContext = tokenRange;\n\n  for (let i = 0; i < tokens.length; i++) {\n    tokens[i].codingUnit = true;\n    if (tokens[i].index < tokenRange[0]) tokens[i].codingUnit = false;\n    if (tokens[i].index > tokenRange[1]) tokens[i].codingUnit = false;\n    if (tokens[i].index < tokenContext[0]) continue;\n    if (tokens[i].index > tokenContext[1]) break;\n    newTokens.push(tokens[i]);\n  }\n  return newTokens;\n};\n\nconst getTokenRange = (tokens, field, startValue, endValue) => {\n  const range = [tokens[0].index, tokens[tokens.length - 1].index];\n\n  const start = tokens.find((token) => token[field] === startValue);\n  if (start) range[0] = start.index;\n  const end = tokens.find((token) => token[field] === endValue + 1);\n  if (end) range[1] = end.index - 1;\n\n  return range;\n};\n\nconst getContextRange = (tokens, tokenRange, contextUnit, contextWindow) => {\n  const offset = -tokens[0].index;\n  let range = [\n    tokens[tokenRange[0] + offset][contextUnit],\n    tokens[tokenRange[1] + offset][contextUnit],\n  ];\n  range[0] = range[0] - contextWindow[0];\n  range[1] = range[1] + contextWindow[1];\n  return getTokenRange(tokens, contextUnit, range[0], range[1]);\n};\n","import { selectTokens } from \"./selectTokens\";\nimport hash from \"object-hash\";\nimport db from \"apis/dexie\";\n\n// Transform an item as its created in codingjob manager into a simpler\n// standardized item format. This is used when codingjobs are deployed,\n// but also per item in the previews. This looks redundant (tokens are\n// transformed to text, only to get tokenized immediately after), but this\n// makes it much easier to understand whats happening.\n// Basically:\n//   - When documents are uploaded they are tokenized\n//   - Unit selection can split documens into coding units (and context units)\n//   - These units are transformed to simplified items\n\nexport const standardizeUnits = async (codingjob, units) => {\n  const { contextUnit, contextWindow } = codingjob.unitSettings;\n\n  const docs = {};\n  const items = [];\n\n  const jobhash = hash(codingjob);\n\n  for (let i = 0; i < units.length; i++) {\n    const doc_uid = units[i].doc_uid;\n    if (!docs[doc_uid]) docs[doc_uid] = await db.getDocument(doc_uid);\n\n    const tokens = selectTokens(docs[doc_uid].tokens, units[i], contextUnit, contextWindow);\n    const item = {\n      text_fields: unparseTokens(tokens),\n      document_id: units[i].document_id,\n      meta: { unit: units[i].textUnit, unit_index: units[i].unitIndex },\n    };\n    item.unit_id = hash({ jobhash, item, date: Date() });\n    items.push(item);\n  }\n  return items;\n};\n\nconst unparseTokens = (tokens) => {\n  // Create texts from tokens in a way that preserves information about original text and textParts (context and unit)\n\n  const text_fields = [];\n  if (tokens.length === 0) return text_fields;\n\n  let unit_start = null;\n  let unit_end = null;\n  let text = \"\";\n  let section = tokens[0].section;\n\n  let offset = {};\n  if (tokens[0].offset > 0) offset.offset = tokens[0].offset;\n\n  let unit_started = false;\n  let unit_ended = false;\n\n  for (let token of tokens) {\n    if (token.section !== section) {\n      const text_field = { name: section, value: text, ...offset };\n      if (unit_start !== null) text_field.unit_start = unit_start;\n      if (unit_end !== null) text_field.unit_end = unit_end;\n\n      text_fields.push(text_field);\n\n      offset = {};\n      if (token.offset > 0) offset.offset = token.offset;\n\n      unit_start = null;\n      unit_end = null;\n      text = \"\";\n    }\n\n    if (!unit_started && token.codingUnit) {\n      unit_start = token.offset;\n      unit_started = true;\n    }\n    if (unit_started && !unit_ended && !token.codingUnit) {\n      unit_end = token.offset - 1;\n      unit_ended = true;\n    }\n\n    text = text + token.pre + token.text + token.post;\n    section = token.section;\n  }\n  if (text.length > 0) {\n    const text_field = { name: section, value: text, ...offset };\n    if (unit_start !== null) text_field.unit_start = unit_start;\n    if (unit_end !== null) text_field.unit_end = unit_end;\n    text_fields.push(text_field);\n  }\n  return text_fields;\n};\n","import SelectionTable from \"./subcomponents/SelectionTable\";\nimport React, { useEffect, useState } from \"react\";\nimport { Grid, Header, Dimmer, Loader } from \"semantic-ui-react\";\n\nimport UnitSettings from \"./subcomponents/UnitSettings\";\nimport Document from \"components/Document/Document\";\nimport useUnits from \"hooks/useUnits\";\nimport { standardizeUnits } from \"util/standardizeUnits\";\n\nconst getTableColumns = (unitSettings) => {\n  if (!unitSettings) return [];\n\n  const columns = [\n    {\n      Header: \"Document ID\",\n      accessor: \"document_id\",\n      headerClass: \"five wide\",\n    },\n  ];\n  if (unitSettings.textUnit === \"paragraph\" || unitSettings.textUnit === \"sentence\") {\n    columns.push({\n      Header: unitSettings.textUnit,\n      accessor: \"unitIndex\",\n      headerClass: \"five wide\",\n    });\n  }\n  if (unitSettings.textUnit === \"span\") {\n    columns.push({\n      Header: \"Token\",\n      accessor: \"annotation.index\",\n      headerClass: \"three wide\",\n    });\n    columns.push({\n      Header: \"Code\",\n      accessor: \"group\",\n      headerClass: \"five wide\",\n    });\n  }\n  return columns;\n};\n\nconst ManageCodingUnits = ({ codingjob }) => {\n  const units = useUnits(codingjob);\n\n  if (!codingjob) return null;\n\n  return (\n    <div>\n      <Grid stackable celled=\"internally\" columns={3}>\n        <Grid.Column verticalAlign=\"top\" stretched width={6}>\n          <Header textAlign=\"center\" style={{ background: \"#1B1C1D\", color: \"white\" }}>\n            Settings\n          </Header>\n\n          <UnitSettings codingjob={codingjob} />\n        </Grid.Column>\n\n        <PreviewUnits codingjob={codingjob} units={units} />\n      </Grid>\n    </div>\n  );\n};\n\nconst PreviewUnits = React.memo(({ codingjob, units }) => {\n  const [jobItem, setJobItem] = useState(null);\n  const [standardizedItem, setStandardizedItem] = useState(null);\n\n  useEffect(() => {\n    if (!jobItem) return null;\n    standardizeUnits(codingjob, [jobItem]).then((singleItemArray) => {\n      const previewItem = singleItemArray[0];\n      previewItem.post = (annotations) => console.log(annotations); // don't store annotations\n      setStandardizedItem(previewItem);\n    });\n  }, [jobItem, setStandardizedItem, codingjob]);\n\n  useEffect(() => {\n    if (units && units.length > 0) {\n      setJobItem({ ...units[0], ROW_ID: \"0\" });\n    } else setJobItem(null);\n  }, [units, setJobItem]);\n\n  return (\n    <>\n      <Grid.Column width={5}>\n        <Header textAlign=\"center\" style={{ background: \"#1B1C1D\", color: \"white\" }}>\n          Selected units\n        </Header>\n        <Dimmer inverted active={codingjob?.unitSettings?.textUnit && units === null}>\n          <Loader />\n        </Dimmer>\n        <SelectionTable\n          columns={getTableColumns(codingjob?.unitSettings)}\n          selectedRow={jobItem}\n          setSelectedRow={setJobItem}\n          data={units || []}\n          defaultSize={10}\n        />\n        {/* <ItemDetails items={units || []} /> */}\n      </Grid.Column>\n      <Grid.Column width={5}>\n        <PreviewDocument item={standardizedItem} codebook={{}} />\n      </Grid.Column>\n    </>\n  );\n});\n\nconst PreviewDocument = ({ item, codebook }) => {\n  const renderDocument = () => {\n    if (!item) return null;\n    return (\n      <>\n        <Header textAlign=\"center\" style={{ background: \"#1B1C1D\", color: \"white\" }}>\n          Unit preview\n        </Header>\n\n        <Dimmer inverted active={item === null}>\n          <Loader />\n        </Dimmer>\n        <Document unit={item} codes={codebook?.codes} settings={{}} />\n      </>\n    );\n  };\n\n  return <Grid.Column width={6}>{renderDocument()}</Grid.Column>;\n};\n\nexport default React.memo(ManageCodingUnits);\n","import { blockEvents } from \"actions\";\nimport React, { useEffect, useState } from \"react\";\nimport { useDispatch } from \"react-redux\";\n\nimport { Menu, Segment, Button, Popup, Form, Input } from \"semantic-ui-react\";\n\nconst VariableMenu = ({\n  children,\n  variables,\n  setVariables,\n  index,\n  setIndex,\n  newVariableDefaults,\n}) => {\n  const onAdd = () => {\n    const newVariables = {\n      ...newVariableDefaults,\n      name: uniqueName(newVariableDefaults.name, variables, null),\n    };\n\n    variables.push(newVariables);\n    setVariables(variables);\n  };\n\n  return (\n    <div>\n      <Menu attached=\"top\">\n        {Array(variables.length)\n          .fill(0)\n          .map((v, i) => {\n            return (\n              <Menu.Item active={index === i} style={{ padding: \"0em\", position: \"relative\" }}>\n                <div>\n                  <div\n                    onClick={(e, d) => setIndex(i)}\n                    style={{ padding: \"0.5em\", cursor: \"pointer\" }}\n                  >\n                    {variables[i].name}\n                  </div>\n\n                  <div style={{ position: \"absolute\", zIndex: 10, bottom: \"-1.5em\" }}>\n                    <MoveButtons\n                      i={i}\n                      variables={variables}\n                      setVariables={setVariables}\n                      index={index}\n                      setIndex={setIndex}\n                    />\n                  </div>\n                </div>\n              </Menu.Item>\n            );\n          })}\n        <Menu.Item icon=\"plus\" style={{ background: \"lightblue\" }} onClick={onAdd} />\n        <DeleteButton\n          variables={variables}\n          setVariables={setVariables}\n          index={index}\n          setIndex={setIndex}\n        />\n      </Menu>\n      <Segment attached=\"bottom\" style={{ padding: \"1em\" }}>\n        <br />\n        <ChangeName variables={variables} setVariables={setVariables} index={index} />\n        {children}\n      </Segment>\n    </div>\n  );\n};\n\nconst setNewName = (name, variables, index, setVariables) => {\n  if (variables[index].name === name) return;\n  variables[index].name = uniqueName(name, variables, index);\n  setVariables(variables);\n};\n\nconst ChangeName = ({ variables, setVariables, index }) => {\n  const [delayedName, setDelayedName] = useState(\"\");\n  const dispatch = useDispatch();\n\n  useEffect(() => {\n    if (variables.length === 0) return;\n    if (!delayedName || delayedName === variables[index].name) return;\n    if (variables[index].name === delayedName) return;\n    const timer = setTimeout(() => {\n      setNewName(delayedName.trim(), variables, index, setVariables);\n    }, 500);\n    return () => clearTimeout(timer);\n  }, [delayedName, variables, index, setVariables]);\n\n  useEffect(() => {\n    if (variables.length === 0) return;\n    setDelayedName(variables[index].name);\n  }, [variables, index, setDelayedName]);\n\n  return (\n    <Form>\n      <Form.Group grouped>\n        <label>Name</label> <span style={{ fontSize: \"10px\" }}>(keep it short)</span>\n        <Form.Field>\n          <Input\n            value={delayedName}\n            style={{ width: \"150px\" }}\n            onFocus={() => dispatch(blockEvents(true))}\n            onBlur={() => dispatch(blockEvents(false))}\n            onChange={(e, d) => setDelayedName(d.value)}\n          />\n        </Form.Field>{\" \"}\n      </Form.Group>\n    </Form>\n  );\n};\n\nconst DeleteButton = ({ variables, setVariables, index, setIndex }) => {\n  const [deleteOpen, setDeleteOpen] = useState(false);\n\n  const onDelete = () => {\n    const newVariables = [];\n    for (let i = 0; i < variables.length; i++) {\n      if (i !== index) newVariables.push(variables[i]);\n    }\n\n    setVariables(newVariables);\n    setDeleteOpen(false);\n    setIndex(Math.max(0, index - 1));\n  };\n\n  if (variables.length === 0) return null;\n\n  return (\n    <Popup\n      hoverable\n      open={deleteOpen}\n      onClose={() => setDeleteOpen(false)}\n      trigger={\n        <Menu.Item\n          icon=\"minus\"\n          position=\"right\"\n          style={{ background: \"red\" }}\n          onClick={() => setDeleteOpen(!deleteOpen)}\n        />\n      }\n    >\n      <p>\n        Delete <b>{variables[index].name}</b>?\n      </p>\n\n      <Button style={{ background: \"red\" }} onClick={onDelete}>\n        yes please\n      </Button>\n    </Popup>\n  );\n};\n\nconst MoveButtons = ({ i, variables, setVariables, index, setIndex }) => {\n  const onMove = (direction, i) => {\n    const j = direction === \"left\" ? Math.max(0, i - 1) : Math.min(variables.length - 1, i + 1);\n    const temp = variables[i];\n\n    variables[i] = variables[j];\n    variables[j] = temp;\n\n    setVariables(variables);\n    setIndex(j);\n  };\n\n  if (index !== i) return null;\n  return (\n    <Button.Group>\n      {i > 0 ? (\n        <Button\n          icon=\"arrow left\"\n          onClick={() => {\n            onMove(\"left\", i);\n          }}\n          style={{\n            borderRadius: \"0\",\n            padding: \"0em\",\n            background: \"rgba(0,0,0,0)\",\n          }}\n        />\n      ) : null}\n      {i < variables.length - 1 ? (\n        <Button\n          icon=\"arrow right\"\n          onClick={() => onMove(\"right\", i)}\n          style={{\n            borderRadius: \"0\",\n            padding: \"0em\",\n            background: \"rgba(0,0,0,0)\",\n          }}\n        />\n      ) : null}\n    </Button.Group>\n  );\n};\n\nconst uniqueName = (newName, variables, index) => {\n  let uniqueNewName = newName;\n  let i = 2;\n\n  const existingNames = [];\n  for (let i = 0; i < variables.length; i++) {\n    if (index !== null && i === index) continue;\n    existingNames.push(variables[i].name);\n  }\n\n  while (existingNames.includes(uniqueNewName)) {\n    uniqueNewName = newName + ` ${i}`;\n    i++;\n  }\n  return uniqueNewName;\n};\n\nexport default VariableMenu;\n","import React, { useEffect, useState } from \"react\";\n\nimport { Form, Radio, TextArea, Grid, Dropdown } from \"semantic-ui-react\";\n\nimport Help from \"./Help\";\nimport CodesEditor from \"./CodesEditor\";\nimport { standardizeCodes } from \"util/codebook\";\nimport VariableMenu from \"./VariableMenu\";\n\nconst questionDefaultSettings = {\n  type: \"select code\",\n  name: \"Question name\",\n  question: \"The question itself\",\n  codes: [\"No\", \"Skip\", \"Yes\"],\n};\n\nconst QuestionTaskSettings = ({ taskSettings, setTaskSettings, unitSettings }) => {\n  const [questionIndex, setQuestionIndex] = useState(0);\n\n  const setQuestions = (variables) => {\n    setTaskSettings({\n      ...taskSettings,\n      questions: { settings: taskSettings.questions.settings, questions: variables },\n    });\n  };\n\n  return (\n    <VariableMenu\n      variables={taskSettings.questions.questions}\n      setVariables={setQuestions}\n      index={questionIndex}\n      setIndex={setQuestionIndex}\n      newVariableDefaults={questionDefaultSettings}\n    >\n      <QuestionForm\n        taskSettings={taskSettings}\n        setTaskSettings={setTaskSettings}\n        unitSettings={unitSettings}\n        questionIndex={questionIndex}\n      />{\" \"}\n    </VariableMenu>\n  );\n};\n\nconst QuestionForm = ({ taskSettings, setTaskSettings, unitSettings, questionIndex }) => {\n  const questions = taskSettings.questions.questions;\n\n  const setQuestionForm = (value) => {\n    const newTaskSettings = { ...taskSettings };\n    const newValue = { ...value };\n\n    newTaskSettings.questions.questions[questionIndex] = newValue;\n    setTaskSettings(newTaskSettings);\n  };\n\n  return (\n    <QuestionFormSettings\n      questionForm={questions[questionIndex]}\n      setQuestionForm={setQuestionForm}\n      setTaskSettings={setTaskSettings}\n      questions={questions}\n      questionIndex={questionIndex}\n      unitSettings={unitSettings}\n    />\n  );\n};\n\nconst QuestionFormSettings = ({ questionForm, setQuestionForm, questions, unitSettings }) => {\n  const [delayed, setDelayed] = useState(\"\");\n  const [warn, setWarn] = useState([]);\n\n  useEffect(() => {\n    if (!delayed) return;\n    if (questionForm.question === delayed.question) return;\n    const timer = setTimeout(() => {\n      // if (questionForm.name !== delayed.name)\n      //   updateRelevanceBranching(questionForm.name, delayed.name, setTaskSettings);\n      setQuestionForm({ ...questionForm, name: delayed.name, question: delayed.question });\n    }, 500);\n    return () => clearTimeout(timer);\n  }, [delayed, questionForm, setQuestionForm]);\n\n  useEffect(() => {\n    let newWarn = [];\n\n    const hasCodeRef = questionForm.question.search(\"\\\\[code\\\\]\") >= 0;\n    console.log(unitSettings);\n\n    if (hasCodeRef && unitSettings?.unitSelection === \"allTextUnits\")\n      newWarn.push(\n        \"Referring to a specific code with [code] is only possible if coding units are annotations\"\n      );\n\n    setWarn(newWarn);\n    setDelayed({ name: questionForm.name, question: questionForm.question });\n  }, [setDelayed, questionForm, setWarn, unitSettings]);\n\n  const codesEditor = () => {\n    //if (questionForm.type !== \"search code\" && questionForm.type !== \"select code\") return null;\n    return (\n      <CodesEditor\n        codes={standardizeCodes(questionForm.codes)}\n        setCodes={(newCodes) => setQuestionForm({ ...questionForm, codes: newCodes })}\n        questions={questions}\n      />\n    );\n  };\n\n  if (!questionForm) return null;\n  return (\n    <Form>\n      <Form.Group grouped>\n        <br />\n        <label>\n          Question\n          <Help\n            header={\"Referring to annotation codes in a question\"}\n            texts={[\n              \"If unit selection is based on span annotations, you can also use the tag [code]. This will be replaced by the code label of the annotation\",\n            ]}\n          />\n        </label>\n        {warn.length > 0 ? <Help type=\"warn\" header=\"\" texts={warn} /> : null}\n        <Form.Field>\n          <TextArea\n            value={delayed.question}\n            onChange={(e, d) => setDelayed({ ...delayed, question: d.value })}\n          />\n        </Form.Field>\n      </Form.Group>\n\n      <Form.Group grouped>\n        <label>Type of answer</label>\n        <Form.Field>\n          <Radio\n            value=\"search code\"\n            label=\"Select code from search box\"\n            checked={questionForm.type === \"search code\"}\n            onChange={() => setQuestionForm({ ...questionForm, type: \"search code\" })}\n          />\n        </Form.Field>\n        <Form.Field>\n          <Radio\n            value=\"select code\"\n            label=\"Select code from buttons\"\n            checked={questionForm.type === \"select code\"}\n            onChange={() => setQuestionForm({ ...questionForm, type: \"select code\" })}\n          />\n        </Form.Field>\n\n        <Form.Field>\n          <Radio\n            value=\"annotinder\"\n            label=\"Annotinder (swipe left/right/up)\"\n            checked={questionForm.type === \"annotinder\"}\n            onChange={() => setQuestionForm({ ...questionForm, type: \"annotinder\" })}\n          />\n        </Form.Field>\n      </Form.Group>\n      <br />\n      {/* <Form.Group grouped>\n        <label>Type of answer</label>\n        <Form.Field>\n          <Dropdown\n            options={questionForm.codes.map((code) => ({ key: code, text: code, value: code }))}\n            placeholder=\"answers that should \"\n            fluid\n            multiple\n            selection\n          />\n        </Form.Field>\n      </Form.Group> */}\n      <br />\n      <AnnotinderEditor questionForm={questionForm} setQuestionForm={setQuestionForm} />\n      <div style={{ margin: \"-1em\" }}>{codesEditor()}</div>\n    </Form>\n  );\n};\n\nconst AnnotinderEditor = ({ questionForm, setQuestionForm }) => {\n  const [swipes, setSwipes] = useState({ left: null, up: null, right: null });\n\n  useEffect(() => {\n    // if there are not yet any .swipe keys, read first 3 codes as defaults\n    if (questionForm.type !== \"annotinder\") return null;\n    const newCodes = [...questionForm.codes];\n    let firstTime = true;\n    for (let code of newCodes) if (code?.swipe) firstTime = false;\n    if (!firstTime) return null;\n    const directions = [\"left\", \"up\", \"right\"];\n    for (let i = 0; i < 3; i++) {\n      if (newCodes.length > i) {\n        if (typeof newCodes[i] === \"object\") {\n          newCodes[i] = { ...newCodes[i], swipe: directions[i] };\n        } else newCodes[i] = { code: newCodes[i], swipe: directions[i] };\n      }\n    }\n    setQuestionForm({ ...questionForm, codes: newCodes });\n  }, [questionForm, setQuestionForm]);\n\n  useEffect(() => {\n    const getSwipeCode = (direction) => {\n      return questionForm.codes.find((code) => {\n        if (typeof code !== \"object\") return false;\n        return code.swipe && code.swipe === direction;\n      });\n    };\n    const left = getSwipeCode(\"left\") || null;\n    const up = getSwipeCode(\"up\") || null;\n    const right = getSwipeCode(\"right\") || null;\n    setSwipes({ left, up, right });\n  }, [questionForm, setSwipes]);\n\n  const onSelect = (direction, selected) => {\n    const newCodes = questionForm.codes.map((code) => {\n      const newcode = typeof code !== \"object\" ? { code } : { ...code };\n      if (newcode.code === selected) {\n        return { ...newcode, swipe: direction };\n      } else {\n        if (newcode.swipe && newcode.swipe === direction) return { ...newcode, swipe: null };\n      }\n      if (!newcode.swipe) newcode.swipe = null;\n      return newcode;\n    });\n    setQuestionForm({ ...questionForm, codes: newCodes });\n  };\n\n  if (questionForm.type !== \"annotinder\") return null;\n\n  const options = questionForm.codes.map((code, i) => {\n    return { key: i, text: code.code || code, value: code.code || code };\n  });\n\n  return (\n    <Form>\n      <Grid textAlign=\"center\" verticalAlign=\"middle\">\n        <Grid.Row style={{ paddingBottom: \"0\" }}>\n          <Grid.Column width={6}>\n            <Form.Group grouped>\n              <b>swipe</b> or <b>arrow up</b>\n              <br />\n              <Dropdown\n                placeholder=\"not used\"\n                clearable\n                value={swipes.up?.code || null}\n                options={options}\n                selection\n                style={{ minWidth: \"10em\", maxWidth: \"10em\" }}\n                onChange={(e, d) => onSelect(\"up\", d.value)}\n              />\n            </Form.Group>\n          </Grid.Column>\n        </Grid.Row>\n        <Grid.Row>\n          <Grid.Column width={8}>\n            <b>swipe</b> or <b>arrow left</b>\n            <br />\n            <Dropdown\n              placeholder=\"not used\"\n              clearable\n              value={swipes.left?.code || null}\n              options={options}\n              selection\n              style={{ minWidth: \"10em\", maxWidth: \"10em\" }}\n              onChange={(e, d) => onSelect(\"left\", d.value)}\n            />\n          </Grid.Column>\n          <Grid.Column width={8}>\n            <b>swipe</b> or <b>arrow right</b>\n            <br />\n            <Dropdown\n              placeholder=\"not used\"\n              clearable\n              value={swipes.right?.code || null}\n              options={options}\n              selection\n              style={{ minWidth: \"10em\", maxWidth: \"10em\" }}\n              onChange={(e, d) => onSelect(\"right\", d.value)}\n            />\n          </Grid.Column>\n        </Grid.Row>\n      </Grid>\n      <br />\n      <br />\n    </Form>\n  );\n};\n\nexport default QuestionTaskSettings;\n","import React, { useState } from \"react\";\n\nimport { Form, Radio, Icon, Checkbox } from \"semantic-ui-react\";\n\nimport CodesEditor from \"./CodesEditor\";\nimport { standardizeCodes } from \"util/codebook\";\nimport VariableMenu from \"./VariableMenu\";\n\nimport Help from \"components/CodingjobManager/subcomponents/Help\";\n\nconst variableDefaultSettings = {\n  name: \"Variable name\",\n  buttonMode: \"all\",\n  searchBox: false,\n  codes: [\"No\", \"Skip\", \"Yes\"],\n};\n\nconst AnnotateTaskSettings = ({ taskSettings, setTaskSettings }) => {\n  const [variableIndex, setVariableIndex] = useState(0);\n\n  const setVariables = (variables) => {\n    setTaskSettings({\n      ...taskSettings,\n      annotate: { settings: taskSettings.annotate.settings, variables: variables },\n    });\n  };\n\n  return (\n    <VariableMenu\n      variables={taskSettings.annotate.variables}\n      setVariables={setVariables}\n      index={variableIndex}\n      setIndex={setVariableIndex}\n      newVariableDefaults={variableDefaultSettings}\n    >\n      <br />\n      <AnnotateForm\n        taskSettings={taskSettings}\n        setTaskSettings={setTaskSettings}\n        variableIndex={variableIndex}\n      />{\" \"}\n    </VariableMenu>\n  );\n};\n\nconst AnnotateForm = ({ taskSettings, setTaskSettings, variableIndex }) => {\n  const annotateForm = taskSettings.annotate.variables[variableIndex];\n  const setAnnotateForm = (value) => {\n    const newTaskSettings = { ...taskSettings };\n    const newValue = { ...value };\n\n    newTaskSettings.annotate.variables[variableIndex] = newValue;\n    setTaskSettings(newTaskSettings);\n  };\n\n  const codesEditor = () => {\n    return (\n      <CodesEditor\n        codes={standardizeCodes(annotateForm.codes)}\n        setCodes={(newCodes) => setAnnotateForm({ ...annotateForm, codes: newCodes })}\n      />\n    );\n  };\n\n  if (!taskSettings?.annotate?.variables?.[variableIndex]) return null;\n\n  return (\n    <Form>\n      <Form.Group>\n        <Icon name=\"setting\" />\n        <label>Code Selector settings</label>\n      </Form.Group>\n\n      <Form.Group>\n        <Form.Field>\n          <Checkbox\n            label=\"Search box\"\n            disabled={annotateForm.buttonMode === \"recent\"}\n            checked={annotateForm.searchBox || annotateForm.buttonMode === \"recent\"}\n            onChange={(e, d) => setAnnotateForm({ ...annotateForm, searchBox: d.checked })}\n          />\n        </Form.Field>\n      </Form.Group>\n      <Form.Group grouped>\n        <label>Code buttons</label>\n\n        <Form.Field>\n          <Radio\n            value=\"all\"\n            label=\"Show all codes\"\n            checked={annotateForm.buttonMode === \"all\"}\n            onChange={() => setAnnotateForm({ ...annotateForm, buttonMode: \"all\" })}\n          />\n          <Help\n            header={\"Show all active codes\"}\n            texts={[\n              \"Only codes that are 'active' will be shown\",\n              \"You can toggle which codes are active in the codebook (top-right in menu bar)\",\n            ]}\n          />\n        </Form.Field>\n        <Form.Field>\n          <Radio\n            value=\"recent\"\n            label=\"Show recently used\"\n            checked={annotateForm.buttonMode === \"recent\"}\n            onChange={() => setAnnotateForm({ ...annotateForm, buttonMode: \"recent\" })}\n          />\n          <Help\n            header={\"Show recently used codes\"}\n            texts={[\n              \"Show only (active) codes that the coder used recently\",\n              \"The Search box is always enabled with this option, and the buttons only serve as quick keys. This is especially usefull for very large codebooks, for instance for tagging specific named entities\",\n            ]}\n          />\n        </Form.Field>\n      </Form.Group>\n\n      <br />\n      <div style={{ overflow: \"auto\", margin: \"-1em\" }}>{codesEditor()}</div>\n    </Form>\n  );\n};\n\nexport default AnnotateTaskSettings;\n","import React, { useEffect } from \"react\";\n\nimport { Icon, Form, Radio, Divider } from \"semantic-ui-react\";\n\nimport QuestionTaskSettings from \"./QuestionTaskSettings\";\nimport AnnotateTaskSettings from \"./AnnotateTaskSettings\";\nimport db from \"apis/dexie\";\n\nconst defaultTaskSettings = {\n  // contains the type of task (annotate, question) and settings for this task\n  // note that each type corresponds to a key. So if for instance type = 'questions',\n  // the questions settings will be used.\n  type: null,\n\n  // annotate type settings\n  annotate: {\n    settings: {},\n    variables: [\n      {\n        name: \"Variable name\",\n        buttonMode: \"all\",\n        searchBox: false,\n        codes: [\"Some\", \"example\", \"options\"],\n      },\n    ],\n  },\n\n  // question type settings\n  questions: {\n    settings: {},\n    questions: [\n      {\n        name: \"Question name\",\n        type: \"select code\",\n        question: \"[The question itself]\",\n        codes: [\"No\", \"Skip\", \"Yes\"],\n      },\n    ],\n  },\n};\n\nconst TaskSettings = ({ codingjob }) => {\n  const unitSettings = codingjob?.unitSettings;\n  const taskSettings = codingjob?.taskSettings || defaultTaskSettings;\n  const setTaskSettings = (us) => {\n    db.setCodingjobProp(codingjob, \"taskSettings\", us);\n  };\n\n  if (!taskSettings || !unitSettings) return null;\n\n  return (\n    <div style={{ verticalAlign: \"top\", float: \"top\", paddingLeft: \"1em\" }}>\n      <TypeForm taskSettings={taskSettings} setTaskSettings={setTaskSettings} />\n      <Divider />\n      {taskSettings.type === \"questions\" ? (\n        <QuestionTaskSettings\n          taskSettings={taskSettings}\n          setTaskSettings={setTaskSettings}\n          unitSettings={unitSettings}\n        />\n      ) : null}\n      {taskSettings.type === \"annotate\" ? (\n        <AnnotateTaskSettings\n          taskSettings={taskSettings}\n          setTaskSettings={setTaskSettings}\n          unitSettings={unitSettings}\n        />\n      ) : null}\n    </div>\n  );\n};\n\nconst TypeForm = ({ taskSettings, setTaskSettings }) => {\n  useEffect(() => {\n    if (!taskSettings?.type)\n      setTaskSettings({\n        ...taskSettings,\n        type: \"annotate\",\n      });\n  }, [taskSettings, setTaskSettings]);\n\n  const radioButton = (value, label) => {\n    return (\n      <Form.Field>\n        <Radio\n          value={value}\n          label={label}\n          checked={taskSettings.type === value}\n          onChange={(e, d) =>\n            setTaskSettings({\n              ...taskSettings,\n              type: value,\n            })\n          }\n        />\n      </Form.Field>\n    );\n  };\n\n  return (\n    <Form>\n      <Form.Group>\n        <Icon name=\"setting\" />\n        <label>Set task type</label>\n      </Form.Group>\n      <Form.Group grouped widths=\"equal\">\n        {radioButton(\"annotate\", \"Annotate\")}\n        {radioButton(\"questions\", \"Question\")}\n      </Form.Group>\n    </Form>\n  );\n};\n\nexport default React.memo(TaskSettings);\n","import React, { useEffect, useState, useRef } from \"react\";\nimport { Input, Loader, Pagination, Segment } from \"semantic-ui-react\";\n\nconst IndexController = ({ n, index, setIndex, canGoForward = true, canGoBack = true }) => {\n  const reached = useRef(0); // if canGoBack but not canGoForward, can still go forward after going back\n  const canMove = useRef(false);\n\n  const [loading, setLoading] = useState(false);\n  const [activePage, setActivePage] = useState(1);\n  const [delayedActivePage, setDelayedActivePage] = useState(1);\n\n  // const onKeyDown = (e) => {\n  //   if (e.keyCode === 9) {\n  //     e.preventDefault();\n  //     if (e.shiftKey) {\n  //       if (!canGoBack) return;\n  //       if (e.repeat) {\n  //         setDelayedActivePage((current) => (current > 1 ? current - 1 : current));\n  //       } else {\n  //         setActivePage((current) => (current > 1 ? current - 1 : current));\n  //       }\n  //     } else {\n  //       if (e.repeat) {\n  //         setDelayedActivePage((current) => {\n  //           if (canGoForward || current < reached.current)\n  //             return current < n + 1 ? current + 1 : current;\n  //         });\n  //       } else {\n  //         setActivePage((current) => {\n  //           if (canGoForward || current < reached.current)\n  //             return current < n + 1 ? current + 1 : current;\n  //         });\n  //       }\n  //     }\n  //   }\n  // };\n\n  useEffect(() => {\n    if (index !== null) setActivePage(Math.min(index + 1, n + 1));\n    if (index === null) setActivePage(n + 1);\n  }, [index, n, setActivePage]);\n\n  // useEffect(() => {\n  //   if (canGoForward || canGoBack) window.addEventListener(\"keydown\", onKeyDown);\n  //   return () => {\n  //     window.removeEventListener(\"keydown\", onKeyDown);\n  //   };\n  // });\n\n  useEffect(() => {\n    reached.current = 0;\n    canMove.current = false;\n  }, [n]);\n\n  useEffect(() => {\n    if (!n) return null;\n    setActivePage(1);\n    canMove.current = true;\n  }, [n, setActivePage]);\n\n  useEffect(() => {\n    if (!n) return null;\n    reached.current = Math.max(activePage, reached.current);\n    if (activePage - 1 === n) {\n      setIndex(null);\n    } else {\n      setIndex(activePage - 1);\n    }\n    setDelayedActivePage(activePage);\n  }, [n, setIndex, activePage]);\n\n  useEffect(() => {\n    if (!n) return null;\n    if (activePage === delayedActivePage) {\n      setLoading(false);\n      return null;\n    }\n    setLoading(true);\n    const timer = setTimeout(() => {\n      setActivePage(delayedActivePage);\n      setLoading(false);\n    }, 500);\n    return () => clearTimeout(timer);\n  }, [activePage, delayedActivePage, n, setLoading]);\n\n  if (!n) return null;\n\n  return (\n    <Segment\n      style={{\n        border: \"none\",\n        boxShadow: \"none\",\n        padding: \"0\",\n        leftMargin: \"0px\",\n        width: \"100%\",\n        maxHeight: \"35px\",\n        borderRadius: \"0\",\n      }}\n    >\n      <Loader active={loading} content=\"\" />\n\n      <Input\n        style={{ padding: \"0 !important\", margin: \"0\", width: \"100%\" }}\n        min={1}\n        max={n + 1}\n        onChange={(e, d) => {\n          if (\n            (canGoForward || Number(d.value) < reached.current) &&\n            Number(d.value) > delayedActivePage\n          )\n            setDelayedActivePage(Number(d.value));\n          if (canGoBack && Number(d.value) < delayedActivePage)\n            setDelayedActivePage(Number(d.value));\n        }}\n        type=\"range\"\n        labelPosition=\"left\"\n        label={\n          <Pagination\n            secondary\n            activePage={delayedActivePage}\n            pageItem={delayedActivePage <= n ? `${delayedActivePage} / ${n}` : `done / ${n}`}\n            size={\"mini\"}\n            firstItem={null}\n            lastItem={null}\n            prevItem={canGoBack ? \"back\" : null}\n            nextItem={canGoForward || activePage < reached.current ? \"next\" : \"\"}\n            siblingRange={0}\n            boundaryRange={0}\n            ellipsisItem={null}\n            totalPages={n + 1}\n            onClick={(e, d) => e.stopPropagation()}\n            onPageChange={(e, d) => {\n              if (\n                (canGoForward || activePage < reached.current) &&\n                Number(d.activePage) > activePage\n              )\n                setActivePage(Number(d.activePage));\n              if (canGoBack && Number(d.activePage) < activePage)\n                setActivePage(Number(d.activePage));\n            }}\n            style={{ fontSize: \"9px\", border: \"none\", boxShadow: \"none\", padding: 0, margin: 0 }}\n          ></Pagination>\n        }\n        value={delayedActivePage}\n      />\n    </Segment>\n  );\n};\n\nexport default IndexController;\n","import React, { useRef } from \"react\";\nimport { Ref, Table } from \"semantic-ui-react\";\nimport { getColor } from \"util/tokenDesign\";\nimport { importSpanAnnotations } from \"util/annotations\";\nimport \"components/Document/subcomponents/spanAnnotationsStyle.css\";\n\nconst COLWIDTHS = [4, 4, 2, 2]; // for offset and text\n\nconst AnnotateTable = ({ tokens, variableMap, annotations }) => {\n  if (!tokens || tokens.length === 0) return null;\n  return (\n    <Table\n      style={{ fontSize: \"10px\" }}\n      fixed\n      role=\"grid\"\n      arioa-labelledby=\"header\"\n      selectable\n      unstackable\n      singleLine\n      compact=\"very\"\n      size=\"small\"\n    >\n      <Table.Header className=\"annotations-thead\">\n        <Table.Row>\n          <Table.HeaderCell width={COLWIDTHS[0]}>Variable</Table.HeaderCell>\n          <Table.HeaderCell width={COLWIDTHS[1]}>Value</Table.HeaderCell>\n          <Table.HeaderCell width={COLWIDTHS[2]}>Section</Table.HeaderCell>\n          <Table.HeaderCell width={COLWIDTHS[3]}>Tokens</Table.HeaderCell>\n          <Table.HeaderCell>Text</Table.HeaderCell>\n        </Table.Row>\n      </Table.Header>\n      <Table.Body className=\"annotations-tbody\">\n        {annotationRows(tokens, variableMap, importSpanAnnotations(annotations, tokens))}\n      </Table.Body>\n    </Table>\n  );\n};\n\nconst annotationRows = (tokens, variableMap, annotations) => {\n  const rows = [];\n  let text = null;\n  let annotation = null;\n\n  for (const tokenIndex of Object.keys(annotations)) {\n    for (const variable of Object.keys(annotations[tokenIndex])) {\n      annotation = annotations[tokenIndex][variable];\n\n      // annotations are stored percode token index, and so are duplicated\n      // to get unique annotations we only use the first one.\n      if (annotation.index !== annotation.span[0]) continue;\n\n      // negative offset, so that index/span matches array indices (more efficient)\n      const offset = -tokens[0].index;\n      //const span = [annotation.span[0] - tokens[0].index, annotation.span[1] - tokens[0].index];\n\n      let notInUnit = true;\n      for (let span_i = annotation.span[0]; span_i <= annotation.span[1]; span_i++) {\n        if (tokens[span_i + offset] != null && tokens[span_i + offset].codingUnit)\n          notInUnit = false;\n      }\n\n      if (notInUnit) continue;\n\n      const annotationTokens = tokens.slice(\n        annotation.span[0] + offset,\n        annotation.span[1] + 1 + offset\n      );\n      text = annotationTokens\n        .map((at, i) => {\n          const pre = i > 0 ? at.pre : \"\";\n          const post = i < annotationTokens.length - 1 ? at.post : \"\";\n          return pre + at.text + post;\n        })\n        .join(\"\");\n\n      const row = (\n        <AnnotationRow\n          key={tokenIndex + annotation.value}\n          tokens={tokens}\n          variable={variable}\n          variableMap={variableMap}\n          annotation={annotation}\n          text={text}\n          offset={offset}\n        />\n      );\n      rows.push(row);\n    }\n  }\n  return rows;\n};\n\nconst AnnotationRow = ({ tokens, variable, variableMap, annotation, text, offset }) => {\n  const ref = useRef();\n\n  if (!variableMap) return null;\n\n  const codeMap = variableMap[variable].codeMap;\n  const color = getColor(annotation.value, codeMap);\n  const label = codeMap[annotation.value]?.foldToParent\n    ? `${codeMap[annotation.value].foldToParent} - ${annotation.value}`\n    : annotation.value;\n\n  return (\n    <Ref innerRef={ref}>\n      <Table.Row className=\"annotations-tr\">\n        <Table.Cell width={COLWIDTHS[0]}>\n          <span title={variable}>{variable}</span>\n        </Table.Cell>\n\n        <Table.Cell width={COLWIDTHS[1]} style={color ? { background: color } : null}>\n          <span title={label}>{label}</span>\n        </Table.Cell>\n        <Table.Cell width={COLWIDTHS[2]}>{annotation.section}</Table.Cell>\n        <Table.Cell width={COLWIDTHS[3]} cref={ref}>\n          {`${annotation.span[0]}-${annotation.span[1]}`}\n        </Table.Cell>\n        <Table.Cell>\n          <span title={text}>{text}</span>\n        </Table.Cell>\n      </Table.Row>\n    </Ref>\n  );\n};\n\nexport default AnnotateTable;\n","import React, { useState, useEffect } from \"react\";\nimport { Container, Grid, Header, List, ListItem, Table, Popup, Button } from \"semantic-ui-react\";\nimport AnnotateTable from \"./subcomponents/AnnotateTable\";\nimport Document from \"components/Document/Document\";\nimport { codeBookEdgesToMap } from \"util/codebook\";\n\nconst AnnotateTask = ({ unit, codebook, blockEvents }) => {\n  const [annotations, setAnnotations] = useState([]);\n  const [variableMap, setVariableMap] = useState(null);\n  const [tokens, setTokens] = useState();\n\n  useEffect(() => {\n    // settings is an array with the settings for each question\n    // This needs a little preprocessing, so we only update it when codebook changes (not per unit)\n    const vm = {};\n    for (let variable of codebook.variables) {\n      if (!variable?.codes) return null;\n      const codeMap = codeBookEdgesToMap([...variable.codes]);\n      vm[variable.name] = { ...variable, codeMap };\n    }\n    setVariableMap(vm);\n  }, [codebook, setVariableMap]);\n\n  if (!unit || codebook?.variables === null) return null;\n\n  return (\n    <Grid\n      centered\n      style={{ height: \"100%\", width: \"100%\", paddingTop: \"0\" }}\n      verticalAlign={\"top\"}\n      columns={2}\n    >\n      <Grid.Column width={10} style={{ paddingRight: \"0em\", height: \"100%\" }}>\n        <Document\n          unit={unit}\n          variables={codebook?.variables}\n          settings={codebook?.settings}\n          onChangeAnnotations={setAnnotations}\n          returnTokens={setTokens}\n          blockEvents={blockEvents}\n        />\n      </Grid.Column>\n      <Grid.Column\n        width={6}\n        style={{\n          paddingRight: \"0em\",\n          height: \"100%\",\n          overflow: \"auto\",\n        }}\n      >\n        <Instructions codebook={codebook} />\n\n        <AnnotateTable tokens={tokens} variableMap={variableMap} annotations={annotations} />\n      </Grid.Column>\n    </Grid>\n  );\n};\n\nconst Instructions = () => {\n  const [open, setOpen] = useState(false);\n  return (\n    <Popup\n      flowing\n      open={open}\n      position=\"bottom right\"\n      trigger={\n        <Button fluid primary size=\"tiny\" onClick={() => setOpen(!open)} style={{}}>\n          Instructions\n        </Button>\n      }\n    >\n      <Container style={{ paddingTop: \"2em\", width: \"500px\" }}>\n        <Header as=\"h4\" align=\"center\">\n          Edit span annotations\n        </Header>\n        <p align=\"center\">Assign codes to words or phrases. A word can have multiple codes.</p>\n        <Table unstackable>\n          <Table.Header>\n            <Table.Row>\n              <Table.HeaderCell></Table.HeaderCell>\n              <Table.HeaderCell>Keyboard</Table.HeaderCell>\n              <Table.HeaderCell>Mouse</Table.HeaderCell>\n              <Table.HeaderCell>Touchpad</Table.HeaderCell>\n            </Table.Row>\n          </Table.Header>\n          <Table.Body>\n            <Table.Row>\n              <Table.Cell>\n                <strong>Navigate</strong>\n              </Table.Cell>\n              <Table.Cell>\n                <i>Arrow keys</i>\n              </Table.Cell>\n              <Table.Cell></Table.Cell>\n              <Table.Cell></Table.Cell>\n            </Table.Row>\n            <Table.Row>\n              <Table.Cell>\n                <strong>Select words</strong>\n              </Table.Cell>\n              <Table.Cell>\n                <i>spacebar</i>\n                <br />\n                Hold to select mutiple\n              </Table.Cell>\n              <Table.Cell>\n                <i>Left-click</i>\n                <br />\n                Hold to select multiple\n              </Table.Cell>\n              <Table.Cell>\n                <i>tab</i> first word 2 times, then last word 1 time\n              </Table.Cell>\n            </Table.Row>\n            <Table.Row>\n              <Table.Cell>\n                <strong>Edit code</strong>\n              </Table.Cell>\n              <Table.Cell>\n                Press <i>spacebar</i> (don't hold) on an annotation\n              </Table.Cell>\n              <Table.Cell>\n                <i>Left-click</i> (don't hold) on an annotation\n              </Table.Cell>\n              <Table.Cell>\n                <i>tab</i> an annotation 3 times\n              </Table.Cell>\n            </Table.Row>\n          </Table.Body>\n          <Table.Footer>\n            <Table.Row>\n              <Table.HeaderCell>\n                <strong>Quick keys</strong> <br />\n                in popup\n              </Table.HeaderCell>\n              <Table.HeaderCell colSpan=\"3\">\n                <List as=\"ul\">\n                  <ListItem as=\"li\">\n                    <i>text input</i> automatically opens dropdown{\" \"}\n                  </ListItem>\n                  <ListItem as=\"li\">\n                    navigate buttons with <i>arrow keys</i>, select with <i>spacebar</i>\n                  </ListItem>\n                  <ListItem as=\"li\">\n                    use <i>escape</i> to close popup and <i>delete</i> to remove code\n                  </ListItem>\n                </List>\n              </Table.HeaderCell>\n            </Table.Row>\n          </Table.Footer>\n        </Table>\n      </Container>\n    </Popup>\n  );\n};\n\nexport default React.memo(AnnotateTask);\n","import React, { useState, useEffect, useRef } from \"react\";\nimport { Button, Dropdown, Ref, Icon } from \"semantic-ui-react\";\nimport { moveUp, moveDown } from \"util/refNavigation\";\n\nconst arrowKeys = [\"ArrowRight\", \"ArrowLeft\", \"ArrowUp\", \"ArrowDown\"];\n\nexport const SearchBoxDropdown = React.memo(({ options, callback, blockEvents }) => {\n  const ref = useRef();\n\n  return (\n    <Ref innerRef={ref}>\n      <Dropdown\n        fluid\n        scrolling\n        upward={false}\n        placeholder={\"<type to search>\"}\n        searchInput={{ autoFocus: !blockEvents }}\n        style={{ minWidth: \"12em\" }}\n        options={options.map((option) => {\n          return {\n            key: option.code,\n            value: option,\n            text: option.code + (option.tree ? \" (\" + option.tree + \")\" : \"\"),\n            content: (\n              <>\n                {option.code}\n                <br />\n                <span style={{ color: \"grey\" }}>{option.tree}</span>\n              </>\n            ),\n          };\n        })}\n        search\n        selection\n        compact\n        selectOnNavigation={false}\n        minCharacters={0}\n        autoComplete={\"on\"}\n        onChange={(e, d) => {\n          callback(d.value);\n        }}\n      />\n    </Ref>\n  );\n});\n\nexport const ButtonSelection = React.memo(({ options, callback, blockEvents }) => {\n  // render buttons for options (an array of objects with keys 'label' and 'color')\n  // On selection perform callback function with the button label as input\n  // if canDelete is TRUE, also contains a delete button, which passes null to callback\n  const [selected, setSelected] = useState(0);\n\n  const onKeydown = React.useCallback(\n    (event) => {\n      const nbuttons = options.length;\n\n      // any arrowkey\n      if (arrowKeys.includes(event.key)) {\n        event.preventDefault();\n\n        if (event.key === \"ArrowRight\") {\n          if (selected < nbuttons - 1) setSelected(selected + 1);\n        }\n\n        if (event.key === \"ArrowDown\") {\n          setSelected(moveDown(options, selected));\n        }\n\n        if (event.key === \"ArrowLeft\") {\n          if (selected > 0) setSelected(selected - 1);\n        }\n\n        if (event.key === \"ArrowUp\") {\n          setSelected(moveUp(options, selected));\n        }\n\n        return;\n      }\n\n      // delete\n      if (event.keyCode === 46) {\n        callback(null);\n        setSelected(0);\n      }\n\n      // space or enter\n      if (event.keyCode === 32 || event.keyCode === 13) {\n        event.preventDefault();\n        event.stopPropagation();\n\n        if (selected === options.length) {\n          callback(null); // this means delete button was selected\n        } else {\n          callback(options[selected]);\n        }\n        setSelected(0);\n      }\n    },\n    [selected, callback, options]\n  );\n\n  useEffect(() => {\n    if (!blockEvents) {\n      window.addEventListener(\"keydown\", onKeydown);\n    } else window.removeEventListener(\"keydown\", onKeydown);\n\n    return () => {\n      window.removeEventListener(\"keydown\", onKeydown);\n    };\n  }, [onKeydown, blockEvents]);\n\n  const mapButtons = () => {\n    return options.map((option, i) => {\n      return (\n        <>\n          <Ref innerRef={option.ref}>\n            <Button\n              style={{\n                backgroundColor: option.color,\n                padding: \"1em\",\n                margin: \"0.2em\",\n                flex: \"0.5 1 0\",\n                flexBasis: \"0\",\n                fontWeight: \"bold\",\n                fontSize: \"1em\",\n                border: i === selected ? \"3px solid black\" : \"3px solid #ece9e9\",\n              }}\n              key={option.code}\n              value={option}\n              compact\n              onMouseOver={() => setSelected(i)}\n              onClick={(e, d) => {\n                callback(d.value);\n                setSelected(0);\n              }}\n            >\n              {option.code}\n            </Button>\n          </Ref>\n        </>\n      );\n    });\n  };\n\n  return (\n    <div\n      style={{\n        display: \"flex\",\n        flexDirection: \"row\",\n        //alignItems: \"stretch\",\n        alignItems: \"space-eventy\",\n        maxWidth: \"100%\",\n        height: \"100%\",\n        flexWrap: \"wrap\",\n        justifyContent: \"space-around\",\n      }}\n    >\n      {mapButtons()}\n    </div>\n  );\n});\n\nexport const Annotinder = React.memo(({ swipeOptions, callback, swipe, blockEvents }) => {\n  // const left = options.find(option => option.swipe === \"left\");\n  // const up = options.find(option => option.swipe === \"up\");\n  // const right = options.find(option => option.swipe === \"right\");\n\n  useEffect(() => {\n    if (swipe) {\n      console.log(swipe);\n      if (swipe === \"right\") callback(swipeOptions.right);\n      if (swipe === \"up\") callback(swipeOptions.up);\n      if (swipe === \"left\") callback(swipeOptions.left);\n    }\n  }, [swipe, callback, swipeOptions]);\n\n  const onKeydown = React.useCallback(\n    (event) => {\n      // any arrowkey\n      if (arrowKeys.includes(event.key)) {\n        event.preventDefault();\n\n        if (event.key === \"ArrowRight\") callback(swipeOptions.right);\n        if (event.key === \"ArrowUp\") callback(swipeOptions.up);\n        if (event.key === \"ArrowLeft\") callback(swipeOptions.left);\n      }\n    },\n\n    [callback, swipeOptions]\n  );\n\n  useEffect(() => {\n    if (!blockEvents) {\n      window.addEventListener(\"keydown\", onKeydown);\n    } else window.removeEventListener(\"keydown\", onKeydown);\n\n    return () => {\n      window.removeEventListener(\"keydown\", onKeydown);\n    };\n  }, [onKeydown, blockEvents]);\n\n  return (\n    <div\n      style={{\n        display: \"flex\",\n        flexWrap: \"wrap\",\n        alignContent: \"stretch\",\n\n        height: \"100%\",\n      }}\n    >\n      {swipeOptions.up == null ? null : (\n        <Button\n          fluid\n          disabled={swipeOptions.up == null}\n          onClick={(e, d) => callback(swipeOptions.up)}\n          style={{\n            margin: \"0\",\n            padding: \"0\",\n            flex: \"1 1 auto\",\n            borderRadius: \"0\",\n            border: \"1px solid\",\n            background: swipeOptions.up?.color || \"white\",\n          }}\n        >\n          <div style={{ color: \"black\", fontWeight: \"bold\", fontSize: \"1em\" }}>\n            <Icon name={swipeOptions.up?.code ? \"arrow up\" : null} />\n            <span>{swipeOptions.up?.code || \"\"}</span>\n          </div>\n        </Button>\n      )}\n      <div style={{ flex: \"1 1 auto\" }}>\n        <div\n          style={{\n            padding: \"0\",\n            margin: \"0\",\n            display: \"flex\",\n            height: \"100%\",\n            flexWrap: \"wrap\",\n            alignContent: \"stretch\",\n          }}\n        >\n          <Button\n            disabled={swipeOptions.left == null}\n            onClick={(e, d) => callback(swipeOptions.left)}\n            style={{\n              margin: \"0\",\n              padding: \"0\",\n              flex: \"1 1 auto\",\n              width: \"45%\",\n              borderRadius: \"0\",\n              border: \"1px solid\",\n              background: swipeOptions.left?.color || \"white\",\n            }}\n          >\n            <div style={{ color: \"black\", fontWeight: \"bold\", fontSize: \"1em\" }}>\n              <Icon name={swipeOptions.left?.code ? \"arrow left\" : null} />\n              <span>{swipeOptions.left?.code || \"\"}</span>\n            </div>\n          </Button>\n          <Button\n            disabled={swipeOptions.right == null}\n            onClick={(e, d) => callback(swipeOptions.right)}\n            style={{\n              padding: \"0\",\n              margin: \"0\",\n              flex: \"1 1 auto\",\n              width: \"45%\",\n              borderRadius: \"0\",\n              border: \"1px solid\",\n              background: swipeOptions.right?.color || \"white\",\n            }}\n          >\n            <div style={{ color: \"black\", fontWeight: \"bold\", fontSize: \"1em\" }}>\n              <span>{swipeOptions.right?.code || \"\"}</span>\n              <Icon name={swipeOptions.right?.code ? \"arrow right\" : null} />\n            </div>\n          </Button>\n        </div>\n      </div>\n    </div>\n  );\n});\n","import React, { useState, useEffect, useRef } from \"react\";\nimport { Header, Button, Segment } from \"semantic-ui-react\";\nimport { SearchBoxDropdown, ButtonSelection, Annotinder } from \"./AnswerForms\";\n\nconst DONE_COLOR = \"lightgreen\";\nconst IRRELEVANT_COLOR = \"red\";\n\nconst QuestionForm = ({\n  unit,\n  tokens,\n  questions,\n  questionIndex,\n  setQuestionIndex,\n  setUnitIndex,\n  swipe,\n  blockEvents,\n}) => {\n  const [answerTransition, setAnswerTransition] = useState();\n  const answered = useRef(false); // to prevent answering double (e.g. with swipe events)\n  const [annotations, setAnnotations] = useState(null);\n\n  useEffect(() => {\n    prepareAnnotations(unit, tokens, questions, setAnnotations, setQuestionIndex);\n    answered.current = false;\n  }, [unit, tokens, setAnnotations, questions, setQuestionIndex]);\n\n  if (!questions || !unit || !annotations) return null;\n  if (!questions?.[questionIndex]) {\n    setQuestionIndex(0);\n    return null;\n  }\n\n  const question = prepareQuestion(unit, questions[questionIndex]);\n\n  const onSelect = (answer) => {\n    // write result to IDB/server and skip to next question or next unit\n    if (answered.current) return null;\n    answered.current = true;\n\n    annotations[questionIndex].value = answer.code;\n    unit.annotations = updateAnnotations(annotations[questionIndex], unit.annotations);\n    makeIrrelevant(unit, annotations, answer.makes_irrelevant, questionIndex);\n    unit.jobServer.postAnnotations(unit.unitId, unit.annotations);\n\n    setAnswerTransition(answer); // show given answer\n    setTimeout(() => {\n      // wait a little bit, so coder can see their answer and breathe\n      setAnswerTransition(null);\n\n      // check if there is a non irrelevant question remaining\n      let newQuestionIndex = null;\n      for (let i = questionIndex + 1; i < questions.length; i++) {\n        if (annotations[i].value === \"IRRELEVANT\") continue;\n        newQuestionIndex = i;\n        break;\n      }\n\n      // if none remain, go to next unit\n      if (newQuestionIndex === null) {\n        setUnitIndex((state) => state + 1);\n        setQuestionIndex(0);\n      } else {\n        setQuestionIndex(newQuestionIndex);\n      }\n\n      answered.current = false;\n    }, 250);\n  };\n\n  return (\n    <div style={{ height: \"100%\", width: \"100%\" }}>\n      <QuestionIndexStep\n        questions={questions}\n        questionIndex={questionIndex}\n        annotations={annotations}\n        setQuestionIndex={setQuestionIndex}\n      />\n\n      <div\n        style={{\n          display: \"flex\",\n          position: \"relative\",\n          flexFlow: \"column\",\n          height: \"calc(100% - 30px)\",\n          width: \"100%\",\n          maxHeight: \"100%\",\n          padding: \"10px\",\n          color: \"white\",\n          backgroundColor: \"#1B1C1D\",\n        }}\n      >\n        <div style={{ width: \"100%\", flex: \"1 1 auto\", paddingBottom: \"10px\" }}>\n          <Header as=\"h3\" style={{ color: \"white\" }}>\n            {question}\n          </Header>\n        </div>\n        <AnswerSegment\n          answerTransition={answerTransition}\n          currentAnswer={annotations?.[questionIndex]?.value}\n          questions={questions}\n          questionIndex={questionIndex}\n          onSelect={onSelect}\n          swipe={swipe}\n          blockEvents={blockEvents}\n        />\n      </div>\n    </div>\n  );\n};\n\nconst makeIrrelevant = (unit, annotations, makesIrrelevant, questionIndex) => {\n  // if answer has makes_irrelevant, marks these annotations as irrelevant,\n  // and adds irrelevant annotatons to unit.annotations\n  // (doesn't return anything, but changes the objects)\n  console.log(makesIrrelevant);\n  if (makesIrrelevant == null || makesIrrelevant === null) return unit;\n  const which = new Set();\n\n  for (let value of makesIrrelevant) {\n    if (value === \"remaining\") {\n      for (let i = questionIndex + 1; i < annotations.length; i++) which.add(i);\n    }\n    if (isNaN(value)) continue;\n    which.add(Number(value));\n  }\n\n  console.log(which);\n\n  for (let makeIrrelevant of which) {\n    annotations[makeIrrelevant].value = \"IRRELEVANT\";\n    unit.annotations = updateAnnotations(annotations[makeIrrelevant], unit.annotations);\n  }\n};\n\nconst prepareAnnotations = (unit, tokens, questions, setAnnotations, setQuestionIndex) => {\n  // create a list with annotations for each question, and see if they have been answered yet\n  if (tokens.length === 0) return null;\n  const annotations = [];\n  if (!unit.annotations) unit.annotations = [];\n  let questionIndex = 0;\n  for (let i = 0; i < questions.length; i++) {\n    const annotation = createAnnotationObject(tokens, questions[i], i);\n    annotation.value = getCurrentAnswer(unit.annotations, annotation);\n    if (annotation.value !== null) questionIndex = i;\n    annotations.push(annotation);\n  }\n  setAnnotations(annotations);\n  setQuestionIndex(questionIndex);\n};\n\nconst QuestionIndexStep = ({ questions, questionIndex, annotations, setQuestionIndex }) => {\n  //if (questions.length === 1) return null;\n  const [canSelect, setCanSelect] = useState();\n\n  useEffect(() => {\n    const cs = Array(annotations.length).fill(false);\n    cs[0] = true;\n    setCanSelect(cs);\n  }, [annotations, setCanSelect]);\n\n  useEffect(() => {\n    setCanSelect((state) => {\n      const newState = [...state];\n      newState[questionIndex] = true;\n      return newState;\n    });\n  }, [questionIndex, setCanSelect]);\n\n  const setColor = (i) => {\n    if (annotations[i].value === \"IRRELEVANT\") return [\"black\", IRRELEVANT_COLOR];\n    if (canSelect && i > questionIndex && !canSelect[i]) return [\"white\", \"grey\"];\n    if (annotations[i].value) return [\"black\", DONE_COLOR];\n    if (i === 0) return [DONE_COLOR, \"#1B1C1D\"];\n    if (canSelect && canSelect[i]) return [DONE_COLOR, \"#1B1C1D\"];\n    return [DONE_COLOR, \"grey\"];\n  };\n\n  return (\n    <div>\n      <Button.Group\n        fluid\n        style={{\n          border: \"1px solid\",\n          height: \"30px\",\n        }}\n      >\n        {questions.map((q, i) => {\n          const [color, background] = setColor(i);\n          return (\n            <Button\n              active={i === questionIndex}\n              style={{\n                padding: \"0em 0.2em 0.2em 0.2em\",\n\n                minWidth: \"2em\",\n                height: \"30px\",\n                borderRadius: \"0\",\n                fontSize: \"12px\",\n                border: \"1px solid darkgrey\",\n                background: background,\n                textOverflow: \"clip\",\n                overflow: \"hidden\",\n                color: color,\n              }}\n              onClick={() => {\n                if (canSelect[i]) {\n                  setQuestionIndex(i);\n                }\n              }}\n            >\n              {/* {i + 1} */}\n              <span title={questions[i].name}>{questions[i].name}</span>\n            </Button>\n          );\n        })}\n      </Button.Group>\n    </div>\n  );\n};\n\nconst AnswerSegment = ({\n  answerTransition,\n  currentAnswer,\n  questions,\n  questionIndex,\n  onSelect,\n  swipe,\n  blockEvents,\n}) => {\n  if (answerTransition)\n    return (\n      <Segment\n        style={{\n          display: \"flex\",\n          flex: \"1 1 auto\",\n          padding: \"0\",\n          overflowY: \"auto\",\n          height: \"100%\",\n          width: \"100%\",\n          margin: \"0\",\n          background: answerTransition.color,\n\n          justifyContent: \"center\",\n          alignItems: \"center\",\n        }}\n      >\n        <Header as=\"h1\">{answerTransition.code}</Header>\n      </Segment>\n    );\n  return (\n    <>\n      {showCurrent(currentAnswer || answerTransition)}\n      <Segment\n        style={{\n          flex: \"1 1 auto\",\n          padding: \"0\",\n          overflowY: \"auto\",\n          height: \"100%\",\n          width: \"100%\",\n          margin: \"0\",\n        }}\n      >\n        {questions[questionIndex].type === \"search code\" ? (\n          <SearchBoxDropdown\n            options={questions[questionIndex].options}\n            callback={onSelect}\n            blockEvents={blockEvents}\n          />\n        ) : null}\n        {questions[questionIndex].type === \"select code\" ? (\n          <ButtonSelection\n            options={questions[questionIndex].options}\n            callback={onSelect}\n            blockEvents={blockEvents}\n          />\n        ) : null}\n        {questions[questionIndex].type === \"annotinder\" ? (\n          <Annotinder\n            swipeOptions={questions[questionIndex].swipeOptions}\n            currentAnswer={currentAnswer}\n            callback={onSelect}\n            swipe={swipe}\n            blockEvents={blockEvents}\n          />\n        ) : null}\n      </Segment>\n    </>\n  );\n};\n\nconst createAnnotationObject = (tokens, question, questionIndex) => {\n  // creates an object with all information about the annotation except for the\n  // value. This lets us check whether the annotations already exists, and add\n  // or change the value.\n  if (tokens.length === 0) return null;\n\n  const sections = {};\n  const lastToken = tokens[tokens.length - 1];\n\n  const charspan = [0, lastToken.offset + lastToken.length];\n  const indexspan = [0, tokens.length - 1];\n  let [unitStarted, unitEnded] = [false, false];\n\n  let i = 0;\n  for (let token of tokens) {\n    if (token.codingUnit && !sections[token.section]) sections[token.section] = 1;\n    if (!unitStarted && token.codingUnit) {\n      unitStarted = true;\n      charspan[0] = token.offset;\n      indexspan[0] = i;\n    }\n    if (!unitEnded && !token.codingUnit && unitStarted) {\n      unitEnded = true;\n      charspan[1] = tokens[i - 1].offset + tokens[i - 1].length;\n      indexspan[1] = i - 1;\n    }\n    i++;\n  }\n\n  // make these optional? Because they're not tokenizer agnostic\n  const meta = {\n    length_tokens: 1 + indexspan[1] - indexspan[0],\n    length_paragraphs: 1 + tokens[indexspan[1]].paragraph - tokens[indexspan[0]].paragraph,\n    length_sentences: 1 + tokens[indexspan[1]].sentence - tokens[indexspan[0]].sentence,\n  };\n\n  return {\n    variable: `Q${questionIndex + 1}_${question.name.replace(\" \", \"_\")}`,\n    value: null,\n    section: Object.keys(sections).join(\" + \"),\n    offset: charspan[0],\n    length: charspan[1] - charspan[0],\n    meta,\n  };\n};\n\nconst sameQuestion = (x, y) => {\n  return (\n    x.variable === y.variable &&\n    x.section === y.section &&\n    x.offset === y.offset &&\n    x.length === y.length\n  );\n};\n\nconst getCurrentAnswer = (annotations, annotationObject) => {\n  if (!annotations) return null;\n  for (let annotation of annotations) {\n    if (sameQuestion(annotation, annotationObject)) return annotation.value;\n  }\n  return null;\n};\n\nconst updateAnnotations = (newAnnotation, annotations) => {\n  if (!annotations) annotations = [];\n  for (let i = 0; i < annotations.length; i++) {\n    if (sameQuestion(annotations[i], newAnnotation)) {\n      annotations[i] = newAnnotation;\n      return annotations;\n    }\n  }\n  annotations.push(newAnnotation);\n  return annotations;\n};\n\nconst showCurrent = (currentAnswer) => {\n  if (currentAnswer == null) return null;\n  return (\n    <div style={{ backgroundColor: \"white\", color: \"black\" }}>\n      <Segment\n        style={{\n          padding: \"0 0 0.5em 0\",\n          margin: \"0\",\n          borderRadius: \"0\",\n          background: \"#1B1C1D\",\n          color: DONE_COLOR,\n          textAlign: \"center\",\n        }}\n      >\n        <div style={{ marginTop: \"0.3em\" }}>\n          you answered:{\"  \"}\n          <b style={{ fontSize: \"1.5em\" }}>{`${currentAnswer}`}</b>\n        </div>\n      </Segment>\n    </div>\n  );\n};\n\nconst prepareQuestion = (unit, question) => {\n  let preparedQuestion = question.question;\n\n  if (preparedQuestion.search(\"\\\\[code\\\\]\") >= 0) {\n    if (unit.annotation) {\n      let code = unit.annotation.value;\n      const codeTag = `{{lightyellow###${code}}}`; // add optional color from itemquestions\n      preparedQuestion = preparedQuestion.replace(\"[code]\", codeTag);\n    }\n  }\n\n  return markedString(preparedQuestion);\n};\n\nconst markedString = (text) => {\n  const regex = new RegExp(/{{(.*?)}}/); // Match text inside two square brackets\n\n  text = text.replace(/(\\r\\n|\\n|\\r)/gm, \"\");\n  return (\n    <div>\n      {text.split(regex).reduce((prev, current, i) => {\n        if (i % 2 === 0) {\n          prev.push(current);\n        } else {\n          const [color, string] = current.split(\"###\");\n          prev.push(\n            <mark key={i + current} style={{ backgroundColor: color }}>\n              {string}\n            </mark>\n          );\n        }\n        return prev;\n      }, [])}\n    </div>\n  );\n};\n\nexport default React.memo(QuestionForm);\n","import React, { useState, useEffect, useRef } from \"react\";\nimport QuestionForm from \"./subcomponents/QuestionForm\";\nimport Document from \"components/Document/Document\";\nimport { useSwipeable } from \"react-swipeable\";\nimport { codeBookEdgesToMap, getCodeTreeArray } from \"util/codebook\";\nimport { Form, Icon, Input, Popup } from \"semantic-ui-react\";\nimport { useCookies } from \"react-cookie\";\nimport { useSelector } from \"react-redux\";\n\nconst documentSettings = {\n  centerVertical: true,\n};\n\nconst QuestionTask = ({ unit, codebook, setUnitIndex, blockEvents }) => {\n  const [tokens, setTokens] = useState([]);\n  const [questionIndex, setQuestionIndex] = useState(0);\n  const [questions, setQuestions] = useState(null);\n  const refs = { text: useRef(), box: useRef(), code: useRef() };\n  const [textReady, setTextReady] = useState(0);\n  const [cookies, setCookie] = useCookies([\"questionTaskSettings\"]);\n  const [settings, setSettings] = useState(\n    cookies.questionTaskSettings || { splitHeight: 60, textSize: 1 }\n  );\n  const divref = useRef(null);\n\n  useEffect(() => {\n    setCookie(\"questionTaskSettings\", JSON.stringify(settings), { path: \"/\" });\n  }, [settings, setCookie]);\n\n  useEffect(() => {\n    if (!codebook?.questions) return;\n    setQuestions(prepareQuestions(codebook));\n  }, [codebook]);\n\n  useEffect(() => {\n    if (!refs?.text.current) return null;\n    refs.box.current.style.backgroundColor = \"white\";\n    refs.text.current.style.transition = ``;\n    refs.box.current.style.transition = ``;\n    refs.box.current.style.opacity = 0;\n    refs.text.current.style.transform = \"translateX(0%) translateY(0%)\";\n  }, [refs.text, refs.box, unit, questionIndex]);\n\n  useEffect(() => {\n    if (!refs?.text.current) return null;\n    refs.box.current.style.transition = `opacity 200ms ease-out`;\n    refs.box.current.style.opacity = 1;\n  }, [textReady, refs.text, refs.box, questionIndex]);\n\n  // swipe controlls need to be up here due to working on the div wrapping the while question screen\n  // use separate swipe for text (document) and menu rows, to disable swiping up\n  // in text (which conflicts with scrolling)\n  const [swipe, setSwipe] = useState(null);\n  const textSwipe = useSwipeable(swipeControl(questions?.[questionIndex], refs, setSwipe, false));\n  const menuSwipe = useSwipeable(swipeControl(questions?.[questionIndex], refs, setSwipe, true));\n\n  if (!unit) return null;\n\n  return (\n    <div ref={divref} style={{ height: \"100%\" }}>\n      <div\n        {...textSwipe}\n        style={{\n          position: \"relative\",\n          border: \"1px solid\",\n          height: `${settings.splitHeight}%`,\n        }}\n      >\n        <div\n          ref={refs.box}\n          style={{\n            height: \"100%\",\n            width: \"100%\",\n            overflow: \"hidden\",\n            position: \"absolute\",\n          }}\n        >\n          {/* This div moves around behind the div containing the document to show the swipe code  */}\n          <div\n            ref={refs.code}\n            style={{ padding: \"0.6em 0.3em\", width: \"100%\", fontSize: \"3em\", position: \"absolute\" }}\n          />\n          <div\n            ref={refs.text}\n            style={{\n              border: \"1px solid\",\n              height: \"100%\",\n              position: \"absolute\",\n              top: \"0\",\n              backgroundColor: \"white\",\n              overflow: \"hidden\",\n              fontSize: `${settings.textSize}em`,\n            }}\n          >\n            <Document\n              unit={unit}\n              settings={documentSettings}\n              setReady={setTextReady}\n              returnTokens={setTokens}\n            />\n          </div>\n        </div>\n        <SettingsPopup settings={settings} setSettings={setSettings} />\n      </div>\n      <div {...menuSwipe} style={{ height: `${100 - settings.splitHeight}%` }}>\n        <QuestionForm\n          unit={unit}\n          tokens={tokens}\n          questions={questions}\n          questionIndex={questionIndex}\n          setQuestionIndex={setQuestionIndex}\n          setUnitIndex={setUnitIndex}\n          swipe={swipe}\n          blockEvents={blockEvents}\n        />\n      </div>\n    </div>\n  );\n};\n\nconst SettingsPopup = ({ settings, setSettings }) => {\n  const fullScreenNode = useSelector((state) => state.fullScreenNode);\n  console.log(fullScreenNode);\n  return (\n    <Popup\n      on=\"click\"\n      mountNode={fullScreenNode || undefined}\n      trigger={\n        <Icon\n          name=\"setting\"\n          style={{\n            position: \"absolute\",\n            cursor: \"pointer\",\n            top: \"0px\",\n            left: \"0px\",\n            color: \"grey\",\n            padding: \"5px 3px\",\n            height: \"30px\",\n          }}\n        />\n      }\n    >\n      <Form>\n        <Form.Group grouped>\n          <Form.Field>\n            <label>\n              text window size <font style={{ color: \"blue\" }}>{`${settings.splitHeight}%`}</font>\n            </label>\n            <Input\n              size=\"mini\"\n              step={2}\n              min={20}\n              max={80}\n              type=\"range\"\n              value={settings.splitHeight}\n              onChange={(e, d) => setSettings((state) => ({ ...state, splitHeight: d.value }))}\n            />\n          </Form.Field>\n          <Form.Field>\n            <label>\n              text size scaling <font style={{ color: \"blue\" }}>{`${settings.textSize}`}</font>\n            </label>\n            <Input\n              size=\"mini\"\n              step={0.025}\n              min={0.4}\n              max={1.2}\n              type=\"range\"\n              value={settings.textSize}\n              onChange={(e, d) => setSettings((state) => ({ ...state, textSize: d.value }))}\n            />\n          </Form.Field>\n        </Form.Group>\n      </Form>\n    </Popup>\n  );\n};\n\nconst prepareQuestions = (codebook) => {\n  const questions = codebook.questions;\n  return questions.map((question) => {\n    const codeMap = codeBookEdgesToMap(question.codes);\n    const cta = getCodeTreeArray(codeMap);\n    const [options, swipeOptions] = getOptions(cta);\n    return { ...question, options, swipeOptions }; // note that it's important that this deep copies question\n  });\n};\n\nconst getOptions = (cta) => {\n  const options = [];\n  const swipeOptions = {}; // object, for fast lookup in swipeControl\n\n  for (let code of cta) {\n    if (!code.active) continue;\n    if (!code.activeParent) continue;\n    let tree = code.tree.join(\" - \");\n    const option = {\n      code: code.code,\n      tree: tree,\n      makes_irrelevant: code.makes_irrelevant,\n      color: code.color,\n    };\n    if (code.swipe) swipeOptions[code.swipe] = option;\n    options.push(option);\n  }\n  return [options, swipeOptions];\n};\n\nconst swipeControl = (question, refs, setSwipe, doVertical, triggerdist = 150) => {\n  if (!question) return {};\n  if (question.type !== \"annotinder\") return {};\n  const transitionTime = 200;\n  // const blockSwipe = useRef()\n\n  const swipeConfig = {\n    delta: 10, // min distance(px) before a swipe starts. *See Notes*\n    preventDefaultTouchmoveEvent: false, // call e.preventDefault *See Details*\n    trackTouch: true, // track touch input\n    trackMouse: false, // track mouse input\n    rotationAngle: 0, // set a rotation angle\n  };\n\n  const getDeltas = (d) => {\n    let deltaX = d.deltaX;\n    let deltaY = d.deltaY;\n    if (Math.abs(deltaX) > Math.abs(deltaY) + 10) deltaY = 0;\n    if (Math.abs(deltaX) < Math.abs(deltaY) + 10) deltaX = 0;\n    if (!doVertical) deltaY = 0;\n    return [deltaX, deltaY];\n  };\n\n  return {\n    onSwiping: (d) => {\n      const [deltaX, deltaY] = getDeltas(d);\n      if (deltaX > 0 && !question.swipeOptions.right) return;\n      if (deltaX < 0 && !question.swipeOptions.left) return;\n      if (deltaY < 0 && !question.swipeOptions.up) return;\n      if (deltaY !== 0 && deltaY > 0) return;\n\n      refs.text.current.style.transition = ``;\n      refs.text.current.style.transform = `translateX(${deltaX}px) translateY(${deltaY}px)`;\n\n      let bgc = question.swipeOptions.up?.color;\n      let code = question.swipeOptions.up?.code;\n      let [bottom, talign] = [\"0%\", \"center\"];\n      if (deltaX > 0) {\n        bgc = question.swipeOptions.right?.color;\n        code = question.swipeOptions.right?.code;\n        [bottom, talign] = [\"40%\", \"left\"];\n      }\n      if (deltaX < 0) {\n        bgc = question.swipeOptions.left?.color;\n        code = question.swipeOptions.left?.code;\n        [bottom, talign] = [\"40%\", \"right\"];\n      }\n\n      refs.box.current.style.backgroundColor = bgc;\n      refs.code.current.innerText = code;\n      refs.code.current.style.bottom = bottom;\n      refs.code.current.style.textAlign = talign;\n    },\n    onSwiped: (d) => {\n      const [deltaX, deltaY] = getDeltas(d);\n      if (deltaX > 0 && !question.swipeOptions.right) return;\n      if (deltaX < 0 && !question.swipeOptions.left) return;\n      if (deltaY < 0 && !question.swipeOptions.up) return;\n      if (deltaY !== 0 && deltaY > 0) return;\n\n      refs.text.current.style.transition = `transform ${transitionTime}ms ease-out, opacity ${transitionTime}ms ease-out`;\n\n      if (Math.abs(deltaX) < triggerdist && Math.abs(deltaY) < triggerdist) {\n        refs.text.current.style.transform = `translateX(0%) translateY(0%)`;\n        //refs.box.current.style.backgroundColor = \"white\";\n      } else {\n        refs.text.current.style.transform = `translateX(${\n          deltaX > 0 ? 100 : deltaX < 0 ? -100 : 0\n        }%) translateY(${deltaY > 0 ? 100 : -100}%)`;\n        refs.box.current.style.transition = `opacity ${transitionTime}ms ease-out`;\n        refs.box.current.style.opacity = 0;\n\n        let dir = \"up\";\n        dir = deltaX > 0 ? \"right\" : \"left\";\n        setSwipe(dir);\n        setSwipe(null);\n      }\n    },\n    ...swipeConfig,\n  };\n};\n\nexport default React.memo(QuestionTask);\n","import React, { useState, useEffect } from \"react\";\nimport TaskSettings from \"./subcomponents/TaskSettings\";\nimport { Grid, Header } from \"semantic-ui-react\";\nimport useUnits from \"hooks/useUnits\";\nimport { standardizeUnits } from \"util/standardizeUnits\";\nimport { getCodebook } from \"util/codebook\";\nimport { useSelector } from \"react-redux\";\n\n// imported from annotator\nimport IndexController from \"components/Annotator/subcomponents/IndexController\";\nimport AnnotateTask from \"components/Annotator/AnnotateTask\";\nimport QuestionTask from \"components/Annotator/QuestionTask\";\n\nconst ManageTask = ({ codingjob }) => {\n  // When a new codingjob is loaded, set codingjobLoaded ref to false\n  // this prevents actually loading the data until unitSettings has loaded\n  // the unitSettings stored in the codingjob\n  const units = useUnits(codingjob);\n\n  if (!codingjob) return null;\n  let cwidths = [8, 8];\n  if (codingjob.taskSettings?.type) {\n    if (codingjob.taskSettings.type === \"annotate\") cwidths = [6, 10];\n    if (codingjob.taskSettings.type === \"questions\") cwidths = [8, 6];\n  }\n\n  return (\n    <div>\n      <Grid stackable columns={2}>\n        <Grid.Column verticalAlign=\"top\" stretched width={cwidths[0]}>\n          <Header textAlign=\"center\" style={{ background: \"#1B1C1D\", color: \"white\" }}>\n            Settings\n          </Header>\n          <TaskSettings codingjob={codingjob} />\n        </Grid.Column>\n        <Grid.Column width={cwidths[1]}>\n          <PreviewTask codingjob={codingjob} units={units} />\n        </Grid.Column>\n      </Grid>\n    </div>\n  );\n};\n\nconst PreviewTask = React.memo(({ codingjob, units }) => {\n  const [index, setIndex] = useState(null);\n  const [standardizedUnit, setStandardizedUnit] = useState(null);\n  const [codebook, setCodebook] = useState(null);\n\n  useEffect(() => {\n    if (!codingjob?.taskSettings) return;\n    setCodebook(getCodebook(codingjob.taskSettings));\n  }, [codingjob.taskSettings]);\n\n  useEffect(() => {\n    if (!units || index === null) {\n      setStandardizedUnit(null);\n      return null;\n    }\n    if (index >= units.length) return null;\n    standardizeUnits(codingjob, [units[index]]).then((singleUnitArray) => {\n      const previewUnit = singleUnitArray[0];\n      previewUnit.jobServer = { postAnnotations: (annotations) => console.log(annotations) }; // don't store annotations\n      previewUnit.rules = { canGoBack: true, canGoForward: true };\n      setStandardizedUnit(previewUnit);\n    });\n  }, [index, units, setStandardizedUnit, codingjob]);\n\n  if (!units) return null;\n\n  const renderTaskPreview = (type) => {\n    switch (type) {\n      case \"questions\":\n        return (\n          <PreviewQuestionTask\n            codebook={codebook}\n            standardizedUnit={standardizedUnit}\n            setUnitIndex={setIndex}\n          >\n            <IndexController n={units?.length} index={index} setIndex={setIndex} />\n          </PreviewQuestionTask>\n        );\n      case \"annotate\":\n        return (\n          <PreviewAnnotateTask\n            codebook={codebook}\n            standardizedUnit={standardizedUnit}\n            setUnitIndex={setIndex}\n          >\n            <IndexController n={units?.length} index={index} setIndex={setIndex} />\n          </PreviewAnnotateTask>\n        );\n      default:\n        return null;\n    }\n  };\n\n  if (!codingjob?.taskSettings?.type) return null;\n  return renderTaskPreview(codingjob.taskSettings.type);\n});\n\nconst PreviewQuestionTask = React.memo(({ children, codebook, standardizedUnit, setUnitIndex }) => {\n  if (!codebook) return null;\n  if (!codebook?.type === \"questions\") return null;\n\n  return (\n    <>\n      <Header\n        textAlign=\"center\"\n        style={{ maxWidth: \"400px\", background: \"#1B1C1D\", color: \"white\" }}\n      >\n        Preview\n        {children}\n      </Header>\n\n      <div\n        style={{\n          padding: \"0\",\n          maxWidth: \"400px\",\n          height: \"calc(100vh - 250px)\",\n          minHeight: \"500px\",\n          maxHeight: \"800px\",\n        }}\n      >\n        <div style={{ padding: \"0em\", paddingTop: \"1em\", height: \"100%\" }}>\n          <QuestionTask\n            unit={standardizedUnit}\n            codebook={codebook}\n            setUnitIndex={setUnitIndex}\n            blockEvents={true}\n          />\n        </div>\n      </div>\n    </>\n  );\n});\n\nconst PreviewAnnotateTask = ({ children, codebook, standardizedUnit, setUnitIndex }) => {\n  const blockEvents = useSelector((state) => state.eventsBlocked);\n  if (!codebook) return null;\n  if (codebook.type !== \"annotate\") return null;\n\n  return (\n    <>\n      <Header textAlign=\"center\" style={{ background: \"#1B1C1D\", color: \"white\" }}>\n        Preview\n      </Header>\n      {children}\n\n      <div\n        style={{\n          padding: \"0\",\n          width: \"100%\",\n          height: \"calc(100vh - 250px)\",\n          minHeight: \"500px\",\n        }}\n      >\n        <div style={{ padding: \"0\", height: \"100%\" }}>\n          <AnnotateTask\n            unit={standardizedUnit}\n            codebook={codebook}\n            setUnitIndex={setUnitIndex}\n            blockEvents={blockEvents}\n          />\n        </div>\n      </div>\n    </>\n  );\n};\n\nexport default React.memo(ManageTask);\n","import React, { useState, useEffect } from \"react\";\n\nimport { Icon, Form, Radio, Input } from \"semantic-ui-react\";\n\nimport db from \"apis/dexie\";\n\nconst defaultDeploySettings = {\n  medium: null,\n  nCoders: 1,\n  pctOverlap: 10,\n  //coders: [{ pctUnits: 100, pctOverlap: 10 }],\n};\n\nconst DeploySettings = ({ codingjob }) => {\n  const deploySettings = codingjob?.deploySettings || defaultDeploySettings;\n  const setDeploySettings = (us) => {\n    db.setCodingjobProp(codingjob, \"deploySettings\", us);\n  };\n\n  if (!deploySettings) return null;\n\n  return (\n    <div style={{ verticalAlign: \"top\", float: \"top\", paddingLeft: \"1em\" }}>\n      <DeployForm\n        codingjob={codingjob}\n        deploySettings={deploySettings}\n        setDeploySettings={setDeploySettings}\n      />\n    </div>\n  );\n};\n\nconst DeployForm = ({ codingjob, deploySettings, setDeploySettings }) => {\n  const [delayed, setDelayed] = useState(null); // delayed unitSettings\n  const totalUnits = codingjob?.unitSettings?.totalUnits || 0;\n\n  useEffect(() => {\n    setDelayed(deploySettings);\n  }, [deploySettings, setDelayed]);\n\n  useEffect(() => {\n    if (delayed === deploySettings) return null;\n    const timer = setTimeout(() => {\n      //const newDelayed = computeCoderShare(delayed);\n      setDeploySettings(delayed);\n    }, 300);\n    return () => clearTimeout(timer);\n  }, [delayed, deploySettings, setDeploySettings]);\n\n  const radioButton = (value, label) => {\n    return (\n      <Form.Field>\n        <Radio\n          value={value}\n          label={label}\n          checked={deploySettings.medium === value}\n          onChange={(e, d) =>\n            setDeploySettings({\n              ...deploySettings,\n              medium: value,\n            })\n          }\n        />\n      </Form.Field>\n    );\n  };\n\n  const amcatSettings = () => {\n    return <div></div>;\n  };\n  const fileSettings = () => {\n    if (deploySettings.medium !== \"file\") return null;\n    return (\n      <>\n        <br />\n        <Form.Group>\n          <Icon name=\"setting\" />\n          <label>Divide jobs</label>\n        </Form.Group>\n        <Form.Group>\n          <Form.Field width={5}>\n            <label>Coders</label>\n            <Input\n              size=\"mini\"\n              type=\"number\"\n              min={1}\n              value={delayed.nCoders}\n              onChange={(e, d) => setDelayed((state) => ({ ...state, nCoders: d.value }))}\n            />\n          </Form.Field>\n\n          <Form.Field width={7}>\n            <label>Overlap</label>\n            <Input\n              size=\"mini\"\n              type=\"number\"\n              step={1}\n              min={0}\n              max={100}\n              label=\"%\"\n              labelPosition=\"right\"\n              value={delayed.pctOverlap}\n              onChange={(e, d) => setDelayed((state) => ({ ...state, pctOverlap: d.value }))}\n            />\n          </Form.Field>\n\n          {/* <Form.Field width={5}>\n            <label>Off total units</label>\n            <Input\n              size=\"mini\"\n              type=\"number\"\n              step={1}\n              min={1}\n              max={100}\n              label=\"%\"\n              labelPosition=\"right\"\n              value={delayed.pctOfUnits}\n              onChange={(e, d) => setDelayed((state) => ({ ...state, pctOfUnits: d.value }))}\n            />\n          </Form.Field> */}\n          <CoderDistribution totalUnits={totalUnits} settings={delayed} />\n        </Form.Group>\n      </>\n    );\n  };\n\n  if (delayed === null) return null;\n\n  return (\n    <Form>\n      <Form.Group>\n        <Icon name=\"setting\" />\n        <label>Deploy medium</label>\n      </Form.Group>\n      <Form.Group grouped widths=\"equal\">\n        {radioButton(\"file\", \"File\")}\n        {radioButton(\"amcat\", \"AmCAT\")}\n      </Form.Group>\n      {amcatSettings()}\n      {fileSettings()}\n    </Form>\n  );\n};\n\n// const computeCoderShare = (settings) => {\n//   let coders = settings.coders.slice(0, settings.nCoders);\n//   const prevCoders = coders.length;\n//   const needCoders = settings.nCoders - prevCoders;\n\n//   for (let i = 0; i < needCoders; i++)\n//     coders.push({ pctUnits: 100 / prevCoders, pctOverlap: settings.pctOverlap });\n\n//   const totalPctUnits = coders.reduce((total, coder) => {\n//     return (total += coder.pctUnits);\n//   }, 0);\n\n//   coders = coders.map((coder) => ({\n//     ...coder,\n//     pctUnits: (coder.pctUnits = (100 * coder.pctUnits) / totalPctUnits),\n//   }));\n\n//   return { ...settings, coders };\n// };\n\nconst CoderDistribution = ({ totalUnits, settings }) => {\n  if (!settings) return null;\n\n  const overlapSet = Math.round((totalUnits * settings.pctOverlap) / 100);\n  const unitSet = totalUnits - overlapSet;\n\n  const avgPerCoder = overlapSet + unitSet / settings.nCoders;\n\n  return (\n    <p style={{ textAlign: \"center\", color: \"blue\" }}>\n      Avg. units per coder:{\" \"}\n      <b style={{ fontSize: \"1.3em\" }}>{Math.round(avgPerCoder * 100) / 100}</b>\n    </p>\n  );\n};\n\n// const CoderTable = ({ totalUnits, settings }) => {\n//   console.log(settings);\n//   if (!settings.coders) return null;\n\n//   const rows = () => {\n//     return settings.coders.map((coder, i) => {\n//       return (\n//         <Table.Row>\n//           <Table.Cell>{i + 1}</Table.Cell>\n//           <Table.Cell>{Math.round(coder.pctUnits * 100) / 100}</Table.Cell>\n//           <Table.Cell>{Math.ceil((coder.pctUnits / 100) * totalUnits)}</Table.Cell>\n//         </Table.Row>\n//       );\n//     });\n//   };\n\n//   return (\n//     <Table>\n//       <Table.Header>\n//         <Table.Row>\n//           <Table.HeaderCell>Coder</Table.HeaderCell>\n//           <Table.HeaderCell>% units</Table.HeaderCell>\n//           <Table.HeaderCell># units</Table.HeaderCell>\n//         </Table.Row>\n//       </Table.Header>\n//       <Table.Body>{rows()}</Table.Body>\n//     </Table>\n//   );\n// };\n\n// Also make an option for the type of deployment\n// unitlist: users receive single codingjob json with all units\n// unitchain: each unit contains a reference to the next unit\n\n// /**\n//  * A custom medium allows any backend to be used that can host codingjob jsons, and\n//  * has an address to POST annotations. The form lets the user define where to send the codingjob,\n//  * and where to\n//  * @returns\n//  */\n// const CustomMedium = () => {\n//   return <div></div>;\n// };\n\nexport default DeploySettings;\n","import db from \"apis/dexie\";\nimport SelectionTable from \"./SelectionTable\";\nimport { useLiveQuery } from \"dexie-react-hooks\";\nimport React, { useState, useEffect } from \"react\";\nimport { useHistory } from \"react-router\";\nimport { Button, Grid, Header, Popup, TextArea } from \"semantic-ui-react\";\nimport QRCode from \"qrcode.react\";\nimport { useCookies } from \"react-cookie\";\nimport newAmcatSession from \"apis/amcat\";\n\nconst homepage = \"/CCS_annotator\";\n\nconst DeployedJobs = () => {\n  const history = useHistory();\n  const [jobKey, setJobKey] = useState(null);\n\n  const setJobUrlQuery = async () => {\n    // set task.url as url query to open job in annotator\n    history.push(homepage + \"/annotator?url=\" + jobKey.url);\n  };\n\n  const linkAndQr = () => {\n    if (jobKey == null) return <div style={{ height: \"6em\" }} />;\n    const url = \"http://ccs-amsterdam.github.io/CCS_annotator/annotator?url=\" + jobKey?.url;\n    return (\n      <div style={{ height: \"6em\" }}>\n        <TextArea value={url} style={{ width: \"100%\", height: \"4em\", fontSize: \"10px\" }} />\n        <Popup hoverable trigger={<Button>Show QR code</Button>}>\n          <QRCode value={encodeURI(url)} size={128} />\n        </Popup>\n      </div>\n    );\n  };\n\n  return (\n    <Grid centered container>\n      <Grid.Row>\n        <Grid.Column width={8}>\n          <DeployedTable jobKey={jobKey} setJobKey={setJobKey} />\n        </Grid.Column>\n        <Grid.Column width={8}>\n          <Button primary disabled={!jobKey} onClick={setJobUrlQuery}>\n            Open selected codingjob\n          </Button>\n          <br />\n          <br />\n          {linkAndQr()}\n          <Header>Current annotations</Header>\n          <ResultsTable jobKey={jobKey} />\n        </Grid.Column>\n      </Grid.Row>\n    </Grid>\n  );\n};\n\nconst deployedTableColumns = [\n  {\n    Header: \"Title\",\n    accessor: \"title\",\n    headerClass: \"two wide\",\n  },\n  {\n    Header: \"URL\",\n    accessor: \"url\",\n    headerClass: \"four wide\",\n  },\n  {\n    Header: \"Created\",\n    accessor: \"created\",\n    headerClass: \"four wide\",\n  },\n];\n\nconst DeployedTable = ({ jobKey, setJobKey }) => {\n  const jobs = useLiveQuery(async () => {\n    let arr = await db.idb.deployedJobs.toArray();\n    arr.sort((a, b) => {\n      return b.created - a.created;\n    });\n\n    console.log(arr);\n    return arr.map((row) => ({ ...row, created: row.created.toDateString() }));\n  });\n\n  useEffect(() => {\n    if (!jobKey && jobs) {\n      setJobKey(jobs.length > 0 ? { ...jobs[0], ROW_ID: \"0\" } : null);\n    }\n  }, [jobKey, jobs, setJobKey]);\n\n  return (\n    <SelectionTable\n      columns={deployedTableColumns}\n      data={jobs ? jobs : []}\n      selectedRow={jobKey}\n      setSelectedRow={setJobKey}\n      defaultSize={15}\n    />\n  );\n};\n\nconst resultsTableColumns = [\n  {\n    Header: \"document_id\",\n    accessor: \"document_id\",\n    headerClass: \"three wide\",\n  },\n  {\n    Header: \"unit_id\",\n    accessor: \"unit_id\",\n    headerClass: \"two wide\",\n  },\n  {\n    Header: \"Coder\",\n    accessor: \"coder\",\n    headerClass: \"three wide\",\n  },\n  {\n    Header: \"Variable\",\n    accessor: \"variable\",\n    headerClass: \"three wide\",\n  },\n  {\n    Header: \"Value\",\n    accessor: \"value\",\n    headerClass: \"three wide\",\n  },\n];\n\nconst ResultsTable = ({ jobKey }) => {\n  const [annotations, setAnnotations] = useState([]);\n  const [cookies] = useCookies([\"amcat\"]);\n\n  console.log(cookies);\n\n  useEffect(() => {\n    if (!jobKey) return null;\n    if (!cookies.amcat) return null;\n    const amcat = newAmcatSession(cookies.amcat.host, cookies.amcat.email, cookies.amcat.token);\n    setAnnotations([]);\n    getResultUrl(jobKey, amcat, setAnnotations);\n  }, [jobKey, cookies, setAnnotations]);\n\n  return <SelectionTable columns={resultsTableColumns} data={annotations} />;\n};\n\nconst getResultUrl = async (jobKey, amcat, setAnnotations) => {\n  let job = await db.idb.deployedJobs.get({ url: jobKey.url });\n\n  console.log(job);\n  if (!job) return;\n\n  if (!amcat) return;\n  try {\n    const res = await amcat.api.get(jobKey.url);\n    const annotations = res.data.units.reduce((arr, unit, i) => {\n      if (unit.annotations) {\n        for (let coder of Object.keys(unit.annotations)) {\n          for (let ann of unit.annotations[coder]) {\n            arr.push({\n              document_id: unit.document_id,\n              unit_id: i,\n              coder,\n              ...unit.meta,\n              ...ann,\n            });\n          }\n        }\n      }\n      return arr;\n    }, []);\n    console.log(annotations);\n    setAnnotations(annotations);\n  } catch (e) {\n    console.log(e);\n  }\n};\n\nexport default DeployedJobs;\n","import React, { useState, useEffect } from \"react\";\nimport DeploySettings from \"./subcomponents/DeploySettings\";\nimport useUnits from \"hooks/useUnits\";\nimport { Grid, Header, Button, Form } from \"semantic-ui-react\";\nimport { saveAs } from \"file-saver\";\nimport JSZip from \"jszip\";\n\nimport db from \"apis/dexie\";\nimport { drawRandom } from \"util/sample\";\nimport { standardizeUnits } from \"util/standardizeUnits\";\nimport { getCodebook } from \"util/codebook\";\nimport DeployedJobs from \"./subcomponents/DeployedJobs\";\nimport { useCookies } from \"react-cookie\";\nimport newAmcatSession from \"apis/amcat\";\n\nconst DeployCodingjob = ({ codingjob }) => {\n  const [codingjobPackage, setCodingjobPackage] = useState(null);\n  const units = useUnits(codingjob);\n\n  useEffect(() => {\n    if (!units || units.length === 0) return;\n    if (!codingjob?.unitSettings || !codingjob?.taskSettings || !codingjob?.deploySettings) return;\n\n    const includeDocuments = codingjob.deploySettings.medium === \"file\";\n    createCodingjobPackage(codingjob, units, setCodingjobPackage, includeDocuments);\n  }, [codingjob, units, setCodingjobPackage]);\n\n  const deployButton = (medium) => {\n    if (!medium) return null;\n    switch (codingjob.deploySettings.medium) {\n      case \"file\":\n        return <DownloadButton codingjobPackage={codingjobPackage} />;\n      case \"amcat\":\n        return <AmcatDeploy codingjobPackage={codingjobPackage} />;\n      default:\n        return null;\n    }\n  };\n\n  const viewDeployed = () => {\n    if (!codingjob?.deploySettings?.medium) return null;\n    if (codingjob.deploySettings.medium !== \"amcat\") return null;\n    return (\n      <Grid.Column width={11}>\n        <Header textAlign=\"center\" style={{ background: \"#1B1C1D\", color: \"white\" }}>\n          Previously deployed jobs\n        </Header>\n        <DeployedJobs />\n      </Grid.Column>\n    );\n  };\n\n  if (!codingjob) return null;\n\n  return (\n    <div>\n      <Grid centered stackable columns={2}>\n        <Grid.Column width={5}>\n          <Header textAlign=\"center\" style={{ background: \"#1B1C1D\", color: \"white\" }}>\n            Deploy Codingjob\n          </Header>\n          <DeploySettings codingjob={codingjob} />\n          <br />\n          {deployButton(codingjob?.deploySettings?.medium)}\n        </Grid.Column>\n        {viewDeployed()}\n      </Grid>\n    </div>\n  );\n};\n\nconst DownloadButton = ({ codingjobPackage }) => {\n  const [title, setTitle] = useState(\"\");\n\n  useEffect(() => {\n    if (codingjobPackage?.title) setTitle(codingjobPackage.title);\n  }, [codingjobPackage]);\n\n  const onDownload = async () => {\n    const cjSets = createCoderSets(codingjobPackage);\n\n    const zip = new JSZip();\n    zip.file(`AmCAT_annotator_${codingjobPackage.title}.json`, JSON.stringify(codingjobPackage));\n    for (let i = 0; i < cjSets.length; i++) {\n      const fname = `set_${cjSets[i].set}_units_${cjSets[i].units.length}_${codingjobPackage.title}.json`;\n      zip.file(fname, JSON.stringify(cjSets[i]));\n    }\n\n    const content = await zip.generateAsync({ type: \"blob\" });\n    saveAs(content, `AmCAT_annotator_${codingjobPackage.title}.zip`);\n\n    // codingjobPackage.title = title;\n    // const json = [JSON.stringify(codingjobPackage)];\n    // const blob = new Blob(json, { type: \"text/plain;charset=utf-8\" });\n\n    // try {\n    //   fileDownload(blob, `AmCAT_annotator_${codingjobPackage.title}.json`);\n    //   //const url = objectHash(codingjobPackage);\n    //   //db.uploadTask(codingjobPackage, url, \"local\");\n    // } catch (error) {\n    //   console.error(\"\" + error);\n    // }\n  };\n\n  return (\n    <div>\n      <Form onSubmit={() => onDownload()}>\n        <Form.Input\n          placeholder=\"username\"\n          value={title}\n          maxLength={30}\n          onChange={(e, d) => setTitle(d.value)}\n          autoFocus\n          style={{ width: \"100%\" }}\n        />\n      </Form>\n      <br />\n\n      <Button\n        primary\n        fluid\n        loading={codingjobPackage === null}\n        disabled={title.length < 5}\n        onClick={onDownload}\n      >\n        {title.length < 5 ? \"please use 5 characters or more\" : \"Download codingjob files\"}{\" \"}\n      </Button>\n    </div>\n  );\n};\n\nconst AmcatDeploy = ({ codingjobPackage }) => {\n  const [title, setTitle] = useState(\"\");\n  const [cookies, , removeCookie] = useCookies([\"amcat\"]);\n\n  useEffect(() => {\n    if (codingjobPackage?.title) setTitle(codingjobPackage.title);\n  }, [codingjobPackage]);\n\n  const deploy = async () => {\n    const amcat = newAmcatSession(cookies.amcat.host, cookies.amcat.email, cookies.amcat.token);\n    try {\n      const id = await amcat.postCodingjob(codingjobPackage, title);\n      const url = `${amcat.host}/codingjob/${id.data.id}`;\n      db.createDeployedJob(title, url);\n    } catch (e) {\n      console.log(e);\n      removeCookie(\"amcat\");\n    }\n  };\n\n  if (!cookies.amcat) return <p>You need to log in to AmCAT first. (see top-right in the menu)</p>;\n\n  return (\n    <div>\n      <Form onSubmit={() => deploy()}>\n        <Form.Input\n          placeholder=\"username\"\n          value={title}\n          maxLength={30}\n          onChange={(e, d) => setTitle(d.value)}\n          autoFocus\n          style={{ width: \"100%\" }}\n        />\n      </Form>\n      <br />\n\n      <Button fluid primary disabled={title.length < 5} onClick={() => deploy()}>\n        {title.length < 5 ? \"please use 5 characters or more\" : \"Upload to AmCAT\"}\n      </Button>\n    </div>\n  );\n};\n\nconst createCoderSets = (codingjobPackage) => {\n  const unitSettings = codingjobPackage.provenance.unitSettings;\n  const deploySettings = codingjobPackage.provenance.deploySettings;\n  const units = codingjobPackage.units;\n\n  const nOverlap = Math.round((unitSettings.totalUnits * deploySettings.pctOverlap) / 100);\n  //const n = totalSet - overlapSet\n\n  const overlapSet = units.slice(0, nOverlap);\n  const unitSet = units.slice(nOverlap);\n\n  let unitSets = Array(Number(deploySettings.nCoders))\n    .fill([])\n    .map((set) => [...overlapSet]);\n  for (let i = 0; i < unitSet.length; i++) {\n    unitSets[i % unitSets.length].push(unitSet[i]);\n  }\n\n  return unitSets.map((us, i) => ({\n    set: i + 1,\n    title: codingjobPackage.title,\n    codebook: codingjobPackage.codebook,\n    units: drawRandom(us, us.length, false, 42, null),\n  }));\n};\n\nconst createCodingjobPackage = async (\n  codingjob,\n  units,\n  setCodingjobPackage,\n  includeDocuments = false\n) => {\n  const cjpackage = {\n    title: codingjob.name,\n    provenance: { unitSettings: codingjob.unitSettings, deploySettings: codingjob.deploySettings },\n    codebook: getCodebook(codingjob.taskSettings),\n    units: await standardizeUnits(codingjob, units),\n    rules: {},\n    annotations: [],\n  };\n  if (includeDocuments)\n    cjpackage.provenance.documents = await db.idb.documents\n      .where(\"job_id\")\n      .equals(codingjob.job_id)\n      .toArray();\n\n  setCodingjobPackage(cjpackage);\n};\n\nexport default DeployCodingjob;\n","import React, { useState } from \"react\";\n\nimport { Segment, Step } from \"semantic-ui-react\";\n\nimport db from \"apis/dexie\";\nimport { useLiveQuery } from \"dexie-react-hooks\";\n\nimport CodingjobSelector from \"./1_CodingjobSelector\";\nimport ManageDocuments from \"./2_ManageDocuments\";\nimport ManageCodingUnits from \"./3_ManageCodingUnits\";\nimport ManageTask from \"./4_ManageTask\";\nimport DeployCodingjob from \"./5_DeployCodingjob\";\n\nconst CodingjobManager = () => {\n  const [menuItem, setMenuItem] = useState(\"codingjobs\");\n  const [selectedCodingjob, setSelectedCodingjob] = useState(null);\n\n  const codingjob = useLiveQuery(() => {\n    // retrieve codingjob from Dexie whenever selectedCodingjob changes OR dexie is updated\n    if (selectedCodingjob) {\n      return db.idb.codingjobs\n        .get(selectedCodingjob.job_id)\n        .then((cj) => {\n          return { ...cj, ROW_ID: selectedCodingjob.ROW_ID };\n        })\n        .catch((e) => {\n          console.log(e);\n        });\n    }\n  }, [selectedCodingjob]);\n\n  const nDocuments = useLiveQuery(() => {\n    if (!codingjob?.job_id) return 0;\n    return db.idb.documents.where(\"job_id\").equals(codingjob.job_id).count();\n  }, [codingjob]);\n\n  const renderSwitch = (menuItem) => {\n    switch (menuItem) {\n      case \"codingjobs\":\n        return (\n          <CodingjobSelector codingjob={codingjob} setSelectedCodingjob={setSelectedCodingjob} />\n        );\n      case \"documents\":\n        return <ManageDocuments codingjob={codingjob} />;\n      case \"units\":\n        return <ManageCodingUnits codingjob={codingjob} />;\n      case \"task\":\n        return <ManageTask codingjob={codingjob} />;\n      case \"deploy\":\n        return <DeployCodingjob codingjob={codingjob} />;\n      default:\n        return null;\n    }\n  };\n  return (\n    <div style={{ margin: \"1em\" }}>\n      <Step.Group ordered unstackable size=\"tiny\" style={{ width: \"100%\", overflow: \"auto\" }}>\n        <Step\n          title=\"Codingjob\"\n          description={codingjob ? codingjob.name : \"none selected\"}\n          active={menuItem === \"codingjobs\"}\n          completed={codingjob !== null && codingjob != null}\n          onClick={(e, d) => {\n            setMenuItem(\"codingjobs\");\n          }}\n        />\n        <Step\n          title=\"Documents\"\n          description={nDocuments > 0 ? `${nDocuments} documents` : \"\"}\n          active={menuItem === \"documents\"}\n          completed={nDocuments > 0}\n          disabled={codingjob === null}\n          onClick={(e, d) => setMenuItem(\"documents\")}\n        />\n        <Step\n          title=\"Units\"\n          description={codingjob?.unitSettings?.n ? `${codingjob?.unitSettings?.n} units` : null}\n          active={menuItem === \"units\"}\n          completed={codingjob?.unitSettings?.n}\n          disabled={nDocuments === 0}\n          onClick={(e, d) => setMenuItem(\"units\")}\n        />\n        <Step\n          title=\"Task\"\n          description={codingjob?.taskSettings?.type || \"Define the task\"}\n          active={menuItem === \"task\"}\n          completed={codingjob?.taskSettings?.type}\n          disabled={!codingjob?.unitSettings?.n}\n          onClick={(e, d) => setMenuItem(\"task\")}\n        />\n        <Step\n          title=\"Deploy\"\n          description={\"Get (others) to work\"}\n          active={menuItem === \"deploy\"}\n          disabled={\n            codingjob === null || !codingjob?.unitSettings?.n || !codingjob?.taskSettings?.type\n          }\n          onClick={(e, d) => setMenuItem(\"deploy\")}\n        />\n      </Step.Group>\n\n      <Segment style={{ border: \"0\" }} attached=\"bottom\">\n        {renderSwitch(menuItem)}\n      </Segment>\n    </div>\n  );\n};\n\nexport default React.memo(CodingjobManager);\n","import React, { useState, useEffect } from \"react\";\nimport db from \"apis/dexie\";\nimport { Button } from \"semantic-ui-react\";\n\nimport { CSVDownloader } from \"react-papaparse\";\n\nconst DownloadAnnotations = ({ localJobServer }) => {\n  const [data, setData] = useState(null);\n\n  useEffect(() => {\n    switch (localJobServer.codebook.type) {\n      case \"annotate\":\n        formatAnnotateTaskResults(localJobServer, setData);\n        break;\n      case \"questions\":\n        formatQuestionsTaskResults(localJobServer, setData);\n        break;\n      default:\n        return null;\n    }\n  }, [localJobServer]);\n\n  console.log(localJobServer);\n  return (\n    <CSVDownloader\n      filename={`CSSannotator_${localJobServer.title}_${localJobServer.set}_${localJobServer.coderName}.json`}\n      data={data}\n      style={{ cursor: \"pointer\" }}\n    >\n      <Button\n        loading={data === null}\n        primary\n        content=\"Download results\"\n        icon=\"download\"\n        labelPosition=\"left\"\n        size=\"huge\"\n      />\n    </CSVDownloader>\n  );\n};\n\nconst formatAnnotateTaskResults = async (localJobServer, setData) => {\n  // annotate results are returned in long format\n};\n\nconst formatQuestionsTaskResults = async (localJobServer, setData) => {\n  // questions results are returned in wide format\n  const results = [];\n\n  // variables of annotations are formatted as Q[question index]_[question name]\n  // question index starts at 1, and spaces in question name are replaced with underscores\n  const variables = localJobServer.codebook.questions.map(\n    (question, i) => `Q${i + 1}_${question.name.replace(\" \", \"_\")}`\n  );\n\n  const unitMap = localJobServer.units.reduce((obj, unit) => {\n    obj[unit.unit_id] = unit;\n    return obj;\n  }, {});\n\n  const annotationsPerUnit = await db.getAllAnnotations(localJobServer.id);\n  for (let unitAnnotations of annotationsPerUnit) {\n    const annotations = unitAnnotations.annotations;\n    console.log(annotations);\n    const unit = unitMap[unitAnnotations.unit_id];\n    const result = {\n      document_id: unit.document_id,\n      unit_id: unit.unit_id,\n      ...unit.meta,\n      offset: annotations[0].offset,\n      length: annotations[0].length,\n      section: annotations[0].section,\n      ...annotations[0].meta,\n    };\n    for (let variable of variables) {\n      const a = annotations.find((annotation) => annotation.variable === variable);\n      result[variable] = a == null ? null : a.value;\n    }\n    results.push(result);\n  }\n  setData(results);\n};\n\nexport default DownloadAnnotations;\n","import React, { useEffect, useState } from \"react\";\nimport { FullScreen } from \"react-full-screen\";\nimport { setFullScreenNode } from \"actions\";\nimport { useDispatch } from \"react-redux\";\n\n// This is due to a bug in react-full-screen\n// https://github.com/Semantic-Org/Semantic-UI-React/issues/4191\n\n// It's basically the workaround provided by layershifter, but using redux\n// to make the ref available to the (very deeply nested) popup that needs it\n\nconst FullScreenFix = ({ handle, children }) => {\n  return (\n    <FullScreen handle={handle}>\n      <DOMNodeProvider>\n        {(node) => {\n          return children;\n        }}\n      </DOMNodeProvider>\n      ;\n    </FullScreen>\n  );\n};\n\nconst DOMNodeProvider = ({ children }) => {\n  const [node, setNode] = useState(null);\n  const dispatch = useDispatch();\n\n  useEffect(() => {\n    dispatch(setFullScreenNode(node));\n    return () => {\n      dispatch(setFullScreenNode(null));\n    };\n  }, [node, dispatch]);\n\n  return (\n    <div className=\"dom-node-provider\" ref={setNode}>\n      {children(node)}\n    </div>\n  );\n};\n\nexport default FullScreenFix;\n","import React, { useState, useEffect } from \"react\";\nimport { useLocation, useHistory } from \"react-router\";\nimport { Icon, Grid, Modal, Button, Header } from \"semantic-ui-react\";\nimport { useFullScreenHandle } from \"react-full-screen\";\n\nimport DownloadAnnotations from \"./subcomponents/DownloadAnnotations\";\n\nimport FullScreenFix from \"./subcomponents/FullScreenFix\";\nimport IndexController from \"./subcomponents/IndexController\";\n\nimport QuestionTask from \"components/Annotator/QuestionTask\";\nimport AnnotateTask from \"components/Annotator/AnnotateTask\";\n\nconst AnnotatorScreen = ({ jobServer }) => {\n  const fsHandle = useFullScreenHandle();\n  const [unitIndex, setUnitIndex] = useState(0);\n  const [preparedUnit, setPreparedUnit] = useState(null);\n  const location = useLocation();\n\n  useEffect(() => {\n    setUnitIndex(jobServer.progressIndex);\n  }, [jobServer, setUnitIndex]);\n\n  useEffect(() => {\n    if (!jobServer) return;\n    jobServer\n      .getUnit(unitIndex)\n      .then((unit) => {\n        setPreparedUnit({\n          jobServer,\n          unitId: unit.id,\n          ...unit.unit,\n        });\n      })\n      .catch((e) => {\n        if (e.response?.status === 404) {\n          alert(\"Could not get unit from server\");\n          setPreparedUnit(null);\n          // if (unitIndex !== null && unitIndex < jobServer.rules.n)\n          //   setUnitIndex((state) => state + 1);\n          console.log(e);\n        }\n      });\n  }, [unitIndex, jobServer, setUnitIndex, setPreparedUnit]);\n\n  let maxWidth = \"100%\";\n  let maxHeight = \"100%\";\n  if (jobServer?.codebook?.type) {\n    if (jobServer?.codebook.type === \"questions\") [maxWidth, maxHeight] = [\"800px\", \"1000px\"];\n    if (jobServer?.codebook.type === \"annotate\") [maxWidth, maxHeight] = [\"2000px\", \"2000px\"];\n  }\n\n  const renderTask = () => {\n    if (unitIndex === null) return <Finished jobServer={jobServer} />;\n    return <Task codebook={jobServer?.codebook} unit={preparedUnit} setUnitIndex={setUnitIndex} />;\n  };\n\n  return (\n    <FullScreenFix handle={fsHandle}>\n      <div\n        style={{\n          maxWidth,\n          maxHeight,\n          background: \"white\",\n          margin: \"0 auto\",\n          padding: \"0\",\n          height: \"100vh\",\n          border: \"1px solid white\",\n        }}\n      >\n        <AskFullScreenModal location={location} handle={fsHandle} />\n        <div style={{ height: \"50px\", padding: \"0\", position: \"relative\" }}>\n          <div style={{ width: \"85%\", paddingLeft: \"7.5%\" }}>\n            <IndexController\n              n={jobServer?.rules.n}\n              index={unitIndex}\n              setIndex={setUnitIndex}\n              canGoBack={jobServer?.rules.canGoBack}\n              canGoForward={jobServer?.rules.canGoForward}\n            />\n          </div>\n          <div>\n            <FullScreenButton handle={fsHandle} />\n            <ExitButton />\n          </div>\n        </div>\n        <div style={{ height: \"calc(100% - 50px)\", padding: \"0\" }}>{renderTask()}</div>\n      </div>\n    </FullScreenFix>\n  );\n};\n\nconst Finished = ({ jobServer }) => {\n  if (!jobServer) return null;\n\n  if (jobServer.where === \"remote\") {\n    return (\n      <Grid container centered verticalAlign=\"middle\" style={{ margin: \"0\", padding: \"0\" }}>\n        <Grid.Row style={{ marginTop: \"40vh\" }}>\n          <div>\n            <Icon name=\"flag checkered\" size=\"huge\" style={{ transform: \"scale(5)\" }} />\n          </div>\n        </Grid.Row>\n      </Grid>\n    );\n  } else {\n    return (\n      <Grid container centered verticalAlign=\"middle\" style={{ margin: \"0\", padding: \"0\" }}>\n        <Grid.Row style={{ marginTop: \"40vh\" }}>\n          <Grid.Column width={4}>\n            <Icon name=\"flag checkered\" size=\"huge\" style={{ transform: \"scale(1)\" }} />\n          </Grid.Column>\n          <Grid.Column width={8}>\n            <Header>You finished the codingjob!</Header>\n            <p>Please download your results and send them to whoever gave you this job. </p>\n            <DownloadAnnotations localJobServer={jobServer} />\n          </Grid.Column>\n        </Grid.Row>\n      </Grid>\n    );\n  }\n};\n\nconst AskFullScreenModal = ({ location, handle }) => {\n  const [askFullscreen, setAskFullscreen] = useState(true);\n  useEffect(() => {\n    setAskFullscreen(true);\n  }, [location, setAskFullscreen]);\n\n  return (\n    <Modal open={askFullscreen}>\n      <Modal.Header>Fullscreen mode</Modal.Header>\n      <Modal.Content>\n        <p>\n          We recommend working in fullscreen, especially on mobile devices. You can always change\n          this with the button in the top-left corner\n        </p>\n        <div style={{ display: \"flex\", height: \"30vh\" }}>\n          <Button\n            primary\n            size=\"massive\"\n            onClick={() => {\n              if (!handle.active) handle.enter();\n              setAskFullscreen(false);\n            }}\n            style={{ flex: \"1 1 auto\" }}\n          >\n            Fullscreen\n          </Button>\n          <Button\n            secondary\n            size=\"massive\"\n            onClick={() => {\n              if (handle.active) handle.exit();\n              setAskFullscreen(false);\n            }}\n            style={{ flex: \"1 1 auto\" }}\n          >\n            Windowed\n          </Button>\n        </div>\n      </Modal.Content>\n    </Modal>\n  );\n};\n\nconst FullScreenButton = ({ handle }) => {\n  return (\n    <Icon.Group\n      size=\"big\"\n      style={{ padding: \"3px\", position: \"absolute\", top: \"0px\", left: \"2px\" }}\n    >\n      <Icon\n        link\n        name={handle.active ? \"compress\" : \"expand\"}\n        onClick={() => {\n          handle.active ? handle.exit() : handle.enter();\n        }}\n      />\n    </Icon.Group>\n  );\n};\n\nconst ExitButton = () => {\n  const history = useHistory();\n  return (\n    <Icon.Group size=\"big\" style={{ padding: \"3px\", position: \"absolute\", top: \"0px\", right: 0 }}>\n      <Icon link name=\"window close\" onClick={() => history.goBack()} />\n      <Icon corner=\"top right\" />\n    </Icon.Group>\n  );\n};\n\nconst Task = ({ codebook, unit, setUnitIndex }) => {\n  if (!codebook || !unit) return null;\n\n  const renderTaskPreview = (type) => {\n    switch (type) {\n      case \"questions\":\n        return <QuestionTask unit={unit} codebook={codebook} setUnitIndex={setUnitIndex} />;\n      case \"annotate\":\n        return <AnnotateTask unit={unit} codebook={codebook} setUnitIndex={setUnitIndex} />;\n      default:\n        return null;\n    }\n  };\n\n  if (!codebook?.type) return null;\n  return renderTaskPreview(codebook.type);\n};\n\nexport default AnnotatorScreen;\n","import axios from \"axios\";\nimport db from \"apis/dexie\";\n\n/**\n * Class for jobs hosted on a server\n */\nexport class JobServerRemote {\n  constructor(url, coderName) {\n    this.url = url;\n    this.coderName = coderName;\n    this.where = \"remote\";\n  }\n\n  async init() {\n    // needs to be called in order to fetch codebook/rules\n    let response;\n    try {\n      response = await axios.get(`${this.url}/codebook`);\n    } catch (e) {\n      this.success = false;\n      return;\n    }\n    this.success = true;\n    this.codebook = response.data;\n\n    // this should come from rules\n    this.rules = { n: 20, canGoBack: false, canGoForward: false };\n\n    // this should somehow be provided by amcat\n    this.progressIndex = 0;\n  }\n\n  async getUnit(i) {\n    //\n    const response = await axios.get(`${this.url}/unit?user=${this.coderName}`);\n    return response.data;\n    // data should be an object with url, id and unit, where unit is an object with at least text_fields,\n    // and if available annotations\n  }\n\n  postAnnotations(unit_id, data) {\n    axios.post(`${this.url}/unit/${unit_id}/annotation?user=${this.coderName}`, data);\n  }\n}\n\n/**\n * Class for jobs using local data in Indexed DB\n */\nexport class JobServerLocal {\n  constructor(id, coderName) {\n    this.id = id;\n    this.coderName = coderName;\n    this.where = \"local\";\n  }\n\n  async init() {\n    // needs to be called in order to fetch codebook/rules\n    let job = await db.idb.localJobs.get({ id: this.id });\n    if (!job) {\n      this.success = false;\n      return null;\n    }\n\n    this.success = true;\n    this.units = job.units;\n    this.codebook = job.codebook;\n    this.title = job.title;\n    this.set = job.set;\n    this.rules = { n: job.units.length, canGoBack: true, canGoForward: false };\n\n    this.progressIndex = job.progressIndex || 0;\n  }\n\n  async getUnit(i) {\n    if (i !== null) {\n      // on get unit, also update progress.\n      // progressindex is the index of the currently fetched unit.\n      await db.idb.localJobs\n        .where(\"id\")\n        .equals(this.id)\n        .modify({ progressIndex: Math.max(i, this.progressIndex), last_modified: new Date() });\n    }\n\n    const unit_id = this.units[i].unit_id;\n    let annotations = await db.getUnitAnnotations(this.id, unit_id);\n    annotations = annotations?.annotations || [];\n\n    return {\n      id: unit_id,\n      unit: { ...this.units[i], annotations },\n    };\n  }\n\n  async postAnnotations(unit_id, data) {\n    db.postAnnotations(this.id, unit_id, data);\n  }\n}\n","import React, { useState, useEffect } from \"react\";\nimport { useLocation } from \"react-router\";\n\nimport AnnotatorScreen from \"components/Annotator/AnnotatorScreen\";\nimport { JobServerRemote, JobServerLocal } from \"components/Annotator/JobServerClass\";\nimport { useCookies } from \"react-cookie\";\n\nconst Annotator = () => {\n  const location = useLocation();\n  const [jobServer, setJobServer] = useState(null);\n  const [cookies] = useCookies([\"name\"]);\n\n  useEffect(() => {\n    if (location.search) {\n      const queries = parseQueryString(location);\n      if (queries?.url) createRemoteJobServer(queries.url, cookies, setJobServer);\n      if (queries?.id) createLocalJobServer(queries.id, cookies, setJobServer);\n    } else {\n      setJobServer(null);\n    }\n  }, [location, cookies, setJobServer]);\n\n  //if (!JobServer) return <TaskSelector />;\n  if (!jobServer) return null;\n  return <AnnotatorScreen jobServer={jobServer} />;\n};\n\nconst createLocalJobServer = async (id, cookies, setJobServer) => {\n  const us = new JobServerLocal(id, cookies.name);\n  await us.init();\n  setJobServer(us);\n};\n\nconst createRemoteJobServer = async (url, cookies, setJobServer) => {\n  const us = new JobServerRemote(url, cookies.name);\n  await us.init();\n  setJobServer(us);\n};\n\nconst parseQueryString = (location) => {\n  const query = location.search.substring(1);\n  const parts = query.split(\"&\");\n  return parts.reduce((obj, part) => {\n    const [key, value] = part.split(\"=\");\n    obj[decodeURIComponent(key)] = decodeURIComponent(value);\n    return obj;\n  }, {});\n};\n\nexport default Annotator;\n","import db from \"apis/dexie\";\nimport SelectionTable from \"components/CodingjobManager/subcomponents/SelectionTable\";\nimport { useLiveQuery } from \"dexie-react-hooks\";\nimport React, { useEffect } from \"react\";\n\nconst tableColumns = [\n  {\n    Header: \"Title\",\n    accessor: \"title\",\n    headerClass: \"two wide\",\n  },\n  {\n    Header: \"Set\",\n    accessor: \"set\",\n    headerClass: \"two wide\",\n  },\n  // note that the progressIndex is the index of the highest fetched unit index, but since this\n  // starts at 0, it also represents how many units have been finished\n  {\n    Header: \"progress\",\n    accessor: \"progress\",\n    headerClass: \"two wide\",\n  },\n  {\n    Header: \"Last modified\",\n    accessor: \"last_modified_str\",\n    headerClass: \"four wide\",\n  },\n];\n\nconst LocalJobTable = ({ jobKey, setJobKey }) => {\n  const jobs = useLiveQuery(async () => {\n    let arr = [];\n    await db.idb.localJobs.each((row) => {\n      arr.push({\n        id: row.id,\n        last_modified: row.last_modified,\n        last_modified_str: row.last_modified.toString().slice(0, 24),\n        set: row.set,\n        progress: `${row.progressIndex || 0} / ${row.units.length}`,\n        title: row.title,\n      });\n    });\n    arr.sort((a, b) => {\n      return b.last_modified - a.last_modified;\n    });\n    return arr;\n  });\n\n  useEffect(() => {\n    if (!jobKey && jobs) {\n      setJobKey(jobs.length > 0 ? { ...jobs[0], ROW_ID: \"0\" } : null);\n    }\n  }, [jobKey, jobs, setJobKey]);\n\n  return (\n    <SelectionTable\n      columns={tableColumns}\n      data={jobs ? jobs : []}\n      selectedRow={jobKey}\n      setSelectedRow={setJobKey}\n      defaultSize={15}\n    />\n  );\n};\n\nexport default LocalJobTable;\n","import db from \"apis/dexie\";\nimport objectHash from \"object-hash\";\nimport React, { useState } from \"react\";\nimport { useHistory } from \"react-router\";\nimport { Button, Grid, Header } from \"semantic-ui-react\";\nimport TaskTable from \"./LocalJobTable\";\nimport JSZip from \"jszip\";\n\nconst homepage = \"/CCS_annotator\";\n\nconst LocalJobs = () => {\n  const history = useHistory();\n  const [jobKey, setJobKey] = useState(null);\n\n  const uploadFile = async (e) => {\n    const fileReader = new FileReader();\n    const fileblob = e.target.files[0];\n    const type = getExtension(fileblob.name);\n\n    if (type === \"json\") {\n      fileReader.readAsText(fileblob, \"UTF-8\");\n      fileReader.onload = (e) => {\n        const id = objectHash(e.target.result);\n        db.createLocalJob(JSON.parse(e.target.result), id);\n      };\n    }\n    if (type === \"zip\") {\n      console.log(\"test\");\n      let newZip = new JSZip();\n      const zipped = await newZip.loadAsync(fileblob);\n      zipped.forEach(async (relpath, file) => {\n        if (file.name.slice(0, 3) !== \"set\") return;\n        const content = await zipped.file(file.name).async(\"text\");\n        const id = objectHash(content);\n        db.createLocalJob(JSON.parse(content), id);\n      });\n    }\n  };\n\n  const setJobUrlQuery = async () => {\n    // set task.url as url query to open job in annotator\n    history.push(homepage + \"/annotator?id=\" + jobKey.id);\n  };\n\n  return (\n    <Grid centered stackable container style={{ marginTop: \"5em\" }}>\n      <Grid.Column style={{ textAlign: \"center\" }} width={8}>\n        <Header textAlign=\"center\" style={{ background: \"#1B1C1D\", color: \"white\" }}>\n          Read codingjob\n        </Header>\n\n        <input type=\"file\" accept=\".json,.zip\" onChange={uploadFile} />\n        <div>\n          <br />\n        </div>\n      </Grid.Column>\n      <Grid.Column width={8}>\n        <Header textAlign=\"center\" style={{ background: \"#1B1C1D\", color: \"white\" }}>\n          Your codingjobs\n        </Header>\n        <Button fluid primary disabled={!jobKey} onClick={setJobUrlQuery}>\n          Open selected codingjob\n        </Button>\n        <br />\n        <br />\n        <TaskTable jobKey={jobKey} setJobKey={setJobKey} />\n      </Grid.Column>\n    </Grid>\n  );\n};\n\nconst getExtension = (filename) => {\n  const parts = filename.split(\".\");\n  return parts[parts.length - 1];\n};\n\nexport default LocalJobs;\n","import React from \"react\";\nimport { BrowserRouter, Route, Switch } from \"react-router-dom\";\nimport HeaderMenu from \"components/HeaderMenu/HeaderMenu\";\n\n// Main pages. Use below in items to include in header menu\nimport CodingjobManager from \"components/CodingjobManager/CodingjobManager\";\nimport Annotator from \"components/Annotator/Annotator\";\nimport LocalJobs from \"components/LocalJobs/LocalJobs\";\n\n// Change to add new components to the header\n// The first item will be the opening page after login\nconst homepage = \"/CCS_annotator\";\n\n// TODO: annotate, manage jobs, monitor jobs\nconst items = [\n  { label: \"Annotator\", path: homepage + \"/annotator\", Component: Annotator, menu: false },\n  { label: \"Jobs\", path: homepage + \"/jobs\", Component: LocalJobs, menu: true },\n  {\n    label: \"Codingjob manager\",\n    path: homepage + \"/manager\",\n    Component: CodingjobManager,\n    menu: true,\n  },\n];\n\nconst createRoutes = (items) => {\n  return items.map((item) => {\n    return <Route exact path={item.path} render={() => <item.Component />} />;\n  });\n};\n\nconst App = () => {\n  return (\n    <BrowserRouter>\n      <HeaderMenu items={items} homepage={homepage}>\n        <Switch>\n          <Route exact path={homepage} render={() => <CodingjobManager />} />\n          {createRoutes(items)}\n          <Route exact path={\"/\"} render={() => <CodingjobManager />} />\n        </Switch>\n      </HeaderMenu>\n    </BrowserRouter>\n  );\n};\n\nexport default App;\n","import { combineReducers } from \"redux\";\n\nconst eventsBlocked = (state = false, action) => {\n  switch (action.type) {\n    case \"BLOCK_EVENTS\":\n      return action.block;\n    default:\n      return state;\n  }\n};\n\nconst fullScreenNode = (state = null, action) => {\n  switch (action.type) {\n    case \"SET_FULL_SCREEN_NODE\":\n      return action.node;\n    default:\n      return state;\n  }\n};\n\nconst rootReducer = combineReducers({\n  eventsBlocked,\n  fullScreenNode,\n});\n\nexport default rootReducer;\n","import \"semantic-ui-css/semantic.min.css\";\nimport React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport App from \"App\";\nimport { createStore } from \"redux\";\nimport rootReducer from \"reducers\";\nimport { Provider } from \"react-redux\";\nimport { CookiesProvider } from \"react-cookie\";\n\nconst store = createStore(rootReducer);\n\nReactDOM.render(\n  <React.StrictMode>\n    <CookiesProvider>\n      <Provider store={store}>\n        <App />\n      </Provider>\n    </CookiesProvider>\n  </React.StrictMode>,\n  document.querySelector(\"#root\")\n);\n"],"sourceRoot":""}