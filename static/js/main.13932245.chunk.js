(this.webpackJsonpamcat4annotator=this.webpackJsonpamcat4annotator||[]).push([[0],{278:function(e,t){},280:function(e,t){},309:function(e,t,n){var r={"./bg-BG.json":310,"./ca-ES.json":311,"./cs-CZ.json":312,"./de-DE.json":313,"./en-US.json":208,"./es-ES.json":314,"./et-EE.json":315,"./fi-FI.json":316,"./fr-FR.json":317,"./he-IL.json":318,"./it-IT.json":319,"./ja-JP.json":320,"./ko-KR.json":321,"./nb-NO.json":322,"./nn-NO.json":323,"./pl-PL.json":324,"./pt-BR.json":325,"./ru-RU.json":326,"./sv-SE.json":327,"./tr-TR.json":328,"./zh-CN.json":329};function a(e){var t=c(e);return n(t)}function c(e){if(!n.o(r,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return r[e]}a.keys=function(){return Object.keys(r)},a.resolve=c,e.exports=a,a.id=309},349:function(e,t,n){},350:function(e,t,n){},351:function(e,t,n){"use strict";n.r(t);n(256);var r=n(0),a=n.n(r),c=n(60),o=n.n(c),i=n(80),s=n(20),u=n(375),l=n(14),d=n(23),j=n(6),b=n.n(j),f=n(12),p=n(221),h=n(222),O=n(223),v=n(85),x=n.n(v),g=n(75),m=n(173),k=n(224);m.a.extend(k.a);var w=function(e){var t,n=[],r=null,a=0,c=0,o=0,i=null,s=null,u=Object(d.a)(e);try{for(u.s();!(t=u.n()).done;){var l=t.value,j=l.name;s=l.value,i=m.a.tokenize(s).paragraphs().json({offset:!0});for(var b=0;b<i.length;b++){for(var f=0;f<i[b].sentences.length;f++){for(var p=0;p<i[b].sentences[f].length;p++)for(var h=0;h<i[b].sentences[f][p].terms.length;h++)r=i[b].sentences[f][p].terms[h],n.push({section:j,offset:r.offset.start,length:r.offset.length,paragraph:a,sentence:c,index:o,text:r.text,pre:r.pre,post:r.post}),o++;c++}a++}}}catch(O){u.e(O)}finally{u.f()}return n},y=function(e){for(var t=0,n=0,r=0,a=0;a<e.length;a++){if(null==e[a].text){if(null==e[a].token)return alert("Invalid token data:\n\nimported tokens must have 'text' or 'token' field"),null;e[a].text=e[a].token}if(null==e[a].offset&&null!=e[a].start&&(e[a].offset=e[a].start),null==e[a].length&&(e[a].length=e[a].text.length),null==e[a].pre&&(e[a].pre=""),null==e[a].post&&null!=e[a].space&&(e[a].post=e[a].space),null==e[a].post&&(null!=e[a].offset&&null!=e[a].length?e[a].post=a<e[a].length-1?" ".repeat(Math.max(0,e[a+1].offset-e[a].offset-e[a].length)):"":e[a].post=" "),r=e[a].length+e[a].pre.length+e[a].post.length,null==e[a].offset&&(e[a].offset=n,n+=r),a<e.length-1&&e[a+1].offset<e[a].offset+r)return alert('Invalid token position data. The length of "'.concat(e[a].pre+e[a].text+e[a].post,'" on position ').concat(e[a].offset," exeeds the offset/start position of the next token")),null;null==e[a].paragraph&&(e[a].paragraph=t),(e[a].text.includes("\n")||e[a].post.includes("\n"))&&t++,null==e[a].section&&(e[a].section="text"),e[a].index=a}return e},C=function(e,t){for(var n=[],r={},a=0;a<e.length;a++)if(e[a].annotations){var c,o={},i=Object(d.a)(e[a].annotations);try{for(i.s();!(c=i.n()).done;){var s=c.value;t[s.value]?t[s.value].includes(s.name)||t[s].push(s.name):t[s.value]=[s.name],o[s.name]=s.value;var u=a>0?e[a-1].post:"";null==r[s.name]&&(r[s.name]={index:a,code:s.value,offset:e[a].offset,text:e[a].text,section:e[a].section,length:e[a].length}),r[s.name].group===s.value&&(r[s.name].length=e[a].offset+e[a].length-r[s.name].offset,r[s.name].text+=u+e[a].pre+e[a].post)}}catch(O){i.e(O)}finally{i.f()}for(var l=0,j=Object.keys(r);l<j.length;l++){var b=j[l];null!=o[b]?o[b]!==r[b]&&(n.push(r[b]),r[b]={index:a,code:o[b],offset:e[a].offset,text:e[a].text,section:e[a].section,length:e[a].length}):(n.push.apply(n,Object(g.a)(r[b])),r[b]=null)}}else{for(var f=0,p=Object.values(r);f<p.length;f++){var h=p[f];n.push(h)}r={}}return n},S=function(){function e(){Object(p.a)(this,e),this.idb=new O.a("AmCAT_Annotator"),this.idb.version(2).stores({meta:"welcome",apis:"api",codingjobs:"job_id, name",documents:"doc_id, job_id"})}return Object(h.a)(e,[{key:"welcome",value:function(){var e=Object(f.a)(b.a.mark((function e(){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.isWelcome();case 2:if(e.sent){e.next=4;break}this.idb.meta.add({welcome:1});case 4:return e.abrupt("return",null);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"isWelcome",value:function(){var e=Object(f.a)(b.a.mark((function e(){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.idb.meta.get(1));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"addToken",value:function(){var e=Object(f.a)(b.a.mark((function e(t,n){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.idb.apis.put({api:t,token:n.token,refresh_token:n.refresh_token,expiration_date:n.expiration_date}));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"deleteToken",value:function(){var e=Object(f.a)(b.a.mark((function e(t){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.idb.apis.delete(t));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getToken",value:function(){var e=Object(f.a)(b.a.mark((function e(t){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.idb.apis.get(t));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"createCodingjob",value:function(){var e=Object(f.a)(b.a.mark((function e(t){var n,r=arguments;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n=r.length>1&&void 0!==r[1]?r[1]:null)||(n=x()([t,Date.now().toString()])),this.idb.codingjobs.add({job_id:n,name:t}),e.abrupt("return",{job_id:n,name:t});case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"deleteCodingjob",value:function(){var e=Object(f.a)(b.a.mark((function e(t){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.idb.documents.where("job_id").equals(t.job_id).delete();case 2:return e.abrupt("return",this.idb.codingjobs.delete(t.job_id));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"listCodingjobs",value:function(){var e=Object(f.a)(b.a.mark((function e(){var t;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.idb.codingjobs.toArray();case 2:return t=e.sent,e.abrupt("return",t);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getCodingjob",value:function(){var e=Object(f.a)(b.a.mark((function e(t){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.idb.codingjobs.get(t.job_id));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"writeCodebook",value:function(){var e=Object(f.a)(b.a.mark((function e(t,n){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("writing to db"),e.abrupt("return",this.idb.codingjobs.where("job_id").equals(t.job_id).modify({codebook:JSON.stringify(n,null,2)}));case 2:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"writeCodes",value:function(){var e=Object(f.a)(b.a.mark((function e(t,n){var r,a,c,o,i,s,u,l,j,f,p=arguments;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=p.length>2&&void 0!==p[2]&&p[2],e.next=3,this.getCodingjob(t);case 3:if(a=e.sent,c=a.codebook?JSON.parse(a.codebook):{},r){e.next=9;break}c.codes=n,e.next=37;break;case 9:c.codes||(c.codes=[]),o=c.codes.reduce((function(e,t,n){return e[t.code]={parent:t.parent,index:n},e}),{}),i=c.codes.reduce((function(e,t,n){return e[t.parent]=!0,e}),{}),s=Object(d.a)(n),e.prev=13,s.s();case 15:if((u=s.n()).done){e.next=29;break}if(l=u.value,!o[l.code]){e.next=25;break}if(l.parent!==o[l.code].parent){e.next=20;break}return e.abrupt("continue",27);case 20:j=E(l.code+" ("+l.parent+")",o,i,2),c.codes[o[l].index].code=j,c.codes.push({code:j,parent:l.parent}),e.next=27;break;case 25:f=E(l.code,o,i,2),c.codes.push({code:f,parent:l.parent});case 27:e.next=15;break;case 29:e.next=34;break;case 31:e.prev=31,e.t0=e.catch(13),s.e(e.t0);case 34:return e.prev=34,s.f(),e.finish(34);case 37:return e.next=39,this.writeCodebook(t,c);case 39:return e.abrupt("return",e.sent);case 40:case"end":return e.stop()}}),e,this,[[13,31,34,37]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"createDocuments",value:function(){var e=Object(f.a)(b.a.mark((function e(t,n){var r,a,c,o,i,s,u=arguments;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=u.length>2&&void 0!==u[2]&&u[2],e.t0=Set,e.next=4,this.idb.documents.where("job_id").equals(t.job_id).primaryKeys();case 4:return e.t1=e.sent,a=new e.t0(e.t1),c=0,o={},i=n.reduce((function(e,n){var r=x()([n,t]);if(a.has(r))c++;else{if(a.add(r),n.annotations&&n.annotations.length>0)try{JSON.parse(n.annotations)}catch(i){throw alert("Annotations field contains invalid JSON"),new Error("JSON parse error")}n.tokens&&(n.tokens=y(n.tokens),n.annotations=C(n.tokens,o)),e.push(Object(l.a)({doc_id:r,job_id:t.job_id},n))}return e}),[]),r||(s="Created ".concat(n.length-c," new documents in codingjob ").concat(t.name,"."),c>0&&(s+=" Ignored ".concat(c," duplicates")),alert(s)),o=Object.keys(o).reduce((function(e,t){var n,r=Object(d.a)(o[t]);try{for(r.s();!(n=r.n()).done;){var a=n.value;e.push({code:t,parent:a})}}catch(c){r.e(c)}finally{r.f()}return e}),[]),this.writeCodes(t,o,!0),e.abrupt("return",this.idb.documents.bulkAdd(i));case 13:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"deleteDocuments",value:function(){var e=Object(f.a)(b.a.mark((function e(t){var n;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.map((function(e){return e.doc_id})),e.abrupt("return",this.idb.documents.bulkDelete(n));case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getJobDocumentsBatch",value:function(){var e=Object(f.a)(b.a.mark((function e(t,n,r){var a,c;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n<0)){e.next=2;break}return e.abrupt("return",null);case 2:return e.next=4,this.idb.documents.where("job_id").equals(t.job_id);case 4:return a=e.sent,e.next=7,a.count();case 7:if(c=e.sent,!(n>c-1)){e.next=10;break}return e.abrupt("return",null);case 10:return e.abrupt("return",a.offset(n).limit(r).toArray());case 11:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"getJobDocumentCount",value:function(){var e=Object(f.a)(b.a.mark((function e(t){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.idb.documents.where("job_id").equals(t.job_id).count());case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getDocument",value:function(){var e=Object(f.a)(b.a.mark((function e(t){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.idb.documents.get(t));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"writeTokens",value:function(){var e=Object(f.a)(b.a.mark((function e(t,n){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.idb.documents.where("doc_id").equals(t.doc_id).modify({tokens:n}));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"writeAnnotations",value:function(){var e=Object(f.a)(b.a.mark((function e(t,n){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("writing annotations"),console.log(t),console.log(n),e.abrupt("return",this.idb.documents.where("doc_id").equals(t.doc_id).modify({annotations:n}));case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"renameAnnotations",value:function(){var e=Object(f.a)(b.a.mark((function e(t,n,r){var a,c,o,i,s,u;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=Set,e.next=3,this.idb.documents.where("job_id").equals(t.job_id).primaryKeys();case 3:e.t1=e.sent,a=new e.t0(e.t1),c=Object(d.a)(a),e.prev=6,c.s();case 8:if((o=c.n()).done){e.next=18;break}return i=o.value,e.next=12,this.getDocument(i);case 12:return s=e.sent,u=s.annotations.map((function(e){return e.code===n&&(e.code=r),e})),e.next=16,this.writeAnnotations(s,u);case 16:e.next=8;break;case 18:e.next=23;break;case 20:e.prev=20,e.t2=e.catch(6),c.e(e.t2);case 23:return e.prev=23,c.f(),e.finish(23);case 26:case"end":return e.stop()}}),e,this,[[6,20,23,26]])})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"deleteDB",value:function(){var e=Object(f.a)(b.a.mark((function e(){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.idb.meta.clear();case 2:return e.next=4,this.idb.apis.clear();case 4:return e.next=6,this.idb.codingjobs.clear();case 6:return e.next=8,this.idb.documents.clear();case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}(),E=function e(t,n,r,a){if(!n[t]&&!r[t])return t;a>2&&(t=t.slice(0,t.length-t.toString().length)),e(t+=" "+a,n,a+1)},_=new S,T=n(11),R=n(374),D=n(381),A=n(185),N=n(225),I=n(226),z=n.n(I),L=n(1);function B(e){var t=e.totalRows,n=e.completedRows;console.log("Progress: ".concat(n," of ").concat(t," rows completed"))}var F=function(){var e=Object(r.useState)(!1),t=Object(T.a)(e,2),n=t[0],a=t[1],c=function(){var e=Object(f.a)(b.a.mark((function e(){var t;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Object(N.a)(_.idb,{filter:function(e,t,n){return"codingjobs"===e||"documents"===e},prettyJson:!0,progressCallback:B});case 3:t=e.sent,z()(t,"AmCAT_Annotator.json"),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),console.error(""+e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(){return e.apply(this,arguments)}}();return Object(L.jsxs)(R.a,{closeIcon:!0,open:n,trigger:Object(L.jsx)(u.a.Item,{icon:"download",name:"Download",style:{color:"lightgreen"}}),onClose:function(){return a(!1)},onOpen:function(){return a(!0)},children:[Object(L.jsx)(D.a,{icon:"download",content:"Download everything"}),Object(L.jsx)(R.a.Content,{children:Object(L.jsx)("p",{children:"Download all data as a single JSON dump"})}),Object(L.jsx)(R.a.Actions,{children:Object(L.jsx)(A.a,{primary:!0,onClick:c,children:"Download"})})]})},P=n(10),H=function(e){return{type:"BLOCK_EVENTS",payload:e}},G=function(e){return{type:"SELECT_CODINGJOB",payload:e}},M=function(e){return{type:"SET_CODINGJOBS",payload:e}},W=function(e){return{type:"SET_CURRENT_TOKEN",payload:e}},q=function(e,t,n){return{type:"TOGGLE_TOKEN_SELECTION",payload:{tokens:e,index:t,add:n}}},J=function(e,t,n){return{type:"TRIGGER_CODESELECTOR",from:e,index:t,code:n}},K=function(e){return{type:"TOGGLE_ANNOTATIONS",payload:e}},V=function(e){return{type:"SET_CODE_MAP",payload:e}},U=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20;return{type:"APPEND_CODE_HISTORY",payload:{code:e,n:t}}},Y=function(e){return{type:"SET_SHOW_SIDEBAR",payload:e}},$=n(58),Q=function(e){var t=e.homepage,n=Object(P.b)(),a=Object(r.useState)(!1),c=Object(T.a)(a,2),o=c[0],i=c[1],l=Object(s.g)(),d=function(){var e=Object(f.a)(b.a.mark((function e(){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,_.deleteDB();case 3:n({type:"RESET_DB"}),i(!1),l.push(t),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),console.log(e.t0);case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(){return e.apply(this,arguments)}}();return Object(L.jsxs)(R.a,{closeIcon:!0,open:o,trigger:Object(L.jsx)(u.a.Item,{icon:"rocket",name:"Reset",style:{color:"#d7a3a3"}}),onClose:function(){return i(!1)},onOpen:function(){return i(!0)},children:[Object(L.jsx)(D.a,{icon:"power off",content:"Reset Annotator Database"}),Object(L.jsx)(R.a.Content,{children:Object(L.jsx)("p",{children:"This will remove all document and annotation data from your browser. Any annotations that have not been saved/synchronized will be lost. Are you absolutely sure?"})}),Object(L.jsxs)(R.a.Actions,{children:[Object(L.jsxs)(A.a,{color:"red",onClick:function(){i(!1)},children:[Object(L.jsx)($.a,{name:"remove"})," No"]}),Object(L.jsxs)(A.a,{color:"green",onClick:d,children:[Object(L.jsx)($.a,{name:"checkmark"})," Yes"]})]})]})};function Z(){return X.apply(this,arguments)}function X(){return(X=Object(f.a)(b.a.mark((function e(){var t;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ae();case 2:t=e.sent,e.t0=t,e.next="never"===e.t0?6:"persisted"===e.t0?8:"prompt"===e.t0?10:12;break;case 6:return console.log("Not possible to persist storage"),e.abrupt("break",13);case 8:return console.log("Successfully persisted storage silently"),e.abrupt("break",13);case 10:return console.log("Not persisted, but we may prompt user when we want to."),e.abrupt("break",13);case 12:console.log("compiler desperately wanted a default");case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ee(){return te.apply(this,arguments)}function te(){return(te=Object(f.a)(b.a.mark((function e(){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,navigator.storage;case 2:if(e.t0=e.sent,!e.t0){e.next=5;break}e.t0=navigator.storage.persist;case 5:if(!e.t0){e.next=9;break}e.t1=navigator.storage.persist(),e.next=10;break;case 9:e.t1=void 0;case 10:return e.abrupt("return",e.t1);case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ne(){return re.apply(this,arguments)}function re(){return(re=Object(f.a)(b.a.mark((function e(){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,navigator.storage;case 2:if(e.t0=e.sent,!e.t0){e.next=5;break}e.t0=navigator.storage.persisted;case 5:if(!e.t0){e.next=9;break}e.t1=navigator.storage.persisted(),e.next=10;break;case 9:e.t1=void 0;case 10:return e.abrupt("return",e.t1);case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ae(){return ce.apply(this,arguments)}function ce(){return(ce=Object(f.a)(b.a.mark((function e(){var t;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(navigator.storage&&navigator.storage.persisted){e.next=2;break}return e.abrupt("return","never");case 2:return e.next=4,navigator.storage.persisted();case 4:if(!e.sent){e.next=7;break}return e.abrupt("return","persisted");case 7:if(navigator.permissions&&navigator.permissions.query){e.next=9;break}return e.abrupt("return","prompt");case 9:return e.next=11,navigator.permissions.query({name:"persistent-storage"});case 11:if("granted"!==(t=e.sent).state){e.next=21;break}return e.next=15,navigator.storage.persist();case 15:if(!e.sent){e.next=20;break}return e.abrupt("return","persisted");case 20:throw new Error("Failed to persist");case 21:if("prompt"!==t.state){e.next=23;break}return e.abrupt("return","prompt");case 23:return e.abrupt("return","never");case 24:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var oe=function(){var e=Object(r.useState)(!1),t=Object(T.a)(e,2),n=t[0],a=t[1],c=Object(r.useState)(!1),o=Object(T.a)(c,2),i=o[0],s=o[1];Object(r.useEffect)((function(){i||ne().then(s)}),[i]);var l=function(){var e=Object(f.a)(b.a.mark((function e(){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ee();case 2:return e.next=4,ne();case 4:e.sent?(s(!0),alert("indexedDB set to persistent for AmCAT Annotator")):alert("Failed to set indexedDB to persistent");case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return i?null:Object(L.jsxs)(R.a,{closeIcon:!0,open:n,trigger:Object(L.jsx)(u.a.Item,{icon:"database",name:"Enable persitance",style:{color:"#d7a3a3"}}),onClose:function(){return a(!1)},onOpen:function(){return a(!0)},children:[Object(L.jsx)(D.a,{icon:"database",content:"Set database persistence"}),Object(L.jsxs)(R.a.Content,{children:[Object(L.jsx)("p",{children:"We did not have permission to automatically make the data storage for this website persistent. This means that the data could be removed automatically by your browser if it needs to free up space for another website. You can try to set this manually here, but not all browsers support this (yet)."}),Object(L.jsx)("p",{children:"If the database is not persistent the app can still be used, but you need to be more carefull in making sure that data is regularly backed up, either by manually downloading data or syncing with some backend (work in progress)."})]}),Object(L.jsx)(R.a.Actions,{children:Object(L.jsxs)(A.a,{onClick:l,children:[Object(L.jsx)($.a,{name:"checkmark"})," Yes"]})})]})},ie=function(){var e=Object(P.c)((function(e){return e.showSidebar})),t=Object(P.b)();return Object(r.useEffect)((function(){return function(){t(Y(!1))}}),[t]),Object(L.jsx)(u.a.Item,{name:"".concat(e?"Hide":"Show"," codebook"),onClick:function(){return t(Y(!e))}})},se=Object(s.i)((function(e){var t=e.items,n=e.homepage,r=Object(s.h)(),a=t.map((function(e,t){return Object(L.jsx)(u.a.Item,{index:t,as:i.b,to:e.path,header:0===t,disabled:!_,active:e.path===r.pathname,children:e.label},"item-"+t)}));return Object(L.jsxs)(u.a,{fixed:"top",inverted:!0,children:[a,Object(L.jsx)(u.a.Menu,{position:"right",children:r.pathname.includes("annotate")?Object(L.jsx)(ie,{}):Object(L.jsxs)(L.Fragment,{children:[Object(L.jsx)(F,{}),Object(L.jsx)(oe,{}),Object(L.jsx)(Q,{homepage:n})]})})]})})),ue=n(368),le=n(377),de=n(367),je=n(380),be=n(378),fe={settings:{can_edit_codes:!0},codes:[{code:"VVD",parent:"Actor"},{code:"D66",parent:"Actor"},{code:"Groenlinks",parent:"Actor"},{code:"Mark Rutte",parent:"VVD"},{code:"Sigrid Kaag",parent:"D66"},{code:"Jesse Klaver",parent:"Groenlinks"},{code:"Climate change",parent:"Issue"}],relations:[],code_annotations:{coding_unit:"code",context_unit:{paragraph_window:[0,0],sentence_window:[1,1],word_window:[20,20]},sampling:{max_per_document:null,random_documents:!0,random_order:!0},tasks:[{header:"Issue identification",codes_parent:"Issue",instruction:'Does "[text]" refer to the issue "[code]"?',options:["yes","no"]}]},relation_annotations:{}},pe=[{document_id:"Some document ID",text_fields:[{name:"title",value:"GL en PvdA hebben goed gesprek met informateur, maar wantrouwen Rutte"},{name:"text",value:'PvdA-leider Lilianne Ploumen en GroenLinks-leider Jesse Klaver hadden vrijdag een goed gesprek met informateur Herman Tjeenk Willink, zeiden ze zelf. De twee benadrukten dat, hoewel er inhoudelijke stappen zijn gezet, hun vertrouwen in VVD-leider Mark Rutte nog niet is hersteld.\n\n    Informateur Willink zette zich vrijdag aan zijn taak. Eerste punt op de agenda zijn gesprekken met de lijsttrekkers van de acht grootste partijen.\n    \n    Een week nadat een groot deel van de partijleiders bekendmaakte niet meer met Rutte verder te willen onderhandelen over een nieuwe coalitie, wordt gekeken waarover partijen het inhoudelijk eens zijn.\n    \n    "Het was een prettig gesprek langs de lijnen van de inhoud", zei PvdA-leider Lilianne Ploumen na afloop. Ze heeft haar zorgen over de ongelijkheid in Nederland en over de zorg gedeeld.\n    \n    Ook Jesse Klaver (GroenLinks), die een uur eerder op gesprek kwam bij de informateur, benadrukte dat het ging over de problemen die opgelost moeten worden.\n    \n    Situatie niet veranderd in een week\n\nWat betreft de positie ten opzichte van Rutte is echter niets veranderd. Vorige week ondertekenden Ploumen en Klaver net als alle andere oppositiepartijen een motie van wantrouwen, vanwege Ruttes betrokkenheid bij de notitie over CDA-Kamerlid Pieter Omtzigt.\n\n"Als het aan ons ligt, was Rutte geen premier meer", zei Ploumen. Hoe Tjeenk Willink dat gedeukte vertrouwen kan herstellen, weet ze niet. "We wachten de voorstellen van de informateur af."\n\n"De vertrouwensbreuk is niet hersteld na \xe9\xe9n gesprek met de fractievoorzitters", zei ook Klaver. "Mijn mening over Rutte is niet veranderd."\n\nSP\'er Lilian Marijnissen sprak zich al eerder expliciet uit tegen samenwerking met Rutte.\n\nDe partijleiders hekelen het gebrek aan openheid en transparantie waar Rutte in hun ogen voor staat. "Als je een fout maakt, dan moet je dat toegeven en er niet over liegen", zei Klaver. Ploumen: "Het probleem is dat Mark Rutte heeft gelogen. Wij hebben het vertrouwen in hem opgezegd."\n\nWat de vervolgstappen moeten zijn, laten ze volledig over aan Tjeenk Willink. "Ik ga geen lijstjes maken met wat er moet gebeuren", zei Ploumen.\n\nDe informateur ontvangt later op vrijdag nog de partijleiders Wopke Hoekstra (CDA) en Sigrid Kaag (D66), en Rutte zelf.\n\nTjeenk Willink denkt niet dat Rutte zomaar door kan\n\nTjeenk Willink suggereerde woensdag op een persconferentie dat hij Rutte niet per se een sta-in-de-weg voor een verandering van de bestuursstijl in Den Haag vindt. Toen daarover vervolgens berichten in de media verschenen, voelde de informateur zich vrijdag genoodzaakt die boodschap bij te sturen.\n\nDe conclusie dat Rutte geen belemmering vormt voor de formatie, kan hij niet voor zijn rekening nemen, luidt een schriftelijke verklaring.\n\nTjeenk Willink heeft namelijk ook de opdracht om te onderzoeken "of en zo ja onder welke voorwaarden er voldoende vertrouwen tussen partijen bestaat of weer kan ontstaan".'}]},{document_id:"Another document ID",text_fields:[{name:"title",value:"CU-leider Segers vindt dat uitspraak over Rutte te veel op de man was gespeeld"},{name:"text",value:'Partijleider Gert-Jan Segers van de ChristenUnie (CU) vindt dat hij te veel op de man heeft gespeeld door coalitiedeelname uit te sluiten als VVD-leider Mark Rutte opnieuw premier zou worden. Terugblikkend zegt hij dat het niet om \xe9\xe9n persoon moet gaan, maar om "een ongezonde politieke cultuur en een genadeloze overheid". Daar moet volgens hem verandering in komen, zo zei hij zaterdag tijdens een congres van de partij.\n\n    \n    Segers deed zijn uitspraak over Rutte na het debat over de notitie "functie elders" voor CDA-Kamerlid Pieter Omtzigt. Binnen de CU is verdeeldheid ontstaan over het besluit van de fractie, erkent Segers.\n    \n    Naast steun is er ook kritiek van veel leden, die zeggen dat hij "te veel op de man heeft gespeeld en te weinig de bal". "Te veel Rutte, te weinig ons allemaal. En als dat de perceptie van veel mensen is, dan moet ik me dat aantrekken", aldus Segers tijdens het congres.\n    \n    \n    Volgens de CU-leider staat "de politieke cultuur in Den Haag natuurlijk niet los van Mark Rutte, zeker niet".\n    \n    "Maar die oude cultuur staat of valt niet met \xe9\xe9n man. Ook wijzelf maken er deel van uit. Ik wil niet genadeloos zijn voor personen, maar ik wil wel hard en helder zijn over een cultuur die niet deugt en een genadeloze overheid. Daar moet \xe9cht een omslag in komen", zei Segers.\n    \n    \n    De ChristenUnie heeft vijf zetels in de Tweede Kamer. Op het congres werden vier oude Kamerleden uitgezwaaid en trad Ankie van Tatenhove aan als nieuwe partijvoorzitter.'}]}],he=function(){var e=Object(f.a)(b.a.mark((function e(t){var n;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.createCodingjob("Demo codingjob");case 3:return n=e.sent,e.next=6,t.createDocuments(n,pe,!0);case 6:return e.next=8,t.writeCodebook(n,fe);case 8:return e.abrupt("return",null);case 11:e.prev=11,e.t0=e.catch(0),console.log(e.t0);case 14:case"end":return e.stop()}}),e,null,[[0,11]])})));return function(t){return e.apply(this,arguments)}}(),Oe=function(e){var t=e.items,n=Object(s.g)(),a=function(){var e=Object(f.a)(b.a.mark((function e(r,a){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!a){e.next=6;break}return e.next=3,_.isWelcome();case 3:if(e.sent){e.next=6;break}return e.abrupt("return",null);case 6:if(e.prev=6,!r){e.next=10;break}return e.next=10,he(_);case 10:return e.next=12,_.welcome();case 12:return e.next=14,Z();case 14:n.push(t[0].path),e.next=19;break;case 17:e.prev=17,e.t0=e.catch(6);case 19:case"end":return e.stop()}}),e,null,[[6,17]])})));return function(t,n){return e.apply(this,arguments)}}();return Object(r.useEffect)((function(){a(!1,!0)})),Object(L.jsx)(je.a,{inverted:!0,textAlign:"center",style:{height:"100vh"},verticalAlign:"middle",children:Object(L.jsx)(je.a.Column,{style:{maxWidth:450},children:Object(L.jsxs)(be.a,{style:{border:0},children:[Object(L.jsx)(D.a,{as:"h2",textAlign:"center",children:"Welcome to the AmCAT annotator"}),Object(L.jsx)("p",{children:"This is the (early development version of the) AmCAT annotator. The fact that you see this message means that you're either here for the first time, or your local annotation database was reset (by you or your browser)."}),Object(L.jsx)("p",{children:"The annotator stores your codingjobs and annotations on your local computer in your browser's IndexedDB. Your data will only actually touch the internet when you synchronize your data."}),Object(L.jsx)(A.a,{primary:!0,onClick:function(){return a(!0,!1)},children:"Yes, off course I trust you"})]})})})},ve=n(240),xe=function(e){var t=e.Component,n=e.homepage,a=Object(ve.a)(e,["Component","homepage"]),c=Object(r.useState)(!0),o=Object(T.a)(c,2),i=o[0],u=o[1],d=Object(r.useState)(!1),j=Object(T.a)(d,2),p=j[0],h=j[1];return function(){var e=Object(f.a)(b.a.mark((function e(){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,_.isWelcome();case 2:if(!e.sent){e.next=6;break}h(!0),e.next=7;break;case 6:h(!1);case 7:u(!1);case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()(),Object(L.jsx)(s.b,Object(l.a)(Object(l.a)({},a),{},{render:function(e){return i?Object(L.jsx)("div",{children:"loading..."}):p?Object(L.jsx)(t,Object(l.a)(Object(l.a)({},a),e)):Object(L.jsx)(s.a,{to:n})}}))},ge=n(371),me=n(126),ke=n(232),we=n(114),ye=n(101),Ce=n(384),Se=n(120),Ee=n(178),_e=n(385),Te=function(e){e.preGlobalFilteredRows;var t=e.globalFilter,n=e.setGlobalFilter;return Object(L.jsx)("span",{children:Object(L.jsx)("input",{value:t||"",onChange:function(e){n(e.target.value||void 0)},placeholder:"Enter search term",style:{border:"0"}})})},Re=function(e){var t=e.columns,n=e.data,a=e.selectedRow,c=e.setSelectedRow,o=e.width,i=void 0===o?null:o,s=e.defaultSize,u=void 0===s?15:s,d=Object(r.useState)(a?a.ROW_ID:null),j=Object(T.a)(d,2),b=j[0],f=j[1],p=Object(me.useTable)({columns:t,data:n,initialState:{pageSize:u,globalFilter:""}},me.useGlobalFilter,me.useSortBy,me.usePagination),h=p.getTableProps,O=p.getTableBodyProps,v=p.headerGroups,x=p.prepareRow,g=p.page,m=p.pageCount,k=p.gotoPage,w=p.preGlobalFilteredRows,y=p.setGlobalFilter,C=p.state,S=C.pageIndex,E=C.globalFilter;Object(r.useEffect)((function(){f(a?a.ROW_ID:null)}),[a]);var _=function(e){return e.headers.map((function(e){return Object(L.jsxs)(ke.a,Object(l.a)(Object(l.a)({className:e.headerClass},e.getHeaderProps(e.getSortByToggleProps())),{},{children:[e.render("Header"),Object(L.jsx)("span",{children:e.isSorted?e.isSortedDesc?" \ud83d\udd3d":" \ud83d\udd3c":""})]}))}))};return 0===n.length?null:Object(L.jsxs)("div",{style:{width:i},children:[Object(L.jsx)(Te,{preGlobalFilteredRows:w,globalFilter:E,setGlobalFilter:y}),Object(L.jsxs)(Ce.a,Object(l.a)(Object(l.a)({compact:!0,unstackable:!0,fixed:!0,singleLine:!0,selectable:!0},h()),{},{children:[Object(L.jsx)(Se.a,{children:v.map((function(e){return Object(L.jsx)(we.a,Object(l.a)(Object(l.a)({},e.getHeaderGroupProps()),{},{children:_(e)}))}))}),Object(L.jsx)(Ee.a,Object(l.a)(Object(l.a)({},O()),{},{children:function(e){return e.map((function(e,t){return x(e),Object(L.jsx)(we.a,Object(l.a)(Object(l.a)({active:!!b&&b===e.id,onClick:function(){return function(e){b&&b===e.id?(c(null),f(null)):(c(Object(l.a)(Object(l.a)({},n[e.id]),{},{ROW_ID:e.id})),f(e.id))}(e)}},e.getRowProps()),{},{children:e.cells.map((function(e){return Object(L.jsx)(ye.a,Object(l.a)(Object(l.a)({title:e.value},e.getCellProps()),{},{children:e.render("Cell")}))}))}))}))}(g)})),Object(L.jsx)(Ce.a.Footer,{children:Object(L.jsx)(Ce.a.Row,{children:Object(L.jsx)(Ce.a.HeaderCell,{colSpan:t.length,children:n.length>u?Object(L.jsx)(_e.a,{floated:"right",style:{border:"0"},size:"mini",firstItem:!1,lastItem:!1,nextItem:!1,prevItem:!1,boundaryRange:1,ellipsisItem:{content:Object(L.jsx)($.a,{name:"ellipsis horizontal"}),icon:!0},activePage:S+1,totalPages:m,onPageChange:function(e,t){k(t.activePage-1)}}):null})})})]}))]})},De=n(372),Ae=n(379),Ne=n(366),Ie=function(){var e=Object(P.c)((function(e){return e.codingjobs})),t=Object(P.b)(),n=Object(r.useState)("inactive"),a=Object(T.a)(n,2),c=a[0],o=a[1],i=Object(r.useState)(""),s=Object(T.a)(i,2),u=s[0],l=s[1],d=function(){var e=Object(f.a)(b.a.mark((function e(n){var r;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.preventDefault(),l(u.trim()),o("pending"),e.prev=3,e.next=6,_.createCodingjob(u);case 6:return e.next=8,_.listCodingjobs();case 8:r=e.sent,t(G(null)),t(M(r)),o("inactive"),e.next=18;break;case 14:e.prev=14,e.t0=e.catch(3),console.log(e.t0),o("error");case 18:case"end":return e.stop()}}),e,null,[[3,14]])})));return function(t){return e.apply(this,arguments)}}();return e?Object(L.jsxs)(R.a,{as:De.a,trigger:Object(L.jsxs)(A.a,{children:[Object(L.jsx)($.a,{name:"plus"}),"Create job"]}),onSubmit:function(e){return d(e)},open:"inactive"!==c,onClose:function(){return o("inactive")},onOpen:function(){l(""),o("awaiting input")},size:"tiny",children:[Object(L.jsx)(D.a,{icon:"pencil",content:"Create new Codingjob",as:"h2"}),Object(L.jsx)(R.a.Content,{children:Object(L.jsx)(De.a.Group,{children:Object(L.jsx)(De.a.Input,{width:12,label:"Name",required:!0,type:"text",value:u,onChange:function(e,t){o("awaiting input"),l(t.value)},placeholder:"Enter name"})})}),Object(L.jsxs)(R.a.Actions,{children:["error"===c?Object(L.jsx)("div",{children:"Could not create codingjob for a reason not yet covered in the error handling..."}):null,"pending"===c?Object(L.jsx)(Ae.a,{active:!0,inverted:!0,children:Object(L.jsx)(Ne.a,{content:"Creating codingjob"})}):Object(L.jsx)(A.a,{type:"submit",color:"green",icon:"save",content:"Create"})]})]}):null},ze=function(){var e=Object(P.c)((function(e){return e.codingjob})),t=Object(P.b)(),n=Object(r.useState)("inactive"),a=Object(T.a)(n,2),c=a[0],o=a[1],i=function(){var n=Object(f.a)(b.a.mark((function n(r){var a;return b.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return o("pending"),n.prev=1,n.next=4,_.deleteCodingjob(e);case 4:return n.next=6,_.listCodingjobs();case 6:a=n.sent,t(G(null)),t(M(a)),o("inactive"),n.next=16;break;case 12:n.prev=12,n.t0=n.catch(1),console.log(n.t0),o("error");case 16:case"end":return n.stop()}}),n,null,[[1,12]])})));return function(e){return n.apply(this,arguments)}}();return e?Object(L.jsxs)(R.a,{closeIcon:!0,open:"inactive"!==c,trigger:Object(L.jsxs)(A.a,{compact:!0,children:[Object(L.jsx)($.a,{name:"minus"})," Delete job"]}),onClose:function(){o("inactive")},onOpen:function(){o("awaiting input")},children:[Object(L.jsx)(D.a,{icon:"trash",content:"Delete codingjob ".concat(e.name)}),Object(L.jsx)(R.a.Content,{children:Object(L.jsx)("p",{children:"Do you really want to delete this codingjob?"})}),Object(L.jsxs)(R.a.Actions,{children:["error"===c?Object(L.jsx)("div",{children:"Could not delete codingjob for a reason not yet covered in the error handling..."}):null,"pending"===c?Object(L.jsx)(Ae.a,{active:!0,inverted:!0,children:Object(L.jsx)(Ne.a,{content:"Deleting codingjob"})}):Object(L.jsxs)(L.Fragment,{children:[Object(L.jsxs)(A.a,{color:"red",onClick:function(){o("inactive")},children:[Object(L.jsx)($.a,{name:"remove"})," No"]}),Object(L.jsxs)(A.a,{color:"green",onClick:i,children:[Object(L.jsx)($.a,{name:"checkmark"})," Yes"]})]})]})]}):null},Le=function(){var e=Object(f.a)(b.a.mark((function e(t,n){var r,a;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n){e.next=3;break}return t(G(null)),e.abrupt("return");case 3:return r=n.ROW_ID,e.next=6,_.getCodingjob(n);case 6:(a=e.sent)&&(a.ROW_ID=r,t(G(a)));case 8:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),Be=function(){var e=Object(f.a)(b.a.mark((function e(t,n){var r;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(_.isWelcome()){e.next=2;break}return e.abrupt("return",null);case 2:return e.prev=2,e.next=5,_.listCodingjobs();case 5:(r=e.sent).length>0&&(t(M(r)),n(Object(l.a)(Object(l.a)({},r[0]),{},{ROW_ID:"0"}))),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(2),console.log(e.t0);case 12:case"end":return e.stop()}}),e,null,[[2,9]])})));return function(t,n){return e.apply(this,arguments)}}(),Fe=function(e){var t,n=e.type,a=void 0===n?"table":n,c=Object(P.c)((function(e){return e.codingjobs})),o=Object(P.c)((function(e){return e.codingjob})),i=Object(P.b)(),s=Object(r.useState)(o),u=Object(T.a)(s,2),d=u[0],j=u[1];if(Object(r.useEffect)((function(){Le(i,d)}),[d,i]),Object(r.useEffect)((function(){o||j(null)}),[o,i]),Object(r.useEffect)((function(){0===c.length&&Be(i,j)}),[c,i]),"table"===a){return Object(L.jsxs)(be.a,{style:{border:"0"},children:[Object(L.jsxs)(A.a.Group,{widths:"2",children:[Object(L.jsx)(Ie,{}),Object(L.jsx)(ze,{})]}),Object(L.jsx)(de.a,{style:{marginTop:"30px",overflow:"auto",width:"800px"},children:Object(L.jsx)(Re,{columns:[{Header:"Coding job",accessor:"name",headerClass:"thirteen wide"}],data:c||[],selectedRow:d,setSelectedRow:j,defaultSize:15})})]})}if("dropdown"===a){return Object(L.jsx)(ge.a,{inline:!0,search:!0,options:(t=c,t.map((function(e){return{key:e.job_id,text:e.name,value:e.name}}))),value:o?o.name:null,onChange:function(e,t){return function(e){if(e&&c.length>0){var t=c.findIndex((function(t){return t.name===e}));j(Object(l.a)(Object(l.a)({},c[t]),{},{ROW_ID:t.toString()}))}else j(null)}(t.value)}})}return null},Pe=function(){var e=Object(f.a)(b.a.mark((function e(t,n,r,a,c){var o,i;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,_.getJobDocumentCount(t);case 2:if(o=e.sent,r(Math.ceil(o/n)),i=[],!(o>0)){e.next=9;break}return e.next=8,_.getJobDocumentsBatch(t,0,n);case 8:i=e.sent;case 9:a(i),c(He(i));case 11:case"end":return e.stop()}}),e)})));return function(t,n,r,a,c){return e.apply(this,arguments)}}(),He=function(e){var t=[];return e.length>0&&(t=e.reduce((function(e,t){if(t.text_fields){var n,r=Object(d.a)(t.text_fields);try{for(r.s();!(n=r.n()).done;){var a=n.value;e.add(a.name)}}catch(o){r.e(o)}finally{r.f()}}else for(var c=0;c<t.tokens.length;c++)e.add(t.tokens[c].section);return e}),new Set)),["document_id"].concat(Object(g.a)(t))},Ge=function(){var e=Object(P.c)((function(e){return e.codingjob})),t=Object(r.useState)([]),n=Object(T.a)(t,2),a=n[0],c=n[1],o=Object(r.useState)(1),i=Object(T.a)(o,2),s=i[0],u=i[1],l=Object(r.useState)([]),d=Object(T.a)(l,2),j=d[0],p=d[1];Object(r.useEffect)((function(){if(!e)return c([]),p([]),null;Pe(e,10,u,c,p)}),[e]);var h=function(e){return j.map((function(t,n){var r,a,c=null;return"document_id"===t?c=e.document_id:(e.text_fields&&(c=e.text_fields.find((function(e){return e.name===t})))&&(c=c.value),c||e.text_fields||!e.tokens||(r=e.tokens,a=t,c=r.reduce((function(e,t){return t.section===a&&(e=e+t.pre+t.token+t.post),e}),""))),Object(L.jsx)(Ce.a.Cell,{children:Object(L.jsx)("span",{title:c,children:c})},n)}))},O=function(){var t=Object(f.a)(b.a.mark((function t(n,r){var a,o;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=10*(r.activePage-1),t.next=3,_.getJobDocumentsBatch(e,a,10);case 3:o=t.sent,c(o),p(He(o));case 6:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}();return a.length<1?null:Object(L.jsx)(de.a,{style:{marginTop:"2em"},children:Object(L.jsxs)(Ce.a,{fixed:!0,compact:!0,celled:!0,singleLine:!0,children:[Object(L.jsx)(Ce.a.Header,{children:Object(L.jsx)(Ce.a.Row,{children:function(e,t){return t.map((function(e,t){return Object(L.jsx)(Ce.a.HeaderCell,{children:Object(L.jsx)("span",{title:e,children:e})},t)}))}(0,j)})}),Object(L.jsx)(Ce.a.Body,{children:function(e){return e.map((function(e,t){return Object(L.jsx)(Ce.a.Row,{children:h(e)},t)}))}(a)}),Object(L.jsx)(Ce.a.Footer,{children:Object(L.jsx)(Ce.a.Row,{children:Object(L.jsx)(Ce.a.HeaderCell,{colSpan:j.length,children:s>1?Object(L.jsx)(_e.a,{floated:"right",boundaryRange:1,siblingRange:1,ellipsisItem:{content:Object(L.jsx)($.a,{name:"ellipsis horizontal"}),icon:!0},firstItem:{content:Object(L.jsx)($.a,{name:"angle double left"}),icon:!0},lastItem:{content:Object(L.jsx)($.a,{name:"angle double right"}),icon:!0},prevItem:{content:Object(L.jsx)($.a,{name:"angle left"}),icon:!0},nextItem:{content:Object(L.jsx)($.a,{name:"angle right"}),icon:!0},pointing:!0,secondary:!0,defaultActivePage:1,totalPages:s,onPageChange:O}):null})})})]})})},Me=function(){return Object(L.jsx)(de.a,{style:{marginTop:"30px",overflow:"auto"},children:Object(L.jsx)(Ge,{})})},We=n(233),qe=function(e){var t=e.setActive;return Object(L.jsx)(Ue,{type:"texts",columns:{document_id:{required:!0,multiple:!1,defaults:["doc_id","document_id"]},annotations_json:{required:!1,multiple:!1,defaults:["annotations_json"]},text_fields:{required:!0,multiple:!0,defaults:["title","headline","body","message","text"]}},setActive:t})},Je=function(e,t,n,r){return Object(L.jsxs)(L.Fragment,{children:[Object(L.jsxs)(De.a.Group,{widths:"equal",children:[Qe("document id","document_id",e,t,n,r),Qe("annotations (json)","annotations_json",e,t,n,r)]}),Object(L.jsx)(De.a.Group,{widths:"equal",children:Qe("text fields","text_fields",e,t,n,r)})]})},Ke=function(e){var t=e.setActive;return Object(L.jsx)(Ue,{type:"tokens",columns:{document_id:{required:!0,multiple:!1,defaults:["doc_id","document_id"]},token:{required:!0,multiple:!1,defaults:["token","text"]},sentence:{required:!1,multiple:!1,defaults:["sentence","sentence_nr","sentence_id"]},paragraph:{required:!1,multiple:!1,defaults:["paragraph","paragraph_nr","paragraph_id"]},offset:{required:!1,int:!0,multiple:!1,defaults:["offset","start"]},end:{required:!1,int:!0,multiple:!1,defaults:["end"]},post:{required:!1,multiple:!1,defaults:["post","space"]},section:{required:!1,multiple:!1,defaults:["section"]},annotations:{required:!1,multiple:!0,defaults:["annotation"]}},setActive:t})},Ve=function(e,t,n,r){return Object(L.jsxs)(L.Fragment,{children:[Object(L.jsxs)(De.a.Group,{widths:"equal",children:[Qe("document id","document_id",e,t,n,r),Qe("token","token",e,t,n,r),Qe("paragraph","paragraph",e,t,n,r),Qe("sentence","sentence",e,t,n,r)]}),Object(L.jsxs)(De.a.Group,{widths:"equal",children:[Qe("start / offset","offset",e,t,n,r),Qe("end","end",e,t,n,r),Qe("space / post","post",e,t,n,r),Qe("section (title, text..)","section",e,t,n,r)]}),Object(L.jsx)(De.a.Group,{widths:"equal",children:Qe("annotation columns","annotations",e,t,n,r,!0)})]})},Ue=function(e){var t=e.type,n=void 0===t?"text":t,a=e.columns,c=(e.setActive,Object(P.c)((function(e){return e.codingjob}))),o=Object(r.useState)([]),i=Object(T.a)(o,2),s=i[0],u=i[1],l=Object(r.useRef)();return Object(L.jsxs)(de.a,{children:[Object(L.jsxs)(je.a,{children:[Object(L.jsx)(je.a.Column,{width:5,children:Object(L.jsx)(We.a,{ref:l,nodrag:!0,onFileLoad:function(e){return u(e)},addRemoveButton:!0,onRemoveFile:function(){return u([])},children:Object(L.jsx)("span",{children:"Click to upload"})})}),Object(L.jsx)(je.a.Column,{floated:"right",width:11,children:Object(L.jsx)(Ye,{type:n,data:s,codingjob:c,fileRef:l,columns:a})})]}),Object(L.jsx)(Ze,{data:s})]})},Ye=function(e){var t=e.type,n=e.data,a=e.codingjob,c=e.fileRef,o=e.columns,i=Object(r.useState)([]),s=Object(T.a)(i,2),u=s[0],j=s[1],p=Object(r.useState)({}),h=Object(T.a)(p,2),O=h[0],v=h[1],x=Object(r.useState)(!1),g=Object(T.a)(x,2),m=g[0],k=g[1];Object(r.useEffect)((function(){if(n.length<=1)return v({}),void j([]);j(n[0].data.map((function(e){return{key:e,value:e,text:e}})));for(var e={},t=0,r=Object.keys(o);t<r.length;t++){var a=r[t];e[a]=o[a].multiple?[]:null;var c,i=Object(d.a)(o[a].defaults);try{for(i.s();!(c=i.n()).done;){var s=c.value;n[0].data.includes(s)&&(o[a].multiple?e[a].push(s):e[a]=s)}}catch(u){i.e(u)}finally{i.f()}}v(e)}),[n,o]);var w=function(e,t){for(var n=e[0].data,r=Object(l.a)({},t),a=function(){var e=i[c];if(o[e].multiple){r[e]={};var a,s=Object(d.a)(t[e]);try{var u=function(){var t=a.value;r[e][t]=n.findIndex((function(e){return e===t}))};for(s.s();!(a=s.n()).done;)u()}catch(l){s.e(l)}finally{s.f()}}else r[e]=n.findIndex((function(n){return n===t[e]}))},c=0,i=Object.keys(t);c<i.length;c++)a();return e.slice(1).map((function(e){for(var a={original:e.data},c=0,i=Object.keys(t);c<i.length;c++){var s=i[c];if(o[s].multiple){a[s]=[];var u,l=Object(d.a)(t[s]);try{for(l.s();!(u=l.n()).done;){var j=u.value,b=r[s][j];if(!(b<0)){var f=e.data[b];o[s].int&&(f=parseInt(f)),a[s].push({name:n[b],value:f})}}}catch(O){l.e(O)}finally{l.f()}}else{var p=r[s];if(p<0)continue;var h=e.data[p];a[s]=o[s].int?parseInt(h):h}}return a}))},y=function(){var e=Object(f.a)(b.a.mark((function e(){var r;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,k(!0),r=w(n,O),"tokens"===t&&(r=$e(r)),e.next=6,_.createDocuments(a,r);case 6:c.current.removeFile(),k(!1),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),k(!1);case 13:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(){return e.apply(this,arguments)}}();return Object(L.jsx)(L.Fragment,{children:Object(L.jsxs)(De.a,{loading:m,children:["texts"===t?Je(o,u,O,v):null,"tokens"===t?Ve(o,u,O,v):null,Object(L.jsx)(De.a.Group,{children:Object(L.jsxs)(De.a.Field,{control:A.a,onClick:y,disabled:!function(){for(var e=0,t=Object.keys(o);e<t.length;e++){var n=t[e];if(o[n].multiple){if(o[n].required&&0===O[n].length)return!1}else if(o[n].required&&!O[n])return!1}return!0}(),children:[Object(L.jsx)($.a,{name:"upload"}),"Upload"]})})]})})},$e=function(e){for(var t=[],n=[e[0]],r=1;r<e.length;r++)e[r].document_id!==e[r-1].document_id&&(t.push({document_id:e[r-1].document_id,tokens:n}),n=[]),n.push(e[r]);return t},Qe=function(e,t,n,r,a,c){return Object(L.jsx)(De.a.Field,{control:ge.a,clearable:!0,selection:!0,multiple:!!n[t].multiple,label:e,required:n[t].required,options:r,value:a[t],onChange:function(e,n){var r=Object(l.a)({},a);r[t]=n.value,c(r)},style:{minWidth:"3em"}})},Ze=function(e){var t=e.data,n=function(e){return e.map((function(e){return Object(L.jsx)(Ce.a.Cell,{children:Object(L.jsx)("span",{title:e,children:e})})}))};return t.length<=1?null:Object(L.jsxs)("div",{style:{marginTop:"3em",overflow:"auto",width:"85vh",border:"solid 1px"},children:[Object(L.jsxs)(Ce.a,{singleline:!0,style:{display:"block",width:"100%",border:"solid 0px"},children:[Object(L.jsx)(Ce.a.Header,{children:Object(L.jsx)(Ce.a.Row,{children:function(e){return e[0].data.map((function(e){return Object(L.jsx)(Ce.a.HeaderCell,{children:Object(L.jsx)("span",{title:e,children:e})})}))}(t)})}),Object(L.jsx)(Ce.a.Body,{children:function(e,t){return e.slice(0,t+1).slice(1).map((function(e){return Object(L.jsx)(Ce.a.Row,{children:n(e.data)})}))}(t,5)})]}),t.length>5?Object(L.jsxs)(D.a,{align:"center",children:[t.length-1-5," more rows"]}):null]})},Xe=n(239),et=(n(330),function(e){var t=e.fields,n=e.fieldValues,r=e.setFieldValues,a=function(e,t){var a=Object(l.a)({},n);a[e]=t,r(a)};return t?Object.keys(t).map((function(e){return"text"===t[e]?Object(L.jsx)(De.a.TextArea,{value:n[e]?n[e]:"",onChange:function(t,n){return a(e,n.value)},label:e},e):"date"===t[e]?Object(L.jsx)(De.a.Field,{children:Object(L.jsx)(Xe.a,{label:e,value:n[e]?n[e]:"",onChange:function(t,n){return a(e,n.value)}},e)}):"keyword"===t[e]?Object(L.jsxs)(De.a.Field,{children:[Object(L.jsx)("label",{children:e}),Object(L.jsx)("input",{value:n[e]?n[e]:"",onChange:function(t){return a(e,t.target.value)}})]},e):null})):null}),tt=function(){var e=Object(P.c)((function(e){return e.codingjob})),t=Object(r.useState)({}),n=Object(T.a)(t,2),a=n[0],c=n[1],o=function(){var t=Object(f.a)(b.a.mark((function t(){var n,r,o,i;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:for(n=Object(l.a)({},a),r=0,o=Object.keys(n);r<o.length;r++)("date"===(i=o[r])||/_date$/.test(i))&&(n[i]=n[i].toISOString());return t.prev=2,t.next=5,_.createDocuments(e,[n]);case 5:c({}),t.next=11;break;case 8:t.prev=8,t.t0=t.catch(2),console.log(t.t0);case 11:case"end":return t.stop()}}),t,null,[[2,8]])})));return function(){return t.apply(this,arguments)}}();return e?Object(L.jsxs)(De.a,{style:{marginTop:"3em"},children:[Object(L.jsx)(et,{fields:{title:"text",text:"text",annotations:"text"},fieldValues:a,setFieldValues:c}),e?Object(L.jsx)(A.a,{primary:!0,onClick:o,children:"Create document"}):null]}):null},nt=n(370),rt=n(229),at=n(369),ct=n(365),ot=n(161),it=function(e){var t=e.code,n=e.codeTrail;return Object(L.jsxs)("div",{className:"content",children:[Object(L.jsx)("div",{className:"title",children:t}),Object(L.jsx)("div",{className:"description",children:n.join(" -> ")})]},"content")},st=function(){var e=Object(f.a)(b.a.mark((function e(t,n,r,a,c){var o;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=a.map((function(e){return e.code===n&&(e.color=r),e})),e.next=3,_.writeCodes(t,o);case 3:c(o);case 4:case"end":return e.stop()}}),e)})));return function(t,n,r,a,c){return e.apply(this,arguments)}}(),ut=function(){var e=Object(f.a)(b.a.mark((function e(t,n,r){var a,c;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,_.getCodingjob(t);case 2:(a=e.sent).codebook?((c=JSON.parse(a.codebook))&&c.codes&&c.codes.length>0?n(c.codes):n([]),c&&c.settings&&r(c.settings)):(n([]),r(null));case 4:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),lt=function(e){var t=e.children,n=e.codingjob,a=e.code,c=e.codes,o=e.setCodes,i=e.settings,s=Object(r.useState)(!1),u=Object(T.a)(s,2),l=u[0],d=u[1],j=Object(r.useState)(null),b=Object(T.a)(j,2),f=b[0],p=b[1],h=function(){return Object(L.jsxs)(rt.a,{basic:!0,children:[Object(L.jsx)(A.a,{icon:"plus",compact:!0,size:"mini",onClick:function(){return O(!1)}}),Object(L.jsx)(A.a,{icon:"minus",compact:!0,size:"mini",onClick:v}),Object(L.jsx)(A.a,{icon:"shuffle",compact:!0,size:"mini",onClick:x})]})},O=function(e){p(Object(L.jsx)(dt,{codingjob:n,code:e?"":a.code,codes:c,setOpen:d,setCodes:o}))},v=function(){p(Object(L.jsx)(jt,{codingjob:n,code:a.code,codes:c,setOpen:d,setCodes:o}))},x=function(){p(Object(L.jsx)(bt,{codingjob:n,code:a.code,codes:c,setOpen:d,setCodes:o}))};return i&&!i.can_edit_codes?t:Object(L.jsxs)(at.a,{flowing:!0,hoverable:!0,wide:!0,position:"bottom center",onClose:function(){p(h()),d(!1)},open:l,mouseLeaveDelay:1e7,style:{padding:"0px"},trigger:""===a?Object(L.jsx)(A.a,{onClick:function(){O(!0),d(!0)},style:{marginTop:"1em"},compact:!0,size:"mini",children:"Create new root"}):Object(L.jsx)("span",{onClick:function(){p(h),d(!0)},children:t}),children:[f," "]})},dt=function(e){var t=e.codingjob,n=e.code,a=e.codes,c=e.setOpen,o=e.setCodes,i=Object(P.c)((function(e){return e.codeMap})),s=Object(P.b)(),u=Object(r.useState)(""),l=Object(T.a)(u,2),d=l[0],j=l[1];Object(r.useEffect)((function(){return s(H(!0)),function(){s(H(!1))}}),[s]);var p=function(){var e=Object(f.a)(b.a.mark((function e(r){var s;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(""!==r){e.next=2;break}return e.abrupt("return",null);case 2:if(!i[r]){e.next=4;break}return e.abrupt("return",null);case 4:return(s=Object(g.a)(a)).push({code:r,parent:n}),e.next=8,_.writeCodes(t,s);case 8:o(s),c(!1);case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(L.jsxs)("div",{style:{margin:"1em"},children:[Object(L.jsxs)("p",{children:["Add code under ",Object(L.jsx)("b",{children:""===n?"Root":n}),Object(L.jsx)(A.a,{floated:"right",compact:!0,size:"mini",icon:"delete",onClick:function(){return c(!1)}})]}),Object(L.jsx)(De.a,{onSubmit:function(){return p(d)},children:Object(L.jsx)(ct.a,{autoFocus:!0,onChange:function(e,t){j(t.value)},value:d,icon:Object(L.jsx)($.a,{name:"plus",inverted:!0,circular:!0,link:!0,onClick:function(){return p(d)}}),placeholder:"new code"})})]})},jt=function(e){var t=e.codingjob,n=e.code,a=e.codes,c=e.setOpen,o=e.setCodes,i=Object(P.c)((function(e){return e.codeMap})),s=Object(P.b)();Object(r.useEffect)((function(){return s(H(!0)),function(){s(H(!1))}}),[s]);var u=function(){var e=Object(f.a)(b.a.mark((function e(r){var s,u;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=a.filter((function(e){return e.code!==n})),r?s=s.map((function(e){return i[n].children.includes(e.code)&&(e.parent=i[n].parent),e})):(ft(i,n,u=[]),s=s.filter((function(e){return!u.includes(e.code)}))),e.next=4,_.writeCodes(t,s);case 4:o(s),c(!1);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(L.jsxs)("div",{style:{margin:"1em"},children:[Object(L.jsxs)("p",{children:["Delete ",Object(L.jsx)("b",{children:n}),"?"]}),Object(L.jsxs)(rt.a,{fluid:!0,children:[i[n].children.length>0?Object(L.jsxs)(L.Fragment,{children:[Object(L.jsx)(A.a,{color:"red",onClick:function(){return u(!1)},children:"Yes"}),Object(L.jsx)(A.a,{color:"red",onClick:function(){return u(!0)},children:"Yes, but keep children"})]}):Object(L.jsx)(A.a,{color:"red",onClick:function(){return u(!0)},children:"Yes"}),Object(L.jsx)(A.a,{onClick:function(){return c(!1)},children:"Cancel"})]})]})},bt=function(e){var t=e.codingjob,n=e.code,a=e.codes,c=e.setOpen,o=e.setCodes,i=Object(P.c)((function(e){return e.codeMap})),s=Object(P.b)(),u=Object(r.useState)(i[n].parent),l=Object(T.a)(u,2),d=l[0],j=l[1],p=Object(r.useState)(n),h=Object(T.a)(p,2),O=h[0],v=h[1],x=pt(i,n);Object(r.useEffect)((function(){return s(H(!0)),function(){s(H(!1))}}),[s]);var g=function(){var e=Object(f.a)(b.a.mark((function e(r,s){var u;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r===n){e.next=5;break}if(""!==r){e.next=3;break}return e.abrupt("return",null);case 3:if(!i[r]){e.next=5;break}return e.abrupt("return",null);case 5:return u=a.map((function(e){return e.code===n&&(e.code=r,e.parent=s),e.parent===n&&(e.parent=r),e})),e.next=8,_.writeCodes(t,u);case 8:return e.next=10,_.renameAnnotations(t,n,r);case 10:o(u),c(!1);case 12:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}();return Object(L.jsxs)("div",{style:{margin:"1em"},children:[Object(L.jsxs)("p",{children:["Change parent and/or label",Object(L.jsx)(A.a,{floated:"right",compact:!0,size:"mini",icon:"delete",onClick:function(){return c(!1)}})]}),Object(L.jsxs)(De.a,{onSubmit:function(){return g(O,d)},children:[Object(L.jsxs)(De.a.Field,{inline:!0,children:[Object(L.jsx)("label",{children:"Parent:"}),Object(L.jsx)(ge.a,{value:d,style:{minWidth:"10em"},options:x.map((function(e,t){return{key:e,value:e,text:e}})),search:!0,selectOnNavigation:!1,minCharacters:0,autoComplete:"on",onChange:function(e,t){j(t.value)}})]}),Object(L.jsxs)(De.a.Field,{inline:!0,children:[Object(L.jsx)("label",{children:"Code:"}),Object(L.jsx)(ct.a,{autoFocus:!0,onChange:function(e,t){v(t.value)},value:O,placeholder:"new code"})]}),Object(L.jsx)(A.a,{fluid:!0,onClick:function(){return g(O,d)},children:"Change"})]})]})},ft=function e(t,n,r){var a,c=Object(d.a)(t[n].children);try{for(c.s();!(a=c.n()).done;){var o=a.value;r.push(o),e(t,o,r)}}catch(i){c.e(i)}finally{c.f()}},pt=function(e,t){var n=[];return ft(e,t,n),Object.keys(e).filter((function(e){return!n.includes(e)&&e!==t}))},ht=function(e,t){var n=Object.keys(e).filter((function(t){return!e[t].parent||""===e[t].parent})),r=[];return Ot(e,n,r,[],t),r.map((function(e,t){return Object(l.a)(Object(l.a)({},e),{},{i:t})}))},Ot=function e(t,n,r,a,c){var o,i=Object(d.a)(n);try{for(i.s();!(o=i.n()).done;){var s=o.value,u=Object(g.a)(a);u.push(s),r.push({code:s,codeTrail:a,level:a.length,color:Object(ot.randomColor)({seed:s,luminosity:"light"}),codeTrailSpan:vt(s,a,c)}),t[s].children&&e(t,t[s].children,r,u,c)}}catch(l){i.e(l)}finally{i.f()}},vt=function(e,t,n){return Object(L.jsx)("span",{style:{display:"inline-block",marginLeft:"".concat(1*t.length,"em"),marginRight:"0.5em",height:"0.7em",width:"0.7em",borderRadius:"50%",background:n?Object(ot.randomColor)({seed:e,luminosity:"light"}):"grey",border:"1px solid black"}})},xt=function(e){for(var t=e.reduce((function(e,t){return e[t.code]=Object(l.a)(Object(l.a)({},t),{},{children:[]}),e}),{}),n=0,r=Object.keys(t);n<r.length;n++){var a=r[n];""===t[a].parent||t[t[a].parent]||(t[t[a].parent]={code:t[a].parent,parent:"",children:[]})}for(var c=0,o=Object.keys(t);c<o.length;c++){var i=o[c];t[i].color||(t[i].color=Object(ot.randomColor)({seed:i,luminosity:"light"})),t[i].tree=gt(t,i),t[t[i].parent]&&t[t[i].parent].children.push(i)}return t},gt=function(e,t){for(var n=[],r=e[t].parent;r;)n.push(r),r=e[r].parent;return n.reverse()},mt=function(e){var t=e.showColors,n=void 0===t||t,c=e.typeDelay,o=void 0===c?0:c,i=e.height,s=void 0===i?"30vh":i,u=Object(P.c)((function(e){return e.codingjob})),l=Object(P.b)(),d=Object(r.useState)(!1),j=Object(T.a)(d,2),b=j[0],f=j[1],p=Object(r.useState)([]),h=Object(T.a)(p,2),O=h[0],v=h[1],x=Object(r.useState)(""),m=Object(T.a)(x,2),k=m[0],w=m[1],y=Object(r.useState)([]),C=Object(T.a)(y,2),S=C[0],E=C[1],_=Object(r.useState)(null),R=Object(T.a)(_,2),D=R[0],N=R[1],I=Object(r.useState)(-1),z=Object(T.a)(I,2),B=z[0],F=z[1],H=Object(r.useState)([]),G=Object(T.a)(H,2),M=G[0],W=G[1],q=Object(r.useState)(null),J=Object(T.a)(q,2),K=J[0],U=J[1],Y=a.a.useRef();Object(r.useEffect)((function(){if(!u)return null;ut(u,W,N)}),[u,l]),Object(r.useEffect)((function(){if(!M||0===M.length)return E([]),void l(V({}));var e=xt(M),t=ht(e,n);E(t),l(V(e))}),[M,n,l]),Object(r.useEffect)((function(){var e=setTimeout((function(){K&&st(u,K.code,K.color,M,W),U(null)}),500);return function(){return clearTimeout(e)}}),[u,M,W,K,U]);var $=a.a.useRef(),Q=a.a.useCallback((function(e,t,n){clearTimeout($.current),f(!0),w(t.value),$.current=setTimeout((function(){if(0===t.value.length)return f(!1),void v(!1);var e=new RegExp(t.value.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&"),"i");f(!1),v(n.filter((function(t){return e.test(t.code)})))}),o)}),[o]);Object(r.useEffect)((function(){Y.current&&Y.current.scrollIntoView(!1,{block:"center"})}),[Y,B]),a.a.useEffect((function(){return function(){clearTimeout($.current)}}),[]);return Object(L.jsx)(L.Fragment,{children:Object(L.jsxs)(Ce.a,{singleLine:!0,children:[Object(L.jsx)(Ce.a.Header,{className:"codes-thead",children:Object(L.jsx)(Ce.a.Row,{children:Object(L.jsx)(Ce.a.HeaderCell,{children:Object(L.jsx)(nt.a,{showNoResults:!1,loading:b,onResultSelect:function(e,t){w(t.result.code),F(t.result.i)},onSearchChange:function(e,t){t.results.length>0?F(t.results[[0]].i):F(-1),Q(e,t,S)},resultRenderer:it,results:O,value:k,selectFirstResult:!0})})})}),Object(L.jsx)(Ce.a.Body,{style:{height:s},className:"codes-tbody",children:[].concat(Object(g.a)(S),[""]).map((function(e,t){return Object(L.jsx)(Ce.a.Row,{className:"codes-tr",active:t===B,children:Object(L.jsxs)(Ce.a.Cell,{className:"codes-td",children:[e.code?Object(L.jsx)(A.a,{as:"Input",style:{marginLeft:"".concat(1.5*e.level,"em"),marginRight:"0.8em",padding:"0",width:"1em",height:"1em",color:e.color?e.color:"white"},onChange:function(t){return U({code:e.code,color:t.target.value})},type:"color",value:e.color}):null,Object(L.jsx)(lt,{codingjob:u,code:e,codes:M,setCodes:W,settings:D,children:Object(L.jsx)("span",{ref:t===B?Y:null,style:(n=e.level,0===n?{fontWeight:"bold",fontSize:"15px",cursor:"pointer"}:1===n?{fontSize:"15px",cursor:"pointer"}:2===n?{fontSize:"14px",cursor:"pointer"}:{fontSize:"13px",cursor:"pointer"}),children:e.code})})]})},t);var n}))})]})})},kt=function(){return Object(P.c)((function(e){return e.codingjob}))?Object(L.jsxs)(je.a,{children:[Object(L.jsx)(je.a.Column,{width:8}),Object(L.jsxs)(je.a.Column,{width:8,style:{display:"block",overflow:"auto",height:"90vh"},children:[Object(L.jsx)(D.a,{as:"h4",textAlign:"center",children:"Codes"}),Object(L.jsx)(mt,{})]})]}):null},wt=function(){var e=Object(P.c)((function(e){return e.codingjob})),t=Object(r.useState)("details"),n=Object(T.a)(t,2),a=n[0],c=n[1];return Object(L.jsxs)(je.a,{stackable:!0,children:[Object(L.jsx)(je.a.Column,{floated:"left",width:5,children:Object(L.jsx)(Fe,{type:"table"})}),Object(L.jsx)(je.a.Column,{width:11,children:Object(L.jsxs)(be.a,{style:{border:0},children:[Object(L.jsxs)(u.a,{pointing:!0,secondary:!0,children:[Object(L.jsx)(u.a.Item,{name:"details",active:"details"===a,onClick:function(e,t){return c(t.name)}}),Object(L.jsx)(u.a.Item,{name:"codebook",active:"codebook"===a,onClick:function(e,t){return c(t.name)}}),Object(L.jsx)(ge.a,{as:u.a.Item,active:a.includes("upload"),text:"Upload Documents",children:Object(L.jsxs)(ge.a.Menu,{children:[Object(L.jsx)(ge.a.Item,{text:"Texts CSV",onClick:function(e,t){return c("upload texts CSV")}}),Object(L.jsx)(ge.a.Item,{text:"Tokens CSV",onClick:function(e,t){return c("upload tokens CSV")}})]})})]}),e?function(e){switch(e){case"details":return Object(L.jsx)(Me,{});case"codebook":return Object(L.jsx)(kt,{});case"upload texts CSV":return Object(L.jsx)(qe,{});case"upload tokens CSV":return Object(L.jsx)(Ke,{});case"upload Raw":return Object(L.jsx)(tt,{});default:return null}}(a):Object(L.jsx)("div",{style:{height:"20em"},children:Object(L.jsx)("i",{children:"No codingjob selected"})})]})})]})},yt=n(383),Ct=n(184),St=n(237),Et=n.n(St),_t=(n(349),n(376)),Tt=function(e,t){return t[e]?t[e].color+"50":"white"},Rt=["ArrowRight","ArrowLeft","ArrowUp","ArrowDown"],Dt=a.a.memo((function(e){var t=e.children,n=e.annotations,a=e.currentCode,c=e.newSelection,o=Object(P.c)((function(e){return e.codingjob})),i=Object(P.c)((function(e){return e.codeMap})),s=Object(P.c)((function(e){return e.codeHistory})),u=Object(r.useState)(c?"UNASSIGNED":a),l=Object(T.a)(u,2),d=l[0],j=l[1],b=Object(r.useState)(!1),f=Object(T.a)(b,2),p=f[0],h=f[1],O=Object(P.b)();return Object(r.useEffect)((function(){return O(H(!0)),function(){O(H(!1))}}),[O]),Object(L.jsxs)(at.a,{trigger:t,flowing:!0,hoverable:!0,wide:!0,open:!0,mouseLeaveDelay:1e7,onOpen:function(){return h(!0)},onClose:function(){p&&("UNASSIGNED"===d&&zt(n,d,d,j,O),setTimeout((function(){return O(J(null))}),10))},position:"top left",style:{padding:"0px"},children:[Object(L.jsxs)("div",{style:{minWidth:"12em",textAlign:"center",height:"1.9em",background:"lightgrey",border:"1px solid"},children:[d?"UNASSIGNED"===d?Object(L.jsx)("b",{children:"Create new code"}):Object(L.jsxs)(L.Fragment,{children:["Edit ",Object(L.jsx)("b",{children:d})]}):Object(L.jsx)("b",{children:"Edit which code?"}),Object(L.jsx)(A.a,{compact:!0,floated:"right",icon:"delete",size:"mini",style:{background:"#80808000",margin:"0px"},onClick:function(){"UNASSIGNED"===d&&zt(n,d,d,j,O),O(J(null))}})]}),Object(L.jsxs)("div",{style:{margin:"1em",border:"0px"},children:[Object(L.jsx)(At,{current:d,annotations:n,codeMap:i,setCurrent:j}),Object(L.jsx)(Nt,{codeHistory:s,codingjob:o,codeMap:i,annotations:n,current:d,setCurrent:j})]})]})})),At=function(e){var t=e.current,n=e.annotations,r=e.codeMap,a=e.setCurrent,c=Object.keys(n);return 1===c.length&&a(c[0]),t?null:Object(L.jsx)("div",{children:Object(L.jsx)(It,{active:!0,options:function(e){return e.map((function(e){return{label:e,color:Tt(e,r)}}))}(c),canDelete:!1,callback:function(e){a(e)}},"currentCodePageButtons")})},Nt=function(e){var t=e.codeHistory,n=e.codeMap,c=e.annotations,o=e.current,i=e.setCurrent,s=Object(r.useRef)(null),u=Object(P.b)(),l=Object(r.useState)(!0),d=Object(T.a)(l,2),j=d[0],b=d[1],f=a.a.useCallback((function(e){var t;return(null===s||void 0===s||null===(t=s.current)||void 0===t?void 0:t.children[0])===document.activeElement||b(!0),27===e.keyCode&&u(J(null)),Rt.includes(e.key)||e.keyCode<=46||e.keyCode>=106?null:(s.current.click(),void b(!1))}),[s,u]);Object(r.useEffect)((function(){return window.addEventListener("keydown",f),function(){window.removeEventListener("keydown",f)}}));return o?Object(L.jsxs)(L.Fragment,{children:[Object(L.jsx)(je.a,{children:Object(L.jsx)(je.a.Column,{width:13,floated:"left",children:Object(L.jsx)(_t.a,{innerRef:s,children:Object(L.jsx)(ge.a,{fluid:!0,placeholder:"<type to search>",style:{minWidth:"12em"},options:Object.keys(n).reduce((function(e,t){if(!c[t]){var r=n[t].tree.join(" - ");""===r&&(r="Root"),e.push({key:t,value:t,text:t+" "+r,content:Object(L.jsxs)(L.Fragment,{children:[t,Object(L.jsx)("br",{}),Object(L.jsx)("span",{style:{color:"grey"},children:r})]})})}return e}),[]),open:!j,search:!0,selection:!0,compact:!0,selectOnNavigation:!1,minCharacters:0,autoComplete:"on",onClick:function(){return b(!1)},onSearchChange:function(e,t){""===t.searchQuery&&b(!0)},onClose:function(){return b(!0)},onChange:function(e,t){n[t.value]&&zt(c,o,t.value,i,u)}})})})}),Object(L.jsx)("br",{}),Object(L.jsx)(It,{active:j,options:function(e,t){return e.reduce((function(e,r){return!c[r]&&e.length<=t&&e.push({label:r,color:Tt(r,n)}),e}),[])}(t,5),canDelete:!0,callback:function(e){zt(c,o,null===e?o:e,i,u)}},"newCodePageButtons"),"\xa0\xa0"]}):null},It=function(e){var t=e.active,n=e.options,c=e.canDelete,o=e.callback,i=Object(r.useState)(0),s=Object(T.a)(i,2),u=s[0],l=s[1],d=a.a.useCallback((function(e){var t=c?n.length+1:n.length;if(Rt.includes(e.key))return e.preventDefault(),"ArrowRight"===e.key&&u<t-1&&l(u+1),void("ArrowLeft"===e.key&&u>0&&l(u-1));46===e.keyCode&&o(null),32!==e.keyCode&&13!==e.keyCode||(u===n.length?o(null):o(n[u].label))}),[u,o,n,c]);Object(r.useEffect)((function(){return t?window.addEventListener("keydown",d):window.removeEventListener("keydown",d),function(){window.removeEventListener("keydown",d)}}),[t,d]);return Object(L.jsxs)("span",{children:[n.map((function(e,t){return Object(L.jsx)(A.a,{style:{backgroundColor:e.color},value:e.label,compact:!0,size:"mini",active:t===u,onMouseOver:function(){return l(t)},onClick:function(e,t){return o(t.value)},children:e.label},e.label)})),c?Object(L.jsx)(A.a,{icon:"trash",size:"mini",floated:"right",active:u===n.length,compact:!0,style:{backgroundColor:"red",borderColor:"black"},onMouseOver:function(){return l(n.length)},onClick:function(e,t){return o(null)}}):null]})},zt=function(e,t,n,r,a){if(!e)return null;var c=Object(l.a)({},e[t]);c.group=t;var o=Object(l.a)({},c);if(o.span=[o.index,o.index],a({type:"RM_ANNOTATIONS",payload:[o]}),n===t)return a(J(null,null,null)),null;for(var i=[],s=c.span[0];s<=c.span[1];s++){var u=Object(l.a)({},c);u.group=n,u.index=s,i.push(u)}a(K(i)),a(U(n)),a(J(null,null,null))},Lt=Dt,Bt=a.a.forwardRef((function(e,t){var n=e.token,r=Object(P.c)((function(e){if(0===e.tokenSelection.length)return!1;var t=Object(T.a)(e.tokenSelection,2),r=t[0],a=t[1];if(r>a){var c=[r,a];a=c[0],r=c[1]}return n.index>=r&&n.index<=a})),a="token";return r&&(a+=" selected"),Object(L.jsx)("span",{ref:t,className:a,tokenindex:n.index,children:Object(L.jsx)(Ft,{token:n,selected:r})})})),Ft=function(e){var t=e.token,n=e.selected,r=Object(P.c)((function(e){return e.spanAnnotations[t.index]})),a=Object(P.c)((function(e){return e.codeSelectorTrigger.index!==t.index?null:e.codeSelectorTrigger})),c=Object(P.c)((function(e){return e.codeMap})),o=Object(P.b)();if(Object(P.c)((function(e){return JSON.stringify(e.spanAnnotations[t.index])})),!r)return Object(L.jsx)(L.Fragment,{children:t.pre+t.text+t.post});var i=function(e,n){return Object(L.jsxs)("span",{className:e,onContextMenu:function(e){e.preventDefault(),o(J("right_click",t.index,null))},style:n?{background:n}:null,children:[d&&j?t.text:null,d&&!j?t.text+t.post:null,j&&!d?t.pre+t.text:null,d||j?null:t.pre+t.text+t.post]})},s=Object.keys(r),u=null;if(1===s.length)u=Tt(s[0],c);else{var l=s.map((function(e){return Tt(e,c)}));u="linear-gradient(".concat(l.join(", "),")")}var d=!Object.values(r).some((function(e){return e.span[0]!==e.index})),j=!Object.values(r).some((function(e){return e.span[1]!==e.index})),b=Object.values(r).some((function(e){return e.span[0]===e.index})),f=Object.values(r).some((function(e){return e.span[1]===e.index})),p="annotatedToken";return d&&(p+=" allLeft"),b&!d&&(p+=" anyLeft"),j&&(p+=" allRight"),f&!j&&(p+=" anyRight"),n&&(u=null,p+=" selected"),Object(L.jsxs)(L.Fragment,{children:[d?t.pre:null,a?Object(L.jsx)(Lt,{annotations:r,currentCode:a.code,newSelection:"new_selection"===a.from,children:i(p,u)}):i(p,u),j?t.post:null]})},Pt=a.a.memo(Bt),Ht=function(e){var t=e.doc,n=Object(r.useState)(null),a=Object(T.a)(n,2),c=a[0],o=a[1];return Object(r.useEffect)((function(){Gt(t,o)}),[t]),null===t?null:Object(L.jsx)(de.a,{textAlign:"justified",children:c})},Gt=function(){var e=Object(f.a)(b.a.mark((function e(t,n){var r;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.tokens){e.next=5;break}return r=w(t.text_fields),e.next=5,_.writeTokens(t,r);case 5:if(r){e.next=7;break}return e.abrupt("return",null);case 7:n(Mt(r)),t.tokens=r;case 9:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),Mt=function(e){for(var t=[],n=[],r=[],c=e[0].paragraph,o=e[0].sentence,i=e[0].section,s=0;s<e.length;s++)e[s].paragraph!==c&&(n.push(qt(i+o,r)),t.push(Wt(i+c,n,i)),n=[],r=[],c=e[s].paragraph,o=e[s].sentence,i=e[s].section),e[s].sentence!==o&&(n.push(qt(i+o,r)),r=[],o=e[s].sentence),e[s].index=s,e[s].ref=a.a.createRef(),r.push(Jt(e[s]));return n.push(qt(i+o,r)),t.push(Wt(i+c,n,i)),t},Wt=function(e,t,n){return Object(L.jsx)("span",{style:{marginTop:"1em",display:"table",lineHeight:1.65},children:"title"===n?Object(L.jsx)("h2",{children:t}):t},e)},qt=function(e,t){return Object(L.jsx)("span",{className:"sentence",children:t},e)},Jt=function(e){return Object(L.jsx)(Pt,{ref:e.ref,token:e},e.index)},Kt=a.a.memo(Ht),Vt=n(382),Ut=n(183),Yt=function(){var e=Object(f.a)(b.a.mark((function e(t,n){var r;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=Object.values(n).reduce((function(e,n){for(var r=function(){var r=c[a];if(n[r].index!==n[r].span[0])return"continue";var o=t.tokens.slice(n[r].span[0],n[r].span[1]+1),i={code:r,text:o.map((function(e,t){var n=t>0?e.pre:"",r=t<o.length-1?e.post:"";return n+e.text+r})).join(""),section:n[r].section,offset:n[r].offset,index:n[r].index,length:n[r].length};e.push(i)},a=0,c=Object.keys(n);a<c.length;a++)r();return e}),[]),e.next=3,_.writeAnnotations({doc_id:t.doc_id},r);case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),$t=function(e,t){console.log("matching annotations"),console.log(e.annotations);var n,r=Zt(e.annotations),a={},c=[],o=Object(d.a)(e.tokens);try{for(o.s();!(n=o.n()).done;){var i=n.value;Qt(i,r,a,c)}}catch(v){o.e(v)}finally{o.f()}for(var s={},u=[],l=0,j=c;l<j.length;l++){var b=j[l];s[b.group]||(s[b.group]=0),s[b.group]++,u.push(b)}Xt(u,t);var f=Object.keys(s).sort((function(e,t){return s[e]-s[t]}));t({type:"RESET_CODE_HISTORY"});var p,h=Object(d.a)(f.slice(-5));try{for(h.s();!(p=h.n()).done;){var O=p.value;"UNASSIGNED"!==O&&t(U(O))}}catch(v){h.e(v)}finally{h.f()}},Qt=function(e,t,n,r){for(var a=e.offset,c=e.offset+e.length,o=a;o<=c;o++){var i="".concat(e.section,"-").concat(o);if(t[i]){var s,u=Object(d.a)(t[i].start);try{for(u.s();!(s=u.n()).done;){var j=s.value;n[j]=Object(l.a)({},e),n[j].group=j,n[j].offset=a,n[j].length=null,n[j].span=[e.index]}}catch(h){u.e(h)}finally{u.f()}var b,f=Object(d.a)(t[i].end);try{for(f.s();!(b=f.n()).done;){var p=b.value;n[p]&&(n[p].span.push(e.index),n[p].length=e.offset+e.length-n[p].offset,r.push(n[p]),delete n[p])}}catch(h){f.e(h)}finally{f.f()}}}},Zt=function(e){return e&&""!==e?e.reduce((function(e,t){var n="".concat(t.section,"-").concat(t.offset),r="".concat(t.section,"-").concat(t.offset+t.length);return e[n]||(e[n]={start:[],end:[]}),e[r]||(e[r]={start:[],end:[]}),e[n].start.push(t.code),e[r].end.push(t.code),e}),{}):{}},Xt=function(e,t){var n,r=[],a=Object(d.a)(e);try{for(a.s();!(n=a.n()).done;)for(var c=n.value,o=c.span[0];o<=c.span[1];o++){var i=Object(l.a)({},c);i.index=o,r.push(i)}}catch(s){a.e(s)}finally{a.f()}t({type:"SET_ANNOTATIONS",payload:r})},en=function(e){var t=e.doc,n=Object(P.c)((function(e){return e.spanAnnotations})),a=Object(P.b)();return Object(r.useEffect)((function(){t.writable&&Yt(t,n)}),[t,n]),Object(r.useEffect)((function(){t.writable||0===t.tokens.length||($t(t,a),t.writable=!0)}),[t,a]),Object(L.jsx)("div",{})},tn=["ArrowRight","ArrowLeft","ArrowUp","ArrowDown"],nn=function(e){var t=e.tokenSelection,n=e.currentToken,a=e.tokens,c=e.setMover,o=e.setHoldSpace,i=e.setHoldArrow,s=Object(P.b)();Object(r.useEffect)((function(){return window.addEventListener("keydown",l),window.addEventListener("keyup",u),function(){window.removeEventListener("keydown",l),window.removeEventListener("keyup",u)}}));var u=function(e){if(32===e.keyCode||"Shift"===e.key)return o(!1),void(t.length>0&&an(a,t,s));tn.includes(e.key)&&(i(!1),c(null))},l=function(e){if(32!==e.keyCode&&"Shift"!==e.key){if(tn.includes(e.key)){if(e.preventDefault(),e.repeat)return;c({position:n,startposition:n,ntokens:a.length,counter:1}),i(e.key)}t.length>0&&t[0]===t[1]&&13===e.keyCode&&s(J("enter_key",t[0],null))}else{if(e.preventDefault(),e.repeat)return;o(!0)}};return Object(L.jsx)(L.Fragment,{})},rn=function(e){var t=e.tokenSelection,n=e.tokens,a=Object(r.useState)(!1),c=Object(T.a)(a,2),o=c[0],i=c[1],s=Object(P.b)();Object(r.useEffect)((function(){return window.addEventListener("mousedown",u),window.addEventListener("mousemove",l),window.addEventListener("mouseup",d),window.addEventListener("contextmenu",j),function(){window.removeEventListener("mousedown",u),window.removeEventListener("mousemove",l),window.removeEventListener("mouseup",d),window.removeEventListener("contextmenu",j)}}));var u=function(e){1===e.which&&(i(!0),s({type:"CLEAR_TOKEN_SELECTION"}))},l=function(e){if(o){if(1!==e.which)return null;window.getSelection().empty(),b(e)}else{var t=un(n,e);t&&(s(W(t.index)),s(q(n,t.index,!1)))}},d=function(e){if(1!==e.which)return null;var r=b(e);if(window.getSelection().empty(),i(!1),null===r)return null;t.length>0?an(n,t,s):null!==r&&an(n,[r,r],s)},j=function(e){if(2===e.button)return null;e.preventDefault(),e.stopPropagation()},b=function(e){var t=un(n,e);return t?(s(W(t.index)),s(q(n,t.index,!0)),t.index):null};return Object(L.jsx)(L.Fragment,{})},an=function(e,t,n){var r=Object(T.a)(t,2),a=r[0],c=r[1];if(a>c){var o=[c,a];a=o[0],c=o[1]}for(var i=[],s=e[a].section,u=a;u<=c;u++)e[u].section!==s&&(a=u,s=e[u].section),i.push({index:u,group:"UNASSIGNED",length:e[c].length+e[c].offset-e[a].offset,span:[a,c],section:e[u].section,offset:e[a].offset});n(K(i)),n({type:"CLEAR_TOKEN_SELECTION"}),n(J(null,null,null)),n(J("new_selection",c,null))},cn=function(e,t,n,r,a){var c=n.position;if("ArrowRight"===t&&c++,"ArrowLeft"===t&&c--,"ArrowUp"===t&&(c=on(e,n,"up")),"ArrowDown"===t&&(c=on(e,n,"down")),c>n.ntokens&&(c=n.ntokens),c<0&&(c=0),r&&e[n.position].section!==e[c].section)if(c>n.position){for(var o=c;o>=n.position;o--)if(e[o].section===e[n.position].section){c=o;break}}else for(var i=c;i<=n.position;i++)if(e[i].section===e[n.position].section){c=i;break}if(n.position!==c){a(W(c)),a(q(e,c,r));var s="ArrowRight"===t||"ArrowDown"===t;e[c].ref.current.scrollIntoView(!1,{block:s?"start":"end"})}return c},on=function(e,t){var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"up",a=e[t.position].ref.current.getBoundingClientRect(),c=e[t.startposition].ref.current.getBoundingClientRect();if("up"===r){for(var o=t.position;o>=0;o--)if((n=e[o].ref.current.getBoundingClientRect()).y<a.y&&n.x<=c.x)return o;return 0}if("down"===r){for(var i=null,s=t.position;s<e.length;s++){if(n=e[s].ref.current.getBoundingClientRect(),!i&&n.y>a.y&&(i=n.y),i&&n.y>i)return s-1;if(n.y>a.y&&n.x>=c.x)return s}return e.length-1}},sn=function(e,t){var n=parseInt(t.getAttribute("tokenindex"));return{index:n,offset:e[n].offset,length:e[n].length}},un=function(e,t){try{if(t.originalTarget){if("token"===t.originalTarget.className||"token selected"===t.originalTarget.className)return sn(e,t.originalTarget);if(t.originalTarget.parentNode&&("token"===t.originalTarget.parentNode.className||"token selected"===t.originalTarget.parentNode.className))return sn(e,t.originalTarget.parentNode)}return"token"===t.path[0].className||"token selected"===t.path[0].className?sn(e,t.path[0]):null}catch(t){return null}},ln=function(e){var t=e.tokens,n=Object(P.c)((function(e){return e.currentToken})),a=Object(P.c)((function(e){return e.tokenSelection})),c=Object(P.c)((function(e){return e.eventsBlocked})),o=Object(r.useState)(null),i=Object(T.a)(o,2),s=i[0],u=i[1],l=Object(r.useState)(!1),d=Object(T.a)(l,2),j=d[0],b=d[1],f=Object(r.useState)(null),p=Object(T.a)(f,2),h=p[0],O=p[1],v=Object(P.b)();return Object(r.useEffect)((function(){c&&(O(!1),b(!1))}),[O,b,c]),Object(r.useEffect)((function(){if(s&&h){var e=cn(t,h,s,j,v),n=Math.max(5,100/Math.ceil(s.counter/5));1===s.counter&&(n=150),setTimeout((function(){u({position:e,startposition:s.startposition,ntokens:s.ntokens,counter:s.counter+1})}),n)}}),[t,s,h,j,v]),t?c?null:Object(L.jsxs)(L.Fragment,{children:[Object(L.jsx)(nn,{tokenSelection:a,currentToken:n,tokens:t,setMover:u,setHoldSpace:b,setHoldArrow:O}),Object(L.jsx)(rn,{tokenSelection:a,tokens:t})]}):null},dn=(n(350),[4,2,2]),jn=function(e,t){for(var n=[],r=null,a=null,c=0,o=Object.keys(t);c<o.length;c++)for(var i=o[c],s=function(){var c=l[u];if((a=t[i][c]).index!==a.span[0])return"continue";var o=e.slice(a.span[0],a.span[1]+1);r=o.map((function(e,t){var n=t>0?e.pre:"",r=t<o.length-1?e.post:"";return n+e.text+r})).join("");var s=Object(L.jsx)(bn,{tokens:e,token:a,code:c,text:r},i+c);n.push(s)},u=0,l=Object.keys(t[i]);u<l.length;u++)s();return n},bn=function(e){var t=e.tokens,n=e.token,a=e.code,c=e.text,o=Object(P.c)((function(e){return e.codeMap})),i=Object(P.c)((function(e){return e.currentToken>=n.span[0]&&e.currentToken<=n.span[1]})),s=Object(r.useRef)(),u=Object(P.b)();Object(r.useEffect)((function(){i?s.current&&(s.current.style.backgroundColor="grey",s.current.scrollIntoView(!1,{block:"nearest"})):s.current&&(s.current.style.backgroundColor=null)}),[i]);var l=Tt(a,o);return Object(L.jsx)(_t.a,{innerRef:s,children:Object(L.jsxs)(Ce.a.Row,{className:"annotations-tr",onClick:function(){t[n.index].ref.current.scrollIntoView(!1,{block:"center"}),u(J(null,null,null)),u(J("menu",n.index,a))},onMouseOver:function(){},children:[Object(L.jsx)(Ce.a.Cell,{width:dn[0],style:l?{background:l}:null,children:Object(L.jsx)("span",{title:a,children:a})}),Object(L.jsx)(Ce.a.Cell,{width:dn[1],children:n.section}),Object(L.jsx)(Ce.a.Cell,{width:dn[2],cref:s,children:"".concat(n.offset,"-").concat(n.offset+n.length)}),Object(L.jsx)(Ce.a.Cell,{children:Object(L.jsx)("span",{title:c,children:c})})]})})},fn=function(e){var t=e.tokens,n=Object(P.c)((function(e){return e.spanAnnotations}));return t&&0!==t.length?Object(L.jsxs)(Ce.a,{style:{fontSize:"10px"},fixed:!0,role:"grid","arioa-labelledby":"header",selectable:!0,unstackable:!0,singleLine:!0,compact:"very",size:"small",children:[Object(L.jsx)(Ce.a.Header,{className:"annotations-thead",children:Object(L.jsxs)(Ce.a.Row,{children:[Object(L.jsx)(Ce.a.HeaderCell,{width:dn[0],children:"Code"}),Object(L.jsx)(Ce.a.HeaderCell,{width:dn[1],children:"Section"}),Object(L.jsx)(Ce.a.HeaderCell,{width:dn[2],children:"Span"}),Object(L.jsx)(Ce.a.HeaderCell,{children:"Text"})]})}),Object(L.jsx)(Ce.a.Body,{className:"annotations-tbody",children:jn(t,n)})]}):null},pn={height:"35vh"},hn={overflowY:"auto",height:"45vh"},On=function(){return Object(L.jsxs)(de.a,{children:[Object(L.jsx)(D.a,{as:"h2",align:"center",children:"Span annotations"}),Object(L.jsx)("p",{align:"center",children:"Assign codes to words or phrases. A word can have multiple codes."}),Object(L.jsxs)(Ce.a,{compact:!0,size:"small",children:[Object(L.jsx)(Ce.a.Header,{children:Object(L.jsxs)(Ce.a.Row,{children:[Object(L.jsx)(Ce.a.HeaderCell,{}),Object(L.jsx)(Ce.a.HeaderCell,{children:"Keyboard"}),Object(L.jsx)(Ce.a.HeaderCell,{children:"Mouse"})]})}),Object(L.jsxs)(Ce.a.Body,{children:[Object(L.jsxs)(Ce.a.Row,{children:[Object(L.jsx)(Ce.a.Cell,{children:Object(L.jsx)("strong",{children:"Navigate"})}),Object(L.jsx)(Ce.a.Cell,{children:Object(L.jsx)("i",{children:"Arrow keys"})}),Object(L.jsx)(Ce.a.Cell,{})]}),Object(L.jsxs)(Ce.a.Row,{children:[Object(L.jsx)(Ce.a.Cell,{children:Object(L.jsx)("strong",{children:"Select words"})}),Object(L.jsxs)(Ce.a.Cell,{children:[Object(L.jsx)("i",{children:"shift"})," or ",Object(L.jsx)("i",{children:"spacebar"}),Object(L.jsx)("br",{}),"Hold to select mutiple"]}),Object(L.jsxs)(Ce.a.Cell,{children:[Object(L.jsx)("i",{children:"Left-click"}),Object(L.jsx)("br",{}),"Hold to select multiple"]})]}),Object(L.jsxs)(Ce.a.Row,{children:[Object(L.jsx)(Ce.a.Cell,{children:Object(L.jsx)("strong",{children:"Edit code"})}),Object(L.jsxs)(Ce.a.Cell,{children:[Object(L.jsx)("i",{children:"Enter"})," when cursor on annotation"]}),Object(L.jsxs)(Ce.a.Cell,{children:[Object(L.jsx)("i",{children:"Right-click"})," annotation"]})]})]}),Object(L.jsx)(Ce.a.Footer,{children:Object(L.jsxs)(Ce.a.Row,{children:[Object(L.jsxs)(Ce.a.HeaderCell,{children:[Object(L.jsx)("strong",{children:"Quick keys"})," ",Object(L.jsx)("br",{}),"in popup"]}),Object(L.jsx)(Ce.a.HeaderCell,{colSpan:"2",children:Object(L.jsxs)(Vt.a,{as:"ul",children:[Object(L.jsxs)(Ut.a,{as:"li",children:[Object(L.jsx)("i",{children:"text input"})," automatically opens dropdown"," "]}),Object(L.jsxs)(Ut.a,{as:"li",children:["select recent codes with ",Object(L.jsx)("i",{children:"arrow keys"})," and ",Object(L.jsx)("i",{children:"Enter"})]}),Object(L.jsxs)(Ut.a,{as:"li",children:["use ",Object(L.jsx)("i",{children:"escape"})," to close popup and ",Object(L.jsx)("i",{children:"delete"})," to remove code"]})]})})]})})]})]})},vn=function(e){var t=e.doc;return t.tokens?Object(L.jsxs)(L.Fragment,{children:[Object(L.jsx)(je.a.Row,{style:pn,children:Object(L.jsx)(fn,{tokens:t.tokens})}),Object(L.jsx)(je.a.Row,{style:hn,children:Object(L.jsx)(On,{})}),Object(L.jsx)(ln,{tokens:t.tokens}),Object(L.jsx)(en,{doc:t})]}):null},xn={overflowY:"auto",height:"75vh"},gn=function(e){var t=e.doc;return t?Object(L.jsxs)(je.a,{container:!0,columns:2,children:[Object(L.jsx)(je.a.Column,{width:8,style:xn,children:Object(L.jsx)(Kt,{doc:t})}),Object(L.jsx)(je.a.Column,{width:8,children:Object(L.jsx)(vn,{doc:t})})]}):null},mn=function(e,t,n,r,a){return Object(L.jsxs)(L.Fragment,{children:[Object(L.jsx)(je.a.Row,{children:Object(L.jsx)(ct.a,{min:1,max:n,onChange:function(e,t){return a(t.value)},type:"range",value:t})}),Object(L.jsx)(je.a.Row,{children:Object(L.jsx)(_e.a,{activePage:t,size:"mini",firstItem:null,lastItem:null,siblingRange:0,boundaryRange:0,ellipsisItem:null,totalPages:n,onPageChange:function(e,t){return r(t.activePage)}})})]})},kn=function(){var e=Object(f.a)(b.a.mark((function e(t,n,r,a){var c;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,_.getJobDocumentCount(t);case 2:c=e.sent,r(c),c>0?wn(t,0,n,"",a):n(null);case 5:case"end":return e.stop()}}),e)})));return function(t,n,r,a){return e.apply(this,arguments)}}(),wn=function(){var e=Object(f.a)(b.a.mark((function e(t,n,r,a,c){var o;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return",null);case 2:return e.next=4,_.getJobDocumentsBatch(t,n,1);case 4:(o=e.sent)[0].codeMapHash=a,o[0].writable=!1,o&&r(o[0]);case 8:case"end":return e.stop()}}),e)})));return function(t,n,r,a,c){return e.apply(this,arguments)}}(),yn=function(){var e=Object(f.a)(b.a.mark((function e(t,n,r){var a,c,o,i,s;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Et.a.get(t);case 2:return a=e.sent,c=a.data,o={name:c.details.name,job_id:x()(c)},e.next=7,_.getCodingjob(o);case 7:if(o=e.sent){e.next=15;break}return e.next=11,_.createCodingjob(c.details.name,x()(c));case 11:return e.next=13,_.createDocuments(o,c.documents,!0);case 13:return e.next=15,_.writeCodebook(o,c.codebook);case 15:return e.next=17,_.listCodingjobs();case 17:return i=e.sent,e.next=20,_.getCodingjob(o);case 20:s=e.sent,n(G(s)),n(M(i)),r(!0);case 24:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),Cn="/amcat4annotator",Sn=[{label:"Coding Jobs",path:Cn+"/codingjobs",Component:wt},{label:"Annotate",path:Cn+"/annotate",Component:function(){var e=Object(P.c)((function(e){return e.codingjob})),t=Object(P.c)((function(e){return e.codeMap})),n=Object(P.b)(),a=Object(s.h)(),c=Object(r.useState)(null),o=Object(T.a)(c,2),i=o[0],u=o[1],l=Object(r.useState)(0),d=Object(T.a)(l,2),j=d[0],b=d[1],f=Object(r.useState)(1),p=Object(T.a)(f,2),h=p[0],O=p[1],v=Object(r.useState)(1),g=Object(T.a)(v,2),m=g[0],k=g[1],w=Object(r.useState)(!1),y=Object(T.a)(w,2),C=y[0],S=y[1];return Object(r.useEffect)((function(){if(a.search){var e=a.search.substring(1);yn(e,n,S)}else S(!0)}),[a,n]),Object(r.useEffect)((function(){return e&&C?(O(1),void kn(e,u,b,n)):null}),[e,C,n]),Object(r.useEffect)((function(){if(!C)return null;wn(e,h-1,u,x()(t),n),k(h)}),[e,h,t,C,n]),Object(r.useEffect)((function(){var e=setTimeout((function(){O(m)}),500);return function(){return clearTimeout(e)}}),[e,m]),Object(L.jsxs)(je.a,{container:!0,columns:2,children:[Object(L.jsxs)(je.a.Row,{children:[Object(L.jsx)(je.a.Column,{width:10,children:Object(L.jsxs)(yt.a,{children:[Object(L.jsx)(Ct.a,{link:!0,style:{minWidth:"5em"},children:Object(L.jsx)(Fe,{type:"dropdown"})}),Object(L.jsx)(yt.a.Divider,{}),Object(L.jsx)(Ct.a,{children:(null===i||void 0===i?void 0:i.document_id)?i.document_id:h})]})}),Object(L.jsx)(je.a.Column,{align:"center",floated:"right",width:4,children:mn(h,m,j,O,k)})]}),Object(L.jsx)(je.a.Row,{children:Object(L.jsx)(gn,{doc:i||null})})]})}}],En=function(){var e,t=Object(P.c)((function(e){return e.showSidebar}));return Object(L.jsxs)(i.a,{children:[Object(L.jsx)(se,{items:Sn,homepage:Cn}),Object(L.jsx)(ue.a,{}),Object(L.jsxs)(le.a.Pushable,{children:[Object(L.jsx)(le.a,{animation:"overlay",visible:t,direction:"right",width:"wide",style:{backgroundColor:"white"},children:Object(L.jsx)(mt,{height:"80vh",showColors:!0})}),Object(L.jsx)(le.a.Pusher,{children:Object(L.jsx)(de.a,{style:{marginTop:"3em"},children:Object(L.jsxs)(s.d,{children:[Object(L.jsx)(s.b,{exact:!0,path:Cn,render:function(){return Object(L.jsx)(Oe,{items:Sn})}}),(e=Sn,e.map((function(e){return Object(L.jsx)(xe,{path:e.path,homepage:Cn,Component:e.Component},e.path)})))]})})})]})]})},_n=n(100),Tn=function(e,t,n,r){if(!r||0===e.length)return[n,n];if(t[e[0]].section===t[n].section)return[e[0],n];if(n>e[0]){for(var a=n;a>=e[0];a--)if(t[e[0]].section===t[a].section)return[e[0],a]}else for(var c=n;c<=e[0];c++)if(t[e[0]].section===t[c].section)return[e[0],c];return e},Rn=function(e,t,n){for(var r in t){var a=t[r];if(e[a.index]&&e[a.index][a.group]){for(var c=e[a.index][a.group].span,o=c[0];o<=c[1];o++)e[o]&&e[o][a.group]&&(delete e[o][a.group],0===Object.keys(e[o]).length&&delete e[o]);if(a.span[0]===a.span[1])continue}n||(e[a.index]||(e[a.index]={}),e[a.index][a.group]={index:a.index,span:[a.span[0],a.span[1]],length:a.length,section:a.section,offset:a.offset})}return e},Dn=Object(_n.b)({db:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_DB":return t.payload;case"RESET_DB":return null;default:return e}},eventsBlocked:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"BLOCK_EVENTS":return t.payload;default:return e}},codingjob:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SELECT_CODINGJOB":return t.payload;case"RESET_DB":return null;default:return e}},codingjobs:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_CODINGJOBS":return t.payload;case"RESET_DB":return[];default:return e}},codingjobSettings:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_CODINGJOB_SETTINGS":return t.payload;case"RESET_DB":return{};default:return e}},tokenIndices:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_TOKEN_INDICES":return t.payload;case"SELECT_DOCUMENT":case"RESET_DB":return[];default:return e}},currentToken:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_CURRENT_TOKEN":return t.payload;case"SELECT_DOCUMENT":case"RESET_DB":return 0;default:return e}},codeSelectorTrigger:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{from:null,index:null,code:null},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"TRIGGER_CODESELECTOR":return{from:t.from,index:t.index,code:t.code};default:return e}},tokenSelection:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"TOGGLE_TOKEN_SELECTION":return Tn(e,t.payload.tokens,t.payload.index,t.payload.add);case"SET_TOKEN_SELECTION":return t.payload;case"CLEAR_TOKEN_SELECTION":case"RESET_DB":return[];default:return e}},spanAnnotations:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_ANNOTATIONS":return Rn({},t.payload,!1);case"TOGGLE_ANNOTATIONS":return Rn(Object(l.a)({},e),t.payload,!1);case"RM_ANNOTATIONS":return Rn(Object(l.a)({},e),t.payload,!0);case"CLEAR_SPAN_ANNOTATIONS":case"RESET_DB":return{};default:return e}},codeMap:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_CODE_MAP":return t.payload;case"RESET_DB":return{};default:return e}},codeHistory:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"RESET_CODE_HISTORY":return[];case"APPEND_CODE_HISTORY":var n=e.filter((function(e){return e!==t.payload.code})).slice(0,t.payload.n-1);return n.unshift(t.payload.code),n;case"RESET_DB":return[];default:return e}},showSidebar:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_SHOW_SIDEBAR":return t.payload;default:return e}}}),An=Object(_n.c)(Dn);o.a.render(Object(L.jsx)(a.a.StrictMode,{children:Object(L.jsx)(P.a,{store:An,children:Object(L.jsx)(En,{})})}),document.querySelector("#root"))}},[[351,1,2]]]);
//# sourceMappingURL=main.13932245.chunk.js.map