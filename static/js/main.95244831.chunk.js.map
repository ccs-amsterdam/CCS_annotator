{"version":3,"sources":["../node_modules/react-semantic-ui-datepickers/dist/locales sync /^/.//.*/.json$","apis/dropbox.js","actions/index.js","components/DropboxSync.js","components/Dropbox.js","components/Download.js","components/Reset.js","apis/storemanager.js","components/Persist.js","components/HeaderMenu.js","apis/dexie.js","components/Welcome.js","components/AuthRoute.js","components/SelectionTable.js","components/CreateCodingjob.js","components/DeleteCodingjob.js","components/CodingjobSelector.js","components/DocumentTable.js","components/JobDetails.js","components/UploadDocuments.js","components/CreateDocument.js","components/Create.js","components/ManageAnnotations.js","components/CodeSelector.js","components/Token.js","components/Tokens.js","components/AnnotationText.js","App.js","components/Annotate.js","reducers/index.js","index.js"],"names":["map","webpackContext","req","id","webpackContextResolve","__webpack_require__","o","e","Error","code","keys","Object","resolve","module","exports","clientID","setDB","db","type","payload","setDropbox","dropbox","selectCodingjob","codingjob","setCodingjobs","codingjobs","toggleAnnotations","spanAnnotation","DropboxAPI","dbx","user","this","filepath","filesDownload","path","email","data_array","file","File","filesUpload","name","contents","makeConnection","dbxAuth","token","a","setAccessToken","Dropbox","auth","usersGetCurrentAccount","result","getAuthToken","redirectURL","codeVerifier","window","sessionStorage","getItem","setCodeVerifier","generateCodeChallenge","getAccessTokenFromCode","access_token","refresh_token","expiration_date","Date","now","expires_in","DropboxSync","useState","open","setOpen","useSelector","state","dispatch","useDispatch","Modal","closeIcon","trigger","Menu","Item","icon","style","color","onClose","onOpen","Header","content","Content","Actions","Button","primary","onClick","writeJSON","deleteToken","route","DropboxAuth","clientId","DropboxConnect","tryRestore","setTryRestore","history","useHistory","useEffect","console","log","connect","connection","addToken","getToken","then","setRefreshToken","refreshAccessToken","queryString","parse","location","search","push","catch","getAuthenticationUrl","undefined","authUrl","clear","setItem","href","error","progressCallback","totalRows","completedRows","Download","onDownload","exportDB","idb","filter","table","value","key","prettyJson","blob","fileDownload","Reset","Icon","deleteDB","initStoragePersistence","tryPersistWithoutPromtingUser","persist","navigator","storage","isStoragePersisted","persisted","permissions","query","permission","Persist","setPersisted","alert","withRouter","items","useLocation","menuItems","item","index","as","Link","to","header","disabled","active","pathname","label","fixed","inverted","position","AnnotationDB","Dexie","version","stores","apis","documents","api","put","delete","get","job_id","hash","toString","add","listDocuments","deleteDocuments","toArray","equals","documentList","Set","where","primaryKeys","ids","duplicates","preparedDocuments","reduce","document","doc_id","has","annotations","length","JSON","message","bulkAdd","documentIds","bulkDelete","field","modify","Welcome","loggin","exists","Grid","textAlign","height","verticalAlign","Column","maxWidth","Segment","border","Image","src","AuthRoute","Component","componentProps","render","props","SelectionTable","columns","data","selectedRow","setSelectedRow","defaultSize","ROW_ID","activeRow","setActiveRow","useTable","initialState","pageSize","globalFilter","useGlobalFilter","useSortBy","usePagination","getTableProps","getTableBodyProps","headerGroups","prepareRow","page","pageCount","gotoPage","setPageSize","preGlobalFilteredRows","setGlobalFilter","pageIndex","GlobalFilter","count","onChange","target","placeholder","createHeader","headerGroup","headers","column","TableHeaderCell","className","headerClass","getHeaderProps","getSortByToggleProps","isSorted","isSortedDesc","Table","striped","singleLine","selectable","TableHeader","TableRow","getHeaderGroupProps","TableBody","row","i","onRowSelect","getRowProps","cells","cell","TableCell","title","getCellProps","createBody","Dropdown","text","options","n","d","marginTop","display","justifyContent","Pagination","size","firstItem","lastItem","nextItem","prevItem","boundaryRange","ellipsisItem","activePage","totalPages","onPageChange","event","CreateCodingjob","status","setStatus","codingjobName","setCodingjobName","Form","onSubmit","preventDefault","trim","createCodingjob","res","listCodingjobs","Group","Input","width","required","Dimmer","Loader","DeleteCodingjob","deleteCodingjob","CodingjobSelector","indices","selectedCodingjob","setSelectedCodingjob","setDocuments","cjs","widths","Container","accessor","clearable","selection","findIndex","onDropdownSelect","documentTableColumns","DocumentTable","selectDocument","JobDetails","SubmitForm","fileRef","setOptions","titleField","setTitleField","textField","setTextField","annotationsField","setAnnotationsField","colname","includes","csvToJson","slice","datarow","obj","meta","stringify","uploadData","preparedData","createDocuments","current","removeFile","Field","control","Select","fluid","PreviewTable","createRowCells","Cell","basic","Row","HeaderCell","Body","createRows","align","UploadDocuments","setActive","setData","useRef","floated","ref","onFileLoad","addRemoveButton","onRemoveFile","DocumentForms","fields","fieldValues","setFieldValues","newFieldValues","TextArea","CreateDocument","submitData","test","toISOString","Create","activeItem","setActiveItem","pointing","secondary","renderSwitch","exportAnnotations","doc","unique","uniqueAnnotations","values","un_ann","ann","ann_obj","offset","json","writeValue","matchAnnotations","tokens","importedAnnotations","trackAnnotations","matchedAnnotations","findMatches","addAnnotations","start","end","group","span","newAnnotations","newAnnotation","ManageAnnotations","spanAnnotations","ready","setReady","CodeSelector","children","codes","codeHistory","textInputRef","setCurrent","userAccess","annotation","toggleListener","on","addEventListener","onKeydown","removeEventListener","click","getColor","tokenCode","codematch","find","updateAnnotations","oldAnnotation","appendCodeHistory","ddOptions","useValue","Popup","flowing","hoverable","wide","Step","vertical","Title","Description","backgroundColor","getCurrentOptions","compact","Ref","innerRef","allowAdditions","additionPosition","onAddItem","setCodes","randomColor","seed","luminosity","selectOnNavigation","minCharacters","autoComplete","searchInput","autoFocus","Token","tokenindex","tokenoffset","tokenlength","FancyToken","React","memo","pre","post","tokenCodes","colors","join","allLeft","some","allRight","tokenClass","background","nlp","extend","paragraphs","Tokens","setTokens","tokenComponents","setTokenComponents","prepareTokens","tokenize","par","par_i","createParagraph","mapSentences","sentences","sent","sent2","createSentence","terms","mapTokens","getTokenAttributes","tokenNode","parseInt","getAttribute","parentNode","AnnotationText","onKeyDown","onMouseUp","which","getSelection","anchorNode","focusNode","from","parentElement","empty","defaultValue","ctrlKey","setDoc","setDocumentList","getDocument","dropdownOptions","App","Divider","exact","annList","rm","testCodes","rootReducer","combineReducers","action","tokenIndices","newstate","v","unshift","store","createStore","ReactDOM","StrictMode","querySelector"],"mappings":"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","file":"static/js/main.95244831.chunk.js","sourcesContent":["var map = {\n\t\"./bg-BG.json\": 465,\n\t\"./ca-ES.json\": 466,\n\t\"./cs-CZ.json\": 467,\n\t\"./de-DE.json\": 468,\n\t\"./en-US.json\": 290,\n\t\"./es-ES.json\": 469,\n\t\"./et-EE.json\": 470,\n\t\"./fi-FI.json\": 471,\n\t\"./fr-FR.json\": 472,\n\t\"./he-IL.json\": 473,\n\t\"./it-IT.json\": 474,\n\t\"./ja-JP.json\": 475,\n\t\"./ko-KR.json\": 476,\n\t\"./nb-NO.json\": 477,\n\t\"./nn-NO.json\": 478,\n\t\"./pl-PL.json\": 479,\n\t\"./pt-BR.json\": 480,\n\t\"./ru-RU.json\": 481,\n\t\"./sv-SE.json\": 482,\n\t\"./tr-TR.json\": 483,\n\t\"./zh-CN.json\": 484\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 464;","import { Dropbox, DropboxAuth } from \"dropbox\";\nimport queryString from \"query-string\";\n\n// this is just a simple wrapper around Dropbox that gives access\n// to just the methods that we need and in a format that we might\n// reuse with a different api\nexport default class DropboxAPI {\n  constructor(dbx, user) {\n    this.dbx = dbx;\n    this.user = user;\n  }\n\n  readJSON(filepath) {\n    this.dbx.filesDownload({\n      path: `/${this.user.email}/${filepath}`,\n    });\n  }\n\n  writeJSON(data_array, filepath) {\n    const file = new File(data_array, filepath, {\n      type: \"application/json\",\n    });\n    this.dbx.filesUpload({\n      path: `/${this.user.email}/${file.name}`,\n      contents: file,\n    });\n  }\n}\n\nexport const makeConnection = async (dbxAuth, token) => {\n  dbxAuth.setAccessToken(token);\n  const dbx = new Dropbox({ auth: dbxAuth });\n  const user = await dbx.usersGetCurrentAccount();\n  return new DropboxAPI(dbx, user.result);\n};\n\nexport const getDropboxAuth = (clientID) => {\n  return new DropboxAuth({\n    clientId: clientID,\n  });\n};\n\nexport const getCodeFromDropbox = (dbxAuth, redirectURL) => {\n  dbxAuth\n    .getAuthenticationUrl(\n      redirectURL,\n      undefined,\n      \"code\",\n      \"offline\",\n      undefined,\n      undefined,\n      true\n    )\n    .then((authUrl) => {\n      window.sessionStorage.clear();\n      window.sessionStorage.setItem(\"codeVerifier\", dbxAuth.codeVerifier);\n      window.location.href = authUrl;\n    })\n    .catch((error) => console.error(error));\n};\n\nexport const getCodeFromUrl = () => {\n  // the dropbox code is returned as the 'code' query param.\n  return queryString.parse(window.location.search).code;\n};\n\nexport const getAuthToken = async (dbxAuth, code, redirectURL) => {\n  // PKCE authentication\n  const codeVerifier = window.sessionStorage.getItem(\"codeVerifier\");\n  dbxAuth.setCodeVerifier(codeVerifier);\n  await dbxAuth.generateCodeChallenge();\n  const token = await dbxAuth.getAccessTokenFromCode(redirectURL, code);\n  return {\n    token: token.result.access_token,\n    refresh_token: token.result.refresh_token,\n    expiration_date: Date.now() + token.result.expires_in * 1000,\n  };\n};\n","export const setDB = (db) => {\n  return {\n    type: \"SET_DB\",\n    payload: db,\n  };\n};\n\nexport const resetDB = () => {\n  return {\n    type: \"RESET_DB\",\n  };\n};\n\nexport const setDropbox = (dropbox) => {\n  return {\n    type: \"SET_DROPBOX\",\n    payload: dropbox,\n  };\n};\n\nexport const selectCodingjob = (codingjob) => {\n  return {\n    type: \"SELECT_CODINGJOB\",\n    payload: codingjob,\n  };\n};\n\nexport const setCodingjobs = (codingjobs) => {\n  return {\n    type: \"SET_CODINGJOBS\",\n    payload: codingjobs,\n  };\n};\n\nexport const selectDocument = (document) => {\n  return {\n    type: \"SELECT_ARTICLE\",\n    payload: document,\n  };\n};\n\nexport const setDocuments = (document) => {\n  return {\n    type: \"SET_DOCUMENTS\",\n    payload: document,\n  };\n};\n\nexport const setTokenIndices = (tokenIndices) => {\n  return {\n    type: \"SET_TOKEN_INDICES\",\n    payload: tokenIndices,\n  };\n};\n\nexport const toggleAnnotations = (spanAnnotation) => {\n  return {\n    type: \"TOGGLE_ANNOTATIONS\",\n    payload: spanAnnotation,\n  };\n};\n\nexport const rmAnnotations = (spanAnnotation) => {\n  return {\n    type: \"RM_ANNOTATIONS\",\n    payload: spanAnnotation,\n  };\n};\n\nexport const clearSpanAnnotations = () => {\n  return {\n    type: \"CLEAR_SPAN_ANNOTATIONS\",\n  };\n};\n\nexport const setCodes = (codes) => {\n  return {\n    type: \"SET_CODES\",\n    payload: codes,\n  };\n};\n\nexport const appendCodeHistory = (code, n = 5) => {\n  return {\n    type: \"APPEND_CODE_HISTORY\",\n    payload: { code: code, n: n },\n  };\n};\n","import React, { useState } from \"react\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport { Menu, Header, Modal, Button } from \"semantic-ui-react\";\nimport { setDropbox } from \"../actions\";\n\n// dropbox endpoints\n// https://dropbox.github.io/dropbox-sdk-js/Dropbox.html\n\nconst DropboxSync = () => {\n  const [open, setOpen] = useState(false);\n  const dropbox = useSelector((state) => state.dropbox);\n  const dispatch = useDispatch();\n  const db = useSelector((state) => state.db);\n\n  const onSync = () => {\n    dropbox.writeJSON([\"test\"], \"test.json\");\n  };\n\n  const onDisconnect = () => {\n    if (db) db.deleteToken(\"dropbox\");\n    dispatch(setDropbox(null));\n  };\n\n  return (\n    <Modal\n      closeIcon\n      open={open}\n      trigger={\n        <Menu.Item icon=\"dropbox\" name=\"Sync\" style={{ color: \"lightblue\" }} />\n      }\n      onClose={() => setOpen(false)}\n      onOpen={() => setOpen(true)}\n    >\n      <Header icon=\"dropbox\" content=\"Synchronize with Dropbox\" />\n      <Modal.Content>\n        <p>Something about synchronization.</p>\n      </Modal.Content>\n      <Modal.Actions>\n        <Button primary onClick={onSync}>\n          Synchronize\n        </Button>\n        <Button primary onClick={onDisconnect}>\n          Disconnect\n        </Button>\n      </Modal.Actions>\n    </Modal>\n  );\n};\n\nexport default DropboxSync;\n","import React, { useEffect, useState } from \"react\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport { setDropbox } from \"../actions\";\nimport { useHistory } from \"react-router-dom\";\nimport { Menu, Modal, Header, Button } from \"semantic-ui-react\";\n\nimport {\n  getDropboxAuth,\n  getCodeFromDropbox,\n  makeConnection,\n  getCodeFromUrl,\n  getAuthToken,\n} from \"../apis/dropbox\";\nimport DropboxSync from \"./DropboxSync\";\n\n// PKCE browser authentication for Dropbox:\n// https://github.com/dropbox/dropbox-sdk-js\n\nconst clientID = \"doge8b5gywmaz6x\";\nconst host = \"http://localhost:3000\";\nconst route = \"/create\";\nconst redirectURL = host + route;\n\nlet dbxAuth = getDropboxAuth(clientID); // this is an ID that doesn't have to be secret\nconst DropboxConnect = () => {\n  const [open, setOpen] = useState();\n  const dropbox = useSelector((state) => state.dropbox);\n  const db = useSelector((state) => state.db);\n  const [tryRestore, setTryRestore] = useState(true);\n  const dispatch = useDispatch();\n  const history = useHistory();\n\n  // Change this if you're deploying this app on another host\n  // You'll need to create your own Dropbox app, where you specify\n  // allowed redirect urls for the new host\n\n  useEffect(() => {\n    console.log(\"listen\");\n    if (dropbox || !db) return;\n\n    const connect = async (token) => {\n      try {\n        const connection = await makeConnection(dbxAuth, token.token);\n        await db.addToken(\"dropbox\", token);\n        await dispatch(setDropbox(connection));\n      } catch (e) {\n        console.log(e);\n      }\n    };\n\n    if (tryRestore) {\n      setTryRestore(false); // try once to get token from db (once db is loaded)\n      // check for token in db to restore connection\n      db.getToken(\"dropbox\").then((token) => {\n        if (!token) return;\n        if (!token.token) return;\n\n        if (Date.now() > token.expiration_date) {\n          //not yet tested\n          console.log(\"Trying refresh\");\n          dbxAuth.setRefreshToken(token.refresh_token);\n          dbxAuth.refreshAccessToken().then(connect);\n        } else {\n          connect(token);\n        }\n      });\n    }\n\n    // check for code in url from dropbox redirect\n    const code = getCodeFromUrl();\n    if (code)\n      getAuthToken(dbxAuth, code, redirectURL)\n        .then(connect)\n        .then(() => {\n          history.push(route); // remove code from url\n        })\n        .catch((e) => console.log(e));\n  }, [dropbox, db, tryRestore, dispatch, history]);\n\n  const startAuthentication = () => {\n    // redirects from dropbox with code in url\n    getCodeFromDropbox(dbxAuth, redirectURL);\n  };\n\n  if (!db) return null;\n\n  if (dropbox) {\n    return <DropboxSync />;\n  }\n\n  return (\n    <Modal\n      closeIcon\n      open={open}\n      trigger={<Menu.Item icon=\"dropbox\" name=\"Connect\" />}\n      onClose={() => setOpen(false)}\n      onOpen={() => setOpen(true)}\n    >\n      <Header icon=\"dropbox\" content=\"Connect to Dropbox\" />\n      <Modal.Content>\n        <p>\n          This app connects with Dropbox using OAuth 2.0 authorization with PKCE\n          flow. Your will exchange your data directly with Dropbox, so we can't\n          touch it. (So we also can't help you if you lose it)\n        </p>\n        <p>\n          As Dropbox will also tell you, this app will only have read/write\n          access to the Apps/AmCAT_Annotator folder in your dropbox. So even if\n          you don't trust us we're quite harmless.\n        </p>\n      </Modal.Content>\n      <Modal.Actions>\n        <Button primary onClick={startAuthentication}>\n          Authenticate\n        </Button>\n      </Modal.Actions>\n    </Modal>\n  );\n};\n\nexport default DropboxConnect;\n","import React, { useState } from \"react\";\nimport { useSelector } from \"react-redux\";\n\nimport { Modal, Menu, Header, Button } from \"semantic-ui-react\";\nimport { exportDB } from \"dexie-export-import\";\nimport fileDownload from \"js-file-download\";\n\nconst Download = () => {\n  const [open, setOpen] = useState(false);\n  const db = useSelector((state) => state.db);\n\n  const onDownload = async () => {\n    try {\n      console.log(db);\n      const blob = await exportDB(db.idb, {\n        filter: (table, value, key) =>\n          table === \"codingjobs\" || table === \"documents\",\n        prettyJson: true,\n        progressCallback,\n      });\n      fileDownload(blob, \"AmCAT_Annotator.json\");\n    } catch (error) {\n      console.error(\"\" + error);\n    }\n  };\n\n  return (\n    <Modal\n      closeIcon\n      open={open}\n      trigger={\n        <Menu.Item\n          icon=\"download\"\n          name=\"Download\"\n          style={{ color: \"lightgreen\" }}\n        />\n      }\n      onClose={() => setOpen(false)}\n      onOpen={() => setOpen(true)}\n    >\n      <Header icon=\"dropbox\" content=\"Download everything\" />\n      <Modal.Content>\n        <p>Download all data as a single JSON dump</p>\n      </Modal.Content>\n      <Modal.Actions>\n        <Button primary onClick={onDownload}>\n          Download\n        </Button>\n      </Modal.Actions>\n    </Modal>\n  );\n};\n\nfunction progressCallback({ totalRows, completedRows }) {\n  console.log(`Progress: ${completedRows} of ${totalRows} rows completed`);\n}\n\nexport default Download;\n","import React, { useState } from \"react\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport { resetDB } from \"../actions\";\nimport { Menu, Button, Header, Icon, Modal } from \"semantic-ui-react\";\nimport { useHistory } from \"react-router-dom\";\n\nconst Reset = () => {\n  const db = useSelector((state) => state.db);\n  const dispatch = useDispatch();\n  const [open, setOpen] = useState(false);\n  const history = useHistory();\n\n  if (!db) return null;\n\n  return (\n    <Modal\n      closeIcon\n      open={open}\n      trigger={\n        <Menu.Item icon=\"rocket\" name=\"Reset\" style={{ color: \"#d7a3a3\" }} />\n      }\n      onClose={() => setOpen(false)}\n      onOpen={() => setOpen(true)}\n    >\n      <Header icon=\"power off\" content=\"Reset Annotator Database\" />\n      <Modal.Content>\n        <p>\n          This will remove all document and annotation data from your browser.\n          Any annotations that have not been saved/synchronized will be lost.\n          Are you absolutely sure?\n        </p>\n      </Modal.Content>\n      <Modal.Actions>\n        <Button\n          color=\"red\"\n          onClick={() => {\n            setOpen(false);\n          }}\n        >\n          <Icon name=\"remove\" /> No\n        </Button>\n        <Button\n          color=\"green\"\n          onClick={() => {\n            console.log(db);\n            db.deleteDB()\n              .then(() => {\n                dispatch(resetDB());\n                setOpen(false);\n                history.push(\"/\");\n              })\n              .catch((e) => {\n                console.log(e);\n              });\n          }}\n        >\n          <Icon name=\"checkmark\" /> Yes\n        </Button>\n      </Modal.Actions>\n    </Modal>\n  );\n};\n\nexport default Reset;\n","// this contains functions for setting indexedDB to persistent\n// taken from: https://dexie.org/docs/StorageManager\n\n/** Check if storage is persisted already.\n  @returns {Promise<boolean>} Promise resolved with true if current origin is\n  using persistent storage, false if not, and undefined if the API is not\n  present.\n*/\n\nexport async function initStoragePersistence() {\n  const persist = await tryPersistWithoutPromtingUser();\n  switch (persist) {\n    case \"never\":\n      console.log(\"Not possible to persist storage\");\n      break;\n    case \"persisted\":\n      console.log(\"Successfully persisted storage silently\");\n      break;\n    case \"prompt\":\n      console.log(\"Not persisted, but we may prompt user when we want to.\");\n      break;\n    default:\n      console.log(\"compiler desperately wanted a default\");\n  }\n}\n\n/** Tries to convert to persisted storage.\n  @returns {Promise<boolean>} Promise resolved with true if successfully\n  persisted the storage, false if not, and undefined if the API is not present.\n*/\nexport async function persist() {\n  return (await navigator.storage) && navigator.storage.persist\n    ? navigator.storage.persist()\n    : undefined;\n}\n\nexport async function isStoragePersisted() {\n  return (await navigator.storage) && navigator.storage.persisted\n    ? navigator.storage.persisted()\n    : undefined;\n}\n\n/** Queries available disk quota.\n  @see https://developer.mozilla.org/en-US/docs/Web/API/StorageEstimate\n  @returns {Promise<{quota: number, usage: number}>} Promise resolved with\n  {quota: number, usage: number} or undefined.\n*/\n// async function showEstimatedQuota() {\n//   return (await navigator.storage) && navigator.storage.estimate\n//     ? navigator.storage.estimate()\n//     : undefined;\n// }\n\n/** Tries to persist storage without ever prompting user.\n  @returns {Promise<string>}\n    \"never\" In case persisting is not ever possible. Caller don't bother\n      asking user for permission.\n    \"prompt\" In case persisting would be possible if prompting user first.\n    \"persisted\" In case this call successfully silently persisted the storage,\n      or if it was already persisted.\n*/\nasync function tryPersistWithoutPromtingUser() {\n  if (!navigator.storage || !navigator.storage.persisted) {\n    return \"never\";\n  }\n  let persisted = await navigator.storage.persisted();\n  if (persisted) {\n    return \"persisted\";\n  }\n  if (!navigator.permissions || !navigator.permissions.query) {\n    return \"prompt\"; // It MAY be successful to prompt. Don't know.\n  }\n  const permission = await navigator.permissions.query({\n    name: \"persistent-storage\",\n  });\n  if (permission.state === \"granted\") {\n    persisted = await navigator.storage.persist();\n    if (persisted) {\n      return \"persisted\";\n    } else {\n      throw new Error(\"Failed to persist\");\n    }\n  }\n  if (permission.state === \"prompt\") {\n    return \"prompt\";\n  }\n  return \"never\";\n}\n","import React, { useEffect, useState } from \"react\";\nimport { Menu, Button, Header, Icon, Modal } from \"semantic-ui-react\";\nimport { persist, isStoragePersisted } from \"../apis/storemanager\";\n\nconst Persist = () => {\n  const [open, setOpen] = useState(false);\n  const [persisted, setPersisted] = useState(false);\n\n  useEffect(() => {\n    if (!persisted) {\n      isStoragePersisted().then(setPersisted);\n    }\n  }, [persisted]);\n\n  const onClick = async () => {\n    await persist();\n    const ispersisted = await isStoragePersisted();\n    if (ispersisted) {\n      setPersisted(true);\n      alert(\"indexedDB set to persistent for AmCAT Annotator\");\n    } else {\n      alert(\"Failed to set indexedDB to persistent\");\n    }\n  };\n\n  if (persisted) return null;\n\n  return (\n    <Modal\n      closeIcon\n      open={open}\n      trigger={\n        <Menu.Item\n          icon=\"database\"\n          name=\"Enable persitance\"\n          style={{ color: \"#d7a3a3\" }}\n        />\n      }\n      onClose={() => setOpen(false)}\n      onOpen={() => setOpen(true)}\n    >\n      <Header icon=\"database\" content=\"Set database persistence\" />\n      <Modal.Content>\n        <p>\n          We did not have permission to automatically make the data storage for\n          this website persistent. This means that the data could be removed\n          automatically by your browser if it needs to free up space for another\n          website. You can try to set this manually here, but not all browsers\n          support this (yet).\n        </p>\n        <p>\n          If the database is not persistent the app can still be used, but you\n          need to be more carefull in making sure that data is regularly backed\n          up, either by manually downloading data or syncing with Dropbox\n        </p>\n      </Modal.Content>\n      <Modal.Actions>\n        <Button onClick={onClick}>\n          <Icon name=\"checkmark\" /> Yes\n        </Button>\n      </Modal.Actions>\n    </Modal>\n  );\n};\n\nexport default Persist;\n","import React from \"react\";\nimport { useSelector } from \"react-redux\";\nimport { Menu } from \"semantic-ui-react\";\nimport { Link, withRouter, useLocation } from \"react-router-dom\";\nimport Dropbox from \"./Dropbox\";\nimport Download from \"./Download\";\nimport Reset from \"./Reset\";\nimport Persist from \"./Persist\";\n\nconst HeaderMenu = ({ items }) => {\n  const db = useSelector((state) => state.db);\n  const location = useLocation();\n\n  const menuItems = items.map((item, index) => {\n    return (\n      <Menu.Item\n        key={\"item-\" + index}\n        index={index}\n        as={Link}\n        to={item.path}\n        header={index === 0}\n        disabled={!db}\n        active={item.path === location.pathname}\n      >\n        {item.label}\n      </Menu.Item>\n    );\n  });\n\n  return (\n    <Menu fixed=\"top\" inverted>\n      {menuItems}\n      <Menu.Menu position=\"right\">\n        <Dropbox />\n        <Download />\n        <Persist />\n        <Reset />\n      </Menu.Menu>\n    </Menu>\n  );\n};\n\nexport default withRouter(HeaderMenu);\n","import Dexie from \"dexie\";\nimport hash from \"object-hash\";\n\nexport default class AnnotationDB {\n  constructor() {\n    this.idb = new Dexie(\"AmCAT_Annotator\");\n    // this.idb.delete();   // for testing: starts with clean db\n    this.idb.version(1).stores({\n      apis: \"api\", // unindexed fields: token, refresh_token, expiration_date,\n      codingjobs: \"job_id, name\", // unindexed fields: jobcreator, codingscheme, codebook, codebookEdit, returnAddress\n      documents: \"doc_id, job_id\", // unindexed fields: title, text, meta, tokens, annotations\n    });\n  }\n\n  // API TOKENS\n  addToken(api, token) {\n    return this.idb.apis.put({\n      api,\n      token: token.token,\n      refresh_token: token.refresh_token,\n      expiration_date: token.expiration_date,\n    });\n  }\n  deleteToken(api) {\n    return this.idb.apis.delete(api);\n  }\n  getToken(api) {\n    return this.idb.apis.get(api);\n  }\n\n  // CODINGJOBS\n  createCodingjob(name) {\n    const job_id = hash([name, Date.now().toString()]);\n    return this.idb.codingjobs.add({\n      job_id,\n      name,\n    });\n  }\n  async deleteCodingjob(codingjob) {\n    const documents = await this.listDocuments(codingjob);\n    await this.deleteDocuments(documents);\n    return this.idb.codingjobs.delete(codingjob.job_id);\n  }\n  listCodingjobs() {\n    return this.idb.codingjobs.toArray();\n  }\n  getCodingjob(codingjob) {\n    return this.idb.codingjobs.get(\"name\").equals(codingjob);\n  }\n\n  // DOCUMENTS\n  async createDocuments(codingjob, documentList) {\n    let ids = new Set(\n      await this.idb.documents\n        .where(\"job_id\")\n        .equals(codingjob.job_id)\n        .primaryKeys()\n    );\n\n    let duplicates = 0;\n    const preparedDocuments = documentList.reduce((result, document) => {\n      const doc_id = hash([document, codingjob]); // codingjob included for doc_id hash\n      if (!ids.has(doc_id)) {\n        ids.add(doc_id);\n        if (document.annotations && document.annotations.length > 0) {\n          console.log(document.annotations);\n          try {\n            JSON.parse(document.annotations);\n          } catch (e) {\n            alert(\"Annotations field contains invalid JSON\");\n            throw new Error(\"JSON parse error\");\n          }\n        }\n        result.push({\n          doc_id: doc_id,\n          job_id: codingjob.job_id,\n          ...document,\n        });\n      } else {\n        duplicates++;\n      }\n      return result;\n    }, []);\n\n    let message = `Created ${\n      documentList.length - duplicates\n    } new documents in codingjob ${codingjob.name}.`;\n    if (duplicates > 0) message = message + ` Ignored ${duplicates} duplicates`;\n    alert(message);\n\n    return this.idb.documents.bulkAdd(preparedDocuments);\n  }\n  deleteDocuments(documents) {\n    const documentIds = documents.map((document) => document.doc_id);\n    return this.idb.documents.bulkDelete(documentIds);\n  }\n  listDocuments(codingjob) {\n    return this.idb.documents\n      .where(\"job_id\")\n      .equals(codingjob.job_id)\n      .toArray();\n  }\n  getDocument(doc_id) {\n    return this.idb.documents.get(doc_id);\n  }\n\n  writeValue(document, field, value) {\n    return this.idb.documents\n      .where(\"doc_id\")\n      .equals(document.doc_id)\n      .modify({ [field]: value });\n  }\n\n  // CLEANUP\n  deleteDB() {\n    return this.idb.delete();\n  }\n}\n","import React from \"react\";\nimport { useDispatch } from \"react-redux\";\nimport { setDB } from \"../actions\";\nimport Dexie from \"dexie\";\n\nimport AnnotationDB from \"../apis/dexie\";\nimport { useHistory } from \"react-router-dom\";\nimport { Grid, Button, Header, Image, Segment } from \"semantic-ui-react\";\nimport { initStoragePersistence } from \"../apis/storemanager\";\n\nconst Welcome = ({ items }) => {\n  const dispatch = useDispatch();\n  const history = useHistory();\n\n  const loggin = async () => {\n    try {\n      const db = await new AnnotationDB();\n      dispatch(setDB(db));\n      await initStoragePersistence();\n      history.push(items[0].path);\n    } catch (e) {}\n  };\n\n  Dexie.exists(\"AmCAT_Annotator\").then((exists) => {\n    if (exists) loggin();\n  });\n\n  return (\n    <Grid\n      inverted\n      textAlign=\"center\"\n      style={{ height: \"100vh\" }}\n      verticalAlign=\"middle\"\n    >\n      <Grid.Column style={{ maxWidth: 450 }}>\n        <Segment style={{ border: 0 }}>\n          <Header as=\"h2\" textAlign=\"center\">\n            <Image src=\"/amcat-logo.svg\" /> Welcome to the AmCAT annotator\n          </Header>\n          <p>\n            This is the (early development version of the) AmCAT annotator. The\n            fact that you see this message means that you're either here for the\n            first time, or your local annotation database was reset (by you or\n            your browser).\n          </p>\n          <p>\n            The annotator stores your codingjobs and annotations on your local\n            computer in your browser's IndexedDB. Your data will only actually\n            touch the internet when you synchronize your data. Currently we've\n            implemented syncronization with Dropbox. This way we have nothing to\n            do with your data.\n          </p>\n          <Button primary onClick={loggin}>\n            Yes, off course I trust you\n          </Button>\n        </Segment>\n      </Grid.Column>\n    </Grid>\n  );\n};\n\nexport default Welcome;\n","import React from \"react\";\nimport { Route, Redirect } from \"react-router\";\nimport { useDispatch } from \"react-redux\";\nimport { setDB } from \"../actions\";\nimport Dexie from \"dexie\";\n\nimport AnnotationDB from \"../apis/dexie\";\n\nconst AuthRoute = ({ Component, ...componentProps }) => {\n  const dispatch = useDispatch();\n  // the trick for passing on componentProps is basically\n  // redundant now that we use Redux, but leaving it intact just in case\n\n  const loggin = async () => {\n    const db = await new AnnotationDB();\n    dispatch(setDB(db));\n  };\n\n  Dexie.exists(\"AmCAT_Annotator\").then((exists) => {\n    loggin();\n    if (!exists) return <Redirect to=\"/\" />;\n  });\n\n  return (\n    <Route\n      {...componentProps}\n      render={(props) => <Component {...componentProps} {...props} />}\n    />\n  );\n};\n\nexport default AuthRoute;\n","import React, { useEffect, useState } from \"react\";\nimport {\n  useTable,\n  useSortBy,\n  usePagination,\n  useGlobalFilter,\n} from \"react-table\";\nimport {\n  Table,\n  TableHeader,\n  TableBody,\n  TableRow,\n  TableHeaderCell,\n  TableCell,\n  Pagination,\n  Dropdown,\n  Icon,\n} from \"semantic-ui-react\";\n\n// Uses react-table with semantic ui. The columns and data arguments are lists of objects\n// The 'columns' argument specifies column names (Header) and the names of the keys to get from data.\n//\n// const columns = [\n//   { Header: \"ID\", accessor: \"id\", headerClass: \"one wide\" },\n//   { Header: \"Name\", accessor: \"text\", headerClass: \"one wide\" },\n// ]\n//\n// Note that headerClass is custom, and enables setting the header cell class,\n// which is used in semantic ui to specify the width (one wide, ten wide, etc).\n\nconst SelectionTable = ({\n  columns,\n  data,\n  selectedRow,\n  setSelectedRow,\n  defaultSize = 15,\n}) => {\n  const [activeRow, setActiveRow] = useState(\n    selectedRow ? selectedRow.ROW_ID : null\n  );\n  const {\n    getTableProps,\n    getTableBodyProps,\n    headerGroups,\n    prepareRow,\n    page,\n    pageCount,\n    gotoPage,\n    setPageSize,\n    preGlobalFilteredRows,\n    setGlobalFilter,\n    state: { pageIndex, globalFilter },\n  } = useTable(\n    {\n      columns,\n      data,\n      initialState: { pageSize: defaultSize, globalFilter: \"\" },\n    },\n\n    useGlobalFilter,\n    useSortBy,\n    usePagination\n  );\n\n  useEffect(() => {\n    if (selectedRow) {\n      setActiveRow(selectedRow.ROW_ID);\n    } else {\n      setActiveRow(null);\n    }\n  }, [selectedRow]);\n\n  const GlobalFilter = ({\n    preGlobalFilteredRows,\n    globalFilter,\n    setGlobalFilter,\n  }) => {\n    const count = preGlobalFilteredRows && preGlobalFilteredRows.length;\n\n    return (\n      <span>\n        <input\n          value={globalFilter || \"\"}\n          onChange={(e) => {\n            setGlobalFilter(e.target.value || undefined); // Set undefined to remove the filter entirely\n          }}\n          placeholder={`Search ${count} records...`}\n          style={{\n            border: \"0\",\n          }}\n        />\n      </span>\n    );\n  };\n\n  const onRowSelect = (row) => {\n    if (activeRow && activeRow === row.id) {\n      setSelectedRow(null);\n      setActiveRow(null);\n    } else {\n      setSelectedRow({ ...data[row.id], ROW_ID: row.id });\n      setActiveRow(row.id);\n    }\n  };\n\n  const createHeader = (headerGroup) => {\n    return headerGroup.headers.map((column) => {\n      return (\n        <TableHeaderCell\n          className={column.headerClass}\n          {...column.getHeaderProps(column.getSortByToggleProps())}\n        >\n          {column.render(\"Header\")}\n          <span>\n            {column.isSorted ? (column.isSortedDesc ? \" 🔽\" : \" 🔼\") : \"\"}\n          </span>\n        </TableHeaderCell>\n      );\n    });\n  };\n\n  const createBody = (page) => {\n    return page.map((row, i) => {\n      prepareRow(row);\n      return (\n        <TableRow\n          active={activeRow ? activeRow === row.id : false}\n          onClick={() => onRowSelect(row)}\n          {...row.getRowProps()}\n        >\n          {row.cells.map((cell) => {\n            return (\n              <TableCell title={cell.value} {...cell.getCellProps()}>\n                {cell.render(\"Cell\")}\n              </TableCell>\n            );\n          })}\n        </TableRow>\n      );\n    });\n  };\n\n  if (data.length === 0) return null;\n\n  return (\n    <>\n      <GlobalFilter\n        preGlobalFilteredRows={preGlobalFilteredRows}\n        globalFilter={globalFilter}\n        setGlobalFilter={setGlobalFilter}\n      />\n      <Table striped fixed singleLine selectable {...getTableProps()}>\n        <TableHeader>\n          {headerGroups.map((headerGroup) => (\n            <TableRow {...headerGroup.getHeaderGroupProps()}>\n              {createHeader(headerGroup)}\n            </TableRow>\n          ))}\n        </TableHeader>\n        <TableBody {...getTableBodyProps()}>{createBody(page)}</TableBody>\n      </Table>\n      <Dropdown\n        text=\"show per page\"\n        options={[10, 25, 50, 100, 500].map((n) => ({ value: n, text: n }))}\n        onChange={(e, d) => {\n          setPageSize(d.value);\n        }}\n      />\n      <div\n        style={{\n          marginTop: \"3em\",\n          display: \"flex\",\n          justifyContent: \"flex-end\",\n        }}\n      >\n        <Pagination\n          style={{ border: \"0\" }}\n          size=\"mini\"\n          firstItem={false}\n          lastItem={false}\n          nextItem={false}\n          prevItem={false}\n          boundaryRange={1}\n          ellipsisItem={{\n            content: <Icon name=\"ellipsis horizontal\" />,\n            icon: true,\n          }}\n          activePage={pageIndex + 1}\n          totalPages={pageCount}\n          onPageChange={(event, data) => {\n            gotoPage(data.activePage - 1);\n          }}\n        />\n      </div>\n    </>\n  );\n};\n\nexport default SelectionTable;\n","import React, { useState } from \"react\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport { selectCodingjob, setCodingjobs } from \"../actions\";\nimport {\n  Header,\n  Button,\n  Modal,\n  Form,\n  Loader,\n  Dimmer,\n  Icon,\n} from \"semantic-ui-react\";\n\nconst CreateCodingjob = () => {\n  const db = useSelector((state) => state.db);\n  const codingjobs = useSelector((state) => state.codingjobs);\n  const dispatch = useDispatch();\n\n  const [status, setStatus] = useState(\"inactive\");\n  const [codingjobName, setCodingjobName] = useState(\"\");\n\n  const onSubmit = (event) => {\n    event.preventDefault();\n\n    setCodingjobName(codingjobName.trim());\n    setStatus(\"pending\");\n\n    db.createCodingjob(codingjobName)\n      .then((res) => {\n        // maybe check for 201 before celebrating\n\n        if (db) {\n          db.listCodingjobs().then((res) => {\n            dispatch(selectCodingjob(null));\n            dispatch(setCodingjobs(res));\n          });\n        }\n\n        setStatus(\"inactive\");\n      })\n      .catch((e) => {\n        console.log(e);\n        setStatus(\"error\");\n      });\n  };\n\n  if (!codingjobs) return null;\n\n  return (\n    <Modal\n      as={Form}\n      trigger={\n        <Button>\n          <Icon name=\"plus\" />\n          Create job\n        </Button>\n      }\n      onSubmit={(e) => onSubmit(e)}\n      open={status !== \"inactive\"}\n      onClose={() => setStatus(\"inactive\")}\n      onOpen={() => {\n        setCodingjobName(\"\");\n        setStatus(\"awaiting input\");\n      }}\n      size=\"tiny\"\n    >\n      <Header icon=\"pencil\" content=\"Create new Codingjob\" as=\"h2\" />\n      <Modal.Content>\n        <Form.Group>\n          <Form.Input\n            width={12}\n            label=\"Name\"\n            required\n            type=\"text\"\n            value={codingjobName}\n            onChange={(e, d) => {\n              setStatus(\"awaiting input\");\n              setCodingjobName(d.value);\n            }}\n            placeholder=\"Enter name\"\n          />\n        </Form.Group>\n      </Modal.Content>\n      <Modal.Actions>\n        {status === \"error\" ? (\n          <div>\n            Could not create codingjob for a reason not yet covered in the error\n            handling...\n          </div>\n        ) : null}\n        {status === \"pending\" ? (\n          <Dimmer active inverted>\n            <Loader content=\"Creating codingjob\" />\n          </Dimmer>\n        ) : (\n          <Button type=\"submit\" color=\"green\" icon=\"save\" content=\"Create\" />\n        )}\n      </Modal.Actions>\n    </Modal>\n  );\n};\n\nexport default CreateCodingjob;\n","import React, { useState } from \"react\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport { selectCodingjob, setCodingjobs } from \"../actions\";\nimport { Button, Header, Icon, Modal, Dimmer, Loader } from \"semantic-ui-react\";\n\nconst DeleteCodingjob = () => {\n  const db = useSelector((state) => state.db);\n  const codingjob = useSelector((state) => state.codingjob);\n  const dispatch = useDispatch();\n\n  const [status, setStatus] = useState(\"inactive\");\n\n  const onSubmit = (event) => {\n    setStatus(\"pending\");\n    db.deleteCodingjob(codingjob)\n      .then((res) => {\n        // maybe check for 201 before celebrating\n\n        if (db) {\n          db.listCodingjobs().then((res) => {\n            dispatch(selectCodingjob(null));\n            dispatch(setCodingjobs(res));\n          });\n        }\n        setStatus(\"inactive\");\n      })\n      .catch((e) => {\n        console.log(e.message);\n        console.log(e);\n        setStatus(\"error\");\n      });\n  };\n\n  if (!codingjob) return null;\n\n  return (\n    <Modal\n      closeIcon\n      open={status !== \"inactive\"}\n      trigger={\n        <Button name=\"logout\">\n          <Icon name=\"minus\" /> Delete job\n        </Button>\n      }\n      onClose={() => {\n        setStatus(\"inactive\");\n      }}\n      onOpen={() => {\n        setStatus(\"awaiting input\");\n      }}\n    >\n      <Header icon=\"trash\" content={`Delete codingjob ${codingjob.name}`} />\n      <Modal.Content>\n        <p>Do you really want to delete this codingjob?</p>\n      </Modal.Content>\n      <Modal.Actions>\n        {status === \"error\" ? (\n          <div>\n            Could not delete codingjob for a reason not yet covered in the error\n            handling...\n          </div>\n        ) : null}\n        {status === \"pending\" ? (\n          <Dimmer active inverted>\n            <Loader content=\"Creating codingjob\" />\n          </Dimmer>\n        ) : (\n          <>\n            <Button color=\"red\" onClick={onSubmit}>\n              <Icon name=\"remove\" /> No\n            </Button>\n            <Button color=\"green\" onClick={onSubmit}>\n              <Icon name=\"checkmark\" /> Yes\n            </Button>\n          </>\n        )}\n      </Modal.Actions>\n    </Modal>\n  );\n};\n\nexport default DeleteCodingjob;\n","import React, { useState, useEffect } from \"react\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport { Button, Segment, Dropdown, Container } from \"semantic-ui-react\";\nimport { selectCodingjob, setCodingjobs, setDocuments } from \"../actions\";\n\nimport SelectionTable from \"./SelectionTable\";\nimport CreateCodingjob from \"./CreateCodingjob\";\nimport DeleteCodingjob from \"./DeleteCodingjob\";\n\nconst CodingjobSelector = ({ type = \"table\" }) => {\n  const db = useSelector((state) => state.db);\n  const codingjobs = useSelector((state) => state.codingjobs);\n  const codingjob = useSelector((state) => state.codingjob);\n  const dispatch = useDispatch();\n\n  const [selectedCodingjob, setSelectedCodingjob] = useState(codingjob);\n\n  useEffect(() => {\n    dispatch(selectCodingjob(selectedCodingjob));\n  }, [codingjob, selectedCodingjob, dispatch]);\n\n  useEffect(() => {\n    if (db && codingjob) {\n      db.listDocuments(codingjob)\n        .then((documents) => {\n          dispatch(setDocuments(documents));\n        })\n        .catch((e) => {\n          console.log(e);\n        });\n    }\n  }, [db, codingjob, dispatch]);\n\n  useEffect(() => {\n    if (db && codingjobs === null) {\n      db.listCodingjobs().then((cjs) => {\n        // add timestamp and sort cjs by timestamp to show most recent\n        dispatch(setCodingjobs(cjs));\n        if (cjs.length > 0) setSelectedCodingjob({ ...cjs[0], ROW_ID: \"0\" });\n      });\n    }\n  }, [db, codingjobs, dispatch]);\n\n  //if (!codingjob) return null;\n\n  if (type === \"table\") {\n    const tableColumns = [\n      {\n        Header: \"Select Index\",\n        accessor: \"name\",\n        headerClass: \"thirteen wide\",\n      },\n    ];\n\n    return (\n      <Segment style={{ border: \"0\" }}>\n        <Button.Group widths=\"2\">\n          <CreateCodingjob />\n          <DeleteCodingjob />\n        </Button.Group>\n\n        <Container style={{ marginTop: \"30px\" }}>\n          <SelectionTable\n            columns={tableColumns}\n            data={codingjobs ? codingjobs : []}\n            selectedRow={selectedCodingjob}\n            setSelectedRow={setSelectedCodingjob}\n            defaultSize={15}\n          />\n        </Container>\n      </Segment>\n    );\n  }\n\n  if (type === \"dropdown\") {\n    const asDropdownItems = (indices) => {\n      return indices.map((index) => {\n        return { key: index.name, text: index.name, value: index.name };\n      });\n    };\n\n    const onDropdownSelect = (value) => {\n      if (value && codingjobs !== null) {\n        const i = codingjobs.findIndex((row) => row.name === value);\n        setSelectedCodingjob({ ...codingjobs[i], ROW_ID: i.toString() });\n      } else {\n        setSelectedCodingjob(null);\n      }\n    };\n\n    return (\n      <Dropdown\n        clearable\n        selection\n        options={asDropdownItems(codingjobs)}\n        value={codingjob ? codingjob.name : null}\n        onChange={(e, d) => onDropdownSelect(d.value)}\n      />\n    );\n  }\n\n  return null;\n};\n\nexport default CodingjobSelector;\n","import React, { useState, useEffect } from \"react\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport SelectionTable from \"./SelectionTable\";\nimport { selectDocument } from \"../actions\";\n\nconst documentTableColumns = [\n  { Header: \"title\", accessor: \"title\", headerClass: \"six wide\" },\n  { Header: \"text\", accessor: \"text\", headerClass: \"four wide\" },\n  { Header: \"annotations\", accessor: \"annotations\", headerClass: \"four wide\" },\n  { Header: \"meta\", accessor: \"meta\", headerClass: \"four wide\" },\n];\n\nconst DocumentTable = () => {\n  const codingjob = useSelector((state) => state.codingjob);\n  const document = useSelector((state) => state.document);\n  const documents = useSelector((state) => state.documents);\n  const dispatch = useDispatch();\n\n  const [selectedRow, setSelectedRow] = useState(document);\n\n  useEffect(() => {\n    dispatch(selectDocument(selectedRow));\n  }, [selectedRow, dispatch]);\n\n  if (!codingjob) return null;\n\n  return (\n    <SelectionTable\n      columns={documentTableColumns}\n      data={documents}\n      selectedRow={selectedRow}\n      setSelectedRow={setSelectedRow}\n      defaultSize={15}\n    />\n  );\n};\n\nexport default DocumentTable;\n","import React from \"react\";\nimport { Container } from \"semantic-ui-react\";\nimport DocumentTable from \"./DocumentTable\";\n\nconst JobDetails = () => {\n  return (\n    <Container style={{ marginTop: \"2em\" }}>\n      <DocumentTable />\n    </Container>\n  );\n};\n\nexport default JobDetails;\n","import React, { useRef, useEffect, useState } from \"react\";\nimport {\n  Container,\n  Header,\n  Table,\n  Grid,\n  Select,\n  Form,\n  Button,\n  Icon,\n} from \"semantic-ui-react\";\nimport { useSelector } from \"react-redux\";\n\n//import CSVReader from \"react-csv-reader\";\n//import Papa from \"papaparse\";\nimport { CSVReader } from \"react-papaparse\";\n\nconst UploadDocuments = ({ setActive }) => {\n  const codingjob = useSelector((state) => state.codingjob);\n  const [data, setData] = useState([]);\n  const fileRef = useRef();\n\n  if (!codingjob) return null;\n  return (\n    <Grid style={{ marginTop: \"4.3em\" }}>\n      <Grid.Row>\n        <Grid.Column floated=\"right\" width={4}>\n          {\" \"}\n          <CSVReader\n            ref={fileRef}\n            onFileLoad={(data) => setData(data)}\n            addRemoveButton\n            onRemoveFile={() => setData([])}\n          >\n            <span>Click to upload</span>\n          </CSVReader>\n        </Grid.Column>\n        <Grid.Column floated=\"right\" width={10}>\n          <SubmitForm data={data} codingjob={codingjob} fileRef={fileRef} />\n        </Grid.Column>\n      </Grid.Row>\n      <Grid.Row>\n        <Grid.Column>\n          <PreviewTable data={data} />\n        </Grid.Column>\n      </Grid.Row>\n    </Grid>\n  );\n};\n\nconst SubmitForm = ({ data, codingjob, fileRef }) => {\n  const db = useSelector((state) => state.db);\n\n  const [options, setOptions] = useState([]);\n  const [titleField, setTitleField] = useState(null);\n  const [textField, setTextField] = useState(null);\n  const [annotationsField, setAnnotationsField] = useState(null);\n\n  useEffect(() => {\n    if (data.length <= 1) {\n      setTitleField(null);\n      setTextField(null);\n      setAnnotationsField(null);\n      setOptions([]);\n      return;\n    }\n\n    setOptions(\n      data[0].data.map((colname) => {\n        return { key: colname, value: colname, text: colname };\n      })\n    );\n    setTitleField(data[0].data.includes(\"title\") ? \"title\" : null);\n    setTextField(data[0].data.includes(\"text\") ? \"text\" : null);\n    setAnnotationsField(\n      data[0].data.includes(\"annotations\") ? \"annotations\" : null\n    );\n  }, [data]);\n\n  const csvToJson = (data, titleField, textField, annotationsField) => {\n    const keys = data[0].data;\n    return data.slice(1).map((row) => {\n      const datarow = row.data.reduce(\n        (obj, value, i) => {\n          let key = keys[i];\n          if (key === titleField) {\n            obj[\"title\"] = value;\n          } else if (key === textField) {\n            obj[\"text\"] = value;\n          } else if (key === annotationsField) {\n            obj[\"annotations\"] = value;\n          } else {\n            obj[\"meta\"][key] = value;\n          }\n          return obj;\n        },\n        { meta: {}, annotations: [] }\n      );\n      datarow.meta = JSON.stringify(datarow.meta, null, 2);\n      console.log(datarow);\n      return datarow;\n    });\n  };\n\n  const uploadData = async () => {\n    try {\n      const preparedData = csvToJson(\n        data,\n        titleField,\n        textField,\n        annotationsField\n      );\n      await db.createDocuments(codingjob, preparedData);\n      fileRef.current.removeFile();\n    } catch (e) {\n      console.log(e);\n    }\n  };\n\n  if (data.length <= 1) return null;\n\n  return (\n    <>\n      <Form>\n        <Form.Group>\n          <Form.Field\n            control={Select}\n            placeholder=\"title column\"\n            options={options}\n            value={titleField}\n            onChange={(e, d) => setTitleField(d.value)}\n          />\n          <Form.Field\n            control={Select}\n            placeholder=\"text column\"\n            options={options}\n            value={textField}\n            onChange={(e, d) => setTextField(d.value)}\n          />\n        </Form.Group>\n        <Form.Group>\n          <Form.Field\n            control={Select}\n            clearable\n            placeholder=\"annotations (optional)\"\n            options={options}\n            value={annotationsField}\n            onChange={(e, d) => setAnnotationsField(d.value)}\n          />\n          <Form.Field\n            control={Button}\n            fluid\n            onClick={uploadData}\n            disabled={!titleField || !textField}\n          >\n            <Icon name=\"upload\" />\n            Upload\n          </Form.Field>\n        </Form.Group>\n      </Form>\n    </>\n  );\n};\n\nconst PreviewTable = ({ data }) => {\n  const n = 5;\n\n  const createHeader = (data) => {\n    return data[0].data.map((colname) => {\n      return (\n        <Table.HeaderCell>\n          <span title={colname}>{colname}</span>\n        </Table.HeaderCell>\n      );\n    });\n  };\n\n  const createRows = (data, n) => {\n    const previewdata = data.slice(0, n + 1);\n    return previewdata.slice(1).map((row) => {\n      return <Table.Row>{createRowCells(row.data)}</Table.Row>;\n    });\n  };\n\n  const createRowCells = (row) => {\n    return row.map((cell) => {\n      return (\n        <Table.Cell>\n          <span title={cell}>{cell}</span>\n        </Table.Cell>\n      );\n    });\n  };\n\n  if (data.length <= 1) return null;\n\n  return (\n    <Container style={{ marginTop: \"2em\" }}>\n      <Table fixed singleLine basic=\"very\">\n        <Table.Header>\n          <Table.Row>{createHeader(data)}</Table.Row>\n        </Table.Header>\n        <Table.Body>{createRows(data, n)}</Table.Body>\n      </Table>\n      {data.length > n ? (\n        <Header align=\"center\">{data.length - 1 - n} more rows</Header>\n      ) : null}\n    </Container>\n  );\n};\n\nexport default UploadDocuments;\n","import React, { useState } from \"react\";\nimport { Form, Button } from \"semantic-ui-react\";\nimport { useSelector } from \"react-redux\";\n\nimport SemanticDatepicker from \"react-semantic-ui-datepickers\";\nimport \"react-semantic-ui-datepickers/dist/react-semantic-ui-datepickers.css\";\n\nconst CreateDocument = () => {\n  const db = useSelector((state) => state.db);\n  const codingjob = useSelector((state) => state.codingjob);\n\n  const [fieldValues, setFieldValues] = useState({});\n\n  const documentFields = {\n    title: \"text\",\n    text: \"text\",\n    annotations: \"text\",\n  };\n\n  const onCreate = () => {\n    let submitData = { ...fieldValues };\n\n    for (const key of Object.keys(submitData)) {\n      if (key === \"date\" || /_date$/.test(key)) {\n        submitData[key] = submitData[key].toISOString();\n      }\n    }\n\n    db.createDocuments(codingjob, [submitData])\n      .then((res) => {\n        // maybe check for 201 before celebrating\n        setFieldValues({});\n      })\n      .catch((e) => {\n        console.log(e);\n      });\n  };\n\n  if (!codingjob) return null;\n\n  return (\n    <Form style={{ marginTop: \"3em\" }}>\n      <DocumentForms\n        fields={documentFields}\n        fieldValues={fieldValues}\n        setFieldValues={setFieldValues}\n      />\n      {!codingjob ? null : (\n        <Button primary onClick={onCreate}>\n          Create document\n        </Button>\n      )}\n    </Form>\n  );\n};\n\nconst DocumentForms = function ({ fields, fieldValues, setFieldValues }) {\n  const onSubmit = (key, value) => {\n    const newFieldValues = { ...fieldValues };\n    newFieldValues[key] = value;\n    setFieldValues(newFieldValues);\n  };\n\n  if (!fields) return null;\n\n  return Object.keys(fields).map((key) => {\n    if (fields[key] === \"text\") {\n      return (\n        <Form.TextArea\n          key={key}\n          value={fieldValues[key] ? fieldValues[key] : \"\"}\n          onChange={(e, d) => onSubmit(key, d.value)}\n          label={key}\n        />\n      );\n    }\n    if (fields[key] === \"date\") {\n      return (\n        <Form.Field>\n          <SemanticDatepicker\n            key={key}\n            label={key}\n            value={fieldValues[key] ? fieldValues[key] : \"\"}\n            onChange={(e, d) => onSubmit(key, d.value)}\n          />\n        </Form.Field>\n      );\n    }\n    if (fields[key] === \"keyword\") {\n      return (\n        <Form.Field key={key}>\n          <label>{key}</label>\n          <input\n            value={fieldValues[key] ? fieldValues[key] : \"\"}\n            onChange={(e) => onSubmit(key, e.target.value)}\n          />\n        </Form.Field>\n      );\n    }\n    return null;\n  });\n};\n\nexport default CreateDocument;\n","import React, { useState } from \"react\";\nimport { Grid, Menu, Segment } from \"semantic-ui-react\";\n\nimport CodingjobSelector from \"./CodingjobSelector\";\nimport JobDetails from \"./JobDetails\";\nimport UploadDocuments from \"./UploadDocuments\";\nimport CreateDocument from \"./CreateDocument\";\n\nconst Create = () => {\n  const [activeItem, setActiveItem] = useState(\"details\");\n\n  const renderSwitch = (activeItem) => {\n    switch (activeItem) {\n      case \"details\":\n        return <JobDetails />;\n      case \"upload\":\n        return <UploadDocuments />;\n      case \"create\":\n        return <CreateDocument />;\n      default:\n        return null;\n    }\n  };\n\n  return (\n    <Grid style={{ marginTop: \"3em\" }}>\n      <Grid.Column floated=\"left\" width={5}>\n        <CodingjobSelector type=\"table\" />\n      </Grid.Column>\n      <Grid.Column width={11}>\n        <Segment style={{ border: 0 }}>\n          <Menu pointing secondary>\n            <Menu.Item\n              name=\"details\"\n              active={activeItem === \"details\"}\n              onClick={(e, d) => setActiveItem(d.name)}\n            />\n            <Menu.Item\n              name=\"upload\"\n              active={activeItem === \"upload\"}\n              onClick={(e, d) => setActiveItem(d.name)}\n            />\n            <Menu.Item\n              name=\"create\"\n              active={activeItem === \"create\"}\n              onClick={(e, d) => setActiveItem(d.name)}\n            />\n          </Menu>\n          {renderSwitch(activeItem)}\n        </Segment>\n      </Grid.Column>\n    </Grid>\n  );\n};\n\nexport default Create;\n","import React, { useEffect, useState } from \"react\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport { toggleAnnotations } from \"../actions\";\n\n// this is a dummy component to listen for changes in annotations and code\n// and saving them to the indexed db.\n\nconst ManageAnnotations = ({ tokens, doc }) => {\n  const db = useSelector((state) => state.db);\n  const annotations = useSelector((state) => state.spanAnnotations);\n  //const codes = useSelector((state) => state.codes);\n  const [ready, setReady] = useState(false);\n  const dispatch = useDispatch();\n\n  useEffect(() => {\n    setReady(false);\n  }, [doc]);\n\n  useEffect(() => {\n    if (tokens && doc.annotations) {\n      matchAnnotations(tokens, doc.annotations, dispatch);\n      setReady(true);\n    }\n  }, [tokens, doc, dispatch]);\n\n  useEffect(() => {\n    if (ready) exportAnnotations(db, doc, annotations);\n  }, [ready, db, doc, annotations]);\n\n  return <div></div>;\n};\n\nconst exportAnnotations = async (db, doc, annotations) => {\n  let unique = new Set();\n  const uniqueAnnotations = Object.values(annotations).reduce((un_ann, ann) => {\n    for (let key of Object.keys(ann)) {\n      const ann_obj = {\n        code: key,\n        offset: ann[key].offset,\n        length: ann[key].length,\n      };\n      const json = JSON.stringify(ann_obj);\n      if (!unique.has(json)) {\n        unique.add(json);\n        un_ann.push(ann_obj);\n      }\n    }\n    return un_ann;\n  }, []);\n  await db.writeValue(\n    { doc_id: doc.doc_id },\n    \"annotations\",\n    JSON.stringify(uniqueAnnotations, null, 2)\n  );\n};\n\nconst matchAnnotations = (tokens, importedAnnotations, dispatch) => {\n  let trackAnnotations = {};\n  let matchedAnnotations = [];\n\n  for (let token of tokens) {\n    findMatches(\n      token,\n      importedAnnotations,\n      trackAnnotations,\n      matchedAnnotations\n    );\n  }\n\n  for (let matchedAnnotation of matchedAnnotations) {\n    addAnnotations(matchedAnnotation, dispatch);\n  }\n};\n\nconst findMatches = (\n  token,\n  importedAnnotations,\n  trackAnnotations,\n  matchedAnnotations\n) => {\n  const start = token.offset.start;\n  const end = token.offset.start + token.offset.length;\n\n  // loop over char offset for token. If a span annotation that\n  // starts on this offset is found, initiate a new annotation in trackAnnotations with this\n  // token index as the start of the span. If a span annotation that ends on\n  // this offset is found, set the token idnex as the end of the span,\n  // store annotation in matchedAnnotations, and remove from trackAnnotations\n  for (let i = start; i <= end; i++) {\n    if (importedAnnotations[i]) {\n      for (let code of importedAnnotations[i].start) {\n        trackAnnotations[code] = {\n          index: token.offset.index,\n          group: code,\n          offset: start,\n          length: null,\n          span: [token.offset.index],\n        };\n      }\n      for (let code of importedAnnotations[i].end) {\n        trackAnnotations[code].span.push(token.offset.index);\n        trackAnnotations[code].length =\n          token.offset.start +\n          token.offset.length -\n          trackAnnotations[code].offset;\n        matchedAnnotations.push(trackAnnotations[code]);\n        delete trackAnnotations[code];\n      }\n    }\n  }\n};\n\nconst addAnnotations = (ann, dispatch) => {\n  let newAnnotations = [];\n  for (let i = ann.span[0]; i <= ann.span[1]; i++) {\n    let newAnnotation = { ...ann };\n    newAnnotation.index = i;\n    newAnnotations.push(newAnnotation);\n  }\n  dispatch(toggleAnnotations(newAnnotations));\n};\n\nexport default ManageAnnotations;\n","import React, { useState, useEffect, useRef } from \"react\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport { Button, Dropdown, Popup, Ref, Step } from \"semantic-ui-react\";\nimport {\n  setCodes,\n  appendCodeHistory,\n  toggleAnnotations,\n  rmAnnotations,\n} from \"../actions\";\nimport randomColor from \"randomcolor\";\n\nconst CodeSelector = ({ index, children }) => {\n  const codes = useSelector((state) => state.codes);\n  const codeHistory = useSelector((state) => state.codeHistory);\n  const spanAnnotations = useSelector((state) => state.spanAnnotations);\n  const textInputRef = useRef(null);\n  const [current, setCurrent] = useState(null);\n\n  // Placeholder: should be managed in state\n  const userAccess = { editable: true };\n  const dispatch = useDispatch();\n\n  useEffect(() => {\n    let annotation = spanAnnotations[index];\n    if (annotation && annotation !== undefined) {\n      if (Object.keys(annotation).includes(\"Not yet assigned\")) {\n        setCurrent(\"Not yet assigned\");\n      } else {\n        setCurrent(Object.keys(annotation)[0]);\n      }\n    }\n  }, [index, spanAnnotations]);\n\n  const toggleListener = (on) => {\n    if (on) {\n      window.addEventListener(\"keydown\", onKeydown);\n    } else {\n      window.removeEventListener(\"keydown\", onKeydown);\n    }\n  };\n  const onKeydown = (event) => {\n    if (textInputRef.current) textInputRef.current.click();\n  };\n\n  const onAddition = (e, d) => {\n    dispatch(\n      setCodes([\n        {\n          key: d.value,\n          text: d.value,\n          value: d.value,\n          color: randomColor({ seed: d.value, luminosity: \"bright\" }),\n        },\n        ...codes,\n      ])\n    );\n  };\n\n  const getColor = (tokenCode, codes) => {\n    const codematch = codes.find((e) => e.value === tokenCode);\n    if (codematch) {\n      return codematch.color;\n    } else {\n      return \"lightgrey\";\n    }\n  };\n\n  const updateAnnotations = (value) => {\n    const key = current;\n\n    let annotation = spanAnnotations[index];\n    if (!annotation) return null;\n\n    let ann = {\n      index: annotation[key].index,\n      group: key,\n      offset: annotation[key].offset,\n      length: annotation[key].length,\n      span: annotation[key].span,\n    };\n\n    // this is a nasty hack. Sort nice solution out later\n    let oldAnnotation = { ...ann };\n    oldAnnotation.span = [oldAnnotation.index, oldAnnotation.index];\n    dispatch(rmAnnotations([oldAnnotation]));\n\n    if (value === key) return null;\n\n    let newAnnotations = [];\n    for (let i = ann.span[0]; i <= ann.span[1]; i++) {\n      let newAnnotation = { ...ann };\n      newAnnotation.group = value;\n      newAnnotation.index = i;\n      newAnnotations.push(newAnnotation);\n    }\n    dispatch(toggleAnnotations(newAnnotations));\n    dispatch(appendCodeHistory(value));\n\n    if (Object.keys(annotation).includes(null)) {\n      setCurrent(null);\n    } else {\n      setCurrent(value);\n    }\n  };\n\n  const newCodeButtons = () => {\n    return codeHistory\n      .filter((e) => e !== current && e !== \"Not yet assigned\")\n      .map((code) => {\n        return (\n          <Button\n            style={{ backgroundColor: getColor(code, codes) }}\n            key={code}\n            value={code}\n            onClick={(e, d) => updateAnnotations(d.value)}\n          >\n            {code}\n          </Button>\n        );\n      });\n  };\n\n  const ddOptions = (value) => {\n    let useValue = value;\n    if (!value || value === \"null\") useValue = \"Not yet assigned\";\n    return { key: useValue, text: useValue, value: useValue };\n  };\n\n  const getCurrentOptions = () => {\n    let annotation = spanAnnotations[index];\n    if (annotation) {\n      return Object.keys(annotation)\n        .filter((e) => e !== current)\n        .map(ddOptions);\n    } else {\n      return [ddOptions(null)];\n    }\n  };\n\n  return (\n    <Popup\n      trigger={children}\n      on=\"hover\"\n      flowing\n      hoverable\n      wide\n      onOpen={() => toggleListener(true)}\n      onClose={() => toggleListener(false)}\n      position=\"top left\"\n    >\n      <div>\n        <Step.Group vertical>\n          <Step active>\n            <Step.Content>\n              <Step.Title>Current code</Step.Title>\n              <Step.Description>\n                <Button.Group>\n                  <Button\n                    icon=\"trash\"\n                    size=\"mini\"\n                    onClick={(e, d) => updateAnnotations(current)}\n                  />\n                  <Button style={{ backgroundColor: getColor(current, codes) }}>\n                    <Dropdown\n                      text={current}\n                      options={getCurrentOptions()}\n                      value={current}\n                      onChange={(e, d) => setCurrent(d.value)}\n                    />\n                  </Button>\n                </Button.Group>\n              </Step.Description>\n            </Step.Content>\n          </Step>\n\n          <Step>\n            <Step.Content>\n              <Step.Title>Set new code</Step.Title>\n              <Step.Description>\n                <Button.Group vertical compact widths=\"1\">\n                  {newCodeButtons()}\n                </Button.Group>\n                &nbsp;&nbsp;\n                <Ref innerRef={textInputRef}>\n                  <Dropdown\n                    compact\n                    options={codes}\n                    placeholder={\n                      userAccess.editable ? \"Search or create \" : \"Search \"\n                    }\n                    widths={1}\n                    search\n                    selection\n                    allowAdditions={userAccess.editable}\n                    additionPosition={\"bottom\"}\n                    onAddItem={onAddition}\n                    selectOnNavigation={false}\n                    minCharacters={0}\n                    autoComplete={\"on\"}\n                    searchInput={{ autoFocus: false }}\n                    onChange={(e, d) => updateAnnotations(d.value)}\n                  />\n                </Ref>\n              </Step.Description>\n            </Step.Content>\n          </Step>\n        </Step.Group>\n      </div>\n    </Popup>\n  );\n};\n\nexport default CodeSelector;\n","import React from \"react\";\nimport { useSelector } from \"react-redux\";\nimport \"./style.css\";\nimport CodeSelector from \"./CodeSelector\";\n\nconst Token = ({ token }) => {\n  return (\n    <span\n      className=\"token\"\n      tokenindex={token.offset.index}\n      tokenoffset={token.offset.start}\n      tokenlength={token.offset.length}\n    >\n      <FancyToken token={token} />\n    </span>\n  );\n};\n\nconst FancyToken = React.memo(({ token }) => {\n  // If we specifically ask for the annotations for the current token within the\n  // useSelector function, rerender is only triggered if this value has changed\n  const annotations = useSelector(\n    (state) => state.spanAnnotations[token.offset.index]\n  );\n  const codes = useSelector((state) => state.codes);\n\n  // This is a trick required to render if at least something within this token's\n  // annotations changed (somehow 'annotations' doesn't trigger this, even though it\n  // does contain all the information)\n  useSelector((state) =>\n    JSON.stringify(state.spanAnnotations[token.offset.index])\n  );\n\n  // if there are no annotation codes, our life is easy\n  if (!annotations) return <>{token.pre + token.text + token.post}</>;\n\n  // create solid colors or color gradients\n  const getColor = (tokenCode, codes) => {\n    const codematch = codes.find((e) => e.value === tokenCode);\n    if (codematch) {\n      return codematch.color;\n    } else {\n      return \"lightgrey\";\n    }\n  };\n  let tokenCodes = Object.keys(annotations);\n  let color = null;\n  if (tokenCodes.length === 1) {\n    color = getColor(tokenCodes[0], codes);\n  } else {\n    let colors = tokenCodes.map((code) => getColor(code, codes));\n    color = `linear-gradient(${colors.join(\", \")})`;\n  }\n\n  // Set specific classes for nice css to show the start/end of codes\n  const allLeft = !Object.values(annotations).some(\n    (code) => code.span[0] !== code.index\n  );\n  const allRight = !Object.values(annotations).some(\n    (code) => code.span[1] !== code.index\n  );\n  const anyLeft = Object.values(annotations).some(\n    (code) => code.span[0] === code.index\n  );\n  const anyRight = Object.values(annotations).some(\n    (code) => code.span[1] === code.index\n  );\n\n  let tokenClass = \"TextCodeBubble\";\n  if (allLeft) tokenClass = tokenClass + \" allLeft\";\n  if (anyLeft & !allLeft) tokenClass = tokenClass + \" anyLeft\";\n  if (allRight) tokenClass = tokenClass + \" allRight\";\n  if (anyRight & !allRight) tokenClass = tokenClass + \" anyRight\";\n\n  return (\n    <>\n      {allLeft ? token.pre : null}\n      <CodeSelector index={token.offset.index}>\n        <span\n          className={tokenClass}\n          style={{\n            background: color,\n          }}\n        >\n          {allLeft && allRight ? token.text : null}\n          {allLeft && !allRight ? token.text + token.post : null}\n          {allRight && !allLeft ? token.pre + token.text : null}\n          {!allLeft && !allRight ? token.pre + token.text + token.post : null}\n        </span>\n      </CodeSelector>\n      {allRight ? token.post : null}\n    </>\n  );\n});\n\nexport default React.memo(Token);\n","import React, { useEffect, useState } from \"react\";\nimport { Container } from \"semantic-ui-react\";\nimport Token from \"./Token\";\n\nimport nlp from \"compromise\";\nimport paragraphs from \"compromise-paragraphs\";\nnlp.extend(paragraphs);\n\nconst Tokens = ({ text, setTokens }) => {\n  // It's imporant that the annotations to not pass by this component\n  // but are loaded into Token from redux. THis prevents rerendering\n  // all the parsing stuff\n  const [tokenComponents, setTokenComponents] = useState(null);\n\n  useEffect(() => {\n    const [paragraphs, tokens] = prepareTokens(text);\n    setTokenComponents(paragraphs);\n    setTokens(tokens);\n  }, [text, setTokens]);\n\n  if (text === null) return null;\n\n  return <Container text>{tokenComponents}</Container>;\n};\n\nconst prepareTokens = (text) => {\n  let tokens = [];\n  const tokenized = nlp.tokenize(text).paragraphs().json({ offset: true });\n  const paragraphs = tokenized.map((par, par_i) => {\n    return createParagraph(par, par_i, tokens);\n  });\n\n  return [paragraphs, tokens];\n};\n\nconst createParagraph = (par, par_i, tokens) => {\n  const mapSentences = (par) => {\n    return par.sentences.map((sent) => {\n      // for some reason there's an other array layer...\n      // I've only found cases where lenght is 1, but I'll map just in case\n      return sent.map((sent2) => {\n        return createSentence(sent2, tokens);\n      });\n    });\n  };\n  return (\n    // uses span behaving like p, because p is not allowed due to nested div (for Label)\n    <span style={{ marginTop: \"1em\", display: \"table\" }} key={par_i}>\n      {par_i === 0 ? <h2>{mapSentences(par)}</h2> : mapSentences(par)}\n    </span>\n  );\n};\n\nconst createSentence = (sent, tokens) => {\n  const mapTokens = (sent) => {\n    return sent.terms.map((token) => {\n      tokens.push(token);\n      return <Token key={token.offset.index} token={token} />;\n    });\n  };\n\n  return (\n    <span className=\"sentence\" key={sent.offset.index}>\n      {mapTokens(sent)}\n    </span>\n  );\n};\n\nexport default React.memo(Tokens);\n","import React, { useEffect, useState } from \"react\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport { clearSpanAnnotations } from \"../actions\";\nimport { toggleAnnotations } from \"../actions\";\nimport ManageAnnotations from \"./ManageAnnotations\";\n\nimport Tokens from \"./Tokens\";\n\nconst AnnotationText = ({ doc }) => {\n  const codeHistory = useSelector((state) => state.codeHistory);\n  const [tokens, setTokens] = useState([]);\n  const dispatch = useDispatch();\n\n  useEffect(() => {\n    dispatch(clearSpanAnnotations());\n  }, [doc, dispatch]);\n\n  // USE THIS LATER TO ENABLE DIRECT CODE SELECTION WITH MOUSE\n  // (showing current code next to line)\n  // useEffect(() => {\n  //   window.addEventListener(\"mousemove\", onMouseMove);\n  //   return () => {\n  //     window.removeEventListener(\"mousemove\", onMouseMove);\n  //   };\n  // });\n\n  // const onMouseMove = (event) => {\n  //   if (event.ctrlKey) {\n  //     console.log(event.pageX);\n  //   }\n  // };\n\n  useEffect(() => {\n    window.addEventListener(\"keydown\", onKeyDown);\n    return () => {\n      window.removeEventListener(\"keydown\", onKeyDown);\n    };\n  });\n\n  useEffect(() => {\n    window.addEventListener(\"mouseup\", onMouseUp);\n    return () => {\n      window.removeEventListener(\"mouseup\", onMouseUp);\n    };\n  });\n\n  const onKeyDown = (event) => {\n    console.log(event.key); // maybe integrate key navigation\n  };\n\n  const onMouseUp = (event) => {\n    if (event.which !== 1) return null;\n\n    const selection = window.getSelection();\n\n    if (!(selection.anchorNode && selection.focusNode)) return null;\n    let from = getToken(selection.anchorNode.parentElement);\n    let to = getToken(selection.focusNode.parentElement);\n\n    if (!(from && to)) return null;\n    window.getSelection().empty();\n\n    if (from.index > to.index) [from, to] = [to, from];\n\n    let defaultValue = codeHistory[0] ? codeHistory[0] : null;\n    if (!event.ctrlKey) defaultValue = \"Not yet assigned\";\n\n    const annotations = [];\n    for (let i = from.index; i <= to.index; i++) {\n      annotations.push({\n        index: i,\n        group: defaultValue,\n        offset: from.offset,\n        length: to.offset + to.length - from.offset,\n        span: [from.index, to.index],\n      });\n    }\n    dispatch(toggleAnnotations(annotations));\n  };\n\n  if (!doc) return null;\n  return (\n    <>\n      <Tokens text={doc.text} setTokens={setTokens} />\n      <ManageAnnotations tokens={tokens} doc={doc} />\n    </>\n  );\n};\n\nconst getTokenAttributes = (tokenNode) => {\n  return {\n    index: parseInt(tokenNode.getAttribute(\"tokenindex\")),\n    offset: parseInt(tokenNode.getAttribute(\"tokenoffset\")),\n    length: parseInt(tokenNode.getAttribute(\"tokenlength\")),\n  };\n};\n\nconst getToken = (e) => {\n  console.log(e);\n  if (e.className === \"token\") return getTokenAttributes(e);\n  if (e.parentNode) {\n    if (e.parentNode.className === \"token\")\n      return getTokenAttributes(e.parentNode);\n  }\n  return null;\n};\n\nexport default AnnotationText;\n","import React from \"react\";\nimport { BrowserRouter, Route, Switch } from \"react-router-dom\";\nimport HeaderMenu from \"./components/HeaderMenu\";\nimport { Divider, Container } from \"semantic-ui-react\";\n\n// login and authenticated route\nimport Welcome from \"./components/Welcome\";\nimport AuthRoute from \"./components/AuthRoute\";\n\n// Main pages. Use below in items to include in header menu\nimport Create from \"./components/Create\";\nimport Annotate from \"./components/Annotate\";\n\n// Change to add new components to the header\n// The first item will be the opening page after login\nconst items = [\n  { label: \"Create\", path: \"/create\", Component: Create },\n  { label: \"Annotate\", path: \"/annotate\", Component: Annotate },\n];\n\nconst App = () => {\n  const createNavigation = (items) => {\n    return items.map((item) => {\n      return (\n        <AuthRoute\n          key={item.path}\n          path={item.path}\n          Component={item.Component}\n        />\n      );\n    });\n  };\n\n  return (\n    <BrowserRouter>\n      <HeaderMenu items={items} />\n      <Divider />\n      <Container style={{ marginTop: \"3em\" }}>\n        <Switch>\n          <Route exact path=\"/\" render={() => <Welcome items={items} />} />\n          {createNavigation(items)}\n        </Switch>\n      </Container>\n    </BrowserRouter>\n  );\n};\n\nexport default App;\n","import React, { useEffect, useState } from \"react\";\nimport { useSelector } from \"react-redux\";\nimport { Dropdown, Grid } from \"semantic-ui-react\";\nimport CodingjobSelector from \"./CodingjobSelector\";\nimport AnnotationText from \"./AnnotationText\";\nimport CodeSelector from \"./CodeSelector\";\n\nconst Annotate = () => {\n  const db = useSelector((state) => state.db);\n  const codingjob = useSelector((state) => state.codingjob);\n  const [doc, setDoc] = useState(null);\n  const [documentList, setDocumentList] = useState([]);\n\n  useEffect(() => {\n    if (db && codingjob) {\n      db.listDocuments(codingjob)\n        .then((res) => {\n          setDocumentList(res);\n        })\n        .catch((e) => {\n          console.log(e);\n        });\n    }\n  }, [db, codingjob]);\n\n  const prepareAnnotations = (annotations) => {\n    if (!annotations) return {};\n    const anns = JSON.parse(annotations);\n\n    // create an object where the key is an offset, and the\n    // value is an array that tells which codes start and end there\n    // used in Tokens for matching to token indices\n    // (matching to tokenindices is needed for speed, to keep coding nice and responsive)\n    return anns.reduce((obj, ann) => {\n      if (!obj[ann.offset]) obj[ann.offset] = { start: [], end: [] };\n      if (!obj[ann.offset + ann.length])\n        obj[ann.offset + ann.length] = { start: [], end: [] };\n      obj[ann.offset].start.push(ann.code);\n      obj[ann.offset + ann.length].end.push(ann.code);\n      return obj;\n    }, {});\n  };\n\n  const dropdownOptions = (documentList) => {\n    const items = documentList.map((document, i) => {\n      return {\n        key: i,\n        text: document.title,\n        value: document.doc_id,\n      };\n    });\n    return items;\n  };\n\n  const getDocument = async (doc_id) => {\n    const document = await db.getDocument(doc_id);\n    setDoc({\n      doc_id: document.doc_id,\n      text: document.title + \"\\n\\n\" + document.text,\n      annotations: prepareAnnotations(document.annotations),\n    });\n  };\n\n  return (\n    <>\n      <Grid>\n        <Grid.Row>\n          <CodingjobSelector type=\"dropdown\" />\n          <Dropdown\n            selection\n            onChange={(e, d) => {\n              getDocument(d.value);\n            }}\n            options={dropdownOptions(documentList)}\n          />\n        </Grid.Row>\n        <Grid.Row>\n          <Grid.Column width={12}>\n            <AnnotationText doc={doc ? doc : null} />\n          </Grid.Column>\n          <Grid.Column width={4}>\n            <CodeSelector />\n          </Grid.Column>\n        </Grid.Row>\n      </Grid>\n    </>\n  );\n};\n\nexport default Annotate;\n","import { combineReducers } from \"redux\";\n\nconst db = (state = null, action) => {\n  switch (action.type) {\n    case \"SET_DB\":\n      return action.payload;\n    case \"RESET_DB\":\n      return null;\n    default:\n      return state;\n  }\n};\n\nconst dropbox = (state = null, action) => {\n  switch (action.type) {\n    case \"SET_DROPBOX\":\n      console.log(\"set dropbox\");\n      return action.payload;\n    case \"RESET_DB\":\n      return null;\n    default:\n      return state;\n  }\n};\n\nconst codingjob = (state = null, action) => {\n  switch (action.type) {\n    case \"SELECT_CODINGJOB\":\n      return action.payload;\n    case \"RESET_DB\":\n      return null;\n    default:\n      return state;\n  }\n};\n\nconst codingjobs = (state = null, action) => {\n  switch (action.type) {\n    case \"SET_CODINGJOBS\":\n      return action.payload;\n    case \"RESET_DB\":\n      return null;\n    default:\n      return state;\n  }\n};\n\nconst documents = (state = [], action) => {\n  switch (action.type) {\n    case \"SET_DOCUMENTS\":\n      return action.payload;\n    case \"RESET_DB\":\n      return [];\n    default:\n      return state;\n  }\n};\n\nconst document = (state = [], action) => {\n  switch (action.type) {\n    case \"SELECT_DOCUMENT\":\n      return action.payload;\n    case \"RESET_DB\":\n      return [];\n    default:\n      return state;\n  }\n};\n\nconst tokenIndices = (state = [], action) => {\n  switch (action.type) {\n    case \"SET_TOKEN_INDICES\":\n      return action.payload;\n    case \"RESET_DB\":\n      return null;\n    default:\n      return state;\n  }\n};\n\n// separately store the annotation in a more universal format and\n// a format that is fast to use in the app. Now store universal format in state\n// but in time figure out how to use indexedDb.\n\nconst toggleAnnotations = (annotations, annList, rm) => {\n  for (let key in annList) {\n    let a = annList[key];\n\n    // if group in annotations, remove it\n    if (annotations[a.index]) {\n      if (annotations[a.index][a.group]) {\n        const span = annotations[a.index][a.group].span;\n        for (let i = span[0]; i <= span[1]; i++) {\n          if (annotations[i]) {\n            if (annotations[i][a.group]) {\n              delete annotations[i][a.group];\n              if (Object.keys(annotations[i]).length === 0) {\n                delete annotations[i];\n              }\n            }\n          }\n        }\n        // if selection was one token (which is probably a click),\n        // just remove the annotation. But if it was a multi-token selection,\n        // we do add the new selection\n        if (a.span[0] === a.span[1]) continue;\n      }\n    }\n\n    // if not, add it\n    if (!rm) {\n      if (!annotations[a.index]) annotations[a.index] = {};\n      annotations[a.index][a.group] = {\n        index: a.index,\n        span: [a.span[0], a.span[1]],\n        offset: a.offset,\n        length: a.length,\n      };\n    }\n  }\n\n  return annotations;\n};\n\nconst spanAnnotations = (state = {}, action) => {\n  switch (action.type) {\n    case \"TOGGLE_ANNOTATIONS\":\n      return toggleAnnotations({ ...state }, action.payload, false);\n    case \"RM_ANNOTATIONS\":\n      return toggleAnnotations({ ...state }, action.payload);\n    case \"CLEAR_SPAN_ANNOTATIONS\":\n      return {};\n    case \"RESET_DB\":\n      return {};\n    default:\n      return state;\n  }\n};\n\nconst testCodes = [\n  {\n    key: \"Mark Rutte\",\n    text: \"Mark Rutte\",\n    value: \"Mark Rutte\",\n    color: \"#40a31f\",\n  },\n  {\n    key: \"Sigrid Kaag\",\n    text: \"Sigrid Kaag\",\n    value: \"Sigrid Kaag\",\n    color: \"#f2db5c\",\n  },\n];\n\nconst codes = (state = testCodes, action) => {\n  switch (action.type) {\n    case \"SET_CODES\":\n      return action.payload;\n    case \"RESET_DB\":\n      return [];\n    default:\n      return state;\n  }\n};\n\nconst codeHistory = (state = [], action) => {\n  switch (action.type) {\n    case \"APPEND_CODE_HISTORY\":\n      let newstate = state\n        .filter((v) => v !== action.payload.code)\n        .slice(0, action.payload.n - 1);\n      newstate.unshift(action.payload.code);\n      return newstate;\n    case \"RESET_DB\":\n      return [];\n    default:\n      return state;\n  }\n};\n\nconst rootReducer = combineReducers({\n  db,\n  dropbox,\n  codingjob,\n  codingjobs,\n  document,\n  documents,\n  tokenIndices,\n  spanAnnotations,\n  codes,\n  codeHistory,\n});\n\nexport default rootReducer;\n","import \"semantic-ui-css/semantic.min.css\";\nimport React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport App from \"./App\";\nimport { createStore } from \"redux\";\nimport rootReducer from \"./reducers\";\nimport { Provider } from \"react-redux\";\n\nconst store = createStore(rootReducer);\n\nReactDOM.render(\n  <React.StrictMode>\n    <Provider store={store}>\n      <App />\n    </Provider>\n  </React.StrictMode>,\n  document.querySelector(\"#root\")\n);\n"],"sourceRoot":""}