(this.webpackJsonpCCS_annotator=this.webpackJsonpCCS_annotator||[]).push([[0],{577:function(e,t){},591:function(e,t,n){},592:function(e,t,n){"use strict";n.r(t);n(427);var a=n(0),r=n.n(a),i=n(89),c=n.n(i),o=n(33),s=n(141),l=n(324),u=n(651),d=n(12),j=n(10),b=n(9),h=n.n(b),f=n(653),p=n(649),O=n(122),x=n(53),v=n(8),g=n(82),m=n(20),y=n(38),k=n(32),w=n(201),C=n(107),S=n.n(C),_=n(29),A=n.n(_),q=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"TEMP",a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],r=new Set(t),i=0,c={},o=e.reduce((function(e,t){if(null==t.document_id)return e;var a=S()([t,n,new Date]);if(r.has(a))i++;else{r.add(a);var o=Object(_.prepareDocument)(t,c);if(0===o.tokens.length)return e;e.push(Object(v.a)({doc_uid:a,job_id:n},o))}return e}),[]);if(!a){var s="Created ".concat(o.length," new documents.");i>0&&(s+=" Ignored ".concat(i," duplicates")),alert(s)}return[o,c]},I="CSSannotator_V2",F={codingjobs:"++id, name",documents:"doc_uid, job_id",unitsets:"++id, name",codebooks:"++id, name",deployedJobs:"++id, [host+job_id], title, created",localJobs:"++id, title, last_modified, id",localAnnotations:"[id+unit_id], id"},T=function(){function e(){Object(y.a)(this,e),this.idb=new w.default(I);try{this.idb.version(2).stores(F)}catch(t){this.idb.delete(),this.idb=new w.default(I),this.idb.version(2).stores(F)}}return Object(k.a)(e,[{key:"getTableBatch",value:function(){var e=Object(d.a)(h.a.mark((function e(t,n,a,r){var i,c,o,s=arguments;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=s.length>4&&void 0!==s[4]&&s[4],!(null!==n&&n<0)){e.next=3;break}return e.abrupt("return",null);case 3:return e.next=5,this.idb.table(t);case 5:return c=e.sent,e.next=8,c.count();case 8:if(o=e.sent,i&&(c=c.reverse()),!(null!==n&&n>o-1)){e.next=12;break}return e.abrupt("return",null);case 12:return null!==a&&(c=c.offset(n).limit(a)),e.next=15,D(c,r);case 15:return e.abrupt("return",e.sent);case 16:case"end":return e.stop()}}),e,this)})));return function(t,n,a,r){return e.apply(this,arguments)}}()},{key:"getTableFromIds",value:function(){var e=Object(d.a)(h.a.mark((function e(t,n,a){var r,i,c=arguments;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=c.length>3&&void 0!==c[3]&&c[3],0!==n.length){e.next=3;break}return e.abrupt("return",[]);case 3:return i=this.idb.table(t).where("id").anyOf(n),r&&(i=i.reverse()),e.next=7,D(i,a);case 7:return e.abrupt("return",e.sent);case 8:case"end":return e.stop()}}),e,this)})));return function(t,n,a){return e.apply(this,arguments)}}()},{key:"getTableN",value:function(){var e=Object(d.a)(h.a.mark((function e(t){var n;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log(t),e.next=3,this.idb.table(t);case 3:return n=e.sent,e.abrupt("return",n.count());case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"deleteTableIds",value:function(){var e=Object(d.a)(h.a.mark((function e(t,n){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==n.length){e.next=2;break}return e.abrupt("return",[]);case 2:return e.next=4,this.idb.table(t).where("id").anyOf(n).delete();case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"textSearch",value:function(){var e=Object(d.a)(h.a.mark((function e(t,n,a,r,i){var c,o,s,l;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c=null,""!==a&&(c=new RegExp(a.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&"))),e.next=4,this.idb.table(t);case 4:if(o=e.sent,s=[],null!=i){e.next=12;break}return e.next=9,o.toCollection();case 9:e.t0=e.sent,e.next=15;break;case 12:return e.next=14,o.where(r).anyOf(i);case 14:e.t0=e.sent;case 15:return l=e.t0,e.next=18,l.each((function(e){var t,a=Object(m.a)(n);try{for(a.s();!(t=a.n()).done;){var r=t.value;if(null===c)return void s.push(e.id);if(c.test(e[r]))return void s.push(e.id)}}catch(i){a.e(i)}finally{a.f()}}));case 18:return e.abrupt("return",s);case 19:case"end":return e.stop()}}),e,this)})));return function(t,n,a,r,i){return e.apply(this,arguments)}}()},{key:"getCodingjobProp",value:function(){var e=Object(d.a)(h.a.mark((function e(t,n){var a,r;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a="object"===typeof t?t.id:t,e.next=3,this.idb.codingjobs.get(a);case 3:return r=e.sent,e.abrupt("return",r[n]);case 5:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"setCodingjobProp",value:function(){var e=Object(d.a)(h.a.mark((function e(t,n,a){var r,i;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r="object"===typeof t?t.id:t,e.next=3,this.idb.codingjobs.get(r);case 3:return null==(i=e.sent).settings&&(i.settings={}),e.abrupt("return",this.idb.codingjobs.where("id").equals(r).modify(Object(g.a)({},n,a)));case 6:case"end":return e.stop()}}),e,this)})));return function(t,n,a){return e.apply(this,arguments)}}()},{key:"createDocuments",value:function(){var e=Object(d.a)(h.a.mark((function e(t,n){var a,r,i,c,o,s,l,u,d=arguments;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=d.length>2&&void 0!==d[2]&&d[2],r="object"===typeof t?t.id:t,e.t0=Set,e.next=5,this.idb.documents.where("job_id").equals(r).primaryKeys();case 5:return e.t1=e.sent,i=new e.t0(e.t1),c=q(n,i,r,a),o=Object(j.a)(c,2),s=o[0],l=o[1],e.next=10,this.getCodingjobProp(t,"importedCodes");case 10:return u=e.sent,u=U(t,u,l),this.idb.codingjobs.where("id").equals(r).modify({importedCodes:u}),e.abrupt("return",this.idb.documents.bulkAdd(s));case 14:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"deleteDocuments",value:function(){var e=Object(d.a)(h.a.mark((function e(t){var n;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.map((function(e){return e.doc_uid})),e.abrupt("return",this.idb.documents.bulkDelete(n));case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getJobDocuments",value:function(){var e=Object(d.a)(h.a.mark((function e(t,n,a){var r,i,c;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r="object"===typeof t?t.id:t,!(null!==n&&n<0)){e.next=3;break}return e.abrupt("return",null);case 3:return e.next=5,this.idb.documents.where("job_id").equals(r);case 5:return i=e.sent,e.next=8,i.count();case 8:if(c=e.sent,!(null!==n&&n>c-1)){e.next=11;break}return e.abrupt("return",null);case 11:return null!==a&&(i=i.offset(n).limit(a)),e.abrupt("return",i.toArray());case 13:case"end":return e.stop()}}),e,this)})));return function(t,n,a){return e.apply(this,arguments)}}()},{key:"getJobDocumentCount",value:function(){var e=Object(d.a)(h.a.mark((function e(t){var n;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n="object"===typeof t?t.id:t,e.abrupt("return",this.idb.documents.where("job_id").equals(n).count());case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getDocuments",value:function(){var e=Object(d.a)(h.a.mark((function e(t){var n;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n="object"===typeof t?t.id:t,e.abrupt("return",this.idb.documents.where("job_id").equals(n));case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getDocument",value:function(){var e=Object(d.a)(h.a.mark((function e(t){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.idb.documents.get(t));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"createDeployedJob",value:function(){var e=Object(d.a)(h.a.mark((function e(t,n,a){var r;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.idb.deployedJobs.get({host:n,job_id:a});case 2:r=e.sent,console.log("test"),r?this.idb.deployedJobs.get({host:n,job_id:a}).modify({created:new Date}):this.idb.deployedJobs.add({host:n,job_id:a,title:t,created:new Date});case 5:case"end":return e.stop()}}),e,this)})));return function(t,n,a){return e.apply(this,arguments)}}()},{key:"createLocalJob",value:function(){var e=Object(d.a)(h.a.mark((function e(t,n){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.idb.localJobs.get({id:n});case 2:e.sent?alert("This job has already been created before"):this.idb.localJobs.add(Object(v.a)(Object(v.a)({},t),{},{id:n,last_modified:new Date}));case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getUnitAnnotations",value:function(){var e=Object(d.a)(h.a.mark((function e(t,n){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.idb.localAnnotations.get({id:t,unit_id:n}));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getAllAnnotations",value:function(){var e=Object(d.a)(h.a.mark((function e(t){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.idb.localAnnotations.where("id").equals(t).toArray());case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"postAnnotations",value:function(){var e=Object(d.a)(h.a.mark((function e(t,n,a,r){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.idb.localAnnotations.put({unit_id:n,id:t,annotations:a,status:r},[t,n]));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n,a,r){return e.apply(this,arguments)}}()},{key:"deleteDB",value:function(){var e=Object(d.a)(h.a.mark((function e(){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.idb.delete();case 2:this.idb=new w.default(I),this.idb.version(2).stores(F),window.location.reload(!1);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}(),U=function(e,t,n){var a=Object.keys(n).reduce((function(e,t){var a=Object(_.standardizeCodes)(Array.from(n[t]));return e[t]=a.map((function(e){return Object(v.a)(Object(v.a)({},e),{},{frozen:!0})})),e}),{});if(!t)return a;for(var r=0,i=Object.keys(a);r<i.length;r++){var c=i[r];if(t[c]){var o,s=Object(m.a)(a[c]);try{var l=function(){var e=o.value;t[c].some((function(t){return t.code===e.code}))||t[c].push(e)};for(s.s();!(o=s.n()).done;)l()}catch(u){s.e(u)}finally{s.f()}}else t[c]=a[c]}return t},D=function(){var e=Object(d.a)(h.a.mark((function e(t,n){var a;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=[],e.next=3,t.each((function(e){var t,r={},i=Object(m.a)(n);try{for(i.s();!(t=i.n()).done;){var c=t.value;r[c.name]=c.f?c.f(e):e[c.name]}}catch(o){i.e(o)}finally{i.f()}a.push(r)}));case 3:return e.abrupt("return",a);case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),z=new T,E=n(1),R=function(){var e=Object(a.useState)(!1),t=Object(j.a)(e,2),n=t[0],r=t[1],i=Object(o.f)(),c=function(){var e=Object(d.a)(h.a.mark((function e(){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,z.deleteDB();case 3:r(!1),i.push("/"),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),console.log(e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(){return e.apply(this,arguments)}}();return Object(E.jsxs)(f.a,{closeIcon:!0,open:n,trigger:Object(E.jsx)(l.a.Item,{icon:"rocket",name:"Reset",style:{color:"#d7a3a3"}}),onClose:function(){return r(!1)},onOpen:function(){return r(!0)},children:[Object(E.jsx)(p.a,{icon:"power off",content:"Reset Annotator Database"}),Object(E.jsx)(f.a.Content,{children:Object(E.jsx)("p",{children:"This will remove all documents and annotations from your browser. Anything that hasn't been exported will be lost. Are you absolutely sure?"})}),Object(E.jsxs)(f.a.Actions,{children:[Object(E.jsxs)(O.a,{color:"red",onClick:function(){r(!1)},children:[Object(E.jsx)(x.a,{name:"remove"})," No"]}),Object(E.jsxs)(O.a,{color:"green",onClick:c,children:[Object(E.jsx)(x.a,{name:"checkmark"})," Yes"]})]})]})};function M(){return N.apply(this,arguments)}function N(){return(N=Object(d.a)(h.a.mark((function e(){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,navigator.storage;case 2:if(e.t0=e.sent,!e.t0){e.next=5;break}e.t0=navigator.storage.persist;case 5:if(!e.t0){e.next=9;break}e.t1=navigator.storage.persist(),e.next=10;break;case 9:e.t1=void 0;case 10:return e.abrupt("return",e.t1);case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function L(){return P.apply(this,arguments)}function P(){return(P=Object(d.a)(h.a.mark((function e(){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,navigator.storage;case 2:if(e.t0=e.sent,!e.t0){e.next=5;break}e.t0=navigator.storage.persisted;case 5:if(!e.t0){e.next=9;break}e.t1=navigator.storage.persisted(),e.next=10;break;case 9:e.t1=void 0;case 10:return e.abrupt("return",e.t1);case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var B=function(){var e=Object(a.useState)(!1),t=Object(j.a)(e,2),n=t[0],r=t[1],i=Object(a.useState)(!1),c=Object(j.a)(i,2),o=c[0],s=c[1];Object(a.useEffect)((function(){o||L().then(s)}),[o]);var u=function(){var e=Object(d.a)(h.a.mark((function e(){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,M();case 2:return e.next=4,L();case 4:e.sent?(s(!0),alert("indexedDB set to persistent for AmCAT Annotator")):alert("Failed to set indexedDB to persistent");case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return o?null:Object(E.jsxs)(f.a,{closeIcon:!0,open:n,trigger:Object(E.jsx)(l.a.Item,{icon:"database",name:"Enable persitance",style:{color:"#d7a3a3"}}),onClose:function(){return r(!1)},onOpen:function(){return r(!0)},children:[Object(E.jsx)(p.a,{icon:"database",content:"Set database persistence"}),Object(E.jsxs)(f.a.Content,{children:[Object(E.jsx)("p",{children:"We did not have permission to automatically make the data storage for this website persistent. This means that the data could be removed automatically by your browser if it needs to free up space for another website. You can try to set this manually here, but not all browsers support this (yet)."}),Object(E.jsx)("p",{children:"If the database is not persistent the app can still be used, but you need to be more carefull in making sure that data is regularly backed up, either by manually downloading data or syncing with some backend (work in progress)."})]}),Object(E.jsx)(f.a.Actions,{children:Object(E.jsxs)(O.a,{onClick:u,children:[Object(E.jsx)(x.a,{name:"checkmark"})," Yes"]})})]})},G=n(652),V=n(403),J=n(325),H=n(645),W=n(648),Y=n(400),Q=function(e){return{type:"BLOCK_EVENTS",block:e}},K=n(56),X=n(285),$=n.n(X);function Z(e,t,n){return ee.apply(this,arguments)}function ee(){return(ee=Object(d.a)(h.a.mark((function e(t,n,a){var r;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,$.a.get("".concat(t,"/token"),{auth:{username:n,password:a}});case 2:return r=e.sent,e.abrupt("return",r.data.token);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function te(e,t){return new ne(e,t)}var ne=function(){function e(t,n){Object(y.a)(this,e),this.host=t,this.token=n,this.api=$.a.create({baseURL:t,headers:{Authorization:"Bearer ".concat(n)}})}return Object(k.a)(e,[{key:"getToken",value:function(){var e=Object(d.a)(h.a.mark((function e(){var t;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.api.get("/token");case 2:return t=e.sent,e.abrupt("return",t.data);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getCodebook",value:function(){var e=Object(d.a)(h.a.mark((function e(t){var n;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.api.get("/codingjob/".concat(t,"/codebook"));case 2:return n=e.sent,e.abrupt("return",n.data);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getProgress",value:function(){var e=Object(d.a)(h.a.mark((function e(t){var n;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("test"),e.next=3,this.api.get("/codingjob/".concat(t,"/progress"));case 3:return n=e.sent,console.log(n),e.abrupt("return",n.data);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getUnit",value:function(){var e=Object(d.a)(h.a.mark((function e(t,n){var a,r;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a="/codingjob/".concat(t,"/unit"),null!==n&&(a+="?index=".concat(n)),e.next=4,this.api.get(a);case 4:return r=e.sent,e.abrupt("return",r.data);case 6:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getCodingjob",value:function(){var e=Object(d.a)(h.a.mark((function e(t){var n;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.api.get("/codingjob/".concat(t));case 2:return n=e.sent,e.abrupt("return",n.data);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"postCodingjob",value:function(e,t){return e.title=t,this.api.post("/codingjob",{title:t,units:e.units,codebook:e.codebook,provenance:e.provenance,rules:e.rules})}},{key:"postAnnotation",value:function(e,t,n,a){var r={annotation:n,status:a};this.api.post("/codingjob/".concat(e,"/unit/").concat(t,"/annotation"),r)}}]),e}(),ae=function(e){var t=e.cookies,n=e.setCookies,a=e.setLoggedIn,r=e.setOpen,i=e.host,c=void 0===i?null:i,o=t.amcat||{host:"http://localhost:5000",email:"test@user.com",token:null};c&&(o.host=c);return o.token?Object(E.jsx)(ie,{amcat:o,setLogout:function(){n("amcat",JSON.stringify(Object(v.a)(Object(v.a)({},o),{},{token:null})),{path:"/"}),a(!1)}}):Object(E.jsx)(ce,{setOpen:r,amcat:o,setLogin:function(e){console.log(e),n("amcat",JSON.stringify(e),{path:"/"}),a(!0),r(!1)}})},re=function(){var e=Object(d.a)(h.a.mark((function e(t,n,a){var r;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=te(null===t||void 0===t?void 0:t.host,null===t||void 0===t?void 0:t.token),e.prev=1,e.next=4,r.getToken();case 4:a(!0),e.next=11;break;case 7:e.prev=7,e.t0=e.catch(1),console.log(e.t0),n("amcat",JSON.stringify(Object(v.a)(Object(v.a)({},t),{},{token:null})),{path:"/"});case 11:case"end":return e.stop()}}),e,null,[[1,7]])})));return function(t,n,a){return e.apply(this,arguments)}}(),ie=function(e){var t=e.amcat,n=e.setLogout;return Object(E.jsxs)(E.Fragment,{children:[Object(E.jsx)(p.a,{icon:"user",content:"Sign out"}),Object(E.jsx)(V.a,{textAlign:"center",children:Object(E.jsx)(V.a.Column,{children:Object(E.jsxs)(O.a,{secondary:!0,onClick:n,children:["Sign out from ",Object(E.jsx)("span",{style:{color:"lightblue"},children:t.email})]})})})]})},ce=function(e){var t=e.amcat,n=e.setLogin,r=Object(a.useState)(""),i=Object(j.a)(r,2),c=i[0],o=i[1],s=Object(a.useState)(""),l=Object(j.a)(s,2),u=l[0],b=l[1],f=Object(a.useState)(""),x=Object(j.a)(f,2),v=x[0],g=x[1],m=Object(a.useState)(!1),y=Object(j.a)(m,2),k=y[0],w=y[1],C=function(){var e=Object(d.a)(h.a.mark((function e(){var t;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return g(""),e.prev=1,e.next=4,Z(c,u,v);case 4:t=e.sent,n({host:c,email:u,token:t}),e.next=12;break;case 8:e.prev=8,e.t0=e.catch(1),w(!0),console.log(e.t0);case 12:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(){return e.apply(this,arguments)}}(),S=!u.match(/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/);return Object(a.useEffect)((function(){null!==t&&void 0!==t&&t.email&&b(t.email),null!==t&&void 0!==t&&t.host&&o(t.host)}),[t]),Object(E.jsxs)(E.Fragment,{children:[Object(E.jsx)(p.a,{icon:"user",content:"Register or sign in"}),Object(E.jsxs)(J.a,{placeholder:!0,attached:"bottom",children:[Object(E.jsx)(V.a,{stackable:!0,textAlign:"center",children:Object(E.jsx)(V.a.Row,{children:Object(E.jsx)(V.a.Column,{children:Object(E.jsxs)(H.a,{children:[Object(E.jsx)(H.a.Input,{placeholder:"Host",name:"host",label:"Host",value:c,onChange:function(e,t){t.value.length<100&&o(t.value)},icon:"home",iconPosition:"left",autoFocus:!0}),Object(E.jsx)(H.a.Input,{placeholder:"email adress",error:!!S&&"Please enter a valid email adress",name:"email",label:"Email",icon:"mail",iconPosition:"left",value:u,onChange:function(e,t){t.value.length<100&&b(t.value)}})]})})})}),Object(E.jsx)(W.a,{}),Object(E.jsx)(V.a,{columns:2,textAlign:"center",children:Object(E.jsxs)(V.a.Row,{verticalAlign:"middle",children:[Object(E.jsx)(V.a.Column,{children:Object(E.jsx)(H.a,{children:Object(E.jsx)(O.a,{circular:!0,primary:!0,fluid:!0,style:{width:"7em",height:"7em"},children:"Send link by email"})})}),Object(E.jsx)(W.a,{vertical:!0,children:"Or"}),Object(E.jsx)(V.a.Column,{children:Object(E.jsxs)(H.a,{children:[Object(E.jsx)(H.a.Input,{placeholder:"password",name:"password",error:!!k&&"Invalid password for this host & email",label:"Password",type:"password",icon:"lock",iconPosition:"left",value:v,onChange:function(e,t){w(!1),g(t.value)}}),Object(E.jsx)(O.a,{disabled:0===v.length,primary:!0,fluid:!0,onClick:C,children:"Sign in"})]})})]})})]})]})},oe=function(e){var t=e.host,n=void 0===t?null:t,r=e.force,i=void 0!==r&&r,c=Object(K.b)(),o=Object(a.useState)(!1),s=Object(j.a)(o,2),u=s[0],d=s[1],b=Object(Y.a)(["amcat"]),h=Object(j.a)(b,2),f=h[0],p=h[1],O=Object(a.useState)(!1),x=Object(j.a)(O,2),v=x[0],g=x[1];return console.log(f),Object(a.useEffect)((function(){return c(Q(u)),function(){c(Q(!1))}}),[c,u]),Object(a.useEffect)((function(){var e;v||null!==f&&void 0!==f&&null!==(e=f.amcat)&&void 0!==e&&e.token&&re(f.amcat,p,g)}),[f,v,p,g]),Object(E.jsx)(G.a,{closeIcon:!i,open:u||i,hoverable:!0,flowing:!0,on:"click",mouseLeaveDelay:1e3,trigger:Object(E.jsx)(l.a.Item,{icon:v?"log out":"sign in",name:v?"Sign out":"Sign in",style:{color:"white"}}),onClose:function(){return d(!1)},onOpen:function(){return d(!0)},children:Object(E.jsx)(ae,{cookies:f,setCookies:p,setLoggedIn:g,setOpen:d,host:n})})},se=Object(o.h)((function(e){var t=e.items,n=e.children,a=Object(o.g)(),r=t.map((function(e,t){return e.menu?Object(E.jsx)(l.a.Item,{index:t,as:s.b,to:e.path,header:0===t,active:e.path===a.pathname,children:e.label},"item-"+t):null}));return"/annotator"===a.pathname?n:Object(E.jsxs)(u.a.Pushable,{style:{height:"100vh"},children:[Object(E.jsxs)(u.a,{as:l.a,inverted:!0,animation:"push",visible:!0,direction:"top",size:"mini",children:[r,Object(E.jsxs)(l.a.Menu,{position:"right",children:[Object(E.jsx)(oe,{}),Object(E.jsx)(B,{}),Object(E.jsx)(R,{})]})]}),Object(E.jsx)(u.a.Pusher,{children:n})]})})),le=n(404),ue=n(203),de=n(647),je=n(595),be=n(650),he=n(26),fe=n(646),pe=n(644),Oe=n(600),xe=function(){var e=Object(d.a)(h.a.mark((function e(t,n,a,r,i,c,o,s,l,u){var d,j,b;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(d=null,null!=l){e.next=7;break}return e.next=4,z.getTableN(t);case 4:d=e.sent,e.next=8;break;case 7:d=l.length;case 8:if(a(Math.ceil(d/n)),j=[],b=Object(he.a)(c),!(d>0)){e.next=22;break}if(null!=l){e.next=18;break}return e.next=15,z.getTableBatch(t,0,n,c,u);case 15:j=e.sent,e.next=21;break;case 18:return e.next=20,z.getTableFromIds(t,l.slice(0,10),c,u);case 20:j=e.sent;case 21:o&&ve(b,j);case 22:console.log(j),s(b),r(j),j.length>0&&i(j[0]);case 26:case"end":return e.stop()}}),e)})));return function(t,n,a,r,i,c,o,s,l,u){return e.apply(this,arguments)}}(),ve=function(e,t){var n,a=e.map((function(e){return e.name})),r=Object(m.a)(t);try{for(r.s();!(n=r.n()).done;)for(var i=n.value,c=0,o=Object.keys(i);c<o.length;c++){var s=o[c];a.includes(s)||(a.push(s),e.push({name:s,width:2}))}}catch(l){r.e(l)}finally{r.f()}},ge=r.a.memo((function(e){var t=e.table,n=e.searchOn,r=e.setSearch,i=Object(a.useState)(""),c=Object(j.a)(i,2),o=c[0],s=c[1],l=Object(a.useState)("none"),u=Object(j.a)(l,2),d=u[0],b=u[1];return Object(a.useEffect)((function(){var e=setTimeout((function(){me(t,n,o,r,b)}),500);return function(){return clearTimeout(e)}}),[t,o,b,n,r]),Object(E.jsx)(E.Fragment,{children:Object(E.jsx)(Oe.a,{loading:"searching"===d,value:o,icon:"search",placeholder:n,onChange:function(e,t){return s(t.value)}})})})),me=function(){var e=Object(d.a)(h.a.mark((function e(t,n,a,r,i){var c;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(""!==a){e.next=4;break}return r(null),i("none"),e.abrupt("return");case 4:return i("searching"),e.next=7,z.textSearch(t,[n],a);case 7:c=e.sent,r(c),i("finished");case 10:case"end":return e.stop()}}),e)})));return function(t,n,a,r,i){return e.apply(this,arguments)}}(),ye=function(e){var t=e.table,n=e.columns,r=e.allColumns,i=e.idColumn,c=void 0===i?"id":i,o=e.setSelected,s=e.searchColumn,l=e.reverse,u=Object(ue.useLiveQuery)((function(){return z.idb.table(t).toCollection().keys()})),b=Object(a.useState)([]),f=Object(j.a)(b,2),p=f[0],O=f[1],v=Object(a.useState)(1),g=Object(j.a)(v,2),m=g[0],y=g[1],k=Object(a.useState)(n),w=Object(j.a)(k,2),C=w[0],S=w[1],_=Object(a.useState)(null),A=Object(j.a)(_,2),q=A[0],I=A[1],F=Object(a.useState)(null),T=Object(j.a)(F,2),U=T[0],D=T[1];Object(a.useEffect)((function(){if(!t)return O([]),null;xe(t,10,y,O,D,n,r,S,q,l)}),[t,n,r,q,u,D,l]),Object(a.useEffect)((function(){o&&o(U)}),[U,o]);var R=function(e){return C.map((function(t,n){if(t.hide)return null;var a=e?e[t.name]:null;return a instanceof Date&&(a=a.toISOString().slice(0,19).replace(/T/g," ")),Object(E.jsx)(fe.a.Cell,{children:Object(E.jsx)("span",{title:a,children:a})},n)}))},M=function(){var e=Object(d.a)(h.a.mark((function e(n,a){var r,i;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=10*(a.activePage-1),i=null,null!=q){e.next=8;break}return e.next=5,z.getTableBatch(t,r,10);case 5:i=e.sent,e.next=11;break;case 8:return e.next=10,z.getTableFromIds(t,q.slice(r,r+10));case 10:i=e.sent;case 11:O(i);case 12:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}();return C?Object(E.jsx)(de.a,{style:{overflow:"auto"},children:Object(E.jsxs)(fe.a,{unstackable:!0,selectable:!0,fixed:!0,compact:!0,singleLine:!0,size:"small",style:{fontSize:"10px"},children:[Object(E.jsx)(fe.a.Header,{children:Object(E.jsx)(fe.a.Row,{children:C.map((function(e,n){return e.hide?null:Object(E.jsx)(fe.a.HeaderCell,{width:e.width,children:Object(E.jsx)("span",{title:e.name,children:(a=e.name,a!==s?a:Object(E.jsx)(ge,{table:t,searchOn:a,setSearch:I}))})},n);var a}))})}),Object(E.jsx)(fe.a.Body,{children:function(e){return null===e||0===e.length?null:e.map((function(e,t){var n=e[c]===(null===U||void 0===U?void 0:U[c]);return Object(E.jsx)(fe.a.Row,{style:{height:"3.1em"},active:n,onClick:function(){return D(e)},children:R(e)},t)}))}(p)}),Object(E.jsx)(fe.a.Footer,{children:Object(E.jsx)(fe.a.Row,{children:Object(E.jsx)(fe.a.HeaderCell,{colSpan:n.filter((function(e){return!e.hide})).length,children:m>1?Object(E.jsx)(pe.a,{size:"mini",floated:"right",boundaryRange:1,siblingRange:1,ellipsisItem:{content:Object(E.jsx)(x.a,{name:"ellipsis horizontal"}),icon:!0},firstItem:{content:Object(E.jsx)(x.a,{name:"angle double left"}),icon:!0},lastItem:{content:Object(E.jsx)(x.a,{name:"angle double right"}),icon:!0},prevItem:{content:Object(E.jsx)(x.a,{name:"angle left"}),icon:!0},nextItem:{content:Object(E.jsx)(x.a,{name:"angle right"}),icon:!0},pointing:!0,secondary:!0,defaultActivePage:1,totalPages:m,onPageChange:M}):null})})})]})}):null},ke=function(e){var t=e.table,n=e.itemLabel,r=e.columns,i=e.setSelected,c=e.reverse,o=void 0===c||c,s=e.onCreate,l=e.onDelete,u=Object(a.useState)(null),d=Object(j.a)(u,2),b=d[0],h=d[1];return Object(a.useEffect)((function(){i&&i(b)}),[b,i]),Object(E.jsx)(V.a,{centered:!0,stackable:!0,columns:1,children:Object(E.jsxs)(V.a.Column,{width:6,children:[Object(E.jsxs)(p.a,{textAlign:"center",style:{background:"#1B1C1D",color:"white"},children:["Select ",n]}),Object(E.jsxs)(J.a,{style:{border:"0"},children:[Object(E.jsxs)(O.a.Group,{widths:"2",size:"mini",children:[Object(E.jsx)(we,{setItem:h,table:t,itemLabel:n,onCreate:s}),Object(E.jsx)(Ce,{item:b,setItem:h,table:t,itemLabel:n,onDelete:l})]}),Object(E.jsx)(de.a,{style:{marginTop:"30px",overflow:"auto",width:"800px"},children:Object(E.jsx)(ye,{table:t,columns:r,searchColumn:"name",idColumn:"id",setSelected:h,reverse:o})})]})]})})},we=function(e){var t=e.setItem,n=e.table,r=e.itemLabel,i=e.onCreate,c=Object(a.useState)("inactive"),o=Object(j.a)(c,2),s=o[0],l=o[1],u=Object(a.useState)(""),b=Object(j.a)(u,2),v=b[0],g=b[1],m=function(){var e=Object(d.a)(h.a.mark((function e(a){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a.preventDefault(),g(v.trim()),l("pending");try{z.idb.table(n).add({name:v}).then((function(e){i&&i(e),t({id:e,name:v})})),l("inactive")}catch(r){console.log(r),l("error")}case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(E.jsxs)(f.a,{as:H.a,trigger:Object(E.jsxs)(O.a,{children:[Object(E.jsx)(x.a,{name:"plus"}),"Create ",r]}),onSubmit:function(e){return m(e)},open:"inactive"!==s,onClose:function(){return l("inactive")},onOpen:function(){g(""),l("awaiting input")},size:"tiny",children:[Object(E.jsx)(p.a,{icon:"pencil",content:"Create new Item",as:"h2"}),Object(E.jsx)(f.a.Content,{children:Object(E.jsx)(H.a.Group,{children:Object(E.jsx)(H.a.Input,{width:12,label:"Name",required:!0,type:"text",value:v,onChange:function(e,t){l("awaiting input"),g(t.value)},placeholder:"Enter name"})})}),Object(E.jsxs)(f.a.Actions,{children:["error"===s?Object(E.jsx)("div",{children:"Could not create item for a reason not yet covered in the error handling..."}):null,"pending"===s?Object(E.jsx)(je.a,{active:!0,inverted:!0,children:Object(E.jsx)(be.a,{content:"Creating item"})}):Object(E.jsx)(O.a,{type:"submit",color:"green",icon:"save",content:"Create"})]})]})},Ce=function(e){var t=e.item,n=e.setItem,r=e.table,i=e.itemLabel,c=e.onDelete,o=Object(a.useState)("inactive"),s=Object(j.a)(o,2),l=s[0],u=s[1],b=function(){var e=Object(d.a)(h.a.mark((function e(a){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(u("pending"),e.prev=1,!c){e.next=5;break}return e.next=5,c(t.id);case 5:return e.next=7,z.idb.table(r).where("id").equals(t.id).delete();case 7:n(null),u("inactive"),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),u("error");case 14:case"end":return e.stop()}}),e,null,[[1,11]])})));return function(t){return e.apply(this,arguments)}}();return null!==t&&void 0!==t&&t.id?Object(E.jsxs)(f.a,{closeIcon:!0,open:"inactive"!==l,trigger:Object(E.jsxs)(O.a,{compact:!0,children:[Object(E.jsx)(x.a,{name:"minus"})," Delete ",i]}),onClose:function(){u("inactive")},onOpen:function(){u("awaiting input")},children:[Object(E.jsx)(p.a,{icon:"trash",content:"Delete item ".concat(t.name)}),Object(E.jsx)(f.a.Content,{children:Object(E.jsx)("p",{children:"Do you really want to delete this item?"})}),Object(E.jsxs)(f.a.Actions,{children:["error"===l?Object(E.jsx)("div",{children:"Could not delete item for a reason not yet covered in the error handling..."}):null,"pending"===l?Object(E.jsx)(je.a,{active:!0,inverted:!0,children:Object(E.jsx)(be.a,{content:"Deleting item"})}):Object(E.jsxs)(E.Fragment,{children:[Object(E.jsxs)(O.a,{color:"red",onClick:function(){u("inactive")},children:[Object(E.jsx)(x.a,{name:"remove"})," No"]}),Object(E.jsxs)(O.a,{color:"green",onClick:b,children:[Object(E.jsx)(x.a,{name:"checkmark"})," Yes"]})]})]})]}):null},Se=r.a.memo(ke),_e=[{name:"id",width:4},{name:"name",width:12}],Ae=function(e){var t=e.setSelectedCodingjob,n=function(){var e=Object(d.a)(h.a.mark((function e(t){var n;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,z.idb.documents.where("job_id").equals(t);case 2:return n=e.sent,e.next=5,n.count();case 5:if(!(e.sent>0)){e.next=9;break}return e.next=9,n.delete();case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(E.jsx)(V.a,{centered:!0,stackable:!0,columns:1,children:Object(E.jsx)(V.a.Column,{width:8,children:Object(E.jsx)(Se,{table:"codingjobs",itemLabel:"codingjob",columns:_e,setSelected:t,onDelete:n})})})},qe=r.a.memo(Ae),Ie=n(171),Fe=n(409),Te=function(e){var t=e.codingjob;return Object(E.jsx)(Ee,{codingjob:t,type:"texts",columns:{document_id:{required:!0,multiple:!1,defaults:["doc_id","document_id"]},text_fields:{required:!0,multiple:!0,defaults:["title","headline","body","message","text"]},meta_fields:{required:!1,multiple:!0,defaults:["medium","publisher","date"]}},keepOriginal:!1})},Ue=function(e,t,n,a){return Object(E.jsx)(E.Fragment,{children:Object(E.jsxs)(H.a.Group,{widths:"equal",children:[Ne("document id","document_id",e,t,n,a),Ne("text columns","text_fields",e,t,n,a),Ne("meta columns","meta_fields",e,t,n,a)]})})},De=function(e){var t=e.codingjob;return Object(E.jsx)(Ee,{codingjob:t,type:"tokens",columns:{document_id:{required:!0,multiple:!1,defaults:["doc_id","document_id"]},token:{required:!0,multiple:!1,defaults:["token","text"]},sentence:{required:!1,multiple:!1,defaults:["sentence","sentence_id"]},paragraph:{required:!1,multiple:!1,defaults:["paragraph","paragraph_id"]},offset:{required:!1,int:!0,multiple:!1,defaults:["offset","start"]},end:{required:!1,int:!0,multiple:!1,defaults:["end"]},post:{required:!1,multiple:!1,defaults:["post","space"]},field:{required:!1,multiple:!1,defaults:["field"]},annotations:{required:!1,multiple:!0,defaults:[]}},keepOriginal:!1})},ze=function(e,t,n,a){return Object(E.jsxs)(E.Fragment,{children:[Object(E.jsxs)(H.a.Group,{widths:"equal",children:[Ne("document id","document_id",e,t,n,a),Ne("token","token",e,t,n,a)]}),Object(E.jsxs)(H.a.Group,{widths:"equal",children:[Ne("field","field",e,t,n,a),Ne("paragraph","paragraph",e,t,n,a),Ne("sentence","sentence",e,t,n,a)]}),Object(E.jsxs)(H.a.Group,{widths:"equal",children:[Ne("start / offset","offset",e,t,n,a),Ne("end","end",e,t,n,a),Ne("space / post","post",e,t,n,a)]}),Object(E.jsx)(H.a.Group,{widths:"equal",children:Ne("annotations","annotations",e,t,n,a,!0)})]})},Ee=function(e){var t=e.codingjob,n=e.type,r=void 0===n?"text":n,i=e.columns,c=e.keepOriginal,o=Object(a.useState)([]),s=Object(j.a)(o,2),l=s[0],u=s[1],d=Object(a.useRef)();return Object(E.jsxs)(de.a,{children:[Object(E.jsxs)(V.a,{children:[Object(E.jsx)(V.a.Column,{width:5,children:Object(E.jsx)(Fe.a,{ref:d,nodrag:!0,onFileLoad:function(e){return u(e)},addRemoveButton:!0,onRemoveFile:function(){return u([])},children:Object(E.jsx)("span",{children:"Click to upload"})})}),Object(E.jsx)(V.a.Column,{floated:"right",width:11,children:Object(E.jsx)(Re,{type:r,data:l,codingjob:t,fileRef:d,columns:i,keepOriginal:c})})]}),Object(E.jsx)(Le,{data:l})]})},Re=function(e){var t=e.type,n=e.data,r=e.codingjob,i=e.fileRef,c=e.columns,o=e.keepOriginal,s=Object(a.useState)([]),l=Object(j.a)(s,2),u=l[0],b=l[1],f=Object(a.useState)({}),p=Object(j.a)(f,2),g=p[0],y=p[1],k=Object(a.useState)(!1),w=Object(j.a)(k,2),C=w[0],S=w[1];Object(a.useEffect)((function(){if(n.length<=1)return y({}),void b([]);b(n[0].data.map((function(e){return{key:e,value:e,text:e}})));for(var e={},t=0,a=Object.keys(c);t<a.length;t++){var r=a[t];e[r]=c[r].multiple?[]:null;var i,o=Object(m.a)(c[r].defaults);try{for(o.s();!(i=o.n()).done;){var s=i.value;n[0].data.includes(s)&&(c[r].multiple?e[r].push(s):e[r]=s)}}catch(l){o.e(l)}finally{o.f()}}y(e)}),[n,c]);var _=function(e,t){for(var n=e[0].data,a=Object(v.a)({},t),r=function(){var e=s[i];if(c[e].multiple){a[e]={};var r,o=Object(m.a)(t[e]);try{var l=function(){var t=r.value;a[e][t]=n.findIndex((function(e){return e===t}))};for(o.s();!(r=o.n()).done;)l()}catch(u){o.e(u)}finally{o.f()}}else a[e]=n.findIndex((function(n){return n===t[e]}))},i=0,s=Object.keys(t);i<s.length;i++)r();return e.slice(1).map((function(e){var r={};if(o){var i=n.map((function(t,n){return{name:t,value:e.data[n]}}));r.original=i}for(var s=0,l=Object.keys(t);s<l.length;s++){var u=l[s];if(c[u].multiple){r[u]=[];var d,j=Object(m.a)(t[u]);try{for(j.s();!(d=j.n()).done;){var b=d.value,h=a[u][b];if(!(h<0)){var f=e.data[h];c[u].int&&(f=parseInt(f)),r[u].push({name:n[h],value:f})}}}catch(x){j.e(x)}finally{j.f()}}else{var p=a[u];if(p<0)continue;var O=e.data[p];r[u]=c[u].int?parseInt(O):O}}return r}))},A=function(){var e=Object(d.a)(h.a.mark((function e(){var a;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,S(!0),a=_(n,g),"tokens"===t&&(a=Me(a)),e.next=6,z.createDocuments(r,a);case 6:return e.next=8,z.setCodingjobProp(r,"codebook.unitSettings.n",null);case 8:i.current.removeFile(),S(!1),e.next=16;break;case 12:e.prev=12,e.t0=e.catch(0),console.log(e.t0),S(!1);case 16:case"end":return e.stop()}}),e,null,[[0,12]])})));return function(){return e.apply(this,arguments)}}();return Object(E.jsx)(E.Fragment,{children:Object(E.jsxs)(H.a,{loading:C,children:["texts"===t?Ue(c,u,g,y):null,"tokens"===t?ze(c,u,g,y):null,Object(E.jsx)(H.a.Group,{children:Object(E.jsxs)(H.a.Field,{control:O.a,onClick:A,disabled:!function(){for(var e=0,t=Object.keys(c);e<t.length;e++){var n=t[e];if(c[n].multiple){if(c[n].required&&0===g[n].length)return!1}else if(c[n].required&&!g[n])return!1}return!0}(),children:[Object(E.jsx)(x.a,{name:"upload"}),"Upload"]})})]})})},Me=function(e){for(var t=[],n=[e[0]],a=1;a<e.length;a++)e[a].document_id!==e[a-1].document_id&&(t.push({document_id:e[a-1].document_id,tokens:n}),n=[]),n.push(e[a]);return t},Ne=function(e,t,n,a,r,i){return Object(E.jsx)(H.a.Field,{control:Ie.a,clearable:!0,selection:!0,multiple:!!n[t].multiple,label:{children:e,style:{fontSize:"10px"}},required:n[t].required,options:a,value:r[t],onChange:function(e,n){var a=Object(v.a)({},r);a[t]=n.value,i(a)},style:{minWidth:"3em",fontSize:"10px"}})},Le=function(e){var t=e.data,n=function(e){return e.map((function(e){return Object(E.jsx)(fe.a.Cell,{children:Object(E.jsx)("span",{title:e,children:e})})}))};return t.length<=1?null:Object(E.jsxs)("div",{style:{marginTop:"3em",overflow:"auto",width:"100%",border:"solid 1px"},children:[Object(E.jsxs)(fe.a,{unstackable:!0,singleLine:!0,fixed:!0,size:"small",compact:!0,children:[Object(E.jsx)(fe.a.Header,{children:Object(E.jsx)(fe.a.Row,{children:function(e){return e[0].data.map((function(e){return Object(E.jsx)(fe.a.HeaderCell,{style:{width:"7em"},children:Object(E.jsx)("span",{title:e,children:e})})}))}(t)})}),Object(E.jsx)(fe.a.Body,{children:function(e,t){return e.slice(0,t+1).slice(1).map((function(e){return Object(E.jsx)(fe.a.Row,{children:n(e.data)})}))}(t,5)})]}),t.length>5?Object(E.jsxs)(p.a,{align:"center",children:[t.length-1-5," more rows"]}):null]})},Pe=function(e){var t=e.codingjob,n=Object(a.useState)("Documents CSV"),r=Object(j.a)(n,2),i=r[0],c=r[1];return Object(E.jsxs)(E.Fragment,{children:[Object(E.jsxs)(l.a,{attached:"top",tabular:!0,children:[Object(E.jsx)(l.a.Item,{name:"Documents CSV",active:"Documents CSV"===i,onClick:function(e,t){return c(t.name)}}),Object(E.jsx)(l.a.Item,{name:"Tokens CSV",active:"Tokens CSV"===i,onClick:function(e,t){return c(t.name)}})]}),Object(E.jsx)(J.a,{attached:"bottom",children:function(e){switch(e){case"Documents CSV":return Object(E.jsx)(Te,{codingjob:t});case"Tokens CSV":return Object(E.jsx)(De,{codingjob:t});default:return null}}(i)})]})},Be=function(e){var t=e.data,n=e.columns,a=e.pages,r=e.pageChange,i=function(e){return n.map((function(t,n){var a=e[t.name];return Object(E.jsx)(fe.a.Cell,{children:Object(E.jsx)("span",{title:a,children:a})},n)}))};return t.length<1?null:Object(E.jsx)(de.a,{children:Object(E.jsxs)(fe.a,{unstackable:!0,selectable:!0,fixed:!0,compact:!0,singleLine:!0,size:"small",style:{fontSize:"10px"},children:[Object(E.jsx)(fe.a.Header,{children:Object(E.jsx)(fe.a.Row,{children:function(e,t){return t.map((function(e,t){return Object(E.jsx)(fe.a.HeaderCell,{width:e.width||null,children:Object(E.jsx)("span",{title:e.name,children:e.name})},t)}))}(0,n)})}),Object(E.jsx)(fe.a.Body,{children:function(e){return e.map((function(e,t){return Object(E.jsx)(fe.a.Row,{children:i(e)},t)}))}(t)}),Object(E.jsx)(fe.a.Footer,{children:Object(E.jsx)(fe.a.Row,{children:Object(E.jsx)(fe.a.HeaderCell,{colSpan:n.length,children:a>1?Object(E.jsx)(pe.a,{size:"mini",floated:"right",boundaryRange:1,siblingRange:1,ellipsisItem:{content:Object(E.jsx)(x.a,{name:"ellipsis horizontal"}),icon:!0},firstItem:{content:Object(E.jsx)(x.a,{name:"angle double left"}),icon:!0},lastItem:{content:Object(E.jsx)(x.a,{name:"angle double right"}),icon:!0},prevItem:{content:Object(E.jsx)(x.a,{name:"angle left"}),icon:!0},nextItem:{content:Object(E.jsx)(x.a,{name:"angle right"}),icon:!0},pointing:!0,secondary:!0,defaultActivePage:1,totalPages:a,onPageChange:function(e,t){return r(t.activePage)}}):null})})})]})})},Ge=function(e,t){return e.map((function(e){return t.reduce((function(t,n){var a,r,i=e[n.name];return"document_id"===n.name?i=e.document_id:(e.text_fields&&(i=e.text_fields.find((function(e){return e.name===n.name})))&&(i=i.value),i||e.text_fields||!e.tokens||(a=e.tokens,r=n.name,i=a.reduce((function(e,t){return t.field===r&&(e=e+t.pre+t.token+t.post),e}),""))),t[n.name]=i,t}),{})}))},Ve=function(){var e=Object(d.a)(h.a.mark((function e(t,n,a,r,i){var c,o,s;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,z.getJobDocumentCount(t);case 2:if(c=e.sent,a(Math.ceil(c/n)),o=[],!(c>0)){e.next=9;break}return e.next=8,z.getJobDocuments(t,0,n);case 8:o=e.sent;case 9:s=Je(o),console.log(Ge(o,s)),r(Ge(o,s)),i(s);case 13:case"end":return e.stop()}}),e)})));return function(t,n,a,r,i){return e.apply(this,arguments)}}(),Je=function(e){var t=[];return e.length>0&&(t=e.reduce((function(e,t){if(t.text_fields){var n,a=Object(m.a)(t.text_fields);try{for(a.s();!(n=a.n()).done;){var r=n.value;e.add(r.name)}}catch(c){a.e(c)}finally{a.f()}}else for(var i=0;i<t.tokens.length;i++)e.add(t.tokens[i].field);return e}),new Set)),["document_id"].concat(Object(he.a)(t)).map((function(e){return{name:e}}))},He=function(e){var t=e.codingjob,n=Object(a.useState)([]),r=Object(j.a)(n,2),i=r[0],c=r[1],o=Object(a.useState)(1),s=Object(j.a)(o,2),l=s[0],u=s[1],b=Object(a.useState)([]),f=Object(j.a)(b,2),p=f[0],O=f[1],x=function(){var e=Object(d.a)(h.a.mark((function e(n){var a,r,i;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=10*(n-1),e.next=3,z.getJobDocuments(t,a,10);case 3:r=e.sent,i=Je(r),c(Ge(r,i)),O(i);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(a.useEffect)((function(){if(!t)return c([]),O([]),null;Ve(t,10,u,c,O)}),[t]),Object(E.jsx)(Be,{data:i,pages:l,columns:p,pageChange:x})},We=function(e){var t=e.codingjob;return Object(E.jsx)("div",{style:{paddingLeft:"1em"},children:Object(E.jsxs)(V.a,{stackable:!0,columns:2,children:[Object(E.jsxs)(V.a.Column,{width:8,children:[Object(E.jsx)(p.a,{textAlign:"center",style:{background:"#1B1C1D",color:"white"},children:"Upload Documents"}),Object(E.jsx)(Pe,{codingjob:t})]}),Object(E.jsxs)(V.a.Column,{width:8,children:[Object(E.jsx)(p.a,{textAlign:"center",style:{background:"#1B1C1D",color:"white"},children:"Document list"}),Object(E.jsx)(He,{codingjob:t})]})]})})},Ye=r.a.memo(We),Qe=n(413),Ke={textUnit:"document",unitSelection:"allTextUnits",annotation:null,contextUnit:"document",contextWindow:[1,1],n:null,totalUnits:null,seed:42,ordered:!1,balanceDocuments:!1,balanceAnnotations:!0,validCodes:{},highlightAnnotation:!1,annotationMix:0,onlyUnused:!0,layout:{text:{},meta:{}}},Xe=function(e){var t=e.codingjob,n=null===t||void 0===t?void 0:t.unitSettings,a=function(e){z.setCodingjobProp(t,"unitSettings",e)};return null!==t&&void 0!==t&&t.unitSettings||a(Ke),n?Object(E.jsx)("div",{style:{verticalAlign:"top",float:"top",paddingLeft:"1em"},children:Object(E.jsx)(V.a,{style:{paddingTop:"1em"},children:Object(E.jsxs)(V.a.Row,{children:[Object(E.jsx)(V.a.Column,{width:8,children:Object(E.jsx)($e,{codingjob:t,unitSettings:n,setUnitSettings:a})}),Object(E.jsx)(V.a.Column,{width:8,children:Object(E.jsx)(Ze,{unitSettings:n,setUnitSettings:a})})]})})}):null},$e=function(e){var t=e.codingjob,n=e.unitSettings,r=e.setUnitSettings;Object(a.useEffect)((function(){null===(null===n||void 0===n?void 0:n.textUnit)&&r(Object(v.a)(Object(v.a)({},n),{},{textUnit:"document",value:"allTextUnits",n:null,totalUnits:null}))}),[n,r]);var i=function(e,t,a,i){var c=a?"annotations":"allTextUnits",o=n.textUnit===e&&n.unitSelection===c;return Object(E.jsx)(H.a.Field,{children:Object(E.jsx)(Qe.a,{value:e,label:t,checked:o,onChange:function(t,a){return r(Object(v.a)(Object(v.a)({},n),{},{textUnit:e,unitSelection:c,n:null,totalUnits:null}))},style:{marginLeft:i?"1em":"0em"}})})};return Object(E.jsxs)(H.a,{children:[Object(E.jsxs)(H.a.Group,{children:[Object(E.jsx)(x.a,{name:"setting"}),Object(E.jsx)("label",{children:"Coding unit"})]}),Object(E.jsxs)(H.a.Group,{grouped:!0,widths:"equal",children:[i("document","Document",!1),i("paragraph","Paragraph",!1),i("sentence","Sentence",!1),function(){if(!t.importedCodes)return null;if(0===Object.keys(t.importedCodes).length)return null;var e=Object.keys(t.importedCodes).map((function(e){return{key:e,value:e,text:e}}));return null===n.annotation&&r(Object(v.a)(Object(v.a)({},n),{},{annotation:e[0].value})),Object(E.jsxs)("span",{style:{fontWeight:"bold"},children:["Annotation:","   ",Object(E.jsx)(Ie.a,{options:e,value:n.annotation,onChange:function(e,t){return r(Object(v.a)(Object(v.a)({},n),{},{annotation:t.value}))}})]})}(),n.annotation?Object(E.jsxs)(E.Fragment,{children:[i("span","Span annotation",!0,!0),i("document","Span + document",!0,!0),i("paragraph","Span + paragraph",!0,!0),i("sentence","Span + sentence",!0,!0)]}):null]})]})},Ze=function(e){var t=e.unitSettings,n=e.setUnitSettings,a=function(e){n(Object(v.a)(Object(v.a)({},t),{},{contextWindow:e}))},r=function(e,r){return Object(E.jsxs)(H.a.Field,{children:[Object(E.jsx)(Qe.a,{value:e,label:r,disabled:"document"===t.textUnit,checked:t.contextUnit===e,onChange:function(a,r){return n(Object(v.a)(Object(v.a)({},t),{},{contextUnit:e}))}}),"  ","paragraph"!==e&&"sentence"!==e||e!==t.contextUnit?null:Object(E.jsx)(et,{contextUnit:t.contextUnit,contextWindow:t.contextWindow,setContextWindow:a})]})};return Object(E.jsxs)(H.a,{children:[Object(E.jsxs)(H.a.Group,{children:[Object(E.jsx)(x.a,{name:"setting"}),Object(E.jsx)("label",{children:"Context unit"})]}),Object(E.jsxs)(H.a.Group,{grouped:!0,widths:"equal",children:[r("document","Document"),r("paragraph","Paragraph"),r("sentence","Sentence"),r("none","No context")]})]})},et=function(e){var t=e.contextUnit,n=e.contextWindow,a=e.setContextWindow;return"document"===t?null:Object(E.jsx)(G.a,{hoverable:!0,trigger:Object(E.jsx)(O.a,{style:{padding:"0em 0.2em 0em 0.2em",background:"white",border:"1px solid"},children:"".concat(n[0]," - ").concat(n[1])}),children:Object(E.jsxs)(Ie.a.Menu,{children:[Object(E.jsx)(Ie.a.Header,{content:"Set ".concat(t," window")}),Object(E.jsxs)(V.a,{style:{paddingTop:"1em",width:"20em"},children:[Object(E.jsx)(V.a.Column,{width:8,children:Object(E.jsx)(Oe.a,{size:"mini",value:n[0],min:0,type:"number",style:{width:"6em"},label:"before",onChange:function(e,t){return a([Number(t.value),n[1]])}})}),Object(E.jsx)(V.a.Column,{width:5,children:Object(E.jsx)(Oe.a,{size:"mini",value:n[1],min:0,type:"number",labelPosition:"right",style:{width:"6em"},label:"after",onChange:function(e,t){return a([n[0],Number(t.value)])}})})]})]})})},tt=r.a.memo(Xe),nt=n(410),at=n.n(nt),rt=function(e,t,n,a,r){var i=at()(a);null!=t&&null!==t||(t=e.length),!n&&t>e.length&&(t=e.length);var c,o,s=Object(he.a)(Array(e.length).keys());null===r?(c=[s],o=[t]):(c=ct(s,r),c=it(c,c.length,i),o=ot(c,t,i));for(var l=[],u=0;u<c.length;u++)if(n)for(var d=0;d<t;d++)l.push(c[u][Math.floor(i()*c[u].length)]);else{c[u]=it(c[u],o[u]<c[u].length?o[u]:c[u].length,i);var j,b=Object(m.a)(c[u]);try{for(b.s();!(j=b.n()).done;){var h=j.value;l.push(h)}}catch(f){b.e(f)}finally{b.f()}}return(l=it(l,l.length,i)).map((function(t){return e[t]}))},it=function(e,t,n){for(var a,r,i=e.slice(0),c=e.length,o=c-t;c-- >o;)a=i[r=Math.floor((c+1)*n())],i[r]=i[c],i[c]=a;return i.slice(o)},ct=function(e,t){for(var n=[],a={},r=0;r<e.length;r++)null==a[t[r]]&&(a[t[r]]=n.length,n.push([])),n[a[t[r]]].push(e[r]);return n},ot=function(e,t,n){for(var a=new Array(e.length).fill(0),r=new Array(e.length).fill(0),i=t,c=e.length,o=-1;i>0;){var s=++o%e.length;if(1!==r[s]&&(a[s]++,i--,a[s]===e[s].length&&(r[s]=1,c--)),0===c)break}return a},st=function(){var e=Object(d.a)(h.a.mark((function e(t,n){var a,r;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,z.getCodingjobProp(t,"unitSettings");case 2:return a=e.sent,e.next=5,ut(t,a);case 5:if(r=e.sent,n(r),null!==a.totalUnits&&null!==a.n&&!Number.isNaN(a.n)){e.next=10;break}return e.next=10,z.setCodingjobProp(t,"unitSettings",Object(v.a)(Object(v.a)({},a),{},{n:r.units.length,totalUnits:r.units.length}));case 10:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),lt=function(){var e=Object(d.a)(h.a.mark((function e(t,n,a,r){var i,c,o,s,l,u,d,j;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=t.unitSettings.validCodes[t.unitSettings.annotation],c=n.units,o={},i&&"annotations"===t.unitSettings.unitSelection&&i.some((function(e){return!e.valid}))&&(o=i.reduce((function(e,t){return t.valid||(e[t.code]=!0),e}),{}),c=c.filter((function(e){return!o[e.annotationValue]}))),0===(s=c.length-t.unitSettings.totalUnits)){e.next=10;break}return e.next=8,z.setCodingjobProp(t,"unitSettings",Object(v.a)(Object(v.a)({},t.unitSettings),{},{n:Math.max(0,Math.min(c.length,t.unitSettings.n+s)),totalUnits:c.length}));case 8:return 0===c.length&&(a([]),setTimeout((function(){return r("ready")}),50)),e.abrupt("return");case 10:l=c.map((function(e){var a=t.unitSettings.balanceDocuments?e.doc_uid:"";return"annotations"===n.unitSelection&&t.unitSettings.balanceAnnotations&&(a+="_".concat(e.annotationValue)),a})),u=rt(c,t.unitSettings.n,!1,t.unitSettings.seed,l),"annotations"===n.unitSelection&&"span"!==n.textUnit&&t.unitSettings.annotationMix&&(d=Math.ceil(c.length*(t.unitSettings.annotationMix/100)),(j=jt(n.all,t,t.unitSettings,d,o)).length>0&&(u=u.concat(j),u=rt(u,u.length,!1,t.unitSettings.seed,null))),u=pt(u,t.unitSettings),a(u),setTimeout((function(){return r("ready")}),50);case 16:case"end":return e.stop()}}),e)})));return function(t,n,a,r){return e.apply(this,arguments)}}(),ut=function(){var e=Object(d.a)(h.a.mark((function e(t,n){var a,r,i,c,o;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,dt(t,n);case 2:return a=e.sent,r=Object(j.a)(a,2),i=r[0],c=r[1],"allTextUnits"===n.unitSelection&&(o=i),"annotations"===n.unitSelection&&(o=c),e.abrupt("return",{all:i,annotations:c,units:o,unitSelection:n.unitSelection,textUnit:n.textUnit,annotation:n.annotation});case 9:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),dt=function(){var e=Object(d.a)(h.a.mark((function e(t,n){var a,r,i,c,o,s,l;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.textUnit,r=n.unitSelection,e.next=3,z.getDocuments(t);case 3:return i=e.sent,0,c=1/0,o=[],s=[],l=-1,e.next=11,i.each((function(e){l++;var t=[],i="annotations"===r?bt(e.annotations,e.tokens,a,n.annotation):[];if("document"!==a&&"span"!==a||t.push(0),"paragraph"===a)for(var u=e.tokens[e.tokens.length-1].paragraph,d=0;d<=Math.min(c,u);d++)t.push(d);if("sentence"===a)for(var j=e.tokens[e.tokens.length-1].sentence,b=0;b<=Math.min(c,j);b++)t.push(b);for(var h=0,f=t;h<f.length;h++){var p=f[h],O={textUnit:a,unitIndex:p,doc_uid:e.doc_uid,document_id:e.document_id,textFields:ht(e),metaFields:ft(e),docIndex:l,annotationValues:{}};if(i[p]){var x,g=Object(m.a)(i[p]);try{for(g.s();!(x=g.n()).done;){var y=x.value,k=Object(v.a)({},O);k.variables=y.variables,k.span=y.span,k.annotationValue=y.annotationValue,"span"===a&&(O.unitIndex=y.span[0]),o.push(k),O.annotationValues[y.annotationValue]=!0}}catch(w){g.e(w)}finally{g.f()}}"span"!==a&&s.push(O)}}));case 11:return e.abrupt("return",[s,o]);case 12:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),jt=function(e,t,n,a,r){for(var i=n.annotation,c=t.importedCodes[i],o=[],s=0;s<e.length;s++){var l,u=e[s],d=Object(m.a)(c);try{for(d.s();!(l=d.n()).done;){var j=l.value;if(!r[j.code]){var b=j.code;n.onlyUnused&&u.annotationValues[b]||o.push({i:s,variables:Object(g.a)({},i,j.code),stratum:u.stratum+"_".concat(b)})}}}catch(x){d.e(x)}finally{d.f()}}if(0===o.length)return[];o=rt(o,a,!1,n.seed+1,o.map((function(e){return e.stratum})));var h,f=[],p=Object(m.a)(o);try{for(p.s();!(h=p.n()).done;){var O=h.value;f.push(Object(v.a)(Object(v.a)({},e[O.i]),{},{random:!0,variables:O.variables}))}}catch(x){p.e(x)}finally{p.f()}return f},bt=function(e,t,n,a){if(!e)return[];for(var r={},i=0,c=Object.keys(e);i<c.length;i++)for(var o=c[i],s=0,l=Object.keys(e[o]);s<l.length;s++){var u=l[s],d=e[o][u].variable;if(d===a){var j={annotationValue:e[o][u].value,span:e[o][u].span,variables:Object(g.a)({},d,e[o][u].value)};"document"!==n&&"span"!==n||(r[0]||(r[0]=[]),r[0].push(j)),"paragraph"===n&&(r[t[o].paragraph]||(r[t[o].paragraph]=[]),r[t[o].paragraph].push(j)),"sentence"===n&&(r[t[o].sentence]||(r[t[o].sentence]=[]),r[t[o].sentence].push(j))}}return r},ht=function(e){if(e.text_fields)return e.text_fields.map((function(e){return e.name}));if(e.tokens){var t,n=new Set,a=Object(m.a)(e.tokens);try{for(a.s();!(t=a.n()).done;){var r=t.value;n.add(r.field)}}catch(i){a.e(i)}finally{a.f()}return Object(he.a)(n)}return[]},ft=function(e){return e.meta_fields?e.meta_fields.map((function(e){return e.name})):[]},pt=function(e,t){return"annotations"===t.unitSelection&&t.annotationMix>0?e:t.ordered?e.sort((function(e,t){return e.docIndex!==t.docIndex?e.docIndex-t.docIndex:e.unitIndex!==t.unitIndex?e.unitIndex-t.unitIndex:null!=e.annotation&&e.annotation.index!==t?e.annotation.index-t.annotation.index:0})):e},Ot=function(e){var t,n,r,i=Object(a.useState)(null),c=Object(j.a)(i,2),o=c[0],s=c[1],l=Object(a.useState)(null),u=Object(j.a)(l,2),d=u[0],b=u[1],h=Object(a.useState)("ready"),f=Object(j.a)(h,2),p=f[0],O=f[1];return Object(a.useEffect)((function(){var t;O("loading"),null!==e&&void 0!==e&&null!==(t=e.unitSettings)&&void 0!==t&&t.textUnit&&st(e.id,s)}),[null===e||void 0===e||null===(t=e.unitSettings)||void 0===t?void 0:t.textUnit,null===e||void 0===e||null===(n=e.unitSettings)||void 0===n?void 0:n.unitSelection,null===e||void 0===e||null===(r=e.unitSettings)||void 0===r?void 0:r.annotation,e.id,s]),Object(a.useEffect)((function(){if(o&&null!==e&&void 0!==e&&e.importedCodes){O((function(e){return"loading"===e?"loading":"awaiting_input"}));var t=setTimeout((function(){O((function(e){return"loading"===e?null:"loading"})),lt(e,o,b,O)}),100);return function(){return clearTimeout(t)}}}),[o,e,b,O]),e?[d,p]:null},xt=function(e,t,n,a){var r=[];if(0===e.length)return r;var i=[0,e.length-1],c=[0,e.length-1];"span"===t.textUnit&&(i=t.span),"paragraph"!==t.textUnit&&"sentence"!==t.textUnit||(i=vt(e,t.textUnit,t.unitIndex,t.unitIndex)),"paragraph"!==n&&"sentence"!==n||(c=gt(e,i,n,a)),"none"===n&&(c=i);for(var o=0;o<e.length;o++)if(e[o].codingUnit=!0,e[o].index<i[0]&&(e[o].codingUnit=!1),e[o].index>i[1]&&(e[o].codingUnit=!1),!(e[o].index<c[0])){if(e[o].index>c[1])break;r.push(e[o])}return r},vt=function(e,t,n,a){var r=[e[0].index,e[e.length-1].index],i=e.find((function(e){return e[t]===n}));i&&(r[0]=i.index);var c=e.find((function(e){return e[t]===a+1}));return c&&(r[1]=c.index-1),r},gt=function(e,t,n,a){var r=-e[0].index,i=[e[t[0]+r][n],e[t[1]+r][n]];return i[0]=i[0]-a[0],i[1]=i[1]+a[1],vt(e,n,i[0],i[1])},mt=function(){var e=Object(d.a)(h.a.mark((function e(t,n){var a,r,i,c,o,s,l,u,d;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=t.unitSettings,r=a.contextUnit,i=a.contextWindow,c=a.layout,console.log(c),o={},s=[],l=S()(t),u=h.a.mark((function e(t){var a,u,d,j,b,f,p,O,x,g;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=n[t].doc_uid,o[a]){e.next=5;break}return e.next=4,z.getDocument(a);case 4:o[a]=e.sent;case 5:u=xt(o[a].tokens,n[t],r,i),d=u.map((function(e){return e.codingUnit})),j=d.indexOf(!0),b=d.lastIndexOf(!0),f=u[j].offset,p=u[b].offset+u[b].length,O=Object(_.exportSpanAnnotations)(o[a].annotations,o[a].tokens),x=O.filter((function(e){return e.offset>=f&&e.offset<p})),g={document_id:n[t].document_id,provenance:{unit:n[t].textUnit,unit_index:n[t].unitIndex},meta_fields:o[a].meta_fields,importedAnnotations:x,variables:n[t].variables},!1,g.text_fields=yt(u),g.text_fields=g.text_fields.map((function(e){return Object(v.a)(Object(v.a)({},e),c.text[e.name])})),g.text_fields=g.text_fields.filter((function(e){return null==e.visible||e.visible})),g.meta_fields=g.meta_fields.map((function(e){return Object(v.a)(Object(v.a)({},e),c.meta[e.name])})),g.meta_fields=g.meta_fields.filter((function(e){return null==e.visible||e.visible})),g.unit_id=S()({jobhash:l,unit:g,date:Date()}),s.push(g);case 21:case"end":return e.stop()}}),e)})),d=0;case 7:if(!(d<n.length)){e.next=12;break}return e.delegateYield(u(d),"t0",9);case 9:d++,e.next=7;break;case 12:return e.abrupt("return",s);case 13:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),yt=function(e){var t=[];if(0===e.length)return t;var n=null,a=null,r="",i=e[0].field,c={};e[0].offset>0&&(c.offset=e[0].offset);var o,s=!1,l=!1,u=Object(m.a)(e);try{for(u.s();!(o=u.n()).done;){var d=o.value;if(d.field!==i){var j=Object(v.a)({name:i,value:r},c);null!==n&&(j.unit_start=n),null!==a&&(j.unit_end=a),t.push(j),c={},d.offset>0&&(c.offset=d.offset),n=null,a=null,r=""}!s&&d.codingUnit&&(n=d.offset,s=!0),!s||l||d.codingUnit||(a=d.offset-1,l=!0),r=r+d.pre+d.text+d.post,i=d.field}}catch(h){u.e(h)}finally{u.f()}if(r.length>0){var b=Object(v.a)({name:i,value:r},c);null!==n&&(b.unit_start=n),null!==a&&(b.unit_end=a),t.push(b)}return t},kt=n(327),wt=function(e){var t=e.children,n=e.header,a=e.texts,r=e.type;return Object(E.jsxs)(G.a,{wide:!0,trigger:Object(E.jsx)(O.a,{circular:!0,icon:"warn"===r?"exclamation":"question",size:"mini",style:{position:"absolute",transform:"scale(0.7)",marginTop:"-0.6em",marginLeft:"0.2em",paddingLeft:"0.1em",paddingRight:"0.1em",paddingTop:"0.2em",paddingBottom:"0.2em",background:"warn"===r?"orange":"blue",color:"white",border:"1px solid grey"}}),children:[n?Object(E.jsx)("h3",{children:n}):null,a?a.map((function(e,t){return Object(E.jsx)("p",{children:e},t)})):null,t]})},Ct=function(e){var t=e.fullData,n=e.columns,r=Object(a.useState)([]),i=Object(j.a)(r,2),c=i[0],o=i[1],s=Object(a.useState)(1),l=Object(j.a)(s,2),u=l[0],d=l[1];if(Object(a.useEffect)((function(){if(!t)return o([]),null;var e=t.length;d(Math.ceil(e/10));var n=[];e>0&&(n=t.slice(0,10)),o(n)}),[t]),c)return Object(E.jsx)(Be,{data:c,pages:u,columns:n,pageChange:function(e){var n=10*(e-1),a=t.slice(n,n+10);o(a)}})},St=function(e){var t=e.codingjob,n=e.units,a=null===t||void 0===t?void 0:t.unitSettings;return a?Object(E.jsxs)("div",{style:{verticalAlign:"top",float:"top",paddingLeft:"1em"},children:[Object(E.jsx)(_t,{unitSettings:a,setUnitSettings:function(e){z.setCodingjobProp(t,"unitSettings",e)}}),Object(E.jsx)("div",{style:{height:"25px"},children:n?0===(null===a||void 0===a?void 0:a.annotationMix)?null:Object(E.jsxs)(p.a,{children:["Total units = ",n.length]}):null}),Object(E.jsx)("br",{}),Object(E.jsx)(qt,{codingjob:t,units:n})]}):null},_t=r.a.memo((function(e){var t=e.unitSettings,n=e.setUnitSettings,r=Object(a.useState)(null),i=Object(j.a)(r,2),c=i[0],o=i[1],s=Object(a.useState)(100),l=Object(j.a)(s,2),u=l[0],d=l[1],b=t.totalUnits||0;Object(a.useEffect)((function(){var e=.1*Math.round(t.n/b*1e3);d(e!==Math.round(e)?e.toFixed(2):e),o(t)}),[b,t,o]),Object(a.useEffect)((function(){if(c===t)return null;var e=setTimeout((function(){n(c)}),300);return function(){return clearTimeout(e)}}),[c,t,n]);var h=function(e,a){n(Object(v.a)(Object(v.a)({},t),{},Object(g.a)({},e,a)))};return null===c?null:Object(E.jsxs)(H.a,{children:[Object(E.jsxs)(H.a.Group,{children:[Object(E.jsx)(x.a,{name:"setting"}),Object(E.jsxs)("div",{children:[Object(E.jsx)("label",{children:"Sample settings"}),Object(E.jsx)(wt,{header:"Sampling and shuffling",texts:["If % < 100, a random sample will be drawn.","If shuffle is enabled, the order of the units will be randomized. Shuffle cannot be disabled if random annotations are added","Seed initializes the random number generator. Simply put, using the same seed gives the same 'random' results if the data is the same."]})]})]}),Object(E.jsxs)(H.a.Group,{widths:"equal",children:[Object(E.jsx)(H.a.Field,{fluid:!0,min:1,max:b,label:Object(E.jsx)("b",{children:"N"}),size:"mini",control:Oe.a,type:"number",value:c.n,onChange:function(e,t){var n=Number(t.value);d(Math.round(100*n/b)),o((function(e){return Object(v.a)(Object(v.a)({},e),{},{n:n})}))}}),Object(E.jsx)(H.a.Field,{fluid:!0,min:0,step:5,max:100,label:Object(E.jsx)("b",{children:"%"}),size:"mini",control:Oe.a,type:"number",value:u,onChange:function(e,t){var n=Number(t.value),a=Math.ceil(n/100*b);a>=0&&(d(n),o((function(e){return Object(v.a)(Object(v.a)({},e),{},{n:a})})))}})]}),Object(E.jsxs)(H.a.Group,{children:[Object(E.jsxs)(H.a.Field,{width:8,children:[Object(E.jsx)("label",{children:"Shuffle"}),Object(E.jsx)(kt.a,{toggle:!0,size:"mini",checked:!t.ordered||"annotations"===t.unitSelection&&t.annotationMix>0,onChange:function(e,t){h("ordered",!t.checked)}})]}),Object(E.jsxs)(H.a.Field,{width:8,children:[Object(E.jsx)("label",{children:"Seed"}),Object(E.jsx)(Oe.a,{size:"mini",type:"number",min:1,value:c.seed,onChange:function(e,t){o((function(e){return Object(v.a)(Object(v.a)({},e),{},{seed:Number(t.value)})}))}})]})]}),Object(E.jsxs)(H.a.Group,{grouped:!0,widths:"equal",children:[Object(E.jsxs)(H.a.Field,{children:[Object(E.jsx)("b",{children:"Balance"}),Object(E.jsx)(wt,{header:"Balanced sampling",texts:["Balance sampled Units evenly over groups. Uses a simple approach where unique groups are created (documents, codes, or documentsXcodes), and samples are drawn from these groups one by one","For documents: get an equal number of paragraphs, sentences or annotations per document.","For codes: if units are annotations, get an equal number annotations for each unique code."]})]}),Object(E.jsx)(H.a.Field,{children:Object(E.jsx)(kt.a,{size:"mini",label:"documents",checked:t.balanceDocuments,onChange:function(e,t){h("balanceDocuments",t.checked)}})}),Object(E.jsx)(H.a.Field,{children:Object(E.jsx)(kt.a,{disabled:"annotations"!==t.unitSelection,size:"mini",label:"codes",checked:t.balanceAnnotations,onChange:function(e,t){h("balanceAnnotations",t.checked)}})})]}),Object(E.jsxs)(H.a.Group,{children:[Object(E.jsx)(H.a.Field,{width:8,disabled:"span"===t.textUnit||"allTextUnits"===t.unitSelection,min:0,step:10,max:1e3,label:Object(E.jsxs)("b",{children:["Random annotations (%)",Object(E.jsx)(wt,{header:"Create units with random annotations",texts:["Given units based on imported annotations, this feature adds units to the sample in which this annotation does NOT occur.\n                   (This is only possible if units are sentences, paragraphs or documents, because randomly adding spans is a lost cause)","In other words, if imported annotations are 'positives', then this adds 'negatives' to the sample. \n                   This is particularly relevant for validation tasks, and when it cannot be taken for granted that all negatives are true negatives.","The maximum number of random annotations is the number of unique text units times the number of unique codes.",'Randomly added annotations can concidentally coincide with actual annotations. This can be prevented with the "only unused" setting.']})]}),size:"mini",control:Oe.a,type:"number",value:c.annotationMix,onChange:function(e,t){o((function(e){return Object(v.a)(Object(v.a)({},e),{},{annotationMix:Number(t.value)})}))}}),Object(E.jsxs)(H.a.Field,{children:[Object(E.jsx)("label",{children:"Only unused "}),Object(E.jsx)(kt.a,{toggle:!0,disabled:"span"===t.textUnit||"allTextUnits"===t.unitSelection,size:"mini",checked:t.onlyUnused,onChange:function(e,t){h("onlyUnused",t.checked)},style:{paddingTop:"3px"}})]})]})]})})),At=[{name:"USE",width:1},{name:"ONLY",width:2},{name:"code"},{name:"N"},{name:"random"}],qt=function(e){var t,n,i,c=e.codingjob,o=e.units,s=null===c||void 0===c||null===(t=c.unitSettings)||void 0===t?void 0:t.annotation,l=null===c||void 0===c||null===(n=c.unitSettings)||void 0===n?void 0:n.validCodes,u="annotations"===(null===c||void 0===c||null===(i=c.unitSettings)||void 0===i?void 0:i.unitSelection),d=Object(a.useState)([]),b=Object(j.a)(d,2),h=b[0],f=b[1],p=r.a.useCallback((function(e){var t=Object(v.a)(Object(v.a)({},c.unitSettings),{},{validCodes:Object(v.a)(Object(v.a)({},l),{},Object(g.a)({},s,e))});z.setCodingjobProp(c,"unitSettings",t)}),[c,l,s]);if(Object(a.useEffect)((function(){if(l&&s&&u&&l[s])if(o&&0!==o.length){if(o[0].variables){var e=o.reduce((function(e,t){var n=Object.values(t.variables)[0];return e[n]||(e[n]={real:0,random:0}),t.random?e[n].random++:e[n].real++,e}),{});f(l[s].map((function(t){var n,a;return Object(v.a)(Object(v.a)({},t),{},{N:null===(n=e[t.code])||void 0===n?void 0:n.real,random:null===(a=e[t.code])||void 0===a?void 0:a.random})})))}}else f(l[s].map((function(e){return{code:e.code,N:0,random:0}})))}),[l,o,f,s,u]),Object(a.useEffect)((function(){var e;if(!l||!s||!u)return null;if(!l[s]){var t=null===(e=c.importedCodes)||void 0===e?void 0:e[s];t&&p(t.map((function(e){return{code:e.code,valid:!0}})))}}),[c,s,u,p,l]),!l||!s||!u)return null;if(!l[s])return null;var m=h.map((function(e,t){return(e=Object(v.a)({},e)).USE=Object(E.jsx)(kt.a,{checked:e.valid,onClick:function(){h[t].valid=!e.valid,p(Object(he.a)(h))}}),e.ONLY=Object(E.jsx)(O.a,{icon:"hand point right",style:{padding:"0",background:"white"},onClick:function(){p(h.map((function(e,n){return e.valid=n===t,e})))}}),e}));return Object(E.jsxs)(H.a,{children:[Object(E.jsxs)(H.a.Group,{children:[Object(E.jsx)(x.a,{name:"setting"}),Object(E.jsx)("div",{children:Object(E.jsx)("label",{children:"Annotations per code"})})]}),Object(E.jsx)(O.a,{primary:!0,content:"use all",style:{padding:"5px",marginBottom:"5px"},onClick:function(){p(h.map((function(e){return e.valid=!0,e})))}}),Object(E.jsx)(Ct,{fullData:m,columns:At})]})},It=r.a.memo(St),Ft=function(e){var t={label:e.toUpperCase().replaceAll("_"," "),bold:!1,italic:!1,size:1,visible:!0,justify:!0,paragraphs:!0};return["title","headline"].includes(e)&&(t.size=1,t.bold=!0),t},Tt=function(e){var t=e.fields,n=e.unitSettings,a=e.setUnitSettings,r=function(e,t,r,i){var c=Object(v.a)({},n.layout);c[e][t][r]=i,a(Object(v.a)(Object(v.a)({},n),{},{layout:c}))},i=function(e,t,n){return Object(E.jsx)(kt.a,{checked:t[n].visible,onChange:function(){return r(e,n,"visible",!t[n].visible)}})},c=function(e,t,n){return Object(E.jsx)(Oe.a,{size:"mini",value:t[n].label,style:{padding:"0",width:"10em"},onChange:function(t,a){return r(e,n,"label",a.value)}})},o=function(e,t,n){return Object(E.jsx)(kt.a,{checked:t[n].bold,onChange:function(){return r(e,n,"bold",!t[n].bold)}})},s=function(e,t,n){return Object(E.jsx)(kt.a,{checked:t[n].italic,onChange:function(){return r(e,n,"italic",!t[n].italic)}})},l=function(e,t,n){return"text"!==e?null:Object(E.jsx)(kt.a,{checked:t[n].justify,onChange:function(){return r(e,n,"justify",!t[n].justify)}})},u=function(e,t,n){return"text"!==e?null:Object(E.jsx)(kt.a,{checked:t[n].paragraphs,onChange:function(){return r(e,n,"paragraphs",!t[n].paragraphs)}})},d=function(e,t,n){return Object(E.jsx)(Oe.a,{size:"mini",value:Math.round(100*t[n].size),type:"number",label:"%",min:0,max:500,step:10,style:{width:"100%",padding:"0",border:"none"},onChange:function(t,a){var i=Number(a.value);isNaN(i)||r(e,n,"size",Math.round(i)/100)}})},j=function(e,t){var n=Object.keys(t).length;return Object.keys(t).map((function(a,r){return Object(E.jsxs)(fe.a.Row,{children:[0===r?Object(E.jsx)(fe.a.Cell,{rowSpan:n,children:Object(E.jsx)("b",{children:e})},"which".concat(r)):null,Object(E.jsx)(fe.a.Cell,{children:a},"field".concat(r)),Object(E.jsx)(fe.a.Cell,{style:{textAlign:"left"},children:i(e,t,a)},"visible".concat(r)),Object(E.jsx)(fe.a.Cell,{style:{padding:"2px"},children:c(e,t,a)},"label".concat(r)),Object(E.jsx)(fe.a.Cell,{style:{padding:"2px"},children:d(e,t,a)},"size".concat(r)),Object(E.jsx)(fe.a.Cell,{style:{textAlign:"left"},children:o(e,t,a)},"bold".concat(r)),Object(E.jsx)(fe.a.Cell,{style:{textAlign:"left"},children:s(e,t,a)},"italic".concat(r)),Object(E.jsx)(fe.a.Cell,{style:{textAlign:"left"},children:l(e,t,a)},"justify".concat(r)),Object(E.jsx)(fe.a.Cell,{style:{textAlign:"left"},children:u(e,t,a)},"paragraphs".concat(r))]},"header".concat(r))}))};return Object(E.jsxs)(fe.a,{structured:!0,compact:!0,unstackable:!0,singleLine:!0,children:[Object(E.jsx)(fe.a.Header,{children:Object(E.jsxs)(fe.a.Row,{children:[Object(E.jsx)(fe.a.HeaderCell,{width:2},"which"),Object(E.jsx)(fe.a.HeaderCell,{width:3,children:"field"},"field"),Object(E.jsx)(fe.a.HeaderCell,{width:1,children:Object(E.jsx)(x.a,{name:"eye slash"})},"visible"),Object(E.jsx)(fe.a.HeaderCell,{width:3,children:"label"},"label"),Object(E.jsx)(fe.a.HeaderCell,{width:3,children:"text size %"},"size"),Object(E.jsx)(fe.a.HeaderCell,{width:1,children:Object(E.jsx)(x.a,{name:"bold"})},"bold"),Object(E.jsx)(fe.a.HeaderCell,{width:1,children:Object(E.jsx)(x.a,{name:"italic"})},"italic"),Object(E.jsx)(fe.a.HeaderCell,{width:1,children:Object(E.jsx)(x.a,{name:"align justify"})},"justify"),Object(E.jsx)(fe.a.HeaderCell,{width:1,children:Object(E.jsx)(x.a,{name:"paragraph"})},"paragraph")]},"header")}),Object(E.jsxs)(fe.a.Body,{children:[j("meta",t.meta),j("text",t.text)]})]})},Ut=function(e){var t=e.codingjob,n=e.units,r=Object(a.useState)({text:[],meta:[]}),i=Object(j.a)(r,2),c=i[0],o=i[1],s=null===t||void 0===t?void 0:t.unitSettings;return Object(a.useEffect)((function(){if(null!==s&&void 0!==s&&s.layout&&n){var e,t=s.layout,a=Object(m.a)(n);try{for(a.s();!(e=a.n()).done;){var r=e.value;if(console.log(r),r.textFields){var i,c=Object(m.a)(r.textFields);try{for(c.s();!(i=c.n()).done;){var l=i.value;t.text[l]||(t.text[l]=Ft(l))}}catch(b){c.e(b)}finally{c.f()}}if(r.metaFields){var u,d=Object(m.a)(r.metaFields);try{for(d.s();!(u=d.n()).done;){var j=u.value;t.meta[j]||(t.meta[j]=Ft(j))}}catch(b){d.e(b)}finally{d.f()}}}}catch(b){a.e(b)}finally{a.f()}o(t)}}),[n,s]),s?Object(E.jsx)("div",{style:{overflowX:"auto"},children:Object(E.jsx)(Tt,{fields:c,unitSettings:s,setUnitSettings:function(e){z.setCodingjobProp(t,"unitSettings",e)}})}):null},Dt=function(e){var t=e.codingjob,n=Ot(t),a=Object(j.a)(n,2),r=a[0],i=a[1];return t?Object(E.jsx)("div",{children:Object(E.jsxs)(V.a,{stackable:!0,celled:"internally",columns:3,children:[Object(E.jsxs)(V.a.Column,{verticalAlign:"top",stretched:!0,width:5,children:[Object(E.jsx)(p.a,{textAlign:"center",style:{background:"#1B1C1D",color:"white"},children:"Define Coding Units"}),Object(E.jsx)(tt,{codingjob:t}),Object(E.jsx)("br",{})]}),Object(E.jsxs)(V.a.Column,{width:5,children:[Object(E.jsx)(p.a,{textAlign:"center",style:{background:"#1B1C1D",color:"white"},children:"Select Units"}),Object(E.jsx)(It,{codingjob:t,units:r})]}),Object(E.jsxs)(V.a.Column,{width:6,style:{height:"80vh"},children:[Object(E.jsx)(p.a,{textAlign:"center",style:{background:"#1B1C1D",color:"white"},children:"Coding Unit Design"}),Object(E.jsx)("div",{style:{maxHeight:"50%",overflow:"auto"},children:Object(E.jsx)(Ut,{codingjob:t,units:r})}),Object(E.jsxs)("div",{style:{position:"relative",paddingTop:"20px",overflow:"auto"},children:[Object(E.jsx)(p.a,{textAlign:"center",style:{background:"#1B1C1D",color:"white"},children:"Unit preview"}),Object(E.jsxs)(je.a,{inverted:!0,active:"awaiting_input"===i||"loading"===i,children:["Awaiting input",Object(E.jsx)(be.a,{size:"huge",children:"awaiting_input"===i?"Awaiting input":"updating"})]}),Object(E.jsx)(zt,{units:r,codingjob:t,codebook:{}})]})]})]})}):null},zt=function(e){var t,n=e.units,r=e.codingjob,i=e.codebook,c=Object(a.useState)(null),o=Object(j.a)(c,2),s=o[0],l=o[1],u=Object(a.useState)(null),d=Object(j.a)(u,2),b=d[0],h=d[1];Object(a.useEffect)((function(){if(null===n||void 0===n||!n[s])return null;mt(r,[n[s]]).then((function(e){var t=e[0];t.post=function(e){return console.log(e)},h(t)}))}),[n,s,h,r]),console.log(null===b||void 0===b||null===(t=b.text_fields)||void 0===t?void 0:t[0]);return!(null!==n&&void 0!==n&&n.length)>0?null:Object(E.jsxs)(V.a.Column,{width:6,children:[Object(E.jsx)(_.IndexController,{n:null===n||void 0===n?void 0:n.length,index:s,setIndex:l}),b?Object(E.jsxs)(E.Fragment,{children:[Object(E.jsx)(je.a,{inverted:!0,active:null===b,children:Object(E.jsx)(be.a,{})}),Object(E.jsx)(_.Document,{unit:b,codes:null===i||void 0===i?void 0:i.codes,settings:{}})]}):null]})},Et=r.a.memo(Dt),Rt=n(599),Mt=n(128),Nt=function(e){var t=Object(v.a)({type:e.type},e[e.type]);return"annotate"===e.type&&(t.variables=Object(he.a)(t.variables.filter((function(e){return null==e.enabled||!0===e.enabled}))),t.variables=t.variables.map((function(e){var t=Object(v.a)({},e);return t.singleCode&&(t.codes=["true"]),t.codes=Object(_.standardizeCodes)(t.codes),t}))),"questions"===e.type&&(t.questions=t.questions.map((function(e){var t=Object(v.a)({},e);return t.codes=Object(_.standardizeCodes)(t.codes),t}))),t},Lt=function(e,t,n,a){var r,i=n.reduce((function(e,t){return"object"===typeof t?(e[t.code]=1,e[t.parent]=1):e[t]=1,e}),{}),c=[],o=Object(he.a)(n),s={},l=e.split("\n"),u=Object(m.a)(l);try{var d=function(){for(var e=r.value,n=e.search(/\S/),l=e,u=0,d=["color","disabled","folded","irrelevant"];u<d.length;u++){var j=d[u];l=l.split("#".concat(j))[0].trim()}if(""===l)return"continue";i[l]&&c.push(l),i[l]=1;var b={code:l,frozen:a.some((function(e){return e.code===l})),parent:Pt(s,t,l,n),active:!e.includes("#disabled"),folded:e.includes("#folded")};if(e.includes("#irrelevant")){var h=e.split("#irrelevant(")[1].split(")")[0];b.makes_irrelevant=h.split(",")}if(e.includes("#color")){var f=e.split("#color(")[1].split(")")[0];b.color=Bt(f)}o.push(b)};for(u.s();!(r=u.n()).done;)d()}catch(f){u.e(f)}finally{u.f()}var j,b=Object(m.a)(a);try{var h=function(){var e=j.value;if(o.some((function(t){return t.code===e.code})))return"continue";e.parent="",o.push(e)};for(b.s();!(j=b.n()).done;)h()}catch(f){b.e(f)}finally{b.f()}return[o,c]},Pt=function(e,t,n,a){for(var r=t,i=0,c=Object.keys(e);i<c.length;i++){var o=c[i];a>(o=Number(o))?r=e[o]:(delete e[o],e[a]=n)}return e[a]=n,r},Bt=function(e){if(!e)return"#FFFFFF";var t=document.createElement("canvas").getContext("2d");return t.fillStyle=e.trim(),t.fillStyle},Gt=n(232),Vt=function(e,t,n,a){for(var r=e.findIndex((function(e){return e.code===t.code})),i=null,c=e[r].parent,o=0;o<e.length;o++)o!==r&&e[o].parent===c&&("down"===n&&o>r&&(null===i||i>o)&&(i=o),"up"===n&&o<r&&(null===i||i<o)&&(i=o));if(null===i)return null;var s=Object(he.a)(e),l=s[r];s[r]=s[i],s[i]=l,a(s)},Jt=function(e){e.codeMap;var t=e.code,n=e.codes,r=e.setCodes,i=e.setOpen,c=Object(a.useState)([]),o=Object(j.a)(c,2),s=o[0],l=o[1],u=Object(a.useState)(""),d=Object(j.a)(u,2),b=d[0],h=d[1],f=function(e){if(""===e)return null;var a=Lt(e,t,n,n.filter((function(e){return e.frozen}))),c=Object(j.a)(a,2),o=c[0],s=c[1];if(s.length>0)return l(s),null;r(o),i(!1)};return Object(E.jsxs)("div",{style:{margin:"1em",height:"200px"},children:[Object(E.jsxs)("p",{children:[""===t?"Create new codes":Object(E.jsxs)(E.Fragment,{children:["Add codes under ",Object(E.jsx)("b",{children:t})]}),Object(E.jsx)(O.a,{floated:"right",compact:!0,size:"mini",icon:"delete",onClick:function(){return i(!1)}})]}),Object(E.jsxs)(H.a,{onSubmit:function(){return f(b)},children:[Object(E.jsxs)(G.a,{open:s.length>0,trigger:Object(E.jsx)(Rt.a,{autoFocus:!0,onChange:function(e,t){h(t.value),l([])},value:b,style:{height:"130px"},placeholder:"Every line becomes a new code"}),children:["Duplicate labels: ",Object(E.jsx)("br",{}),Object(E.jsx)("b",{children:s.join(", ")})]}),Object(E.jsx)(O.a,{fluid:!0,content:"Create",onClick:function(){return f(b)}})]})]})},Ht=function(e){var t=e.codeMap,n=e.code,a=e.codes,r=e.setCodes,i=e.setOpen,c=function(e){var c=a.filter((function(e){return e.code!==n})),o=[];e?c=c.map((function(e){return t[n].children.includes(e.code)&&(e.parent=t[n].parent),e})):(Yt(t,n,o),c=c.filter((function(e){return!o.includes(e.code)}))),r(c),i(!1)};return Object(E.jsxs)("div",{style:{margin:"1em"},children:[Object(E.jsxs)("p",{children:["Delete ",Object(E.jsx)("b",{children:n}),"?"]}),Object(E.jsxs)(Gt.a,{fluid:!0,children:[t[n].children.length>0?Object(E.jsxs)(E.Fragment,{children:[Object(E.jsx)(O.a,{color:"red",onClick:function(){return c(!1)},children:"Yes"}),Object(E.jsx)(O.a,{color:"red",onClick:function(){return c(!0)},children:"Yes, but keep children"})]}):Object(E.jsx)(O.a,{color:"red",onClick:function(){return c(!0)},children:"Yes"}),Object(E.jsx)(O.a,{onClick:function(){return i(!1)},children:"Cancel"})]})]})},Wt=function(e){var t=e.codeMap,n=e.code,r=e.codes,i=e.setCodes,c=e.setOpen,o=e.frozen,s=Object(a.useState)(t[n].parent),l=Object(j.a)(s,2),u=l[0],d=l[1],b=Object(a.useState)(n),h=Object(j.a)(b,2),f=h[0],p=h[1],x=["ROOT"].concat(Object(he.a)(Qt(t,n))),v=function(e,a){if(e!==n){if(""===e)return null;if(t[e])return null}var o=!0,s=r.map((function(t){return t.code===n&&(t.code=e,t.parent=a,o=!1),t.parent===n&&(t.parent=e),t}));o&&r.push({code:e,parent:a,active:!0}),r=r.filter((function(e){return"ROOT"!==e.parent})),i(s),c(!1)};return Object(E.jsxs)("div",{style:{margin:"1em"},children:[Object(E.jsxs)("p",{children:[o?"Change parent":"Change parent and/or label",Object(E.jsx)(O.a,{floated:"right",compact:!0,size:"mini",icon:"delete",onClick:function(){return c(!1)}})]}),Object(E.jsxs)(H.a,{onSubmit:function(){return v(f,u)},children:[Object(E.jsxs)(H.a.Field,{inline:!0,children:[Object(E.jsx)("label",{style:{color:"white"},children:"Parent:"}),Object(E.jsx)(Ie.a,{value:u,style:{minWidth:"10em"},options:x.map((function(e,t){return{key:e,value:e,text:e}})),search:!0,selectOnNavigation:!1,minCharacters:0,autoComplete:"on",onChange:function(e,t){d(t.value)}})]}),o?null:Object(E.jsxs)(H.a.Field,{inline:!0,children:[Object(E.jsx)("label",{style:{color:"white"},children:"Code:"}),Object(E.jsx)(Oe.a,{autoFocus:!0,onChange:function(e,t){p(t.value)},value:f,placeholder:"new code"})]}),Object(E.jsx)(O.a,{fluid:!0,onClick:function(){return v(f,u)},children:"Change"})]})]})},Yt=function e(t,n,a){var r,i=Object(m.a)(t[n].children);try{for(i.s();!(r=i.n()).done;){var c=r.value;a.push(c),e(t,c,a)}}catch(o){i.e(o)}finally{i.f()}},Qt=function(e,t){var n=[];return Yt(e,t,n),Object.keys(e).filter((function(e){return!n.includes(e)&&e!==t}))},Kt=function(e){var t=e.codeMap,n=e.code,r=e.codes,i=e.setCodes,c=e.toggleActiveCode,o=e.setChangeColor,s=e.canAdd,l=Object(K.b)(),u=Object(a.useState)(!1),d=Object(j.a)(u,2),b=d[0],h=d[1],f=Object(a.useState)(null),p=Object(j.a)(f,2),x=p[0],g=p[1];Object(a.useEffect)((function(){return l(Q(b)),function(){l(Q(!1))}}),[l,b]);var m={padding:"0",margin:"0",width:"15px",borderRadius:"0",minHeight:"10px"},y=function(){return n.code||null!=n.active?Object(E.jsx)(O.a,{size:"mini",as:"Input",style:Object(v.a)(Object(v.a)({},m),{},{padding:"10px 0px",background:n.color||"white"}),onInput:function(e){return o({code:n.code,color:e.target.value})},type:"color",value:n.color||"white"}):null},k=function(e){g(Object(E.jsx)(Jt,{codeMap:t,code:e?"":n.code,codes:r,setCodes:i,setOpen:h})),h(!0)},w=function(){g(Object(E.jsx)(Ht,{codeMap:t,code:n.code,codes:r,setCodes:i,setOpen:h})),h(!0)},C=function(){g(Object(E.jsx)(Wt,{codeMap:t,code:n.code,codes:r,setCodes:i,setOpen:h,frozen:n.frozen})),h(!0)},S=function(e){Vt(r,n,e,i),h(!1)};return Object(E.jsx)(G.a,{inverted:!0,size:"mini",flowing:!0,hoverable:!0,mouseLeaveDelay:99999999,open:b,onClose:function(){return h(!1)},trigger:""===n?s?Object(E.jsxs)(Gt.a,{fluid:!0,color:"black",children:[Object(E.jsx)(O.a,{content:"Add codes",onClick:function(){return k(!0)},style:m}),";"]}):null:Object(E.jsxs)(Gt.a,{color:"black",attached:!0,fluid:!0,size:"mini",style:{padding:"0",margin:"0"},children:[Object(E.jsx)(O.a,{size:"mini",icon:n.active&&n.activeParent?"toggle on":"toggle off",onClick:function(){return c(r,n.code,!n.active,i)},style:Object(v.a)(Object(v.a)({},m),{},{color:n.active&&n.activeParent?"green":"red"})}),Object(E.jsx)(O.a,{icon:"arrow up",compact:!0,size:"mini",onClick:function(){return S("up")},style:m}),Object(E.jsx)(O.a,{icon:"arrow down",compact:!0,size:"mini",onClick:function(){return S("down")},style:m}),Object(E.jsx)(O.a,{disabled:!s,icon:"plus",compact:!0,size:"mini",onClick:function(){return k(!1)},style:m}),Object(E.jsx)(O.a,{disabled:n.frozen,icon:"minus",compact:!0,size:"mini",onClick:w,style:m}),Object(E.jsx)(O.a,{icon:"edit",compact:!0,size:"mini",onClick:C,style:m}),y()]}),style:{padding:"0",margin:"0"},children:x})},Xt=function(e,t,n,a){if(!t)return null;var r=$t(e,t,n),i=n.makes_irrelevant.map((function(e){return"Skip_"+e})),c=n.required_for.map((function(e){return"Required for_"+e})),o=[].concat(Object(he.a)(i),Object(he.a)(c)),s=o.filter((function(e){return r.some((function(t){return t.value===e}))}));return s.length<o.length&&a(n.code,s),Object(E.jsx)(Ie.a,{multiple:!0,header:"Determine how this answer affects remaining questions",direction:"left",options:r,value:s,renderLabel:Zt,onChange:function(e,t){var r=t.value;a(n.code,r)},style:{paddingRight:"0",textAlign:"right"}})},$t=function(e,t,n){var a=[];n.required_for.includes("REMAINING")||a.push({key:"skipremaining",content:Object(E.jsxs)(E.Fragment,{children:[Object(E.jsx)(Mt.a,{color:"red",children:"Skips"}),"All remaining questions"]}),value:"Skip_REMAINING",color:"red"});for(var r=t.length||0,i=0;i<r;i++)t[i].name!==e.name&&(n.required_for.includes(t[i].name)||a.push({key:"skip"+i,content:Object(E.jsxs)(E.Fragment,{children:[Object(E.jsx)(Mt.a,{color:"red",children:"Skips"}),t[i].name]}),color:"red",value:"Skip_"+t[i].name}));n.makes_irrelevant.includes("REMAINING")||a.push({key:"requiredremaining",content:Object(E.jsxs)(E.Fragment,{children:[Object(E.jsx)(Mt.a,{color:"green",children:"Required for"}),"All remaining questions"]}),value:"Required for_REMAINING",color:"green"});for(var c=0;c<r;c++)t[c].name!==e.name&&(n.makes_irrelevant.includes(t[c].name)||a.push({key:"required"+c,content:Object(E.jsxs)(E.Fragment,{children:[Object(E.jsx)(Mt.a,{color:"green",children:"Required for"}),t[c].name]}),color:"green",value:"Required for_"+t[c].name}));return a},Zt=function(e){return{content:e.value.replace("Skip_","").replace("Required for_",""),style:{fontSize:"12px",padding:"0",color:e.color,background:"white",border:"0",boxShadow:"none"}}},en=function(e){var t=e.codes,n=e.codeTreeArray,r=e.setCodes,i=Object(K.b)(),c=Object(a.useState)(!1),o=Object(j.a)(c,2),s=o[0],l=o[1],u=Object(a.useState)(""),d=Object(j.a)(u,2),b=d[0],h=d[1],p=Object(a.useState)([]),x=Object(j.a)(p,2),v=x[0],g=x[1];Object(a.useEffect)((function(){return i(Q(s)),function(){i(Q(!1))}}),[i,s]),Object(a.useEffect)((function(){h(function(e){var t,n,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:25,i="",c=Object(m.a)(e);try{for(c.s();!(n=c.n()).done;){var o=n.value;t="",t+=Array(1+o.level*a).join(" ");var s=r-(t+=o.code).length;s>0&&(t+=Array(s).join(" ")),t+=" #color(".concat(o.color,")"),o.active||(t+=" #disabled"),o.folded&&(t+=" #folded"),o.makes_irrelevant&&o.makes_irrelevant.length>0&&(t+=" #irrelevant(".concat(o.makes_irrelevant.join(","),")")),i+=t+"\n"}}catch(l){c.e(l)}finally{c.f()}return i}(n,2,40))}),[n]);return Object(E.jsxs)(f.a,{on:"click",open:s,style:{width:"700px",maxWidth:"100%",overflowX:"auto",padding:"0.3em"},trigger:Object(E.jsx)(O.a,{fluid:!0,onClick:function(){return l(!0)},style:{padding:"0.3em 1em",borderRadius:"0"},children:"Plain text editor"}),children:[Object(E.jsxs)(G.a,{open:v.length>0,trigger:Object(E.jsx)(Rt.a,{autoFocus:!0,rows:20,onChange:function(e,t){h(t.value)},value:b,style:{fontFamily:"monospace",height:"100%",width:"100%"},placeholder:"Every line is a code\\n\\nindent codes to make a tree, like\\nparent\\n  child\\n    grandchild\\n\\nAdd colors with:\\ncode   #color(red)"}),children:["Duplicate labels: ",Object(E.jsx)("br",{}),Object(E.jsx)("b",{children:v.join(", ")})]}),Object(E.jsxs)(f.a.Actions,{children:[Object(E.jsx)(O.a,{color:"black",onClick:function(){return l(!1)},children:"Cancel"}),Object(E.jsx)(O.a,{content:"Save changes",onClick:function(){var e=Lt(b,"",[],t.filter((function(e){return e.frozen}))),n=Object(j.a)(e,2),a=n[0],i=n[1];if(i.length>0)return g(i),null;r(a),l(!1)},positive:!0})]})]})},tn=function(e,t,n,a){a(n.map((function(n){return n.code===e&&(n.color=t),n})))},nn=function(e,t,n,a){var r=Object(he.a)(e),i=r.find((function(e){return e.code===t}));i?i.active=n:r.push({code:t,parent:"",active:!0}),a(r)},an=function(e,t,n,a){var r=Object(he.a)(e),i=r.find((function(e){return e.code===t}));i?i.folded=!n:r.push({code:t,parent:"",active:!0,folded:!n}),a(r)},rn=function(e){var t=e.codes,n=e.setCodes,r=e.questions,i=e.question,c=e.canAdd,o=void 0===c||c,s=e.height,l=void 0===s?"100%":s,u=Object(a.useState)({}),d=Object(j.a)(u,2),b=d[0],h=d[1],f=Object(a.useState)([]),p=Object(j.a)(f,2),O=p[0],g=p[1],y=Object(a.useState)(null),k=Object(j.a)(y,2),w=k[0],C=k[1];Object(a.useEffect)((function(){if(t&&0!==t.length){var e=Object(_.codeBookEdgesToMap)(t);h(e),g(Object(_.getCodeTreeArray)(e,true))}else g([])}),[t,g,h,true]),Object(a.useEffect)((function(){var e=setTimeout((function(){w&&tn(w.code,w.color,t,n),C(null)}),500);return function(){return clearTimeout(e)}}),[t,n,w,C]);var S=function(e){var t=null==e.active||e.active?"black":"grey";return 0===e.level?{fontWeight:"bold",fontSize:"15px",color:t}:1===e.level||2===e.level?{fontSize:"12px",color:t}:{fontSize:"10px",color:t}},A=function(e,a){var r,i=Object(he.a)(t),c=[],o=[],s=Object(m.a)(a);try{for(s.s();!(r=s.n()).done;){var l=r.value.split(/_(.+)/),u=Object(j.a)(l,2),d=u[0],b=u[1];"Skip"===d&&c.push(b),"Required for"===d&&o.push(b)}}catch(f){s.e(f)}finally{s.f()}var h=i.find((function(t){return t.code===e}));h.makes_irrelevant=c,h.required_for=o.filter((function(e){return!c.includes(e)})),n(i)};return Object(E.jsx)("div",{children:Object(E.jsxs)(fe.a,{columns:3,unstackable:!0,textAlign:"left",style:{border:"0",boxShadow:"0",width:"100%"},children:[Object(E.jsx)(fe.a.Header,{className:"codes-thead"}),Object(E.jsxs)(fe.a.Body,{style:{height:l,margin:"0",overflow:"visible"},className:"codes-tbody",children:[Object(E.jsxs)(fe.a.Row,{className:"codes-tr",children:[Object(E.jsx)(fe.a.HeaderCell,{textAlign:"center",children:Object(E.jsx)(x.a,{name:"settings"})}),Object(E.jsx)(fe.a.HeaderCell,{style:{position:"relative",paddingLeft:"0.5em"},children:"Codebook"}),Object(E.jsx)(fe.a.HeaderCell,{style:{textAlign:"right"},children:Object(E.jsxs)("div",{hidden:null==i,style:{marginRight:"18px"},children:["Branching",Object(E.jsx)(wt,{header:"Make other questions conditional on this answer",texts:["Certain answers can make other questions irrelevant.\n           For example, you might first ask if a text is relevant (for your study).\n           If it isn't, you don't need your coder to waste time answering the remaining questions.\n           In this case, you can set branching to \"Skip all\".",'You can also let an answer "Skip a specific questions", so that certain follow-up questions\n           are only asked if certain conditions are met.','Alternatively, you can specify that an answer is "Required for a specific question" (which is just shorthand for Skip for all other answers)',"It is recommended to implement branching as a final step, and to use the preview to test whether it works as intended"]})]})})]}),Object(he.a)(O).map((function(e,a){return e.foldToParent?null:Object(E.jsxs)(fe.a.Row,{className:"codes-tr",style:{},children:[Object(E.jsx)(fe.a.Cell,{className:"codes-td",width:1,style:{border:"1px solid black",padding:"0",margin:"0",background:"#1B1C1D",borderRight:null==e.active?null:"1px solid black"},children:Object(E.jsx)(Kt,{codeMap:b,code:e,codes:t,setCodes:n,toggleActiveCode:nn,setChangeColor:C,canAdd:o})}),Object(E.jsx)(fe.a.Cell,{className:"codes-td",style:{paddingLeft:"0.5em",borderTop:0===e.level?"1px solid black":null},children:Object(E.jsxs)("span",{style:Object(v.a)(Object(v.a)({},S(e)),{},{marginLeft:"".concat(1*e.level,"em")}),children:[e.code,0===e.totalChildren||null==e.active?null:Object(E.jsxs)(E.Fragment,{children:[Object(E.jsx)(x.a,{style:{padding:"0",margin:"0",marginLeft:"1em",cursor:"pointer"},onClick:function(){return an(t,e.code,null!=e.folded&&e.folded,n)},name:e.folded?"caret right":"dropdown"}),e.folded?Object(E.jsx)("span",{style:{color:"grey"},children:"".concat(e.totalActiveChildren,"/").concat(e.totalChildren)}):null]})]})}),Object(E.jsx)(fe.a.Cell,{className:"codes-td",style:{textAlign:"right",paddingLeft:"0.5em",borderTop:0===e.level?"1px solid black":null},children:Xt(i,r,e,A)})]},a)})),Object(E.jsx)(Kt,{codeMap:b,code:"",codes:t,setCodes:n,setChangeColor:C,canAdd:o,children:Object(E.jsx)(x.a,{name:"cog",style:{marginLeft:"0.7em",cursor:"pointer"}})}),Object(E.jsx)(en,{codes:t,codeTreeArray:O,setCodes:n})]})]})})},cn=n(358),on=function(e){var t=e.variables,n=e.setVariables,r=e.index,i=Object(a.useState)(""),c=Object(j.a)(i,2),o=c[0],s=c[1],l=Object(K.b)();return Object(a.useEffect)((function(){if(0!==t.length&&o&&o!==t[r].name&&t[r].name!==o){var e=setTimeout((function(){!function(e,t,n,a){if(t[n].name!==e){var r=t[n].name;t[n].name=un(e,t,n),dn(t,r,t[n].name),a(t)}}(o.trim(),t,r,n)}),500);return function(){return clearTimeout(e)}}}),[o,t,r,n]),Object(a.useEffect)((function(){0!==t.length&&s(t[r].name)}),[t,r,s]),0===t.length?null:Object(E.jsx)(H.a,{style:{width:"50%"},children:Object(E.jsxs)(H.a.Group,{grouped:!0,children:[Object(E.jsx)("label",{children:"Name"})," ",Object(E.jsx)("span",{style:{fontSize:"10px"},children:"(keep it short)"}),Object(E.jsx)(H.a.Field,{children:Object(E.jsx)(Oe.a,{disabled:null!=t[r].enabled,value:o,style:{width:"150px"},onFocus:function(){return l(Q(!0))},onBlur:function(){return l(Q(!1))},onChange:function(e,t){return s(t.value)}})})," "]})})},sn=function(e){var t=e.variables,n=e.setVariables,r=e.index,i=e.setIndex,c=Object(a.useState)(!1),o=Object(j.a)(c,2),s=o[0],l=o[1];return t.length<=1||null!=t[r].enabled?null:Object(E.jsxs)(G.a,{hoverable:!0,open:s,onClose:function(){return l(!1)},trigger:Object(E.jsx)(O.a,{icon:"delete",floated:"right",style:{background:"red",zIndex:100},onClick:function(){return l(!s)}}),children:[Object(E.jsxs)("p",{children:["Delete ",Object(E.jsx)("b",{children:t[r].name}),"?"]}),Object(E.jsx)(O.a,{style:{background:"red"},onClick:function(){for(var e=[],a=0;a<t.length;a++)a!==r&&e.push(t[a]);n(e),l(!1),i(Math.max(0,r-1))},children:"yes please"})]})},ln=function(e){var t=e.i,n=e.variables,a=e.setVariables,r=e.index,i=e.setIndex,c=function(e,t){var r="left"===e?Math.max(0,t-1):Math.min(n.length-1,t+1),c=n[t];n[t]=n[r],n[r]=c,a(n),i(r)};return r!==t?null:Object(E.jsxs)(O.a.Group,{children:[t>0?Object(E.jsx)(O.a,{icon:"arrow left",onClick:function(e){e.stopPropagation(),c("left",t)},style:{borderRadius:"0",padding:"0em",background:"rgba(0,0,0,0)"}}):null,t<n.length-1?Object(E.jsx)(O.a,{icon:"arrow right",onClick:function(e){e.stopPropagation(),c("right",t)},style:{borderRadius:"0",padding:"0em",background:"rgba(0,0,0,0)"}}):null]})},un=function(e,t,n){for(var a=e,r=2,i=["REMAINING"],c=0;c<t.length;c++)null!==n&&c===n||i.push(t[c].name);for(;i.includes(a);)a=e+" ".concat(r),r++;return a},dn=function(e,t,n){var a,r=Object(m.a)(e);try{for(r.s();!(a=r.n()).done;){var i=a.value;i.codes=i.codes.map((function(e){return e.makes_irrelevant&&(e.makes_irrelevant=e.makes_irrelevant.map((function(e){return e===t?n:e}))),e.required_for&&(e.required_for=e.required_for.map((function(e){return e===t?n:e}))),e}))}}catch(c){r.e(c)}finally{r.f()}},jn=function(e){var t=e.children,n=e.variables,r=e.setVariables,i=e.index,c=e.setIndex,o=e.newVariableDefaults,s=Object(a.useState)(!1),u=Object(j.a)(s,2),d=u[0],b=u[1];return Object(E.jsxs)("div",{children:[Object(E.jsxs)(l.a,{attached:"top",style:{width:"100%",overflowX:"auto"},children:[Array(n.length).fill(0).map((function(e,t){return Object(E.jsx)(l.a.Item,{onClick:function(e,n){return c(t)},active:i===t,style:{padding:"0 0",position:"relative"},children:Object(E.jsx)("div",{children:Object(E.jsxs)("div",{style:{padding:"0 0.5em",height:"100%",cursor:"pointer"},children:[null!=n[t].enabled?Object(E.jsx)(kt.a,{checked:n[t].enabled,onChange:function(){n[t].enabled=!n[t].enabled,r(n)},label:n[t].name,style:{margin:"5px 5px 20px -5px"}}):Object(E.jsx)("div",{style:{margin:"5px 5px 20px 0px"},children:n[t].name}),Object(E.jsx)("div",{style:{position:"absolute",bottom:"0"},children:Object(E.jsx)(ln,{i:t,variables:n,setVariables:r,index:i,setIndex:c})})]})})})})),Object(E.jsx)(l.a.Item,{icon:"plus",attached:"right",position:"right",style:{background:"lightblue"},onClick:function(){var e=Object(v.a)(Object(v.a)({},o),{},{name:un(o.name,n,null)});n.push(e),r(n)}})]}),Object(E.jsxs)(J.a,{attached:"bottom",style:{padding:"1em"},children:[Object(E.jsx)(sn,{variables:n,setVariables:r,index:i,setIndex:c}),Object(E.jsxs)(cn.a,{children:[Object(E.jsxs)(cn.a.Title,{active:d,onClick:function(){return b(!d)},children:[Object(E.jsxs)("i",{style:{color:"blue"},children:[d?"Hide":"Show"," settings"]})," ",Object(E.jsx)(x.a,{name:"dropdown"})]}),Object(E.jsxs)(cn.a.Content,{active:d,children:[" ",null==n[i].enabled?null:Object(E.jsx)("h4",{children:Object(E.jsx)("i",{children:"Imported annotations"})}),Object(E.jsx)(on,{variables:n,setVariables:r,index:i}),t]})]})]})]})},bn={type:"select code",name:"Question name",question:"The question itself",codes:["No","Skip","Yes"]},hn=function(e){var t=e.taskSettings,n=e.setTaskSettings,a=e.unitSettings,r=e.questionIndex,i=t.questions.questions;return Object(E.jsx)(fn,{questionForm:i[r],setQuestionForm:function(e){var a=Object(v.a)({},t),i=Object(v.a)({},e);a.questions.questions[r]=i,n(a)},setTaskSettings:n,questions:i,questionIndex:r,unitSettings:a})},fn=function(e){var t=e.questionForm,n=e.setQuestionForm,r=e.questions,i=e.unitSettings,c=Object(a.useState)(""),o=Object(j.a)(c,2),s=o[0],l=o[1],u=Object(a.useState)([]),d=Object(j.a)(u,2),b=d[0],h=d[1];Object(a.useEffect)((function(){if(s&&t.question!==s.question){var e=setTimeout((function(){n(Object(v.a)(Object(v.a)({},t),{},{name:s.name,question:s.question}))}),500);return function(){return clearTimeout(e)}}}),[s,t,n]),Object(a.useEffect)((function(){if(t){var e=[];t.question.search("\\[code\\]")>=0&&"allTextUnits"===(null===i||void 0===i?void 0:i.unitSelection)&&e.push("Referring to a specific code with [code] is only possible if coding units are annotations"),h(e),l({name:t.name,question:t.question})}}),[l,t,h,i]);return t?Object(E.jsxs)(H.a,{children:[Object(E.jsxs)(H.a.Group,{grouped:!0,children:[Object(E.jsxs)("label",{children:["Question",Object(E.jsx)(wt,{header:"Referring to annotation codes in a question",texts:["If unit selection is based on span annotations, you can also use the tag [code]. This will be replaced by the code label of the annotation"]})]}),b.length>0?Object(E.jsx)(wt,{type:"warn",header:"",texts:b}):null,Object(E.jsx)(H.a.Field,{children:Object(E.jsx)(Rt.a,{value:s.question,onChange:function(e,t){return l(Object(v.a)(Object(v.a)({},s),{},{question:t.value}))}})})]}),Object(E.jsxs)(H.a.Group,{grouped:!0,children:[Object(E.jsx)("label",{children:"Type of answer"}),Object(E.jsx)(H.a.Field,{children:Object(E.jsx)(Qe.a,{value:"search code",label:"Select code from search box",checked:"search code"===t.type,onChange:function(){return n(Object(v.a)(Object(v.a)({},t),{},{type:"search code"}))}})}),Object(E.jsx)(H.a.Field,{children:Object(E.jsx)(Qe.a,{value:"select code",label:"Select code from buttons",checked:"select code"===t.type,onChange:function(){return n(Object(v.a)(Object(v.a)({},t),{},{type:"select code"}))}})}),Object(E.jsx)(H.a.Field,{children:Object(E.jsx)(Qe.a,{value:"annotinder",label:"Annotinder (swipe left/right/up)",checked:"annotinder"===t.type,onChange:function(){return n(Object(v.a)(Object(v.a)({},t),{},{type:"annotinder"}))}})})]}),Object(E.jsx)("br",{}),Object(E.jsx)("br",{}),Object(E.jsx)(pn,{questionForm:t,setQuestionForm:n}),Object(E.jsx)("div",{style:{margin:"-1em"},children:Object(E.jsx)(rn,{codes:Object(_.standardizeCodes)(t.codes),setCodes:function(e){return n(Object(v.a)(Object(v.a)({},t),{},{codes:e}))},questions:r,question:t})})]}):null},pn=function(e){var t,n,r,i=e.questionForm,c=e.setQuestionForm,o=Object(a.useState)({left:null,up:null,right:null}),s=Object(j.a)(o,2),l=s[0],u=s[1];Object(a.useEffect)((function(){if("annotinder"!==i.type)return null;var e,t=Object(he.a)(i.codes),n=!0,a=Object(m.a)(t);try{for(a.s();!(e=a.n()).done;){var r=e.value;null!==r&&void 0!==r&&r.swipe&&(n=!1)}}catch(l){a.e(l)}finally{a.f()}if(!n)return null;for(var o=["left","up","right"],s=0;s<3;s++)t.length>s&&("object"===typeof t[s]?t[s]=Object(v.a)(Object(v.a)({},t[s]),{},{swipe:o[s]}):t[s]={code:t[s],swipe:o[s]});c(Object(v.a)(Object(v.a)({},i),{},{codes:t}))}),[i,c]),Object(a.useEffect)((function(){var e=function(e){return i.codes.find((function(t){return"object"===typeof t&&(t.swipe&&t.swipe===e)}))},t=e("left")||null,n=e("up")||null,a=e("right")||null;u({left:t,up:n,right:a})}),[i,u]);var d=function(e,t){var n=i.codes.map((function(n){var a="object"!==typeof n?{code:n}:Object(v.a)({},n);return a.code===t?Object(v.a)(Object(v.a)({},a),{},{swipe:e}):a.swipe&&a.swipe===e?Object(v.a)(Object(v.a)({},a),{},{swipe:null}):(a.swipe||(a.swipe=null),a)}));c(Object(v.a)(Object(v.a)({},i),{},{codes:n}))};if("annotinder"!==i.type)return null;var b=i.codes.map((function(e,t){return{key:t,text:e.code||e,value:e.code||e}}));return Object(E.jsxs)(H.a,{children:[Object(E.jsxs)(V.a,{textAlign:"center",verticalAlign:"middle",children:[Object(E.jsx)(V.a.Row,{style:{paddingBottom:"0"},children:Object(E.jsx)(V.a.Column,{width:6,children:Object(E.jsxs)(H.a.Group,{grouped:!0,children:[Object(E.jsx)("b",{children:"swipe"})," or ",Object(E.jsx)("b",{children:"arrow up"}),Object(E.jsx)("br",{}),Object(E.jsx)(Ie.a,{placeholder:"not used",clearable:!0,value:(null===(t=l.up)||void 0===t?void 0:t.code)||null,options:b,selection:!0,style:{minWidth:"10em",maxWidth:"10em"},onChange:function(e,t){return d("up",t.value)}})]})})}),Object(E.jsxs)(V.a.Row,{children:[Object(E.jsxs)(V.a.Column,{width:8,children:[Object(E.jsx)("b",{children:"swipe"})," or ",Object(E.jsx)("b",{children:"arrow left"}),Object(E.jsx)("br",{}),Object(E.jsx)(Ie.a,{placeholder:"not used",clearable:!0,value:(null===(n=l.left)||void 0===n?void 0:n.code)||null,options:b,selection:!0,style:{minWidth:"10em",maxWidth:"10em"},onChange:function(e,t){return d("left",t.value)}})]}),Object(E.jsxs)(V.a.Column,{width:8,children:[Object(E.jsx)("b",{children:"swipe"})," or ",Object(E.jsx)("b",{children:"arrow right"}),Object(E.jsx)("br",{}),Object(E.jsx)(Ie.a,{placeholder:"not used",clearable:!0,value:(null===(r=l.right)||void 0===r?void 0:r.code)||null,options:b,selection:!0,style:{minWidth:"10em",maxWidth:"10em"},onChange:function(e,t){return d("right",t.value)}})]})]})]}),Object(E.jsx)("br",{}),Object(E.jsx)("br",{})]})},On=function(e){var t=e.taskSettings,n=e.setTaskSettings,r=e.unitSettings,i=Object(a.useState)(0),c=Object(j.a)(i,2),o=c[0],s=c[1];return Object(E.jsxs)(jn,{variables:t.questions.questions,setVariables:function(e){n(Object(v.a)(Object(v.a)({},t),{},{questions:{settings:t.questions.settings,questions:e}}))},index:o,setIndex:s,newVariableDefaults:bn,children:[Object(E.jsx)(hn,{taskSettings:t,setTaskSettings:n,unitSettings:r,questionIndex:o})," "]})},xn={name:"Variable name",instruction:"This is what you need to do",buttonMode:"all",editMode:!1,searchBox:!1,singleCode:!1,codes:["No","Skip","Yes"]},vn=function(e){var t,n,a=e.taskSettings,r=e.setTaskSettings;console.log(a);var i=null===a||void 0===a||null===(t=a.annotate)||void 0===t?void 0:t.settings,c=null===a||void 0===a||null===(n=a.annotate)||void 0===n?void 0:n.variables;return i&&c?Object(E.jsx)(H.a,{children:Object(E.jsx)(H.a.Group,{children:Object(E.jsxs)(H.a.Field,{children:[Object(E.jsx)(kt.a,{disabled:c.filter((function(e){return null==e.enabled||e.enabled})).length<=1,toggle:!0,label:"Edit all option",checked:i.editAll,onChange:function(e,t){return n=Object(v.a)(Object(v.a)({},i),{},{editAll:t.checked}),void r(Object(v.a)(Object(v.a)({},a),{},{annotate:{settings:n,variables:a.annotate.variables}}));var n}}),Object(E.jsx)(wt,{header:"Add edit all option",texts:["If there are two or more variables, adds the option for coders to view and edit all annotations together"]})]})})}):null},gn=function(e){var t,n,a=e.taskSettings,r=e.setTaskSettings,i=e.variableIndex,c=a.annotate.variables[i],o=function(e){var t=Object(v.a)({},a),n=Object(v.a)({},e);t.annotate.variables[i]=n,r(t)};return null!==a&&void 0!==a&&null!==(t=a.annotate)&&void 0!==t&&null!==(n=t.variables)&&void 0!==n&&n[i]?Object(E.jsxs)(H.a,{children:[Object(E.jsx)(mn,{annotateForm:c,setAnnotateForm:o}),Object(E.jsxs)(H.a.Group,{children:[Object(E.jsx)(x.a,{name:"setting"}),Object(E.jsx)("label",{children:"Code Selector settings"})]}),Object(E.jsx)(H.a.Group,{children:null==c.enabled?Object(E.jsx)(H.a.Field,{children:Object(E.jsx)(kt.a,{label:"Single code (only select)",checked:c.singleCode,onChange:function(e,t){return o(Object(v.a)(Object(v.a)({},c),{},{singleCode:t.checked}))}})}):Object(E.jsxs)(E.Fragment,{children:[Object(E.jsxs)(H.a.Field,{children:[Object(E.jsx)(kt.a,{label:"Edit mode",checked:c.editMode,onChange:function(e,t){return o(Object(v.a)(Object(v.a)({},c),{},{editMode:t.checked}))}}),Object(E.jsx)(wt,{header:"Edit mode",texts:["In edit mode you can not create new annotations, but only edit existing anntations"]})]}),Object(E.jsxs)(H.a.Field,{children:[Object(E.jsx)(kt.a,{label:"Only code ",checked:c.editMode,onChange:function(e,t){return o(Object(v.a)(Object(v.a)({},c),{},{editMode:t.checked}))}}),Object(E.jsx)(wt,{header:"Edit mode",texts:["In edit mode you can not create new annotations, but only edit existing anntations"]})]})]})}),Object(E.jsx)(H.a.Group,{children:Object(E.jsxs)(H.a.Field,{children:[Object(E.jsx)(kt.a,{label:"Multiple",checked:c.multiple,onChange:function(e,t){return o(Object(v.a)(Object(v.a)({},c),{},{multiple:t.checked}))}}),Object(E.jsx)(wt,{header:"Select multiple codes",texts:["Allows user to select (or delete) multiple codes before closing the popup"]})]})}),Object(E.jsxs)(H.a.Group,{grouped:!0,style:{display:c.singleCode?"none":"block"},children:[Object(E.jsx)("label",{children:"Code buttons"}),Object(E.jsxs)(H.a.Field,{children:[Object(E.jsx)(Qe.a,{value:"all",label:"Show all codes",checked:"all"===c.buttonMode,onChange:function(){return o(Object(v.a)(Object(v.a)({},c),{},{buttonMode:"all"}))}}),Object(E.jsx)(wt,{header:"Show all active codes",texts:["Only codes that are 'active' will be shown","You can toggle which codes are active in the codebook (top-right in menu bar)"]}),Object(E.jsx)(H.a.Field,{style:{marginLeft:"25px"},children:Object(E.jsx)(kt.a,{label:"Include search field",disabled:"recent"===c.buttonMode,checked:c.searchBox,onChange:function(e,t){return o(Object(v.a)(Object(v.a)({},c),{},{searchBox:t.checked}))}})})]}),Object(E.jsxs)(H.a.Field,{children:[Object(E.jsx)(Qe.a,{value:"recent",label:"Show recently used",checked:"recent"===c.buttonMode,onChange:function(){return o(Object(v.a)(Object(v.a)({},c),{},{buttonMode:"recent"}))}}),Object(E.jsx)(wt,{header:"Show recently used codes",texts:["Show only (active) codes that the coder used recently","The Search box is always enabled with this option, and the buttons only serve as quick keys. This is especially usefull for very large codebooks, for instance for tagging specific named entities"]})]})]}),Object(E.jsx)("br",{}),Object(E.jsx)("div",{style:{overflow:"auto",margin:"-1em",display:c.singleCode?"none":"block"},children:Object(E.jsx)(rn,{codes:Object(_.standardizeCodes)(c.codes),setCodes:function(e){return o(Object(v.a)(Object(v.a)({},c),{},{codes:e}))}})})]}):null},mn=function(e){var t=e.annotateForm,n=e.setAnnotateForm,r=Object(a.useState)(t.instruction||""),i=Object(j.a)(r,2),c=i[0],o=i[1],s=Object(K.b)();return Object(a.useEffect)((function(){if(null!==c&&null!=c&&t.instruction!==c){var e=setTimeout((function(){n(Object(v.a)(Object(v.a)({},t),{},{instruction:c}))}),1e3);return function(){return clearTimeout(e)}}}),[c,t,n]),Object(a.useEffect)((function(){o(t.instruction)}),[t]),Object(E.jsxs)(H.a.Group,{grouped:!0,children:[Object(E.jsx)("label",{children:"Instruction"}),Object(E.jsx)(H.a.Field,{children:Object(E.jsx)(Rt.a,{value:c,onFocus:function(){return s(Q(!0))},onBlur:function(){return s(Q(!1))},onChange:function(e,t){return o(t.value)}})})]})},yn=function(e){var t=e.taskSettings,n=e.setTaskSettings,r=Object(a.useState)(0),i=Object(j.a)(r,2),c=i[0],o=i[1];return Object(E.jsxs)(E.Fragment,{children:[Object(E.jsx)("h3",{children:"Global settings"}),Object(E.jsx)(vn,{taskSettings:t,setTaskSettings:n}),Object(E.jsx)("h3",{children:"Variables"}),Object(E.jsxs)(jn,{variables:t.annotate.variables,setVariables:function(e){n(Object(v.a)(Object(v.a)({},t),{},{annotate:{settings:t.annotate.settings,variables:e}}))},index:c,setIndex:o,newVariableDefaults:xn,children:[Object(E.jsx)(gn,{taskSettings:t,setTaskSettings:n,variableIndex:c})," "]})]})},kn={type:null,annotate:{settings:{editAll:!1},variables:[{name:"Variable name",buttonMode:"all",editMode:!1,multiple:!1,searchBox:!1,codes:["Some","example","options"]}]},questions:{settings:{},questions:[{name:"Question name",type:"select code",question:"[The question itself]",codes:["No","Skip","Yes"]}]}},wn=function(e){var t=e.codingjob,n=null===t||void 0===t?void 0:t.unitSettings,r=(null===t||void 0===t?void 0:t.taskSettings)||kn,i=function(e){z.setCodingjobProp(t,"taskSettings",e)};return Object(a.useEffect)((function(){if(null!==t&&void 0!==t&&t.taskSettings&&t.importedCodes)for(var e=function(){var e=a[n],r=t.importedCodes[e],i=t.taskSettings;i.annotate.variables.some((function(t){return t.name===e}))||(i.annotate.variables.push({name:e,buttonMode:r.length>10?"recent":"all",searchBox:r.length>10,codes:r,enabled:!1}),z.setCodingjobProp(t,"taskSettings",i))},n=0,a=Object.keys(t.importedCodes);n<a.length;n++)e()}),[t]),r&&n?Object(E.jsxs)("div",{style:{verticalAlign:"top",float:"top",paddingLeft:"1em"},children:[Object(E.jsx)(Cn,{taskSettings:r,setTaskSettings:i}),Object(E.jsx)(W.a,{}),"questions"===r.type?Object(E.jsx)(On,{taskSettings:r,setTaskSettings:i,unitSettings:n}):null,"annotate"===r.type?Object(E.jsx)(yn,{taskSettings:r,setTaskSettings:i,unitSettings:n}):null]}):null},Cn=function(e){var t=e.taskSettings,n=e.setTaskSettings;Object(a.useEffect)((function(){null!==t&&void 0!==t&&t.type||n(Object(v.a)(Object(v.a)({},t),{},{type:"annotate"}))}),[t,n]);var r=function(e,a){return Object(E.jsx)(H.a.Field,{children:Object(E.jsx)(Qe.a,{value:e,label:a,checked:t.type===e,onChange:function(a,r){return n(Object(v.a)(Object(v.a)({},t),{},{type:e}))}})})};return Object(E.jsxs)(H.a,{children:[Object(E.jsxs)(H.a.Group,{children:[Object(E.jsx)(x.a,{name:"setting"}),Object(E.jsx)("label",{children:"Set task type"})]}),Object(E.jsxs)(H.a.Group,{grouped:!0,widths:"equal",children:[r("annotate","Annotate"),r("questions","Question")]})]})},Sn=r.a.memo(wn),_n=function(e){var t,n=e.codingjob,a=Ot(n),r=Object(j.a)(a,1)[0];if(!n)return null;var i=[8,8];return null!==(t=n.taskSettings)&&void 0!==t&&t.type&&("annotate"===n.taskSettings.type&&(i=[6,10]),"questions"===n.taskSettings.type&&(i=[8,8])),Object(E.jsx)("div",{children:Object(E.jsxs)(V.a,{stackable:!0,columns:2,children:[Object(E.jsxs)(V.a.Column,{verticalAlign:"top",stretched:!0,width:i[0],children:[Object(E.jsx)(p.a,{textAlign:"center",style:{background:"#1B1C1D",color:"white"},children:"Settings"}),Object(E.jsx)(Sn,{codingjob:n})]}),Object(E.jsx)(V.a.Column,{width:i[1],children:Object(E.jsx)(An,{codingjob:n,units:r})})]})})},An=r.a.memo((function(e){var t,n=e.codingjob,r=e.units,i=Object(a.useState)(null),c=Object(j.a)(i,2),o=c[0],s=c[1],l=Object(a.useState)(null),u=Object(j.a)(l,2),b=u[0],f=u[1],p=Object(a.useState)(null),O=Object(j.a)(p,2),x=O[0],v=O[1];if(console.log(o),Object(a.useEffect)((function(){null!==n&&void 0!==n&&n.taskSettings&&v(Nt(n.taskSettings))}),[n.taskSettings]),console.log(b),Object(a.useEffect)((function(){return r&&null!==o?o>=r.length?null:void mt(n,[r[o]]).then((function(e){console.log(e);var t=e[0];t.jobServer={postAnnotations:function(){var e=Object(d.a)(h.a.mark((function e(t,n){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("PREVIEW: POST ".concat(n.length," annotations")),e.abrupt("return",0);case 2:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},t.progress={seek_backwards:!0,seek_forwards:!0},f(t)})):(f(null),null)}),[o,r,f,n]),!r)return null;return null!==n&&void 0!==n&&null!==(t=n.taskSettings)&&void 0!==t&&t.type?function(e){switch(e){case"questions":return Object(E.jsx)(qn,{codebook:x,standardizedUnit:b,setUnitIndex:s,children:Object(E.jsx)(_.IndexController,{n:null===r||void 0===r?void 0:r.length,index:o,setIndex:s})});case"annotate":return Object(E.jsx)(In,{codebook:x,standardizedUnit:b,setUnitIndex:s,children:Object(E.jsx)(_.IndexController,{n:null===r||void 0===r?void 0:r.length,index:o,setIndex:s})});default:return null}}(n.taskSettings.type):null})),qn=r.a.memo((function(e){var t=e.children,n=e.codebook,a=e.standardizedUnit,r=e.setUnitIndex;return n?"questions"===!(null!==n&&void 0!==n&&n.type)?null:Object(E.jsxs)(E.Fragment,{children:[Object(E.jsxs)(p.a,{textAlign:"center",style:{background:"#1B1C1D",color:"white",height:"40px"},children:["Preview",t]}),Object(E.jsx)("div",{style:{padding:"0",display:"flex",justifyContent:"center",height:"calc(100vh - 250px)",minHeight:"500px",maxHeight:"800px"},children:Object(E.jsx)("div",{style:{padding:"0em",width:"70%",paddingTop:"1em",height:"100%"},children:Object(E.jsx)(_.QuestionTask,{unit:a,codebook:n,setUnitIndex:r,blockEvents:!0})})})]}):null})),In=function(e){var t=e.children,n=e.codebook,a=e.standardizedUnit,r=e.setUnitIndex,i=Object(K.c)((function(e){return e.eventsBlocked}));return n?"annotate"!==n.type?null:Object(E.jsxs)(E.Fragment,{children:[Object(E.jsx)(p.a,{textAlign:"center",style:{background:"#1B1C1D",color:"white"},children:"Preview"}),t,Object(E.jsx)("div",{style:{padding:"0",width:"100%",height:"calc(100vh - 250px)",minHeight:"500px"},children:Object(E.jsx)("div",{style:{padding:"0",height:"100%"},children:Object(E.jsx)(_.AnnotateTask,{unit:a,codebook:n,setUnitIndex:r,blockEvents:i})})})]}):null},Fn=r.a.memo(_n),Tn={medium:null,nCoders:1,pctOverlap:10},Un=function(e){var t,n=e.codingjob,r=e.deploySettings,i=e.setDeploySettings,c=Object(a.useState)(null),o=Object(j.a)(c,2),s=o[0],l=o[1],u=(null===n||void 0===n||null===(t=n.unitSettings)||void 0===t?void 0:t.totalUnits)||0;Object(a.useEffect)((function(){l(r)}),[r,l]),Object(a.useEffect)((function(){if(s===r)return null;var e=setTimeout((function(){i(s)}),300);return function(){return clearTimeout(e)}}),[s,r,i]);var d=function(e,t){return Object(E.jsx)(H.a.Field,{children:Object(E.jsx)(Qe.a,{value:e,label:t,checked:r.medium===e,onChange:function(t,n){return i(Object(v.a)(Object(v.a)({},r),{},{medium:e}))}})})};return null===s?null:Object(E.jsxs)(H.a,{children:[Object(E.jsxs)(H.a.Group,{children:[Object(E.jsx)(x.a,{name:"setting"}),Object(E.jsx)("label",{children:"Deploy medium"})]}),Object(E.jsxs)(H.a.Group,{grouped:!0,widths:"equal",children:[d("file","File"),d("amcat","AmCAT")]}),Object(E.jsx)("div",{}),function(){var e;return"file"!==r.medium?null:Object(E.jsxs)(E.Fragment,{children:[Object(E.jsx)("br",{}),Object(E.jsxs)(H.a.Group,{children:[Object(E.jsx)(x.a,{name:"setting"}),Object(E.jsx)("label",{children:"Divide jobs"})]}),Object(E.jsxs)(H.a.Group,{children:[Object(E.jsxs)(H.a.Field,{width:4,children:[Object(E.jsxs)("label",{children:["Coders",s.nCoders>1&&null!==n&&void 0!==n&&null!==(e=n.unitSettings)&&void 0!==e&&e.ordered?Object(E.jsx)(wt,{header:"Using multiple coders shuffles data",type:"warn",texts:["You disabled 'shuffle' in the sample settings, but if more than 1 coder is assigned, \n                     the data will still be shuffled. Otherwise only the overlap items would be random, and \n                     they could be identifiable by breaking a pattern"]}):null]}),Object(E.jsx)(Oe.a,{size:"mini",type:"number",min:1,value:s.nCoders,onChange:function(e,t){return l((function(e){return Object(v.a)(Object(v.a)({},e),{},{nCoders:t.value})}))}})]}),Object(E.jsxs)(H.a.Field,{width:4,children:[Object(E.jsxs)("label",{children:["Overlap","0"===s.pctOverlap?Object(E.jsx)(wt,{header:"Are you sure?",type:"warn",texts:["I mean, we're not being judgmental, but reviewer 2 is going to ask for that intercoder reliability"]}):null]}),Object(E.jsx)(Oe.a,{size:"mini",type:"number",step:1,min:0,max:100,label:"%",labelPosition:"right",value:s.pctOverlap,onChange:function(e,t){return l((function(e){return Object(v.a)(Object(v.a)({},e),{},{pctOverlap:t.value})}))}})]}),Object(E.jsx)(H.a.Field,{width:8,children:Object(E.jsx)(Dn,{totalUnits:u,settings:s})})]})]})}()]})},Dn=function(e){var t=e.totalUnits,n=e.settings;if(!n)return null;var a=Math.round(t*n.pctOverlap/100),r=a+(t-a)/n.nCoders;return Object(E.jsxs)("div",{style:{textAlign:"center",color:"blue"},children:["Avg. units per coder ",Object(E.jsx)("br",{}),Object(E.jsx)("b",{style:{fontSize:"1.3em"},children:Math.round(100*r)/100})]})},zn=function(e){var t=e.codingjob,n=(null===t||void 0===t?void 0:t.deploySettings)||Tn;return n?Object(E.jsx)("div",{style:{verticalAlign:"top",float:"top",paddingLeft:"1em"},children:Object(E.jsx)(Un,{codingjob:t,deploySettings:n,setDeploySettings:function(e){z.setCodingjobProp(t,"deploySettings",e)}})}):null},En=n(411),Rn=n(277),Mn=n.n(Rn),Nn=function(e){var t=e.provenance.unitSettings,n=e.provenance.deploySettings,a=e.units.map((function(e){return e.unit}));if(1===t.nCoders)return[{set:1,title:e.title,codebook:e.codebook,units:a}];for(var r=Math.round(t.totalUnits*n.pctOverlap/100),i=(a=rt(a,a.length,!1,42,null)).slice(0,r),c=a.slice(r),o=Array(Number(n.nCoders)).fill([]).map((function(e){return Object(he.a)(i)})),s=0;s<c.length;s++)o[s%o.length].push(c[s]);return o.map((function(t,n){return{set:n+1,title:e.title,codebook:e.codebook,units:rt(t,t.length,!1,42,null)}}))},Ln=function(e){var t=e.codingjobPackage,n=Object(a.useState)(""),r=Object(j.a)(n,2),i=r[0],c=r[1];Object(a.useEffect)((function(){null!==t&&void 0!==t&&t.title&&c(t.title)}),[t]);var o=function(){var e=Object(d.a)(h.a.mark((function e(){var n,a,r,c,o;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(n=Nn(t),(a=new Mn.a).file("AmCAT_annotator_".concat(i,".json"),JSON.stringify(t)),r=0;r<n.length;r++)c="set_".concat(n[r].set,"_units_").concat(n[r].units.length,"_").concat(i,".json"),a.file(c,JSON.stringify(n[r]));return e.next=6,a.generateAsync({type:"blob"});case 6:o=e.sent,Object(En.saveAs)(o,"AmCAT_annotator_".concat(i,".zip"));case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(E.jsxs)("div",{children:[Object(E.jsx)(H.a,{onSubmit:function(){return o()},children:Object(E.jsx)(H.a.Input,{placeholder:"username",value:i,maxLength:30,onChange:function(e,t){return c(t.value)},autoFocus:!0,style:{width:"100%"}})}),Object(E.jsx)("br",{}),Object(E.jsxs)(O.a,{primary:!0,fluid:!0,loading:null===t,disabled:i.length<5,onClick:o,children:[i.length<5?"please use 5 characters or more":"Download codingjob files"," "]})]})},Pn=function(e){var t,n=e.codingjobPackage,r=Object(a.useState)(""),i=Object(j.a)(r,2),c=i[0],o=i[1],s=Object(Y.a)(["amcat"]),l=Object(j.a)(s,2),u=l[0],b=l[1];Object(a.useEffect)((function(){null!==n&&void 0!==n&&n.name&&o(n.name)}),[n]);var f=function(){var e=Object(d.a)(h.a.mark((function e(){var t,a;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=te(u.amcat.host,u.amcat.token),console.log(t),e.prev=2,e.next=5,t.postCodingjob(n,c);case 5:a=e.sent,z.createDeployedJob(c,t.host,a.data.id),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(2),console.log(e.t0);case 12:case"end":return e.stop()}}),e,null,[[2,9]])})));return function(){return e.apply(this,arguments)}}();return null!==u&&void 0!==u&&null!==(t=u.amcat)&&void 0!==t&&t.token?Object(E.jsxs)("div",{children:[Object(E.jsx)(H.a,{onSubmit:function(){return f()},children:Object(E.jsx)(H.a.Input,{placeholder:"Codingjob title",value:c,maxLength:30,onChange:function(e,t){return o(t.value)},autoFocus:!0,style:{width:"100%"}})}),Object(E.jsx)("br",{}),Object(E.jsx)(O.a,{fluid:!0,primary:!0,disabled:c.length<5,onClick:function(){return f()},children:c.length<5?"please use 5 characters or more":"Upload to AmCAT"})]}):Object(E.jsx)(ae,{cookies:u,setCookies:b,setOpen:function(){return null},setLoggedIn:function(){return null}})},Bn=n(412),Gn=n.n(Bn),Vn=[{name:"id",width:1},{name:"host"},{name:"job_id"},{name:"title"},{name:"created"}],Jn=[{name:"document_id"},{name:"unit_id"},{name:"coder"},{name:"variable"},{name:"value"},{name:"offset"},{name:"length"},{name:"text"}],Hn=function(e){var t=e.jobKey,n=Object(a.useState)([]),r=Object(j.a)(n,2),i=r[0],c=r[1],o=Object(Y.a)(["amcat"]),s=Object(j.a)(o,1)[0];return Object(a.useEffect)((function(){if(!t)return null;if(!s.amcat)return null;var e=te(s.amcat.host,s.amcat.email,s.amcat.token);c([]),Wn(t,e,c)}),[t,s,c]),Object(E.jsx)(Ct,{data:i,columns:Jn})},Wn=function(){var e=Object(d.a)(h.a.mark((function e(t,n,a){var r,i,c;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,z.idb.deployedJobs.get({id:t.id});case 3:if(e.sent){e.next=6;break}return e.abrupt("return");case 6:if(n){e.next=8;break}return e.abrupt("return");case 8:return r=t.job_id,e.next=11,n.getCodingjob(r);case 11:i=e.sent,c=i.data.units.reduce((function(e,t,n){if(t.annotations){var a,r=Object(m.a)(t.annotations);try{for(r.s();!(a=r.n()).done;){var i,c=a.value,o=c.user,s=c.annotation,l=Object(m.a)(s);try{for(l.s();!(i=l.n()).done;){var u=i.value,d=Object(v.a)(Object(v.a)({document_id:t.document_id,unit_id:n,coder:o},t.provenance),u);if(t.meta)for(var j=0,b=Object.keys(t.meta);j<b.length;j++){var h=b[j];d["meta_"+h]=t.meta[h]}e.push(d)}}catch(f){l.e(f)}finally{l.f()}}}catch(f){r.e(f)}finally{r.f()}}return e}),[]),a(c),e.next=19;break;case 16:e.prev=16,e.t0=e.catch(0),console.log(e.t0);case 19:case"end":return e.stop()}}),e,null,[[0,16]])})));return function(t,n,a){return e.apply(this,arguments)}}(),Yn=function(){var e=Object(a.useState)(null),t=Object(j.a)(e,2),n=t[0],r=t[1];return Object(E.jsx)(V.a,{centered:!0,container:!0,children:Object(E.jsxs)(V.a.Row,{children:[Object(E.jsx)(V.a.Column,{width:8,children:Object(E.jsx)(ye,{table:"deployedJobs",columns:Vn,setSelected:r,reverse:!0})}),Object(E.jsxs)(V.a.Column,{width:8,children:[Object(E.jsx)("br",{}),Object(E.jsx)("br",{}),function(){if(null==n)return Object(E.jsx)("div",{style:{height:"6em"}});var e="https://ccs-amsterdam.github.io/ccs-annotator-client/?host=".concat(null===n||void 0===n?void 0:n.host,"&job_id=").concat(null===n||void 0===n?void 0:n.job_id),t=null===n||void 0===n?void 0:n.host.replace(":","%colon%"),a="https://ccs-amsterdam.github.io/ccs-annotator-client/?host=".concat(t,"&job_id=").concat(null===n||void 0===n?void 0:n.job_id);return Object(E.jsxs)("div",{style:{height:"6em"},children:[Object(E.jsx)("h3",{children:Object(E.jsx)("a",{href:e,children:"Open coding job"})}),Object(E.jsx)(G.a,{on:"click",hoverable:!0,trigger:Object(E.jsx)(O.a,{children:"Show QR code"}),children:Object(E.jsx)(Gn.a,{value:encodeURI(a),size:256})})]})}(),Object(E.jsx)(p.a,{children:"Current annotations"}),Object(E.jsx)(Hn,{jobKey:n})]})]})})},Qn=function(){var e=Object(d.a)(h.a.mark((function e(t,n,a){var r,i,c,o=arguments;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=o.length>3&&void 0!==o[3]&&o[3],e.next=3,mt(t,n);case 3:if(i=(i=e.sent).map((function(e){return{unit:e}})),c={title:t.name,provenance:{unitSettings:t.unitSettings,deploySettings:t.deploySettings},codebook:Nt(t.taskSettings),units:i,rules:{ruleset:"crowdcoding"}},!r){e.next=10;break}return e.next=9,z.idb.documents.where("job_id").equals(t.id).toArray();case 9:c.provenance.documents=e.sent;case 10:a(c);case 11:case"end":return e.stop()}}),e)})));return function(t,n,a){return e.apply(this,arguments)}}(),Kn=function(e){var t,n=e.codingjob,r=Object(a.useState)(null),i=Object(j.a)(r,2),c=i[0],o=i[1],s=Ot(n),l=Object(j.a)(s,1)[0];Object(a.useEffect)((function(){if(l&&0!==l.length&&null!==n&&void 0!==n&&n.unitSettings&&null!==n&&void 0!==n&&n.taskSettings&&null!==n&&void 0!==n&&n.deploySettings){var e="file"===n.deploySettings.medium;Qn(n,l,o,e)}}),[n,l,o]);return n?Object(E.jsx)("div",{children:Object(E.jsxs)(V.a,{centered:!0,stackable:!0,columns:2,children:[Object(E.jsxs)(V.a.Column,{width:5,children:[Object(E.jsx)(p.a,{textAlign:"center",style:{background:"#1B1C1D",color:"white"},children:"Deploy Codingjob"}),Object(E.jsx)(zn,{codingjob:n}),Object(E.jsx)("br",{}),function(e){if(!e)return null;switch(n.deploySettings.medium){case"file":return Object(E.jsx)(Ln,{codingjobPackage:c});case"amcat":return Object(E.jsx)(Pn,{codingjobPackage:c});default:return null}}(null===n||void 0===n||null===(t=n.deploySettings)||void 0===t?void 0:t.medium)]}),function(){var e;return null!==n&&void 0!==n&&null!==(e=n.deploySettings)&&void 0!==e&&e.medium&&"amcat"===n.deploySettings.medium?Object(E.jsxs)(V.a.Column,{width:11,children:[Object(E.jsx)(p.a,{textAlign:"center",style:{background:"#1B1C1D",color:"white"},children:"Jobs deployed on AmCAT"}),Object(E.jsx)(Yn,{})]}):null}()]})}):null},Xn=function(){var e,t,n,r,i,c,o,s,l=Object(a.useState)("codingjobs"),u=Object(j.a)(l,2),d=u[0],b=u[1],h=Object(a.useState)(null),f=Object(j.a)(h,2),p=f[0],O=f[1];console.log(p);var x=Object(ue.useLiveQuery)((function(){return p?z.idb.codingjobs.get(p.id).then((function(e){return Object(v.a)(Object(v.a)({},e),{},{ROW_ID:p.ROW_ID})})).catch((function(e){console.log(e)})):null}),[p]),g=Object(ue.useLiveQuery)((function(){return null!==x&&void 0!==x&&x.id?z.idb.documents.where("job_id").equals(x.id).count():0}),[x]);return Object(E.jsxs)("div",{style:{margin:"1em"},children:[Object(E.jsxs)(le.a.Group,{ordered:!0,unstackable:!0,size:"tiny",style:{width:"100%",overflow:"auto"},children:[Object(E.jsx)(le.a,{title:"Codingjob",description:x?x.name:"none selected",active:"codingjobs"===d,completed:null!==x&&null!=x,onClick:function(e,t){b("codingjobs")}}),Object(E.jsx)(le.a,{title:"Documents",description:g>0?"".concat(g," documents"):"",active:"documents"===d,completed:g>0,disabled:null===x,onClick:function(e,t){return b("documents")}}),Object(E.jsx)(le.a,{title:"Units",description:null!==x&&void 0!==x&&null!==(e=x.unitSettings)&&void 0!==e&&e.n?"".concat(null===x||void 0===x||null===(t=x.unitSettings)||void 0===t?void 0:t.n," units ").concat(null!==x&&void 0!==x&&x.unitSettings.annotationMix?"(+random)":""):null,active:"units"===d,completed:!(null===x||void 0===x||null===(n=x.unitSettings)||void 0===n||!n.n),disabled:0===g,onClick:function(e,t){return b("units")}}),Object(E.jsx)(le.a,{title:"Codebook",description:(null===x||void 0===x||null===(r=x.taskSettings)||void 0===r?void 0:r.type)||"Define the task",active:"task"===d,completed:!(null===x||void 0===x||null===(i=x.taskSettings)||void 0===i||!i.type),disabled:!(null!==x&&void 0!==x&&null!==(c=x.unitSettings)&&void 0!==c&&c.n),onClick:function(e,t){return b("task")}}),Object(E.jsx)(le.a,{title:"Deploy",description:"Get (others) to work",active:"deploy"===d,disabled:null===x||!(null!==x&&void 0!==x&&null!==(o=x.unitSettings)&&void 0!==o&&o.n)||!(null!==x&&void 0!==x&&null!==(s=x.taskSettings)&&void 0!==s&&s.type),onClick:function(e,t){return b("deploy")}})]}),Object(E.jsx)(J.a,{style:{border:"0"},attached:"bottom",children:function(e){switch(e){case"codingjobs":return Object(E.jsx)(qe,{setSelectedCodingjob:O});case"documents":return Object(E.jsx)(Ye,{codingjob:x});case"units":return Object(E.jsx)(Et,{codingjob:x});case"task":return Object(E.jsx)(Fn,{codingjob:x});case"deploy":return Object(E.jsx)(Kn,{codingjob:x});default:return null}}(d)})]})},$n=r.a.memo(Xn),Zn=function(){function e(t,n){Object(y.a)(this,e),this.amcat=t,this.job_id=n,this.where="remote"}return Object(k.a)(e,[{key:"init",value:function(){var e=Object(d.a)(h.a.mark((function e(){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.amcat.getCodebook(this.job_id);case 3:return this.codebook=e.sent,e.next=6,this.amcat.getProgress(this.job_id);case 6:this.progress=e.sent,e.next=14;break;case 9:return e.prev=9,e.t0=e.catch(0),console.log(e.t0),this.success=!1,e.abrupt("return");case 14:this.success=!0;case 15:case"end":return e.stop()}}),e,this,[[0,9]])})));return function(){return e.apply(this,arguments)}}()},{key:"getUnit",value:function(){var e=Object(d.a)(h.a.mark((function e(t){var n;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t>=this.progress.n_coded&&!this.progress.seek_forwards,this.progress.n_coded=Math.max(t,this.progress.n_coded),e.next=4,this.amcat.getUnit(this.job_id,n?null:t);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"postAnnotations",value:function(e,t,n){this.amcat.postAnnotation(this.job_id,e,t,n)}}]),e}(),ea=function(){function e(t,n){Object(y.a)(this,e),this.id=t,this.coderName=n,this.where="local"}return Object(k.a)(e,[{key:"init",value:function(){var e=Object(d.a)(h.a.mark((function e(){var t;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,z.idb.localJobs.get({id:this.id});case 2:if(t=e.sent){e.next=6;break}return this.success=!1,e.abrupt("return",null);case 6:this.success=!0,this.title=t.title,this.units=t.units,this.set=t.set,this.codebook=t.codebook,this.progress={n_total:t.units.length,n_coded:t.n_coded||0,seek_backwards:!0,seek_forwards:!1};case 12:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getUnit",value:function(){var e=Object(d.a)(h.a.mark((function e(t){var n,a,r,i,c;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null===t){e.next=4;break}return this.progress.n_coded=Math.max(t,this.progress.n_coded),e.next=4,z.idb.localJobs.where("id").equals(this.id).modify({n_coded:Math.max(t,this.progress.n_coded),last_modified:new Date});case 4:return r=this.units[t].unit_id,e.next=7,z.getUnitAnnotations(this.id,r);case 7:return i=e.sent,c=null===(n=i)||void 0===n?void 0:n.status,i=(null===(a=i)||void 0===a?void 0:a.annotations)||[],e.abrupt("return",{id:r,unit:Object(v.a)({},this.units[t]),annotation:i,status:c});case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"postAnnotations",value:function(){var e=Object(d.a)(h.a.mark((function e(t,n,a){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:z.postAnnotations(this.id,t,n,a);case 1:case"end":return e.stop()}}),e,this)})));return function(t,n,a){return e.apply(this,arguments)}}()}]),e}(),ta=(n(591),function(){var e=Object(d.a)(h.a.mark((function e(t,n,a,r){var i,c,o,s,l;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c=new URL(t),o=te(c.origin,null===n||void 0===n||null===(i=n.amcat)||void 0===i?void 0:i.token),e.prev=2,e.next=5,o.getToken();case 5:e.next=10;break;case 7:e.prev=7,e.t0=e.catch(2),r(Object(E.jsx)(oe,{host:c.origin,force:!0}));case 10:return s=c.pathname.split("/").slice(-1)[0],l=new Zn(o,s),e.next=14,l.init();case 14:l.success&&a(l);case 15:case"end":return e.stop()}}),e,null,[[2,7]])})));return function(t,n,a,r){return e.apply(this,arguments)}}()),na=function(){var e=Object(d.a)(h.a.mark((function e(t,n,a){var r;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=new ea(t,null===n||void 0===n?void 0:n.email,null===n||void 0===n?void 0:n.token),e.next=3,r.init();case 3:r.success&&a(r);case 4:case"end":return e.stop()}}),e)})));return function(t,n,a){return e.apply(this,arguments)}}(),aa=function(e){return e.search.substring(1).split("&").reduce((function(e,t){var n=t.split("="),a=Object(j.a)(n,2),r=a[0],i=a[1];return e[decodeURIComponent(r)]=decodeURIComponent(i),e}),{})},ra=[{name:"title"},{name:"set"},{name:"progress",f:function(e){return"".concat(e.n_coded||0," / ").concat(e.units.length)}},{name:"last_modified"},{name:"id",hide:!0}],ia=function(){var e=Object(o.f)(),t=Object(a.useState)(null),n=Object(j.a)(t,2),r=n[0],i=n[1],c=function(){var t=Object(d.a)(h.a.mark((function t(){return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.push("/annotator?id="+r.id);case 1:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();return Object(E.jsxs)(E.Fragment,{children:[Object(E.jsx)(p.a,{textAlign:"center",style:{background:"#1B1C1D",color:"white"},children:"Your codingjobs"}),Object(E.jsx)(O.a,{fluid:!0,primary:!0,disabled:!r,onClick:c,children:"Open selected codingjob"}),Object(E.jsx)("br",{}),Object(E.jsx)("br",{}),Object(E.jsx)(ye,{table:"localJobs",columns:ra,setSelected:i,searchOn:"title"})]})},ca=function(e){var t=e.split(".");return t[t.length-1]},oa=function(){var e=function(){var e=Object(d.a)(h.a.mark((function e(t){var n,a,r,i,c;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=new FileReader,a=t.target.files[0],"json"===(r=ca(a.name))&&(n.readAsText(a,"UTF-8"),n.onload=function(e){var t=S()(e.target.result);z.createLocalJob(JSON.parse(e.target.result),t)}),"zip"!==r){e.next=10;break}return i=new Mn.a,e.next=8,i.loadAsync(a);case 8:(c=e.sent).forEach(function(){var e=Object(d.a)(h.a.mark((function e(t,n){var a,r;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("set"===n.name.slice(0,3)){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,c.file(n.name).async("text");case 4:a=e.sent,r=S()(a),z.createLocalJob(JSON.parse(a),r);case 7:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}());case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(E.jsxs)(V.a,{centered:!0,stackable:!0,container:!0,style:{marginTop:"5em"},children:[Object(E.jsxs)(V.a.Column,{style:{textAlign:"center"},width:8,children:[Object(E.jsx)(p.a,{textAlign:"center",style:{background:"#1B1C1D",color:"white"},children:"Read codingjob"}),Object(E.jsx)("input",{type:"file",accept:".json,.zip",onChange:e}),Object(E.jsx)("div",{children:Object(E.jsx)("br",{})})]}),Object(E.jsx)(V.a.Column,{width:8,children:Object(E.jsx)(ia,{})})]})},sa=[{label:"Annotator",path:"/annotator",Component:function(){var e=Object(o.g)(),t=Object(a.useState)(null),n=Object(j.a)(t,2),r=n[0],i=n[1],c=Object(a.useState)(null),s=Object(j.a)(c,2),l=s[0],u=s[1],d=Object(Y.a)(["amcat"]),b=Object(j.a)(d,1)[0];return Object(a.useEffect)((function(){if(e.search){var t=aa(e);null!==t&&void 0!==t&&t.url&&ta(t.url,b,i,u),t.id&&na(t.id,b,i,u)}else i(null)}),[e,b,i]),r?Object(E.jsx)("div",{style:{height:"100vh",width:"100vw"},children:Object(E.jsx)(A.a,{jobServer:r})}):l},menu:!1},{label:"Jobs",path:"/jobs",Component:oa,menu:!0},{label:"Codingjob manager",path:"/manager",Component:$n,menu:!0}],la=function(){return Object(E.jsx)(s.a,{basename:"/",children:Object(E.jsx)(se,{items:sa,children:Object(E.jsxs)(o.c,{children:[Object(E.jsx)(o.a,{exact:!0,path:"/",render:function(){return Object(E.jsx)($n,{})}}),(e=sa,e.map((function(e){return Object(E.jsx)(o.a,{exact:!0,path:e.path,render:function(){return Object(E.jsx)(e.Component,{})}})})))]})})});var e},ua=n(278),da=Object(ua.a)({eventsBlocked:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1?arguments[1]:void 0;return"BLOCK_EVENTS"===t.type?t.block:e},fullScreenNode:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0;return"SET_FULL_SCREEN_NODE"===t.type?t.node:e}}),ja=da,ba=n(368),ha=Object(ua.b)(ja);c.a.render(Object(E.jsx)(r.a.StrictMode,{children:Object(E.jsx)(ba.a,{children:Object(E.jsx)(K.a,{store:ha,children:Object(E.jsx)(la,{})})})}),document.querySelector("#root"))}},[[592,1,2]]]);
//# sourceMappingURL=main.6c8461f6.chunk.js.map