(this.webpackJsonpCCS_annotator=this.webpackJsonpCCS_annotator||[]).push([[0],{205:function(e,t,n){},276:function(e,t){},278:function(e,t){},294:function(e,t){},302:function(e,t,n){"use strict";n.r(t);n(238);var r=n(1),a=n.n(r),i=n(59),o=n.n(i),c=n(18),s=n(117),l=n(336),u=n(340),d=n(7),j=n.n(d),b=n(12),f=n(4),h=n(332),p=n(337),v=n(181),O=n(55),x=n(13),g=n(3),m=n(48),y=n(20),k=n(24),w=n(119),C=n(38),S=n.n(C),_=n(16),A=n(180),I=n(213);A.a.extend(I.a);var R=function(e){var t,n=[],r=null,a=0,i=0,o=0,c=null,s=null,l=!1,u=Object(x.a)(e);try{for(u.s();!(t=u.n()).done;){null!=t.value.unit_start&&(l=!0)}}catch(w){u.e(w)}finally{u.f()}var d,j=!l,b=!1,f=Object(x.a)(e);try{for(f.s();!(d=f.n()).done;){var h=d.value,p=h.name||"text",v=h.offset||0;s=h.value,c=A.a.tokenize(s).paragraphs().json({offset:!0});for(var O=0;O<c.length;O++){for(var g=0;g<c[O].sentences.length;g++){for(var m=0;m<c[O].sentences[g].length;m++)for(var y=0;y<c[O].sentences[g][m].terms.length;y++){r=c[O].sentences[g][m].terms[y],null!=h.unit_start&&r.offset.start+v>=h.unit_start&&(j=!0),null!=h.unit_end&&r.offset.start+v>h.unit_end&&(b=!0);var k={section:p,offset:r.offset.start+v,length:r.offset.length,paragraph:a,sentence:i,index:o,text:r.text,pre:r.pre,post:r.post,codingUnit:j&!b};n.push(k),o++}i++}a++}}}catch(w){f.e(w)}finally{f.f()}return n},E=function(e){for(var t=0,n=(e=T(e))[0].paragraph,r=0,a=e[0].sentence,i=0,o=0,c=0;c<e.length;c++){var s;if(null==e[c].text){if(null==e[c].token)return alert("Invalid token data:\n\nimported tokens must have 'text' or 'token' field"),null;e[c].text=e[c].token}if(null==e[c].offset&&null!=e[c].start&&(e[c].offset=e[c].start),null==e[c].length&&(e[c].length=e[c].text.length),null==e[c].pre&&(e[c].pre=""),null==e[c].post&&null!=e[c].space&&(e[c].post=e[c].space),null==e[c].post&&(null!=e[c].offset&&null!=e[c].length?e[c].post=c<e[c].length-1?" ".repeat(Math.max(0,e[c+1].offset-e[c].offset-e[c].length)):"":e[c].post=" "),o=e[c].length+e[c].post.length,c<e.length-1&&(o+=(null===(s=e[c+1].pre)||void 0===s?void 0:s.length)||0),null==e[c].offset&&(e[c].offset=i,i+=o),c<e.length-1&&(!e[c].section||e[c].section===e[c+1].section)&&(null==e[c+1].offset&&null!=e[c+1].start&&(e[c+1].offset=e[c+1].start),e[c+1].offset&&e[c+1].offset<e[c].offset+o))return alert('Invalid token position data. The length of "'.concat(e[c].pre+e[c].text+e[c].post,'" on position ').concat(e[c].offset," exeeds the offset/start position of the next token")),null;null==e[c].sentence?(e[c].sentence=r,(e[c].text.includes("\n")||e[c].post.includes("\n"))&&r++):(e[c].paragraph===n&&e[c].sentence===a||(a=e[c].sentence,r++),e[c].sentence=r),null==e[c].paragraph?(e[c].paragraph=t,(e[c].text.includes("\n")||e[c].post.includes("\n"))&&t++):(e[c].paragraph!==n&&(n=e[c].paragraph,t++),e[c].paragraph=t),null==e[c].section&&(e[c].section="text"),e[c].index=c}return e},z=function(e,t){if(0===e.length)return[];for(var n=[],r={},a=e[0].section,i=0;i<e.length;i++)if(e[i].annotations){var o,c={},s=Object(x.a)(e[i].annotations);try{for(s.s();!(o=s.n()).done;){var l=o.value;if(""!==l.value){t[l.name]||(t[l.name]=new Set),t[l.name].add(l.value),c[l.name]=l.value;var u=i>0?e[i-1].post:"";null==r[l.name]&&(r[l.name]={index:i,variable:l.name,value:l.value,offset:e[i].offset,text:e[i].text,section:e[i].section,length:e[i].length}),r[l.name].value===l.value&&(r[l.name].length=e[i].offset+e[i].length-r[l.name].offset,r[l.name].text+=u+e[i].pre+e[i].post)}}}catch(w){s.e(w)}finally{s.f()}for(var d=0,j=Object.keys(r);d<j.length;d++){var b=j[d];null!=c[b]?c[b]!==r[b].value&&(n.push(r[b]),r[b]={index:i,variable:b,value:c[b],offset:e[i].offset,text:e[i].text,section:e[i].section,length:e[i].length}):(n.push(r[b]),delete r[b])}if(i<e.length-1&&e[i+1].section!==a){for(var f=0,h=Object.values(r);f<h.length;f++){var p=h[f];n.push(p)}r={},a=e[i].section}else;}else{for(var v=0,O=Object.values(r);v<O.length;v++){var g=O[v];n.push(g)}r={}}for(var m=0,y=Object.values(r);m<y.length;m++){var k=y[m];n.push(k)}return n},T=function(e){if(Array.isArray(e))return e;for(var t=Object.keys(e),n=e[t[0]].length,r=[],a=function(n){var a=t.reduce((function(t,r){return t[r]=e[r][n],t}),{});r.push(a)},i=0;i<n;i++)a(i);return r},D=function(e){if(!Array.isArray(e))return e;var t,n={},r=Object(x.a)(e);try{for(r.s();!(t=r.n()).done;)for(var a=t.value,i=0,o=Object.keys(a);i<o.length;i++){var c=o[i];n[c]||(n[c]=[]),n[c].push(a[c])}}catch(s){r.e(s)}finally{r.f()}return n},q=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(0===Object.keys(e).length)return[];var r=Object.keys(e).reduce((function(r,a){for(var i=e[a],o=0,c=Object.keys(i);o<c.length;o++){var s=c[o];if("unit"===a||i[s].index===i[s].span[0]){var l={variable:s,value:i[s].value,section:i[s].section,offset:i[s].offset,length:i[s].length};if(n){var u=i[s].span,d=t.slice(u[0],u[1]+1).map((function(e){return e.pre+e.text+e.post})).join("");l.text=d}r.push(l)}}return r}),[]);return r},F=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(0===e.length)return Object(g.a)({},n);var r,a=U(e),i={},o=[],c=Object(x.a)(t);try{for(c.s();!(r=c.n()).done;){var s=r.value;P(s,a,i,o)}}catch(C){c.e(C)}finally{c.f()}for(var l={},u=[],d=0,j=o;d<j.length;d++){var b=j[d];l[b.variable]||(l[b.variable]=0),l[b.variable]++,u.push(b)}for(var f=[],h=0,p=u;h<p.length;h++)for(var v=p[h],O=v.span[0];O<=v.span[1];O++){var m=Object(g.a)({},v);m.index=O,f.push(m)}for(var y=0,k=u;y<k.length;y++){var w=k[y];n=N(n,w,!1)}return n},N=function(e,t,n){for(var r=t.span[0];r<=t.span[1];r++){var a=t;if(e[r]&&e[r][a.variable])for(var i=e[r][a.variable].span,o=i[0];o<=i[1];o++)e[o]&&e[o][a.variable]&&(delete e[o][a.variable],0===Object.keys(e[o]).length&&delete e[o]);n||(e[r]||(e[r]={}),e[r][a.variable]={index:r,span:[a.span[0],a.span[1]],length:a.length,value:a.value,section:a.section,offset:a.offset})}return e},U=function(e){return e&&""!==e?e.reduce((function(e,t){return e[t.section]||(e[t.section]={}),e[t.section][t.offset]||(e[t.section][t.offset]={start:[],end:[]}),e[t.section][t.offset+t.length-1]||(e[t.section][t.offset+t.length-1]={start:[],end:[]}),e[t.section][t.offset].start.push(t),e[t.section][t.offset+t.length-1].end.push(t.variable),e}),{}):{}},P=function(e,t,n,r){var a=e.offset,i=e.offset+e.length-1;if(t[e.section])for(var o=t[e.section],c=a;c<=i;c++)if(o[c]){var s,l=Object(x.a)(o[c].start);try{for(l.s();!(s=l.n()).done;){var u=s.value;n[u.variable]=Object(g.a)({},e),n[u.variable].variable=u.variable,n[u.variable].value=u.value,n[u.variable].offset=a,n[u.variable].length=null,n[u.variable].span=[e.index]}}catch(f){l.e(f)}finally{l.f()}var d,j=Object(x.a)(o[c].end);try{for(j.s();!(d=j.n()).done;){var b=d.value;n[b]&&(n[b].span.push(e.index),n[b].length=e.offset+e.length-n[b].offset,r.push(n[b]),delete n[b])}}catch(f){j.e(f)}finally{j.f()}}},L=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"TEMP",r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=new Set(t),i=0,o=0,c={},s=e.reduce((function(e,t){if(null==t.document_id)return e;i++;var r=S()([t,n]);return a.has(r)?o++:(a.add(r),e.push(Object(g.a)({doc_uid:r,job_id:n},M(t,c)))),e}),[]);if(!r){var l="Created ".concat(i-o," new documents.");o>0&&(l+=" Ignored ".concat(o," duplicates")),alert(l)}return[s,c]},M=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=Object(g.a)({},e);n.tokens?(n.importedTokens=!0,n.tokens=E(e.tokens)):(n.importedTokens=!1,!n.text_fields&&n.text&&(n.text_fields=[{name:"text",value:n.text}]),n.tokens=R(Object(_.a)(n.text_fields))),n.meta_fields=e.meta_fields||[],n.tokens.length>0?(n.n_paragraphs=n.tokens[n.tokens.length-1].paragraph,n.n_sentences=n.tokens[n.tokens.length-1].sentence):(n.n_paragraphs=0,n.n_sentences=0),n.annotations?n.annotations=F(Object(_.a)(n.annotations),n.tokens):n.annotations={};var r=z(n.tokens,t);return r.length>0&&(n.annotations=F(r,n.tokens,n.annotations)),n},H=n(174),G=n.n(H),B=function(e){var t=Object(g.a)({type:e.type},e[e.type]);return"annotate"===e.type&&(t.variables=t.variables.filter((function(e){return null==e.enabled||!0===e.enabled}))),t},W=function(e){return e.map((function(e,t){return"object"!==typeof e&&(e={code:e}),null==e.active&&(e.active=!0),null==e.tree&&(e.tree=[]),null==e.parent&&(e.parent=""),null==e.makes_irrelevant&&(e.makes_irrelevant=[]),"object"!==typeof e.makes_irrelevant&&(e.makes_irrelevant=[e.makes_irrelevant]),null==e.required_for&&(e.required_for=[]),"object"!==typeof e.required_for&&(e.required_for=[e.required_for]),null==e.color&&(e.color=G()({seed:e.code,luminosity:"light"})),e}))},V=function(e){for(var t=W(e).reduce((function(e,t){return e[t.code]=Object(g.a)(Object(g.a)({},t),{},{children:[],totalChildren:0,totalActiveChildren:0}),e}),{}),n=0,r=Object.keys(t);n<r.length;n++){var a=r[n];""===t[a].parent||t[t[a].parent]||(t[t[a].parent]={code:t[a].parent,parent:"",children:[],active:!1,totalChildren:0,totalActiveChildren:0})}for(var i=0,o=Object.keys(t);i<o.length;i++){var c=o[i],s=Y(t,c),l=Object(f.a)(s,3);t[c].tree=l[0],t[c].activeParent=l[1],t[c].foldToParent=l[2],t[c].parent&&t[t[c].parent].children.push(c);var u,d=Object(x.a)(t[c].tree);try{for(d.s();!(u=d.n()).done;){var j=u.value;t[j].totalChildren++,t[c].active&&t[c].activeParent&&t[j].totalActiveChildren++}}catch(b){d.e(b)}finally{d.f()}}return t},J=function(e,t){var n=Object.keys(e).filter((function(t){return!e[t].parent||""===e[t].parent})),r=[];return K(e,n,r,[],t),r.map((function(e,t){return Object(g.a)(Object(g.a)({},e),{},{i:t})}))},K=function e(t,n,r,a,i){var o,c=Object(x.a)(n);try{for(c.s();!(o=c.n()).done;){var s=o.value,l=Object(_.a)(a);l.push(s),r.push(Object(g.a)(Object(g.a)({},t[s]),{},{code:s,codeTrail:a,level:a.length,color:t[s].color?t[s].color:G()({seed:s,luminosity:"light"})})),t[s].children&&e(t,t[s].children,r,l,i)}}catch(u){c.e(u)}finally{c.f()}},Y=function(e,t){for(var n=[],r=!0,a="",i=e[t].parent;i;)n.push(i),null!=e[i].folded&&e[i].folded&&(a=i,null==e[i].active||e[i].active||(r=!1)),i=e[i].parent;return[n.reverse(),r,a]},Q=function(e,t,n,r){var a,i=n.reduce((function(e,t){return"object"===typeof t?(e[t.code]=1,e[t.parent]=1):e[t]=1,e}),{}),o=[],c=Object(_.a)(n),s={},l=e.split("\n"),u=Object(x.a)(l);try{var d=function(){for(var e=a.value,n=e.search(/\S/),l=e,u=0,d=["color","disabled","folded","irrelevant"];u<d.length;u++){var j=d[u];l=l.split("#".concat(j))[0].trim()}if(""===l)return"continue";i[l]&&o.push(l),i[l]=1;var b={code:l,frozen:r.some((function(e){return e.code===l})),parent:X(s,t,l,n),active:!e.includes("#disabled"),folded:e.includes("#folded")};if(e.includes("#irrelevant")){var f=e.split("#irrelevant(")[1].split(")")[0];b.makes_irrelevant=f.split(",")}if(e.includes("#color")){var h=e.split("#color(")[1].split(")")[0];b.color=Z(h)}c.push(b)};for(u.s();!(a=u.n()).done;)d()}catch(h){u.e(h)}finally{u.f()}var j,b=Object(x.a)(r);try{var f=function(){var e=j.value;if(c.some((function(t){return t.code===e.code})))return"continue";e.parent="",c.push(e)};for(b.s();!(j=b.n()).done;)f()}catch(h){b.e(h)}finally{b.f()}return[c,o]},X=function(e,t,n,r){for(var a=t,i=0,o=Object.keys(e);i<o.length;i++){var c=o[i];r>(c=Number(c))?a=e[c]:(delete e[c],e[r]=n)}return e[r]=n,a},Z=function(e){if(!e)return"#FFFFFF";var t=document.createElement("canvas").getContext("2d");return t.fillStyle=e.trim(),t.fillStyle},$="CSSannotator_V1",ee={codingjobs:"job_id, name",documents:"doc_uid, job_id",tasks:"[title+url], last_modified, url",deployedJobs:"url",localJobs:"[title+id], last_modified, id",localAnnotations:"[id+unit_id], id"},te=function(){function e(){Object(y.a)(this,e),this.idb=new w.default($);try{this.idb.version(2).stores(ee)}catch(t){this.idb.delete(),this.idb=new w.default($),this.idb.version(2).stores(ee)}}return Object(k.a)(e,[{key:"createCodingjob",value:function(){var e=Object(b.a)(j.a.mark((function e(t){var n,r=arguments;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n=r.length>1&&void 0!==r[1]?r[1]:null)||(n=S()([t,Date.now().toString()])),this.idb.codingjobs.add({job_id:n,name:t}),e.abrupt("return",{job_id:n,name:t});case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"deleteCodingjob",value:function(){var e=Object(b.a)(j.a.mark((function e(t){var n;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.idb.documents.where("job_id").equals(t.job_id);case 2:return n=e.sent,e.next=5,n.count();case 5:return e.sent>0&&n.delete(),e.abrupt("return",this.idb.codingjobs.delete(t.job_id));case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getCodingjobProp",value:function(){var e=Object(b.a)(j.a.mark((function e(t,n){var r;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.idb.codingjobs.get(t.job_id);case 2:return r=e.sent,e.abrupt("return",r[n]);case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"setCodingjobProp",value:function(){var e=Object(b.a)(j.a.mark((function e(t,n,r){var a;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.idb.codingjobs.get(t.job_id);case 2:return null==(a=e.sent).settings&&(a.settings={}),e.abrupt("return",this.idb.codingjobs.where("job_id").equals(t.job_id).modify(Object(m.a)({},n,r)));case 5:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"createDocuments",value:function(){var e=Object(b.a)(j.a.mark((function e(t,n){var r,a,i,o,c,s,l,u=arguments;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=u.length>2&&void 0!==u[2]&&u[2],e.t0=Set,e.next=4,this.idb.documents.where("job_id").equals(t.job_id).primaryKeys();case 4:return e.t1=e.sent,a=new e.t0(e.t1),i=L(n,a,t.job_id,r),o=Object(f.a)(i,2),c=o[0],s=o[1],e.next=9,this.getCodingjobProp(t,"importedCodes");case 9:return l=e.sent,l=ne(t,l,s),this.idb.codingjobs.where("job_id").equals(t.job_id).modify({importedCodes:l}),e.abrupt("return",this.idb.documents.bulkAdd(c));case 13:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"deleteDocuments",value:function(){var e=Object(b.a)(j.a.mark((function e(t){var n;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.map((function(e){return e.doc_uid})),e.abrupt("return",this.idb.documents.bulkDelete(n));case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getJobDocuments",value:function(){var e=Object(b.a)(j.a.mark((function e(t,n,r){var a,i;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(null!==n&&n<0)){e.next=2;break}return e.abrupt("return",null);case 2:return e.next=4,this.idb.documents.where("job_id").equals(t.job_id);case 4:return a=e.sent,e.next=7,a.count();case 7:if(i=e.sent,!(null!==n&&n>i-1)){e.next=10;break}return e.abrupt("return",null);case 10:return null!==r&&(a=a.offset(n).limit(r)),e.abrupt("return",a.toArray());case 12:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"getJobDocumentCount",value:function(){var e=Object(b.a)(j.a.mark((function e(t){return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.idb.documents.where("job_id").equals(t.job_id).count());case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getDocuments",value:function(){var e=Object(b.a)(j.a.mark((function e(t){return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.idb.documents.where("job_id").equals(t.job_id));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getDocument",value:function(){var e=Object(b.a)(j.a.mark((function e(t){return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.idb.documents.get(t));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"writeTokens",value:function(){var e=Object(b.a)(j.a.mark((function e(t,n){return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.idb.documents.where("doc_uid").equals(t.doc_uid).modify({tokens:n}));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"createDeployedJob",value:function(){var e=Object(b.a)(j.a.mark((function e(t,n){return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.idb.deployedJobs.get({url:n});case 2:e.sent?this.idb.deployedJobs.get({url:n}).modify({created:new Date}):this.idb.deployedJobs.add({title:t,url:n,created:new Date});case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"createLocalJob",value:function(){var e=Object(b.a)(j.a.mark((function e(t,n){return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.idb.localJobs.get({id:n});case 2:e.sent?alert("This job has already been created before"):this.idb.localJobs.add(Object(g.a)(Object(g.a)({},t),{},{id:n,last_modified:new Date}));case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getUnitAnnotations",value:function(){var e=Object(b.a)(j.a.mark((function e(t,n){return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.idb.localAnnotations.get({id:t,unit_id:n}));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getAllAnnotations",value:function(){var e=Object(b.a)(j.a.mark((function e(t){return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.idb.localAnnotations.where("id").equals(t).toArray());case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"postAnnotations",value:function(){var e=Object(b.a)(j.a.mark((function e(t,n,r){return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.idb.localAnnotations.put({unit_id:n,id:t,annotations:r},[t,n]));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"deleteDB",value:function(){var e=Object(b.a)(j.a.mark((function e(){return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.idb.delete();case 2:this.idb=new w.default($),this.idb.version(2).stores(ee),window.location.reload(!1);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}(),ne=function(e,t,n){var r=Object.keys(n).reduce((function(e,t){var r=W(Array.from(n[t]));return e[t]=r.map((function(e){return Object(g.a)(Object(g.a)({},e),{},{frozen:!0})})),e}),{});if(!t)return r;for(var a=0,i=Object.keys(r);a<i.length;a++){var o=i[a];if(t[o]){var c,s=Object(x.a)(r[o]);try{var l=function(){var e=c.value;t[o].some((function(t){return t.code===e.code}))||t[o].push(e)};for(s.s();!(c=s.n()).done;)l()}catch(u){s.e(u)}finally{s.f()}}else t[o]=r[o]}return t},re=new te,ae=n(0),ie=function(){var e=Object(r.useState)(!1),t=Object(f.a)(e,2),n=t[0],a=t[1],i=Object(c.f)(),o=function(){var e=Object(b.a)(j.a.mark((function e(){return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,re.deleteDB();case 3:a(!1),i.push("/"),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),console.log(e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(){return e.apply(this,arguments)}}();return Object(ae.jsxs)(h.a,{closeIcon:!0,open:n,trigger:Object(ae.jsx)(l.a.Item,{icon:"rocket",name:"Reset",style:{color:"#d7a3a3"}}),onClose:function(){return a(!1)},onOpen:function(){return a(!0)},children:[Object(ae.jsx)(p.a,{icon:"power off",content:"Reset Annotator Database"}),Object(ae.jsx)(h.a.Content,{children:Object(ae.jsx)("p",{children:"This will remove all document and annotation data from your browser. Any annotations that have not been saved/synchronized will be lost. Are you absolutely sure?"})}),Object(ae.jsxs)(h.a.Actions,{children:[Object(ae.jsxs)(v.a,{color:"red",onClick:function(){a(!1)},children:[Object(ae.jsx)(O.a,{name:"remove"})," No"]}),Object(ae.jsxs)(v.a,{color:"green",onClick:o,children:[Object(ae.jsx)(O.a,{name:"checkmark"})," Yes"]})]})]})};function oe(){return ce.apply(this,arguments)}function ce(){return(ce=Object(b.a)(j.a.mark((function e(){return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,navigator.storage;case 2:if(e.t0=e.sent,!e.t0){e.next=5;break}e.t0=navigator.storage.persist;case 5:if(!e.t0){e.next=9;break}e.t1=navigator.storage.persist(),e.next=10;break;case 9:e.t1=void 0;case 10:return e.abrupt("return",e.t1);case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function se(){return le.apply(this,arguments)}function le(){return(le=Object(b.a)(j.a.mark((function e(){return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,navigator.storage;case 2:if(e.t0=e.sent,!e.t0){e.next=5;break}e.t0=navigator.storage.persisted;case 5:if(!e.t0){e.next=9;break}e.t1=navigator.storage.persisted(),e.next=10;break;case 9:e.t1=void 0;case 10:return e.abrupt("return",e.t1);case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var ue=function(){var e=Object(r.useState)(!1),t=Object(f.a)(e,2),n=t[0],a=t[1],i=Object(r.useState)(!1),o=Object(f.a)(i,2),c=o[0],s=o[1];Object(r.useEffect)((function(){c||se().then(s)}),[c]);var u=function(){var e=Object(b.a)(j.a.mark((function e(){return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,oe();case 2:return e.next=4,se();case 4:e.sent?(s(!0),alert("indexedDB set to persistent for AmCAT Annotator")):alert("Failed to set indexedDB to persistent");case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return c?null:Object(ae.jsxs)(h.a,{closeIcon:!0,open:n,trigger:Object(ae.jsx)(l.a.Item,{icon:"database",name:"Enable persitance",style:{color:"#d7a3a3"}}),onClose:function(){return a(!1)},onOpen:function(){return a(!0)},children:[Object(ae.jsx)(p.a,{icon:"database",content:"Set database persistence"}),Object(ae.jsxs)(h.a.Content,{children:[Object(ae.jsx)("p",{children:"We did not have permission to automatically make the data storage for this website persistent. This means that the data could be removed automatically by your browser if it needs to free up space for another website. You can try to set this manually here, but not all browsers support this (yet)."}),Object(ae.jsx)("p",{children:"If the database is not persistent the app can still be used, but you need to be more carefull in making sure that data is regularly backed up, either by manually downloading data or syncing with some backend (work in progress)."})]}),Object(ae.jsx)(h.a.Actions,{children:Object(ae.jsxs)(v.a,{onClick:u,children:[Object(ae.jsx)(O.a,{name:"checkmark"})," Yes"]})})]})},de=n(84),je=n.n(de);function be(e,t,n){return fe.apply(this,arguments)}function fe(){return(fe=Object(b.a)(j.a.mark((function e(t,n,r){var a;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,je.a.get("".concat(t,"/anno/auth/token/"),{auth:{username:n,password:r}});case 2:return a=e.sent,e.abrupt("return",a.data.token);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function he(e,t,n){return new pe(e,t,n)}var pe=function(){function e(t,n,r){Object(y.a)(this,e),this.host=t,this.email=n,this.api=je.a.create({baseURL:t,headers:{Authorization:"Bearer ".concat(r)}})}return Object(k.a)(e,[{key:"postCodingjob",value:function(e,t){return e.title=t,this.api.post("/codingjob",{title:t,units:e.units,codebook:e.codebook,provenance:e.provenance,rules:e.rules})}}]),e}(),ve=n(338),Oe=n(330),xe=n(339),ge=n(333),me=n(341),ye="blue",ke=function(e){var t=e.setOpen,n=e.setCookie,a=Object(r.useState)("https://amcat4.labs.vu.nl/api"),i=Object(f.a)(a,2),o=i[0],c=i[1],s=Object(r.useState)("admin"),l=Object(f.a)(s,2),u=l[0],d=l[1],h=Object(r.useState)("admin"),O=Object(f.a)(h,2),x=O[0],g=O[1],m=Object(r.useState)("idle"),y=Object(f.a)(m,2),k=y[0],w=y[1],C=function(){var e=Object(b.a)(j.a.mark((function e(){var r;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return w("waiting"),e.prev=1,e.next=4,be(o,u,x);case 4:(r=e.sent)?(n("amcat",JSON.stringify({host:o,email:u,token:r}),{path:"/"}),w("success"),t(!1)):w("error"),e.next=12;break;case 8:e.prev=8,e.t0=e.catch(1),console.log(e.t0),w("error");case 12:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(){return e.apply(this,arguments)}}();return Object(ae.jsx)(ve.a,{inverted:!0,textAlign:"center",style:{height:"50%"},verticalAlign:"middle",children:Object(ae.jsxs)(ve.a.Column,{style:{maxWidth:450},children:[Object(ae.jsx)(p.a,{as:"h2",color:ye,textAlign:"center",children:"Connect to AmCAT server"}),Object(ae.jsx)(Oe.a,{size:"large",children:Object(ae.jsxs)(xe.a,{stacked:!0,children:[Object(ae.jsx)(Oe.a.Input,{fluid:!0,error:"error"===k,value:o,onChange:function(e,t){var n=t.value;w("idle"),c(n)},icon:"home",iconPosition:"left",placeholder:"Host"}),Object(ae.jsx)(Oe.a.Input,{fluid:!0,error:"error"===k,value:u,onChange:function(e,t){var n=t.value;w("idle"),d(n)},icon:"user",iconPosition:"left",placeholder:"Email adress"}),Object(ae.jsx)(Oe.a.Input,{fluid:!0,error:"error"===k,value:x,onChange:function(e,t){var n=t.value;w("idle"),g(n)},icon:"lock",iconPosition:"left",placeholder:"Password",type:"password"}),Object(ae.jsx)(v.a,{onClick:C,color:ye,fluid:!0,size:"large",children:"Login"})]})}),Object(ae.jsx)(ge.a,{children:"Don't have an account? Too bad"})]})})},we=function(){var e=Object(r.useState)(!1),t=Object(f.a)(e,2),n=t[0],a=t[1],i=Object(me.a)(["amcat"]),o=Object(f.a)(i,2),c=o[0],s=o[1];return Object(ae.jsxs)(h.a,{closeIcon:!0,open:n,trigger:Object(ae.jsx)(l.a.Item,{icon:null==c.amcat?"toggle off":"toggle on",name:"AmCAT",style:{color:null==c.amcat?"red":"green"}}),onClose:function(){return a(!1)},onOpen:function(){return a(!0)},children:[Object(ae.jsx)(p.a,{icon:"database",content:"Connect to AmCAT server"}),Object(ae.jsx)(h.a.Content,{children:Object(ae.jsx)(ke,{setOpen:a,setCookie:s})})]})},Ce=function(e){var t=e.force,n=void 0!==t&&t,a=Object(r.useState)(!1),i=Object(f.a)(a,2),o=i[0],c=i[1],s=Object(r.useState)(""),u=Object(f.a)(s,2),d=u[0],j=u[1],b=Object(me.a)(["name"]),O=Object(f.a)(b,2),x=O[0],g=O[1],m=function(){d.length<5||(g("name",d,{path:"/"}),c(!1))};return Object(r.useEffect)((function(){x.name&&j(x.name)}),[x.name]),Object(ae.jsxs)(h.a,{closeIcon:!n,open:o||n,trigger:Object(ae.jsx)(l.a.Item,{icon:null==x.name?"toggle off":"toggle on",name:"Name",style:{color:null==x.name?"red":"green"}}),style:{width:"23em"},onClose:function(){return c(!1)},onOpen:function(){return c(!0)},children:[Object(ae.jsx)(p.a,{icon:"user",content:"Set user name"}),Object(ae.jsx)(h.a.Content,{children:Object(ae.jsx)(Oe.a,{onSubmit:m,children:Object(ae.jsx)(Oe.a.Input,{placeholder:"username",value:d,onChange:function(e,t){t.value.length<50&&j(t.value)},autoFocus:!0,style:{width:"18em"}})})}),Object(ae.jsx)(h.a.Actions,{children:Object(ae.jsx)(v.a,{primary:!0,disabled:d.length<5,onClick:m,children:d.length<5?"please use 5 characters or more":"Set user name"})})]})},Se=Object(c.h)((function(e){var t=e.items,n=e.children,r=Object(c.g)(),a=t.map((function(e,t){return e.menu?Object(ae.jsx)(l.a.Item,{index:t,as:s.b,to:e.path,header:0===t,active:e.path===r.pathname,children:e.label},"item-"+t):null}));return"/annotator"===r.pathname?n:Object(ae.jsxs)(u.a.Pushable,{style:{height:"100vh"},children:[Object(ae.jsxs)(u.a,{as:l.a,inverted:!0,animation:"push",visible:!0,direction:"top",size:"mini",children:[a,Object(ae.jsxs)(l.a.Menu,{position:"right",children:[Object(ae.jsx)(Ce,{}),Object(ae.jsx)(we,{}),Object(ae.jsx)(ue,{}),Object(ae.jsx)(ie,{})]})]}),Object(ae.jsx)(u.a.Pusher,{children:n})]})})),_e=n(334),Ae=n(60),Ie=n(324),Re=n(335),Ee=n(325),ze=n(57),Te=n(219),De=n(114),qe=n(99),Fe=n(343),Ne=n(122),Ue=n(177),Pe=n(344),Le=function(e){var t=e.columns,n=e.data,a=e.selectedRow,i=e.setSelectedRow,o=e.width,c=void 0===o?null:o,s=e.defaultSize,l=void 0===s?15:s,u=Object(r.useState)(a?a.ROW_ID:null),d=Object(f.a)(u,2),j=d[0],b=d[1],h=Object(ze.useTable)({columns:t,data:n,initialState:{pageIndex:a?Math.floor(Number(a.ROW_ID)/l):0,pageSize:l,globalFilter:""}},ze.useGlobalFilter,ze.useSortBy,ze.usePagination),p=h.getTableProps,v=h.getTableBodyProps,x=h.headerGroups,m=h.prepareRow,y=h.page,k=h.pageCount,w=h.gotoPage,C=h.preGlobalFilteredRows,S=h.setGlobalFilter,_=h.state,A=_.pageIndex,I=_.globalFilter;Object(r.useEffect)((function(){b(a?a.ROW_ID:null)}),[a]);var R=function(e){return e.headers.map((function(e){return Object(ae.jsxs)(Te.a,Object(g.a)(Object(g.a)({className:e.headerClass},e.getHeaderProps(e.getSortByToggleProps())),{},{children:[e.render("Header"),Object(ae.jsx)("span",{children:e.isSorted?e.isSortedDesc?" \ud83d\udd3d":" \ud83d\udd3c":""})]}))}))};return Object(ae.jsxs)("div",{style:{width:c},children:[Object(ae.jsx)(Me,{preGlobalFilteredRows:C,globalFilter:I,setGlobalFilter:S}),Object(ae.jsxs)(Fe.a,Object(g.a)(Object(g.a)({compact:!0,unstackable:!0,fixed:!0,singleLine:!0,selectable:!0},p()),{},{size:"small",style:{fontSize:"10px",overflowY:"auto"},children:[Object(ae.jsx)(Ne.a,{children:x.map((function(e){return Object(ae.jsx)(De.a,Object(g.a)(Object(g.a)({},e.getHeaderGroupProps()),{},{children:R(e)}))}))}),Object(ae.jsx)(Ue.a,Object(g.a)(Object(g.a)({},v()),{},{children:function(e){return e.map((function(e,t){return m(e),Object(ae.jsx)(De.a,Object(g.a)(Object(g.a)({active:!!j&&j===e.id,onClick:function(){return function(e){if(!i)return null;j&&j===e.id||(i(Object(g.a)(Object(g.a)({},n[e.id]),{},{ROW_ID:e.id})),b(e.id))}(e)}},e.getRowProps()),{},{children:e.cells.map((function(e){return Object(ae.jsx)(qe.a,Object(g.a)(Object(g.a)({title:e.value},e.getCellProps()),{},{children:e.render("Cell")}))}))}))}))}(y)})),Object(ae.jsx)(Fe.a.Footer,{children:Object(ae.jsx)(Fe.a.Row,{children:Object(ae.jsx)(Fe.a.HeaderCell,{colSpan:t.length,children:n.length>l?Object(ae.jsx)(Pe.a,{floated:"right",style:{border:"0"},size:"mini",firstItem:!1,lastItem:!1,nextItem:!1,prevItem:!1,boundaryRange:1,ellipsisItem:{content:Object(ae.jsx)(O.a,{name:"ellipsis horizontal"}),icon:!0},activePage:A+1,totalPages:k,onPageChange:function(e,t){w(t.activePage-1)}}):null})})})]}))]})},Me=function(e){e.preGlobalFilteredRows;var t=e.globalFilter,n=e.setGlobalFilter;return Object(ae.jsx)("span",{children:Object(ae.jsx)("input",{value:t||"",onChange:function(e){n(e.target.value||void 0)},placeholder:"Enter search term",style:{border:"0"}})})},He=a.a.memo(Le),Ge={codes:[{code:"VVD",parent:"Actor",active:!0},{code:"D66",parent:"Actor",active:!0},{code:"Groenlinks",parent:"Actor",active:!0},{code:"Mark Rutte",parent:"VVD",active:!0},{code:"Sigrid Kaag",parent:"D66",active:!0},{code:"Jesse Klaver",parent:"Groenlinks",active:!0},{code:"Climate change",parent:"Issue",active:!0}]},Be=[{document_id:"Some document ID",meta_fields:[{name:"source",value:"Krantje"}],text_fields:[{name:"title",value:"GL en PvdA hebben goed gesprek met informateur, maar wantrouwen Rutte"},{name:"text",value:'PvdA-leider Lilianne Ploumen en GroenLinks-leider Jesse Klaver hadden vrijdag een goed gesprek met informateur Herman Tjeenk Willink, zeiden ze zelf. De twee benadrukten dat, hoewel er inhoudelijke stappen zijn gezet, hun vertrouwen in VVD-leider Mark Rutte nog niet is hersteld.\n\n    Informateur Willink zette zich vrijdag aan zijn taak. Eerste punt op de agenda zijn gesprekken met de lijsttrekkers van de acht grootste partijen.\n    \n    Een week nadat een groot deel van de partijleiders bekendmaakte niet meer met Rutte verder te willen onderhandelen over een nieuwe coalitie, wordt gekeken waarover partijen het inhoudelijk eens zijn.\n    \n    "Het was een prettig gesprek langs de lijnen van de inhoud", zei PvdA-leider Lilianne Ploumen na afloop. Ze heeft haar zorgen over de ongelijkheid in Nederland en over de zorg gedeeld.\n    \n    Ook Jesse Klaver (GroenLinks), die een uur eerder op gesprek kwam bij de informateur, benadrukte dat het ging over de problemen die opgelost moeten worden.\n    \n    Situatie niet veranderd in een week\n\nWat betreft de positie ten opzichte van Rutte is echter niets veranderd. Vorige week ondertekenden Ploumen en Klaver net als alle andere oppositiepartijen een motie van wantrouwen, vanwege Ruttes betrokkenheid bij de notitie over CDA-Kamerlid Pieter Omtzigt.\n\n"Als het aan ons ligt, was Rutte geen premier meer", zei Ploumen. Hoe Tjeenk Willink dat gedeukte vertrouwen kan herstellen, weet ze niet. "We wachten de voorstellen van de informateur af."\n\n"De vertrouwensbreuk is niet hersteld na \xe9\xe9n gesprek met de fractievoorzitters", zei ook Klaver. "Mijn mening over Rutte is niet veranderd."\n\nSP\'er Lilian Marijnissen sprak zich al eerder expliciet uit tegen samenwerking met Rutte.\n\nDe partijleiders hekelen het gebrek aan openheid en transparantie waar Rutte in hun ogen voor staat. "Als je een fout maakt, dan moet je dat toegeven en er niet over liegen", zei Klaver. Ploumen: "Het probleem is dat Mark Rutte heeft gelogen. Wij hebben het vertrouwen in hem opgezegd."\n\nWat de vervolgstappen moeten zijn, laten ze volledig over aan Tjeenk Willink. "Ik ga geen lijstjes maken met wat er moet gebeuren", zei Ploumen.\n\nDe informateur ontvangt later op vrijdag nog de partijleiders Wopke Hoekstra (CDA) en Sigrid Kaag (D66), en Rutte zelf.\n\nTjeenk Willink denkt niet dat Rutte zomaar door kan\n\nTjeenk Willink suggereerde woensdag op een persconferentie dat hij Rutte niet per se een sta-in-de-weg voor een verandering van de bestuursstijl in Den Haag vindt. Toen daarover vervolgens berichten in de media verschenen, voelde de informateur zich vrijdag genoodzaakt die boodschap bij te sturen.\n\nDe conclusie dat Rutte geen belemmering vormt voor de formatie, kan hij niet voor zijn rekening nemen, luidt een schriftelijke verklaring.\n\nTjeenk Willink heeft namelijk ook de opdracht om te onderzoeken "of en zo ja onder welke voorwaarden er voldoende vertrouwen tussen partijen bestaat of weer kan ontstaan".'}]},{document_id:"Another document ID",meta_fields:[{name:"source",value:"Krantje"}],text_fields:[{name:"title",value:"CU-leider Segers vindt dat uitspraak over Rutte te veel op de man was gespeeld"},{name:"text",value:'Partijleider Gert-Jan Segers van de ChristenUnie (CU) vindt dat hij te veel op de man heeft gespeeld door coalitiedeelname uit te sluiten als VVD-leider Mark Rutte opnieuw premier zou worden. Terugblikkend zegt hij dat het niet om \xe9\xe9n persoon moet gaan, maar om "een ongezonde politieke cultuur en een genadeloze overheid". Daar moet volgens hem verandering in komen, zo zei hij zaterdag tijdens een congres van de partij.\n\n    \n    Segers deed zijn uitspraak over Rutte na het debat over de notitie "functie elders" voor CDA-Kamerlid Pieter Omtzigt. Binnen de CU is verdeeldheid ontstaan over het besluit van de fractie, erkent Segers.\n    \n    Naast steun is er ook kritiek van veel leden, die zeggen dat hij "te veel op de man heeft gespeeld en te weinig de bal". "Te veel Rutte, te weinig ons allemaal. En als dat de perceptie van veel mensen is, dan moet ik me dat aantrekken", aldus Segers tijdens het congres.\n    \n    \n    Volgens de CU-leider staat "de politieke cultuur in Den Haag natuurlijk niet los van Mark Rutte, zeker niet".\n    \n    "Maar die oude cultuur staat of valt niet met \xe9\xe9n man. Ook wijzelf maken er deel van uit. Ik wil niet genadeloos zijn voor personen, maar ik wil wel hard en helder zijn over een cultuur die niet deugt en een genadeloze overheid. Daar moet \xe9cht een omslag in komen", zei Segers.\n    \n    \n    De ChristenUnie heeft vijf zetels in de Tweede Kamer. Op het congres werden vier oude Kamerleden uitgezwaaid en trad Ankie van Tatenhove aan als nieuwe partijvoorzitter.'}]}],We=function(e){var t=e.codingjob,n=e.setSelectedCodingjob,a=Object(Ae.useLiveQuery)((function(){return re.idb.codingjobs.toArray()}));Object(r.useEffect)((function(){!(null===t||void 0===t?void 0:t.job_id)&&a&&n(a.length>0?Object(g.a)(Object(g.a)({},a[0]),{},{ROW_ID:"0"}):null),console.log(a)}),[t,a,n]),Object(r.useEffect)((function(){if(a&&null==(null===t||void 0===t?void 0:t.ROW_ID)&&(null===t||void 0===t?void 0:t.job_id))for(var e=0;e<a.length;e++)if(a[e].job_id===t.job_id)return void n(Object(g.a)(Object(g.a)({},t),{},{ROW_ID:String(e)}))}),[t,a,n]);var i=[{Header:"Coding job",accessor:"name",headerClass:"thirteen wide"}];return Object(ae.jsx)(ve.a,{centered:!0,stackable:!0,columns:1,children:Object(ae.jsxs)(ve.a.Column,{width:6,children:[Object(ae.jsx)(p.a,{textAlign:"center",style:{background:"#1B1C1D",color:"white"},children:"Select Codingjob"}),Object(ae.jsxs)(xe.a,{style:{border:"0"},children:[Object(ae.jsxs)(v.a.Group,{widths:"2",size:"mini",children:[Object(ae.jsx)(Je,{setSelectedCodingjob:n}),Object(ae.jsx)(Ke,{codingjob:t,setCodingjob:n})]}),Object(ae.jsx)(Ie.a,{style:{marginTop:"30px",overflow:"auto",width:"800px"},children:a?0===a.length?Object(ae.jsx)("div",{style:{textAlign:"center"},children:Object(ae.jsx)(v.a,{primary:!0,onClick:function(){return Ve()},children:"Create Demo job"})}):Object(ae.jsx)(He,{columns:i,data:a||[],selectedRow:t,setSelectedRow:n,defaultSize:15}):null})]})]})})},Ve=function(){var e=Object(b.a)(j.a.mark((function e(){var t;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,re.idb.codingjobs.get({name:"Demo codingjob"});case 3:if(!e.sent){e.next=6;break}return e.abrupt("return",null);case 6:return e.next=8,re.createCodingjob("Demo codingjob");case 8:return t=e.sent,e.next=11,re.createDocuments(t,Be,!0);case 11:return e.next=13,re.writeCodebook(t,Ge);case 13:return e.abrupt("return",null);case 16:e.prev=16,e.t0=e.catch(0),console.log(e.t0);case 19:case"end":return e.stop()}}),e,null,[[0,16]])})));return function(){return e.apply(this,arguments)}}(),Je=function(e){var t=e.setSelectedCodingjob,n=Object(r.useState)("inactive"),a=Object(f.a)(n,2),i=a[0],o=a[1],c=Object(r.useState)(""),s=Object(f.a)(c,2),l=s[0],u=s[1],d=function(){var e=Object(b.a)(j.a.mark((function e(n){var r;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.preventDefault(),u(l.trim()),o("pending"),e.prev=3,e.next=6,re.createCodingjob(l);case 6:r=e.sent,t(r),o("inactive"),e.next=15;break;case 11:e.prev=11,e.t0=e.catch(3),console.log(e.t0),o("error");case 15:case"end":return e.stop()}}),e,null,[[3,11]])})));return function(t){return e.apply(this,arguments)}}();return Object(ae.jsxs)(h.a,{as:Oe.a,trigger:Object(ae.jsxs)(v.a,{children:[Object(ae.jsx)(O.a,{name:"plus"}),"Create job"]}),onSubmit:function(e){return d(e)},open:"inactive"!==i,onClose:function(){return o("inactive")},onOpen:function(){u(""),o("awaiting input")},size:"tiny",children:[Object(ae.jsx)(p.a,{icon:"pencil",content:"Create new Codingjob",as:"h2"}),Object(ae.jsx)(h.a.Content,{children:Object(ae.jsx)(Oe.a.Group,{children:Object(ae.jsx)(Oe.a.Input,{width:12,label:"Name",required:!0,type:"text",value:l,onChange:function(e,t){o("awaiting input"),u(t.value)},placeholder:"Enter name"})})}),Object(ae.jsxs)(h.a.Actions,{children:["error"===i?Object(ae.jsx)("div",{children:"Could not create codingjob for a reason not yet covered in the error handling..."}):null,"pending"===i?Object(ae.jsx)(Re.a,{active:!0,inverted:!0,children:Object(ae.jsx)(Ee.a,{content:"Creating codingjob"})}):Object(ae.jsx)(v.a,{type:"submit",color:"green",icon:"save",content:"Create"})]})]})},Ke=function(e){var t=e.codingjob,n=e.setCodingjob,a=Object(r.useState)("inactive"),i=Object(f.a)(a,2),o=i[0],c=i[1],s=function(){var e=Object(b.a)(j.a.mark((function e(r){return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c("pending"),e.prev=1,e.next=4,re.deleteCodingjob(t);case 4:n(null),c("inactive"),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),c("error");case 11:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t){return e.apply(this,arguments)}}();return(null===t||void 0===t?void 0:t.job_id)?Object(ae.jsxs)(h.a,{closeIcon:!0,open:"inactive"!==o,trigger:Object(ae.jsxs)(v.a,{compact:!0,children:[Object(ae.jsx)(O.a,{name:"minus"})," Delete job"]}),onClose:function(){c("inactive")},onOpen:function(){c("awaiting input")},children:[Object(ae.jsx)(p.a,{icon:"trash",content:"Delete codingjob ".concat(t.name)}),Object(ae.jsx)(h.a.Content,{children:Object(ae.jsx)("p",{children:"Do you really want to delete this codingjob?"})}),Object(ae.jsxs)(h.a.Actions,{children:["error"===o?Object(ae.jsx)("div",{children:"Could not delete codingjob for a reason not yet covered in the error handling..."}):null,"pending"===o?Object(ae.jsx)(Re.a,{active:!0,inverted:!0,children:Object(ae.jsx)(Ee.a,{content:"Deleting codingjob"})}):Object(ae.jsxs)(ae.Fragment,{children:[Object(ae.jsxs)(v.a,{color:"red",onClick:function(){c("inactive")},children:[Object(ae.jsx)(O.a,{name:"remove"})," No"]}),Object(ae.jsxs)(v.a,{color:"green",onClick:s,children:[Object(ae.jsx)(O.a,{name:"checkmark"})," Yes"]})]})]})]}):null},Ye=a.a.memo(We),Qe=n(329),Xe=n(149),Ze=function(e){var t=e.codingjob;return Object(ae.jsx)(nt,{codingjob:t,type:"texts",columns:{document_id:{required:!0,multiple:!1,defaults:["doc_id","document_id"]},text_fields:{required:!0,multiple:!0,defaults:["title","headline","body","message","text"]},meta_fields:{required:!1,multiple:!0,defaults:["title","date"]}},keepOriginal:!1})},$e=function(e,t,n,r){return Object(ae.jsx)(ae.Fragment,{children:Object(ae.jsxs)(Oe.a.Group,{widths:"equal",children:[it("document id","document_id",e,t,n,r),it("text columns","text_fields",e,t,n,r),it("meta columns","meta_fields",e,t,n,r)]})})},et=function(e){var t=e.codingjob;return Object(ae.jsx)(nt,{codingjob:t,type:"tokens",columns:{document_id:{required:!0,multiple:!1,defaults:["doc_id","document_id"]},token:{required:!0,multiple:!1,defaults:["token","text"]},sentence:{required:!1,multiple:!1,defaults:["sentence","sentence_id"]},paragraph:{required:!1,multiple:!1,defaults:["paragraph","paragraph_id"]},offset:{required:!1,int:!0,multiple:!1,defaults:["offset","start"]},end:{required:!1,int:!0,multiple:!1,defaults:["end"]},post:{required:!1,multiple:!1,defaults:["post","space"]},section:{required:!1,multiple:!1,defaults:["section"]},annotations:{required:!1,multiple:!0,defaults:[]}},keepOriginal:!1})},tt=function(e,t,n,r){return Object(ae.jsxs)(ae.Fragment,{children:[Object(ae.jsxs)(Oe.a.Group,{widths:"equal",children:[it("document id","document_id",e,t,n,r),it("token","token",e,t,n,r)]}),Object(ae.jsxs)(Oe.a.Group,{widths:"equal",children:[it("section","section",e,t,n,r),it("paragraph","paragraph",e,t,n,r),it("sentence","sentence",e,t,n,r)]}),Object(ae.jsxs)(Oe.a.Group,{widths:"equal",children:[it("start / offset","offset",e,t,n,r),it("end","end",e,t,n,r),it("space / post","post",e,t,n,r)]}),Object(ae.jsx)(Oe.a.Group,{widths:"equal",children:it("annotations","annotations",e,t,n,r,!0)})]})},nt=function(e){var t=e.codingjob,n=e.type,a=void 0===n?"text":n,i=e.columns,o=e.keepOriginal,c=Object(r.useState)([]),s=Object(f.a)(c,2),l=s[0],u=s[1],d=Object(r.useRef)();return Object(ae.jsxs)(Ie.a,{children:[Object(ae.jsxs)(ve.a,{children:[Object(ae.jsx)(ve.a.Column,{width:5,children:Object(ae.jsx)(Xe.b,{ref:d,nodrag:!0,onFileLoad:function(e){return u(e)},addRemoveButton:!0,onRemoveFile:function(){return u([])},children:Object(ae.jsx)("span",{children:"Click to upload"})})}),Object(ae.jsx)(ve.a.Column,{floated:"right",width:11,children:Object(ae.jsx)(rt,{type:a,data:l,codingjob:t,fileRef:d,columns:i,keepOriginal:o})})]}),Object(ae.jsx)(ot,{data:l})]})},rt=function(e){var t=e.type,n=e.data,a=e.codingjob,i=e.fileRef,o=e.columns,c=e.keepOriginal,s=Object(r.useState)([]),l=Object(f.a)(s,2),u=l[0],d=l[1],h=Object(r.useState)({}),p=Object(f.a)(h,2),m=p[0],y=p[1],k=Object(r.useState)(!1),w=Object(f.a)(k,2),C=w[0],S=w[1];Object(r.useEffect)((function(){if(n.length<=1)return y({}),void d([]);d(n[0].data.map((function(e){return{key:e,value:e,text:e}})));for(var e={},t=0,r=Object.keys(o);t<r.length;t++){var a=r[t];e[a]=o[a].multiple?[]:null;var i,c=Object(x.a)(o[a].defaults);try{for(c.s();!(i=c.n()).done;){var s=i.value;n[0].data.includes(s)&&(o[a].multiple?e[a].push(s):e[a]=s)}}catch(l){c.e(l)}finally{c.f()}}y(e)}),[n,o]);var _=function(e,t){for(var n=e[0].data,r=Object(g.a)({},t),a=function(){var e=s[i];if(o[e].multiple){r[e]={};var a,c=Object(x.a)(t[e]);try{var l=function(){var t=a.value;r[e][t]=n.findIndex((function(e){return e===t}))};for(c.s();!(a=c.n()).done;)l()}catch(u){c.e(u)}finally{c.f()}}else r[e]=n.findIndex((function(n){return n===t[e]}))},i=0,s=Object.keys(t);i<s.length;i++)a();return e.slice(1).map((function(e){var a={};if(c){var i=n.map((function(t,n){return{name:t,value:e.data[n]}}));a.original=i}for(var s=0,l=Object.keys(t);s<l.length;s++){var u=l[s];if(o[u].multiple){a[u]=[];var d,j=Object(x.a)(t[u]);try{for(j.s();!(d=j.n()).done;){var b=d.value,f=r[u][b];if(!(f<0)){var h=e.data[f];o[u].int&&(h=parseInt(h)),a[u].push({name:n[f],value:h})}}}catch(O){j.e(O)}finally{j.f()}}else{var p=r[u];if(p<0)continue;var v=e.data[p];a[u]=o[u].int?parseInt(v):v}}return a}))},A=function(){var e=Object(b.a)(j.a.mark((function e(){var r;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,S(!0),r=_(n,m),"tokens"===t&&(r=at(r)),e.next=6,re.createDocuments(a,r);case 6:return e.next=8,re.setCodingjobProp(a,"codebook.unitSettings.n",null);case 8:i.current.removeFile(),S(!1),e.next=16;break;case 12:e.prev=12,e.t0=e.catch(0),console.log(e.t0),S(!1);case 16:case"end":return e.stop()}}),e,null,[[0,12]])})));return function(){return e.apply(this,arguments)}}();return Object(ae.jsx)(ae.Fragment,{children:Object(ae.jsxs)(Oe.a,{loading:C,children:["texts"===t?$e(o,u,m,y):null,"tokens"===t?tt(o,u,m,y):null,Object(ae.jsx)(Oe.a.Group,{children:Object(ae.jsxs)(Oe.a.Field,{control:v.a,onClick:A,disabled:!function(){for(var e=0,t=Object.keys(o);e<t.length;e++){var n=t[e];if(o[n].multiple){if(o[n].required&&0===m[n].length)return!1}else if(o[n].required&&!m[n])return!1}return!0}(),children:[Object(ae.jsx)(O.a,{name:"upload"}),"Upload"]})})]})})},at=function(e){for(var t=[],n=[e[0]],r=1;r<e.length;r++)e[r].document_id!==e[r-1].document_id&&(t.push({document_id:e[r-1].document_id,tokens:n}),n=[]),n.push(e[r]);return t},it=function(e,t,n,r,a,i){return Object(ae.jsx)(Oe.a.Field,{control:Qe.a,clearable:!0,selection:!0,multiple:!!n[t].multiple,label:{children:e,style:{fontSize:"10px"}},required:n[t].required,options:r,value:a[t],onChange:function(e,n){var r=Object(g.a)({},a);r[t]=n.value,i(r)},style:{minWidth:"3em",fontSize:"10px"}})},ot=function(e){var t=e.data,n=function(e){return e.map((function(e){return Object(ae.jsx)(Fe.a.Cell,{children:Object(ae.jsx)("span",{title:e,children:e})})}))};return t.length<=1?null:Object(ae.jsxs)("div",{style:{marginTop:"3em",overflow:"auto",width:"100%",border:"solid 1px"},children:[Object(ae.jsxs)(Fe.a,{unstackable:!0,singleLine:!0,fixed:!0,size:"small",compact:!0,children:[Object(ae.jsx)(Fe.a.Header,{children:Object(ae.jsx)(Fe.a.Row,{children:function(e){return e[0].data.map((function(e){return Object(ae.jsx)(Fe.a.HeaderCell,{style:{width:"7em"},children:Object(ae.jsx)("span",{title:e,children:e})})}))}(t)})}),Object(ae.jsx)(Fe.a.Body,{children:function(e,t){return e.slice(0,t+1).slice(1).map((function(e){return Object(ae.jsx)(Fe.a.Row,{children:n(e.data)})}))}(t,5)})]}),t.length>5?Object(ae.jsxs)(p.a,{align:"center",children:[t.length-1-5," more rows"]}):null]})},ct=function(e){var t=e.codingjob,n=Object(r.useState)("Documents CSV"),a=Object(f.a)(n,2),i=a[0],o=a[1];return Object(ae.jsxs)(ae.Fragment,{children:[Object(ae.jsxs)(l.a,{attached:"top",tabular:!0,children:[Object(ae.jsx)(l.a.Item,{name:"Documents CSV",active:"Documents CSV"===i,onClick:function(e,t){return o(t.name)}}),Object(ae.jsx)(l.a.Item,{name:"Tokens CSV",active:"Tokens CSV"===i,onClick:function(e,t){return o(t.name)}})]}),Object(ae.jsx)(xe.a,{attached:"bottom",children:function(e){switch(e){case"Documents CSV":return Object(ae.jsx)(Ze,{codingjob:t});case"Tokens CSV":return Object(ae.jsx)(et,{codingjob:t});default:return null}}(i)})]})},st=function(){var e=Object(b.a)(j.a.mark((function e(t,n,r,a,i){var o,c;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,re.getJobDocumentCount(t);case 2:if(o=e.sent,r(Math.ceil(o/n)),c=[],!(o>0)){e.next=9;break}return e.next=8,re.getJobDocuments(t,0,n);case 8:c=e.sent;case 9:a(c),i(lt(c));case 11:case"end":return e.stop()}}),e)})));return function(t,n,r,a,i){return e.apply(this,arguments)}}(),lt=function(e){var t=[];return e.length>0&&(t=e.reduce((function(e,t){if(t.text_fields){var n,r=Object(x.a)(t.text_fields);try{for(r.s();!(n=r.n()).done;){var a=n.value;e.add(a.name)}}catch(o){r.e(o)}finally{r.f()}}else for(var i=0;i<t.tokens.length;i++)e.add(t.tokens[i].section);return e}),new Set)),["document_id"].concat(Object(_.a)(t))},ut=function(e){var t=e.codingjob,n=Object(r.useState)([]),a=Object(f.a)(n,2),i=a[0],o=a[1],c=Object(r.useState)(1),s=Object(f.a)(c,2),l=s[0],u=s[1],d=Object(r.useState)([]),h=Object(f.a)(d,2),p=h[0],v=h[1];Object(r.useEffect)((function(){if(!t)return o([]),v([]),null;st(t,10,u,o,v)}),[t]);var x=function(e){return p.map((function(t,n){var r,a,i=null;return"document_id"===t?i=e.document_id:(e.text_fields&&(i=e.text_fields.find((function(e){return e.name===t})))&&(i=i.value),i||e.text_fields||!e.tokens||(r=e.tokens,a=t,i=r.reduce((function(e,t){return t.section===a&&(e=e+t.pre+t.token+t.post),e}),""))),Object(ae.jsx)(Fe.a.Cell,{children:Object(ae.jsx)("span",{title:i,children:i})},n)}))},g=function(){var e=Object(b.a)(j.a.mark((function e(n,r){var a,i;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=10*(r.activePage-1),e.next=3,re.getJobDocuments(t,a,10);case 3:i=e.sent,o(i),v(lt(i));case 6:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}();return i.length<1?Object(ae.jsx)("h3",{style:{marginTop:"5em",textAlign:"center"},children:"This codingjob does not yet have any documents"}):Object(ae.jsx)(Ie.a,{style:{marginTop:"2em"},children:Object(ae.jsxs)(Fe.a,{unstackable:!0,selectable:!0,fixed:!0,compact:!0,singleLine:!0,size:"small",style:{fontSize:"10px"},children:[Object(ae.jsx)(Fe.a.Header,{children:Object(ae.jsx)(Fe.a.Row,{children:function(e,t){return t.map((function(e,t){return Object(ae.jsx)(Fe.a.HeaderCell,{width:0===t?3:null,children:Object(ae.jsx)("span",{title:e,children:e})},t)}))}(0,p)})}),Object(ae.jsx)(Fe.a.Body,{children:function(e){return e.map((function(e,t){return Object(ae.jsx)(Fe.a.Row,{children:x(e)},t)}))}(i)}),Object(ae.jsx)(Fe.a.Footer,{children:Object(ae.jsx)(Fe.a.Row,{children:Object(ae.jsx)(Fe.a.HeaderCell,{colSpan:p.length,children:l>1?Object(ae.jsx)(Pe.a,{size:"mini",floated:"right",boundaryRange:1,siblingRange:1,ellipsisItem:{content:Object(ae.jsx)(O.a,{name:"ellipsis horizontal"}),icon:!0},firstItem:{content:Object(ae.jsx)(O.a,{name:"angle double left"}),icon:!0},lastItem:{content:Object(ae.jsx)(O.a,{name:"angle double right"}),icon:!0},prevItem:{content:Object(ae.jsx)(O.a,{name:"angle left"}),icon:!0},nextItem:{content:Object(ae.jsx)(O.a,{name:"angle right"}),icon:!0},pointing:!0,secondary:!0,defaultActivePage:1,totalPages:l,onPageChange:g}):null})})})]})})},dt=function(e){var t=e.codingjob;return Object(ae.jsx)("div",{style:{paddingLeft:"1em"},children:Object(ae.jsxs)(ve.a,{stackable:!0,columns:2,children:[Object(ae.jsxs)(ve.a.Column,{width:8,children:[Object(ae.jsx)(p.a,{textAlign:"center",style:{background:"#1B1C1D",color:"white"},children:"Upload Documents"}),Object(ae.jsx)(ct,{codingjob:t})]}),Object(ae.jsxs)(ve.a.Column,{width:8,children:[Object(ae.jsx)(p.a,{textAlign:"center",style:{background:"#1B1C1D",color:"white"},children:"Document list"}),Object(ae.jsx)(ut,{codingjob:t})]})]})})},jt=a.a.memo(dt),bt=n(321),ft=n(328),ht=n(322),pt={textUnit:null,unitSelection:"allTextUnits",annotation:null,contextUnit:"document",contextWindow:[1,1],n:null,seed:42,ordered:!1,balanceDocuments:!0,balanceAnnotations:!0,validCodes:{},highlightAnnotation:!1,layout:{text:{},meta:{}}},vt=function(e){var t=e.codingjob,n=(null===t||void 0===t?void 0:t.unitSettings)||pt,r=function(e){re.setCodingjobProp(t,"unitSettings",e)};return n?Object(ae.jsx)("div",{style:{verticalAlign:"top",float:"top",paddingLeft:"1em"},children:Object(ae.jsx)(ve.a,{style:{paddingTop:"1em"},children:Object(ae.jsxs)(ve.a.Row,{children:[Object(ae.jsx)(ve.a.Column,{width:8,children:Object(ae.jsx)(Ot,{codingjob:t,unitSettings:n,setUnitSettings:r})}),Object(ae.jsx)(ve.a.Column,{width:8,children:Object(ae.jsx)(xt,{unitSettings:n,setUnitSettings:r})})]})})}):null},Ot=function(e){var t=e.codingjob,n=e.unitSettings,a=e.setUnitSettings;Object(r.useEffect)((function(){null===(null===n||void 0===n?void 0:n.textUnit)&&a(Object(g.a)(Object(g.a)({},n),{},{textUnit:"document",value:"allTextUnits",n:null,totalUnits:null}))}),[n,a]);var i=function(e,t,r,i){var o=r?"annotations":"allTextUnits",c=n.textUnit===e&&n.unitSelection===o;return Object(ae.jsx)(Oe.a.Field,{children:Object(ae.jsx)(bt.a,{value:e,label:t,checked:c,onChange:function(t,r){return a(Object(g.a)(Object(g.a)({},n),{},{textUnit:e,unitSelection:o,n:null,totalUnits:null}))},style:{marginLeft:i?"1em":"0em"}})})};return Object(ae.jsxs)(Oe.a,{children:[Object(ae.jsxs)(Oe.a.Group,{children:[Object(ae.jsx)(O.a,{name:"setting"}),Object(ae.jsx)("label",{children:"Coding unit"})]}),Object(ae.jsxs)(Oe.a.Group,{grouped:!0,widths:"equal",children:[i("document","Document",!1),i("paragraph","Paragraph",!1),i("sentence","Sentence",!1),function(){if(!t.importedCodes)return null;if(0===Object.keys(t.importedCodes).length)return null;var e=Object.keys(t.importedCodes).map((function(e){return{key:e,value:e,text:e}}));return null===n.annotation&&a(Object(g.a)(Object(g.a)({},n),{},{annotation:e[0].value})),Object(ae.jsxs)("span",{style:{fontWeight:"bold"},children:["Annotation:","   ",Object(ae.jsx)(Qe.a,{options:e,value:n.annotation,onChange:function(e,t){return a(Object(g.a)(Object(g.a)({},n),{},{annotation:t.value}))}})]})}(),n.annotation?Object(ae.jsxs)(ae.Fragment,{children:[i("span","Span annotation",!0,!0),i("document","Span + document",!0,!0),i("paragraph","Span + paragraph",!0,!0),i("sentence","Span + sentence",!0,!0)]}):null]})]})},xt=function(e){var t=e.unitSettings,n=e.setUnitSettings,r=function(e){n(Object(g.a)(Object(g.a)({},t),{},{contextWindow:e}))},a=function(e,a){return Object(ae.jsxs)(Oe.a.Field,{children:[Object(ae.jsx)(bt.a,{value:e,label:a,disabled:"document"===t.textUnit,checked:t.contextUnit===e,onChange:function(r,a){return n(Object(g.a)(Object(g.a)({},t),{},{contextUnit:e}))}}),"  ","paragraph"!==e&&"sentence"!==e||e!==t.contextUnit?null:Object(ae.jsx)(gt,{contextUnit:t.contextUnit,contextWindow:t.contextWindow,setContextWindow:r})]})};return Object(ae.jsxs)(Oe.a,{children:[Object(ae.jsxs)(Oe.a.Group,{children:[Object(ae.jsx)(O.a,{name:"setting"}),Object(ae.jsx)("label",{children:"Context unit"})]}),Object(ae.jsxs)(Oe.a.Group,{grouped:!0,widths:"equal",children:[a("document","Document"),a("paragraph","Paragraph"),a("sentence","Sentence"),a("none","No context")]})]})},gt=function(e){var t=e.contextUnit,n=e.contextWindow,r=e.setContextWindow;return"document"===t?null:Object(ae.jsx)(ft.a,{hoverable:!0,trigger:Object(ae.jsx)(v.a,{style:{padding:"0em 0.2em 0em 0.2em",background:"white",border:"1px solid"},children:"".concat(n[0]," - ").concat(n[1])}),children:Object(ae.jsxs)(Qe.a.Menu,{children:[Object(ae.jsx)(Qe.a.Header,{content:"Set ".concat(t," window")}),Object(ae.jsxs)(ve.a,{style:{paddingTop:"1em",width:"20em"},children:[Object(ae.jsx)(ve.a.Column,{width:8,children:Object(ae.jsx)(ht.a,{size:"mini",value:n[0],type:"number",style:{width:"6em"},label:"before",onChange:function(e,t){return r([Number(t.value),n[1]])}})}),Object(ae.jsx)(ve.a.Column,{width:5,children:Object(ae.jsx)(ht.a,{size:"mini",value:n[1],type:"number",labelPosition:"right",style:{width:"6em"},label:"after",onChange:function(e,t){return r([n[0],Number(t.value)])}})})]})]})})},mt=a.a.memo(vt),yt=function(e,t){for(var n=St(e[t].ref),r=null,a=0,i=t-1;i>=0;i--){if(null==e[i].ref||null===e[i].ref.current)return i+1;var o=St(e[i].ref);if(null===r){if(wt(n,o))continue;r=o}else if(!wt(r,o))return i+1;var c=Ct(n,o);if(a>0&&c<a)return i+1;if(n.left>o.right)return i;a=c}return 0},kt=function(e,t){for(var n=St(e[t].ref),r=null,a=0,i=t+1;i<e.length;i++){if(null==e[i].ref||null===e[i].ref.current)return i-1;var o=St(e[i].ref);if(null===r){if(wt(n,o))continue;r=o}else if(!wt(r,o))return i-1;var c=Ct(n,o);if(a>0&&c<a)return i-1;if(n.right<o.left)return i;a=c}return e.length-1},wt=function(e,t){var n=Math.max(e.top,t.top);return Math.min(e.bottom,t.bottom)-n>.5*e.height},Ct=function(e,t){var n=Math.max(e.left,t.left),r=Math.min(e.right,t.right),a=(r-n)/e.width,i=(r-n)/t.width;return Math.max(a,i)},St=function(e){return e?e.current.getBoundingClientRect():null},_t=["ArrowRight","ArrowLeft","ArrowUp","ArrowDown"],At=function(e){var t=e.tokenSelection,n=e.currentToken,a=e.tokens,i=e.HoldSpace,o=e.setMover,c=e.setHoldSpace,s=e.setHoldArrow,l=e.triggerCodePopup;Object(r.useEffect)((function(){return window.addEventListener("keydown",d),window.addEventListener("keyup",u),function(){window.removeEventListener("keydown",d),window.removeEventListener("keyup",u)}}));var u=function(e){if(32===e.keyCode&&i)return c(!1),void(t.length>0&&Rt(a,t,l));_t.includes(e.key)&&(s(!1),o(null))},d=function(e){if(32!==e.keyCode){if(_t.includes(e.key)){if(e.preventDefault(),e.repeat)return;o({position:n,startposition:n,ntokens:a.length,counter:1}),s(e.key)}}else{if(e.preventDefault(),e.repeat)return;c(!0)}};return Object(ae.jsx)(ae.Fragment,{})},It=function(e){var t=e.tokenSelection,n=e.tokens,a=e.setCurrentToken,i=e.setTokenSelection,o=e.triggerCodePopup,c=Object(r.useRef)(!1),s=Object(r.useRef)(null),l=Object(r.useRef)("ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0);Object(r.useEffect)((function(){return window.addEventListener("mousedown",d),window.addEventListener("mousemove",j),window.addEventListener("mouseup",b),window.addEventListener("touchstart",u),window.addEventListener("contextmenu",f),function(){window.removeEventListener("mousedown",d),window.removeEventListener("mousemove",j),window.removeEventListener("mouseup",b),window.removeEventListener("touchstart",u),window.removeEventListener("contextmenu",f)}}));var u=function(e){var r=Tt(n,e);if(null===(null===r||void 0===r?void 0:r.index))return s.current=null,void i((function(e){return 0===e.length?e:[]}));if(t.length>0&&t[0]===s.current){var a=h(e);return i((function(e){return Nt(e,n,a,!0)})),(null===r||void 0===r?void 0:r.annotated)&&a===t[0]?Rt(n,[a,a],o):Rt(n,[t[0],a],o),void(s.current=null)}s.current!==r.index?(s.current=r.index,i((function(e){return 0===e.length?e:[]}))):i((function(e){return Nt(e,n,r.index,!0)}))},d=function(e){l.current||1===e.which&&(c.current=!0,i((function(e){return 0===e.length?e:[]})))},j=function(e){if(!l.current)if(c.current){if(e.preventDefault(),1!==e.which&&0!==e.which)return null;window.getSelection().empty(),h(e)}else{var t=Tt(n,e);null!==t.index?(a((function(e){return e===t.index?e:t.index})),i((function(e){return Nt(e,n,t.index,!1)}))):a((function(e){return e===t.index?e:t.index}))}},b=function(e){if(!l.current){if(1!==e.which&&0!==e.which)return null;var r=h(e);window.getSelection().empty(),c.current=!1,t.length>0&&null!==t[0]&&null!==t[1]?Rt(n,t,o):null!==r&&Rt(n,[r,r],o)}},f=function(e){if(2===e.button)return null;e.preventDefault(),e.stopPropagation()},h=function(e){var t=Tt(n,e);return a((function(e){return e===t.index?e:t.index})),i((function(e){return Nt(e,n,t.index,!0)})),t.index};return Object(ae.jsx)(ae.Fragment,{})},Rt=function(e,t,n){var r=Object(f.a)(t,2),a=r[0],i=r[1];if(a>i){var o=[i,a];a=o[0],i=o[1]}var c={index:e[a].index,length:e[i].length+e[i].offset-e[a].offset,span:[e[a].index,e[i].index],section:e[a].section,offset:e[a].offset};n(e[i].index,c)},Et=function(e,t,n,r,a,i){var o,c=n.position;if("ArrowRight"===t&&c++,"ArrowLeft"===t&&c--,"ArrowUp"===t&&(c=zt(e,n,"up")),"ArrowDown"===t&&(c=zt(e,n,"down")),c>n.ntokens&&(c=n.ntokens),c<0&&(c=0),null==(null===(o=e[c])||void 0===o?void 0:o.ref)){if("ArrowRight"===t){var s=e.findIndex((function(e){return e.codingUnit}));if(s<0)return n.position;c=s}if("ArrowLeft"===t){var l=e.lastIndexOf((function(e){return e.codingUnit}));if(l<0)return n.position;c=l-1}}if(r&&e[n.position].section!==e[c].section)if(c>n.position){for(var u=c;u>=n.position;u--)if(e[u].section===e[n.position].section){c=u;break}}else for(var d=c;d<=n.position;d++)if(e[d].section===e[n.position].section){c=d;break}return n.position!==c&&(a((function(e){return e===c?e:c})),i((function(t){return Nt(t,e,c,r)})),Ft(e[c].ref.current)),c},zt=function(e,t){var n,r,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"up";if(null==(null===(n=e[t.position])||void 0===n?void 0:n.ref)||null==(null===(r=e[t.startposition])||void 0===r?void 0:r.ref)){var i=e.findIndex((function(e){return e.codingUnit}));return i<0?0:i}return"up"===a?yt(e,t.position):"down"===a?kt(e,t.position):void 0},Tt=function(e,t){var n=Dt(e,t),r=Object(f.a)(n,2),a=r[0],i=r[1];return null===a?{index:null,annotated:!1}:{index:qt(e,a),annotated:i}},Dt=function(e,t){try{var n,r,a;if("mousemove"!==t.type&&"mouseup"!==t.type||(a=t.originalTarget||t.path[0]),"touchmove"===t.type||"touchstart"===t.type){var i=t.touches[0];a=document.elementFromPoint(i.clientX,i.clientY)}if("item"===(null===(n=a)||void 0===n||null===(r=n.parentNode)||void 0===r?void 0:r.className))return[null,!1];if(a){if(a.className.includes("token"))return[a,!1];if(a.parentNode&&a.parentNode.className.includes("token"))return[a.parentNode,!0]}return[null,!1]}catch(t){return[null,!1]}},qt=function(e,t){return parseInt(t.getAttribute("tokenindex"))},Ft=function(e){!function(e,t){var n=e.getBoundingClientRect(),r=t.getBoundingClientRect(),a=n.top,i=n.height,o=r.top,c=o-a<50;o>a+.9*i&&(e.scrollTop=e.scrollTop+o-(.9*i+a)),c&&(e.scrollTop=e.scrollTop+o-(.1*i+a))}(e.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode,e)},Nt=function(e,t,n,r){if(null===n)return e;var a=Object(_.a)(e);if(!r||0===a.length)return[n,n];if(null===n)return[a[0],null];if(t[a[0]].section===t[n].section)a=[a[0],n];else if(n>a[0])for(var i=n;i>=a[0];i--)t[a[0]].section===t[i].section&&(a=[a[0],i]);else for(var o=n;o<=a[0];o++)t[a[0]].section===t[o].section&&(a=[a[0],o]);return a.length>0&&e[0]===a[0]&&e[1]===a[1]?e:a},Ut=function(e){var t=e.tokens,n=e.currentToken,a=e.setCurrentToken,i=e.tokenSelection,o=e.setTokenSelection,c=e.triggerCodePopup,s=e.eventsBlocked,l=Object(r.useState)(null),u=Object(f.a)(l,2),d=u[0],j=u[1],b=Object(r.useState)(!1),h=Object(f.a)(b,2),p=h[0],v=h[1],O=Object(r.useState)(null),x=Object(f.a)(O,2),g=x[0],m=x[1];return Object(r.useEffect)((function(){s?(m(!1),v(!1)):o([])}),[m,v,s,o]),Object(r.useEffect)((function(){if(d&&g){var e=Et(t,g,d,p,a,o),n=Math.max(5,100/Math.ceil(d.counter/5));1===d.counter&&(n=150),setTimeout((function(){j({position:e,startposition:d.startposition,ntokens:d.ntokens,counter:d.counter+1})}),n)}}),[t,d,g,p,a,o]),t?s?null:Object(ae.jsxs)(ae.Fragment,{children:[Object(ae.jsx)(At,{tokenSelection:i,currentToken:n,tokens:t,HoldSpace:p,setMover:j,setHoldSpace:v,setHoldArrow:m,triggerCodePopup:c}),Object(ae.jsx)(It,{tokenSelection:i,tokens:t,setCurrentToken:a,setTokenSelection:o,triggerCodePopup:c})]}):null},Pt=n(345),Lt=function(e,t){if(t[e]){var n=t[e].foldToParent;return n&&t[n]?t[n].color+"50":t[e].color+"50"}return"#ffffff50"},Mt=function(e){var t=null;if(1===e.length)t=e[0];else{var n=Math.floor(100/e.length),r=e.reduce((function(t,r,a){return 0===a&&t.push(r+" ".concat(n,"%")),a===e.length-1&&t.push(r+" ".concat(100-n,"%")),a>0&&a<e.length-1&&(t.push(r+" ".concat(n*a,"%")),t.push(r+" ".concat(n*(a+1),"%"))),t}),[]);t="linear-gradient(to bottom, ".concat(r.join(", "),")")}return t},Ht=function(e,t,n){var r,a=Object(x.a)(e);try{for(a.s();!(r=a.n()).done;){var i,o=r.value;if(null===(i=o.ref)||void 0===i?void 0:i.current){var c=Gt(null===t||void 0===t?void 0:t[o.index],n);c&&0!==Object.keys(c).length?Bt(o,c,n):o.ref.current.classList.contains("annotated")&&(o.ref.current.classList.remove("annotated"),Wt(o,null,null,null))}}}catch(s){a.e(s)}finally{a.f()}},Gt=function(e,t){if(!e)return null;if(e&&t){e=Object(g.a)({},e);for(var n=0,r=Object.keys(e);n<r.length;n++){var a=r[n];if(t[a]){var i=t[a].codeMap,o=e[a].value;i[o]&&i[o].active&&i[o].activeParent||delete e[a]}else delete e[a]}}return e},Bt=function(e,t,n){for(var r=0,a=0,i={pre:[],text:[],post:[]},o=0,c=Object.keys(n);o<c.length;o++){var s=c[o];if(t[s]){var l=n[s].codeMap,u=t[s],d=Lt(u.value,l);i.text.push(d),u.span[0]===u.index?r++:i.pre.push(d),u.span[1]===u.index?a++:i.post.push(d)}else i.text.push("#ffffff50"),i.pre.push("#ffffff50"),i.post.push("#ffffff50")}var j=r===Object.values(t).length,b=a===Object.values(t).length,f=r>0,h=a>0,p=e.ref.current.classList;p.add("annotated"),j?p.add("allLeft"):p.remove("allLeft"),f&!j?p.add("anyLeft"):p.remove("anyLeft"),b?p.add("allRight"):p.remove("allRight"),h&!b?p.add("anyRight"):p.remove("anyRight");var v=Mt(i.text),O=j?"white":Mt(i.pre),x=b?"white":Mt(i.post);Wt(e,O,v,x)},Wt=function(e,t,n,r){var a=e.ref.current.children;a[0].style.background=t,a[1].style.background=n,a[2].style.background=r},Vt=function(e,t){var n,r=Object(x.a)(e);try{for(r.s();!(n=r.n()).done;){var a,i=n.value;if(null===(a=i.ref)||void 0===a?void 0:a.current)if(0!==t.length&&null!==t[0]&&null!==t[1]){var o=Object(f.a)(t,2),c=o[0],s=o[1];if(c>s){var l=[c,s];s=l[0],c=l[1]}var u=i.arrayIndex>=c&&i.arrayIndex<=s,d=i.ref.current.classList;if(u&&i.codingUnit){var j=c===i.arrayIndex,b=s===i.arrayIndex;d.add("selected"),j?d.add("start"):d.remove("start"),b?d.add("end"):d.remove("end")}else d.remove("selected")}else i.ref.current.classList.remove("selected")}}catch(h){r.e(h)}finally{r.f()}},Jt=function(e){var t,n,r=e.tokens,a=e.currentToken,i=e.annotations,o=e.variableMap,c=e.fullScreenNode;if(!(null===r||void 0===r||null===(t=r[a])||void 0===t?void 0:t.ref))return null;if(!(null===i||void 0===i?void 0:i[r[a].index]))return null;if(!o)return null;var s=i[r[a].index],l=Object.keys(s),u=l.map((function(e){return s[e].value}));return Object(ae.jsx)(ft.a,{mountNode:c||void 0,context:null===r||void 0===r||null===(n=r[a])||void 0===n?void 0:n.ref,basic:!0,hoverable:!1,position:"top left",mouseLeaveDelay:1,open:!0,style:{margin:"0",padding:"0",border:"1px solid"},children:Object(ae.jsx)(Pt.a,{children:l.map((function(e,t){return o[e]?Object(ae.jsxs)(Pt.a.Item,{style:{backgroundColor:Lt(u[t],o[e].codeMap),padding:"0.3em"},children:[Object(ae.jsx)("b",{children:e}),": "+u[t]]},t):null}))})})},Kt=function(e){var t=e.tokens,n=e.variableMap,a=e.annotations,i=e.triggerCodePopup,o=e.eventsBlocked,c=e.fullScreenNode,s=e.disableAnnotations,l=Object(r.useState)(0),u=Object(f.a)(l,2),d=u[0],j=u[1],b=Object(r.useState)([]),h=Object(f.a)(b,2),p=h[0],v=h[1];return Object(r.useEffect)((function(){if(!n)return null;Ht(t,a,n)}),[t,a,n]),Object(r.useEffect)((function(){Vt(t,p)}),[t,p]),Object(ae.jsxs)(ae.Fragment,{children:[Object(ae.jsx)(Jt,{tokens:t,currentToken:d,annotations:a,variableMap:n,fullScreenNode:c}),s?null:Object(ae.jsx)(Ut,{tokens:t,currentToken:d,setCurrentToken:j,tokenSelection:p,setTokenSelection:v,triggerCodePopup:i,eventsBlocked:o})]})},Yt=n(303),Qt=(n(205),function(e){return Date.parse(e)?e.replace("T"," "):e}),Xt=function(e){var t=e.meta_fields,n=function(e){var t={};return e.bold&&(t.fontWeight="bold"),e.italic&&(t.fontStyle="italic"),t};return Object(ae.jsx)(Fe.a,{basic:"very",compact:!0,style:{lineHeight:"0.8"},children:t.map((function(e){return Object(ae.jsxs)(Fe.a.Row,{style:{fontSize:"".concat(null!=e.size?e.size:1,"em")},children:[Object(ae.jsx)(Fe.a.Cell,{width:1,children:Object(ae.jsx)("b",{children:e.label||e.name})}),Object(ae.jsx)(Fe.a.Cell,{style:n(e),children:Qt(e.value)})]})}))})},Zt=function(e){var t=e.tokens,n=e.text_fields,a=e.meta_fields,i=e.centerVertical,o=e.setReady,c=e.height,s=Object(r.useState)({}),l=Object(f.a)(s,2),u=l[0],d=l[1],j=Object(r.useRef)(null);return Object(r.useEffect)((function(){var e,n=t.find((function(e){return e.codingUnit}));(null===n||void 0===n||null===(e=n.ref)||void 0===e?void 0:e.current)&&j.current&&function(e,t,n){var r=e.getBoundingClientRect(),a=t.getBoundingClientRect(),i=r.top,o=r.height,c=a.top,s=o/(1/n);e.scrollTop=e.scrollTop+c-(s+i)}(j.current,n.ref.current,1/4)})),Object(r.useEffect)((function(){if(!t)return null;d($t(t,n)),o&&o((function(e){return e+1}))}),[t,n,o]),null===t?null:Object(ae.jsx)("div",{style:{display:"flex",alignItems:i?"center":null,height:c},children:Object(ae.jsx)(Yt.a,{innerRef:j,children:Object(ae.jsxs)("div",{className:"TokensContainer",style:{flex:"1 97%",width:"100%",maxHeight:c,overflowY:"auto",textAlign:"justify"},children:[Object(ae.jsx)("div",{style:{paddingTop:"20px",marginLeft:"10%",width:"80%",textAlign:"right"},children:Object(ae.jsx)(Xt,{meta_fields:a})}),Object(ae.jsx)("div",{style:{padding:"20px"},children:u.text}),Object(ae.jsx)("div",{style:{height:"25px"}})]})})},"tokens")},$t=function(e,t){var n={text:[]};if(0===e.length)return n;for(var r=[],i=[],o=[],c=e[0].codingUnit,s=e[0].section,l=e[0].paragraph,u=e[0].sentence,d=0;d<e.length;d++)e[d].arrayIndex=d,e[d].sentence!==u&&(o.length>0&&i.push(nn(d,u,o)),o=[]),e[d].paragraph!==l&&(i.length>0&&r.push(tn(d,l,i,e[d].paragraph!==l)),i=[]),e[d].section!==s&&(r.length>0&&n.text.push(en(t,d+"_"+s,r,s)),r=[]),l=e[d].paragraph,u=e[d].sentence,s=e[d].section,(c=e[d].codingUnit)&&(e[d].ref=a.a.createRef()),o.push(rn(e[d],c));return o.length>0&&i.push(nn("last",u,o)),i.length>0&&r.push(tn("last",l,i,!1)),r.length>0&&n.text.push(en(t,"last_"+s,r,s)),n},en=function(e,t,n,r){return Object(ae.jsx)("span",{className:"section",children:function(n){var a=e.find((function(e){return e.name===r}));return a?Object(ae.jsxs)(ae.Fragment,{children:[a.label?Object(ae.jsx)("span",{style:{color:"grey",fontWeight:"bold",textAlign:"center"},children:a.label}):null,Object(ae.jsx)("p",{style:{fontSize:"".concat(null!=a.size?a.size:1,"em"),fontWeight:a.bold?"bold":"normal",fontStyle:a.italic?"italic":"normal"},children:n},r+t)]}):n}(n)},"section"+r)},tn=function(e,t,n,r){return Object(ae.jsx)("div",{style:{display:"flex"},children:Object(ae.jsx)("span",{className:"paragraph",style:{flex:"1 98%",paddingBottom:r?"1.5em":"0em",display:"table",paddingLeft:"0.3em"},children:n},"par"+t)})},nn=function(e,t,n){return Object(ae.jsx)("span",{className:"sentence",children:n},"sent"+t)},rn=function(e,t){var n=t?{lineHeight:"1.4em",fontSize:"1.5em",position:"relative"}:{color:"#746363",position:"relative"};return Object(ae.jsxs)("span",{ref:e.ref,className:"token",tokenindex:e.arrayIndex,style:n,children:[Object(ae.jsx)("span",{className:"pre",children:e.pre}),Object(ae.jsx)("span",{className:"text",children:e.text}),Object(ae.jsx)("span",{className:"post",children:e.post}),Object(ae.jsx)("div",{className:"variable",style:{position:"absolute",top:"-0.4em",left:"0",fontSize:"0.4em"}})]},e.index)},an=a.a.memo(Zt),on=["ArrowRight","ArrowLeft","ArrowUp","ArrowDown"],cn=function(e){var t=e.children,n=e.variable,a=e.fullScreenNode,i=e.open,o=e.setOpen,c=e.tokenRef,s=e.overwrites,l=Object(r.useState)(!1),u=Object(f.a)(l,2),d=u[0],j=u[1];return Object(ae.jsxs)(ft.a,{mountNode:a||void 0,context:c,hoverable:!0,open:i,mouseLeaveDelay:1e7,onOpen:function(){return j(!0)},onClose:function(){d&&o(!1)},style:{padding:"0px",minWidth:"15em"},children:[Object(ae.jsxs)("div",{style:{minWidth:"12em",textAlign:"center",background:"#1B1C1D",color:"white",border:"1px solid"},children:[n?Object(ae.jsxs)(ae.Fragment,{children:[Object(ae.jsx)("b",{children:n})," "]}):Object(ae.jsx)("b",{children:"Select variable"}),Object(ae.jsx)(v.a,{compact:!0,floated:"right",icon:"delete",size:"mini",style:{background:"#80808000",margin:"0px",color:"white"},onClick:function(){o(!1)}})]}),function(){if(n&&0!==s.length){var e=1===s.length?"existing annotation":"".concat(s.length," existing annotations");return Object(ae.jsxs)("div",{style:{margin:"1em",color:"red"},children:["Warning: overwrites or deletes ",e]})}}(),Object(ae.jsx)("div",{style:{margin:"1em",border:"0px"},children:t})]})},sn=function(e){var t=e.variable,n=e.setVariable,r=e.setOverwrites,a=e.annotations,i=e.selection,o=e.canBeNew,c=e.setOpen,s=e.variableMap,l=function(e){for(var t=new Set,o=i.span[0];o<=i.span[1];o++){var c;if(null===a||void 0===a||null===(c=a[o])||void 0===c?void 0:c[e]){var s,l,u=(null===a||void 0===a||null===(s=a[o])||void 0===s?void 0:s[e].span[0])+"_"+(null===a||void 0===a||null===(l=a[o])||void 0===l?void 0:l[e].value);t.add(u)}}t.size>0?r(Array.from(t)):r([]),n(e)};if(t)return null;var u=function(){var e=Object.keys(s);return o||(e=e.filter((function(e){return null!=a[e]}))),e.map((function(e){return{color:"white",label:e,value:e}}))}();return 1===u.length&&l(u[0].value),Object(ae.jsx)("div",{children:Object(ae.jsx)(un,{active:!0,canDelete:!1,settings:{rowSize:5},options:u,setOpen:c,callback:l},"currentCodePageButtons")})},ln=function(e){var t=e.variable,n=e.variableMap,i=e.codeHistory,o=e.settings,c=e.annotations,s=e.setAnnotations,l=e.selection,u=e.overwrites,d=e.setOpen,j=e.setCodeHistory,b=Object(r.useRef)(null),h=Object(r.useState)(!0),p=Object(f.a)(h,2),v=p[0],O=p[1],g=a.a.useCallback((function(e){var t;return o&&!o.searchBox?null:((null===b||void 0===b||null===(t=b.current)||void 0===t?void 0:t.children[0])===document.activeElement||O(!0),27===e.keyCode&&d(!1),on.includes(e.key)||e.keyCode<=46||e.keyCode>=106?null:(b.current&&b.current.click(),void O(!1)))}),[b,d,o]);Object(r.useEffect)((function(){return window.addEventListener("keydown",g),function(){window.removeEventListener("keydown",g)}}));var m=function(e){dn(c,t,null===e,e,l,s,d,i,j)};if(!t)return null;var y,k=function(){for(var e,r=[],a=[],s=null===n||void 0===n||null===(e=n[t])||void 0===e?void 0:e.codeMap,u=0,d=Object.keys(s);u<d.length;u++){var j=d[u];if(!(null===l||(null===l||void 0===l?void 0:l.span[0])===(null===l||void 0===l?void 0:l.span[1]))||!c[j]){o&&"all"===o.buttonMode&&r.push({key:j,label:j,value:j,color:Lt(j,s)});var b=s[j].tree.join(" - ");a.push({key:j,value:j,text:j+" "+b,content:Object(ae.jsxs)(ae.Fragment,{children:[j,Object(ae.jsx)("br",{}),Object(ae.jsx)("span",{style:{color:"grey"},children:b})]})})}}if(!o||"recent"===o.buttonMode){var f,h=Object(x.a)(i);try{for(h.s();!(f=h.n()).done;){var p=f.value;if(r.length>5)break;r.push({key:p,label:p,value:p,color:Lt(p,s)})}}catch(v){h.e(v)}finally{h.f()}}return[r,a]}(),w=Object(f.a)(k,2),C=w[0],S=w[1];return Object(ae.jsxs)(ae.Fragment,{children:[function(e){var r;if(0===e.length)return null;var a=null===n||void 0===n||null===(r=n[t])||void 0===r?void 0:r.codeMap;return a?o&&!o.searchBox&&"recent"!==o.buttonMode?null:Object(ae.jsxs)(ae.Fragment,{children:[Object(ae.jsx)(ve.a,{children:Object(ae.jsx)(ve.a.Column,{width:13,floated:"left",children:Object(ae.jsx)(Yt.a,{innerRef:b,children:Object(ae.jsx)(Qe.a,{fluid:!0,placeholder:"<type to search>",style:{minWidth:"12em"},options:Object.keys(a).reduce((function(e,t){var n=a[t].tree.join(" - ");return e.push({key:t,value:t,text:t+" "+n,content:Object(ae.jsxs)(ae.Fragment,{children:[t,Object(ae.jsx)("br",{}),Object(ae.jsx)("span",{style:{color:"grey"},children:n})]})}),e}),[]),open:!v,search:!0,selection:!0,compact:!0,selectOnNavigation:!1,minCharacters:0,autoComplete:"on",onClick:function(){return O(!1)},onSearchChange:function(e,t){""===t.searchQuery&&O(!0)},onClose:function(){return O(!0)},onChange:function(e,n){a[n.value]&&dn(c,t,!1,n.value,l,s,d,i,j)}})})})}),Object(ae.jsx)("br",{})]}):null}(S),(y=C,0===y.length?null:Object(ae.jsx)(un,{active:v,canDelete:u.length>0,settings:o,options:y,setOpen:d,callback:m},"newCodePageButtons"))]})},un=function(e){var t=e.active,n=e.options,i=e.canDelete,o=(e.settings,e.setOpen),c=e.callback,s=Object(r.useState)(0),l=Object(f.a)(s,2),u=l[0],d=l[1],j=Object(r.useState)([]),b=Object(f.a)(j,2),h=b[0],p=b[1];Object(r.useEffect)((function(){var e=Object(_.a)(n);i&&e.push({label:"DELETE",color:"red",value:null,textColor:"white"}),e.push({label:"CANCEL",color:"grey",value:"CANCEL",textColor:"white"});var t,r=Object(x.a)(e);try{for(r.s();!(t=r.n()).done;){t.value.ref=a.a.createRef()}}catch(o){r.e(o)}finally{r.f()}p(e)}),[n,i,p]);var O=a.a.useCallback((function(e){var t=h.length;if(on.includes(e.key))return e.preventDefault(),"ArrowRight"===e.key&&u<t-1&&d(u+1),"ArrowDown"===e.key&&d(kt(h,u)),"ArrowLeft"===e.key&&u>0&&d(u-1),void("ArrowUp"===e.key&&d(yt(h,u)));if(46===e.keyCode&&c(null),32===e.keyCode||13===e.keyCode){e.preventDefault(),e.stopPropagation();var n=h[u].value;"CANCEL"===n?o(!1):c(n)}}),[u,c,h,o]);Object(r.useEffect)((function(){return t?window.addEventListener("keydown",O):window.removeEventListener("keydown",O),function(){window.removeEventListener("keydown",O)}}),[t,O]);return Object(ae.jsx)("div",{style:{display:"flex",flexWrap:"wrap"},children:h.map((function(e,t){return Object(ae.jsx)(Yt.a,{innerRef:e.ref,children:Object(ae.jsx)(v.a,{style:{flex:"1 1 auto",backgroundColor:e.color,color:e.textColor||"black",border:"3px solid",borderColor:t===u?"black":"lightgrey",margin:"0"},value:e.value,compact:!0,size:"mini",onMouseOver:function(){return d(t)},onClick:function(e,t){console.log(t.value),"CANCEL"===t.value?o(!1):c(t.value)},children:" "+e.label},e.label)})}))})},dn=function(e,t,n,r,a,i,o,c,s){if(!e)return o(!1),null;var l=Object(g.a)(Object(g.a)({},a),{},{variable:t});if(n)return i((function(e){return N(Object(g.a)({},e),l,!0)})),o(!1),null;var u=Object(g.a)(Object(g.a)({},a),{},{variable:t,value:r});i((function(e){var t=N(Object(g.a)({},e),l,!0);return N(t,u,!1)})),s([r].concat(Object(_.a)(c.filter((function(e){return e!==r})))).slice(0,5)),o(!1)},jn=function(e,t,n,i,o,c){var s,l=Object(r.useState)(!1),u=Object(f.a)(l,2),d=u[0],j=u[1],b=Object(r.useState)(null),h=Object(f.a)(b,2),p=h[0],v=h[1],O=Object(r.useState)([]),y=Object(f.a)(O,2),k=y[0],w=y[1],C=Object(r.useState)(null),S=Object(f.a)(C,2),_=S[0],A=S[1],I=Object(r.useState)(null),R=Object(f.a)(I,2),E=R[0],z=R[1],T=Object(r.useState)({}),D=Object(f.a)(T,2),q=D[0],F=D[1],N=Object(r.useState)(null),U=Object(f.a)(N,2),P=U[0],L=U[1],M=Object(r.useState)(null),H=Object(f.a)(M,2),G=H[0],B=H[1],W=Object(r.useState)({}),J=Object(f.a)(W,2),K=J[0],Y=J[1],Q=a.a.useCallback((function(e){Y((function(t){return t[n]=e,t}))}),[n,Y]);if(Object(r.useEffect)((function(){if(!t||0===t.length)return L(null),null;var e,n={},r=Object(x.a)(t);try{var a=function(){var t=e.value,r=V(t.codes);r=Object.keys(r).reduce((function(e,t){return r[t].active&&r[t].activeParent?(e[t]=r[t],e):e}),{}),n[t.name]=Object(g.a)(Object(g.a)({},t),{},{codeMap:r})};for(r.s();!(e=r.n()).done;)a()}catch(i){r.e(i)}finally{r.f()}L(n),Y({})}),[t,L,Y]),Object(r.useEffect)((function(){null!==P?null===n||"ALL"===n?(B(P),A(null)):(B(Object(m.a)({},n,P[n])),A(n)):B(null)}),[P,n,A,B]),Object(r.useEffect)((function(){j(!1)}),[e]),Object(r.useEffect)((function(){d||A(null)}),[d]),!t)return[null,null,null,!0];var X=Object(ae.jsxs)(cn,{variable:_,fullScreenNode:c,open:d,setOpen:j,tokenRef:E,overwrites:k,children:[Object(ae.jsx)(sn,{variable:_,setVariable:A,setOverwrites:w,variableMap:G,annotations:i,selection:p,setOpen:j,canBeNew:null!==p}),Object(ae.jsx)(ln,{variable:_,variableMap:G,overwrites:k,codeMap:null===G||void 0===G||null===(s=G[_])||void 0===s?void 0:s.codeMap,settings:null===G||void 0===G?void 0:G[_],codeHistory:K[n]||[],annotations:q,setAnnotations:o,selection:p,setOpen:j,setCodeHistory:Q})]});return G&&e||(X=null),[X,function(t,n){z(e[t].ref),F(i[t]||{}),v(n),j(!0)},G,d]},bn=n(29),fn=function(e,t,n){var a=Object(r.useState)({}),i=Object(f.a)(a,2),o=i[0],c=i[1],s=Object(r.useState)(),l=Object(f.a)(s,2),u=l[0],d=l[1];return Object(r.useEffect)((function(){if(!(null===e||void 0===e?void 0:e.text)&&!e.text_fields&&!e.tokens)return null;var r=M(e);t.current={tokens:r.tokens,annotationsChanged:!1,annotations:S()(r.annotations)},c({tokens:r.tokens,text_fields:r.text_fields,meta_fields:r.meta_fields}),d(r.annotations),n&&n(r.tokens)}),[e,n,t]),[o,u,d]},hn=function(e){var t=e.variables,n=e.variable,a=e.setVariable,i=e.height,o=[];null!=t&&(null===t||void 0===t?void 0:t.length)>0&&(o=t.map((function(e){return e.name}))).push("ALL");var c=function(e){var t=0;9===e.keyCode&&(e.preventDefault(),e.shiftKey?e.repeat||(t=-1):e.repeat||(t=1));var r=o.findIndex((function(e){return e===n}))+t;r>o.length-1&&(r=0),r<0&&(r=o.length-1),a(o[r])};if(Object(r.useEffect)((function(){return window.addEventListener("keydown",c),function(){window.removeEventListener("keydown",c)}})),!t||t.length<=1)return null;return null===n&&a(o[0]),Object(ae.jsx)(v.a.Group,{fluid:!0,style:{height:i},children:o.map((function(e){return Object(ae.jsx)(v.a,{active:e===n,style:{padding:"0"},onClick:function(){return a(e)},children:e})}))})},pn=function(e){var t=e.unit,n=e.variables,a=e.settings,i=e.onChangeAnnotations,o=e.returnTokens,c=e.setReady,s=e.blockEvents,l=Object(bn.c)((function(e){return e.fullScreenNode})),u=Object(r.useRef)(null),d=Object(r.useState)(null),j=Object(f.a)(d,2),b=j[0],h=j[1],p=Object(r.useState)(0),v=Object(f.a)(p,2),O=v[0],x=v[1],m=fn(t,u,o),y=Object(f.a)(m,3),k=y[0],w=y[1],C=y[2],_=jn(k.tokens,n,b,w,C,l),A=Object(f.a)(_,4),I=A[0],R=A[1],E=A[2],z=A[3];return Object(r.useEffect)((function(){if(w&&i&&u.current.tokens===k.tokens){if(!u.current.annotationsChanged){if(u.current.annotations===S()(w))return;u.current.annotationsChanged=!0}i(q(w,k.tokens,!0))}}),[k.tokens,w,i]),Object(r.useEffect)((function(){c&&c((function(e){return e+1})),C((function(e){return Object(g.a)({},e)}))}),[O,C,c]),k.tokens?Object(ae.jsxs)(ae.Fragment,{children:[Object(ae.jsx)(hn,{variables:n,variable:b,setVariable:h,height:"30px"}),Object(ae.jsx)(an,{tokens:k.tokens,text_fields:k.text_fields,meta_fields:k.meta_fields,centerVertical:a.centerVertical,setReady:x,height:n&&n.length>1?"calc(100% - 30px)":"100%"}),Object(ae.jsx)(Kt,{tokens:k.tokens,variableMap:E,annotations:w,triggerCodePopup:R,eventsBlocked:z||s,fullScreenNode:l,disableAnnotations:!i||!E}),I||null]}):null},vn=a.a.memo(pn),On=n(223),xn=n.n(On),gn=function(e,t,n,r,a){var i=xn()(r);null!=t&&null!==t||(t=e.length),!n&&t>e.length&&(t=e.length);var o,c,s=Object(_.a)(Array(e.length).keys());null===a?(o=[s],c=[t]):(o=yn(s,a),c=kn(o,t));for(var l=[],u=0;u<o.length;u++)if(n)for(var d=0;d<t;d++)l.push(o[u][Math.floor(i()*o[u].length)]);else{o[u]=mn(o[u],c[u]<o[u].length?c[u]:o[u].length,i);var j,b=Object(x.a)(o[u]);try{for(b.s();!(j=b.n()).done;){var f=j.value;l.push(f)}}catch(h){b.e(h)}finally{b.f()}}return(l=mn(l,l.length,i)).map((function(t){return e[t]}))},mn=function(e,t,n){for(var r,a,i=e.slice(0),o=e.length,c=o-t;o-- >c;)r=i[a=Math.floor((o+1)*n())],i[a]=i[o],i[o]=r;return i.slice(c)},yn=function(e,t){for(var n=[],r={},a=0;a<e.length;a++)null==r[t[a]]&&(r[t[a]]=n.length,n.push([])),n[r[t[a]]].push(e[a]);return n},kn=function(e,t){for(var n=new Array(e.length).fill(0),r=new Array(e.length).fill(0),a=t,i=e.length,o=-1;a>0;){var c=++o%e.length;if(1!==r[c]&&(n[c]++,a--,n[c]===e[c].length&&(r[c]=1,i--)),0===i)break}return n},wn=function(){var e=Object(b.a)(j.a.mark((function e(t,n){var r,a,i,o;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Cn(t);case 2:if(r=e.sent,a=Object(f.a)(r,2),i=a[0],o=a[1],n(o),null!==t.unitSettings.n&&null!=t.unitSettings.n&&t.unitSettings.totalUnits===i){e.next=10;break}return e.next=10,re.setCodingjobProp(t,"unitSettings",Object(g.a)(Object(g.a)({},t.unitSettings),{},{n:i,totalUnits:i}));case 10:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),Cn=function(){var e=Object(b.a)(j.a.mark((function e(t){var n,r,a,i,o,c,s,l,u,d,b,h,p;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null===t||void 0===t?void 0:t.unitSettings){e.next=2;break}return e.abrupt("return",null);case 2:if(n=t.unitSettings.textUnit,r=t.unitSettings,a=0,i=function(e){return r.balanceDocuments||r.balanceAnnotations?e.map((function(e){var t="";return r.balanceDocuments&&(t+=e.docIndex),e.variables&&r.balanceAnnotations&&(t+="_"+Object.values(e.variables)[0]),t})):null},"allTextUnits"!==r.unitSelection){e.next=12;break}return e.next=9,Sn(t,n,new Set([]),!0);case 9:o=e.sent,a=o.length,o=gn(o,r.n,!1,r.seed,i(o));case 12:if("annotations"!==r.unitSelection){e.next=31;break}return e.next=15,_n(t,n,!1,r.validCodes);case 15:if(s=e.sent,l=Object(f.a)(s,2),o=l[0],c=l[1],a=o.length,o=gn(o,r.n,!1,r.seed,i(o)),!(r.annotationMix&&r.annotationMix>0)){e.next=31;break}return u=!1,e.next=25,Sn(t,n,c,u);case 25:d=e.sent,b=Math.ceil(o.length*(r.annotationMix/100)),h=gn(d,b,!u,r.seed,i(o)),p=r.validCodes.length,h=h.map((function(e,t){var n;r.balanceAnnotations?n=r.validCodes[t%p]:n=o[t%o.length].value;return e.variables=Object(m.a)({},r.annotation,n),Object(g.a)({},e)})),o=o.concat(h);case 31:return o=Rn(o,r),e.abrupt("return",[a,o]);case 33:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Sn=function(){var e=Object(b.a)(j.a.mark((function e(t,n,r,a){var i,o,c,s,l;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,re.getDocuments(t);case 2:return i=e.sent,o=0,c=1/0,t.unitSettings.useIndexWindow&&(o=t.unitSettings.indexWindow[0],c=t.unitSettings.indexWindow[1]),s=[],l=-1,e.next=10,i.each((function(e){if(l++,"document"===n&&!r.has(e.doc_uid)){if(a&&r.has(e.doc_uid))return;s.push({textUnit:n,unitIndex:0,doc_uid:e.doc_uid,document_id:e.document_id,textFields:An(e),metaFields:In(e),docIndex:l})}if("paragraph"===n)for(var t=e.tokens[e.tokens.length-1].paragraph,i=o;i<=Math.min(c,t);i++){if(a&&r.has(e.doc_uid+"_"+i))return;s.push({textUnit:n,unitIndex:i,doc_uid:e.doc_uid,document_id:e.document_id,textFields:An(e),metaFields:In(e),docIndex:l})}if("sentence"===n)for(var u=e.tokens[e.tokens.length-1].sentence,d=o;d<=Math.min(c,u);d++){if(a&&r.has(e.doc_uid+"_"+d))return;s.push({textUnit:n,unitIndex:d,doc_uid:e.doc_uid,document_id:e.document_id,textFields:An(e),metaFields:In(e),docIndex:l})}}));case 10:return e.abrupt("return",s);case 11:case"end":return e.stop()}}),e)})));return function(t,n,r,a){return e.apply(this,arguments)}}(),_n=function(){var e=Object(b.a)(j.a.mark((function e(t,n,r,a){var i,o,c,s,l,u;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,re.getDocuments(t);case 2:return i=e.sent,o=t.unitSettings.annotation,c=null,(null===a||void 0===a?void 0:a[o])&&(c=a[o].reduce((function(e,t){return t.valid?(e[t.code]=!0,e):e}),{})),s=[],l=new Set([]),u=-1,e.next=11,i.each((function(e){if(u++,e.annotations)for(var t=0,a=Object.keys(e.annotations);t<a.length;t++)for(var i=a[t],d=0,j=Object.keys(e.annotations[i]);d<j.length;d++){var b=j[d];if(b===o){if(i>e.annotations[i][b][0]){if("document"===n)continue;if("span"===n)continue;if("paragraph"===n&&e.tokens[i].paragraph===e.tokens[i-1].paragraph)continue;if("sentence"===n&&e.tokens[i].sentence===e.tokens[i-1].sentence)continue}if(!c||null!=c[e.annotations[i][b].value]){var f={textUnit:n,doc_uid:e.doc_uid,document_id:e.document_id,docIndex:u,textFields:An(e),metaFields:In(e),span:e.annotations[i][b].span};if("document"!==n&&"span"!==n||(f.unitIndex=Number(i)),"paragraph"===n&&(f.unitIndex=e.tokens[Number(i)].paragraph),"sentence"===n&&(f.unitIndex=e.tokens[Number(i)].sentence),r){var h=f.doc_uid+"_"+f.textUnit+"_"+f.unitIndex;if(l.has(h))continue;l.add(h)}else f.variables=Object(m.a)({},b,e.annotations[i][b].value);s.push(f)}}}}));case 11:return e.abrupt("return",[s,l]);case 12:case"end":return e.stop()}}),e)})));return function(t,n,r,a){return e.apply(this,arguments)}}(),An=function(e){if(e.text_fields)return e.text_fields.map((function(e){return e.name}));if(e.tokens){var t,n=new Set,r=Object(x.a)(e.tokens);try{for(r.s();!(t=r.n()).done;){var a=t.value;n.add(a.section)}}catch(i){r.e(i)}finally{r.f()}return Object(_.a)(n)}return[]},In=function(e){return e.meta_fields?e.meta_fields.map((function(e){return e.name})):[]},Rn=function(e,t){return t.ordered?e.sort((function(e,t){return e.docIndex!==t.docIndex?e.docIndex-t.docIndex:e.unitIndex!==t.unitIndex?e.unitIndex-t.unitIndex:null!=e.annotation&&e.annotation.index!==t?e.annotation.index-t.annotation.index:0})):e},En=function(e){var t=Object(r.useState)(null),n=Object(f.a)(t,2),a=n[0],i=n[1];return Object(r.useEffect)((function(){if(!(null===e||void 0===e?void 0:e.unitSettings))return null;wn(e,i)}),[e,i]),e?a:null},zn=function(e,t,n,r){var a=[];if(0===e.length)return a;var i=[0,e.length-1],o=[0,e.length-1];"span"===t.textUnit&&(i=t.span),"paragraph"!==t.textUnit&&"sentence"!==t.textUnit||(i=Tn(e,t.textUnit,t.unitIndex,t.unitIndex)),"paragraph"!==n&&"sentence"!==n||(o=Dn(e,i,n,r)),"none"===n&&(o=i);for(var c=0;c<e.length;c++)if(e[c].codingUnit=!0,e[c].index<i[0]&&(e[c].codingUnit=!1),e[c].index>i[1]&&(e[c].codingUnit=!1),!(e[c].index<o[0])){if(e[c].index>o[1])break;a.push(e[c])}return a},Tn=function(e,t,n,r){var a=[e[0].index,e[e.length-1].index],i=e.find((function(e){return e[t]===n}));i&&(a[0]=i.index);var o=e.find((function(e){return e[t]===r+1}));return o&&(a[1]=o.index-1),a},Dn=function(e,t,n,r){var a=-e[0].index,i=[e[t[0]+a][n],e[t[1]+a][n]];return i[0]=i[0]-r[0],i[1]=i[1]+r[1],Tn(e,n,i[0],i[1])},qn=function(){var e=Object(b.a)(j.a.mark((function e(t,n){var r,a,i,o,c,s,l,u,d;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=t.unitSettings,a=r.contextUnit,i=r.contextWindow,o=r.layout,c={},s=[],l=S()(t),u=j.a.mark((function e(t){var r,u,d,b,f,h,p,v,O,x;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=n[t].doc_uid,c[r]){e.next=5;break}return e.next=4,re.getDocument(r);case 4:c[r]=e.sent;case 5:u=zn(c[r].tokens,n[t],a,i),d=q(c[r].annotations,c[r].tokens),b=u.map((function(e){return e.codingUnit})),f=b.indexOf(!0),h=b.lastIndexOf(!0),p=u[f].offset,v=u[h].offset+u[h].length,O=d.filter((function(e){return e.offset>=p&&e.offset<v})),x={document_id:n[t].document_id,provenance:{unit:n[t].textUnit,unit_index:n[t].unitIndex},meta_fields:c[r].meta_fields,annotations:O,variables:n[t].variables},c[r].importedTokens?(x.tokens=D(u),x.text_fields=Object.keys(o.text).reduce((function(e,t){return e.push(Object(g.a)({name:t},o.text[t])),e}),[])):(x.text_fields=Fn(u),x.text_fields=x.text_fields.map((function(e){return Object(g.a)(Object(g.a)({},e),o.text[e.name])}))),x.meta_fields=x.meta_fields.map((function(e){return Object(g.a)(Object(g.a)({},e),o.meta[e.name])})),x.unit_id=S()({jobhash:l,unit:x,date:Date()}),s.push(x);case 18:case"end":return e.stop()}}),e)})),d=0;case 6:if(!(d<n.length)){e.next=11;break}return e.delegateYield(u(d),"t0",8);case 8:d++,e.next=6;break;case 11:return e.abrupt("return",s);case 12:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),Fn=function(e){var t=[];if(0===e.length)return t;var n=null,r=null,a="",i=e[0].section,o={};e[0].offset>0&&(o.offset=e[0].offset);var c,s=!1,l=!1,u=Object(x.a)(e);try{for(u.s();!(c=u.n()).done;){var d=c.value;if(d.section!==i){var j=Object(g.a)({name:i,value:a},o);null!==n&&(j.unit_start=n),null!==r&&(j.unit_end=r),t.push(j),o={},d.offset>0&&(o.offset=d.offset),n=null,r=null,a=""}!s&&d.codingUnit&&(n=d.offset,s=!0),!s||l||d.codingUnit||(r=d.offset-1,l=!0),a=a+d.pre+d.text+d.post,i=d.section}}catch(f){u.e(f)}finally{u.f()}if(a.length>0){var b=Object(g.a)({name:i,value:a},o);null!==n&&(b.unit_start=n),null!==r&&(b.unit_end=r),t.push(b)}return t},Nn=n(304),Un=function(e){var t=e.children,n=e.header,r=e.texts,a=e.type;return Object(ae.jsxs)(ft.a,{wide:!0,trigger:Object(ae.jsx)(v.a,{circular:!0,icon:"warn"===a?"exclamation":"question",size:"mini",style:{position:"absolute",marginTop:"-0.6em",marginLeft:"0.2em",paddingLeft:"0.1em",paddingRight:"0.1em",paddingTop:"0.2em",paddingBottom:"0.2em",background:"warn"===a?"orange":"white",color:"black",border:"1px solid grey"}}),children:[n?Object(ae.jsx)("h3",{children:n}):null,r?r.map((function(e,t){return Object(ae.jsx)("p",{children:e},t)})):null,t]})},Pn=function(e){e.preGlobalFilteredRows;var t=e.globalFilter,n=e.setGlobalFilter;return Object(ae.jsx)("span",{children:Object(ae.jsx)("input",{value:t||"",onChange:function(e){n(e.target.value||void 0)},placeholder:"Enter search term",style:{border:"0"}})})},Ln=function(e){var t=e.columns,n=e.data,r=e.setData,a=e.width,i=void 0===a?null:a,o=e.defaultSize,c=void 0===o?10:o,s=Object(ze.useTable)({columns:t,data:n,initialState:{pageIndex:0,pageSize:c,globalFilter:""},autoResetPage:!1},ze.useGlobalFilter,ze.useSortBy,ze.usePagination),l=s.getTableProps,u=s.getTableBodyProps,d=s.headerGroups,j=s.prepareRow,b=s.page,f=s.pageCount,h=s.gotoPage,p=s.preGlobalFilteredRows,v=s.setGlobalFilter,x=s.state,m=x.pageIndex,y=x.globalFilter,k=function(e){var t=Object(ae.jsx)(Te.a,{width:3,children:"Include"}),n=e.headers.map((function(e){return Object(ae.jsxs)(Te.a,Object(g.a)(Object(g.a)({className:e.headerClass},e.getHeaderProps(e.getSortByToggleProps())),{},{children:[e.render("Header"),Object(ae.jsx)("span",{children:e.isSorted?e.isSortedDesc?" \ud83d\udd3d":" \ud83d\udd3c":""})]}))}));return[t].concat(Object(_.a)(n))};return Object(ae.jsxs)("div",{style:{width:i},children:[Object(ae.jsx)(Pn,{preGlobalFilteredRows:p,globalFilter:y,setGlobalFilter:v}),Object(ae.jsxs)(Fe.a,Object(g.a)(Object(g.a)({definition:!0,compact:!0,unstackable:!0,fixed:!0,singleLine:!0,selectable:!0},l()),{},{size:"small",style:{fontSize:"10px",overflowY:"auto"},children:[Object(ae.jsx)(Ne.a,{children:d.map((function(e){return Object(ae.jsx)(De.a,Object(g.a)(Object(g.a)({},e.getHeaderGroupProps()),{},{children:k(e)}))}))}),Object(ae.jsx)(Ue.a,Object(g.a)(Object(g.a)({},u()),{},{children:function(e){return e.map((function(e,t){return j(e),Object(ae.jsxs)(De.a,Object(g.a)(Object(g.a)({onClick:function(){return t=e.index,n[t].valid=!n[t].valid,void r(n);var t}},e.getRowProps()),{},{children:[Object(ae.jsx)(qe.a,{style:{padding:"1px 5px"},children:Object(ae.jsx)(Nn.a,{toggle:!0,checked:e.original.valid})}),e.cells.map((function(e){return Object(ae.jsx)(qe.a,Object(g.a)(Object(g.a)({title:e.value},e.getCellProps()),{},{style:{padding:"1px 5px"},children:e.render("Cell")}))}))]}))}))}(b)})),Object(ae.jsx)(Fe.a.Footer,{children:Object(ae.jsx)(Fe.a.Row,{children:Object(ae.jsx)(Fe.a.HeaderCell,{colSpan:t.length+1,children:n.length>c?Object(ae.jsx)(Pe.a,{floated:"right",style:{border:"0"},size:"mini",firstItem:!1,lastItem:!1,nextItem:!1,prevItem:!1,boundaryRange:1,ellipsisItem:{content:Object(ae.jsx)(O.a,{name:"ellipsis horizontal"}),icon:!0},activePage:m+1,totalPages:f,onPageChange:function(e,t){h(t.activePage-1)}}):null})})})]}))]})},Mn=function(e){var t=e.codingjob,n=e.units,r=null===t||void 0===t?void 0:t.unitSettings;return r?Object(ae.jsxs)("div",{style:{verticalAlign:"top",float:"top",paddingLeft:"1em"},children:[Object(ae.jsx)(Hn,{unitSettings:r,setUnitSettings:function(e){re.setCodingjobProp(t,"unitSettings",e)}}),Object(ae.jsx)(Bn,{codingjob:t,units:n})]}):null},Hn=a.a.memo((function(e){var t=e.unitSettings,n=e.setUnitSettings,a=Object(r.useState)(null),i=Object(f.a)(a,2),o=i[0],c=i[1],s=Object(r.useState)(100),l=Object(f.a)(s,2),u=l[0],d=l[1],j=t.totalUnits||0;Object(r.useEffect)((function(){d(Math.round(100*t.n/j)),c(t)}),[j,t,c]),Object(r.useEffect)((function(){if(o===t)return null;var e=setTimeout((function(){n(o)}),300);return function(){return clearTimeout(e)}}),[o,t,n]);var b=function(e,r){n(Object(g.a)(Object(g.a)({},t),{},Object(m.a)({},e,r)))};return null===o?null:Object(ae.jsxs)(Oe.a,{children:[Object(ae.jsxs)(Oe.a.Group,{children:[Object(ae.jsx)(O.a,{name:"setting"}),Object(ae.jsxs)("div",{children:[Object(ae.jsx)("label",{children:"Sample settings"}),Object(ae.jsx)(Un,{header:"Sampling and shuffling",texts:["If % < 100, a random sample will be drawn.","If shuffle is enabled, the order of the units will be randomized.","Seed initializes the random number generator. Simply put, using the same seed gives the same 'random' results if the data is the same."]})]})]}),Object(ae.jsxs)(Oe.a.Group,{children:[Object(ae.jsx)(Oe.a.Field,{width:8,min:1,max:j,label:"N",size:"mini",control:ht.a,type:"number",value:o.n,onChange:function(e,t){var n=Number(t.value);d(Math.round(100*n/j)),c((function(e){return Object(g.a)(Object(g.a)({},e),{},{n:n})}))}}),Object(ae.jsx)(Oe.a.Field,{width:8,min:0,step:5,max:100,label:"%",size:"mini",control:ht.a,type:"number",value:u,onChange:function(e,t){var n=Number(t.value),r=Math.ceil(n/100*j);r>=0&&(d(n),c((function(e){return Object(g.a)(Object(g.a)({},e),{},{n:r})})))}})]}),Object(ae.jsxs)(Oe.a.Group,{children:[Object(ae.jsxs)(Oe.a.Field,{width:8,children:[Object(ae.jsx)("label",{children:"Shuffle"}),Object(ae.jsx)(Nn.a,{toggle:!0,size:"mini",checked:!t.ordered,onChange:function(e,t){b("ordered",!t.checked)}})]}),Object(ae.jsxs)(Oe.a.Field,{width:8,children:[Object(ae.jsx)("label",{children:"Seed"}),Object(ae.jsx)(ht.a,{size:"mini",type:"number",min:1,value:o.seed,onChange:function(e,t){c((function(e){return Object(g.a)(Object(g.a)({},e),{},{seed:Number(t.value)})}))}})]})]}),Object(ae.jsxs)(Oe.a.Group,{grouped:!0,widths:"equal",children:[Object(ae.jsxs)(Oe.a.Field,{children:[Object(ae.jsx)("b",{children:"Balance"}),Object(ae.jsx)(Un,{header:"Balanced sampling",texts:["Balance sampled Units evenly over groups. Uses a simple approach where unique groups are created (documents, codes, or documentsXcodes), and samples are drawn from these groups one by one","For documents: get an equal number of paragraphs, sentences or annotations per document.","For codes: if units are annotations, get an equal number annotations for each unique code."]})]}),Object(ae.jsx)(Oe.a.Field,{children:Object(ae.jsx)(Nn.a,{size:"mini",label:"documents",checked:t.balanceDocuments,onChange:function(e,t){b("balanceDocuments",t.checked)}})}),Object(ae.jsx)(Oe.a.Field,{children:Object(ae.jsx)(Nn.a,{disabled:"annotations"!==t.unitSelection,size:"mini",label:"codes",checked:t.balanceAnnotations,onChange:function(e,t){b("balanceAnnotations",t.checked)}})})]}),Object(ae.jsx)("br",{})]})})),Gn=[{Header:"Code",accessor:"code",headerClass:"ten wide"},{Header:"N",accessor:"N",headerClass:"two wide"}],Bn=function(e){var t,n,i,o=e.codingjob,c=e.units,s=null===o||void 0===o||null===(t=o.unitSettings)||void 0===t?void 0:t.annotation,l=null===o||void 0===o||null===(n=o.unitSettings)||void 0===n?void 0:n.validCodes,u="annotations"===(null===o||void 0===o||null===(i=o.unitSettings)||void 0===i?void 0:i.unitSelection),d=Object(r.useState)([]),j=Object(f.a)(d,2),b=j[0],h=j[1],p=a.a.useCallback((function(e){var t=Object(g.a)(Object(g.a)({},o.unitSettings),{},{validCodes:Object(g.a)(Object(g.a)({},l),{},Object(m.a)({},s,e))});re.setCodingjobProp(o,"unitSettings",t)}),[o,l,s]);return Object(r.useEffect)((function(){if(c&&0!==c.length&&l&&s&&u&&l[s]&&c[0].variables){var e=c.reduce((function(e,t){var n=Object.values(t.variables)[0];return e[n]||(e[n]=0),e[n]++,e}),{});h(l[s].map((function(t){return Object(g.a)(Object(g.a)({},t),{},{N:e[t.code]})})))}}),[l,c,h,s,u]),Object(r.useEffect)((function(){var e;if(!l||!s||!u)return null;if(!l[s]){var t=null===(e=o.importedCodes)||void 0===e?void 0:e[s];t&&p(t.map((function(e){return{code:e.code,valid:!0}})))}}),[o,s,u,p,l]),l&&s&&u&&l[s]?Object(ae.jsxs)(Oe.a,{children:[Object(ae.jsxs)(Oe.a.Group,{children:[Object(ae.jsx)(O.a,{name:"setting"}),Object(ae.jsx)("div",{children:Object(ae.jsx)("label",{children:"Select annotation codes"})})]}),Object(ae.jsx)(Ln,{columns:Gn,data:b,setData:p})]}):null},Wn=a.a.memo(Mn),Vn=function(e){var t=e.n,n=e.index,a=e.setIndex,i=e.canGoForward,o=void 0===i||i,c=e.canGoBack,s=void 0===c||c,l=(e.quickKeyNext,Object(r.useRef)(0)),u=Object(r.useRef)(!1),d=Object(r.useState)(!1),j=Object(f.a)(d,2),b=j[0],h=j[1],p=Object(r.useState)(1),v=Object(f.a)(p,2),O=v[0],x=v[1],g=Object(r.useState)(1),m=Object(f.a)(g,2),y=m[0],k=m[1];return Object(r.useEffect)((function(){null!==n&&x(Math.min(n+1,t+1)),null===n&&x(t+1)}),[n,t,x]),Object(r.useEffect)((function(){l.current=0,u.current=!1}),[t]),Object(r.useEffect)((function(){if(!t)return null;x(1),u.current=!0}),[t,x]),Object(r.useEffect)((function(){if(!t)return null;l.current=Math.max(O,l.current),a(O-1===t?null:O-1),k(O)}),[t,a,O]),Object(r.useEffect)((function(){if(!t)return null;if(O===y)return h(!1),null;h(!0);var e=setTimeout((function(){x(y),h(!1)}),500);return function(){return clearTimeout(e)}}),[O,y,t,h]),t?Object(ae.jsxs)(xe.a,{style:{border:"none",boxShadow:"none",padding:"0",leftMargin:"0px",width:"100%",maxHeight:"35px",borderRadius:"0"},children:[Object(ae.jsx)(Ee.a,{active:b,content:""}),Object(ae.jsx)(ht.a,{style:{padding:"0 !important",margin:"0",width:"100%"},min:1,max:t+1,onChange:function(e,t){(o||Number(t.value)<l.current)&&Number(t.value)>y&&k(Number(t.value)),s&&Number(t.value)<y&&k(Number(t.value))},type:"range",labelPosition:"left",label:Object(ae.jsx)(Pe.a,{secondary:!0,activePage:y,pageItem:y<=t?"".concat(y," / ").concat(t):"done / ".concat(t),size:"mini",firstItem:null,lastItem:null,prevItem:s?"back":"   ",nextItem:o||O<l.current?"next":"   ",siblingRange:0,boundaryRange:0,ellipsisItem:null,totalPages:t+1,onClick:function(e,t){return e.stopPropagation()},onPageChange:function(e,t){(o||O<l.current)&&Number(t.activePage)>O&&x(Number(t.activePage)),s&&Number(t.activePage)<O&&x(Number(t.activePage))},style:{fontSize:"9px",border:"none",boxShadow:"none",padding:0,margin:0}}),value:y})]}):null},Jn=function(e){var t={label:e.toUpperCase().replaceAll("_"," "),bold:!1,italic:!1,size:1};return["title","headline"].includes(e)&&(t.size=1,t.bold=!0),t},Kn=function(e){e.codingjob;var t=e.unitSettings,n=e.setUnitSettings,r=e.fields;return Object(ae.jsx)(Yn,{fields:r,unitSettings:t,setUnitSettings:n})},Yn=function(e){var t=e.fields,n=e.unitSettings,r=e.setUnitSettings,a=function(e,t,a,i){var o=Object(g.a)({},n.layout);o[e][t][a]=i,r(Object(g.a)(Object(g.a)({},n),{},{layout:o}))},i=function(e,t,n){return Object(ae.jsx)(ht.a,{value:t[n].label,style:{width:"100%",padding:"0"},onChange:function(t,r){return a(e,n,"label",r.value)}})},o=function(e,t,n){return Object(ae.jsx)(Nn.a,{checked:t[n].bold,onChange:function(){return a(e,n,"bold",!t[n].bold)}})},c=function(e,t,n){return Object(ae.jsx)(Nn.a,{checked:t[n].italic,onChange:function(){return a(e,n,"italic",!t[n].italic)}})},s=function(e,t,n){return Object(ae.jsx)(ht.a,{value:t[n].size,type:"number",min:0,max:5,step:.1,style:{width:"100%",padding:"0",border:"none"},onChange:function(t,r){var i=Number(r.value);isNaN(i)||a(e,n,"size",i)}})},l=function(e,t){var n=Object.keys(t).length;return Object.keys(t).map((function(r,a){return Object(ae.jsxs)(Fe.a.Row,{children:[0===a?Object(ae.jsx)(Fe.a.Cell,{rowSpan:n,children:Object(ae.jsx)("b",{children:e})}):null,Object(ae.jsx)(Fe.a.Cell,{children:r}),Object(ae.jsx)(Fe.a.Cell,{style:{padding:"2px"},children:i(e,t,r)}),Object(ae.jsx)(Fe.a.Cell,{style:{padding:"2px"},children:s(e,t,r)}),Object(ae.jsx)(Fe.a.Cell,{style:{textAlign:"center"},children:o(e,t,r)}),Object(ae.jsx)(Fe.a.Cell,{style:{textAlign:"center"},children:c(e,t,r)})]})}))};return Object(ae.jsxs)(Fe.a,{celled:!0,structured:!0,compact:!0,unstackable:!0,singleLine:!0,children:[Object(ae.jsx)(Fe.a.Header,{children:Object(ae.jsxs)(Fe.a.Row,{children:[Object(ae.jsx)(Fe.a.HeaderCell,{width:2}),Object(ae.jsx)(Fe.a.HeaderCell,{width:4,children:"field"}),Object(ae.jsx)(Fe.a.HeaderCell,{width:3,children:"label"}),Object(ae.jsx)(Fe.a.HeaderCell,{width:3,children:"text size"}),Object(ae.jsx)(Fe.a.HeaderCell,{width:1,children:Object(ae.jsx)(O.a,{name:"bold"})}),Object(ae.jsx)(Fe.a.HeaderCell,{width:1,children:Object(ae.jsx)(O.a,{name:"italic"})})]})}),Object(ae.jsxs)(Fe.a.Body,{children:[l("meta",t.meta),l("text",t.text)]})]})},Qn=function(e){var t=e.codingjob,n=e.units,a=Object(r.useState)({text:[],meta:[]}),i=Object(f.a)(a,2),o=i[0],c=i[1],s=null===t||void 0===t?void 0:t.unitSettings;return Object(r.useEffect)((function(){if((null===s||void 0===s?void 0:s.layout)&&n){var e,t=s.layout,r=Object(x.a)(n);try{for(r.s();!(e=r.n()).done;){var a=e.value;if(a.textFields){var i,o=Object(x.a)(a.textFields);try{for(o.s();!(i=o.n()).done;){var l=i.value;t.text[l]||(t.text[l]=Jn(l))}}catch(b){o.e(b)}finally{o.f()}}if(a.metaFields){var u,d=Object(x.a)(a.metaFields);try{for(d.s();!(u=d.n()).done;){var j=u.value;t.meta[j]||(t.meta[j]=Jn(j))}}catch(b){d.e(b)}finally{d.f()}}}}catch(b){r.e(b)}finally{r.f()}c(t)}}),[n,s]),s?Object(ae.jsx)(Kn,{codingjob:t,unitSettings:s,setUnitSettings:function(e){re.setCodingjobProp(t,"unitSettings",e)},fields:o}):null},Xn=function(e){var t=e.codingjob,n=En(t);return t?Object(ae.jsx)("div",{children:Object(ae.jsxs)(ve.a,{stackable:!0,celled:"internally",columns:3,children:[Object(ae.jsxs)(ve.a.Column,{verticalAlign:"top",stretched:!0,width:6,children:[Object(ae.jsx)(p.a,{textAlign:"center",style:{background:"#1B1C1D",color:"white"},children:"Define Coding Units"}),Object(ae.jsx)(mt,{codingjob:t}),Object(ae.jsx)("br",{}),Object(ae.jsx)(p.a,{textAlign:"center",style:{background:"#1B1C1D",color:"white"},children:"Coding Unit Layout"}),Object(ae.jsx)(Qn,{codingjob:t,units:n})]}),Object(ae.jsxs)(ve.a.Column,{width:4,children:[Object(ae.jsx)(p.a,{textAlign:"center",style:{background:"#1B1C1D",color:"white"},children:"Select Units"}),Object(ae.jsx)(Wn,{codingjob:t,units:n})]}),Object(ae.jsxs)(ve.a.Column,{width:6,children:[Object(ae.jsx)(p.a,{textAlign:"center",style:{background:"#1B1C1D",color:"white"},children:"Unit preview"}),Object(ae.jsx)(Zn,{units:n,codingjob:t,codebook:{}})]})]})}):null},Zn=function(e){var t=e.units,n=e.codingjob,a=e.codebook,i=Object(r.useState)(null),o=Object(f.a)(i,2),c=o[0],s=o[1],l=Object(r.useState)(null),u=Object(f.a)(l,2),d=u[0],j=u[1];Object(r.useEffect)((function(){if(!(null===t||void 0===t?void 0:t[c]))return null;qn(n,[t[c]]).then((function(e){var t=e[0];t.post=function(e){return console.log(e)},j(t)}))}),[t,c,j,n]);return!(null===t||void 0===t?void 0:t.length)>0?null:Object(ae.jsxs)(ve.a.Column,{width:6,children:[Object(ae.jsx)(Vn,{n:null===t||void 0===t?void 0:t.length,index:c,setIndex:s}),d?Object(ae.jsxs)(ae.Fragment,{children:[Object(ae.jsx)(Re.a,{inverted:!0,active:null===d,children:Object(ae.jsx)(Ee.a,{})}),Object(ae.jsx)(vn,{unit:d,codes:null===a||void 0===a?void 0:a.codes,settings:{}})]}):null]})},$n=a.a.memo(Xn),er=n(326),tr=n(323),nr=n(125),rr=function(e){return{type:"BLOCK_EVENTS",block:e}},ar=function(e){return{type:"SET_FULL_SCREEN_NODE",node:e}},ir=n(217),or=function(e,t,n,r){for(var a=e.findIndex((function(e){return e.code===t.code})),i=null,o=e[a].parent,c=0;c<e.length;c++)c!==a&&e[c].parent===o&&("down"===n&&c>a&&(null===i||i>c)&&(i=c),"up"===n&&c<a&&(null===i||i<c)&&(i=c));if(null===i)return null;var s=Object(_.a)(e),l=s[a];s[a]=s[i],s[i]=l,r(s)},cr=function(e){e.codeMap;var t=e.code,n=e.codes,a=e.setCodes,i=e.setOpen,o=Object(r.useState)([]),c=Object(f.a)(o,2),s=c[0],l=c[1],u=Object(r.useState)(""),d=Object(f.a)(u,2),j=d[0],b=d[1],h=function(e){if(""===e)return null;var r=Q(e,t,n,n.filter((function(e){return e.frozen}))),o=Object(f.a)(r,2),c=o[0],s=o[1];if(s.length>0)return l(s),null;a(c),i(!1)};return Object(ae.jsxs)("div",{style:{margin:"1em",height:"200px"},children:[Object(ae.jsxs)("p",{children:[""===t?"Create new codes":Object(ae.jsxs)(ae.Fragment,{children:["Add codes under ",Object(ae.jsx)("b",{children:t})]}),Object(ae.jsx)(v.a,{floated:"right",compact:!0,size:"mini",icon:"delete",onClick:function(){return i(!1)}})]}),Object(ae.jsxs)(Oe.a,{onSubmit:function(){return h(j)},children:[Object(ae.jsxs)(ft.a,{open:s.length>0,trigger:Object(ae.jsx)(tr.a,{autoFocus:!0,onChange:function(e,t){b(t.value),l([])},value:j,style:{height:"130px"},placeholder:"Every line becomes a new code"}),children:["Duplicate labels: ",Object(ae.jsx)("br",{}),Object(ae.jsx)("b",{children:s.join(", ")})]}),Object(ae.jsx)(v.a,{fluid:!0,content:"Create",onClick:function(){return h(j)}})]})]})},sr=function(e){var t=e.codeMap,n=e.code,r=e.codes,a=e.setCodes,i=e.setOpen,o=function(e){var o=r.filter((function(e){return e.code!==n})),c=[];e?o=o.map((function(e){return t[n].children.includes(e.code)&&(e.parent=t[n].parent),e})):(ur(t,n,c),o=o.filter((function(e){return!c.includes(e.code)}))),a(o),i(!1)};return Object(ae.jsxs)("div",{style:{margin:"1em"},children:[Object(ae.jsxs)("p",{children:["Delete ",Object(ae.jsx)("b",{children:n}),"?"]}),Object(ae.jsxs)(ir.a,{fluid:!0,children:[t[n].children.length>0?Object(ae.jsxs)(ae.Fragment,{children:[Object(ae.jsx)(v.a,{color:"red",onClick:function(){return o(!1)},children:"Yes"}),Object(ae.jsx)(v.a,{color:"red",onClick:function(){return o(!0)},children:"Yes, but keep children"})]}):Object(ae.jsx)(v.a,{color:"red",onClick:function(){return o(!0)},children:"Yes"}),Object(ae.jsx)(v.a,{onClick:function(){return i(!1)},children:"Cancel"})]})]})},lr=function(e){var t=e.codeMap,n=e.code,a=e.codes,i=e.setCodes,o=e.setOpen,c=e.frozen,s=Object(r.useState)(t[n].parent),l=Object(f.a)(s,2),u=l[0],d=l[1],j=Object(r.useState)(n),b=Object(f.a)(j,2),h=b[0],p=b[1],O=["ROOT"].concat(Object(_.a)(dr(t,n))),x=function(e,r){if(e!==n){if(""===e)return null;if(t[e])return null}var c=!0,s=a.map((function(t){return t.code===n&&(t.code=e,t.parent=r,c=!1),t.parent===n&&(t.parent=e),t}));c&&a.push({code:e,parent:r,active:!0}),a=a.filter((function(e){return"ROOT"!==e.parent})),i(s),o(!1)};return Object(ae.jsxs)("div",{style:{margin:"1em"},children:[Object(ae.jsxs)("p",{children:[c?"Change parent":"Change parent and/or label",Object(ae.jsx)(v.a,{floated:"right",compact:!0,size:"mini",icon:"delete",onClick:function(){return o(!1)}})]}),Object(ae.jsxs)(Oe.a,{onSubmit:function(){return x(h,u)},children:[Object(ae.jsxs)(Oe.a.Field,{inline:!0,children:[Object(ae.jsx)("label",{style:{color:"white"},children:"Parent:"}),Object(ae.jsx)(Qe.a,{value:u,style:{minWidth:"10em"},options:O.map((function(e,t){return{key:e,value:e,text:e}})),search:!0,selectOnNavigation:!1,minCharacters:0,autoComplete:"on",onChange:function(e,t){d(t.value)}})]}),c?null:Object(ae.jsxs)(Oe.a.Field,{inline:!0,children:[Object(ae.jsx)("label",{style:{color:"white"},children:"Code:"}),Object(ae.jsx)(ht.a,{autoFocus:!0,onChange:function(e,t){p(t.value)},value:h,placeholder:"new code"})]}),Object(ae.jsx)(v.a,{fluid:!0,onClick:function(){return x(h,u)},children:"Change"})]})]})},ur=function e(t,n,r){var a,i=Object(x.a)(t[n].children);try{for(i.s();!(a=i.n()).done;){var o=a.value;r.push(o),e(t,o,r)}}catch(c){i.e(c)}finally{i.f()}},dr=function(e,t){var n=[];return ur(e,t,n),Object.keys(e).filter((function(e){return!n.includes(e)&&e!==t}))},jr=function(e){var t=e.codeMap,n=e.code,a=e.codes,i=e.setCodes,o=e.toggleActiveCode,c=e.setChangeColor,s=e.canAdd,l=Object(bn.b)(),u=Object(r.useState)(!1),d=Object(f.a)(u,2),j=d[0],b=d[1],h=Object(r.useState)(null),p=Object(f.a)(h,2),O=p[0],x=p[1];Object(r.useEffect)((function(){return l(rr(j)),function(){l(rr(!1))}}),[l,j]);var m={padding:"0",margin:"0",width:"15px",borderRadius:"0",minHeight:"10px"},y=function(){return n.code||null!=n.active?Object(ae.jsx)(v.a,{size:"mini",as:"Input",style:Object(g.a)(Object(g.a)({},m),{},{padding:"10px 0px",background:n.color||"white"}),onInput:function(e){return c({code:n.code,color:e.target.value})},type:"color",value:n.color||"white"}):null},k=function(e){x(Object(ae.jsx)(cr,{codeMap:t,code:e?"":n.code,codes:a,setCodes:i,setOpen:b})),b(!0)},w=function(){x(Object(ae.jsx)(sr,{codeMap:t,code:n.code,codes:a,setCodes:i,setOpen:b})),b(!0)},C=function(){x(Object(ae.jsx)(lr,{codeMap:t,code:n.code,codes:a,setCodes:i,setOpen:b,frozen:n.frozen})),b(!0)},S=function(e){or(a,n,e,i),b(!1)};return Object(ae.jsx)(ft.a,{inverted:!0,size:"mini",flowing:!0,hoverable:!0,mouseLeaveDelay:99999999,open:j,onClose:function(){return b(!1)},trigger:""===n?s?Object(ae.jsxs)(ir.a,{fluid:!0,color:"black",children:[Object(ae.jsx)(v.a,{content:"Add codes",onClick:function(){return k(!0)},style:m}),";"]}):null:Object(ae.jsxs)(ir.a,{color:"black",attached:!0,fluid:!0,size:"mini",style:{padding:"0",margin:"0"},children:[Object(ae.jsx)(v.a,{size:"mini",icon:n.active&&n.activeParent?"toggle on":"toggle off",onClick:function(){return o(a,n.code,!n.active,i)},style:Object(g.a)(Object(g.a)({},m),{},{color:n.active&&n.activeParent?"green":"red"})}),Object(ae.jsx)(v.a,{icon:"arrow up",compact:!0,size:"mini",onClick:function(){return S("up")},style:m}),Object(ae.jsx)(v.a,{icon:"arrow down",compact:!0,size:"mini",onClick:function(){return S("down")},style:m}),Object(ae.jsx)(v.a,{disabled:!s,icon:"plus",compact:!0,size:"mini",onClick:function(){return k(!1)},style:m}),Object(ae.jsx)(v.a,{disabled:n.frozen,icon:"minus",compact:!0,size:"mini",onClick:w,style:m}),Object(ae.jsx)(v.a,{icon:"edit",compact:!0,size:"mini",onClick:C,style:m}),y()]}),style:{padding:"0",margin:"0"},children:O})},br=function(e,t,n,r){if(!t)return null;var a=fr(e,t,n),i=n.makes_irrelevant.map((function(e){return"Skip_"+e})),o=n.required_for.map((function(e){return"Required for_"+e})),c=[].concat(Object(_.a)(i),Object(_.a)(o)),s=c.filter((function(e){return a.some((function(t){return t.value===e}))}));return s.length<c.length&&r(n.code,s),Object(ae.jsx)(Qe.a,{multiple:!0,header:"Determine how this answer affects remaining questions",direction:"left",options:a,value:s,renderLabel:hr,onChange:function(e,t){var a=t.value;r(n.code,a)},style:{paddingRight:"0",textAlign:"right"}})},fr=function(e,t,n){var r=[];n.required_for.includes("REMAINING")||r.push({key:"skipremaining",content:Object(ae.jsxs)(ae.Fragment,{children:[Object(ae.jsx)(nr.a,{color:"red",children:"Skips"}),"All remaining questions"]}),value:"Skip_REMAINING",color:"red"});for(var a=t.length||0,i=0;i<a;i++)t[i].name!==e.name&&(n.required_for.includes(t[i].name)||r.push({key:"skip"+i,content:Object(ae.jsxs)(ae.Fragment,{children:[Object(ae.jsx)(nr.a,{color:"red",children:"Skips"}),t[i].name]}),color:"red",value:"Skip_"+t[i].name}));n.makes_irrelevant.includes("REMAINING")||r.push({key:"requiredremaining",content:Object(ae.jsxs)(ae.Fragment,{children:[Object(ae.jsx)(nr.a,{color:"green",children:"Required for"}),"All remaining questions"]}),value:"Required for_REMAINING",color:"green"});for(var o=0;o<a;o++)t[o].name!==e.name&&(n.makes_irrelevant.includes(t[o].name)||r.push({key:"required"+o,content:Object(ae.jsxs)(ae.Fragment,{children:[Object(ae.jsx)(nr.a,{color:"green",children:"Required for"}),t[o].name]}),color:"green",value:"Required for_"+t[o].name}));return r},hr=function(e){return{content:e.value.replace("Skip_","").replace("Required for_",""),style:{fontSize:"12px",padding:"0",color:e.color,background:"white",border:"0",boxShadow:"none"}}},pr=function(e){var t=e.codes,n=e.codeTreeArray,a=e.setCodes,i=Object(bn.b)(),o=Object(r.useState)(!1),c=Object(f.a)(o,2),s=c[0],l=c[1],u=Object(r.useState)(""),d=Object(f.a)(u,2),j=d[0],b=d[1],p=Object(r.useState)([]),O=Object(f.a)(p,2),g=O[0],m=O[1];Object(r.useEffect)((function(){return i(rr(s)),function(){i(rr(!1))}}),[i,s]),Object(r.useEffect)((function(){b(function(e){var t,n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:25,i="",o=Object(x.a)(e);try{for(o.s();!(n=o.n()).done;){var c=n.value;t="",t+=Array(1+c.level*r).join(" ");var s=a-(t+=c.code).length;s>0&&(t+=Array(s).join(" ")),t+=" #color(".concat(c.color,")"),c.active||(t+=" #disabled"),c.folded&&(t+=" #folded"),c.makes_irrelevant&&c.makes_irrelevant.length>0&&(t+=" #irrelevant(".concat(c.makes_irrelevant.join(","),")")),i+=t+"\n"}}catch(l){o.e(l)}finally{o.f()}return i}(n,2,40))}),[n]);return Object(ae.jsxs)(h.a,{on:"click",open:s,style:{width:"700px",maxWidth:"100%",overflowX:"auto",padding:"0.3em"},trigger:Object(ae.jsx)(v.a,{fluid:!0,onClick:function(){return l(!0)},style:{padding:"0.3em 1em",borderRadius:"0"},children:"Plain text editor"}),children:[Object(ae.jsxs)(ft.a,{open:g.length>0,trigger:Object(ae.jsx)(tr.a,{autoFocus:!0,rows:20,onChange:function(e,t){b(t.value)},value:j,style:{fontFamily:"monospace",height:"100%",width:"100%"},placeholder:"Every line is a code\\n\\nindent codes to make a tree, like\\nparent\\n  child\\n    grandchild\\n\\nAdd colors with:\\ncode   #color(red)"}),children:["Duplicate labels: ",Object(ae.jsx)("br",{}),Object(ae.jsx)("b",{children:g.join(", ")})]}),Object(ae.jsxs)(h.a.Actions,{children:[Object(ae.jsx)(v.a,{color:"black",onClick:function(){return l(!1)},children:"Cancel"}),Object(ae.jsx)(v.a,{content:"Save changes",onClick:function(){var e=Q(j,"",[],t.filter((function(e){return e.frozen}))),n=Object(f.a)(e,2),r=n[0],i=n[1];if(i.length>0)return m(i),null;a(r),l(!1)},positive:!0})]})]})},vr=function(e,t,n,r){r(n.map((function(n){return n.code===e&&(n.color=t),n})))},Or=function(e,t,n,r){var a=Object(_.a)(e),i=a.find((function(e){return e.code===t}));i?i.active=n:a.push({code:t,parent:"",active:!0}),r(a)},xr=function(e,t,n,r){var a=Object(_.a)(e),i=a.find((function(e){return e.code===t}));i?i.folded=!n:a.push({code:t,parent:"",active:!0,folded:!n}),r(a)},gr=function(e){var t=e.codes,n=e.setCodes,a=e.questions,i=e.question,o=e.canAdd,c=void 0===o||o,s=e.height,l=void 0===s?"100%":s,u=Object(r.useState)({}),d=Object(f.a)(u,2),j=d[0],b=d[1],h=Object(r.useState)([]),p=Object(f.a)(h,2),v=p[0],m=p[1],y=Object(r.useState)(null),k=Object(f.a)(y,2),w=k[0],C=k[1];Object(r.useEffect)((function(){if(t&&0!==t.length){var e=V(t);b(e),m(J(e,true))}else m([])}),[t,m,b,true]),Object(r.useEffect)((function(){var e=setTimeout((function(){w&&vr(w.code,w.color,t,n),C(null)}),500);return function(){return clearTimeout(e)}}),[t,n,w,C]);var S=function(e){var t=null==e.active||e.active?"black":"grey";return 0===e.level?{fontWeight:"bold",fontSize:"15px",color:t}:1===e.level||2===e.level?{fontSize:"12px",color:t}:{fontSize:"10px",color:t}},A=function(e,r){var a,i=Object(_.a)(t),o=[],c=[],s=Object(x.a)(r);try{for(s.s();!(a=s.n()).done;){var l=a.value.split(/_(.+)/),u=Object(f.a)(l,2),d=u[0],j=u[1];"Skip"===d&&o.push(j),"Required for"===d&&c.push(j)}}catch(h){s.e(h)}finally{s.f()}var b=i.find((function(t){return t.code===e}));b.makes_irrelevant=o,b.required_for=c.filter((function(e){return!o.includes(e)})),n(i)};return Object(ae.jsx)("div",{children:Object(ae.jsxs)(Fe.a,{columns:3,unstackable:!0,textAlign:"left",style:{border:"0",boxShadow:"0",width:"100%"},children:[Object(ae.jsx)(Fe.a.Header,{className:"codes-thead"}),Object(ae.jsxs)(Fe.a.Body,{style:{height:l,margin:"0",overflow:"visible"},className:"codes-tbody",children:[Object(ae.jsxs)(Fe.a.Row,{className:"codes-tr",children:[Object(ae.jsx)(Fe.a.HeaderCell,{textAlign:"center",children:Object(ae.jsx)(O.a,{name:"settings"})}),Object(ae.jsx)(Fe.a.HeaderCell,{style:{position:"relative",paddingLeft:"0.5em"},children:"Codebook"}),Object(ae.jsx)(Fe.a.HeaderCell,{style:{textAlign:"right"},children:Object(ae.jsxs)("div",{style:{marginRight:"18px"},children:["Branching",Object(ae.jsx)(Un,{header:"Make other questions conditional on this answer",texts:["Certain answers can make other questions irrelevant.\n           For example, you might first ask if a text is relevant (for your study).\n           If it isn't, you don't need your coder to waste time answering the remaining questions.\n           In this case, you can set branching to \"Skip all\".",'You can also let an answer "Skip a specific questions", so that certain follow-up questions\n           are only asked if certain conditions are met.','Alternatively, you can specify that an answer is "Required for a specific question" (which is just shorthand for Skip for all other answers)',"It is recommended to implement branching as a final step, and to use the preview to test whether it works as intended"]})]})})]}),Object(_.a)(v).map((function(e,r){return e.foldToParent?null:Object(ae.jsxs)(Fe.a.Row,{className:"codes-tr",style:{},children:[Object(ae.jsx)(Fe.a.Cell,{className:"codes-td",width:1,style:{border:"1px solid black",padding:"0",margin:"0",background:"#1B1C1D",borderRight:null==e.active?null:"1px solid black"},children:Object(ae.jsx)(jr,{codeMap:j,code:e,codes:t,setCodes:n,toggleActiveCode:Or,setChangeColor:C,canAdd:c})}),Object(ae.jsx)(Fe.a.Cell,{className:"codes-td",style:{paddingLeft:"0.5em",borderTop:0===e.level?"1px solid black":null},children:Object(ae.jsxs)("span",{style:Object(g.a)(Object(g.a)({},S(e)),{},{marginLeft:"".concat(1*e.level,"em")}),children:[e.code,0===e.totalChildren||null==e.active?null:Object(ae.jsxs)(ae.Fragment,{children:[Object(ae.jsx)(O.a,{style:{padding:"0",margin:"0",marginLeft:"1em",cursor:"pointer"},onClick:function(){return xr(t,e.code,null!=e.folded&&e.folded,n)},name:e.folded?"caret right":"dropdown"}),e.folded?Object(ae.jsx)("span",{style:{color:"grey"},children:"".concat(e.totalActiveChildren,"/").concat(e.totalChildren)}):null]})]})}),Object(ae.jsx)(Fe.a.Cell,{className:"codes-td",style:{textAlign:"right",paddingLeft:"0.5em",borderTop:0===e.level?"1px solid black":null},children:br(i,a,e,A)})]},r)})),Object(ae.jsx)(jr,{codeMap:j,code:"",codes:t,setCodes:n,setChangeColor:C,canAdd:c,children:Object(ae.jsx)(O.a,{name:"cog",style:{marginLeft:"0.7em",cursor:"pointer"}})}),Object(ae.jsx)(pr,{codes:t,codeTreeArray:v,setCodes:n})]})]})})},mr=function(e){var t=e.variables,n=e.setVariables,a=e.index,i=Object(r.useState)(""),o=Object(f.a)(i,2),c=o[0],s=o[1],l=Object(bn.b)();return Object(r.useEffect)((function(){if(0!==t.length&&c&&c!==t[a].name&&t[a].name!==c){var e=setTimeout((function(){!function(e,t,n,r){if(t[n].name!==e){var a=t[n].name;t[n].name=wr(e,t,n),Cr(t,a,t[n].name),r(t)}}(c.trim(),t,a,n)}),500);return function(){return clearTimeout(e)}}}),[c,t,a,n]),Object(r.useEffect)((function(){0!==t.length&&s(t[a].name)}),[t,a,s]),0===t.length?null:Object(ae.jsx)(Oe.a,{style:{width:"50%"},children:Object(ae.jsxs)(Oe.a.Group,{grouped:!0,children:[Object(ae.jsx)("label",{children:"Name"})," ",Object(ae.jsx)("span",{style:{fontSize:"10px"},children:"(keep it short)"}),Object(ae.jsx)(Oe.a.Field,{children:Object(ae.jsx)(ht.a,{value:c,style:{width:"150px"},onFocus:function(){return l(rr(!0))},onBlur:function(){return l(rr(!1))},onChange:function(e,t){return s(t.value)}})})," "]})})},yr=function(e){var t=e.variables,n=e.setVariables,a=e.index,i=e.setIndex,o=Object(r.useState)(!1),c=Object(f.a)(o,2),s=c[0],l=c[1];return t.length<=1||null!=t[a].enabled?null:Object(ae.jsxs)(ft.a,{hoverable:!0,open:s,onClose:function(){return l(!1)},trigger:Object(ae.jsx)(v.a,{icon:"delete",floated:"right",style:{background:"red",zIndex:100},onClick:function(){return l(!s)}}),children:[Object(ae.jsxs)("p",{children:["Delete ",Object(ae.jsx)("b",{children:t[a].name}),"?"]}),Object(ae.jsx)(v.a,{style:{background:"red"},onClick:function(){for(var e=[],r=0;r<t.length;r++)r!==a&&e.push(t[r]);n(e),l(!1),i(Math.max(0,a-1))},children:"yes please"})]})},kr=function(e){var t=e.i,n=e.variables,r=e.setVariables,a=e.index,i=e.setIndex,o=function(e,t){var a="left"===e?Math.max(0,t-1):Math.min(n.length-1,t+1),o=n[t];n[t]=n[a],n[a]=o,r(n),i(a)};return a!==t?null:Object(ae.jsxs)(v.a.Group,{children:[t>0?Object(ae.jsx)(v.a,{icon:"arrow left",onClick:function(e){e.stopPropagation(),o("left",t)},style:{borderRadius:"0",padding:"0em",background:"rgba(0,0,0,0)"}}):null,t<n.length-1?Object(ae.jsx)(v.a,{icon:"arrow right",onClick:function(e){e.stopPropagation(),o("right",t)},style:{borderRadius:"0",padding:"0em",background:"rgba(0,0,0,0)"}}):null]})},wr=function(e,t,n){for(var r=e,a=2,i=["REMAINING"],o=0;o<t.length;o++)null!==n&&o===n||i.push(t[o].name);for(;i.includes(r);)r=e+" ".concat(a),a++;return r},Cr=function(e,t,n){var r,a=Object(x.a)(e);try{for(a.s();!(r=a.n()).done;){var i=r.value;i.codes=i.codes.map((function(e){return e.makes_irrelevant&&(e.makes_irrelevant=e.makes_irrelevant.map((function(e){return e===t?n:e}))),e.required_for&&(e.required_for=e.required_for.map((function(e){return e===t?n:e}))),e}))}}catch(o){a.e(o)}finally{a.f()}},Sr=function(e){var t=e.children,n=e.variables,r=e.setVariables,a=e.index,i=e.setIndex,o=e.newVariableDefaults;return Object(ae.jsxs)("div",{children:[Object(ae.jsxs)(l.a,{attached:"top",style:{width:"100%",overflowX:"auto"},children:[Array(n.length).fill(0).map((function(e,t){return Object(ae.jsx)(l.a.Item,{onClick:function(e,n){return i(t)},active:a===t,style:{padding:"0 0",position:"relative"},children:Object(ae.jsx)("div",{children:Object(ae.jsxs)("div",{style:{padding:"0 0.5em",height:"100%",cursor:"pointer"},children:[null!=n[t].enabled?Object(ae.jsx)(Nn.a,{checked:n[t].enabled,onChange:function(){n[t].enabled=!n[t].enabled,r(n)},label:n[t].name,style:{margin:"5px 5px 20px -5px"}}):Object(ae.jsx)("div",{style:{margin:"5px 5px 20px 0px"},children:n[t].name}),Object(ae.jsx)("div",{style:{position:"absolute",bottom:"0"},children:Object(ae.jsx)(kr,{i:t,variables:n,setVariables:r,index:a,setIndex:i})})]})})})})),Object(ae.jsx)(l.a.Item,{icon:"plus",attached:"right",position:"right",style:{background:"lightblue"},onClick:function(){var e=Object(g.a)(Object(g.a)({},o),{},{name:wr(o.name,n,null)});n.push(e),r(n)}})]}),Object(ae.jsxs)(xe.a,{attached:"bottom",style:{padding:"1em"},children:[Object(ae.jsx)(yr,{variables:n,setVariables:r,index:a,setIndex:i}),Object(ae.jsx)(mr,{variables:n,setVariables:r,index:a}),t]})]})},_r={type:"select code",name:"Question name",question:"The question itself",codes:["No","Skip","Yes"]},Ar=function(e){var t=e.taskSettings,n=e.setTaskSettings,r=e.unitSettings,a=e.questionIndex,i=t.questions.questions;return Object(ae.jsx)(Ir,{questionForm:i[a],setQuestionForm:function(e){var r=Object(g.a)({},t),i=Object(g.a)({},e);r.questions.questions[a]=i,n(r)},setTaskSettings:n,questions:i,questionIndex:a,unitSettings:r})},Ir=function(e){var t=e.questionForm,n=e.setQuestionForm,a=e.questions,i=e.unitSettings,o=Object(r.useState)(""),c=Object(f.a)(o,2),s=c[0],l=c[1],u=Object(r.useState)([]),d=Object(f.a)(u,2),j=d[0],b=d[1];Object(r.useEffect)((function(){if(s&&t.question!==s.question){var e=setTimeout((function(){n(Object(g.a)(Object(g.a)({},t),{},{name:s.name,question:s.question}))}),500);return function(){return clearTimeout(e)}}}),[s,t,n]),Object(r.useEffect)((function(){if(t){var e=[];t.question.search("\\[code\\]")>=0&&"allTextUnits"===(null===i||void 0===i?void 0:i.unitSelection)&&e.push("Referring to a specific code with [code] is only possible if coding units are annotations"),b(e),l({name:t.name,question:t.question})}}),[l,t,b,i]);return t?Object(ae.jsxs)(Oe.a,{children:[Object(ae.jsxs)(Oe.a.Group,{grouped:!0,children:[Object(ae.jsx)("br",{}),Object(ae.jsxs)("label",{children:["Question",Object(ae.jsx)(Un,{header:"Referring to annotation codes in a question",texts:["If unit selection is based on span annotations, you can also use the tag [code]. This will be replaced by the code label of the annotation"]})]}),j.length>0?Object(ae.jsx)(Un,{type:"warn",header:"",texts:j}):null,Object(ae.jsx)(Oe.a.Field,{children:Object(ae.jsx)(tr.a,{value:s.question,onChange:function(e,t){return l(Object(g.a)(Object(g.a)({},s),{},{question:t.value}))}})})]}),Object(ae.jsxs)(Oe.a.Group,{grouped:!0,children:[Object(ae.jsx)("label",{children:"Type of answer"}),Object(ae.jsx)(Oe.a.Field,{children:Object(ae.jsx)(bt.a,{value:"search code",label:"Select code from search box",checked:"search code"===t.type,onChange:function(){return n(Object(g.a)(Object(g.a)({},t),{},{type:"search code"}))}})}),Object(ae.jsx)(Oe.a.Field,{children:Object(ae.jsx)(bt.a,{value:"select code",label:"Select code from buttons",checked:"select code"===t.type,onChange:function(){return n(Object(g.a)(Object(g.a)({},t),{},{type:"select code"}))}})}),Object(ae.jsx)(Oe.a.Field,{children:Object(ae.jsx)(bt.a,{value:"annotinder",label:"Annotinder (swipe left/right/up)",checked:"annotinder"===t.type,onChange:function(){return n(Object(g.a)(Object(g.a)({},t),{},{type:"annotinder"}))}})})]}),Object(ae.jsx)("br",{}),Object(ae.jsx)("br",{}),Object(ae.jsx)(Rr,{questionForm:t,setQuestionForm:n}),Object(ae.jsx)("div",{style:{margin:"-1em"},children:Object(ae.jsx)(gr,{codes:W(t.codes),setCodes:function(e){return n(Object(g.a)(Object(g.a)({},t),{},{codes:e}))},questions:a,question:t})})]}):null},Rr=function(e){var t,n,a,i=e.questionForm,o=e.setQuestionForm,c=Object(r.useState)({left:null,up:null,right:null}),s=Object(f.a)(c,2),l=s[0],u=s[1];Object(r.useEffect)((function(){if("annotinder"!==i.type)return null;var e,t=Object(_.a)(i.codes),n=!0,r=Object(x.a)(t);try{for(r.s();!(e=r.n()).done;){var a=e.value;(null===a||void 0===a?void 0:a.swipe)&&(n=!1)}}catch(l){r.e(l)}finally{r.f()}if(!n)return null;for(var c=["left","up","right"],s=0;s<3;s++)t.length>s&&("object"===typeof t[s]?t[s]=Object(g.a)(Object(g.a)({},t[s]),{},{swipe:c[s]}):t[s]={code:t[s],swipe:c[s]});o(Object(g.a)(Object(g.a)({},i),{},{codes:t}))}),[i,o]),Object(r.useEffect)((function(){var e=function(e){return i.codes.find((function(t){return"object"===typeof t&&(t.swipe&&t.swipe===e)}))},t=e("left")||null,n=e("up")||null,r=e("right")||null;u({left:t,up:n,right:r})}),[i,u]);var d=function(e,t){var n=i.codes.map((function(n){var r="object"!==typeof n?{code:n}:Object(g.a)({},n);return r.code===t?Object(g.a)(Object(g.a)({},r),{},{swipe:e}):r.swipe&&r.swipe===e?Object(g.a)(Object(g.a)({},r),{},{swipe:null}):(r.swipe||(r.swipe=null),r)}));o(Object(g.a)(Object(g.a)({},i),{},{codes:n}))};if("annotinder"!==i.type)return null;var j=i.codes.map((function(e,t){return{key:t,text:e.code||e,value:e.code||e}}));return Object(ae.jsxs)(Oe.a,{children:[Object(ae.jsxs)(ve.a,{textAlign:"center",verticalAlign:"middle",children:[Object(ae.jsx)(ve.a.Row,{style:{paddingBottom:"0"},children:Object(ae.jsx)(ve.a.Column,{width:6,children:Object(ae.jsxs)(Oe.a.Group,{grouped:!0,children:[Object(ae.jsx)("b",{children:"swipe"})," or ",Object(ae.jsx)("b",{children:"arrow up"}),Object(ae.jsx)("br",{}),Object(ae.jsx)(Qe.a,{placeholder:"not used",clearable:!0,value:(null===(t=l.up)||void 0===t?void 0:t.code)||null,options:j,selection:!0,style:{minWidth:"10em",maxWidth:"10em"},onChange:function(e,t){return d("up",t.value)}})]})})}),Object(ae.jsxs)(ve.a.Row,{children:[Object(ae.jsxs)(ve.a.Column,{width:8,children:[Object(ae.jsx)("b",{children:"swipe"})," or ",Object(ae.jsx)("b",{children:"arrow left"}),Object(ae.jsx)("br",{}),Object(ae.jsx)(Qe.a,{placeholder:"not used",clearable:!0,value:(null===(n=l.left)||void 0===n?void 0:n.code)||null,options:j,selection:!0,style:{minWidth:"10em",maxWidth:"10em"},onChange:function(e,t){return d("left",t.value)}})]}),Object(ae.jsxs)(ve.a.Column,{width:8,children:[Object(ae.jsx)("b",{children:"swipe"})," or ",Object(ae.jsx)("b",{children:"arrow right"}),Object(ae.jsx)("br",{}),Object(ae.jsx)(Qe.a,{placeholder:"not used",clearable:!0,value:(null===(a=l.right)||void 0===a?void 0:a.code)||null,options:j,selection:!0,style:{minWidth:"10em",maxWidth:"10em"},onChange:function(e,t){return d("right",t.value)}})]})]})]}),Object(ae.jsx)("br",{}),Object(ae.jsx)("br",{})]})},Er=function(e){var t=e.taskSettings,n=e.setTaskSettings,a=e.unitSettings,i=Object(r.useState)(0),o=Object(f.a)(i,2),c=o[0],s=o[1];return Object(ae.jsxs)(Sr,{variables:t.questions.questions,setVariables:function(e){n(Object(g.a)(Object(g.a)({},t),{},{questions:{settings:t.questions.settings,questions:e}}))},index:c,setIndex:s,newVariableDefaults:_r,children:[Object(ae.jsx)(Ar,{taskSettings:t,setTaskSettings:n,unitSettings:a,questionIndex:c})," "]})},zr={name:"Variable name",buttonMode:"all",searchBox:!1,codes:["No","Skip","Yes"]},Tr=function(e){var t,n,r=e.taskSettings,a=e.setTaskSettings,i=e.variableIndex,o=r.annotate.variables[i],c=function(e){var t=Object(g.a)({},r),n=Object(g.a)({},e);t.annotate.variables[i]=n,a(t)};return(null===r||void 0===r||null===(t=r.annotate)||void 0===t||null===(n=t.variables)||void 0===n?void 0:n[i])?Object(ae.jsxs)(Oe.a,{children:[Object(ae.jsxs)(Oe.a.Group,{children:[Object(ae.jsx)(O.a,{name:"setting"}),Object(ae.jsx)("label",{children:"Code Selector settings"})]}),Object(ae.jsx)(Oe.a.Group,{children:Object(ae.jsx)(Oe.a.Field,{children:Object(ae.jsx)(Nn.a,{label:"Search box",disabled:"recent"===o.buttonMode,checked:o.searchBox||"recent"===o.buttonMode,onChange:function(e,t){return c(Object(g.a)(Object(g.a)({},o),{},{searchBox:t.checked}))}})})}),Object(ae.jsxs)(Oe.a.Group,{grouped:!0,children:[Object(ae.jsx)("label",{children:"Code buttons"}),Object(ae.jsxs)(Oe.a.Field,{children:[Object(ae.jsx)(bt.a,{value:"all",label:"Show all codes",checked:"all"===o.buttonMode,onChange:function(){return c(Object(g.a)(Object(g.a)({},o),{},{buttonMode:"all"}))}}),Object(ae.jsx)(Un,{header:"Show all active codes",texts:["Only codes that are 'active' will be shown","You can toggle which codes are active in the codebook (top-right in menu bar)"]})]}),Object(ae.jsxs)(Oe.a.Field,{children:[Object(ae.jsx)(bt.a,{value:"recent",label:"Show recently used",checked:"recent"===o.buttonMode,onChange:function(){return c(Object(g.a)(Object(g.a)({},o),{},{buttonMode:"recent"}))}}),Object(ae.jsx)(Un,{header:"Show recently used codes",texts:["Show only (active) codes that the coder used recently","The Search box is always enabled with this option, and the buttons only serve as quick keys. This is especially usefull for very large codebooks, for instance for tagging specific named entities"]})]})]}),Object(ae.jsx)("br",{}),Object(ae.jsx)("div",{style:{overflow:"auto",margin:"-1em"},children:Object(ae.jsx)(gr,{codes:W(o.codes),setCodes:function(e){return c(Object(g.a)(Object(g.a)({},o),{},{codes:e}))}})})]}):null},Dr=function(e){var t=e.taskSettings,n=e.setTaskSettings,a=Object(r.useState)(0),i=Object(f.a)(a,2),o=i[0],c=i[1];return Object(ae.jsxs)(Sr,{variables:t.annotate.variables,setVariables:function(e){n(Object(g.a)(Object(g.a)({},t),{},{annotate:{settings:t.annotate.settings,variables:e}}))},index:o,setIndex:c,newVariableDefaults:zr,children:[Object(ae.jsx)("br",{}),Object(ae.jsx)(Tr,{taskSettings:t,setTaskSettings:n,variableIndex:o})," "]})},qr={type:null,annotate:{settings:{},variables:[{name:"Variable name",buttonMode:"all",searchBox:!1,codes:["Some","example","options"]}]},questions:{settings:{},questions:[{name:"Question name",type:"select code",question:"[The question itself]",codes:["No","Skip","Yes"]}]}},Fr=function(e){var t=e.codingjob,n=null===t||void 0===t?void 0:t.unitSettings,a=(null===t||void 0===t?void 0:t.taskSettings)||qr,i=function(e){re.setCodingjobProp(t,"taskSettings",e)};return Object(r.useEffect)((function(){if((null===t||void 0===t?void 0:t.taskSettings)&&t.importedCodes)for(var e=function(){var e=r[n],a=t.importedCodes[e],i=t.taskSettings;i.annotate.variables.some((function(t){return t.name===e}))||(i.annotate.variables.push({name:e,buttonMode:a.length>10?"recent":"all",searchBox:a.length>10,codes:a,enabled:!1}),re.setCodingjobProp(t,"taskSettings",i))},n=0,r=Object.keys(t.importedCodes);n<r.length;n++)e()}),[t]),a&&n?Object(ae.jsxs)("div",{style:{verticalAlign:"top",float:"top",paddingLeft:"1em"},children:[Object(ae.jsx)(Nr,{taskSettings:a,setTaskSettings:i}),Object(ae.jsx)(er.a,{}),"questions"===a.type?Object(ae.jsx)(Er,{taskSettings:a,setTaskSettings:i,unitSettings:n}):null,"annotate"===a.type?Object(ae.jsx)(Dr,{taskSettings:a,setTaskSettings:i,unitSettings:n}):null]}):null},Nr=function(e){var t=e.taskSettings,n=e.setTaskSettings;Object(r.useEffect)((function(){(null===t||void 0===t?void 0:t.type)||n(Object(g.a)(Object(g.a)({},t),{},{type:"annotate"}))}),[t,n]);var a=function(e,r){return Object(ae.jsx)(Oe.a.Field,{children:Object(ae.jsx)(bt.a,{value:e,label:r,checked:t.type===e,onChange:function(r,a){return n(Object(g.a)(Object(g.a)({},t),{},{type:e}))}})})};return Object(ae.jsxs)(Oe.a,{children:[Object(ae.jsxs)(Oe.a.Group,{children:[Object(ae.jsx)(O.a,{name:"setting"}),Object(ae.jsx)("label",{children:"Set task type"})]}),Object(ae.jsxs)(Oe.a.Group,{grouped:!0,widths:"equal",children:[a("annotate","Annotate"),a("questions","Question")]})]})},Ur=a.a.memo(Fr),Pr=n(178),Lr=[4,4,2,2],Mr=function(e,t){var n,r=[],a=0,i=Object(x.a)(t);try{for(i.s();!(n=i.n()).done;){var o=n.value,c=o.text||"",s=Object(ae.jsx)(Hr,{variable:o.variable,variableMap:e,annotation:o,text:c},a);r.push(s),a++}}catch(l){i.e(l)}finally{i.f()}return r},Hr=function(e){var t,n=e.variable,r=e.variableMap,a=e.annotation,i=e.text;if(console.log(n),!r)return null;var o=r[n].codeMap,c=Lt(a.value,o),s=(null===(t=o[a.value])||void 0===t?void 0:t.foldToParent)?"".concat(o[a.value].foldToParent," - ").concat(a.value):a.value;return Object(ae.jsxs)(Fe.a.Row,{className:"annotations-tr",children:[Object(ae.jsx)(Fe.a.Cell,{width:Lr[0],children:Object(ae.jsx)("span",{title:n,children:n})}),Object(ae.jsx)(Fe.a.Cell,{width:Lr[1],style:c?{background:c}:null,children:Object(ae.jsx)("span",{title:s,children:s})}),Object(ae.jsx)(Fe.a.Cell,{width:Lr[2],children:a.section}),Object(ae.jsx)(Fe.a.Cell,{width:Lr[3],children:"".concat(a.offset,"-").concat(a.offset+a.length)}),Object(ae.jsx)(Fe.a.Cell,{children:Object(ae.jsx)("span",{title:i,children:i})})]})},Gr=function(e){var t=e.variableMap,n=e.annotations;return t&&0!==Object.keys(t).length?Object(ae.jsxs)(Fe.a,{style:{fontSize:"10px"},fixed:!0,role:"grid","arioa-labelledby":"header",unstackable:!0,singleLine:!0,compact:"very",size:"small",children:[Object(ae.jsx)(Fe.a.Header,{className:"annotations-thead",children:Object(ae.jsxs)(Fe.a.Row,{children:[Object(ae.jsx)(Fe.a.HeaderCell,{width:Lr[0],children:"Variable"}),Object(ae.jsx)(Fe.a.HeaderCell,{width:Lr[1],children:"Value"}),Object(ae.jsx)(Fe.a.HeaderCell,{width:Lr[2],children:"Section"}),Object(ae.jsx)(Fe.a.HeaderCell,{width:Lr[3],children:"Tokens"}),Object(ae.jsx)(Fe.a.HeaderCell,{children:"Text"})]})}),Object(ae.jsx)(Fe.a.Body,{className:"annotations-tbody",children:Mr(t,n)})]}):null},Br=function(e){var t=e.unit,n=e.codebook,a=e.setUnitIndex,i=e.blockEvents,o=Object(r.useState)([]),c=Object(f.a)(o,2),s=c[0],l=c[1],u=Object(r.useState)(null),d=Object(f.a)(u,2),j=d[0],b=d[1];return Object(r.useEffect)((function(){var e,t={},r=Object(x.a)(n.variables);try{for(r.s();!(e=r.n()).done;){var a=e.value;if(!(null===a||void 0===a?void 0:a.codes))return null;var i=V(Object(_.a)(a.codes));t[a.name]=Object(g.a)(Object(g.a)({},a),{},{codeMap:i})}}catch(o){r.e(o)}finally{r.f()}b(t)}),[n,b]),t&&null!==(null===n||void 0===n?void 0:n.variables)?Object(ae.jsxs)(ve.a,{centered:!0,style:{height:"100%",width:"100%",paddingTop:"0"},verticalAlign:"top",columns:2,children:[Object(ae.jsx)(ve.a.Column,{width:10,style:{paddingRight:"0em",height:"100%"},children:Object(ae.jsx)(vn,{unit:t,variables:null===n||void 0===n?void 0:n.variables,settings:null===n||void 0===n?void 0:n.settings,onChangeAnnotations:l,blockEvents:i})}),Object(ae.jsxs)(ve.a.Column,{width:6,style:{paddingRight:"0em",height:"100%",overflow:"auto"},children:[Object(ae.jsxs)(v.a.Group,{fluid:!0,style:{padding:"0"},children:[Object(ae.jsx)(Wr,{setUnitIndex:a}),Object(ae.jsx)(Vr,{codebook:n})]}),Object(ae.jsx)(Gr,{variableMap:j,annotations:s})]})]}):null},Wr=function(e){var t=e.setUnitIndex,n=Object(r.useState)(!1),a=Object(f.a)(n,2),i=a[0],o=a[1],c=function(){i||(o(!0),t((function(e){return e+1})),setTimeout((function(){o(!1)}),1e3))},s=function(e){e.ctrlKey&&13===e.keyCode&&(e.preventDefault(),c())};return Object(r.useEffect)((function(){return window.addEventListener("keydown",s),function(){window.removeEventListener("keydown",s)}})),Object(ae.jsxs)(v.a,{disabled:i,loading:i,primary:!0,size:"tiny",onClick:c,children:["Next Unit",Object(ae.jsx)("br",{}),"(ctrl + Enter)"]})},Vr=function(){var e=Object(r.useState)(!1),t=Object(f.a)(e,2),n=t[0],a=t[1];return Object(ae.jsx)(ft.a,{flowing:!0,open:n,position:"bottom right",trigger:Object(ae.jsx)(v.a,{secondary:!0,size:"tiny",onClick:function(){return a(!n)},children:"Instructions"}),children:Object(ae.jsxs)(Ie.a,{style:{paddingTop:"2em",width:"700px"},children:[Object(ae.jsx)(p.a,{as:"h4",align:"center",children:"Edit span annotations"}),Object(ae.jsx)("p",{align:"center",children:"Assign codes to words or phrases. A word can have multiple codes."}),Object(ae.jsxs)(Fe.a,{unstackable:!0,children:[Object(ae.jsx)(Fe.a.Header,{children:Object(ae.jsxs)(Fe.a.Row,{children:[Object(ae.jsx)(Fe.a.HeaderCell,{width:3}),Object(ae.jsx)(Fe.a.HeaderCell,{children:"Keyboard"}),Object(ae.jsx)(Fe.a.HeaderCell,{children:"Mouse"}),Object(ae.jsx)(Fe.a.HeaderCell,{children:"Touchpad"})]})}),Object(ae.jsxs)(Fe.a.Body,{children:[Object(ae.jsxs)(Fe.a.Row,{children:[Object(ae.jsx)(Fe.a.Cell,{children:Object(ae.jsx)("strong",{children:"Navigate"})}),Object(ae.jsx)(Fe.a.Cell,{children:Object(ae.jsx)("i",{children:"Arrow keys"})}),Object(ae.jsx)(Fe.a.Cell,{}),Object(ae.jsx)(Fe.a.Cell,{})]}),Object(ae.jsxs)(Fe.a.Row,{children:[Object(ae.jsx)(Fe.a.Cell,{children:Object(ae.jsx)("strong",{children:"Select words"})}),Object(ae.jsxs)(Fe.a.Cell,{children:[Object(ae.jsx)("i",{children:"spacebar"}),Object(ae.jsx)("br",{}),"Hold to select mutiple"]}),Object(ae.jsxs)(Fe.a.Cell,{children:[Object(ae.jsx)("i",{children:"Left-click"}),Object(ae.jsx)("br",{}),"Hold to select multiple"]}),Object(ae.jsxs)(Fe.a.Cell,{children:[Object(ae.jsx)("i",{children:"tab"})," first word 2 times, then last word 1 time"]})]}),Object(ae.jsxs)(Fe.a.Row,{children:[Object(ae.jsx)(Fe.a.Cell,{children:Object(ae.jsx)("strong",{children:"Edit code"})}),Object(ae.jsxs)(Fe.a.Cell,{children:["Press ",Object(ae.jsx)("i",{children:"spacebar"})," (don't hold) on an annotation"]}),Object(ae.jsxs)(Fe.a.Cell,{children:[Object(ae.jsx)("i",{children:"Left-click"})," (don't hold) on an annotation"]}),Object(ae.jsxs)(Fe.a.Cell,{children:[Object(ae.jsx)("i",{children:"tab"})," an annotation 3 times"]})]}),Object(ae.jsxs)(Fe.a.Row,{children:[Object(ae.jsx)(Fe.a.Cell,{children:Object(ae.jsxs)("strong",{children:["Select variable",Object(ae.jsx)("br",{}),"(if multiple)"]})}),Object(ae.jsxs)(Fe.a.Cell,{children:["Next with ",Object(ae.jsx)("i",{children:"tab"}),", previous with ",Object(ae.jsx)("i",{children:"shift+tab"})]}),Object(ae.jsx)(Fe.a.Cell,{children:"Use buttons"}),Object(ae.jsx)(Fe.a.Cell,{children:"Use buttons"})]}),Object(ae.jsxs)(Fe.a.Row,{children:[Object(ae.jsx)(Fe.a.Cell,{children:Object(ae.jsx)("strong",{children:"Next unit"})}),Object(ae.jsx)(Fe.a.Cell,{children:Object(ae.jsx)("i",{children:"ctrl+Enter"})}),Object(ae.jsx)(Fe.a.Cell,{children:"Next Unit button"}),Object(ae.jsx)(Fe.a.Cell,{children:"Next Unit button"})]})]}),Object(ae.jsx)(Fe.a.Footer,{children:Object(ae.jsxs)(Fe.a.Row,{children:[Object(ae.jsxs)(Fe.a.HeaderCell,{children:[Object(ae.jsx)("strong",{children:"Quick keys"})," ",Object(ae.jsx)("br",{}),"in popup"]}),Object(ae.jsx)(Fe.a.HeaderCell,{colSpan:"3",children:Object(ae.jsxs)(Pt.a,{as:"ul",children:[Object(ae.jsxs)(Pr.a,{as:"li",children:[Object(ae.jsx)("i",{children:"text input"})," automatically opens dropdown"," "]}),Object(ae.jsxs)(Pr.a,{as:"li",children:["navigate buttons with ",Object(ae.jsx)("i",{children:"arrow keys"}),", select with ",Object(ae.jsx)("i",{children:"spacebar"})]}),Object(ae.jsxs)(Pr.a,{as:"li",children:["use ",Object(ae.jsx)("i",{children:"escape"})," to close popup and ",Object(ae.jsx)("i",{children:"delete"})," to remove code"]})]})})]})})]})]})})},Jr=a.a.memo(Br),Kr=["ArrowRight","ArrowLeft","ArrowUp","ArrowDown"],Yr=a.a.memo((function(e){var t=e.options,n=e.callback,a=e.blockEvents,i=Object(r.useRef)();return Object(ae.jsx)(Yt.a,{innerRef:i,children:Object(ae.jsx)(Qe.a,{fluid:!0,scrolling:!0,upward:!1,placeholder:"<type to search>",searchInput:{autoFocus:!a},style:{minWidth:"12em"},options:t.map((function(e){return{key:e.code,value:e,text:e.code+(e.tree?" ("+e.tree+")":""),content:Object(ae.jsxs)(ae.Fragment,{children:[e.code,Object(ae.jsx)("br",{}),Object(ae.jsx)("span",{style:{color:"grey"},children:e.tree})]})}})),search:!0,selection:!0,compact:!0,selectOnNavigation:!1,minCharacters:0,autoComplete:"on",onChange:function(e,t){n(t.value)}})})})),Qr=a.a.memo((function(e){var t=e.options,n=e.callback,i=e.blockEvents,o=Object(r.useState)(0),c=Object(f.a)(o,2),s=c[0],l=c[1],u=a.a.useCallback((function(e){var r=t.length;if(Kr.includes(e.key))return e.preventDefault(),"ArrowRight"===e.key&&s<r-1&&l(s+1),"ArrowDown"===e.key&&l(kt(t,s)),"ArrowLeft"===e.key&&s>0&&l(s-1),void("ArrowUp"===e.key&&l(yt(t,s)));46===e.keyCode&&(n(null),l(0)),32!==e.keyCode&&13!==e.keyCode||(e.preventDefault(),e.stopPropagation(),s===t.length?n(null):n(t[s]),l(0))}),[s,n,t]);Object(r.useEffect)((function(){return i?window.removeEventListener("keydown",u):window.addEventListener("keydown",u),function(){window.removeEventListener("keydown",u)}}),[u,i]);return Object(ae.jsx)("div",{style:{display:"flex",flexDirection:"row",alignItems:"space-eventy",maxWidth:"100%",height:"100%",flexWrap:"wrap",justifyContent:"space-around"},children:t.map((function(e,t){return Object(ae.jsx)(ae.Fragment,{children:Object(ae.jsx)(Yt.a,{innerRef:e.ref,children:Object(ae.jsx)(v.a,{style:{backgroundColor:e.color,padding:"1em",margin:"0.2em",flex:"0.5 1 0",flexBasis:"0",fontWeight:"bold",fontSize:"1em",border:t===s?"3px solid black":"3px solid #ece9e9"},value:e,compact:!0,onMouseOver:function(){return l(t)},onClick:function(e,t){n(t.value),l(0)},children:e.code},e.code)})})}))})})),Xr=a.a.memo((function(e){var t,n,i,o,c,s,l,u,d,j=e.swipeOptions,b=e.callback,f=e.swipe,h=e.blockEvents;Object(r.useEffect)((function(){f&&(console.log(f),"right"===f&&b(j.right),"up"===f&&b(j.up),"left"===f&&b(j.left))}),[f,b,j]);var p=a.a.useCallback((function(e){Kr.includes(e.key)&&(e.preventDefault(),"ArrowRight"===e.key&&b(j.right),"ArrowUp"===e.key&&b(j.up),"ArrowLeft"===e.key&&b(j.left))}),[b,j]);return Object(r.useEffect)((function(){return h?window.removeEventListener("keydown",p):window.addEventListener("keydown",p),function(){window.removeEventListener("keydown",p)}}),[p,h]),Object(ae.jsxs)("div",{style:{display:"flex",flexWrap:"wrap",alignContent:"stretch",height:"100%"},children:[null==j.up?null:Object(ae.jsx)(v.a,{fluid:!0,disabled:null==j.up,onClick:function(e,t){return b(j.up)},style:{margin:"0",padding:"0",flex:"1 1 auto",borderRadius:"0",border:"1px solid",background:(null===(t=j.up)||void 0===t?void 0:t.color)||"white"},children:Object(ae.jsxs)("div",{style:{color:"black",fontWeight:"bold",fontSize:"1em"},children:[Object(ae.jsx)(O.a,{name:(null===(n=j.up)||void 0===n?void 0:n.code)?"arrow up":null}),Object(ae.jsx)("span",{children:(null===(i=j.up)||void 0===i?void 0:i.code)||""})]})}),Object(ae.jsx)("div",{style:{flex:"1 1 auto"},children:Object(ae.jsxs)("div",{style:{padding:"0",margin:"0",display:"flex",height:"100%",flexWrap:"wrap",alignContent:"stretch"},children:[Object(ae.jsx)(v.a,{disabled:null==j.left,onClick:function(e,t){return b(j.left)},style:{margin:"0",padding:"0",flex:"1 1 auto",width:"45%",borderRadius:"0",border:"1px solid",background:(null===(o=j.left)||void 0===o?void 0:o.color)||"white"},children:Object(ae.jsxs)("div",{style:{color:"black",fontWeight:"bold",fontSize:"1em"},children:[Object(ae.jsx)(O.a,{name:(null===(c=j.left)||void 0===c?void 0:c.code)?"arrow left":null}),Object(ae.jsx)("span",{children:(null===(s=j.left)||void 0===s?void 0:s.code)||""})]})}),Object(ae.jsx)(v.a,{disabled:null==j.right,onClick:function(e,t){return b(j.right)},style:{padding:"0",margin:"0",flex:"1 1 auto",width:"45%",borderRadius:"0",border:"1px solid",background:(null===(l=j.right)||void 0===l?void 0:l.color)||"white"},children:Object(ae.jsxs)("div",{style:{color:"black",fontWeight:"bold",fontSize:"1em"},children:[Object(ae.jsx)("span",{children:(null===(u=j.right)||void 0===u?void 0:u.code)||""}),Object(ae.jsx)(O.a,{name:(null===(d=j.right)||void 0===d?void 0:d.code)?"arrow right":null})]})})]})})]})})),Zr="lightgreen",$r=function(e){var t,n=e.unit,a=e.tokens,i=e.questions,o=e.questionIndex,c=e.setQuestionIndex,s=e.setUnitIndex,l=e.swipe,u=e.blockEvents,d=Object(r.useState)(),j=Object(f.a)(d,2),b=j[0],h=j[1],v=Object(r.useRef)(!1),O=Object(r.useState)(null),x=Object(f.a)(O,2),g=x[0],m=x[1];if(Object(r.useEffect)((function(){i&&(ta(n,a,i,m,c),v.current=!1)}),[n,a,m,i,c]),!i||!n||!g)return null;if(!(null===i||void 0===i?void 0:i[o]))return c(0),null;var y=la(n,i[o]);return Object(ae.jsxs)("div",{style:{height:"100%",width:"100%"},children:[Object(ae.jsx)(na,{questions:i,questionIndex:o,annotations:g,setQuestionIndex:c}),Object(ae.jsxs)("div",{style:{display:"flex",position:"relative",flexFlow:"column",height:"calc(100% - 30px)",width:"100%",maxHeight:"100%",padding:"10px",color:"white",backgroundColor:"#1B1C1D"},children:[Object(ae.jsx)("div",{style:{width:"100%",flex:"1 1 auto",paddingBottom:"10px"},children:Object(ae.jsx)(p.a,{as:"h3",style:{color:"white"},children:y})}),Object(ae.jsx)(ra,{answerTransition:b,currentAnswer:null===g||void 0===g||null===(t=g[o])||void 0===t?void 0:t.value,questions:i,questionIndex:o,onSelect:function(e){if(v.current)return null;v.current=!0,g[o].value=e.code,g[o].makes_irrelevant=e.makes_irrelevant,n.annotations=ca(g[o],n.annotations),ea(n,i,g,o),n.jobServer.postAnnotations(n.unitId,n.annotations),h(e),setTimeout((function(){h(null);for(var e=null,t=o+1;t<i.length;t++)if("IRRELEVANT"!==g[t].value){e=t;break}null===e?(s((function(e){return e+1})),c(0)):c(e),v.current=!1}),250)},swipe:l,blockEvents:u})]})]})},ea=function(e,t,n,r){var a=new Set;for(var i in Object.keys(e.annotations)){var o=e.annotations[i].makes_irrelevant;if(null!=o&&null!==o){var c,s=Object(x.a)(o);try{var l=function(){var e=c.value;if("REMAINING"===e)for(var i=r+1;i<n.length;i++)a.add(i);var o=t.findIndex((function(t){return t.name===e}));o>=0&&a.add(o)};for(s.s();!(c=s.n()).done;)l()}catch(d){s.e(d)}finally{s.f()}}}for(var u=0;u<n.length;u++)a.has(u)?(n[u].value="IRRELEVANT",e.annotations=ca(n[u],e.annotations)):"IRRELEVANT"===n[u].value&&(delete n[u].value,e.annotations=ca(n[u],e.annotations))},ta=function(e,t,n,r,a){if(0===t.length)return null;var i=[];e.annotations||(e.annotations=[]);for(var o=0,c=0;c<n.length;c++){var s=aa(t,n[c],c);s.value=oa(e.annotations,s),null!==s.value&&(o=c),i.push(s)}r(i),a(o)},na=function(e){var t=e.questions,n=e.questionIndex,a=e.annotations,i=e.setQuestionIndex,o=Object(r.useState)(),c=Object(f.a)(o,2),s=c[0],l=c[1];Object(r.useEffect)((function(){var e=Array(a.length).fill(!1);e[0]=!0,l(e)}),[a,l]),Object(r.useEffect)((function(){l((function(e){var t=Object(_.a)(e);return t[n]=!0,t}))}),[n,l]);return Object(ae.jsx)("div",{children:Object(ae.jsx)(v.a.Group,{fluid:!0,style:{border:"1px solid",height:"30px"},children:t.map((function(e,r){var o=function(e){return a[e]?"IRRELEVANT"===a[e].value?["black","red"]:s&&e>n&&!s[e]?["white","grey"]:a[e].value?["black",Zr]:0===e||s&&s[e]?[Zr,"#1B1C1D"]:[Zr,"grey"]:["black","red"]}(r),c=Object(f.a)(o,2),l=c[0],u=c[1];return Object(ae.jsx)(v.a,{active:r===n,style:{padding:"0em 0.2em 0.2em 0.2em",minWidth:"2em",height:"30px",borderRadius:"0",fontSize:"12px",border:"1px solid darkgrey",background:u,textOverflow:"clip",overflow:"hidden",color:l},onClick:function(){s[r]&&i(r)},children:Object(ae.jsx)("span",{title:t[r].name,children:t[r].name})})}))})})},ra=function(e){var t=e.answerTransition,n=e.currentAnswer,r=e.questions,a=e.questionIndex,i=e.onSelect,o=e.swipe,c=e.blockEvents;return t?Object(ae.jsx)(xe.a,{style:{display:"flex",flex:"1 1 auto",padding:"0",overflowY:"auto",height:"100%",width:"100%",margin:"0",background:t.color,justifyContent:"center",alignItems:"center"},children:Object(ae.jsx)(p.a,{as:"h1",children:t.code})}):Object(ae.jsxs)(ae.Fragment,{children:[sa(n||t),Object(ae.jsxs)(xe.a,{style:{flex:"1 1 auto",padding:"0",overflowY:"auto",height:"100%",width:"100%",margin:"0"},children:["search code"===r[a].type?Object(ae.jsx)(Yr,{options:r[a].options,callback:i,blockEvents:c}):null,"select code"===r[a].type?Object(ae.jsx)(Qr,{options:r[a].options,callback:i,blockEvents:c}):null,"annotinder"===r[a].type?Object(ae.jsx)(Xr,{swipeOptions:r[a].swipeOptions,currentAnswer:n,callback:i,swipe:o,blockEvents:c}):null]})]})},aa=function(e,t,n){if(0===e.length)return null;var r,a={},i=e[e.length-1],o=[0,i.offset+i.length],c=[0,e.length-1],s=!1,l=!1,u=0,d=Object(x.a)(e);try{for(d.s();!(r=d.n()).done;){var j=r.value;j.codingUnit&&!a[j.section]&&(a[j.section]=1),!s&&j.codingUnit&&(s=!0,o[0]=j.offset,c[0]=u),l||j.codingUnit||!s||(l=!0,o[1]=e[u-1].offset+e[u-1].length,c[1]=u-1),u++}}catch(f){d.e(f)}finally{d.f()}var b={length_tokens:1+c[1]-c[0],length_paragraphs:1+e[c[1]].paragraph-e[c[0]].paragraph,length_sentences:1+e[c[1]].sentence-e[c[0]].sentence};return{variable:"Q".concat(n+1,"_").concat(t.name.replace(" ","_")),value:null,section:Object.keys(a).join(" + "),offset:o[0],length:o[1]-o[0],meta:b}},ia=function(e,t){return e.variable===t.variable&&e.section===t.section&&e.offset===t.offset&&e.length===t.length},oa=function(e,t){if(!e)return null;var n,r=Object(x.a)(e);try{for(r.s();!(n=r.n()).done;){var a=n.value;if(ia(a,t))return a.value}}catch(i){r.e(i)}finally{r.f()}return null},ca=function(e,t){t||(t=[]);for(var n=0;n<t.length;n++)if(ia(t[n],e))return t[n]=e,t;return t.push(e),t},sa=function(e){return null==e?null:Object(ae.jsx)("div",{style:{backgroundColor:"white",color:"black"},children:Object(ae.jsx)(xe.a,{style:{padding:"0 0 0.5em 0",margin:"0",borderRadius:"0",background:"#1B1C1D",color:Zr,textAlign:"center"},children:Object(ae.jsxs)("div",{style:{marginTop:"0.3em"},children:["you answered:","  ",Object(ae.jsx)("b",{style:{fontSize:"1.5em"},children:"".concat(e)})]})})})},la=function(e,t){var n=t.question;if(e.variables){for(var r=0,a=Object.keys(e.variables);r<a.length;r++){var i=a[r];if(n.search("\\[".concat(i,"\\]"))>=0){var o=e.variables[i],c="{{lightyellow###".concat(o,"}}");n=n.replace("[".concat(i,"]"),c)}}return ua(n)}},ua=function(e){var t=new RegExp(/{{(.*?)}}/);return e=e.replace(/(\r\n|\n|\r)/gm,""),Object(ae.jsx)("div",{children:e.split(t).reduce((function(e,t,n){if(n%2===0)e.push(t);else{var r=t.split("###"),a=Object(f.a)(r,2),i=a[0],o=a[1];e.push(Object(ae.jsx)("mark",{style:{backgroundColor:i},children:o},n+t))}return e}),[])})},da=a.a.memo($r),ja=n(179),ba={centerVertical:!0},fa=function(e){var t=e.unit,n=e.codebook,a=e.setUnitIndex,i=e.blockEvents,o=Object(r.useState)([]),c=Object(f.a)(o,2),s=c[0],l=c[1],u=Object(r.useState)(0),d=Object(f.a)(u,2),j=d[0],b=d[1],h=Object(r.useState)(null),p=Object(f.a)(h,2),v=p[0],O=p[1],x={text:Object(r.useRef)(),box:Object(r.useRef)(),code:Object(r.useRef)()},m=Object(r.useState)(0),y=Object(f.a)(m,2),k=y[0],w=y[1],C=Object(me.a)(["questionTaskSettings"]),S=Object(f.a)(C,2),_=S[0],A=S[1],I=Object(r.useState)(_.questionTaskSettings||{splitHeight:60,textSize:1}),R=Object(f.a)(I,2),E=R[0],z=R[1],T=Object(r.useRef)(null);Object(r.useEffect)((function(){A("questionTaskSettings",JSON.stringify(E),{path:"/"})}),[E,A]),Object(r.useEffect)((function(){(null===n||void 0===n?void 0:n.questions)&&O(pa(n))}),[n]),Object(r.useEffect)((function(){if(!(null===x||void 0===x?void 0:x.text.current))return null;x.box.current.style.backgroundColor="white",x.text.current.style.transition="",x.box.current.style.transition="",x.box.current.style.opacity=0,x.text.current.style.transform="translateX(0%) translateY(0%)"}),[x.text,x.box,t,j]),Object(r.useEffect)((function(){if(!(null===x||void 0===x?void 0:x.text.current))return null;x.box.current.style.transition="opacity 200ms ease-out",x.box.current.style.opacity=1}),[k,x.text,x.box,j]);var D=Object(r.useState)(null),q=Object(f.a)(D,2),F=q[0],N=q[1],U=Object(ja.useSwipeable)(xa(null===v||void 0===v?void 0:v[j],x,N,!1)),P=Object(ja.useSwipeable)(xa(null===v||void 0===v?void 0:v[j],x,N,!0));return t?Object(ae.jsxs)("div",{ref:T,style:{height:"100%"},children:[Object(ae.jsxs)("div",Object(g.a)(Object(g.a)({},U),{},{style:{position:"relative",border:"1px solid",height:"".concat(E.splitHeight,"%")},children:[Object(ae.jsxs)("div",{ref:x.box,style:{height:"100%",width:"100%",overflow:"hidden",position:"absolute"},children:[Object(ae.jsx)("div",{ref:x.code,style:{padding:"0.6em 0.3em",width:"100%",fontSize:"3em",position:"absolute"}}),Object(ae.jsx)("div",{ref:x.text,style:{border:"1px solid",height:"100%",width:"100%",position:"absolute",top:"0",backgroundColor:"white",overflow:"hidden",fontSize:"".concat(E.textSize,"em")},children:Object(ae.jsx)(vn,{unit:t,settings:ba,setReady:w,returnTokens:l})})]}),Object(ae.jsx)(ha,{settings:E,setSettings:z})]})),Object(ae.jsx)("div",Object(g.a)(Object(g.a)({},P),{},{style:{height:"".concat(100-E.splitHeight,"%")},children:Object(ae.jsx)(da,{unit:t,tokens:s,questions:v,questionIndex:j,setQuestionIndex:b,setUnitIndex:a,swipe:F,blockEvents:i})}))]}):null},ha=function(e){var t=e.settings,n=e.setSettings,r=Object(bn.c)((function(e){return e.fullScreenNode}));return Object(ae.jsx)(ft.a,{on:"click",mountNode:r||void 0,trigger:Object(ae.jsx)(O.a,{name:"setting",style:{position:"absolute",cursor:"pointer",top:"0px",left:"0px",color:"grey",padding:"5px 3px",height:"30px"}}),children:Object(ae.jsx)(Oe.a,{children:Object(ae.jsxs)(Oe.a.Group,{grouped:!0,children:[Object(ae.jsxs)(Oe.a.Field,{children:[Object(ae.jsxs)("label",{children:["text window size ",Object(ae.jsx)("font",{style:{color:"blue"},children:"".concat(t.splitHeight,"%")})]}),Object(ae.jsx)(ht.a,{size:"mini",step:2,min:20,max:80,type:"range",value:t.splitHeight,onChange:function(e,t){return n((function(e){return Object(g.a)(Object(g.a)({},e),{},{splitHeight:t.value})}))}})]}),Object(ae.jsxs)(Oe.a.Field,{children:[Object(ae.jsxs)("label",{children:["text size scaling ",Object(ae.jsx)("font",{style:{color:"blue"},children:"".concat(t.textSize)})]}),Object(ae.jsx)(ht.a,{size:"mini",step:.025,min:.4,max:1.6,type:"range",value:t.textSize,onChange:function(e,t){return n((function(e){return Object(g.a)(Object(g.a)({},e),{},{textSize:t.value})}))}})]})]})})})},pa=function(e){return e.questions.map((function(e){var t=V(e.codes),n=J(t);n=va(Object(_.a)(n));var r=Oa(n),a=Object(f.a)(r,2),i=a[0],o=a[1];return Object(g.a)(Object(g.a)({},e),{},{options:i,swipeOptions:o})}))},va=function(e){var t,n=e.reduce((function(e,t){if(!t.required_for)return e;if("object"!==typeof t.required_for)e.add(t.required_for);else{var n,r=Object(x.a)(t.required_for);try{for(r.s();!(n=r.n()).done;){var a=n.value;e.add(a)}}catch(i){r.e(i)}finally{r.f()}}return e}),new Set),r=Object(x.a)(e);try{for(r.s();!(t=r.n()).done;){var a,i=t.value,o=Object(x.a)(n);try{for(o.s();!(a=o.n()).done;){var c=a.value;i.required_for&&(i.required_for===c||i.required_for.includes(c))||i.makes_irrelevant.includes(c)||(i.makes_irrelevant=[].concat(Object(_.a)(i.makes_irrelevant),[c]))}}catch(s){o.e(s)}finally{o.f()}}}catch(s){r.e(s)}finally{r.f()}return e},Oa=function(e){var t,n=[],r={},a=Object(x.a)(e);try{for(a.s();!(t=a.n()).done;){var i=t.value;if(i.active&&i.activeParent){var o=i.tree.join(" - "),c={code:i.code,tree:o,makes_irrelevant:i.makes_irrelevant,color:i.color};i.swipe&&(r[i.swipe]=c),n.push(c)}}}catch(s){a.e(s)}finally{a.f()}return[n,r]},xa=function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:150;if(!e)return{};if("annotinder"!==e.type)return{};var i=200,o={delta:10,preventDefaultTouchmoveEvent:!1,trackTouch:!0,trackMouse:!1,rotationAngle:0},c=function(e){var n=e.deltaX,a=e.deltaY;if(Math.abs(n)>Math.abs(a)+10&&(a=0),Math.abs(n)<Math.abs(a)+10&&(n=0),!r){var i=t.text.current.getElementsByClassName("TokensContainer")[0];i.scrollHeight-Math.ceil(i.scrollTop)===i.clientHeight||(a=0)}return[n,a]};return Object(g.a)({onSwiping:function(n){var r,a,i=c(n),o=Object(f.a)(i,2),s=o[0],l=o[1];if((!(s>0)||e.swipeOptions.right)&&(!(s<0)||e.swipeOptions.left)&&(!(l<0)||e.swipeOptions.up)&&!(0!==l&&l>0)){t.text.current.style.transition="",t.text.current.style.transform="translateX(".concat(s,"px) translateY(").concat(l,"px)");var u,d,j,b,h=null===(r=e.swipeOptions.up)||void 0===r?void 0:r.color,p=null===(a=e.swipeOptions.up)||void 0===a?void 0:a.code,v="0%",O="center";if(s>0)h=null===(u=e.swipeOptions.right)||void 0===u?void 0:u.color,p=null===(d=e.swipeOptions.right)||void 0===d?void 0:d.code,v="40%",O="left";if(s<0)h=null===(j=e.swipeOptions.left)||void 0===j?void 0:j.color,p=null===(b=e.swipeOptions.left)||void 0===b?void 0:b.code,v="40%",O="right";t.box.current.style.backgroundColor=h,t.code.current.innerText=p,t.code.current.style.bottom=v,t.code.current.style.textAlign=O}},onSwiped:function(r){var o=c(r),s=Object(f.a)(o,2),l=s[0],u=s[1];if((!(l>0)||e.swipeOptions.right)&&(!(l<0)||e.swipeOptions.left)&&(!(u<0)||e.swipeOptions.up)&&!(0!==u&&u>0))if(t.text.current.style.transition="transform ".concat(i,"ms ease-out, opacity ").concat(i,"ms ease-out"),Math.abs(l)<a&&Math.abs(u)<a)t.text.current.style.transform="translateX(0%) translateY(0%)";else{t.text.current.style.transform="translateX(".concat(l>0?100:l<0?-100:0,"%) translateY(").concat(u>0?100:-100,"%)"),t.box.current.style.transition="opacity ".concat(i,"ms ease-out"),t.box.current.style.opacity=0;n(l>0?"right":"left"),n(null)}}},o)},ga=a.a.memo(fa),ma=function(e){var t,n=e.codingjob,r=En(n);if(!n)return null;var a=[8,8];return(null===(t=n.taskSettings)||void 0===t?void 0:t.type)&&("annotate"===n.taskSettings.type&&(a=[6,10]),"questions"===n.taskSettings.type&&(a=[8,8])),Object(ae.jsx)("div",{children:Object(ae.jsxs)(ve.a,{stackable:!0,columns:2,children:[Object(ae.jsxs)(ve.a.Column,{verticalAlign:"top",stretched:!0,width:a[0],children:[Object(ae.jsx)(p.a,{textAlign:"center",style:{background:"#1B1C1D",color:"white"},children:"Settings"}),Object(ae.jsx)(Ur,{codingjob:n})]}),Object(ae.jsx)(ve.a.Column,{width:a[1],children:Object(ae.jsx)(ya,{codingjob:n,units:r})})]})})},ya=a.a.memo((function(e){var t,n=e.codingjob,a=e.units,i=Object(r.useState)(null),o=Object(f.a)(i,2),c=o[0],s=o[1],l=Object(r.useState)(null),u=Object(f.a)(l,2),d=u[0],j=u[1],b=Object(r.useState)(null),h=Object(f.a)(b,2),p=h[0],v=h[1];if(Object(r.useEffect)((function(){(null===n||void 0===n?void 0:n.taskSettings)&&v(B(n.taskSettings))}),[n.taskSettings]),Object(r.useEffect)((function(){return a&&null!==c?c>=a.length?null:void qn(n,[a[c]]).then((function(e){var t=e[0];t.jobServer={postAnnotations:function(e){return console.log(e)}},t.rules={canGoBack:!0,canGoForward:!0},j(t)})):(j(null),null)}),[c,a,j,n]),!a)return null;return(null===n||void 0===n||null===(t=n.taskSettings)||void 0===t?void 0:t.type)?function(e){switch(e){case"questions":return Object(ae.jsx)(ka,{codebook:p,standardizedUnit:d,setUnitIndex:s,children:Object(ae.jsx)(Vn,{n:null===a||void 0===a?void 0:a.length,index:c,setIndex:s})});case"annotate":return Object(ae.jsx)(wa,{codebook:p,standardizedUnit:d,setUnitIndex:s,children:Object(ae.jsx)(Vn,{n:null===a||void 0===a?void 0:a.length,index:c,setIndex:s,canGoBack:!1,canGoForward:!1,quickKeyNext:!0})});default:return null}}(n.taskSettings.type):null})),ka=a.a.memo((function(e){var t=e.children,n=e.codebook,r=e.standardizedUnit,a=e.setUnitIndex;return n?"questions"===!(null===n||void 0===n?void 0:n.type)?null:Object(ae.jsxs)(ae.Fragment,{children:[Object(ae.jsxs)(p.a,{textAlign:"center",style:{background:"#1B1C1D",color:"white"},children:["Preview",t]}),Object(ae.jsx)("div",{style:{padding:"0",display:"flex",justifyContent:"center",height:"calc(100vh - 250px)",minHeight:"500px",maxHeight:"800px"},children:Object(ae.jsx)("div",{style:{padding:"0em",width:"70%",paddingTop:"1em",height:"100%"},children:Object(ae.jsx)(ga,{unit:r,codebook:n,setUnitIndex:a,blockEvents:!0})})})]}):null})),wa=function(e){var t=e.children,n=e.codebook,r=e.standardizedUnit,a=e.setUnitIndex,i=Object(bn.c)((function(e){return e.eventsBlocked}));return n?"annotate"!==n.type?null:Object(ae.jsxs)(ae.Fragment,{children:[Object(ae.jsx)(p.a,{textAlign:"center",style:{background:"#1B1C1D",color:"white"},children:"Preview"}),t,Object(ae.jsx)("div",{style:{padding:"0",width:"100%",height:"calc(100vh - 250px)",minHeight:"500px"},children:Object(ae.jsx)("div",{style:{padding:"0",height:"100%"},children:Object(ae.jsx)(Jr,{unit:r,codebook:n,setUnitIndex:a,blockEvents:i})})})]}):null},Ca=a.a.memo(ma),Sa={medium:null,nCoders:1,pctOverlap:10},_a=function(e){var t,n=e.codingjob,a=e.deploySettings,i=e.setDeploySettings,o=Object(r.useState)(null),c=Object(f.a)(o,2),s=c[0],l=c[1],u=(null===n||void 0===n||null===(t=n.unitSettings)||void 0===t?void 0:t.totalUnits)||0;Object(r.useEffect)((function(){l(a)}),[a,l]),Object(r.useEffect)((function(){if(s===a)return null;var e=setTimeout((function(){i(s)}),300);return function(){return clearTimeout(e)}}),[s,a,i]);var d=function(e,t){return Object(ae.jsx)(Oe.a.Field,{children:Object(ae.jsx)(bt.a,{value:e,label:t,checked:a.medium===e,onChange:function(t,n){return i(Object(g.a)(Object(g.a)({},a),{},{medium:e}))}})})};return null===s?null:Object(ae.jsxs)(Oe.a,{children:[Object(ae.jsxs)(Oe.a.Group,{children:[Object(ae.jsx)(O.a,{name:"setting"}),Object(ae.jsx)("label",{children:"Deploy medium"})]}),Object(ae.jsxs)(Oe.a.Group,{grouped:!0,widths:"equal",children:[d("file","File"),d("amcat","AmCAT")]}),Object(ae.jsx)("div",{}),"file"!==a.medium?null:Object(ae.jsxs)(ae.Fragment,{children:[Object(ae.jsx)("br",{}),Object(ae.jsxs)(Oe.a.Group,{children:[Object(ae.jsx)(O.a,{name:"setting"}),Object(ae.jsx)("label",{children:"Divide jobs"})]}),Object(ae.jsxs)(Oe.a.Group,{children:[Object(ae.jsxs)(Oe.a.Field,{width:5,children:[Object(ae.jsx)("label",{children:"Coders"}),Object(ae.jsx)(ht.a,{size:"mini",type:"number",min:1,value:s.nCoders,onChange:function(e,t){return l((function(e){return Object(g.a)(Object(g.a)({},e),{},{nCoders:t.value})}))}})]}),Object(ae.jsxs)(Oe.a.Field,{width:7,children:[Object(ae.jsx)("label",{children:"Overlap"}),Object(ae.jsx)(ht.a,{size:"mini",type:"number",step:1,min:0,max:100,label:"%",labelPosition:"right",value:s.pctOverlap,onChange:function(e,t){return l((function(e){return Object(g.a)(Object(g.a)({},e),{},{pctOverlap:t.value})}))}})]}),Object(ae.jsx)(Aa,{totalUnits:u,settings:s})]})]})]})},Aa=function(e){var t=e.totalUnits,n=e.settings;if(!n)return null;var r=Math.round(t*n.pctOverlap/100),a=r+(t-r)/n.nCoders;return Object(ae.jsxs)("p",{style:{textAlign:"center",color:"blue"},children:["Avg. units per coder:"," ",Object(ae.jsx)("b",{style:{fontSize:"1.3em"},children:Math.round(100*a)/100})]})},Ia=function(e){var t=e.codingjob,n=(null===t||void 0===t?void 0:t.deploySettings)||Sa;return n?Object(ae.jsx)("div",{style:{verticalAlign:"top",float:"top",paddingLeft:"1em"},children:Object(ae.jsx)(_a,{codingjob:t,deploySettings:n,setDeploySettings:function(e){re.setCodingjobProp(t,"deploySettings",e)}})}):null},Ra=n(224),Ea=n(151),za=n.n(Ea),Ta=n(225),Da=n.n(Ta),qa=[{Header:"Title",accessor:"title",headerClass:"two wide"},{Header:"URL",accessor:"url",headerClass:"four wide"},{Header:"Created",accessor:"created",headerClass:"four wide"}],Fa=function(e){var t=e.jobKey,n=e.setJobKey,a=Object(Ae.useLiveQuery)(Object(b.a)(j.a.mark((function e(){var t;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,re.idb.deployedJobs.toArray();case 2:return(t=e.sent).sort((function(e,t){return t.created-e.created})),console.log(t),e.abrupt("return",t.map((function(e){return Object(g.a)(Object(g.a)({},e),{},{created:e.created.toDateString()})})));case 6:case"end":return e.stop()}}),e)}))));return Object(r.useEffect)((function(){!t&&a&&n(a.length>0?Object(g.a)(Object(g.a)({},a[0]),{},{ROW_ID:"0"}):null)}),[t,a,n]),Object(ae.jsx)(He,{columns:qa,data:a||[],selectedRow:t,setSelectedRow:n,defaultSize:15})},Na=[{Header:"document_id",accessor:"document_id",headerClass:"three wide"},{Header:"unit_id",accessor:"unit_id",headerClass:"two wide"},{Header:"Coder",accessor:"coder",headerClass:"three wide"},{Header:"Variable",accessor:"variable",headerClass:"three wide"},{Header:"Value",accessor:"value",headerClass:"three wide"}],Ua=function(e){var t=e.jobKey,n=Object(r.useState)([]),a=Object(f.a)(n,2),i=a[0],o=a[1],c=Object(me.a)(["amcat"]),s=Object(f.a)(c,1)[0];return Object(r.useEffect)((function(){if(!t)return null;if(!s.amcat)return null;var e=he(s.amcat.host,s.amcat.email,s.amcat.token);o([]),Pa(t,e,o)}),[t,s,o]),Object(ae.jsx)(He,{columns:Na,data:i})},Pa=function(){var e=Object(b.a)(j.a.mark((function e(t,n,r){var a,i;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,re.idb.deployedJobs.get({url:t.url});case 2:if(e.sent){e.next=5;break}return e.abrupt("return");case 5:if(n){e.next=7;break}return e.abrupt("return");case 7:return e.prev=7,e.next=10,n.api.get(t.url);case 10:a=e.sent,i=a.data.units.reduce((function(e,t,n){if(t.annotations)for(var r=0,a=Object.keys(t.annotations);r<a.length;r++){var i,o=a[r],c=Object(x.a)(t.annotations[o]);try{for(c.s();!(i=c.n()).done;){var s=i.value,l=Object(g.a)(Object(g.a)({document_id:t.document_id,unit_id:n,coder:o},t.provenance),s);if(t.meta)for(var u=0,d=Object.keys(t.meta);u<d.length;u++){var j=d[u];l["meta_"+j]=t.meta[j]}e.push(l)}}catch(b){c.e(b)}finally{c.f()}}return e}),[]),console.log(i),r(i),e.next=19;break;case 16:e.prev=16,e.t0=e.catch(7),console.log(e.t0);case 19:case"end":return e.stop()}}),e,null,[[7,16]])})));return function(t,n,r){return e.apply(this,arguments)}}(),La=function(){var e=Object(c.f)(),t=Object(r.useState)(null),n=Object(f.a)(t,2),a=n[0],i=n[1],o=function(){var t=Object(b.a)(j.a.mark((function t(){return j.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.push("/annotator?url="+a.url);case 1:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();return Object(ae.jsx)(ve.a,{centered:!0,container:!0,children:Object(ae.jsxs)(ve.a.Row,{children:[Object(ae.jsx)(ve.a.Column,{width:8,children:Object(ae.jsx)(Fa,{jobKey:a,setJobKey:i})}),Object(ae.jsxs)(ve.a.Column,{width:8,children:[Object(ae.jsx)(v.a,{primary:!0,disabled:!a,onClick:o,children:"Open selected codingjob"}),Object(ae.jsx)("br",{}),Object(ae.jsx)("br",{}),function(){if(null==a)return Object(ae.jsx)("div",{style:{height:"6em"}});var e="https://ccs-amsterdam.github.io/CCS_annotator/#/annotator?url="+(null===a||void 0===a?void 0:a.url),t="https://ccs-amsterdam.github.io/CCS_annotator/#/annotator?url="+(null===a||void 0===a?void 0:a.url.replace(":","%colon%"));return Object(ae.jsxs)("div",{style:{height:"6em"},children:[Object(ae.jsx)(tr.a,{value:e,style:{width:"100%",height:"4em",fontSize:"10px"}}),Object(ae.jsx)(ft.a,{hoverable:!0,trigger:Object(ae.jsx)(v.a,{children:"Show QR code"}),children:Object(ae.jsx)(Da.a,{value:encodeURI(t),size:256})})]})}(),Object(ae.jsx)(p.a,{children:"Current annotations"}),Object(ae.jsx)(Ua,{jobKey:a})]})]})})},Ma=function(e){var t=e.codingjobPackage,n=Object(r.useState)(""),a=Object(f.a)(n,2),i=a[0],o=a[1];Object(r.useEffect)((function(){(null===t||void 0===t?void 0:t.title)&&o(t.title)}),[t]);var c=function(){var e=Object(b.a)(j.a.mark((function e(){var n,r,a,i,o;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(n=Ga(t),(r=new za.a).file("AmCAT_annotator_".concat(t.title,".json"),JSON.stringify(t)),a=0;a<n.length;a++)i="set_".concat(n[a].set,"_units_").concat(n[a].units.length,"_").concat(t.title,".json"),r.file(i,JSON.stringify(n[a]));return e.next=6,r.generateAsync({type:"blob"});case 6:o=e.sent,Object(Ra.saveAs)(o,"AmCAT_annotator_".concat(t.title,".zip"));case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(ae.jsxs)("div",{children:[Object(ae.jsx)(Oe.a,{onSubmit:function(){return c()},children:Object(ae.jsx)(Oe.a.Input,{placeholder:"username",value:i,maxLength:30,onChange:function(e,t){return o(t.value)},autoFocus:!0,style:{width:"100%"}})}),Object(ae.jsx)("br",{}),Object(ae.jsxs)(v.a,{primary:!0,fluid:!0,loading:null===t,disabled:i.length<5,onClick:c,children:[i.length<5?"please use 5 characters or more":"Download codingjob files"," "]})]})},Ha=function(e){var t=e.codingjobPackage,n=Object(r.useState)(""),a=Object(f.a)(n,2),i=a[0],o=a[1],c=Object(me.a)(["amcat"]),s=Object(f.a)(c,3),l=s[0],u=s[2];Object(r.useEffect)((function(){(null===t||void 0===t?void 0:t.title)&&o(t.title)}),[t]);var d=function(){var e=Object(b.a)(j.a.mark((function e(){var n,r,a;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=he(l.amcat.host,l.amcat.email,l.amcat.token),e.prev=1,e.next=4,n.postCodingjob(t,i);case 4:r=e.sent,a="".concat(n.host,"/codingjob/").concat(r.data.id),re.createDeployedJob(i,a),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(1),console.log(e.t0),u("amcat");case 13:case"end":return e.stop()}}),e,null,[[1,9]])})));return function(){return e.apply(this,arguments)}}();return l.amcat?Object(ae.jsxs)("div",{children:[Object(ae.jsx)(Oe.a,{onSubmit:function(){return d()},children:Object(ae.jsx)(Oe.a.Input,{placeholder:"username",value:i,maxLength:30,onChange:function(e,t){return o(t.value)},autoFocus:!0,style:{width:"100%"}})}),Object(ae.jsx)("br",{}),Object(ae.jsx)(v.a,{fluid:!0,primary:!0,disabled:i.length<5,onClick:function(){return d()},children:i.length<5?"please use 5 characters or more":"Upload to AmCAT"})]}):Object(ae.jsx)("p",{children:"You need to log in to AmCAT first. (see top-right in the menu)"})},Ga=function(e){for(var t=e.provenance.unitSettings,n=e.provenance.deploySettings,r=e.units,a=Math.round(t.totalUnits*n.pctOverlap/100),i=r.slice(0,a),o=r.slice(a),c=Array(Number(n.nCoders)).fill([]).map((function(e){return Object(_.a)(i)})),s=0;s<o.length;s++)c[s%c.length].push(o[s]);return c.map((function(t,n){return{set:n+1,title:e.title,codebook:e.codebook,units:gn(t,t.length,!1,42,null)}}))},Ba=function(){var e=Object(b.a)(j.a.mark((function e(t,n,r){var a,i,o=arguments;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=o.length>3&&void 0!==o[3]&&o[3],e.t0=t.name,e.t1={unitSettings:t.unitSettings,deploySettings:t.deploySettings},e.t2=B(t.taskSettings),e.next=6,qn(t,n);case 6:if(e.t3=e.sent,e.t4={authentication:"user"},e.t5=[],i={title:e.t0,provenance:e.t1,codebook:e.t2,units:e.t3,rules:e.t4,annotations:e.t5},!a){e.next=14;break}return e.next=13,re.idb.documents.where("job_id").equals(t.job_id).toArray();case 13:i.provenance.documents=e.sent;case 14:r(i);case 15:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),Wa=function(e){var t,n=e.codingjob,a=Object(r.useState)(null),i=Object(f.a)(a,2),o=i[0],c=i[1],s=En(n);Object(r.useEffect)((function(){if(s&&0!==s.length&&(null===n||void 0===n?void 0:n.unitSettings)&&(null===n||void 0===n?void 0:n.taskSettings)&&(null===n||void 0===n?void 0:n.deploySettings)){var e="file"===n.deploySettings.medium;Ba(n,s,c,e)}}),[n,s,c]);return n?Object(ae.jsx)("div",{children:Object(ae.jsxs)(ve.a,{centered:!0,stackable:!0,columns:2,children:[Object(ae.jsxs)(ve.a.Column,{width:5,children:[Object(ae.jsx)(p.a,{textAlign:"center",style:{background:"#1B1C1D",color:"white"},children:"Deploy Codingjob"}),Object(ae.jsx)(Ia,{codingjob:n}),Object(ae.jsx)("br",{}),function(e){if(!e)return null;switch(n.deploySettings.medium){case"file":return Object(ae.jsx)(Ma,{codingjobPackage:o});case"amcat":return Object(ae.jsx)(Ha,{codingjobPackage:o});default:return null}}(null===n||void 0===n||null===(t=n.deploySettings)||void 0===t?void 0:t.medium)]}),function(){var e;return(null===n||void 0===n||null===(e=n.deploySettings)||void 0===e?void 0:e.medium)?"amcat"!==n.deploySettings.medium?null:Object(ae.jsxs)(ve.a.Column,{width:11,children:[Object(ae.jsx)(p.a,{textAlign:"center",style:{background:"#1B1C1D",color:"white"},children:"Previously deployed jobs"}),Object(ae.jsx)(La,{})]}):null}()]})}):null},Va=function(){var e,t,n,a,i,o,c,s,l=Object(r.useState)("codingjobs"),u=Object(f.a)(l,2),d=u[0],j=u[1],b=Object(r.useState)(null),h=Object(f.a)(b,2),p=h[0],v=h[1],O=Object(Ae.useLiveQuery)((function(){return p?re.idb.codingjobs.get(p.job_id).then((function(e){return Object(g.a)(Object(g.a)({},e),{},{ROW_ID:p.ROW_ID})})).catch((function(e){console.log(e)})):null}),[p]),x=Object(Ae.useLiveQuery)((function(){return(null===O||void 0===O?void 0:O.job_id)?re.idb.documents.where("job_id").equals(O.job_id).count():0}),[O]);return Object(ae.jsxs)("div",{style:{margin:"1em"},children:[Object(ae.jsxs)(_e.a.Group,{ordered:!0,unstackable:!0,size:"tiny",style:{width:"100%",overflow:"auto"},children:[Object(ae.jsx)(_e.a,{title:"Codingjob",description:O?O.name:"none selected",active:"codingjobs"===d,completed:null!==O&&null!=O,onClick:function(e,t){j("codingjobs")}}),Object(ae.jsx)(_e.a,{title:"Documents",description:x>0?"".concat(x," documents"):"",active:"documents"===d,completed:x>0,disabled:null===O,onClick:function(e,t){return j("documents")}}),Object(ae.jsx)(_e.a,{title:"Units",description:(null===O||void 0===O||null===(e=O.unitSettings)||void 0===e?void 0:e.n)?"".concat(null===O||void 0===O||null===(t=O.unitSettings)||void 0===t?void 0:t.n," units"):null,active:"units"===d,completed:null===O||void 0===O||null===(n=O.unitSettings)||void 0===n?void 0:n.n,disabled:0===x,onClick:function(e,t){return j("units")}}),Object(ae.jsx)(_e.a,{title:"Task",description:(null===O||void 0===O||null===(a=O.taskSettings)||void 0===a?void 0:a.type)||"Define the task",active:"task"===d,completed:null===O||void 0===O||null===(i=O.taskSettings)||void 0===i?void 0:i.type,disabled:!(null===O||void 0===O||null===(o=O.unitSettings)||void 0===o?void 0:o.n),onClick:function(e,t){return j("task")}}),Object(ae.jsx)(_e.a,{title:"Deploy",description:"Get (others) to work",active:"deploy"===d,disabled:null===O||!(null===O||void 0===O||null===(c=O.unitSettings)||void 0===c?void 0:c.n)||!(null===O||void 0===O||null===(s=O.taskSettings)||void 0===s?void 0:s.type),onClick:function(e,t){return j("deploy")}})]}),Object(ae.jsx)(xe.a,{style:{border:"0"},attached:"bottom",children:function(e){switch(e){case"codingjobs":return Object(ae.jsx)(Ye,{codingjob:O,setSelectedCodingjob:v});case"documents":return Object(ae.jsx)(jt,{codingjob:O});case"units":return Object(ae.jsx)($n,{codingjob:O});case"task":return Object(ae.jsx)(Ca,{codingjob:O});case"deploy":return Object(ae.jsx)(Wa,{codingjob:O});default:return null}}(d)})]})},Ja=a.a.memo(Va),Ka=n(161),Ya=function(){var e=Object(b.a)(j.a.mark((function e(t,n){return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),Qa=function(){var e=Object(b.a)(j.a.mark((function e(t,n){var r,a,i,o,c,s,l,u,d,b,f,h,p,v,O,m;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=[],a=t.codebook.questions.map((function(e,t){return"Q".concat(t+1,"_").concat(e.name.replace(" ","_"))})),i=t.units.reduce((function(e,t){return e[t.unit_id]=t,e}),{}),e.next=5,re.getAllAnnotations(t.id);case 5:o=e.sent,c=Object(x.a)(o);try{for(c.s();!(s=c.n()).done;){if(l=s.value,u=l.annotations,console.log(u),d=i[l.unit_id],b=Object(g.a)(Object(g.a)({document_id:d.document_id,unit_id:d.unit_id},d.provenance),{},{offset:u[0].offset,length:u[0].length,section:u[0].section},u[0].meta),d.meta)for(f=0,h=Object.keys(d.meta);f<h.length;f++)p=h[f],b["meta_"+p]=d.meta[p];v=Object(x.a)(a);try{for(m=function(){var e=O.value,t=u.find((function(t){return t.variable===e}));b[e]=null==t?null:t.value},v.s();!(O=v.n()).done;)m()}catch(j){v.e(j)}finally{v.f()}r.push(b)}}catch(j){c.e(j)}finally{c.f()}n(r);case 9:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),Xa=function(e){var t=e.localJobServer,n=Object(r.useState)(null),a=Object(f.a)(n,2),i=a[0],o=a[1];return Object(r.useEffect)((function(){switch(t.codebook.type){case"annotate":Ya(t,o);break;case"questions":Qa(t,o);break;default:return null}}),[t]),console.log(t),Object(ae.jsx)(Xe.a,{filename:"CSSannotator_".concat(t.title,"_").concat(t.set,"_").concat(t.coderName,".json"),data:i,style:{cursor:"pointer"},children:Object(ae.jsx)(v.a,{loading:null===i,primary:!0,content:"Download results",icon:"download",labelPosition:"left",size:"huge"})})},Za=function(e){var t=e.children,n=Object(r.useState)(null),a=Object(f.a)(n,2),i=a[0],o=a[1],c=Object(bn.b)();return Object(r.useEffect)((function(){return c(ar(i)),function(){c(ar(null))}}),[i,c]),Object(ae.jsx)("div",{className:"dom-node-provider",ref:o,children:t(i)})},$a=function(e){var t=e.handle,n=e.children;return Object(ae.jsxs)(Ka.a,{handle:t,children:[Object(ae.jsx)(Za,{children:function(e){return n}}),";"]})},ei=function(e){var t=e.jobServer;return t?"remote"===t.where?Object(ae.jsx)(ve.a,{container:!0,centered:!0,verticalAlign:"middle",style:{margin:"0",padding:"0"},children:Object(ae.jsx)(ve.a.Row,{style:{marginTop:"40vh"},children:Object(ae.jsx)("div",{children:Object(ae.jsx)(O.a,{name:"flag checkered",size:"huge",style:{transform:"scale(5)"}})})})}):Object(ae.jsx)(ve.a,{container:!0,centered:!0,verticalAlign:"middle",style:{margin:"0",padding:"0"},children:Object(ae.jsxs)(ve.a.Row,{style:{marginTop:"40vh"},children:[Object(ae.jsx)(ve.a.Column,{width:4,children:Object(ae.jsx)(O.a,{name:"flag checkered",size:"huge",style:{transform:"scale(1)"}})}),Object(ae.jsxs)(ve.a.Column,{width:8,children:[Object(ae.jsx)(p.a,{children:"You finished the codingjob!"}),Object(ae.jsx)("p",{children:"Please download your results and send them to whoever gave you this job. "}),Object(ae.jsx)(Xa,{localJobServer:t})]})]})}):null},ti=function(e){var t=e.location,n=e.handle,a=Object(r.useState)(!0),i=Object(f.a)(a,2),o=i[0],c=i[1];return Object(r.useEffect)((function(){c(!0)}),[t,c]),Object(ae.jsxs)(h.a,{open:o,children:[Object(ae.jsx)(h.a.Header,{children:"Fullscreen mode"}),Object(ae.jsxs)(h.a.Content,{children:[Object(ae.jsx)("p",{children:"We recommend working in fullscreen, especially on mobile devices. You can always change this with the button in the top-left corner"}),Object(ae.jsxs)("div",{style:{display:"flex",height:"30vh"},children:[Object(ae.jsx)(v.a,{primary:!0,size:"massive",onClick:function(){n.active||n.enter(),c(!1)},style:{flex:"1 1 auto"},children:"Fullscreen"}),Object(ae.jsx)(v.a,{secondary:!0,size:"massive",onClick:function(){n.active&&n.exit(),c(!1)},style:{flex:"1 1 auto"},children:"Windowed"})]})]})]})},ni=function(e){var t=e.handle;return Object(ae.jsx)(O.a.Group,{size:"big",style:{padding:"3px",position:"absolute",top:"0px",left:"2px"},children:Object(ae.jsx)(O.a,{link:!0,name:t.active?"compress":"expand",onClick:function(){t.active?t.exit():t.enter()}})})},ri=function(){var e=Object(c.f)();return Object(ae.jsxs)(O.a.Group,{size:"big",style:{padding:"3px",position:"absolute",top:"0px",right:0},children:[Object(ae.jsx)(O.a,{link:!0,name:"window close",onClick:function(){return e.goBack()}}),Object(ae.jsx)(O.a,{corner:"top right"})]})},ai=function(e){var t=e.codebook,n=e.unit,r=e.setUnitIndex;if(!t||!n)return null;return(null===t||void 0===t?void 0:t.type)?function(e){switch(e){case"questions":return Object(ae.jsx)(ga,{unit:n,codebook:t,setUnitIndex:r});case"annotate":return Object(ae.jsx)(Jr,{unit:n,codebook:t,setUnitIndex:r});default:return null}}(t.type):null},ii=function(e){var t,n=e.jobServer,a=Object(Ka.b)(),i=Object(r.useState)(0),o=Object(f.a)(i,2),s=o[0],l=o[1],u=Object(r.useState)(null),d=Object(f.a)(u,2),j=d[0],b=d[1],h=Object(c.g)();Object(r.useEffect)((function(){l(n.progressIndex)}),[n,l]),Object(r.useEffect)((function(){n&&n.getUnit(s).then((function(e){b(Object(g.a)({jobServer:n,unitId:e.id},e.unit))})).catch((function(e){var t;404===(null===(t=e.response)||void 0===t?void 0:t.status)&&(alert("Could not get unit from server"),b(null),console.log(e))}))}),[s,n,l,b]);return Object(ae.jsx)($a,{handle:a,children:Object(ae.jsxs)("div",{style:{maxWidth:"100%",maxHeight:"100%",background:"white",margin:"0 auto",padding:"0",height:"100vh",border:"1px solid white"},children:[Object(ae.jsx)(ti,{location:h,handle:a}),Object(ae.jsxs)("div",{style:{height:"50px",padding:"0",position:"relative"},children:[Object(ae.jsx)("div",{style:{width:"85%",paddingLeft:"7.5%"},children:Object(ae.jsx)(Vn,{n:null===n||void 0===n?void 0:n.rules.n,index:s,setIndex:l,canGoBack:null===n||void 0===n?void 0:n.rules.canGoBack,canGoForward:null===n||void 0===n?void 0:n.rules.canGoForward,quickKeyNext:"annotate"===(null===n||void 0===n||null===(t=n.codebook)||void 0===t?void 0:t.type)})}),Object(ae.jsxs)("div",{children:[Object(ae.jsx)(ni,{handle:a}),Object(ae.jsx)(ri,{})]})]}),Object(ae.jsx)("div",{style:{height:"calc(100% - 50px)",padding:"0"},children:null===s?Object(ae.jsx)(ei,{jobServer:n}):Object(ae.jsx)(ai,{codebook:null===n||void 0===n?void 0:n.codebook,unit:j,setUnitIndex:l})})]})})},oi=function(){function e(t,n){Object(y.a)(this,e),this.url=t,this.coderName=n,this.where="remote"}return Object(k.a)(e,[{key:"init",value:function(){var e=Object(b.a)(j.a.mark((function e(){var t,n,r;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=new URL(this.url),r=n.pathname.split("/")[2],e.next=5,je.a.get("".concat(this.url,"/codebook?id=").concat(r));case 5:t=e.sent,e.next=12;break;case 8:return e.prev=8,e.t0=e.catch(0),this.success=!1,e.abrupt("return");case 12:this.success=!0,this.codebook=t.data,this.rules={n:20,canGoBack:!1,canGoForward:!1},this.progressIndex=0;case 16:case"end":return e.stop()}}),e,this,[[0,8]])})));return function(){return e.apply(this,arguments)}}()},{key:"getUnit",value:function(){var e=Object(b.a)(j.a.mark((function e(t){var n;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,je.a.get("".concat(this.url,"/unit?user=").concat(this.coderName));case 2:return n=e.sent,e.abrupt("return",n.data);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"postAnnotations",value:function(e,t){je.a.post("".concat(this.url,"/unit/").concat(e,"/annotation?user=").concat(this.coderName),t)}}]),e}(),ci=function(){function e(t,n){Object(y.a)(this,e),this.id=t,this.coderName=n,this.where="local"}return Object(k.a)(e,[{key:"init",value:function(){var e=Object(b.a)(j.a.mark((function e(){var t;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,re.idb.localJobs.get({id:this.id});case 2:if(t=e.sent){e.next=6;break}return this.success=!1,e.abrupt("return",null);case 6:this.success=!0,this.units=t.units,this.codebook=t.codebook,this.title=t.title,this.set=t.set,this.rules={n:t.units.length,canGoBack:!0,canGoForward:!1},this.progressIndex=t.progressIndex||0;case 13:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getUnit",value:function(){var e=Object(b.a)(j.a.mark((function e(t){var n,r,a;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null===t){e.next=3;break}return e.next=3,re.idb.localJobs.where("id").equals(this.id).modify({progressIndex:Math.max(t,this.progressIndex),last_modified:new Date});case 3:return r=this.units[t].unit_id,e.next=6,re.getUnitAnnotations(this.id,r);case 6:return a=e.sent,a=(null===(n=a)||void 0===n?void 0:n.annotations)||[],e.abrupt("return",{id:r,unit:Object(g.a)(Object(g.a)({},this.units[t]),{},{annotations:a})});case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"postAnnotations",value:function(){var e=Object(b.a)(j.a.mark((function e(t,n){return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:re.postAnnotations(this.id,t,n);case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}]),e}(),si=function(){var e=Object(b.a)(j.a.mark((function e(t,n,r){var a;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=new ci(t,n.name),e.next=3,a.init();case 3:r(a);case 4:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),li=function(){var e=Object(b.a)(j.a.mark((function e(t,n,r){var a;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=new oi(t,n.name),e.next=3,a.init();case 3:r(a);case 4:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),ui=function(e){return e.search.substring(1).split("&").reduce((function(e,t){var n=t.split("="),r=Object(f.a)(n,2),a=r[0],i=r[1];return e[decodeURIComponent(a)]=decodeURIComponent(i),e}),{})},di=[{Header:"Title",accessor:"title",headerClass:"two wide"},{Header:"Set",accessor:"set",headerClass:"two wide"},{Header:"progress",accessor:"progress",headerClass:"two wide"},{Header:"Last modified",accessor:"last_modified_str",headerClass:"four wide"}],ji=function(e){var t=e.jobKey,n=e.setJobKey,a=Object(Ae.useLiveQuery)(Object(b.a)(j.a.mark((function e(){var t;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[],e.next=3,re.idb.localJobs.each((function(e){t.push({id:e.id,last_modified:e.last_modified,last_modified_str:e.last_modified.toString().slice(0,24),set:e.set,progress:"".concat(e.progressIndex||0," / ").concat(e.units.length),title:e.title})}));case 3:return t.sort((function(e,t){return t.last_modified-e.last_modified})),e.abrupt("return",t);case 5:case"end":return e.stop()}}),e)}))));return Object(r.useEffect)((function(){!t&&a&&n(a.length>0?Object(g.a)(Object(g.a)({},a[0]),{},{ROW_ID:"0"}):null)}),[t,a,n]),Object(ae.jsx)(He,{columns:di,data:a||[],selectedRow:t,setSelectedRow:n,defaultSize:15})},bi=function(e){var t=e.split(".");return t[t.length-1]},fi=function(){var e=Object(c.f)(),t=Object(r.useState)(null),n=Object(f.a)(t,2),a=n[0],i=n[1],o=function(){var e=Object(b.a)(j.a.mark((function e(t){var n,r,a,i,o;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=new FileReader,r=t.target.files[0],"json"===(a=bi(r.name))&&(n.readAsText(r,"UTF-8"),n.onload=function(e){var t=S()(e.target.result);re.createLocalJob(JSON.parse(e.target.result),t)}),"zip"!==a){e.next=10;break}return i=new za.a,e.next=8,i.loadAsync(r);case 8:(o=e.sent).forEach(function(){var e=Object(b.a)(j.a.mark((function e(t,n){var r,a;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("set"===n.name.slice(0,3)){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,o.file(n.name).async("text");case 4:r=e.sent,a=S()(r),re.createLocalJob(JSON.parse(r),a);case 7:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}());case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),s=function(){var t=Object(b.a)(j.a.mark((function t(){return j.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.push("/annotator?id="+a.id);case 1:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();return Object(ae.jsxs)(ve.a,{centered:!0,stackable:!0,container:!0,style:{marginTop:"5em"},children:[Object(ae.jsxs)(ve.a.Column,{style:{textAlign:"center"},width:8,children:[Object(ae.jsx)(p.a,{textAlign:"center",style:{background:"#1B1C1D",color:"white"},children:"Read codingjob"}),Object(ae.jsx)("input",{type:"file",accept:".json,.zip",onChange:o}),Object(ae.jsx)("div",{children:Object(ae.jsx)("br",{})})]}),Object(ae.jsxs)(ve.a.Column,{width:8,children:[Object(ae.jsx)(p.a,{textAlign:"center",style:{background:"#1B1C1D",color:"white"},children:"Your codingjobs"}),Object(ae.jsx)(v.a,{fluid:!0,primary:!0,disabled:!a,onClick:s,children:"Open selected codingjob"}),Object(ae.jsx)("br",{}),Object(ae.jsx)("br",{}),Object(ae.jsx)(ji,{jobKey:a,setJobKey:i})]})]})},hi=[{label:"Annotator",path:"/annotator",Component:function(){var e=Object(c.g)(),t=Object(r.useState)(null),n=Object(f.a)(t,2),a=n[0],i=n[1],o=Object(me.a)(["name"]),s=Object(f.a)(o,1)[0];return Object(r.useEffect)((function(){if(s.name)if(e.search){var t=ui(e);(null===t||void 0===t?void 0:t.url)&&(t.url=t.url.replace("%colon%",":").replace("%25colon%25",":"),li(t.url,s,i)),(null===t||void 0===t?void 0:t.id)&&si(t.id,s,i)}else i(null)}),[e,s,i]),s.name?a?Object(ae.jsx)(ii,{jobServer:a}):null:Object(ae.jsx)(Ce,{force:!0})},menu:!1},{label:"Jobs",path:"/jobs",Component:fi,menu:!0},{label:"Codingjob manager",path:"/manager",Component:Ja,menu:!0}],pi=function(){return Object(ae.jsx)(s.a,{basename:"/",children:Object(ae.jsx)(Se,{items:hi,children:Object(ae.jsxs)(c.c,{children:[Object(ae.jsx)(c.a,{exact:!0,path:"/",render:function(){return Object(ae.jsx)(Ja,{})}}),(e=hi,e.map((function(e){return Object(ae.jsx)(c.a,{exact:!0,path:e.path,render:function(){return Object(ae.jsx)(e.Component,{})}})})))]})})});var e},vi=n(152),Oi=Object(vi.a)({eventsBlocked:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1?arguments[1]:void 0;return"BLOCK_EVENTS"===t.type?t.block:e},fullScreenNode:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0;return"SET_FULL_SCREEN_NODE"===t.type?t.node:e}}),xi=Oi,gi=n(327),mi=Object(vi.b)(xi);o.a.render(Object(ae.jsx)(a.a.StrictMode,{children:Object(ae.jsx)(gi.a,{children:Object(ae.jsx)(bn.a,{store:mi,children:Object(ae.jsx)(pi,{})})})}),document.querySelector("#root"))}},[[302,1,2]]]);
//# sourceMappingURL=main.4060f071.chunk.js.map