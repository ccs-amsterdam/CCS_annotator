{"version":3,"sources":["../node_modules/react-semantic-ui-datepickers/dist/locales sync /^/.//.*/.json$","apis/dexie.js","components/Download.js","actions/index.js","components/Reset.js","apis/storemanager.js","components/Persist.js","components/HeaderMenu.js","apis/demodata.js","components/Welcome.js","components/AuthRoute.js","components/SelectionTable.js","components/CreateCodingjob.js","components/DeleteCodingjob.js","components/CodingjobSelector.js","components/DocumentTable.js","components/JobDetails.js","components/UploadDocuments.js","components/CreateDocument.js","components/Create.js","components/ManageAnnotations.js","components/CodeSelector.js","components/Token.js","components/Tokens.js","components/AnnotationText.js","components/Annotate.js","App.js","reducers/index.js","index.js"],"names":["map","webpackContext","req","id","webpackContextResolve","__webpack_require__","o","e","Error","code","keys","Object","resolve","module","exports","AnnotationDB","this","idb","Dexie","version","stores","apis","codingjobs","documents","api","token","put","refresh_token","expiration_date","delete","get","name","a","job_id","hash","Date","now","toString","add","codingjob","listDocuments","deleteDocuments","toArray","documentList","silent","Set","where","equals","primaryKeys","ids","duplicates","preparedDocuments","reduce","result","document","doc_id","has","annotations","length","JSON","parse","alert","push","message","bulkAdd","documentIds","bulkDelete","field","value","modify","progressCallback","totalRows","completedRows","console","log","Download","useState","open","setOpen","onDownload","db","exportDB","filter","table","key","prettyJson","blob","fileDownload","error","Modal","closeIcon","trigger","Menu","Item","icon","style","color","onClose","onOpen","Header","content","Content","Actions","Button","primary","onClick","setDB","type","payload","blockEvents","block","selectCodingjob","setCodingjobs","setDocuments","setCurrentToken","index","setTokenSelection","triggerCodeselector","tokenindex","toggleAnnotations","spanAnnotation","Reset","homepage","useSelector","state","dispatch","useDispatch","history","useHistory","deleteDB","Icon","initStoragePersistence","tryPersistWithoutPromtingUser","persist","navigator","storage","undefined","isStoragePersisted","persisted","permissions","query","permission","Persist","setPersisted","useEffect","then","withRouter","items","host","location","useLocation","menuItems","item","as","Link","to","path","header","disabled","active","pathname","label","fixed","inverted","position","demo_articles","title","text","create_demo_job","createCodingjob","job","createDocuments","Welcome","loggin","addDemo","exists","Grid","textAlign","height","verticalAlign","Column","maxWidth","Segment","border","AuthRoute","Component","componentProps","loading","setLoading","hasdb","setHasdb","connect","render","props","GlobalFilter","preGlobalFilteredRows","globalFilter","setGlobalFilter","count","onChange","target","placeholder","SelectionTable","columns","data","selectedRow","setSelectedRow","width","defaultSize","sizeSelector","ROW_ID","activeRow","setActiveRow","useTable","initialState","pageSize","useGlobalFilter","useSortBy","usePagination","getTableProps","getTableBodyProps","headerGroups","prepareRow","page","pageCount","gotoPage","setPageSize","pageIndex","createHeader","headerGroup","headers","column","TableHeaderCell","className","headerClass","getHeaderProps","getSortByToggleProps","isSorted","isSortedDesc","Table","unstackable","striped","singleLine","selectable","TableHeader","TableRow","getHeaderGroupProps","TableBody","row","i","onRowSelect","getRowProps","cells","cell","TableCell","getCellProps","createBody","Dropdown","options","n","d","marginTop","display","justifyContent","Pagination","size","firstItem","lastItem","nextItem","prevItem","boundaryRange","ellipsisItem","activePage","totalPages","onPageChange","event","CreateCodingjob","status","setStatus","codingjobName","setCodingjobName","onSubmit","preventDefault","trim","listCodingjobs","Form","Group","Input","required","Dimmer","Loader","DeleteCodingjob","deleteCodingjob","getCodingjobs","setSelectedCodingjob","cjs","getJobArticles","CodingjobSelector","indices","selectedCodingjob","widths","Container","overflow","accessor","inline","search","findIndex","onDropdownSelect","documentTableColumns","DocumentTable","selectDocument","JobDetails","SubmitForm","fileRef","setOptions","titleField","setTitleField","textField","setTextField","annotationsField","setAnnotationsField","colname","includes","csvToJson","slice","datarow","obj","meta","stringify","uploadData","preparedData","current","removeFile","Field","control","Select","clearable","fluid","PreviewTable","createRowCells","Cell","basic","Row","HeaderCell","Body","createRows","align","UploadDocuments","setActive","setData","useRef","stackable","floated","ref","onFileLoad","addRemoveButton","onRemoveFile","DocumentForms","fields","fieldValues","setFieldValues","newFieldValues","TextArea","CreateDocument","onCreate","submitData","test","toISOString","Create","activeItem","setActiveItem","pointing","secondary","renderSwitch","exportAnnotations","doc","unique","uniqueAnnotations","values","un_ann","ann","ann_obj","offset","json","writeValue","matchAnnotations","tokens","importedAnnotations","trackAnnotations","matchedAnnotations","findMatches","addAnnotations","start","end","group","span","newAnnotations","newAnnotation","ManageAnnotations","spanAnnotations","ready","setReady","getCurrentOptions","annotation","ddOptions","useValue","newCodeButtons","codeHistory","codes","setCurrent","backgroundColor","getColor","updateAnnotations","oldAnnotation","appendCodeHistory","tokenCode","codematch","find","CodeSelector","children","codeSelectorTrigger","textInputRef","userAccess","window","addEventListener","onKeydown","removeEventListener","click","Popup","flowing","hoverable","wide","mouseLeaveDelay","Step","vertical","Title","Description","compact","Ref","innerRef","selection","allowAdditions","additionPosition","onAddItem","setCodes","randomColor","seed","luminosity","selectOnNavigation","minCharacters","autoComplete","searchInput","autoFocus","Token","React","forwardRef","tokenClass","tokenSelection","from","AnnotatedToken","pre","post","tokenCodes","colors","join","allLeft","some","allRight","anyLeft","anyRight","annotatedTokenClass","onContextMenu","background","tokenSpan","memo","nlp","extend","paragraphs","Tokens","setTokens","tokenComponents","setTokenComponents","prepareTokens","tokenize","par","par_i","createParagraph","mapSentences","sentences","sent","sent2","createSentence","terms","createRef","mapTokens","arrowkeys","annotationFromSelection","movePosition","mover","ctrl","newPosition","moveSentence","ntokens","scrollIntoView","next","direction","getBoundingClientRect","startposition","y","x","getTokenAttributes","tokenNode","parseInt","getAttribute","getToken","parentNode","AnnotationText","currentToken","eventsBlocked","holdMouseLeft","setHoldMouseLeft","setMover","holdCtrl","setHoldCtrl","holdArrow","setHoldArrow","onMouseDown","onMouseMove","onMouseUp","onKeyUp","useCallback","onKeyDown","repeat","counter","keyCode","delay","Math","max","ceil","setTimeout","which","storeMouseSelection","currentNode","getSelection","empty","button","stopPropagation","originalTarget","getDocuments","setDoc","setDocumentList","prepareAnnotations","getDocument","dropdownOptions","Breadcrumb","BreadcrumbSection","link","Divider","documentSelector","App","exact","toggleSelection","annList","rm","testCodes","rootReducer","combineReducers","action","tokenIndices","newstate","v","unshift","store","createStore","ReactDOM","StrictMode","querySelector"],"mappings":"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","file":"static/js/main.1606cd76.chunk.js","sourcesContent":["var map = {\n\t\"./bg-BG.json\": 287,\n\t\"./ca-ES.json\": 288,\n\t\"./cs-CZ.json\": 289,\n\t\"./de-DE.json\": 290,\n\t\"./en-US.json\": 197,\n\t\"./es-ES.json\": 291,\n\t\"./et-EE.json\": 292,\n\t\"./fi-FI.json\": 293,\n\t\"./fr-FR.json\": 294,\n\t\"./he-IL.json\": 295,\n\t\"./it-IT.json\": 296,\n\t\"./ja-JP.json\": 297,\n\t\"./ko-KR.json\": 298,\n\t\"./nb-NO.json\": 299,\n\t\"./nn-NO.json\": 300,\n\t\"./pl-PL.json\": 301,\n\t\"./pt-BR.json\": 302,\n\t\"./ru-RU.json\": 303,\n\t\"./sv-SE.json\": 304,\n\t\"./tr-TR.json\": 305,\n\t\"./zh-CN.json\": 306\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 286;","import Dexie from \"dexie\";\nimport hash from \"object-hash\";\n\nexport default class AnnotationDB {\n  constructor() {\n    this.idb = new Dexie(\"AmCAT_Annotator\");\n    this.idb.version(1).stores({\n      apis: \"api\", // unindexed fields: token, refresh_token, expiration_date,\n      codingjobs: \"job_id, name\", // unindexed fields: jobcreator, codingscheme, codebook, codebookEdit, returnAddress\n      documents: \"doc_id, job_id\", // unindexed fields: title, text, meta, tokens, annotations\n    });\n  }\n\n  // API TOKENS\n  addToken(api, token) {\n    return this.idb.apis.put({\n      api,\n      token: token.token,\n      refresh_token: token.refresh_token,\n      expiration_date: token.expiration_date,\n    });\n  }\n  deleteToken(api) {\n    return this.idb.apis.delete(api);\n  }\n  getToken(api) {\n    return this.idb.apis.get(api);\n  }\n\n  // CODINGJOBS\n  async createCodingjob(name) {\n    const job_id = hash([name, Date.now().toString()]);\n    this.idb.codingjobs.add({\n      job_id,\n      name,\n    });\n    return { job_id, name };\n  }\n  async deleteCodingjob(codingjob) {\n    const documents = await this.listDocuments(codingjob);\n    await this.deleteDocuments(documents);\n    return this.idb.codingjobs.delete(codingjob.job_id);\n  }\n  listCodingjobs() {\n    return this.idb.codingjobs.toArray();\n  }\n  getCodingjob(codingjob) {\n    return this.idb.codingjobs.get(codingjob.job_id);\n  }\n\n  // DOCUMENTS\n  async createDocuments(codingjob, documentList, silent = false) {\n    let ids = new Set(\n      await this.idb.documents\n        .where(\"job_id\")\n        .equals(codingjob.job_id)\n        .primaryKeys()\n    );\n\n    let duplicates = 0;\n    const preparedDocuments = documentList.reduce((result, document) => {\n      const doc_id = hash([document, codingjob]); // codingjob included for doc_id hash\n      if (!ids.has(doc_id)) {\n        ids.add(doc_id);\n        if (document.annotations && document.annotations.length > 0) {\n          try {\n            JSON.parse(document.annotations);\n          } catch (e) {\n            alert(\"Annotations field contains invalid JSON\");\n            throw new Error(\"JSON parse error\");\n          }\n        }\n        result.push({\n          doc_id: doc_id,\n          job_id: codingjob.job_id,\n          ...document,\n        });\n      } else {\n        duplicates++;\n      }\n      return result;\n    }, []);\n\n    if (!silent) {\n      let message = `Created ${\n        documentList.length - duplicates\n      } new documents in codingjob ${codingjob.name}.`;\n      if (duplicates > 0)\n        message = message + ` Ignored ${duplicates} duplicates`;\n      alert(message);\n    }\n\n    return this.idb.documents.bulkAdd(preparedDocuments);\n  }\n  deleteDocuments(documents) {\n    const documentIds = documents.map((document) => document.doc_id);\n    return this.idb.documents.bulkDelete(documentIds);\n  }\n  listDocuments(codingjob) {\n    return this.idb.documents\n      .where(\"job_id\")\n      .equals(codingjob.job_id)\n      .toArray();\n  }\n  getDocument(doc_id) {\n    return this.idb.documents.get(doc_id);\n  }\n\n  writeValue(document, field, value) {\n    return this.idb.documents\n      .where(\"doc_id\")\n      .equals(document.doc_id)\n      .modify({ [field]: value });\n  }\n\n  // CLEANUP\n  deleteDB() {\n    return this.idb.delete();\n  }\n}\n","import React, { useState } from \"react\";\n\nimport { Modal, Menu, Header, Button } from \"semantic-ui-react\";\nimport { exportDB } from \"dexie-export-import\";\nimport fileDownload from \"js-file-download\";\nimport AnnotationDB from \"../apis/dexie\";\n\nconst Download = () => {\n  const [open, setOpen] = useState(false);\n\n  const onDownload = async () => {\n    try {\n      const db = new AnnotationDB();\n      const blob = await exportDB(db.idb, {\n        filter: (table, value, key) =>\n          table === \"codingjobs\" || table === \"documents\",\n        prettyJson: true,\n        progressCallback,\n      });\n      fileDownload(blob, \"AmCAT_Annotator.json\");\n    } catch (error) {\n      console.error(\"\" + error);\n    }\n  };\n\n  return (\n    <Modal\n      closeIcon\n      open={open}\n      trigger={\n        <Menu.Item\n          icon=\"download\"\n          name=\"Download\"\n          style={{ color: \"lightgreen\" }}\n        />\n      }\n      onClose={() => setOpen(false)}\n      onOpen={() => setOpen(true)}\n    >\n      <Header icon=\"download\" content=\"Download everything\" />\n      <Modal.Content>\n        <p>Download all data as a single JSON dump</p>\n      </Modal.Content>\n      <Modal.Actions>\n        <Button primary onClick={onDownload}>\n          Download\n        </Button>\n      </Modal.Actions>\n    </Modal>\n  );\n};\n\nfunction progressCallback({ totalRows, completedRows }) {\n  console.log(`Progress: ${completedRows} of ${totalRows} rows completed`);\n}\n\nexport default Download;\n","export const setDB = (db) => {\n  return {\n    type: \"SET_DB\",\n    payload: db,\n  };\n};\n\nexport const resetDB = () => {\n  return {\n    type: \"RESET_DB\",\n  };\n};\n\nexport const blockEvents = (block) => {\n  return {\n    type: \"BLOCK_EVENTS\",\n    payload: block,\n  };\n};\n\nexport const selectCodingjob = (codingjob) => {\n  return {\n    type: \"SELECT_CODINGJOB\",\n    payload: codingjob,\n  };\n};\n\nexport const setCodingjobs = (codingjobs) => {\n  return {\n    type: \"SET_CODINGJOBS\",\n    payload: codingjobs,\n  };\n};\n\nexport const selectDocument = (document) => {\n  return {\n    type: \"SELECT_ARTICLE\",\n    payload: document,\n  };\n};\n\nexport const setDocuments = (document) => {\n  return {\n    type: \"SET_DOCUMENTS\",\n    payload: document,\n  };\n};\n\nexport const setTokenIndices = (tokenIndices) => {\n  return {\n    type: \"SET_TOKEN_INDICES\",\n    payload: tokenIndices,\n  };\n};\n\nexport const setCurrentToken = (index) => {\n  return {\n    type: \"SET_CURRENT_TOKEN\",\n    payload: index,\n  };\n};\n\nexport const setTokenSelection = (index, add) => {\n  return {\n    type: \"SET_TOKEN_SELECTION\",\n    index,\n    add,\n  };\n};\n\nexport const clearTokenSelection = () => {\n  return {\n    type: \"CLEAR_TOKEN_SELECTION\",\n  };\n};\n\nexport const triggerCodeselector = (tokenindex) => {\n  return {\n    type: \"TRIGGER_CODESELECTOR\",\n    payload: tokenindex,\n  };\n};\n\nexport const toggleAnnotations = (spanAnnotation) => {\n  return {\n    type: \"TOGGLE_ANNOTATIONS\",\n    payload: spanAnnotation,\n  };\n};\n\nexport const rmAnnotations = (spanAnnotation) => {\n  return {\n    type: \"RM_ANNOTATIONS\",\n    payload: spanAnnotation,\n  };\n};\n\nexport const clearSpanAnnotations = () => {\n  return {\n    type: \"CLEAR_SPAN_ANNOTATIONS\",\n  };\n};\n\nexport const setCodes = (codes) => {\n  return {\n    type: \"SET_CODES\",\n    payload: codes,\n  };\n};\n\nexport const appendCodeHistory = (code, n = 5) => {\n  return {\n    type: \"APPEND_CODE_HISTORY\",\n    payload: { code: code, n: n },\n  };\n};\n","import React, { useState } from \"react\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport { resetDB } from \"../actions\";\nimport { Menu, Button, Header, Icon, Modal } from \"semantic-ui-react\";\nimport { useHistory } from \"react-router-dom\";\n\nconst Reset = ({ homepage }) => {\n  const db = useSelector((state) => state.db);\n  const dispatch = useDispatch();\n  const [open, setOpen] = useState(false);\n  const history = useHistory();\n\n  if (!db) return null;\n\n  const onClick = async () => {\n    try {\n      await db.deleteDB();\n      dispatch(resetDB());\n      setOpen(false);\n      history.push(homepage);\n    } catch (e) {\n      console.log(e);\n    }\n  };\n\n  return (\n    <Modal\n      closeIcon\n      open={open}\n      trigger={\n        <Menu.Item icon=\"rocket\" name=\"Reset\" style={{ color: \"#d7a3a3\" }} />\n      }\n      onClose={() => setOpen(false)}\n      onOpen={() => setOpen(true)}\n    >\n      <Header icon=\"power off\" content=\"Reset Annotator Database\" />\n      <Modal.Content>\n        <p>\n          This will remove all document and annotation data from your browser.\n          Any annotations that have not been saved/synchronized will be lost.\n          Are you absolutely sure?\n        </p>\n      </Modal.Content>\n      <Modal.Actions>\n        <Button\n          color=\"red\"\n          onClick={() => {\n            setOpen(false);\n          }}\n        >\n          <Icon name=\"remove\" /> No\n        </Button>\n        <Button color=\"green\" onClick={onClick}>\n          <Icon name=\"checkmark\" /> Yes\n        </Button>\n      </Modal.Actions>\n    </Modal>\n  );\n};\n\nexport default Reset;\n","// this contains functions for setting indexedDB to persistent\n// taken from: https://dexie.org/docs/StorageManager\n\n/** Check if storage is persisted already.\n  @returns {Promise<boolean>} Promise resolved with true if current origin is\n  using persistent storage, false if not, and undefined if the API is not\n  present.\n*/\n\nexport async function initStoragePersistence() {\n  const persist = await tryPersistWithoutPromtingUser();\n  switch (persist) {\n    case \"never\":\n      console.log(\"Not possible to persist storage\");\n      break;\n    case \"persisted\":\n      console.log(\"Successfully persisted storage silently\");\n      break;\n    case \"prompt\":\n      console.log(\"Not persisted, but we may prompt user when we want to.\");\n      break;\n    default:\n      console.log(\"compiler desperately wanted a default\");\n  }\n}\n\n/** Tries to convert to persisted storage.\n  @returns {Promise<boolean>} Promise resolved with true if successfully\n  persisted the storage, false if not, and undefined if the API is not present.\n*/\nexport async function persist() {\n  return (await navigator.storage) && navigator.storage.persist\n    ? navigator.storage.persist()\n    : undefined;\n}\n\nexport async function isStoragePersisted() {\n  return (await navigator.storage) && navigator.storage.persisted\n    ? navigator.storage.persisted()\n    : undefined;\n}\n\n/** Queries available disk quota.\n  @see https://developer.mozilla.org/en-US/docs/Web/API/StorageEstimate\n  @returns {Promise<{quota: number, usage: number}>} Promise resolved with\n  {quota: number, usage: number} or undefined.\n*/\n// async function showEstimatedQuota() {\n//   return (await navigator.storage) && navigator.storage.estimate\n//     ? navigator.storage.estimate()\n//     : undefined;\n// }\n\n/** Tries to persist storage without ever prompting user.\n  @returns {Promise<string>}\n    \"never\" In case persisting is not ever possible. Caller don't bother\n      asking user for permission.\n    \"prompt\" In case persisting would be possible if prompting user first.\n    \"persisted\" In case this call successfully silently persisted the storage,\n      or if it was already persisted.\n*/\nasync function tryPersistWithoutPromtingUser() {\n  if (!navigator.storage || !navigator.storage.persisted) {\n    return \"never\";\n  }\n  let persisted = await navigator.storage.persisted();\n  if (persisted) {\n    return \"persisted\";\n  }\n  if (!navigator.permissions || !navigator.permissions.query) {\n    return \"prompt\"; // It MAY be successful to prompt. Don't know.\n  }\n  const permission = await navigator.permissions.query({\n    name: \"persistent-storage\",\n  });\n  if (permission.state === \"granted\") {\n    persisted = await navigator.storage.persist();\n    if (persisted) {\n      return \"persisted\";\n    } else {\n      throw new Error(\"Failed to persist\");\n    }\n  }\n  if (permission.state === \"prompt\") {\n    return \"prompt\";\n  }\n  return \"never\";\n}\n","import React, { useEffect, useState } from \"react\";\nimport { Menu, Button, Header, Icon, Modal } from \"semantic-ui-react\";\nimport { persist, isStoragePersisted } from \"../apis/storemanager\";\n\nconst Persist = () => {\n  const [open, setOpen] = useState(false);\n  const [persisted, setPersisted] = useState(false);\n\n  useEffect(() => {\n    if (!persisted) {\n      isStoragePersisted().then(setPersisted);\n    }\n  }, [persisted]);\n\n  const onClick = async () => {\n    await persist();\n    const ispersisted = await isStoragePersisted();\n    if (ispersisted) {\n      setPersisted(true);\n      alert(\"indexedDB set to persistent for AmCAT Annotator\");\n    } else {\n      alert(\"Failed to set indexedDB to persistent\");\n    }\n  };\n\n  if (persisted) return null;\n\n  return (\n    <Modal\n      closeIcon\n      open={open}\n      trigger={\n        <Menu.Item\n          icon=\"database\"\n          name=\"Enable persitance\"\n          style={{ color: \"#d7a3a3\" }}\n        />\n      }\n      onClose={() => setOpen(false)}\n      onOpen={() => setOpen(true)}\n    >\n      <Header icon=\"database\" content=\"Set database persistence\" />\n      <Modal.Content>\n        <p>\n          We did not have permission to automatically make the data storage for\n          this website persistent. This means that the data could be removed\n          automatically by your browser if it needs to free up space for another\n          website. You can try to set this manually here, but not all browsers\n          support this (yet).\n        </p>\n        <p>\n          If the database is not persistent the app can still be used, but you\n          need to be more carefull in making sure that data is regularly backed\n          up, either by manually downloading data or syncing with some backend\n          (work in progress).\n        </p>\n      </Modal.Content>\n      <Modal.Actions>\n        <Button onClick={onClick}>\n          <Icon name=\"checkmark\" /> Yes\n        </Button>\n      </Modal.Actions>\n    </Modal>\n  );\n};\n\nexport default Persist;\n","import React from \"react\";\nimport { useSelector } from \"react-redux\";\nimport { Menu } from \"semantic-ui-react\";\nimport { Link, withRouter, useLocation } from \"react-router-dom\";\n\nimport Download from \"./Download\";\nimport Reset from \"./Reset\";\nimport Persist from \"./Persist\";\n\nconst HeaderMenu = ({ items, host, homepage }) => {\n  const db = useSelector((state) => state.db);\n  const location = useLocation();\n\n  const menuItems = items.map((item, index) => {\n    return (\n      <Menu.Item\n        key={\"item-\" + index}\n        index={index}\n        as={Link}\n        to={item.path}\n        header={index === 0}\n        disabled={!db}\n        active={item.path === location.pathname}\n      >\n        {item.label}\n      </Menu.Item>\n    );\n  });\n\n  return (\n    <Menu fixed=\"top\" inverted>\n      {menuItems}\n      <Menu.Menu position=\"right\">\n        <Download />\n        <Persist />\n        <Reset homepage={homepage} />\n      </Menu.Menu>\n    </Menu>\n  );\n};\n\nexport default withRouter(HeaderMenu);\n","const demo_articles = [\n  {\n    title: `GL en PvdA hebben goed gesprek met informateur, maar wantrouwen Rutte`,\n    text: `PvdA-leider Lilianne Ploumen en GroenLinks-leider Jesse Klaver hadden vrijdag een goed gesprek met informateur Herman Tjeenk Willink, zeiden ze zelf. De twee benadrukten dat, hoewel er inhoudelijke stappen zijn gezet, hun vertrouwen in VVD-leider Mark Rutte nog niet is hersteld.\n\n    Informateur Willink zette zich vrijdag aan zijn taak. Eerste punt op de agenda zijn gesprekken met de lijsttrekkers van de acht grootste partijen.\n    \n    Een week nadat een groot deel van de partijleiders bekendmaakte niet meer met Rutte verder te willen onderhandelen over een nieuwe coalitie, wordt gekeken waarover partijen het inhoudelijk eens zijn.\n    \n    \"Het was een prettig gesprek langs de lijnen van de inhoud\", zei PvdA-leider Lilianne Ploumen na afloop. Ze heeft haar zorgen over de ongelijkheid in Nederland en over de zorg gedeeld.\n    \n    Ook Jesse Klaver (GroenLinks), die een uur eerder op gesprek kwam bij de informateur, benadrukte dat het ging over de problemen die opgelost moeten worden.\n    \n    Situatie niet veranderd in een week\n\nWat betreft de positie ten opzichte van Rutte is echter niets veranderd. Vorige week ondertekenden Ploumen en Klaver net als alle andere oppositiepartijen een motie van wantrouwen, vanwege Ruttes betrokkenheid bij de notitie over CDA-Kamerlid Pieter Omtzigt.\n\n\"Als het aan ons ligt, was Rutte geen premier meer\", zei Ploumen. Hoe Tjeenk Willink dat gedeukte vertrouwen kan herstellen, weet ze niet. \"We wachten de voorstellen van de informateur af.\"\n\n\"De vertrouwensbreuk is niet hersteld na één gesprek met de fractievoorzitters\", zei ook Klaver. \"Mijn mening over Rutte is niet veranderd.\"\n\nSP'er Lilian Marijnissen sprak zich al eerder expliciet uit tegen samenwerking met Rutte.\n\nDe partijleiders hekelen het gebrek aan openheid en transparantie waar Rutte in hun ogen voor staat. \"Als je een fout maakt, dan moet je dat toegeven en er niet over liegen\", zei Klaver. Ploumen: \"Het probleem is dat Mark Rutte heeft gelogen. Wij hebben het vertrouwen in hem opgezegd.\"\n\nWat de vervolgstappen moeten zijn, laten ze volledig over aan Tjeenk Willink. \"Ik ga geen lijstjes maken met wat er moet gebeuren\", zei Ploumen.\n\nDe informateur ontvangt later op vrijdag nog de partijleiders Wopke Hoekstra (CDA) en Sigrid Kaag (D66), en Rutte zelf.\n\nTjeenk Willink denkt niet dat Rutte zomaar door kan\n\nTjeenk Willink suggereerde woensdag op een persconferentie dat hij Rutte niet per se een sta-in-de-weg voor een verandering van de bestuursstijl in Den Haag vindt. Toen daarover vervolgens berichten in de media verschenen, voelde de informateur zich vrijdag genoodzaakt die boodschap bij te sturen.\n\nDe conclusie dat Rutte geen belemmering vormt voor de formatie, kan hij niet voor zijn rekening nemen, luidt een schriftelijke verklaring.\n\nTjeenk Willink heeft namelijk ook de opdracht om te onderzoeken \"of en zo ja onder welke voorwaarden er voldoende vertrouwen tussen partijen bestaat of weer kan ontstaan\".`,\n  },\n  {\n    title: `CU-leider Segers vindt dat uitspraak over Rutte te veel op de man was gespeeld`,\n    text: `Partijleider Gert-Jan Segers van de ChristenUnie (CU) vindt dat hij te veel op de man heeft gespeeld door coalitiedeelname uit te sluiten als VVD-leider Mark Rutte opnieuw premier zou worden. Terugblikkend zegt hij dat het niet om één persoon moet gaan, maar om \"een ongezonde politieke cultuur en een genadeloze overheid\". Daar moet volgens hem verandering in komen, zo zei hij zaterdag tijdens een congres van de partij.\n\n    \n    Segers deed zijn uitspraak over Rutte na het debat over de notitie \"functie elders\" voor CDA-Kamerlid Pieter Omtzigt. Binnen de CU is verdeeldheid ontstaan over het besluit van de fractie, erkent Segers.\n    \n    Naast steun is er ook kritiek van veel leden, die zeggen dat hij \"te veel op de man heeft gespeeld en te weinig de bal\". \"Te veel Rutte, te weinig ons allemaal. En als dat de perceptie van veel mensen is, dan moet ik me dat aantrekken\", aldus Segers tijdens het congres.\n    \n    \n    Volgens de CU-leider staat \"de politieke cultuur in Den Haag natuurlijk niet los van Mark Rutte, zeker niet\".\n    \n    \"Maar die oude cultuur staat of valt niet met één man. Ook wijzelf maken er deel van uit. Ik wil niet genadeloos zijn voor personen, maar ik wil wel hard en helder zijn over een cultuur die niet deugt en een genadeloze overheid. Daar moet écht een omslag in komen\", zei Segers.\n    \n    \n    De ChristenUnie heeft vijf zetels in de Tweede Kamer. Op het congres werden vier oude Kamerleden uitgezwaaid en trad Ankie van Tatenhove aan als nieuwe partijvoorzitter.`,\n  },\n];\n\nexport default demo_articles;\n","import React from \"react\";\nimport { useDispatch } from \"react-redux\";\nimport { setDB } from \"../actions\";\nimport Dexie from \"dexie\";\n\nimport AnnotationDB from \"../apis/dexie\";\nimport { useHistory } from \"react-router-dom\";\nimport { Grid, Button, Header, Segment } from \"semantic-ui-react\";\nimport { initStoragePersistence } from \"../apis/storemanager\";\nimport demo_articles from \"../apis/demodata\";\n\nconst Welcome = ({ items }) => {\n  const dispatch = useDispatch();\n  const history = useHistory();\n\n  const loggin = async (addDemo = true) => {\n    try {\n      const db = new AnnotationDB();\n      if (addDemo) await create_demo_job(db);\n      dispatch(setDB(db));\n      await initStoragePersistence();\n      history.push(items[0].path);\n    } catch (e) {}\n  };\n\n  Dexie.exists(\"AmCAT_Annotator\").then((exists) => {\n    if (exists) loggin(false);\n  });\n\n  return (\n    <Grid\n      inverted\n      textAlign=\"center\"\n      style={{ height: \"100vh\" }}\n      verticalAlign=\"middle\"\n    >\n      <Grid.Column style={{ maxWidth: 450 }}>\n        <Segment style={{ border: 0 }}>\n          <Header as=\"h2\" textAlign=\"center\">\n            Welcome to the AmCAT annotator\n          </Header>\n          <p>\n            This is the (early development version of the) AmCAT annotator. The\n            fact that you see this message means that you're either here for the\n            first time, or your local annotation database was reset (by you or\n            your browser).\n          </p>\n          <p>\n            The annotator stores your codingjobs and annotations on your local\n            computer in your browser's IndexedDB. Your data will only actually\n            touch the internet when you synchronize your data.\n          </p>\n          <Button primary onClick={loggin}>\n            Yes, off course I trust you\n          </Button>\n        </Segment>\n      </Grid.Column>\n    </Grid>\n  );\n};\n\nconst create_demo_job = async (db) => {\n  try {\n    const job = await db.createCodingjob(\"Demo codingjob\");\n    return await db.createDocuments(job, demo_articles, true);\n  } catch (e) {\n    console.log(e);\n  }\n};\n\nexport default Welcome;\n","import React, { useState } from \"react\";\nimport { Route, Redirect } from \"react-router\";\nimport { useDispatch } from \"react-redux\";\nimport { setDB } from \"../actions\";\nimport Dexie from \"dexie\";\n\nimport AnnotationDB from \"../apis/dexie\";\n\nconst AuthRoute = ({ Component, homepage, ...componentProps }) => {\n  const [loading, setLoading] = useState(true);\n  const [hasdb, setHasdb] = useState(false);\n  const dispatch = useDispatch();\n  // the trick for passing on componentProps is basically\n  // redundant now that we use Redux, but leaving it intact just in case\n\n  const connect = async () => {\n    const exists = await Dexie.exists(\"AmCAT_Annotator\");\n    if (exists) {\n      const db = await new AnnotationDB();\n      dispatch(setDB(db));\n      setHasdb(true);\n    } else {\n      setHasdb(false);\n    }\n    setLoading(false);\n  };\n\n  connect();\n\n  return (\n    <Route\n      {...componentProps}\n      render={(props) =>\n        loading ? (\n          <div>loading...</div>\n        ) : hasdb ? (\n          <Component {...componentProps} {...props} />\n        ) : (\n          <Redirect to={homepage} />\n        )\n      }\n    />\n  );\n};\n\nexport default AuthRoute;\n","import React, { useEffect, useState } from \"react\";\nimport {\n  useTable,\n  useSortBy,\n  usePagination,\n  useGlobalFilter,\n} from \"react-table\";\nimport {\n  Table,\n  TableHeader,\n  TableBody,\n  TableRow,\n  TableHeaderCell,\n  TableCell,\n  Pagination,\n  Dropdown,\n  Icon,\n} from \"semantic-ui-react\";\n\n// Uses react-table with semantic ui. The columns and data arguments are lists of objects\n// The 'columns' argument specifies column names (Header) and the names of the keys to get from data.\n//\n// const columns = [\n//   { Header: \"ID\", accessor: \"id\", headerClass: \"one wide\" },\n//   { Header: \"Name\", accessor: \"text\", headerClass: \"one wide\" },\n// ]\n//\n// Note that headerClass is custom, and enables setting the header cell class,\n// which is used in semantic ui to specify the width (one wide, ten wide, etc).\n\nconst SelectionTable = ({\n  columns,\n  data,\n  selectedRow,\n  setSelectedRow,\n  width = null,\n  defaultSize = 15,\n  sizeSelector = false,\n}) => {\n  const [activeRow, setActiveRow] = useState(\n    selectedRow ? selectedRow.ROW_ID : null\n  );\n  const {\n    getTableProps,\n    getTableBodyProps,\n    headerGroups,\n    prepareRow,\n    page,\n    pageCount,\n    gotoPage,\n    setPageSize,\n    preGlobalFilteredRows,\n    setGlobalFilter,\n    state: { pageIndex, globalFilter },\n  } = useTable(\n    {\n      columns,\n      data,\n      initialState: { pageSize: defaultSize, globalFilter: \"\" },\n    },\n\n    useGlobalFilter,\n    useSortBy,\n    usePagination\n  );\n\n  useEffect(() => {\n    if (selectedRow) {\n      setActiveRow(selectedRow.ROW_ID);\n    } else {\n      setActiveRow(null);\n    }\n  }, [selectedRow]);\n\n  const onRowSelect = (row) => {\n    if (activeRow && activeRow === row.id) {\n      setSelectedRow(null);\n      setActiveRow(null);\n    } else {\n      setSelectedRow({ ...data[row.id], ROW_ID: row.id });\n      setActiveRow(row.id);\n    }\n  };\n\n  const createHeader = (headerGroup) => {\n    return headerGroup.headers.map((column) => {\n      return (\n        <TableHeaderCell\n          className={column.headerClass}\n          {...column.getHeaderProps(column.getSortByToggleProps())}\n        >\n          {column.render(\"Header\")}\n          <span>\n            {column.isSorted ? (column.isSortedDesc ? \" 🔽\" : \" 🔼\") : \"\"}\n          </span>\n        </TableHeaderCell>\n      );\n    });\n  };\n\n  const createBody = (page) => {\n    return page.map((row, i) => {\n      prepareRow(row);\n      return (\n        <TableRow\n          active={activeRow ? activeRow === row.id : false}\n          onClick={() => onRowSelect(row)}\n          {...row.getRowProps()}\n        >\n          {row.cells.map((cell) => {\n            return (\n              <TableCell title={cell.value} {...cell.getCellProps()}>\n                {cell.render(\"Cell\")}\n              </TableCell>\n            );\n          })}\n        </TableRow>\n      );\n    });\n  };\n\n  if (data.length === 0) return null;\n\n  return (\n    <div style={{ width: width }}>\n      <GlobalFilter\n        preGlobalFilteredRows={preGlobalFilteredRows}\n        globalFilter={globalFilter}\n        setGlobalFilter={setGlobalFilter}\n      />\n      <Table\n        unstackable\n        striped\n        fixed\n        singleLine\n        selectable\n        {...getTableProps()}\n      >\n        <TableHeader>\n          {headerGroups.map((headerGroup) => (\n            <TableRow {...headerGroup.getHeaderGroupProps()}>\n              {createHeader(headerGroup)}\n            </TableRow>\n          ))}\n        </TableHeader>\n        <TableBody {...getTableBodyProps()}>{createBody(page)}</TableBody>\n      </Table>\n      {sizeSelector ? (\n        <Dropdown\n          text=\"show per page\"\n          options={[10, 25, 50, 100, 500].map((n) => ({ value: n, text: n }))}\n          onChange={(e, d) => {\n            setPageSize(d.value);\n          }}\n        />\n      ) : null}\n      <div\n        style={{\n          marginTop: \"3em\",\n          display: \"flex\",\n          justifyContent: \"flex-end\",\n        }}\n      >\n        {data.length > defaultSize ? (\n          <Pagination\n            style={{ border: \"0\" }}\n            size=\"mini\"\n            firstItem={false}\n            lastItem={false}\n            nextItem={false}\n            prevItem={false}\n            boundaryRange={1}\n            ellipsisItem={{\n              content: <Icon name=\"ellipsis horizontal\" />,\n              icon: true,\n            }}\n            activePage={pageIndex + 1}\n            totalPages={pageCount}\n            onPageChange={(event, data) => {\n              gotoPage(data.activePage - 1);\n            }}\n          />\n        ) : null}\n      </div>\n    </div>\n  );\n};\n\nconst GlobalFilter = ({\n  preGlobalFilteredRows,\n  globalFilter,\n  setGlobalFilter,\n}) => {\n  const count = preGlobalFilteredRows && preGlobalFilteredRows.length;\n\n  return (\n    <span>\n      <input\n        value={globalFilter || \"\"}\n        onChange={(e) => {\n          setGlobalFilter(e.target.value || undefined); // Set undefined to remove the filter entirely\n        }}\n        placeholder={`Search ${count} records...`}\n        style={{\n          border: \"0\",\n        }}\n      />\n    </span>\n  );\n};\n\nexport default SelectionTable;\n","import React, { useState } from \"react\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport { selectCodingjob, setCodingjobs } from \"../actions\";\nimport {\n  Header,\n  Button,\n  Modal,\n  Form,\n  Loader,\n  Dimmer,\n  Icon,\n} from \"semantic-ui-react\";\nimport AnnotationDB from \"../apis/dexie\";\n\nconst CreateCodingjob = () => {\n  const codingjobs = useSelector((state) => state.codingjobs);\n  const dispatch = useDispatch();\n\n  const [status, setStatus] = useState(\"inactive\");\n  const [codingjobName, setCodingjobName] = useState(\"\");\n\n  const onSubmit = async (event) => {\n    event.preventDefault();\n\n    setCodingjobName(codingjobName.trim());\n    setStatus(\"pending\");\n\n    try {\n      const db = new AnnotationDB();\n      await db.createCodingjob(codingjobName);\n      const codingjobs = await db.listCodingjobs();\n      dispatch(selectCodingjob(null));\n      dispatch(setCodingjobs(codingjobs));\n      setStatus(\"inactive\");\n    } catch (e) {\n      console.log(e);\n      setStatus(\"error\");\n    }\n  };\n\n  if (!codingjobs) return null;\n\n  return (\n    <Modal\n      as={Form}\n      trigger={\n        <Button>\n          <Icon name=\"plus\" />\n          Create job\n        </Button>\n      }\n      onSubmit={(e) => onSubmit(e)}\n      open={status !== \"inactive\"}\n      onClose={() => setStatus(\"inactive\")}\n      onOpen={() => {\n        setCodingjobName(\"\");\n        setStatus(\"awaiting input\");\n      }}\n      size=\"tiny\"\n    >\n      <Header icon=\"pencil\" content=\"Create new Codingjob\" as=\"h2\" />\n      <Modal.Content>\n        <Form.Group>\n          <Form.Input\n            width={12}\n            label=\"Name\"\n            required\n            type=\"text\"\n            value={codingjobName}\n            onChange={(e, d) => {\n              setStatus(\"awaiting input\");\n              setCodingjobName(d.value);\n            }}\n            placeholder=\"Enter name\"\n          />\n        </Form.Group>\n      </Modal.Content>\n      <Modal.Actions>\n        {status === \"error\" ? (\n          <div>\n            Could not create codingjob for a reason not yet covered in the error\n            handling...\n          </div>\n        ) : null}\n        {status === \"pending\" ? (\n          <Dimmer active inverted>\n            <Loader content=\"Creating codingjob\" />\n          </Dimmer>\n        ) : (\n          <Button type=\"submit\" color=\"green\" icon=\"save\" content=\"Create\" />\n        )}\n      </Modal.Actions>\n    </Modal>\n  );\n};\n\nexport default CreateCodingjob;\n","import React, { useState } from \"react\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport { selectCodingjob, setCodingjobs } from \"../actions\";\nimport { Button, Header, Icon, Modal, Dimmer, Loader } from \"semantic-ui-react\";\nimport AnnotationDB from \"../apis/dexie\";\n\nconst DeleteCodingjob = () => {\n  const codingjob = useSelector((state) => state.codingjob);\n  const dispatch = useDispatch();\n\n  const [status, setStatus] = useState(\"inactive\");\n\n  const onSubmit = async (event) => {\n    setStatus(\"pending\");\n    try {\n      const db = new AnnotationDB();\n      await db.deleteCodingjob(codingjob);\n      const codingjobs = db.listCodingjobs();\n\n      dispatch(selectCodingjob(null));\n      dispatch(setCodingjobs(codingjobs));\n\n      setStatus(\"inactive\");\n    } catch (e) {\n      console.log(e);\n      setStatus(\"error\");\n    }\n  };\n\n  if (!codingjob) return null;\n\n  return (\n    <Modal\n      closeIcon\n      open={status !== \"inactive\"}\n      trigger={\n        <Button name=\"logout\">\n          <Icon name=\"minus\" /> Delete job\n        </Button>\n      }\n      onClose={() => {\n        setStatus(\"inactive\");\n      }}\n      onOpen={() => {\n        setStatus(\"awaiting input\");\n      }}\n    >\n      <Header icon=\"trash\" content={`Delete codingjob ${codingjob.name}`} />\n      <Modal.Content>\n        <p>Do you really want to delete this codingjob?</p>\n      </Modal.Content>\n      <Modal.Actions>\n        {status === \"error\" ? (\n          <div>\n            Could not delete codingjob for a reason not yet covered in the error\n            handling...\n          </div>\n        ) : null}\n        {status === \"pending\" ? (\n          <Dimmer active inverted>\n            <Loader content=\"Creating codingjob\" />\n          </Dimmer>\n        ) : (\n          <>\n            <Button color=\"red\" onClick={onSubmit}>\n              <Icon name=\"remove\" /> No\n            </Button>\n            <Button color=\"green\" onClick={onSubmit}>\n              <Icon name=\"checkmark\" /> Yes\n            </Button>\n          </>\n        )}\n      </Modal.Actions>\n    </Modal>\n  );\n};\n\nexport default DeleteCodingjob;\n","import React, { useState, useEffect } from \"react\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport { Button, Segment, Dropdown, Container } from \"semantic-ui-react\";\nimport { selectCodingjob, setCodingjobs, setDocuments } from \"../actions\";\nimport Dexie from \"dexie\";\n\nimport SelectionTable from \"./SelectionTable\";\nimport CreateCodingjob from \"./CreateCodingjob\";\nimport DeleteCodingjob from \"./DeleteCodingjob\";\nimport AnnotationDB from \"../apis/dexie\";\n\nconst CodingjobSelector = ({ type = \"table\" }) => {\n  const codingjobs = useSelector((state) => state.codingjobs);\n  const codingjob = useSelector((state) => state.codingjob);\n  const dispatch = useDispatch();\n\n  const [selectedCodingjob, setSelectedCodingjob] = useState(codingjob);\n\n  useEffect(() => {\n    dispatch(selectCodingjob(selectedCodingjob));\n  }, [selectedCodingjob, dispatch]);\n\n  useEffect(() => {\n    if (codingjob) {\n      getJobArticles(codingjob, dispatch);\n    } else {\n      setSelectedCodingjob(null);\n      dispatch(setDocuments([]));\n    }\n  }, [codingjob, dispatch]);\n\n  useEffect(() => {\n    if (codingjobs.length === 0) {\n      getCodingjobs(dispatch, setSelectedCodingjob);\n    }\n  }, [codingjobs, dispatch]);\n\n  if (type === \"table\") {\n    const tableColumns = [\n      {\n        Header: \"Select Index\",\n        accessor: \"name\",\n        headerClass: \"thirteen wide\",\n      },\n    ];\n\n    return (\n      <Segment style={{ border: \"0\" }}>\n        <Button.Group widths=\"2\">\n          <CreateCodingjob />\n          <DeleteCodingjob />\n        </Button.Group>\n\n        <Container\n          style={{ marginTop: \"30px\", overflow: \"auto\", width: \"800px\" }}\n        >\n          <SelectionTable\n            columns={tableColumns}\n            data={codingjobs ? codingjobs : []}\n            selectedRow={selectedCodingjob}\n            setSelectedRow={setSelectedCodingjob}\n            defaultSize={15}\n          />\n        </Container>\n      </Segment>\n    );\n  }\n\n  if (type === \"dropdown\") {\n    const asDropdownItems = (indices) => {\n      return indices.map((index) => {\n        return { key: index.job_id, text: index.name, value: index.name };\n      });\n    };\n\n    const onDropdownSelect = (value) => {\n      if (value && codingjobs.length > 0) {\n        const i = codingjobs.findIndex((row) => row.name === value);\n        setSelectedCodingjob({ ...codingjobs[i], ROW_ID: i.toString() });\n      } else {\n        setSelectedCodingjob(null);\n      }\n      console.log(selectedCodingjob);\n    };\n\n    return (\n      <Dropdown\n        inline\n        search\n        options={asDropdownItems(codingjobs)}\n        value={codingjob ? codingjob.name : null}\n        onChange={(e, d) => onDropdownSelect(d.value)}\n      />\n    );\n  }\n\n  return null;\n};\n\nconst getCodingjobs = async (dispatch, setSelectedCodingjob) => {\n  // the exists check is super annoying, but if db is included in useEffect, it somehow\n  // rerenders non-stop, and if this check is not here then a new DB will be created immediately\n  // when reset is called.\n  const exists = await Dexie.exists(\"AmCAT_Annotator\");\n  if (!exists) return null;\n  try {\n    const db = new AnnotationDB();\n    const cjs = await db.listCodingjobs();\n    dispatch(setCodingjobs(cjs));\n    if (cjs.length > 0) setSelectedCodingjob({ ...cjs[0], ROW_ID: \"0\" });\n  } catch (e) {\n    console.log(e);\n  }\n};\n\nconst getJobArticles = async (codingjob, dispatch) => {\n  const exists = await Dexie.exists(\"AmCAT_Annotator\");\n  if (!exists) return null;\n  try {\n    const db = new AnnotationDB();\n    const documents = await db.listDocuments(codingjob);\n    dispatch(setDocuments(documents));\n  } catch (e) {\n    console.log(e);\n  }\n};\n\nexport default CodingjobSelector;\n","import React, { useState, useEffect } from \"react\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport SelectionTable from \"./SelectionTable\";\nimport { selectDocument } from \"../actions\";\n\nconst documentTableColumns = [\n  { Header: \"title\", accessor: \"title\", headerClass: \"six wide\" },\n  { Header: \"text\", accessor: \"text\", headerClass: \"four wide\" },\n  { Header: \"annotations\", accessor: \"annotations\", headerClass: \"four wide\" },\n  { Header: \"meta\", accessor: \"meta\", headerClass: \"four wide\" },\n];\n\nconst DocumentTable = ({ width }) => {\n  const codingjob = useSelector((state) => state.codingjob);\n  const document = useSelector((state) => state.document);\n  const documents = useSelector((state) => state.documents);\n  const dispatch = useDispatch();\n\n  const [selectedRow, setSelectedRow] = useState(document);\n\n  useEffect(() => {\n    dispatch(selectDocument(selectedRow));\n  }, [selectedRow, dispatch]);\n\n  if (!codingjob) return null;\n\n  return (\n    <SelectionTable\n      columns={documentTableColumns}\n      data={documents}\n      selectedRow={selectedRow}\n      setSelectedRow={setSelectedRow}\n      width={width}\n      defaultSize={15}\n    />\n  );\n};\n\nexport default DocumentTable;\n","import React from \"react\";\nimport { Container } from \"semantic-ui-react\";\nimport DocumentTable from \"./DocumentTable\";\n\nconst JobDetails = () => {\n  return (\n    <Container style={{ marginTop: \"30px\", overflow: \"auto\" }}>\n      <DocumentTable width=\"800px\" />\n    </Container>\n  );\n};\n\nexport default JobDetails;\n","import React, { useRef, useEffect, useState } from \"react\";\nimport {\n  Container,\n  Header,\n  Table,\n  Grid,\n  Select,\n  Form,\n  Button,\n  Icon,\n} from \"semantic-ui-react\";\nimport { useSelector, useDispatch } from \"react-redux\";\n\n//import CSVReader from \"react-csv-reader\";\n//import Papa from \"papaparse\";\nimport { CSVReader } from \"react-papaparse\";\nimport { setDocuments } from \"../actions\";\n\nconst UploadDocuments = ({ setActive }) => {\n  const codingjob = useSelector((state) => state.codingjob);\n  const [data, setData] = useState([]);\n  const fileRef = useRef();\n\n  if (!codingjob) return null;\n  return (\n    <Grid stackable style={{ marginTop: \"4.3em\" }}>\n      <Grid.Row>\n        <Grid.Column floated=\"right\" width={4}>\n          {\" \"}\n          <CSVReader\n            ref={fileRef}\n            onFileLoad={(data) => setData(data)}\n            addRemoveButton\n            onRemoveFile={() => setData([])}\n          >\n            <span>Click to upload</span>\n          </CSVReader>\n        </Grid.Column>\n        <Grid.Column floated=\"right\" width={10}>\n          <SubmitForm data={data} codingjob={codingjob} fileRef={fileRef} />\n        </Grid.Column>\n      </Grid.Row>\n      <Grid.Row>\n        <Grid.Column>\n          <PreviewTable data={data} />\n        </Grid.Column>\n      </Grid.Row>\n    </Grid>\n  );\n};\n\nconst SubmitForm = ({ data, codingjob, fileRef }) => {\n  const db = useSelector((state) => state.db);\n\n  const [options, setOptions] = useState([]);\n  const [titleField, setTitleField] = useState(null);\n  const [textField, setTextField] = useState(null);\n  const [annotationsField, setAnnotationsField] = useState(null);\n  const dispatch = useDispatch();\n\n  useEffect(() => {\n    if (data.length <= 1) {\n      setTitleField(null);\n      setTextField(null);\n      setAnnotationsField(null);\n      setOptions([]);\n      return;\n    }\n\n    setOptions(\n      data[0].data.map((colname) => {\n        return { key: colname, value: colname, text: colname };\n      })\n    );\n    setTitleField(data[0].data.includes(\"title\") ? \"title\" : null);\n    setTextField(data[0].data.includes(\"text\") ? \"text\" : null);\n    setAnnotationsField(\n      data[0].data.includes(\"annotations\") ? \"annotations\" : null\n    );\n  }, [data]);\n\n  const csvToJson = (data, titleField, textField, annotationsField) => {\n    const keys = data[0].data;\n    return data.slice(1).map((row) => {\n      const datarow = row.data.reduce(\n        (obj, value, i) => {\n          let key = keys[i];\n          if (key === titleField) {\n            obj[\"title\"] = value;\n          } else if (key === textField) {\n            obj[\"text\"] = value;\n          } else if (key === annotationsField) {\n            obj[\"annotations\"] = value;\n          } else {\n            obj[\"meta\"][key] = value;\n          }\n          return obj;\n        },\n        { meta: {}, annotations: \"\" }\n      );\n      datarow.meta = JSON.stringify(datarow.meta, null, 2);\n      return datarow;\n    });\n  };\n\n  const uploadData = async () => {\n    try {\n      const preparedData = csvToJson(\n        data,\n        titleField,\n        textField,\n        annotationsField\n      );\n      await db.createDocuments(codingjob, preparedData);\n      const documents = await db.listDocuments(codingjob);\n      await dispatch(setDocuments(documents));\n      fileRef.current.removeFile();\n    } catch (e) {\n      console.log(e);\n    }\n  };\n\n  if (data.length <= 1) return null;\n\n  return (\n    <>\n      <Form>\n        <Form.Group>\n          <Form.Field\n            control={Select}\n            placeholder=\"title column\"\n            options={options}\n            value={titleField}\n            onChange={(e, d) => setTitleField(d.value)}\n          />\n          <Form.Field\n            control={Select}\n            placeholder=\"text column\"\n            options={options}\n            value={textField}\n            onChange={(e, d) => setTextField(d.value)}\n          />\n        </Form.Group>\n        <Form.Group>\n          <Form.Field\n            control={Select}\n            clearable\n            placeholder=\"annotations (optional)\"\n            options={options}\n            value={annotationsField}\n            onChange={(e, d) => setAnnotationsField(d.value)}\n          />\n          <Form.Field\n            control={Button}\n            fluid\n            onClick={uploadData}\n            disabled={!titleField || !textField}\n          >\n            <Icon name=\"upload\" />\n            Upload\n          </Form.Field>\n        </Form.Group>\n      </Form>\n    </>\n  );\n};\n\nconst PreviewTable = ({ data }) => {\n  const n = 5;\n\n  const createHeader = (data) => {\n    return data[0].data.map((colname) => {\n      return (\n        <Table.HeaderCell>\n          <span title={colname}>{colname}</span>\n        </Table.HeaderCell>\n      );\n    });\n  };\n\n  const createRows = (data, n) => {\n    const previewdata = data.slice(0, n + 1);\n    return previewdata.slice(1).map((row) => {\n      return <Table.Row>{createRowCells(row.data)}</Table.Row>;\n    });\n  };\n\n  const createRowCells = (row) => {\n    return row.map((cell) => {\n      return (\n        <Table.Cell>\n          <span title={cell}>{cell}</span>\n        </Table.Cell>\n      );\n    });\n  };\n\n  if (data.length <= 1) return null;\n\n  return (\n    <Container style={{ marginTop: \"2em\" }}>\n      <Table fixed singleLine basic=\"very\">\n        <Table.Header>\n          <Table.Row>{createHeader(data)}</Table.Row>\n        </Table.Header>\n        <Table.Body>{createRows(data, n)}</Table.Body>\n      </Table>\n      {data.length > n ? (\n        <Header align=\"center\">{data.length - 1 - n} more rows</Header>\n      ) : null}\n    </Container>\n  );\n};\n\nexport default UploadDocuments;\n","import React, { useState } from \"react\";\nimport { Form, Button } from \"semantic-ui-react\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport { setDocuments } from \"../actions\";\n\nimport SemanticDatepicker from \"react-semantic-ui-datepickers\";\nimport \"react-semantic-ui-datepickers/dist/react-semantic-ui-datepickers.css\";\nimport AnnotationDB from \"../apis/dexie\";\n\nconst CreateDocument = () => {\n  const codingjob = useSelector((state) => state.codingjob);\n  const dispatch = useDispatch();\n\n  const [fieldValues, setFieldValues] = useState({});\n\n  const documentFields = {\n    title: \"text\",\n    text: \"text\",\n    annotations: \"text\",\n  };\n\n  const onCreate = async () => {\n    let submitData = { ...fieldValues };\n\n    for (const key of Object.keys(submitData)) {\n      if (key === \"date\" || /_date$/.test(key)) {\n        submitData[key] = submitData[key].toISOString();\n      }\n    }\n\n    try {\n      const db = new AnnotationDB();\n      await db.createDocuments(codingjob, [submitData]);\n      const documents = await db.listDocuments(codingjob);\n      await dispatch(setDocuments(documents));\n      setFieldValues({});\n    } catch (e) {\n      console.log(e);\n    }\n  };\n\n  if (!codingjob) return null;\n\n  return (\n    <Form style={{ marginTop: \"3em\" }}>\n      <DocumentForms\n        fields={documentFields}\n        fieldValues={fieldValues}\n        setFieldValues={setFieldValues}\n      />\n      {!codingjob ? null : (\n        <Button primary onClick={onCreate}>\n          Create document\n        </Button>\n      )}\n    </Form>\n  );\n};\n\nconst DocumentForms = function ({ fields, fieldValues, setFieldValues }) {\n  const onSubmit = (key, value) => {\n    const newFieldValues = { ...fieldValues };\n    newFieldValues[key] = value;\n    setFieldValues(newFieldValues);\n  };\n\n  if (!fields) return null;\n\n  return Object.keys(fields).map((key) => {\n    if (fields[key] === \"text\") {\n      return (\n        <Form.TextArea\n          key={key}\n          value={fieldValues[key] ? fieldValues[key] : \"\"}\n          onChange={(e, d) => onSubmit(key, d.value)}\n          label={key}\n        />\n      );\n    }\n    if (fields[key] === \"date\") {\n      return (\n        <Form.Field>\n          <SemanticDatepicker\n            key={key}\n            label={key}\n            value={fieldValues[key] ? fieldValues[key] : \"\"}\n            onChange={(e, d) => onSubmit(key, d.value)}\n          />\n        </Form.Field>\n      );\n    }\n    if (fields[key] === \"keyword\") {\n      return (\n        <Form.Field key={key}>\n          <label>{key}</label>\n          <input\n            value={fieldValues[key] ? fieldValues[key] : \"\"}\n            onChange={(e) => onSubmit(key, e.target.value)}\n          />\n        </Form.Field>\n      );\n    }\n    return null;\n  });\n};\n\nexport default CreateDocument;\n","import React, { useState } from \"react\";\nimport { Grid, Menu, Segment } from \"semantic-ui-react\";\n\nimport CodingjobSelector from \"./CodingjobSelector\";\nimport JobDetails from \"./JobDetails\";\nimport UploadDocuments from \"./UploadDocuments\";\nimport CreateDocument from \"./CreateDocument\";\n\nconst Create = () => {\n  const [activeItem, setActiveItem] = useState(\"details\");\n\n  const renderSwitch = (activeItem) => {\n    switch (activeItem) {\n      case \"details\":\n        return <JobDetails />;\n      case \"upload\":\n        return <UploadDocuments />;\n      case \"create\":\n        return <CreateDocument />;\n      default:\n        return null;\n    }\n  };\n\n  return (\n    <Grid stackable style={{ marginTop: \"3em\" }}>\n      <Grid.Column floated=\"left\" width={5}>\n        <CodingjobSelector type=\"table\" />\n      </Grid.Column>\n      <Grid.Column width={11}>\n        <Segment style={{ border: 0 }}>\n          <Menu pointing secondary>\n            <Menu.Item\n              name=\"details\"\n              active={activeItem === \"details\"}\n              onClick={(e, d) => setActiveItem(d.name)}\n            />\n            <Menu.Item\n              name=\"upload\"\n              active={activeItem === \"upload\"}\n              onClick={(e, d) => setActiveItem(d.name)}\n            />\n            <Menu.Item\n              name=\"create\"\n              active={activeItem === \"create\"}\n              onClick={(e, d) => setActiveItem(d.name)}\n            />\n          </Menu>\n          {renderSwitch(activeItem)}\n        </Segment>\n      </Grid.Column>\n    </Grid>\n  );\n};\n\nexport default Create;\n","import React, { useEffect, useState } from \"react\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport { toggleAnnotations } from \"../actions\";\nimport AnnotationDB from \"../apis/dexie\";\n\n// this is a dummy component to listen for changes in annotations and code\n// and saving them to the indexed db.\n\nconst ManageAnnotations = ({ tokens, doc }) => {\n  const annotations = useSelector((state) => state.spanAnnotations);\n  //const codes = useSelector((state) => state.codes);\n  const [ready, setReady] = useState(false);\n  const dispatch = useDispatch();\n\n  useEffect(() => {\n    setReady(false);\n  }, [doc]);\n\n  useEffect(() => {\n    if (tokens.length > 0 && doc.annotations && !ready) {\n      matchAnnotations(tokens, doc.annotations, dispatch);\n      setReady(true);\n    }\n  }, [ready, tokens, doc, dispatch]);\n\n  useEffect(() => {\n    if (ready) exportAnnotations(doc, annotations);\n  }, [ready, doc, annotations]);\n\n  return <div></div>;\n};\n\nconst exportAnnotations = async (doc, annotations) => {\n  const db = await new AnnotationDB();\n\n  let unique = new Set();\n  const uniqueAnnotations = Object.values(annotations).reduce((un_ann, ann) => {\n    for (let key of Object.keys(ann)) {\n      const ann_obj = {\n        code: key,\n        offset: ann[key].offset,\n        length: ann[key].length,\n      };\n      const json = JSON.stringify(ann_obj);\n      if (!unique.has(json)) {\n        unique.add(json);\n        un_ann.push(ann_obj);\n      }\n    }\n    return un_ann;\n  }, []);\n\n  await db.writeValue(\n    { doc_id: doc.doc_id },\n    \"annotations\",\n    JSON.stringify(uniqueAnnotations, null, 2)\n  );\n};\n\nconst matchAnnotations = (tokens, importedAnnotations, dispatch) => {\n  let trackAnnotations = {};\n  let matchedAnnotations = [];\n\n  for (let token of tokens) {\n    findMatches(\n      token,\n      importedAnnotations,\n      trackAnnotations,\n      matchedAnnotations\n    );\n  }\n\n  for (let matchedAnnotation of matchedAnnotations) {\n    addAnnotations(matchedAnnotation, dispatch);\n  }\n};\n\nconst findMatches = (\n  token,\n  importedAnnotations,\n  trackAnnotations,\n  matchedAnnotations\n) => {\n  const start = token.offset.start;\n  const end = token.offset.start + token.offset.length;\n\n  // loop over char offset for token. If a span annotation that\n  // starts on this offset is found, initiate a new annotation in trackAnnotations with this\n  // token index as the start of the span. If a span annotation that ends on\n  // this offset is found, set the token idnex as the end of the span,\n  // store annotation in matchedAnnotations, and remove from trackAnnotations\n  for (let i = start; i <= end; i++) {\n    if (importedAnnotations[i]) {\n      for (let code of importedAnnotations[i].start) {\n        trackAnnotations[code] = {\n          index: token.offset.index,\n          group: code,\n          offset: start,\n          length: null,\n          span: [token.offset.index],\n        };\n      }\n      for (let code of importedAnnotations[i].end) {\n        trackAnnotations[code].span.push(token.offset.index);\n        trackAnnotations[code].length =\n          token.offset.start +\n          token.offset.length -\n          trackAnnotations[code].offset;\n        matchedAnnotations.push(trackAnnotations[code]);\n        delete trackAnnotations[code];\n      }\n    }\n  }\n};\n\nconst addAnnotations = (ann, dispatch) => {\n  let newAnnotations = [];\n  for (let i = ann.span[0]; i <= ann.span[1]; i++) {\n    let newAnnotation = { ...ann };\n    newAnnotation.index = i;\n    newAnnotations.push(newAnnotation);\n  }\n  dispatch(toggleAnnotations(newAnnotations));\n};\n\nexport default ManageAnnotations;\n","import React, { useState, useEffect, useRef } from \"react\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport { Button, Dropdown, Popup, Ref, Step } from \"semantic-ui-react\";\nimport {\n  setCodes,\n  appendCodeHistory,\n  toggleAnnotations,\n  rmAnnotations,\n  blockEvents,\n  triggerCodeselector,\n} from \"../actions\";\nimport randomColor from \"randomcolor\";\n\nconst CodeSelector = ({ index, children }) => {\n  const codes = useSelector((state) => state.codes);\n  const codeHistory = useSelector((state) => state.codeHistory);\n  const spanAnnotations = useSelector((state) => state.spanAnnotations[index]);\n  const open = useSelector((state) => state.codeSelectorTrigger === index);\n\n  const textInputRef = useRef(null);\n  const [current, setCurrent] = useState(null);\n\n  // Placeholder: should be managed in state\n  const userAccess = { editable: true };\n  const dispatch = useDispatch();\n\n  // useEffect(() => {\n  //   console.log(\"mount\");\n  //   return () => {\n  //     console.log(\"unmount\");\n  //     setOpen(false);\n  //   };\n  // }, [setOpen]);\n\n  useEffect(() => {\n    if (current) return null;\n    if (!spanAnnotations) return null;\n\n    let annotation = spanAnnotations;\n    if (annotation && annotation !== undefined) {\n      if (Object.keys(annotation).includes(\"Not yet assigned\")) {\n        setCurrent(\"Not yet assigned\");\n      } else {\n        setCurrent(Object.keys(annotation)[0]);\n      }\n    }\n  }, [current, index, spanAnnotations]);\n\n  useEffect(() => {\n    if (open) {\n      window.addEventListener(\"keydown\", onKeydown);\n      dispatch(blockEvents(true));\n    } else {\n      window.removeEventListener(\"keydown\", onKeydown);\n      dispatch(blockEvents(false));\n    }\n    return () => {\n      window.removeEventListener(\"keydown\", onKeydown);\n      dispatch(blockEvents(false));\n    };\n  }, [open, dispatch]);\n\n  const onKeydown = (event) => {\n    if (textInputRef.current) textInputRef.current.click();\n  };\n\n  const onAddition = (e, d) => {\n    dispatch(\n      setCodes([\n        {\n          key: d.value,\n          text: d.value,\n          value: d.value,\n          color: randomColor({ seed: d.value, luminosity: \"bright\" }),\n        },\n        ...codes,\n      ])\n    );\n  };\n\n  console.log(open);\n  if (!open) return children;\n\n  return (\n    <Popup\n      trigger={children}\n      flowing\n      hoverable\n      wide\n      open={open}\n      mouseLeaveDelay={1000}\n      position=\"top left\"\n    >\n      <div>\n        <Step.Group vertical>\n          <Step active>\n            <Step.Content>\n              <Step.Title>Current code</Step.Title>\n              <Step.Description>\n                <Button.Group>\n                  <Button\n                    icon=\"trash\"\n                    size=\"mini\"\n                    onClick={(e, d) => updateAnnotations(current)}\n                  />\n                  <Button style={{ backgroundColor: getColor(current, codes) }}>\n                    <Dropdown\n                      text={current}\n                      options={getCurrentOptions(spanAnnotations, current)}\n                      value={current}\n                      onChange={(e, d) => setCurrent(d.value)}\n                    />\n                  </Button>\n                </Button.Group>\n              </Step.Description>\n            </Step.Content>\n          </Step>\n\n          <Step>\n            <Step.Content>\n              <Step.Title>Set new code</Step.Title>\n              <Step.Description>\n                <Button.Group vertical compact widths=\"1\">\n                  {newCodeButtons(\n                    spanAnnotations,\n                    codeHistory,\n                    current,\n                    codes,\n                    setCurrent,\n                    dispatch\n                  )}\n                </Button.Group>\n                &nbsp;&nbsp;\n                <Ref innerRef={textInputRef}>\n                  <Dropdown\n                    compact\n                    options={codes}\n                    placeholder={\n                      userAccess.editable ? \"Search or create \" : \"Search \"\n                    }\n                    widths={1}\n                    search\n                    selection\n                    allowAdditions={userAccess.editable}\n                    additionPosition={\"bottom\"}\n                    onAddItem={onAddition}\n                    selectOnNavigation={false}\n                    minCharacters={0}\n                    autoComplete={\"on\"}\n                    searchInput={{ autoFocus: false }}\n                    onChange={(e, d) => updateAnnotations(d.value)}\n                  />\n                </Ref>\n              </Step.Description>\n            </Step.Content>\n          </Step>\n        </Step.Group>\n      </div>\n    </Popup>\n  );\n};\n\nconst getCurrentOptions = (spanAnnotations, current) => {\n  let annotation = spanAnnotations;\n  if (annotation) {\n    return Object.keys(annotation)\n      .filter((e) => e !== current)\n      .map(ddOptions);\n  } else {\n    return [ddOptions(null)];\n  }\n};\n\nconst ddOptions = (value) => {\n  let useValue = value;\n  if (!value || value === \"null\") useValue = \"Not yet assigned\";\n  return { key: useValue, text: useValue, value: useValue };\n};\n\nconst newCodeButtons = (\n  spanAnnotations,\n  codeHistory,\n  current,\n  codes,\n  setCurrent,\n  dispatch\n) => {\n  return codeHistory\n    .filter((e) => e !== current && e !== \"Not yet assigned\")\n    .map((code) => {\n      return (\n        <Button\n          style={{ backgroundColor: getColor(code, codes) }}\n          key={code}\n          value={code}\n          onClick={(e, d) =>\n            updateAnnotations(spanAnnotations, current, d.value, dispatch)\n          }\n        >\n          {code}\n        </Button>\n      );\n    });\n};\n\nconst updateAnnotations = (\n  spanAnnotations,\n  current,\n  value,\n  setCurrent,\n  dispatch\n) => {\n  const key = current;\n\n  let annotation = spanAnnotations;\n  if (!annotation) return null;\n\n  let ann = {\n    index: annotation[key].index,\n    group: key,\n    offset: annotation[key].offset,\n    length: annotation[key].length,\n    span: annotation[key].span,\n  };\n\n  // this is a nasty hack. Sort nice solution out later\n  let oldAnnotation = { ...ann };\n  oldAnnotation.span = [oldAnnotation.index, oldAnnotation.index];\n  dispatch(rmAnnotations([oldAnnotation]));\n\n  if (value === key) {\n    dispatch(triggerCodeselector(null));\n    return null;\n  }\n\n  let newAnnotations = [];\n  for (let i = ann.span[0]; i <= ann.span[1]; i++) {\n    let newAnnotation = { ...ann };\n    newAnnotation.group = value;\n    newAnnotation.index = i;\n    newAnnotations.push(newAnnotation);\n  }\n  dispatch(toggleAnnotations(newAnnotations));\n  dispatch(appendCodeHistory(value));\n  if (Object.keys(annotation).includes(null)) {\n    setCurrent(null);\n  } else {\n    setCurrent(value);\n  }\n\n  dispatch(triggerCodeselector(null));\n};\n\nconst getColor = (tokenCode, codes) => {\n  const codematch = codes.find((e) => e.value === tokenCode);\n  if (codematch) {\n    return codematch.color;\n  } else {\n    return \"lightgrey\";\n  }\n};\n\nexport default CodeSelector;\n","import React from \"react\";\nimport { useDispatch, useSelector } from \"react-redux\";\n\nimport \"./style.css\";\nimport CodeSelector from \"./CodeSelector\";\nimport { triggerCodeselector } from \"../actions\";\n\nconst Token = React.forwardRef(({ token }, ref) => {\n  const selected = useSelector((state) => {\n    if (state.tokenSelection.length === 0) return false;\n\n    let [from, to] = state.tokenSelection;\n    if (from > to) [to, from] = [from, to];\n    return token.offset.index >= from && token.offset.index <= to;\n  });\n\n  let tokenClass = \"token\";\n  if (selected) tokenClass = tokenClass + \" selected\";\n\n  return (\n    <span\n      ref={ref}\n      className={tokenClass}\n      tokenindex={token.offset.index}\n      //tokenoffset={token.offset.start}\n      //tokenlength={token.offset.length}\n    >\n      <AnnotatedToken token={token} />\n    </span>\n  );\n});\n\nconst AnnotatedToken = ({ token }) => {\n  // If we specifically ask for the annotations for the current token within the\n  // useSelector function, rerender is only triggered if this value has changed\n  const annotations = useSelector(\n    (state) => state.spanAnnotations[token.offset.index]\n  );\n\n  const codes = useSelector((state) => state.codes);\n  const dispatch = useDispatch();\n\n  // This is a trick required to render if at least something within this token's\n  // annotations changed (somehow 'annotations' doesn't trigger this)\n  useSelector((state) =>\n    JSON.stringify(state.spanAnnotations[token.offset.index])\n  );\n\n  // if there are no annotation codes, our life is easy\n  if (!annotations) return <>{token.pre + token.text + token.post}</>;\n\n  // create solid colors or color gradients\n  const getColor = (tokenCode, codes) => {\n    const codematch = codes.find((e) => e.value === tokenCode);\n    if (codematch) {\n      return codematch.color;\n    } else {\n      return \"lightgrey\";\n    }\n  };\n\n  const tokenSpan = (annotatedTokenClass) => {\n    return (\n      <span\n        className={annotatedTokenClass}\n        onContextMenu={(e) => {\n          e.preventDefault();\n          dispatch(triggerCodeselector(token.offset.index));\n        }}\n        style={{\n          background: color,\n        }}\n      >\n        {allLeft && allRight ? token.text : null}\n        {allLeft && !allRight ? token.text + token.post : null}\n        {allRight && !allLeft ? token.pre + token.text : null}\n        {!allLeft && !allRight ? token.pre + token.text + token.post : null}\n      </span>\n    );\n  };\n\n  let tokenCodes = Object.keys(annotations);\n  let color = null;\n  if (tokenCodes.length === 1) {\n    color = getColor(tokenCodes[0], codes);\n  } else {\n    let colors = tokenCodes.map((code) => getColor(code, codes));\n    color = `linear-gradient(${colors.join(\", \")})`;\n  }\n\n  // Set specific classes for nice css to show the start/end of codes\n  const allLeft = !Object.values(annotations).some(\n    (code) => code.span[0] !== code.index\n  );\n  const allRight = !Object.values(annotations).some(\n    (code) => code.span[1] !== code.index\n  );\n  const anyLeft = Object.values(annotations).some(\n    (code) => code.span[0] === code.index\n  );\n  const anyRight = Object.values(annotations).some(\n    (code) => code.span[1] === code.index\n  );\n\n  let annotatedTokenClass = \"annotatedToken\";\n  if (allLeft) annotatedTokenClass = annotatedTokenClass + \" allLeft\";\n  if (anyLeft & !allLeft)\n    annotatedTokenClass = annotatedTokenClass + \" anyLeft\";\n  if (allRight) annotatedTokenClass = annotatedTokenClass + \" allRight\";\n  if (anyRight & !allRight)\n    annotatedTokenClass = annotatedTokenClass + \" anyRight\";\n\n  return (\n    <>\n      {allLeft ? token.pre : null}\n\n      <CodeSelector index={token.offset.index}>\n        {tokenSpan(annotatedTokenClass)}\n      </CodeSelector>\n\n      {allRight ? token.post : null}\n    </>\n  );\n};\n\nexport default React.memo(Token);\n","import React, { useEffect, useState } from \"react\";\nimport { Container, Segment } from \"semantic-ui-react\";\nimport Token from \"./Token\";\n\nimport nlp from \"compromise\";\nimport paragraphs from \"compromise-paragraphs\";\nnlp.extend(paragraphs);\n\nconst Tokens = ({ text, setTokens }) => {\n  // It's imporant that the annotations to not pass by this component\n  // but are loaded into Token from redux. This prevents rerendering\n  // all the parsing stuff\n  const [tokenComponents, setTokenComponents] = useState(null);\n\n  useEffect(() => {\n    const [paragraphs, tokens] = prepareTokens(text);\n    setTokenComponents(paragraphs);\n    setTokens(tokens);\n  }, [text, setTokens]);\n\n  if (text === null) return null;\n\n  return (\n    <Container text>\n      <Segment style={{ border: \"0\" }}>{tokenComponents}</Segment>\n    </Container>\n  );\n};\n\nconst prepareTokens = (text) => {\n  let tokens = []; // make object with\n  const tokenized = nlp.tokenize(text).paragraphs().json({ offset: true });\n  const paragraphs = tokenized.map((par, par_i) => {\n    return createParagraph(par, par_i, tokens);\n  });\n\n  return [paragraphs, tokens];\n};\n\nconst createParagraph = (par, par_i, tokens) => {\n  const mapSentences = (par) => {\n    return par.sentences.map((sent) => {\n      // for some reason there's an extra array layer between sentences and paragraphs...\n      // I've only found cases where lenght is 1, but I'll map it just in case\n      return sent.map((sent2) => {\n        return createSentence(sent2, tokens);\n      });\n    });\n  };\n  return (\n    // uses span behaving like p, because p is not allowed due to nested div (for Label)\n    <span style={{ marginTop: \"1em\", display: \"table\" }} key={par_i}>\n      {par_i === 0 ? <h2>{mapSentences(par)}</h2> : mapSentences(par)}\n    </span>\n  );\n};\n\nconst createSentence = (sent, tokens) => {\n  const mapTokens = (sent) => {\n    return sent.terms.map((token) => {\n      token.ref = React.createRef();\n      tokens.push(token);\n      return <Token ref={token.ref} key={token.offset.index} token={token} />;\n    });\n  };\n\n  return (\n    <span className=\"sentence\" key={sent.offset.index}>\n      {mapTokens(sent)}\n    </span>\n  );\n};\n\nexport default React.memo(Tokens);\n","import React, { useCallback, useEffect, useState } from \"react\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport {\n  clearSpanAnnotations,\n  setTokenSelection,\n  setCurrentToken,\n  clearTokenSelection,\n  triggerCodeselector,\n} from \"../actions\";\nimport { toggleAnnotations } from \"../actions\";\nimport ManageAnnotations from \"./ManageAnnotations\";\n\nimport Tokens from \"./Tokens\";\n\nconst arrowkeys = [\"ArrowRight\", \"ArrowLeft\", \"ArrowUp\", \"ArrowDown\"];\n\nconst AnnotationText = ({ doc }) => {\n  const currentToken = useSelector((state) => state.currentToken);\n  const tokenSelection = useSelector((state) => state.tokenSelection);\n  const eventsBlocked = useSelector((state) => state.eventsBlocked);\n\n  const [holdMouseLeft, setHoldMouseLeft] = useState(false);\n  const [mover, setMover] = useState(null);\n  const [holdCtrl, setHoldCtrl] = useState(false);\n  const [holdArrow, setHoldArrow] = useState(null);\n\n  const [tokens, setTokens] = useState([]);\n  const dispatch = useDispatch();\n\n  useEffect(() => {\n    dispatch(clearSpanAnnotations());\n  }, [doc, dispatch]);\n\n  useEffect(() => {\n    window.addEventListener(\"mousedown\", onMouseDown);\n    window.addEventListener(\"mousemove\", onMouseMove);\n    window.addEventListener(\"mouseup\", onMouseUp);\n    window.addEventListener(\"contextmenu\", onContextMenu);\n    return () => {\n      window.removeEventListener(\"mousedown\", onMouseDown);\n      window.removeEventListener(\"mousemove\", onMouseMove);\n      window.removeEventListener(\"mouseup\", onMouseUp);\n      window.removeEventListener(\"contextmenu\", onContextMenu);\n    };\n  });\n\n  // (see useEffect with 'eventsBlocked' for details on useCallback)\n  const onKeyUp = useCallback((event) => {\n    // keep track of which buttons are pressed in the state\n    if (event.key === \"Control\" || event.key === \"Shift\") {\n      setHoldCtrl(false);\n      return;\n    }\n    if (arrowkeys.includes(event.key)) {\n      setHoldArrow(false);\n      setMover(null);\n    }\n  }, []);\n\n  // (see useEffect with 'eventsBlocked' for details on useCallback)\n  const onKeyDown = useCallback(\n    (event) => {\n      // key presses, and key holding (see onKeyUp)\n      if (event.key === \"Control\" || event.key === \"Shift\") {\n        if (event.repeat) return;\n        setHoldCtrl(true);\n        return;\n      }\n      if (arrowkeys.includes(event.key)) {\n        event.preventDefault();\n        if (event.repeat) return;\n        setMover({\n          position: currentToken,\n          startposition: currentToken,\n          ntokens: tokens.length,\n          counter: 1,\n        });\n        setHoldArrow(event.key);\n      }\n\n      if (tokenSelection.length > 0) {\n        const space_enter = event.keyCode === 32 || event.keyCode === 13;\n        if (space_enter) {\n          event.preventDefault();\n          annotationFromSelection(tokens, tokenSelection, dispatch);\n        }\n      }\n    },\n    [currentToken, tokenSelection, tokens, dispatch]\n  );\n\n  // This blocks event listeners when the eventsBlocked state (in redux) is true.\n  // This lets us block the key activities in the text (selecting tokens) when\n  // the CodeSelector popup is open\n  useEffect(() => {\n    if (eventsBlocked) {\n      window.removeEventListener(\"keydown\", onKeyDown);\n      window.removeEventListener(\"keyup\", onKeyUp);\n      setHoldCtrl(false);\n      setHoldArrow(false);\n    } else {\n      window.addEventListener(\"keydown\", onKeyDown);\n      window.addEventListener(\"keyup\", onKeyUp);\n    }\n    return () => {\n      window.removeEventListener(\"keydown\", onKeyDown);\n      window.removeEventListener(\"keyup\", onKeyUp);\n    };\n  }, [eventsBlocked, onKeyDown, onKeyUp]);\n\n  useEffect(() => {\n    // When arrow key is held, walk through tokens with increasing speed\n    // this loops itself by updating mover (an object with position information)\n    // this is like setIntervall, but allows custom time intervalls,\n    // and we can interject the loop with updated keydowns (currently ctrl for starting selection)\n    if (!mover || !holdArrow) return;\n\n    let position = movePosition(tokens, holdArrow, mover, holdCtrl, dispatch);\n\n    let delay = Math.max(5, 100 / Math.ceil(mover.counter / 5));\n    if (mover.counter === 1) delay = 150;\n    setTimeout(() => {\n      setMover({\n        position: position,\n        startposition: mover.startposition,\n        ntokens: mover.ntokens,\n        counter: mover.counter + 1,\n      });\n    }, delay);\n  }, [tokens, mover, holdArrow, holdCtrl, dispatch]);\n\n  const onMouseDown = (event) => {\n    // When left button pressed, start new selection\n    if (event.which !== 1) return null;\n    event.preventDefault();\n    setHoldMouseLeft(true);\n    dispatch(clearTokenSelection());\n  };\n\n  const onMouseMove = (event) => {\n    // When selection started (mousedown), select tokens hovered over\n    if (event.which !== 1) return null;\n    if (holdMouseLeft) {\n      storeMouseSelection(event);\n    }\n  };\n\n  const onMouseUp = (event) => {\n    // When left mouse key is released, create the annotation\n    // note that in case of a single click, the token has not been selected (this happens on move)\n    // so this way a click can still be used to open\n    if (event.which !== 1) return null;\n    const currentNode = storeMouseSelection(event);\n    const selection = window.getSelection();\n    selection.empty();\n    setHoldMouseLeft(false);\n\n    // storeMouseSelection does save position to tokenSelection state, but this isn't\n    // yet updated within this scope. This results in single clicks (without mousemove)\n    // not registering. So if there is no current selection, directly use currentNode as position.\n    if (tokenSelection.length > 0) {\n      annotationFromSelection(tokens, tokenSelection, dispatch);\n    } else {\n      if (currentNode)\n        annotationFromSelection(tokens, [currentNode, currentNode], dispatch);\n    }\n  };\n\n  const onContextMenu = (event) => {\n    if (event.button === 2) return null;\n    event.preventDefault();\n    event.stopPropagation();\n  };\n\n  const storeMouseSelection = (event) => {\n    // select tokens that the mouse/touch is currently pointing at\n    let currentNode = getToken(tokens, event.originalTarget);\n    if (!currentNode) return null;\n\n    dispatch(setCurrentToken(currentNode.index));\n    dispatch(setTokenSelection(currentNode.index, true));\n    return currentNode.index;\n  };\n\n  if (!doc) return null;\n  return (\n    <>\n      <Tokens text={doc.text} setTokens={setTokens} />\n      <ManageAnnotations tokens={tokens} doc={doc} />\n    </>\n  );\n};\n\nconst annotationFromSelection = (tokens, selection, dispatch) => {\n  let [from, to] = selection;\n  if (from > to) [from, to] = [to, from];\n\n  const annotations = [];\n  for (let i = from; i <= to; i++) {\n    annotations.push({\n      index: i,\n      group: \"Not yet assigned\",\n      offset: tokens[from].offset.start,\n      length:\n        tokens[to].offset.length +\n        tokens[to].offset.start -\n        tokens[from].offset.start,\n      span: [from, to],\n    });\n  }\n  dispatch(toggleAnnotations(annotations));\n  dispatch(clearTokenSelection());\n  dispatch(triggerCodeselector(to));\n};\n\nconst movePosition = (tokens, key, mover, ctrl, dispatch) => {\n  let newPosition = mover.position;\n  if (key === \"ArrowRight\") newPosition++;\n  if (key === \"ArrowLeft\") newPosition--;\n  if (key === \"ArrowUp\") newPosition = moveSentence(tokens, mover, \"up\");\n  if (key === \"ArrowDown\") newPosition = moveSentence(tokens, mover, \"down\");\n\n  if (newPosition > mover.ntokens) newPosition = mover.ntokens;\n  if (newPosition < 0) newPosition = 0;\n\n  if (mover.position !== newPosition) {\n    dispatch(setCurrentToken(newPosition));\n    dispatch(setTokenSelection(newPosition, ctrl));\n  }\n  tokens[newPosition].ref.current.scrollIntoView({ block: \"center\" });\n  return newPosition;\n};\n\nconst moveSentence = (tokens, mover, direction = \"up\") => {\n  // moving sentences is a bit tricky, but we can do it via the refs to the\n  // token spans, that provide information about the x and y values\n  const current = tokens[mover.position].ref.current.getBoundingClientRect();\n  const start = tokens[mover.startposition].ref.current.getBoundingClientRect();\n  let next;\n\n  if (direction === \"up\") {\n    for (let i = mover.position; i >= 0; i--) {\n      next = tokens[i].ref.current.getBoundingClientRect();\n      if (next.y < current.y && next.x < start.x) {\n        return i;\n      }\n    }\n    return 0;\n  }\n  if (direction === \"down\") {\n    for (let i = mover.position; i < tokens.length; i++) {\n      next = tokens[i].ref.current.getBoundingClientRect();\n      if (next.y > current.y && next.x > start.x) return i;\n    }\n    return tokens.length - 1;\n  }\n};\n\nconst getTokenAttributes = (tokens, tokenNode) => {\n  const tokenindex = parseInt(tokenNode.getAttribute(\"tokenindex\"));\n\n  return {\n    index: tokenindex,\n    offset: tokens[tokenindex].offset.start,\n    length: tokens[tokenindex].offset.length,\n  };\n};\n\nconst getToken = (tokens, e) => {\n  if (e.className === \"token\" || e.className === \"token selected\")\n    return getTokenAttributes(tokens, e);\n  if (e.parentNode) {\n    if (e.parentNode.className === \"token\")\n      return getTokenAttributes(tokens, e.parentNode);\n  }\n  return null;\n};\n\nexport default AnnotationText;\n","import React, { useEffect, useState } from \"react\";\nimport { useSelector } from \"react-redux\";\nimport {\n  Breadcrumb,\n  BreadcrumbSection,\n  Dropdown,\n  Grid,\n} from \"semantic-ui-react\";\n\nimport CodingjobSelector from \"./CodingjobSelector\";\nimport AnnotationText from \"./AnnotationText\";\nimport AnnotationDB from \"../apis/dexie\";\n\nconst Annotate = () => {\n  const codingjob = useSelector((state) => state.codingjob);\n  const [doc, setDoc] = useState(null);\n  const [documentList, setDocumentList] = useState([]);\n\n  useEffect(() => {\n    getDocuments(codingjob, setDoc, setDocumentList);\n  }, [codingjob]);\n\n  const documentSelector = (setDoc, documentList) => {\n    const options = dropdownOptions(documentList);\n    return (\n      <Dropdown\n        inline\n        search\n        onChange={(e, d) => {\n          getDocument(setDoc, d.value);\n        }}\n        options={options}\n        value={doc ? doc.doc_id : null}\n      />\n    );\n  };\n\n  return (\n    <>\n      <Grid>\n        <Grid.Row>\n          <Breadcrumb>\n            <BreadcrumbSection link>\n              <CodingjobSelector type=\"dropdown\" />\n            </BreadcrumbSection>\n            <Breadcrumb.Divider />\n            <BreadcrumbSection link>\n              {documentSelector(setDoc, documentList)}\n            </BreadcrumbSection>\n          </Breadcrumb>\n        </Grid.Row>\n        <Grid.Row>\n          <Grid.Column width={12}>\n            <AnnotationText doc={doc ? doc : null} />\n          </Grid.Column>\n          <Grid.Column width={4}></Grid.Column>\n        </Grid.Row>\n      </Grid>\n    </>\n  );\n};\n\nconst getDocuments = async (codingjob, setDoc, setDocumentList) => {\n  if (codingjob) {\n    const db = new AnnotationDB();\n    const documents = await db.listDocuments(codingjob);\n    setDocumentList(documents);\n    if (documents.length > 0) {\n      setDoc({\n        doc_id: documents[0].doc_id,\n        text: documents[0].title + \"\\n\\n\" + documents[0].text,\n        annotations: prepareAnnotations(documents[0].annotations),\n      });\n    } else {\n      setDoc(null);\n    }\n  }\n};\n\nconst getDocument = async (setDoc, doc_id) => {\n  const db = new AnnotationDB();\n  const document = await db.getDocument(doc_id);\n  setDoc({\n    doc_id: document.doc_id,\n    text: document.title + \"\\n\\n\" + document.text,\n    annotations: prepareAnnotations(document.annotations),\n  });\n};\n\nconst prepareAnnotations = (annotations) => {\n  if (!annotations || annotations === \"\") return {};\n  const anns = JSON.parse(annotations);\n\n  // create an object where the key is an offset, and the\n  // value is an array that tells which codes start and end there\n  // used in Tokens for matching to token indices\n  // (matching to tokenindices is needed for speed, to keep coding nice and responsive)\n  return anns.reduce((obj, ann) => {\n    if (!obj[ann.offset]) obj[ann.offset] = { start: [], end: [] };\n    if (!obj[ann.offset + ann.length])\n      obj[ann.offset + ann.length] = { start: [], end: [] };\n    obj[ann.offset].start.push(ann.code);\n    obj[ann.offset + ann.length].end.push(ann.code);\n    return obj;\n  }, {});\n};\n\nconst dropdownOptions = (documentList) => {\n  const items = documentList.map((document, i) => {\n    return {\n      key: i,\n      text: document.title,\n      value: document.doc_id,\n    };\n  });\n  return items;\n};\n\nexport default Annotate;\n","import React from \"react\";\nimport { BrowserRouter, Route, Switch } from \"react-router-dom\";\nimport HeaderMenu from \"./components/HeaderMenu\";\nimport { Divider, Container } from \"semantic-ui-react\";\n\n// login and authenticated route\nimport Welcome from \"./components/Welcome\";\nimport AuthRoute from \"./components/AuthRoute\";\n\n// Main pages. Use below in items to include in header menu\nimport Create from \"./components/Create\";\nimport Annotate from \"./components/Annotate\";\n\n// Change to add new components to the header\n// The first item will be the opening page after login\nconst host = \"https://ccs-amsterdam.github.io\";\nconst homepage = \"/amcat4annotator\";\nconst items = [\n  { label: \"Create\", path: homepage + \"/create\", Component: Create },\n  { label: \"Annotate\", path: homepage + \"/annotate\", Component: Annotate },\n];\n\nconst App = () => {\n  const createNavigation = (items) => {\n    return items.map((item) => {\n      return (\n        <AuthRoute\n          key={item.path}\n          path={item.path}\n          homepage={homepage}\n          Component={item.Component}\n        />\n      );\n    });\n  };\n\n  return (\n    <BrowserRouter>\n      <HeaderMenu items={items} host={host} homepage={homepage} />\n      <Divider />\n      <Container style={{ marginTop: \"3em\" }}>\n        <Switch>\n          <Route\n            exact\n            path={homepage}\n            render={() => <Welcome items={items} />}\n          />\n          {createNavigation(items)}\n        </Switch>\n      </Container>\n    </BrowserRouter>\n  );\n};\n\nexport default App;\n","import { combineReducers } from \"redux\";\n\nconst db = (state = null, action) => {\n  switch (action.type) {\n    case \"SET_DB\":\n      return action.payload;\n    case \"RESET_DB\":\n      return null;\n    default:\n      return state;\n  }\n};\n\nconst eventsBlocked = (state = false, action) => {\n  switch (action.type) {\n    case \"BLOCK_EVENTS\":\n      return action.payload;\n    default:\n      return state;\n  }\n};\n\nconst codingjob = (state = null, action) => {\n  switch (action.type) {\n    case \"SELECT_CODINGJOB\":\n      return action.payload;\n    case \"RESET_DB\":\n      return null;\n    default:\n      return state;\n  }\n};\n\nconst codingjobs = (state = [], action) => {\n  switch (action.type) {\n    case \"SET_CODINGJOBS\":\n      return action.payload;\n    case \"RESET_DB\":\n      return [];\n    default:\n      return state;\n  }\n};\n\nconst documents = (state = [], action) => {\n  switch (action.type) {\n    case \"SET_DOCUMENTS\":\n      return action.payload;\n    case \"RESET_DB\":\n      return [];\n    default:\n      return state;\n  }\n};\n\nconst document = (state = [], action) => {\n  switch (action.type) {\n    case \"SELECT_DOCUMENT\":\n      return action.payload;\n    case \"RESET_DB\":\n      return [];\n    default:\n      return state;\n  }\n};\n\nconst tokenIndices = (state = [], action) => {\n  switch (action.type) {\n    case \"SET_TOKEN_INDICES\":\n      return action.payload;\n    case \"RESET_DB\":\n      return null;\n    default:\n      return state;\n  }\n};\n\nconst currentToken = (state = 0, action) => {\n  switch (action.type) {\n    case \"SET_CURRENT_TOKEN\":\n      return action.payload;\n    case \"RESET_DB\":\n      return 0;\n    default:\n      return state;\n  }\n};\n\nconst tokenSelection = (state = [], action) => {\n  // an array of length 2, giving the start and end of the selection\n  switch (action.type) {\n    case \"SET_TOKEN_SELECTION\":\n      return toggleSelection(state, action.index, action.add);\n    case \"CLEAR_TOKEN_SELECTION\":\n      return [];\n    case \"RESET_DB\":\n      return [];\n    default:\n      return state;\n  }\n};\n\nconst codeSelectorTrigger = (state = null, action) => {\n  switch (action.type) {\n    case \"TRIGGER_CODESELECTOR\":\n      return action.payload;\n    default:\n      return state;\n  }\n};\n\nconst toggleSelection = (selection, index, add) => {\n  if (!add || selection.length === 0) return [index, index];\n  return [selection[0], index];\n};\n\nconst spanAnnotations = (state = {}, action) => {\n  switch (action.type) {\n    case \"TOGGLE_ANNOTATIONS\":\n      return toggleAnnotations({ ...state }, action.payload, false);\n    case \"RM_ANNOTATIONS\":\n      return toggleAnnotations({ ...state }, action.payload, true);\n    case \"CLEAR_SPAN_ANNOTATIONS\":\n      return {};\n    case \"RESET_DB\":\n      return {};\n    default:\n      return state;\n  }\n};\n\nconst toggleAnnotations = (annotations, annList, rm) => {\n  for (let key in annList) {\n    let a = annList[key];\n\n    // if group in annotations, remove it\n    if (annotations[a.index]) {\n      if (annotations[a.index][a.group]) {\n        const span = annotations[a.index][a.group].span;\n        for (let i = span[0]; i <= span[1]; i++) {\n          if (annotations[i]) {\n            if (annotations[i][a.group]) {\n              delete annotations[i][a.group];\n              if (Object.keys(annotations[i]).length === 0) {\n                delete annotations[i];\n              }\n            }\n          }\n        }\n        // if selection was one token (which is probably a click),\n        // just remove the annotation. But if it was a multi-token selection,\n        // we do add the new selection\n        if (a.span[0] === a.span[1]) continue;\n      }\n    }\n\n    if (!rm) {\n      if (!annotations[a.index]) annotations[a.index] = {};\n      annotations[a.index][a.group] = {\n        index: a.index,\n        span: [a.span[0], a.span[1]],\n        offset: a.offset,\n        length: a.length,\n      };\n    }\n  }\n  return annotations;\n};\n\nconst testCodes = [\n  {\n    key: \"Mark Rutte\",\n    text: \"Mark Rutte\",\n    value: \"Mark Rutte\",\n    color: \"#40a31f\",\n  },\n  {\n    key: \"Sigrid Kaag\",\n    text: \"Sigrid Kaag\",\n    value: \"Sigrid Kaag\",\n    color: \"#f2db5c\",\n  },\n];\n\nconst codes = (state = testCodes, action) => {\n  switch (action.type) {\n    case \"SET_CODES\":\n      return action.payload;\n    case \"RESET_DB\":\n      return [];\n    default:\n      return state;\n  }\n};\n\nconst codeHistory = (state = [], action) => {\n  switch (action.type) {\n    case \"APPEND_CODE_HISTORY\":\n      let newstate = state\n        .filter((v) => v !== action.payload.code)\n        .slice(0, action.payload.n - 1);\n      newstate.unshift(action.payload.code);\n      return newstate;\n    case \"RESET_DB\":\n      return [];\n    default:\n      return state;\n  }\n};\n\nconst rootReducer = combineReducers({\n  db,\n  eventsBlocked,\n  codingjob,\n  codingjobs,\n  document,\n  documents,\n  tokenIndices,\n  currentToken,\n  codeSelectorTrigger,\n  tokenSelection,\n  spanAnnotations,\n  codes,\n  codeHistory,\n});\n\nexport default rootReducer;\n","import \"semantic-ui-css/semantic.min.css\";\nimport React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport App from \"./App\";\nimport { createStore } from \"redux\";\nimport rootReducer from \"./reducers\";\nimport { Provider } from \"react-redux\";\n\nconst store = createStore(rootReducer);\n\nReactDOM.render(\n  <React.StrictMode>\n    <Provider store={store}>\n      <App />\n    </Provider>\n  </React.StrictMode>,\n  document.querySelector(\"#root\")\n);\n"],"sourceRoot":""}