(this.webpackJsonpamcat4annotator=this.webpackJsonpamcat4annotator||[]).push([[0],{331:function(e,t){},333:function(e,t){},343:function(e,t){},345:function(e,t){},371:function(e,t){},373:function(e,t){},374:function(e,t){},379:function(e,t){},381:function(e,t){},400:function(e,t){},412:function(e,t){},415:function(e,t){},463:function(e,t,n){var r={"./bg-BG.json":464,"./ca-ES.json":465,"./cs-CZ.json":466,"./de-DE.json":467,"./en-US.json":284,"./es-ES.json":468,"./et-EE.json":469,"./fi-FI.json":470,"./fr-FR.json":471,"./he-IL.json":472,"./it-IT.json":473,"./ja-JP.json":474,"./ko-KR.json":475,"./nb-NO.json":476,"./nn-NO.json":477,"./pl-PL.json":478,"./pt-BR.json":479,"./ru-RU.json":480,"./sv-SE.json":481,"./tr-TR.json":482,"./zh-CN.json":483};function o(e){var t=a(e);return n(t)}function a(e){if(!n.o(r,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return r[e]}o.keys=function(){return Object.keys(r)},o.resolve=a,e.exports=o,o.id=463},485:function(e,t,n){},486:function(e,t,n){"use strict";n.r(t);n(316);var r,o=n(0),a=n.n(o),c=n(59),i=n.n(c),s=n(82),u=n(18),l=n(7),d=n(518),j=n(11),b=n.n(j),f=n(17),p=n(12),h=function(e){return{type:"SET_DB",payload:e}},O=function(e){return{type:"SET_DROPBOX",payload:e}},x=function(e){return{type:"SELECT_CODINGJOB",payload:e}},g=function(e){return{type:"SET_CODINGJOBS",payload:e}},v=function(e){return{type:"SET_DOCUMENTS",payload:e}},m=function(e){return{type:"TOGGLE_ANNOTATIONS",payload:e}},y=n(512),w=n(514),k=n(487),C=n(141),S=n(142),E=n(206),T=n(290),D=n.n(T),_=function(){function e(t,n){Object(C.a)(this,e),this.dbx=t,this.user=n}return Object(S.a)(e,[{key:"readJSON",value:function(e){this.dbx.filesDownload({path:"/".concat(this.user.email,"/").concat(e)})}},{key:"writeJSON",value:function(e,t){var n=new File(e,t,{type:"application/json"});this.dbx.filesUpload({path:"/".concat(this.user.email,"/").concat(n.name),contents:n})}}]),e}(),A=function(){var e=Object(f.a)(b.a.mark((function e(t,n){var r,o;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.setAccessToken(n),r=new E.Dropbox({auth:t}),e.next=4,r.usersGetCurrentAccount();case 4:return o=e.sent,e.abrupt("return",new _(r,o.result));case 6:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),N=function(){var e=Object(f.a)(b.a.mark((function e(t,n,r){var o,a;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=window.sessionStorage.getItem("codeVerifier"),t.setCodeVerifier(o),e.next=4,t.generateCodeChallenge();case 4:return e.next=6,t.getAccessTokenFromCode(r,n);case 6:return a=e.sent,e.abrupt("return",{token:a.result.access_token,refresh_token:a.result.refresh_token,expiration_date:Date.now()+1e3*a.result.expires_in});case 8:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),R=n(1),I=function(){var e=Object(o.useState)(!1),t=Object(p.a)(e,2),n=t[0],r=t[1],a=Object(l.c)((function(e){return e.dropbox})),c=Object(l.b)(),i=Object(l.c)((function(e){return e.db}));return Object(R.jsxs)(y.a,{closeIcon:!0,open:n,trigger:Object(R.jsx)(d.a.Item,{icon:"dropbox",name:"Sync",style:{color:"lightblue"}}),onClose:function(){return r(!1)},onOpen:function(){return r(!0)},children:[Object(R.jsx)(w.a,{icon:"dropbox",content:"Synchronize with Dropbox"}),Object(R.jsx)(y.a.Content,{children:Object(R.jsx)("p",{children:"Something about synchronization."})}),Object(R.jsxs)(y.a.Actions,{children:[Object(R.jsx)(k.a,{primary:!0,onClick:function(){a.writeJSON(["test"],"test.json")},children:"Synchronize"}),Object(R.jsx)(k.a,{primary:!0,onClick:function(){i&&i.deleteToken("dropbox"),c(O(null))},children:"Disconnect"})]})]})},F="/create",B=(r="doge8b5gywmaz6x",new E.DropboxAuth({clientId:r})),P=function(e,t){var n=window.location.host;return"localhost:3000"===n?"http://"+n+e+t:"https://"+n+e+t},G=function(e){var t=e.homepage,n=Object(o.useState)(),r=Object(p.a)(n,2),a=r[0],c=r[1],i=Object(l.c)((function(e){return e.dropbox})),s=Object(l.c)((function(e){return e.db})),j=Object(o.useState)(!0),h=Object(p.a)(j,2),x=h[0],g=h[1],v=Object(l.b)(),m=Object(u.g)();Object(o.useEffect)((function(){if(console.log("listen"),!i&&s){var e=function(){var e=Object(f.a)(b.a.mark((function e(t){var n;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,A(B,t.token);case 3:return n=e.sent,e.next=6,s.addToken("dropbox",t);case 6:return e.next=8,v(O(n));case 8:e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),console.log(e.t0);case 13:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(t){return e.apply(this,arguments)}}();x&&(g(!1),s.getToken("dropbox").then((function(t){t&&t.token&&(Date.now()>t.expiration_date?(console.log("Trying refresh"),B.setRefreshToken(t.refresh_token),B.refreshAccessToken().then(e)):e(t))})));var n=D.a.parse(window.location.search).code,r=P(t,F);n&&N(B,n,r).then(e).then((function(){m.push(F)})).catch((function(e){return console.log(e)}))}}),[i,s,t,x,v,m]);return s?i?Object(R.jsx)(I,{}):Object(R.jsxs)(y.a,{closeIcon:!0,open:a,trigger:Object(R.jsx)(d.a.Item,{icon:"dropbox",name:"Connect"}),onClose:function(){return c(!1)},onOpen:function(){return c(!0)},children:[Object(R.jsx)(w.a,{icon:"dropbox",content:"Connect to Dropbox"}),Object(R.jsxs)(y.a.Content,{children:[Object(R.jsx)("p",{children:"This app connects with Dropbox using OAuth 2.0 authorization with PKCE flow. Your will exchange your data directly with Dropbox, so we can't touch it. (So we also can't help you if you lose it)"}),Object(R.jsx)("p",{children:"As Dropbox will also tell you, this app will only have read/write access to the Apps/AmCAT_Annotator folder in your dropbox. So even if you don't trust us we're quite harmless."})]}),Object(R.jsx)(y.a.Actions,{children:Object(R.jsx)(k.a,{primary:!0,onClick:function(){var e=P(t,F);!function(e,t){e.getAuthenticationUrl(t,void 0,"code","offline",void 0,void 0,!0).then((function(t){window.sessionStorage.clear(),window.sessionStorage.setItem("codeVerifier",e.codeVerifier),window.location.href=t})).catch((function(e){return console.error(e)}))}(B,e)},children:"Authenticate"})})]}):null},L=n(293),J=n(294),z=n.n(J);function H(e){var t=e.totalRows,n=e.completedRows;console.log("Progress: ".concat(n," of ").concat(t," rows completed"))}var M=function(){var e=Object(o.useState)(!1),t=Object(p.a)(e,2),n=t[0],r=t[1],a=Object(l.c)((function(e){return e.db})),c=function(){var e=Object(f.a)(b.a.mark((function e(){var t;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,console.log(a),e.next=4,Object(L.a)(a.idb,{filter:function(e,t,n){return"codingjobs"===e||"documents"===e},prettyJson:!0,progressCallback:H});case 4:t=e.sent,z()(t,"AmCAT_Annotator.json"),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),console.error(""+e.t0);case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(){return e.apply(this,arguments)}}();return Object(R.jsxs)(y.a,{closeIcon:!0,open:n,trigger:Object(R.jsx)(d.a.Item,{icon:"download",name:"Download",style:{color:"lightgreen"}}),onClose:function(){return r(!1)},onOpen:function(){return r(!0)},children:[Object(R.jsx)(w.a,{icon:"dropbox",content:"Download everything"}),Object(R.jsx)(y.a.Content,{children:Object(R.jsx)("p",{children:"Download all data as a single JSON dump"})}),Object(R.jsx)(y.a.Actions,{children:Object(R.jsx)(k.a,{primary:!0,onClick:c,children:"Download"})})]})},U=n(79),V=function(e){var t=e.homepage,n=Object(l.c)((function(e){return e.db})),r=Object(l.b)(),a=Object(o.useState)(!1),c=Object(p.a)(a,2),i=c[0],s=c[1],j=Object(u.g)();return n?Object(R.jsxs)(y.a,{closeIcon:!0,open:i,trigger:Object(R.jsx)(d.a.Item,{icon:"rocket",name:"Reset",style:{color:"#d7a3a3"}}),onClose:function(){return s(!1)},onOpen:function(){return s(!0)},children:[Object(R.jsx)(w.a,{icon:"power off",content:"Reset Annotator Database"}),Object(R.jsx)(y.a.Content,{children:Object(R.jsx)("p",{children:"This will remove all document and annotation data from your browser. Any annotations that have not been saved/synchronized will be lost. Are you absolutely sure?"})}),Object(R.jsxs)(y.a.Actions,{children:[Object(R.jsxs)(k.a,{color:"red",onClick:function(){s(!1)},children:[Object(R.jsx)(U.a,{name:"remove"})," No"]}),Object(R.jsxs)(k.a,{color:"green",onClick:function(){console.log(n),n.deleteDB().then((function(){r({type:"RESET_DB"}),s(!1),j.push(t)})).catch((function(e){console.log(e)}))},children:[Object(R.jsx)(U.a,{name:"checkmark"})," Yes"]})]})]}):null};function q(){return Y.apply(this,arguments)}function Y(){return(Y=Object(f.a)(b.a.mark((function e(){var t;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,$();case 2:t=e.sent,e.t0=t,e.next="never"===e.t0?6:"persisted"===e.t0?8:"prompt"===e.t0?10:12;break;case 6:return console.log("Not possible to persist storage"),e.abrupt("break",13);case 8:return console.log("Successfully persisted storage silently"),e.abrupt("break",13);case 10:return console.log("Not persisted, but we may prompt user when we want to."),e.abrupt("break",13);case 12:console.log("compiler desperately wanted a default");case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function K(){return W.apply(this,arguments)}function W(){return(W=Object(f.a)(b.a.mark((function e(){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,navigator.storage;case 2:if(e.t0=e.sent,!e.t0){e.next=5;break}e.t0=navigator.storage.persist;case 5:if(!e.t0){e.next=9;break}e.t1=navigator.storage.persist(),e.next=10;break;case 9:e.t1=void 0;case 10:return e.abrupt("return",e.t1);case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function X(){return Z.apply(this,arguments)}function Z(){return(Z=Object(f.a)(b.a.mark((function e(){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,navigator.storage;case 2:if(e.t0=e.sent,!e.t0){e.next=5;break}e.t0=navigator.storage.persisted;case 5:if(!e.t0){e.next=9;break}e.t1=navigator.storage.persisted(),e.next=10;break;case 9:e.t1=void 0;case 10:return e.abrupt("return",e.t1);case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function $(){return Q.apply(this,arguments)}function Q(){return(Q=Object(f.a)(b.a.mark((function e(){var t;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(navigator.storage&&navigator.storage.persisted){e.next=2;break}return e.abrupt("return","never");case 2:return e.next=4,navigator.storage.persisted();case 4:if(!e.sent){e.next=7;break}return e.abrupt("return","persisted");case 7:if(navigator.permissions&&navigator.permissions.query){e.next=9;break}return e.abrupt("return","prompt");case 9:return e.next=11,navigator.permissions.query({name:"persistent-storage"});case 11:if("granted"!==(t=e.sent).state){e.next=21;break}return e.next=15,navigator.storage.persist();case 15:if(!e.sent){e.next=20;break}return e.abrupt("return","persisted");case 20:throw new Error("Failed to persist");case 21:if("prompt"!==t.state){e.next=23;break}return e.abrupt("return","prompt");case 23:return e.abrupt("return","never");case 24:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var ee=function(){var e=Object(o.useState)(!1),t=Object(p.a)(e,2),n=t[0],r=t[1],a=Object(o.useState)(!1),c=Object(p.a)(a,2),i=c[0],s=c[1];Object(o.useEffect)((function(){i||X().then(s)}),[i]);var u=function(){var e=Object(f.a)(b.a.mark((function e(){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,K();case 2:return e.next=4,X();case 4:e.sent?(s(!0),alert("indexedDB set to persistent for AmCAT Annotator")):alert("Failed to set indexedDB to persistent");case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return i?null:Object(R.jsxs)(y.a,{closeIcon:!0,open:n,trigger:Object(R.jsx)(d.a.Item,{icon:"database",name:"Enable persitance",style:{color:"#d7a3a3"}}),onClose:function(){return r(!1)},onOpen:function(){return r(!0)},children:[Object(R.jsx)(w.a,{icon:"database",content:"Set database persistence"}),Object(R.jsxs)(y.a.Content,{children:[Object(R.jsx)("p",{children:"We did not have permission to automatically make the data storage for this website persistent. This means that the data could be removed automatically by your browser if it needs to free up space for another website. You can try to set this manually here, but not all browsers support this (yet)."}),Object(R.jsx)("p",{children:"If the database is not persistent the app can still be used, but you need to be more carefull in making sure that data is regularly backed up, either by manually downloading data or syncing with Dropbox"})]}),Object(R.jsx)(y.a.Actions,{children:Object(R.jsxs)(k.a,{onClick:u,children:[Object(R.jsx)(U.a,{name:"checkmark"})," Yes"]})})]})},te=Object(u.i)((function(e){var t=e.items,n=e.host,r=e.homepage,o=Object(l.c)((function(e){return e.db})),a=Object(u.h)(),c=t.map((function(e,t){return Object(R.jsx)(d.a.Item,{index:t,as:s.b,to:e.path,header:0===t,disabled:!o,active:e.path===a.pathname,children:e.label},"item-"+t)}));return Object(R.jsxs)(d.a,{fixed:"top",inverted:!0,children:[c,Object(R.jsxs)(d.a.Menu,{position:"right",children:[Object(R.jsx)(G,{host:n,homepage:r}),Object(R.jsx)(M,{}),Object(R.jsx)(ee,{}),Object(R.jsx)(V,{homepage:r})]})]})})),ne=n(508),re=n(507),oe=n(103),ae=n(160),ce=n(15),ie=n(210),se=n.n(ie),ue=function(){function e(){Object(C.a)(this,e),this.idb=new oe.a("AmCAT_Annotator"),this.idb.version(1).stores({apis:"api",codingjobs:"job_id, name",documents:"doc_id, job_id"})}return Object(S.a)(e,[{key:"addToken",value:function(e,t){return this.idb.apis.put({api:e,token:t.token,refresh_token:t.refresh_token,expiration_date:t.expiration_date})}},{key:"deleteToken",value:function(e){return this.idb.apis.delete(e)}},{key:"getToken",value:function(e){return this.idb.apis.get(e)}},{key:"createCodingjob",value:function(e){var t=se()([e,Date.now().toString()]);return this.idb.codingjobs.add({job_id:t,name:e})}},{key:"deleteCodingjob",value:function(){var e=Object(f.a)(b.a.mark((function e(t){var n;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.listDocuments(t);case 2:return n=e.sent,e.next=5,this.deleteDocuments(n);case 5:return e.abrupt("return",this.idb.codingjobs.delete(t.job_id));case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"listCodingjobs",value:function(){return this.idb.codingjobs.toArray()}},{key:"getCodingjob",value:function(e){return this.idb.codingjobs.get("name").equals(e)}},{key:"createDocuments",value:function(){var e=Object(f.a)(b.a.mark((function e(t,n){var r,o,a,c;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=Set,e.next=3,this.idb.documents.where("job_id").equals(t.job_id).primaryKeys();case 3:return e.t1=e.sent,r=new e.t0(e.t1),o=0,a=n.reduce((function(e,n){var a=se()([n,t]);if(r.has(a))o++;else{if(r.add(a),n.annotations&&n.annotations.length>0){console.log(n.annotations);try{JSON.parse(n.annotations)}catch(c){throw alert("Annotations field contains invalid JSON"),new Error("JSON parse error")}}e.push(Object(ce.a)({doc_id:a,job_id:t.job_id},n))}return e}),[]),c="Created ".concat(n.length-o," new documents in codingjob ").concat(t.name,"."),o>0&&(c+=" Ignored ".concat(o," duplicates")),alert(c),e.abrupt("return",this.idb.documents.bulkAdd(a));case 11:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"deleteDocuments",value:function(e){var t=e.map((function(e){return e.doc_id}));return this.idb.documents.bulkDelete(t)}},{key:"listDocuments",value:function(e){return this.idb.documents.where("job_id").equals(e.job_id).toArray()}},{key:"getDocument",value:function(e){return this.idb.documents.get(e)}},{key:"writeValue",value:function(e,t,n){return this.idb.documents.where("doc_id").equals(e.doc_id).modify(Object(ae.a)({},t,n))}},{key:"deleteDB",value:function(){return this.idb.delete()}}]),e}(),le=n(516),de=n(517),je=function(e){var t=e.items,n=Object(l.b)(),r=Object(u.g)(),o=function(){var e=Object(f.a)(b.a.mark((function e(){var o;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,console.log("teeeeeeeeeeeeeeeeeest"),e.next=4,new ue;case 4:return o=e.sent,n(h(o)),e.next=8,q();case 8:r.push(t[0].path),e.next=13;break;case 11:e.prev=11,e.t0=e.catch(0);case 13:case"end":return e.stop()}}),e,null,[[0,11]])})));return function(){return e.apply(this,arguments)}}();return oe.a.exists("AmCAT_Annotator").then((function(e){e&&o()})),Object(R.jsx)(le.a,{inverted:!0,textAlign:"center",style:{height:"100vh"},verticalAlign:"middle",children:Object(R.jsx)(le.a.Column,{style:{maxWidth:450},children:Object(R.jsxs)(de.a,{style:{border:0},children:[Object(R.jsx)(w.a,{as:"h2",textAlign:"center",children:"Welcome to the AmCAT annotator"}),Object(R.jsx)("p",{children:"This is the (early development version of the) AmCAT annotator. The fact that you see this message means that you're either here for the first time, or your local annotation database was reset (by you or your browser)."}),Object(R.jsx)("p",{children:"The annotator stores your codingjobs and annotations on your local computer in your browser's IndexedDB. Your data will only actually touch the internet when you synchronize your data. Currently we've implemented syncronization with Dropbox. This way we have nothing to do with your data."}),Object(R.jsx)(k.a,{primary:!0,onClick:o,children:"Yes, off course I trust you"})]})})})},be=n(303),fe=function(e){var t=e.Component,n=e.homepage,r=Object(be.a)(e,["Component","homepage"]),o=Object(l.b)(),a=function(){var e=Object(f.a)(b.a.mark((function e(){var t;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new ue;case 2:t=e.sent,o(h(t));case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return oe.a.exists("AmCAT_Annotator").then((function(e){if(a(),!e)return Object(R.jsx)(u.a,{to:n})})),Object(R.jsx)(u.b,Object(ce.a)(Object(ce.a)({},r),{},{render:function(e){return Object(R.jsx)(t,Object(ce.a)(Object(ce.a)({},r),e))}}))},pe=n(132),he=n(131),Oe=n(295),xe=n(116),ge=n(104),ve=n(521),me=n(127),ye=n(211),we=n(522),ke=function(e){var t=e.columns,n=e.data,r=e.selectedRow,a=e.setSelectedRow,c=e.defaultSize,i=void 0===c?15:c,s=Object(o.useState)(r?r.ROW_ID:null),u=Object(p.a)(s,2),l=u[0],d=u[1],j=Object(he.useTable)({columns:t,data:n,initialState:{pageSize:i,globalFilter:""}},he.useGlobalFilter,he.useSortBy,he.usePagination),b=j.getTableProps,f=j.getTableBodyProps,h=j.headerGroups,O=j.prepareRow,x=j.page,g=j.pageCount,v=j.gotoPage,m=j.setPageSize,y=j.preGlobalFilteredRows,w=j.setGlobalFilter,k=j.state,C=k.pageIndex,S=k.globalFilter;Object(o.useEffect)((function(){d(r?r.ROW_ID:null)}),[r]);var E=function(e){var t=e.preGlobalFilteredRows,n=e.globalFilter,r=e.setGlobalFilter,o=t&&t.length;return Object(R.jsx)("span",{children:Object(R.jsx)("input",{value:n||"",onChange:function(e){r(e.target.value||void 0)},placeholder:"Search ".concat(o," records..."),style:{border:"0"}})})},T=function(e){return e.headers.map((function(e){return Object(R.jsxs)(Oe.a,Object(ce.a)(Object(ce.a)({className:e.headerClass},e.getHeaderProps(e.getSortByToggleProps())),{},{children:[e.render("Header"),Object(R.jsx)("span",{children:e.isSorted?e.isSortedDesc?" \ud83d\udd3d":" \ud83d\udd3c":""})]}))}))};return 0===n.length?null:Object(R.jsxs)(R.Fragment,{children:[Object(R.jsx)(E,{preGlobalFilteredRows:y,globalFilter:S,setGlobalFilter:w}),Object(R.jsxs)(ve.a,Object(ce.a)(Object(ce.a)({striped:!0,fixed:!0,singleLine:!0,selectable:!0},b()),{},{children:[Object(R.jsx)(me.a,{children:h.map((function(e){return Object(R.jsx)(xe.a,Object(ce.a)(Object(ce.a)({},e.getHeaderGroupProps()),{},{children:T(e)}))}))}),Object(R.jsx)(ye.a,Object(ce.a)(Object(ce.a)({},f()),{},{children:function(e){return e.map((function(e,t){return O(e),Object(R.jsx)(xe.a,Object(ce.a)(Object(ce.a)({active:!!l&&l===e.id,onClick:function(){return function(e){l&&l===e.id?(a(null),d(null)):(a(Object(ce.a)(Object(ce.a)({},n[e.id]),{},{ROW_ID:e.id})),d(e.id))}(e)}},e.getRowProps()),{},{children:e.cells.map((function(e){return Object(R.jsx)(ge.a,Object(ce.a)(Object(ce.a)({title:e.value},e.getCellProps()),{},{children:e.render("Cell")}))}))}))}))}(x)}))]})),Object(R.jsx)(pe.a,{text:"show per page",options:[10,25,50,100,500].map((function(e){return{value:e,text:e}})),onChange:function(e,t){m(t.value)}}),Object(R.jsx)("div",{style:{marginTop:"3em",display:"flex",justifyContent:"flex-end"},children:Object(R.jsx)(we.a,{style:{border:"0"},size:"mini",firstItem:!1,lastItem:!1,nextItem:!1,prevItem:!1,boundaryRange:1,ellipsisItem:{content:Object(R.jsx)(U.a,{name:"ellipsis horizontal"}),icon:!0},activePage:C+1,totalPages:g,onPageChange:function(e,t){v(t.activePage-1)}})})]})},Ce=n(510),Se=n(519),Ee=n(506),Te=function(){var e=Object(l.c)((function(e){return e.db})),t=Object(l.c)((function(e){return e.codingjobs})),n=Object(l.b)(),r=Object(o.useState)("inactive"),a=Object(p.a)(r,2),c=a[0],i=a[1],s=Object(o.useState)(""),u=Object(p.a)(s,2),d=u[0],j=u[1];return t?Object(R.jsxs)(y.a,{as:Ce.a,trigger:Object(R.jsxs)(k.a,{children:[Object(R.jsx)(U.a,{name:"plus"}),"Create job"]}),onSubmit:function(t){return t.preventDefault(),j(d.trim()),i("pending"),void e.createCodingjob(d).then((function(t){e&&e.listCodingjobs().then((function(e){n(x(null)),n(g(e))})),i("inactive")})).catch((function(e){console.log(e),i("error")}))},open:"inactive"!==c,onClose:function(){return i("inactive")},onOpen:function(){j(""),i("awaiting input")},size:"tiny",children:[Object(R.jsx)(w.a,{icon:"pencil",content:"Create new Codingjob",as:"h2"}),Object(R.jsx)(y.a.Content,{children:Object(R.jsx)(Ce.a.Group,{children:Object(R.jsx)(Ce.a.Input,{width:12,label:"Name",required:!0,type:"text",value:d,onChange:function(e,t){i("awaiting input"),j(t.value)},placeholder:"Enter name"})})}),Object(R.jsxs)(y.a.Actions,{children:["error"===c?Object(R.jsx)("div",{children:"Could not create codingjob for a reason not yet covered in the error handling..."}):null,"pending"===c?Object(R.jsx)(Se.a,{active:!0,inverted:!0,children:Object(R.jsx)(Ee.a,{content:"Creating codingjob"})}):Object(R.jsx)(k.a,{type:"submit",color:"green",icon:"save",content:"Create"})]})]}):null},De=function(){var e=Object(l.c)((function(e){return e.db})),t=Object(l.c)((function(e){return e.codingjob})),n=Object(l.b)(),r=Object(o.useState)("inactive"),a=Object(p.a)(r,2),c=a[0],i=a[1],s=function(r){i("pending"),e.deleteCodingjob(t).then((function(t){e&&e.listCodingjobs().then((function(e){n(x(null)),n(g(e))})),i("inactive")})).catch((function(e){console.log(e.message),console.log(e),i("error")}))};return t?Object(R.jsxs)(y.a,{closeIcon:!0,open:"inactive"!==c,trigger:Object(R.jsxs)(k.a,{name:"logout",children:[Object(R.jsx)(U.a,{name:"minus"})," Delete job"]}),onClose:function(){i("inactive")},onOpen:function(){i("awaiting input")},children:[Object(R.jsx)(w.a,{icon:"trash",content:"Delete codingjob ".concat(t.name)}),Object(R.jsx)(y.a.Content,{children:Object(R.jsx)("p",{children:"Do you really want to delete this codingjob?"})}),Object(R.jsxs)(y.a.Actions,{children:["error"===c?Object(R.jsx)("div",{children:"Could not delete codingjob for a reason not yet covered in the error handling..."}):null,"pending"===c?Object(R.jsx)(Se.a,{active:!0,inverted:!0,children:Object(R.jsx)(Ee.a,{content:"Creating codingjob"})}):Object(R.jsxs)(R.Fragment,{children:[Object(R.jsxs)(k.a,{color:"red",onClick:s,children:[Object(R.jsx)(U.a,{name:"remove"})," No"]}),Object(R.jsxs)(k.a,{color:"green",onClick:s,children:[Object(R.jsx)(U.a,{name:"checkmark"})," Yes"]})]})]})]}):null},_e=function(e){var t,n=e.type,r=void 0===n?"table":n,a=Object(l.c)((function(e){return e.db})),c=Object(l.c)((function(e){return e.codingjobs})),i=Object(l.c)((function(e){return e.codingjob})),s=Object(l.b)(),u=Object(o.useState)(i),d=Object(p.a)(u,2),j=d[0],b=d[1];if(Object(o.useEffect)((function(){console.log("a"),console.log(j),s(x(j))}),[j,s]),Object(o.useEffect)((function(){a&&(i?a.listDocuments(i).then((function(e){s(v(e))})).catch((function(e){console.log(e)})):(b(null),s(v([]))))}),[a,i,s]),Object(o.useEffect)((function(){a&&null===c&&a.listCodingjobs().then((function(e){s(g(e)),e.length>0&&b(Object(ce.a)(Object(ce.a)({},e[0]),{},{ROW_ID:"0"}))}))}),[a,c,s]),"table"===r){return Object(R.jsxs)(de.a,{style:{border:"0"},children:[Object(R.jsxs)(k.a.Group,{widths:"2",children:[Object(R.jsx)(Te,{}),Object(R.jsx)(De,{})]}),Object(R.jsx)(re.a,{style:{marginTop:"30px"},children:Object(R.jsx)(ke,{columns:[{Header:"Select Index",accessor:"name",headerClass:"thirteen wide"}],data:c||[],selectedRow:j,setSelectedRow:b,defaultSize:15})})]})}if("dropdown"===r){return Object(R.jsx)(pe.a,{clearable:!0,selection:!0,options:(t=c,t.map((function(e){return{key:e.name,text:e.name,value:e.name}}))),value:i?i.name:null,onChange:function(e,t){return function(e){if(e&&null!==c){var t=c.findIndex((function(t){return t.name===e}));b(Object(ce.a)(Object(ce.a)({},c[t]),{},{ROW_ID:t.toString()}))}else b(null)}(t.value)}})}return null},Ae=[{Header:"title",accessor:"title",headerClass:"six wide"},{Header:"text",accessor:"text",headerClass:"four wide"},{Header:"annotations",accessor:"annotations",headerClass:"four wide"},{Header:"meta",accessor:"meta",headerClass:"four wide"}],Ne=function(){var e=Object(l.c)((function(e){return e.codingjob})),t=Object(l.c)((function(e){return e.document})),n=Object(l.c)((function(e){return e.documents})),r=Object(l.b)(),a=Object(o.useState)(t),c=Object(p.a)(a,2),i=c[0],s=c[1];return Object(o.useEffect)((function(){r(function(e){return{type:"SELECT_ARTICLE",payload:e}}(i))}),[i,r]),e?Object(R.jsx)(ke,{columns:Ae,data:n,selectedRow:i,setSelectedRow:s,defaultSize:15}):null},Re=function(){return Object(R.jsx)(re.a,{style:{marginTop:"2em"},children:Object(R.jsx)(Ne,{})})},Ie=n(505),Fe=n(296),Be=function(e){var t=e.data,n=e.codingjob,r=e.fileRef,a=Object(l.c)((function(e){return e.db})),c=Object(o.useState)([]),i=Object(p.a)(c,2),s=i[0],u=i[1],d=Object(o.useState)(null),j=Object(p.a)(d,2),h=j[0],O=j[1],x=Object(o.useState)(null),g=Object(p.a)(x,2),m=g[0],y=g[1],w=Object(o.useState)(null),C=Object(p.a)(w,2),S=C[0],E=C[1],T=Object(l.b)();Object(o.useEffect)((function(){if(t.length<=1)return O(null),y(null),E(null),void u([]);u(t[0].data.map((function(e){return{key:e,value:e,text:e}}))),O(t[0].data.includes("title")?"title":null),y(t[0].data.includes("text")?"text":null),E(t[0].data.includes("annotations")?"annotations":null)}),[t]);var D=function(e,t,n,r){var o=e[0].data;return e.slice(1).map((function(e){var a=e.data.reduce((function(e,a,c){var i=o[c];return i===t?e.title=a:i===n?e.text=a:i===r?e.annotations=a:e.meta[i]=a,e}),{meta:{},annotations:""});return a.meta=JSON.stringify(a.meta,null,2),a}))},_=function(){var e=Object(f.a)(b.a.mark((function e(){var o,c;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,o=D(t,h,m,S),e.next=4,a.createDocuments(n,o);case 4:return e.next=6,a.listDocuments(n);case 6:return c=e.sent,e.next=9,T(v(c));case 9:r.current.removeFile(),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(0),console.log(e.t0);case 15:case"end":return e.stop()}}),e,null,[[0,12]])})));return function(){return e.apply(this,arguments)}}();return t.length<=1?null:Object(R.jsx)(R.Fragment,{children:Object(R.jsxs)(Ce.a,{children:[Object(R.jsxs)(Ce.a.Group,{children:[Object(R.jsx)(Ce.a.Field,{control:Ie.a,placeholder:"title column",options:s,value:h,onChange:function(e,t){return O(t.value)}}),Object(R.jsx)(Ce.a.Field,{control:Ie.a,placeholder:"text column",options:s,value:m,onChange:function(e,t){return y(t.value)}})]}),Object(R.jsxs)(Ce.a.Group,{children:[Object(R.jsx)(Ce.a.Field,{control:Ie.a,clearable:!0,placeholder:"annotations (optional)",options:s,value:S,onChange:function(e,t){return E(t.value)}}),Object(R.jsxs)(Ce.a.Field,{control:k.a,fluid:!0,onClick:_,disabled:!h||!m,children:[Object(R.jsx)(U.a,{name:"upload"}),"Upload"]})]})]})})},Pe=function(e){var t=e.data,n=function(e){return e.map((function(e){return Object(R.jsx)(ve.a.Cell,{children:Object(R.jsx)("span",{title:e,children:e})})}))};return t.length<=1?null:Object(R.jsxs)(re.a,{style:{marginTop:"2em"},children:[Object(R.jsxs)(ve.a,{fixed:!0,singleLine:!0,basic:"very",children:[Object(R.jsx)(ve.a.Header,{children:Object(R.jsx)(ve.a.Row,{children:function(e){return e[0].data.map((function(e){return Object(R.jsx)(ve.a.HeaderCell,{children:Object(R.jsx)("span",{title:e,children:e})})}))}(t)})}),Object(R.jsx)(ve.a.Body,{children:function(e,t){return e.slice(0,t+1).slice(1).map((function(e){return Object(R.jsx)(ve.a.Row,{children:n(e.data)})}))}(t,5)})]}),t.length>5?Object(R.jsxs)(w.a,{align:"center",children:[t.length-1-5," more rows"]}):null]})},Ge=function(e){e.setActive;var t=Object(l.c)((function(e){return e.codingjob})),n=Object(o.useState)([]),r=Object(p.a)(n,2),a=r[0],c=r[1],i=Object(o.useRef)();return t?Object(R.jsxs)(le.a,{stackable:!0,style:{marginTop:"4.3em"},children:[Object(R.jsxs)(le.a.Row,{children:[Object(R.jsxs)(le.a.Column,{floated:"right",width:4,children:[" ",Object(R.jsx)(Fe.a,{ref:i,onFileLoad:function(e){return c(e)},addRemoveButton:!0,onRemoveFile:function(){return c([])},children:Object(R.jsx)("span",{children:"Click to upload"})})]}),Object(R.jsx)(le.a.Column,{floated:"right",width:10,children:Object(R.jsx)(Be,{data:a,codingjob:t,fileRef:i})})]}),Object(R.jsx)(le.a.Row,{children:Object(R.jsx)(le.a.Column,{children:Object(R.jsx)(Pe,{data:a})})})]}):null},Le=n(302),Je=(n(484),function(e){var t=e.fields,n=e.fieldValues,r=e.setFieldValues,o=function(e,t){var o=Object(ce.a)({},n);o[e]=t,r(o)};return t?Object.keys(t).map((function(e){return"text"===t[e]?Object(R.jsx)(Ce.a.TextArea,{value:n[e]?n[e]:"",onChange:function(t,n){return o(e,n.value)},label:e},e):"date"===t[e]?Object(R.jsx)(Ce.a.Field,{children:Object(R.jsx)(Le.a,{label:e,value:n[e]?n[e]:"",onChange:function(t,n){return o(e,n.value)}},e)}):"keyword"===t[e]?Object(R.jsxs)(Ce.a.Field,{children:[Object(R.jsx)("label",{children:e}),Object(R.jsx)("input",{value:n[e]?n[e]:"",onChange:function(t){return o(e,t.target.value)}})]},e):null})):null}),ze=function(){var e=Object(l.c)((function(e){return e.db})),t=Object(l.c)((function(e){return e.codingjob})),n=Object(l.b)(),r=Object(o.useState)({}),a=Object(p.a)(r,2),c=a[0],i=a[1],s=function(){var r=Object(f.a)(b.a.mark((function r(){var o,a,s,u,l;return b.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:for(o=Object(ce.a)({},c),a=0,s=Object.keys(o);a<s.length;a++)("date"===(u=s[a])||/_date$/.test(u))&&(o[u]=o[u].toISOString());return r.prev=2,r.next=5,e.createDocuments(t,[o]);case 5:return r.next=7,e.listDocuments(t);case 7:return l=r.sent,r.next=10,n(v(l));case 10:i({}),r.next=16;break;case 13:r.prev=13,r.t0=r.catch(2),console.log(r.t0);case 16:case"end":return r.stop()}}),r,null,[[2,13]])})));return function(){return r.apply(this,arguments)}}();return t?Object(R.jsxs)(Ce.a,{style:{marginTop:"3em"},children:[Object(R.jsx)(Je,{fields:{title:"text",text:"text",annotations:"text"},fieldValues:c,setFieldValues:i}),t?Object(R.jsx)(k.a,{primary:!0,onClick:s,children:"Create document"}):null]}):null},He=function(){var e=Object(o.useState)("details"),t=Object(p.a)(e,2),n=t[0],r=t[1];return Object(R.jsxs)(le.a,{stackable:!0,style:{marginTop:"3em"},children:[Object(R.jsx)(le.a.Column,{floated:"left",width:5,children:Object(R.jsx)(_e,{type:"table"})}),Object(R.jsx)(le.a.Column,{width:11,children:Object(R.jsxs)(de.a,{style:{border:0},children:[Object(R.jsxs)(d.a,{pointing:!0,secondary:!0,children:[Object(R.jsx)(d.a.Item,{name:"details",active:"details"===n,onClick:function(e,t){return r(t.name)}}),Object(R.jsx)(d.a.Item,{name:"upload",active:"upload"===n,onClick:function(e,t){return r(t.name)}}),Object(R.jsx)(d.a.Item,{name:"create",active:"create"===n,onClick:function(e,t){return r(t.name)}})]}),function(e){switch(e){case"details":return Object(R.jsx)(Re,{});case"upload":return Object(R.jsx)(Ge,{});case"create":return Object(R.jsx)(ze,{});default:return null}}(n)]})})]})},Me=n(175),Ue=function(){var e=Object(f.a)(b.a.mark((function e(t,n,r){var o,a;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=new Set,a=Object.values(r).reduce((function(e,t){for(var n=0,r=Object.keys(t);n<r.length;n++){var a=r[n],c={code:a,offset:t[a].offset,length:t[a].length},i=JSON.stringify(c);o.has(i)||(o.add(i),e.push(c))}return e}),[]),e.next=4,t.writeValue({doc_id:n.doc_id},"annotations",JSON.stringify(a,null,2));case 4:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),Ve=function(e,t,n){var r,o={},a=[],c=Object(Me.a)(e);try{for(c.s();!(r=c.n()).done;){var i=r.value;qe(i,t,o,a)}}catch(l){c.e(l)}finally{c.f()}for(var s=0,u=a;s<u.length;s++){Ye(u[s],n)}},qe=function(e,t,n,r){for(var o=e.offset.start,a=e.offset.start+e.offset.length,c=o;c<=a;c++)if(t[c]){var i,s=Object(Me.a)(t[c].start);try{for(s.s();!(i=s.n()).done;){var u=i.value;n[u]={index:e.offset.index,group:u,offset:o,length:null,span:[e.offset.index]}}}catch(b){s.e(b)}finally{s.f()}var l,d=Object(Me.a)(t[c].end);try{for(d.s();!(l=d.n()).done;){var j=l.value;n[j].span.push(e.offset.index),n[j].length=e.offset.start+e.offset.length-n[j].offset,r.push(n[j]),delete n[j]}}catch(b){d.e(b)}finally{d.f()}}},Ye=function(e,t){for(var n=[],r=e.span[0];r<=e.span[1];r++){var o=Object(ce.a)({},e);o.index=r,n.push(o)}t(m(n))},Ke=function(e){var t=e.tokens,n=e.doc,r=Object(l.c)((function(e){return e.db})),a=Object(l.c)((function(e){return e.spanAnnotations})),c=Object(o.useState)(!1),i=Object(p.a)(c,2),s=i[0],u=i[1],d=Object(l.b)();return Object(o.useEffect)((function(){u(!1)}),[n]),Object(o.useEffect)((function(){t&&n.annotations&&(Ve(t,n.annotations,d),u(!0))}),[t,n,d]),Object(o.useEffect)((function(){s&&Ue(r,n,a)}),[s,r,n,a]),Object(R.jsx)("div",{})},We=(n(485),n(301)),Xe=n(509),Ze=n(513),$e=n(515),Qe=n(299),et=n.n(Qe),tt=function(e){var t=e.index,n=e.children,r=Object(l.c)((function(e){return e.codes})),a=Object(l.c)((function(e){return e.codeHistory})),c=Object(l.c)((function(e){return e.spanAnnotations})),i=Object(o.useRef)(null),s=Object(o.useState)(null),u=Object(p.a)(s,2),d=u[0],j=u[1],b=!0,f=Object(l.b)();Object(o.useEffect)((function(){var e=c[t];e&&void 0!==e&&(Object.keys(e).includes("Not yet assigned")?j("Not yet assigned"):j(Object.keys(e)[0]))}),[t,c]);var h=function(e){e?window.addEventListener("keydown",O):window.removeEventListener("keydown",O)},O=function(e){i.current&&i.current.click()},x=function(e,t){var n=t.find((function(t){return t.value===e}));return n?n.color:"lightgrey"},g=function(e){var n=d,r=c[t];if(!r)return null;var o={index:r[n].index,group:n,offset:r[n].offset,length:r[n].length,span:r[n].span},a=Object(ce.a)({},o);if(a.span=[a.index,a.index],f({type:"RM_ANNOTATIONS",payload:[a]}),e===n)return null;for(var i=[],s=o.span[0];s<=o.span[1];s++){var u=Object(ce.a)({},o);u.group=e,u.index=s,i.push(u)}f(m(i)),f(function(e){return{type:"APPEND_CODE_HISTORY",payload:{code:e,n:arguments.length>1&&void 0!==arguments[1]?arguments[1]:5}}}(e)),Object.keys(r).includes(null)?j(null):j(e)},v=function(e){var t=e;return e&&"null"!==e||(t="Not yet assigned"),{key:t,text:t,value:t}};return Object(R.jsx)(Xe.a,{trigger:n,on:"hover",flowing:!0,hoverable:!0,wide:!0,onOpen:function(){return h(!0)},onClose:function(){return h(!1)},position:"top left",children:Object(R.jsx)("div",{children:Object(R.jsxs)(Ze.a.Group,{vertical:!0,children:[Object(R.jsx)(Ze.a,{active:!0,children:Object(R.jsxs)(Ze.a.Content,{children:[Object(R.jsx)(Ze.a.Title,{children:"Current code"}),Object(R.jsx)(Ze.a.Description,{children:Object(R.jsxs)(k.a.Group,{children:[Object(R.jsx)(k.a,{icon:"trash",size:"mini",onClick:function(e,t){return g(d)}}),Object(R.jsx)(k.a,{style:{backgroundColor:x(d,r)},children:Object(R.jsx)(pe.a,{text:d,options:function(){var e=c[t];return e?Object.keys(e).filter((function(e){return e!==d})).map(v):[v(null)]}(),value:d,onChange:function(e,t){return j(t.value)}})})]})})]})}),Object(R.jsx)(Ze.a,{children:Object(R.jsxs)(Ze.a.Content,{children:[Object(R.jsx)(Ze.a.Title,{children:"Set new code"}),Object(R.jsxs)(Ze.a.Description,{children:[Object(R.jsx)(k.a.Group,{vertical:!0,compact:!0,widths:"1",children:a.filter((function(e){return e!==d&&"Not yet assigned"!==e})).map((function(e){return Object(R.jsx)(k.a,{style:{backgroundColor:x(e,r)},value:e,onClick:function(e,t){return g(t.value)},children:e},e)}))}),"\xa0\xa0",Object(R.jsx)($e.a,{innerRef:i,children:Object(R.jsx)(pe.a,{compact:!0,options:r,placeholder:b?"Search or create ":"Search ",widths:1,search:!0,selection:!0,allowAdditions:b,additionPosition:"bottom",onAddItem:function(e,t){f(function(e){return{type:"SET_CODES",payload:e}}([{key:t.value,text:t.value,value:t.value,color:et()({seed:t.value,luminosity:"bright"})}].concat(Object(We.a)(r))))},selectOnNavigation:!1,minCharacters:0,autoComplete:"on",searchInput:{autoFocus:!1},onChange:function(e,t){return g(t.value)}})})]})]})})]})})})},nt=function(e){var t=e.token;return Object(R.jsx)("span",{className:"token",tokenindex:t.offset.index,tokenoffset:t.offset.start,tokenlength:t.offset.length,children:Object(R.jsx)(rt,{token:t})})},rt=a.a.memo((function(e){var t=e.token,n=Object(l.c)((function(e){return e.spanAnnotations[t.offset.index]})),r=Object(l.c)((function(e){return e.codes}));if(Object(l.c)((function(e){return JSON.stringify(e.spanAnnotations[t.offset.index])})),!n)return Object(R.jsx)(R.Fragment,{children:t.pre+t.text+t.post});var o=function(e,t){var n=t.find((function(t){return t.value===e}));return n?n.color:"lightgrey"},a=Object.keys(n),c=null;if(1===a.length)c=o(a[0],r);else{var i=a.map((function(e){return o(e,r)}));c="linear-gradient(".concat(i.join(", "),")")}var s=!Object.values(n).some((function(e){return e.span[0]!==e.index})),u=!Object.values(n).some((function(e){return e.span[1]!==e.index})),d="TextCodeBubble";return s&&(d+=" allLeft"),Object.values(n).some((function(e){return e.span[0]===e.index}))&!s&&(d+=" anyLeft"),u&&(d+=" allRight"),Object.values(n).some((function(e){return e.span[1]===e.index}))&!u&&(d+=" anyRight"),Object(R.jsxs)(R.Fragment,{children:[s?t.pre:null,Object(R.jsx)(tt,{index:t.offset.index,children:Object(R.jsxs)("span",{className:d,style:{background:c},children:[s&&u?t.text:null,s&&!u?t.text+t.post:null,u&&!s?t.pre+t.text:null,s||u?null:t.pre+t.text+t.post]})}),u?t.post:null]})})),ot=a.a.memo(nt),at=n(216),ct=n(300);at.a.extend(ct.a);var it=function(e){var t=e.text,n=e.setTokens,r=Object(o.useState)(null),a=Object(p.a)(r,2),c=a[0],i=a[1];return Object(o.useEffect)((function(){var e=st(t),r=Object(p.a)(e,2),o=r[0],a=r[1];i(o),n(a)}),[t,n]),null===t?null:Object(R.jsx)(re.a,{text:!0,children:c})},st=function(e){var t=[];return[at.a.tokenize(e).paragraphs().json({offset:!0}).map((function(e,n){return ut(e,n,t)})),t]},ut=function(e,t,n){var r=function(e){return e.sentences.map((function(e){return e.map((function(e){return lt(e,n)}))}))};return Object(R.jsx)("span",{style:{marginTop:"1em",display:"table"},children:0===t?Object(R.jsx)("h2",{children:r(e)}):r(e)},t)},lt=function(e,t){return Object(R.jsx)("span",{className:"sentence",children:function(e){return e.terms.map((function(e){return t.push(e),Object(R.jsx)(ot,{token:e},e.offset.index)}))}(e)},e.offset.index)},dt=a.a.memo(it),jt=function(e){return{index:parseInt(e.getAttribute("tokenindex")),offset:parseInt(e.getAttribute("tokenoffset")),length:parseInt(e.getAttribute("tokenlength"))}},bt=function(e){return console.log(e),"token"===e.className?jt(e):e.parentNode&&"token"===e.parentNode.className?jt(e.parentNode):null},ft=function(e){var t=e.doc,n=Object(l.c)((function(e){return e.codeHistory})),r=Object(o.useState)([]),a=Object(p.a)(r,2),c=a[0],i=a[1],s=Object(l.b)();Object(o.useEffect)((function(){s({type:"CLEAR_SPAN_ANNOTATIONS"})}),[t,s]),Object(o.useEffect)((function(){return window.addEventListener("keydown",u),function(){window.removeEventListener("keydown",u)}})),Object(o.useEffect)((function(){return window.addEventListener("mouseup",d),function(){window.removeEventListener("mouseup",d)}}));var u=function(e){console.log(e.key)},d=function(e){if(1!==e.which)return null;e.preventDefault();var t=window.getSelection();if(!t.anchorNode||!t.focusNode)return null;var r=bt(t.anchorNode.parentElement),o=bt(t.focusNode.parentElement);if(!r||!o)return null;if(window.getSelection().empty(),r.index>o.index){var a=[o,r];r=a[0],o=a[1]}var c=n[0]?n[0]:null;e.ctrlKey||(c="Not yet assigned");for(var i=[],u=r.index;u<=o.index;u++)i.push({index:u,group:c,offset:r.offset,length:o.offset+o.length-r.offset,span:[r.index,o.index]});s(m(i))};return t?Object(R.jsxs)(R.Fragment,{children:[Object(R.jsx)(dt,{text:t.text,setTokens:i}),Object(R.jsx)(Ke,{tokens:c,doc:t})]}):null},pt="/amcat4annotator",ht=[{label:"Create",path:pt+"/create",Component:He},{label:"Annotate",path:pt+"/annotate",Component:function(){var e=Object(l.c)((function(e){return e.db})),t=Object(l.c)((function(e){return e.codingjob})),n=Object(o.useState)(null),r=Object(p.a)(n,2),a=r[0],c=r[1],i=Object(o.useState)([]),s=Object(p.a)(i,2),u=s[0],d=s[1];Object(o.useEffect)((function(){e&&t&&e.listDocuments(t).then((function(e){d(e)})).catch((function(e){console.log(e)}))}),[e,t]);var j=function(){var t=Object(f.a)(b.a.mark((function t(n){var r;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.getDocument(n);case 2:r=t.sent,c({doc_id:r.doc_id,text:r.title+"\n\n"+r.text,annotations:(o=r.annotations,o&&""!==o?JSON.parse(o).reduce((function(e,t){return e[t.offset]||(e[t.offset]={start:[],end:[]}),e[t.offset+t.length]||(e[t.offset+t.length]={start:[],end:[]}),e[t.offset].start.push(t.code),e[t.offset+t.length].end.push(t.code),e}),{}):{})});case 4:case"end":return t.stop()}var o}),t)})));return function(e){return t.apply(this,arguments)}}();return Object(R.jsx)(R.Fragment,{children:Object(R.jsxs)(le.a,{children:[Object(R.jsxs)(le.a.Row,{children:[Object(R.jsx)(_e,{type:"dropdown"}),Object(R.jsx)(pe.a,{selection:!0,onChange:function(e,t){j(t.value)},options:function(e){return e.map((function(e,t){return{key:t,text:e.title,value:e.doc_id}}))}(u)})]}),Object(R.jsxs)(le.a.Row,{children:[Object(R.jsx)(le.a.Column,{width:12,children:Object(R.jsx)(ft,{doc:a||null})}),Object(R.jsx)(le.a.Column,{width:4,children:Object(R.jsx)(tt,{})})]})]})})}}],Ot=function(){var e;return Object(R.jsxs)(s.a,{children:[Object(R.jsx)(te,{items:ht,host:"https://ccs-amsterdam.github.io",homepage:pt}),Object(R.jsx)(ne.a,{}),Object(R.jsx)(re.a,{style:{marginTop:"3em"},children:Object(R.jsxs)(u.d,{children:[Object(R.jsx)(u.b,{exact:!0,path:pt,render:function(){return Object(R.jsx)(je,{items:ht})}}),(e=ht,e.map((function(e){return Object(R.jsx)(fe,{path:e.path,homepage:pt,Component:e.Component},e.path)})))]})})]})},xt=n(92),gt=function(e,t,n){for(var r in t){var o=t[r];if(e[o.index]&&e[o.index][o.group]){for(var a=e[o.index][o.group].span,c=a[0];c<=a[1];c++)e[c]&&e[c][o.group]&&(delete e[c][o.group],0===Object.keys(e[c]).length&&delete e[c]);if(o.span[0]===o.span[1])continue}n||(e[o.index]||(e[o.index]={}),e[o.index][o.group]={index:o.index,span:[o.span[0],o.span[1]],offset:o.offset,length:o.length})}return e},vt=[{key:"Mark Rutte",text:"Mark Rutte",value:"Mark Rutte",color:"#40a31f"},{key:"Sigrid Kaag",text:"Sigrid Kaag",value:"Sigrid Kaag",color:"#f2db5c"}],mt=Object(xt.b)({db:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_DB":return t.payload;case"RESET_DB":return null;default:return e}},dropbox:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_DROPBOX":return console.log("set dropbox"),t.payload;case"RESET_DB":return null;default:return e}},codingjob:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SELECT_CODINGJOB":return t.payload;case"RESET_DB":return null;default:return e}},codingjobs:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_CODINGJOBS":return t.payload;case"RESET_DB":return null;default:return e}},document:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SELECT_DOCUMENT":return t.payload;case"RESET_DB":return[];default:return e}},documents:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_DOCUMENTS":return t.payload;case"RESET_DB":return[];default:return e}},tokenIndices:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_TOKEN_INDICES":return t.payload;case"RESET_DB":return null;default:return e}},spanAnnotations:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"TOGGLE_ANNOTATIONS":return gt(Object(ce.a)({},e),t.payload,!1);case"RM_ANNOTATIONS":return gt(Object(ce.a)({},e),t.payload);case"CLEAR_SPAN_ANNOTATIONS":case"RESET_DB":return{};default:return e}},codes:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:vt,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_CODES":return t.payload;case"RESET_DB":return[];default:return e}},codeHistory:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"APPEND_CODE_HISTORY":var n=e.filter((function(e){return e!==t.payload.code})).slice(0,t.payload.n-1);return n.unshift(t.payload.code),n;case"RESET_DB":return[];default:return e}}}),yt=Object(xt.c)(mt);i.a.render(Object(R.jsx)(a.a.StrictMode,{children:Object(R.jsx)(l.a,{store:yt,children:Object(R.jsx)(Ot,{})})}),document.querySelector("#root"))}},[[486,1,2]]]);
//# sourceMappingURL=main.b5955f50.chunk.js.map