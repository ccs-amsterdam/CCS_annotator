{"version":3,"sources":["../node_modules/react-semantic-ui-datepickers/dist/locales sync /^/.//.*/.json$","apis/dexie.js","components/Download.js","actions/index.js","components/Reset.js","apis/storemanager.js","components/Persist.js","components/HeaderMenu.js","apis/demodata.js","components/Welcome.js","components/AuthRoute.js","components/SelectionTable.js","components/CreateCodingjob.js","components/DeleteCodingjob.js","components/CodingjobSelector.js","components/DocumentTable.js","components/JobDetails.js","components/UploadDocuments.js","components/UploadRaw.js","components/CodeBook.js","components/CodingJobs.js","components/SpanAnnotations.js","components/SpanAnnotationsDB.js","components/CodeSelector.js","components/Token.js","components/Tokens.js","components/AnnotationText.js","components/Annotate.js","App.js","reducers/index.js","index.js"],"names":["map","webpackContext","req","id","webpackContextResolve","__webpack_require__","o","e","Error","code","keys","Object","resolve","module","exports","db","this","idb","Dexie","version","stores","meta","apis","codingjobs","documents","a","isWelcome","add","welcome","get","api","token","put","refresh_token","expiration_date","delete","name","job_id","hash","Date","now","toString","codingjob","where","equals","toArray","test","codebook","modify","JSON","stringify","codes","getCodingjob","cj","console","log","parse","writeCodebook","documentList","silent","Set","primaryKeys","ids","duplicates","preparedDocuments","reduce","result","document","doc_id","has","annotations","length","alert","push","message","bulkAdd","documentIds","bulkDelete","offset","limit","count","ndocs","clear","progressCallback","totalRows","completedRows","Download","useState","open","setOpen","onDownload","exportDB","filter","table","value","key","prettyJson","blob","fileDownload","error","Modal","closeIcon","trigger","Menu","Item","icon","style","color","onClose","onOpen","Header","content","Content","Actions","Button","primary","onClick","blockEvents","block","type","payload","selectCodingjob","setCodingjobs","setCurrentToken","index","setTokenSelection","triggerCodeselector","from","tokenIndex","toggleAnnotations","spanAnnotation","setCodes","appendCodeHistory","n","Reset","homepage","dispatch","useDispatch","history","useHistory","deleteDB","Icon","initStoragePersistence","tryPersistWithoutPromtingUser","persist","navigator","storage","undefined","isStoragePersisted","persisted","permissions","query","permission","state","Persist","setPersisted","useEffect","then","withRouter","items","location","useLocation","menuItems","item","as","Link","to","path","header","disabled","active","pathname","label","fixed","inverted","position","demo_codebook","settings","canAddCodes","demo_articles","title","text","create_demo_job","createCodingjob","job","createDocuments","Welcome","loggin","addDemo","checkWelcome","Grid","textAlign","height","verticalAlign","Column","maxWidth","Segment","border","AuthRoute","Component","componentProps","loading","setLoading","hasdb","setHasdb","connect","render","props","GlobalFilter","preGlobalFilteredRows","globalFilter","setGlobalFilter","onChange","target","placeholder","SelectionTable","columns","data","selectedRow","setSelectedRow","width","defaultSize","ROW_ID","activeRow","setActiveRow","useTable","initialState","pageSize","useGlobalFilter","useSortBy","usePagination","getTableProps","getTableBodyProps","headerGroups","prepareRow","page","pageCount","gotoPage","pageIndex","createHeader","headerGroup","headers","column","TableHeaderCell","className","headerClass","getHeaderProps","getSortByToggleProps","isSorted","isSortedDesc","Table","compact","unstackable","singleLine","selectable","TableHeader","TableRow","getHeaderGroupProps","TableBody","row","i","onRowSelect","getRowProps","cells","cell","TableCell","getCellProps","createBody","Footer","Row","HeaderCell","colSpan","Pagination","floated","size","firstItem","lastItem","nextItem","prevItem","boundaryRange","ellipsisItem","activePage","totalPages","onPageChange","event","CreateCodingjob","useSelector","status","setStatus","codingjobName","setCodingjobName","onSubmit","preventDefault","trim","listCodingjobs","Form","Group","Input","required","d","Dimmer","Loader","DeleteCodingjob","deleteCodingjob","setCodingjob","getCodingjobs","setSelectedCodingjob","cjs","CodingjobSelector","indices","selectedCodingjob","widths","Container","marginTop","overflow","accessor","Dropdown","inline","search","options","findIndex","onDropdownSelect","COLUMNS","fetchFromDb","setPages","setData","getJobDocumentCount","Math","ceil","newdata","getJobDocumentsBatch","shortString","string","slice","DocumentTable","pages","createRowCells","rowObj","Cell","pageChange","celled","colname","Body","createBodyRows","siblingRange","pointing","secondary","defaultActivePage","JobDetails","UploadCsv","setActive","fileRef","useRef","stackable","ref","onFileLoad","addRemoveButton","onRemoveFile","SubmitForm","setOptions","titleField","setTitleField","textField","setTextField","annotationsField","setAnnotationsField","includes","csvToJson","datarow","obj","uploadData","preparedData","current","removeFile","Field","control","Select","clearable","fluid","PreviewTable","basic","createRows","align","DocumentForms","fields","fieldValues","setFieldValues","newFieldValues","TextArea","UploadRaw","onCreate","submitData","toISOString","CodeBook","selectedCode","setSelectedCode","activeIndex","setActiveIndex","cb","handleClick","titleProps","Accordion","Title","Label","CodingJobs","activeItem","setActiveItem","renderSwitch","arrowkeys","annotationFromSelection","tokens","selection","group","start","span","movePosition","mover","ctrl","newPosition","moveSentence","ntokens","scrollIntoView","next","direction","getBoundingClientRect","startposition","y","x","getTokenAttributes","tokenNode","tokenindex","parseInt","getAttribute","getToken","parentNode","SpanAnnotations","doc","currentToken","tokenSelection","eventsBlocked","holdMouseLeft","setHoldMouseLeft","setMover","holdCtrl","setHoldCtrl","holdArrow","setHoldArrow","window","addEventListener","onMouseDown","onMouseMove","onMouseUp","onContextMenu","removeEventListener","onKeyUp","useCallback","onKeyDown","repeat","counter","keyCode","delay","max","setTimeout","which","storeMouseSelection","currentNode","getSelection","empty","button","stopPropagation","originalTarget","exportAnnotations","unique","uniqueAnnotations","values","un_ann","ann","ann_obj","json","writeAnnotations","matchAnnotations","importedAnnotations","trackAnnotations","matchedAnnotations","findMatches","codeCounter","matchedAnnotation","addAnnotations","topCodes","sort","b","end","newAnnotations","newAnnotation","SpanAnnotationsDB","spanAnnotations","ready","setReady","arrowKeys","CodeSelector","React","memo","children","csTrigger","codingjobSettings","codeHistory","textInputRef","setCurrent","hasOpened","setHasOpened","popupPage","setPopupPage","selectedCodeButton","setSelectedCodeButton","nButtons","setNButtons","onKeydown","activeElement","click","codebuttons","updateAnnotations","Popup","flowing","hoverable","wide","mouseLeaveDelay","annotationCodes","backgroundColor","getColor","onMouseOver","display","Ref","innerRef","marginLeft","minWidth","selectOnNavigation","minCharacters","autoComplete","additionPosition","allowAdditions","additionLabel","onAddItem","addCode","createPopupPage","CodeButtons","codeHistoryValid","find","newcodes","writeCodes","annotation","oldAnnotation","tokenCode","codematch","Token","forwardRef","selected","tokenClass","AnnotatedToken","codeSelectorTrigger","pre","post","tokenSpan","annotatedTokenClass","background","allLeft","allRight","tokenCodes","colors","join","some","anyLeft","anyRight","nlp","extend","paragraphs","Tokens","setTokens","tokenComponents","setTokenComponents","prepareTokens","tokenize","par","par_i","createParagraph","mapSentences","sentences","sent","sent2","createSentence","terms","createRef","mapTokens","AnnotationText","documentPagination","nDocuments","setupCodingjob","setDoc","setNDocuments","documentSelector","docs","prepareAnnotations","setActivePage","setCodingjobSettings","Breadcrumb","BreadcrumbSection","link","Divider","App","exact","toggleSelection","annList","rm","rootReducer","combineReducers","action","tokenIndices","randomColor","seed","luminosity","newstate","v","unshift","store","createStore","ReactDOM","StrictMode","querySelector"],"mappings":"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","file":"static/js/main.56d53dc6.chunk.js","sourcesContent":["var map = {\n\t\"./bg-BG.json\": 285,\n\t\"./ca-ES.json\": 286,\n\t\"./cs-CZ.json\": 287,\n\t\"./de-DE.json\": 288,\n\t\"./en-US.json\": 194,\n\t\"./es-ES.json\": 289,\n\t\"./et-EE.json\": 290,\n\t\"./fi-FI.json\": 291,\n\t\"./fr-FR.json\": 292,\n\t\"./he-IL.json\": 293,\n\t\"./it-IT.json\": 294,\n\t\"./ja-JP.json\": 295,\n\t\"./ko-KR.json\": 296,\n\t\"./nb-NO.json\": 297,\n\t\"./nn-NO.json\": 298,\n\t\"./pl-PL.json\": 299,\n\t\"./pt-BR.json\": 300,\n\t\"./ru-RU.json\": 301,\n\t\"./sv-SE.json\": 302,\n\t\"./tr-TR.json\": 303,\n\t\"./zh-CN.json\": 304\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 284;","import Dexie from \"dexie\";\nimport hash from \"object-hash\";\n\nclass AnnotationDB {\n  constructor() {\n    this.idb = new Dexie(\"AmCAT_Annotator\");\n    this.idb.version(1).stores({\n      meta: \"welcome\", // this just serves to keep track of whether db was 'created' via the welcome component\n      apis: \"api\", // unindexed fields: token, refresh_token, expiration_date,\n      codingjobs: \"job_id, name\", // unindexed fields: jobcreator, codingscheme, codebook, codebookEdit, returnAddress\n      documents: \"doc_id, job_id\", // unindexed fields: title, text, meta, tokens, annotations\n    });\n  }\n\n  // META\n  async welcome() {\n    if (!(await this.isWelcome())) this.idb.meta.add({ welcome: 1 });\n    return null;\n  }\n  async isWelcome() {\n    return this.idb.meta.get(1);\n  }\n\n  // API TOKENS\n  async addToken(api, token) {\n    return this.idb.apis.put({\n      api,\n      token: token.token,\n      refresh_token: token.refresh_token,\n      expiration_date: token.expiration_date,\n    });\n  }\n  async deleteToken(api) {\n    return this.idb.apis.delete(api);\n  }\n  async getToken(api) {\n    return this.idb.apis.get(api);\n  }\n\n  // CODINGJOBS\n  async createCodingjob(name) {\n    const job_id = hash([name, Date.now().toString()]);\n    this.idb.codingjobs.add({\n      job_id,\n      name,\n    });\n    return { job_id, name };\n  }\n  async deleteCodingjob(codingjob) {\n    await this.idb.documents.where(\"job_id\").equals(codingjob.job_id).delete();\n    return this.idb.codingjobs.delete(codingjob.job_id);\n  }\n  async listCodingjobs() {\n    const test = await this.idb.codingjobs.toArray();\n    return test;\n  }\n  async getCodingjob(codingjob) {\n    return this.idb.codingjobs.get(codingjob.job_id);\n  }\n  async writeCodebook(codingjob, codebook) {\n    return this.idb.codingjobs\n      .where(\"job_id\")\n      .equals(codingjob.job_id)\n      .modify({ codebook: JSON.stringify(codebook, null, 2) });\n  }\n  async writeCodes(codingjob, codes) {\n    const cj = await this.getCodingjob(codingjob);\n    console.log();\n    const codebook = JSON.parse(cj.codebook);\n    codebook.codes = codes;\n    return await this.writeCodebook(codingjob, codebook);\n  }\n\n  // DOCUMENTS\n  async createDocuments(codingjob, documentList, silent = false) {\n    let ids = new Set(\n      await this.idb.documents\n        .where(\"job_id\")\n        .equals(codingjob.job_id)\n        .primaryKeys()\n    );\n\n    let duplicates = 0;\n    const preparedDocuments = documentList.reduce((result, document) => {\n      const doc_id = hash([document, codingjob]); // codingjob included for doc_id hash\n      if (!ids.has(doc_id)) {\n        ids.add(doc_id);\n        if (document.annotations && document.annotations.length > 0) {\n          try {\n            JSON.parse(document.annotations);\n          } catch (e) {\n            alert(\"Annotations field contains invalid JSON\");\n            throw new Error(\"JSON parse error\");\n          }\n        }\n        result.push({\n          doc_id: doc_id,\n          job_id: codingjob.job_id,\n          ...document,\n        });\n      } else {\n        duplicates++;\n      }\n      return result;\n    }, []);\n\n    if (!silent) {\n      let message = `Created ${\n        documentList.length - duplicates\n      } new documents in codingjob ${codingjob.name}.`;\n      if (duplicates > 0)\n        message = message + ` Ignored ${duplicates} duplicates`;\n      alert(message);\n    }\n\n    return this.idb.documents.bulkAdd(preparedDocuments);\n  }\n  async deleteDocuments(documents) {\n    const documentIds = documents.map((document) => document.doc_id);\n    return this.idb.documents.bulkDelete(documentIds);\n  }\n\n  async getJobDocumentsBatch(codingjob, offset, limit) {\n    if (offset < 0) return null;\n    const documents = await this.idb.documents\n      .where(\"job_id\")\n      .equals(codingjob.job_id);\n    const ndocs = await documents.count();\n    if (offset > ndocs - 1) return null;\n    return documents.offset(offset).limit(limit).toArray();\n  }\n\n  async getJobDocumentCount(codingjob) {\n    return this.idb.documents.where(\"job_id\").equals(codingjob.job_id).count();\n  }\n\n  async getDocument(doc_id) {\n    return this.idb.documents.get(doc_id);\n  }\n\n  async writeAnnotations(document, annotations) {\n    return this.idb.documents\n      .where(\"doc_id\")\n      .equals(document.doc_id)\n      .modify({ annotations: JSON.stringify(annotations, null, 2) });\n  }\n\n  // CLEANUP\n  async deleteDB() {\n    await this.idb.meta.clear();\n    await this.idb.apis.clear();\n    await this.idb.codingjobs.clear();\n    await this.idb.documents.clear();\n  }\n}\n\nconst db = new AnnotationDB();\nexport default db;\n","import React, { useState } from \"react\";\n\nimport { Modal, Menu, Header, Button } from \"semantic-ui-react\";\nimport { exportDB } from \"dexie-export-import\";\nimport fileDownload from \"js-file-download\";\nimport db from \"../apis/dexie\";\n\nconst Download = () => {\n  const [open, setOpen] = useState(false);\n\n  const onDownload = async () => {\n    try {\n      const blob = await exportDB(db.idb, {\n        filter: (table, value, key) =>\n          table === \"codingjobs\" || table === \"documents\",\n        prettyJson: true,\n        progressCallback,\n      });\n      fileDownload(blob, \"AmCAT_Annotator.json\");\n    } catch (error) {\n      console.error(\"\" + error);\n    }\n  };\n\n  return (\n    <Modal\n      closeIcon\n      open={open}\n      trigger={\n        <Menu.Item\n          icon=\"download\"\n          name=\"Download\"\n          style={{ color: \"lightgreen\" }}\n        />\n      }\n      onClose={() => setOpen(false)}\n      onOpen={() => setOpen(true)}\n    >\n      <Header icon=\"download\" content=\"Download everything\" />\n      <Modal.Content>\n        <p>Download all data as a single JSON dump</p>\n      </Modal.Content>\n      <Modal.Actions>\n        <Button primary onClick={onDownload}>\n          Download\n        </Button>\n      </Modal.Actions>\n    </Modal>\n  );\n};\n\nfunction progressCallback({ totalRows, completedRows }) {\n  console.log(`Progress: ${completedRows} of ${totalRows} rows completed`);\n}\n\nexport default Download;\n","export const resetDB = () => {\n  return {\n    type: \"RESET_DB\",\n  };\n};\n\nexport const blockEvents = (block) => {\n  return {\n    type: \"BLOCK_EVENTS\",\n    payload: block,\n  };\n};\n\nexport const selectCodingjob = (codingjob) => {\n  return {\n    type: \"SELECT_CODINGJOB\",\n    payload: codingjob,\n  };\n};\n\nexport const setCodingjobs = (codingjobs) => {\n  return {\n    type: \"SET_CODINGJOBS\",\n    payload: codingjobs,\n  };\n};\n\nexport const setCodingjobSettings = (codingjobSettings) => {\n  return {\n    type: \"SET_CODINGJOB_SETTINGS\",\n    payload: codingjobSettings,\n  };\n};\n\nexport const setTokenIndices = (tokenIndices) => {\n  return {\n    type: \"SET_TOKEN_INDICES\",\n    payload: tokenIndices,\n  };\n};\n\nexport const setCurrentToken = (index) => {\n  return {\n    type: \"SET_CURRENT_TOKEN\",\n    payload: index,\n  };\n};\n\nexport const setTokenSelection = (index, add) => {\n  return {\n    type: \"SET_TOKEN_SELECTION\",\n    index,\n    add,\n  };\n};\n\nexport const clearTokenSelection = () => {\n  return {\n    type: \"CLEAR_TOKEN_SELECTION\",\n  };\n};\n\nexport const triggerCodeselector = (from, tokenIndex) => {\n  return {\n    type: \"TRIGGER_CODESELECTOR\",\n    from: from,\n    index: tokenIndex,\n  };\n};\n\nexport const toggleAnnotations = (spanAnnotation) => {\n  return {\n    type: \"TOGGLE_ANNOTATIONS\",\n    payload: spanAnnotation,\n  };\n};\n\nexport const rmAnnotations = (spanAnnotation) => {\n  return {\n    type: \"RM_ANNOTATIONS\",\n    payload: spanAnnotation,\n  };\n};\n\nexport const clearSpanAnnotations = () => {\n  return {\n    type: \"CLEAR_SPAN_ANNOTATIONS\",\n  };\n};\n\nexport const setCodes = (codes) => {\n  return {\n    type: \"SET_CODES\",\n    payload: codes,\n  };\n};\n\nexport const appendCodeHistory = (code, n = 5) => {\n  return {\n    type: \"APPEND_CODE_HISTORY\",\n    payload: { code: code, n: n },\n  };\n};\n","import React, { useState } from \"react\";\nimport { useDispatch } from \"react-redux\";\nimport { resetDB } from \"../actions\";\nimport { Menu, Button, Header, Icon, Modal } from \"semantic-ui-react\";\nimport { useHistory } from \"react-router-dom\";\nimport db from \"../apis/dexie\";\n\nconst Reset = ({ homepage }) => {\n  const dispatch = useDispatch();\n  const [open, setOpen] = useState(false);\n  const history = useHistory();\n\n  const onClick = async () => {\n    try {\n      await db.deleteDB();\n      dispatch(resetDB());\n      setOpen(false);\n      history.push(homepage);\n    } catch (e) {\n      console.log(e);\n    }\n  };\n\n  return (\n    <Modal\n      closeIcon\n      open={open}\n      trigger={\n        <Menu.Item icon=\"rocket\" name=\"Reset\" style={{ color: \"#d7a3a3\" }} />\n      }\n      onClose={() => setOpen(false)}\n      onOpen={() => setOpen(true)}\n    >\n      <Header icon=\"power off\" content=\"Reset Annotator Database\" />\n      <Modal.Content>\n        <p>\n          This will remove all document and annotation data from your browser.\n          Any annotations that have not been saved/synchronized will be lost.\n          Are you absolutely sure?\n        </p>\n      </Modal.Content>\n      <Modal.Actions>\n        <Button\n          color=\"red\"\n          onClick={() => {\n            setOpen(false);\n          }}\n        >\n          <Icon name=\"remove\" /> No\n        </Button>\n        <Button color=\"green\" onClick={onClick}>\n          <Icon name=\"checkmark\" /> Yes\n        </Button>\n      </Modal.Actions>\n    </Modal>\n  );\n};\n\nexport default Reset;\n","// this contains functions for setting indexedDB to persistent\n// taken from: https://dexie.org/docs/StorageManager\n\n/** Check if storage is persisted already.\n  @returns {Promise<boolean>} Promise resolved with true if current origin is\n  using persistent storage, false if not, and undefined if the API is not\n  present.\n*/\n\nexport async function initStoragePersistence() {\n  const persist = await tryPersistWithoutPromtingUser();\n  switch (persist) {\n    case \"never\":\n      console.log(\"Not possible to persist storage\");\n      break;\n    case \"persisted\":\n      console.log(\"Successfully persisted storage silently\");\n      break;\n    case \"prompt\":\n      console.log(\"Not persisted, but we may prompt user when we want to.\");\n      break;\n    default:\n      console.log(\"compiler desperately wanted a default\");\n  }\n}\n\n/** Tries to convert to persisted storage.\n  @returns {Promise<boolean>} Promise resolved with true if successfully\n  persisted the storage, false if not, and undefined if the API is not present.\n*/\nexport async function persist() {\n  return (await navigator.storage) && navigator.storage.persist\n    ? navigator.storage.persist()\n    : undefined;\n}\n\nexport async function isStoragePersisted() {\n  return (await navigator.storage) && navigator.storage.persisted\n    ? navigator.storage.persisted()\n    : undefined;\n}\n\n/** Queries available disk quota.\n  @see https://developer.mozilla.org/en-US/docs/Web/API/StorageEstimate\n  @returns {Promise<{quota: number, usage: number}>} Promise resolved with\n  {quota: number, usage: number} or undefined.\n*/\n// async function showEstimatedQuota() {\n//   return (await navigator.storage) && navigator.storage.estimate\n//     ? navigator.storage.estimate()\n//     : undefined;\n// }\n\n/** Tries to persist storage without ever prompting user.\n  @returns {Promise<string>}\n    \"never\" In case persisting is not ever possible. Caller don't bother\n      asking user for permission.\n    \"prompt\" In case persisting would be possible if prompting user first.\n    \"persisted\" In case this call successfully silently persisted the storage,\n      or if it was already persisted.\n*/\nasync function tryPersistWithoutPromtingUser() {\n  if (!navigator.storage || !navigator.storage.persisted) {\n    return \"never\";\n  }\n  let persisted = await navigator.storage.persisted();\n  if (persisted) {\n    return \"persisted\";\n  }\n  if (!navigator.permissions || !navigator.permissions.query) {\n    return \"prompt\"; // It MAY be successful to prompt. Don't know.\n  }\n  const permission = await navigator.permissions.query({\n    name: \"persistent-storage\",\n  });\n  if (permission.state === \"granted\") {\n    persisted = await navigator.storage.persist();\n    if (persisted) {\n      return \"persisted\";\n    } else {\n      throw new Error(\"Failed to persist\");\n    }\n  }\n  if (permission.state === \"prompt\") {\n    return \"prompt\";\n  }\n  return \"never\";\n}\n","import React, { useEffect, useState } from \"react\";\nimport { Menu, Button, Header, Icon, Modal } from \"semantic-ui-react\";\nimport { persist, isStoragePersisted } from \"../apis/storemanager\";\n\nconst Persist = () => {\n  const [open, setOpen] = useState(false);\n  const [persisted, setPersisted] = useState(false);\n\n  useEffect(() => {\n    if (!persisted) {\n      isStoragePersisted().then(setPersisted);\n    }\n  }, [persisted]);\n\n  const onClick = async () => {\n    await persist();\n    const ispersisted = await isStoragePersisted();\n    if (ispersisted) {\n      setPersisted(true);\n      alert(\"indexedDB set to persistent for AmCAT Annotator\");\n    } else {\n      alert(\"Failed to set indexedDB to persistent\");\n    }\n  };\n\n  if (persisted) return null;\n\n  return (\n    <Modal\n      closeIcon\n      open={open}\n      trigger={\n        <Menu.Item\n          icon=\"database\"\n          name=\"Enable persitance\"\n          style={{ color: \"#d7a3a3\" }}\n        />\n      }\n      onClose={() => setOpen(false)}\n      onOpen={() => setOpen(true)}\n    >\n      <Header icon=\"database\" content=\"Set database persistence\" />\n      <Modal.Content>\n        <p>\n          We did not have permission to automatically make the data storage for\n          this website persistent. This means that the data could be removed\n          automatically by your browser if it needs to free up space for another\n          website. You can try to set this manually here, but not all browsers\n          support this (yet).\n        </p>\n        <p>\n          If the database is not persistent the app can still be used, but you\n          need to be more carefull in making sure that data is regularly backed\n          up, either by manually downloading data or syncing with some backend\n          (work in progress).\n        </p>\n      </Modal.Content>\n      <Modal.Actions>\n        <Button onClick={onClick}>\n          <Icon name=\"checkmark\" /> Yes\n        </Button>\n      </Modal.Actions>\n    </Modal>\n  );\n};\n\nexport default Persist;\n","import React from \"react\";\nimport { Menu } from \"semantic-ui-react\";\nimport { Link, withRouter, useLocation } from \"react-router-dom\";\nimport db from \"../apis/dexie\";\n\nimport Download from \"./Download\";\nimport Reset from \"./Reset\";\nimport Persist from \"./Persist\";\n\nconst HeaderMenu = ({ items, homepage }) => {\n  const location = useLocation();\n\n  const menuItems = items.map((item, index) => {\n    return (\n      <Menu.Item\n        key={\"item-\" + index}\n        index={index}\n        as={Link}\n        to={item.path}\n        header={index === 0}\n        disabled={!db}\n        active={item.path === location.pathname}\n      >\n        {item.label}\n      </Menu.Item>\n    );\n  });\n\n  return (\n    <Menu fixed=\"top\" inverted>\n      {menuItems}\n      <Menu.Menu position=\"right\">\n        <Download />\n        <Persist />\n        <Reset homepage={homepage} />\n      </Menu.Menu>\n    </Menu>\n  );\n};\n\nexport default withRouter(HeaderMenu);\n","export const demo_codebook = {\n  settings: {\n    canAddCodes: true,\n  },\n  codes: [\n    {\n      code: \"Mark Rutte\",\n      color: \"#40a31f\",\n    },\n    {\n      code: \"Sigrid Kaag\",\n      color: \"#f2db5c\",\n    },\n    {\n      code: \"Jesse Klaver\",\n    },\n  ],\n};\n\nexport const demo_articles = [\n  {\n    title: `GL en PvdA hebben goed gesprek met informateur, maar wantrouwen Rutte`,\n    text: `PvdA-leider Lilianne Ploumen en GroenLinks-leider Jesse Klaver hadden vrijdag een goed gesprek met informateur Herman Tjeenk Willink, zeiden ze zelf. De twee benadrukten dat, hoewel er inhoudelijke stappen zijn gezet, hun vertrouwen in VVD-leider Mark Rutte nog niet is hersteld.\n\n    Informateur Willink zette zich vrijdag aan zijn taak. Eerste punt op de agenda zijn gesprekken met de lijsttrekkers van de acht grootste partijen.\n    \n    Een week nadat een groot deel van de partijleiders bekendmaakte niet meer met Rutte verder te willen onderhandelen over een nieuwe coalitie, wordt gekeken waarover partijen het inhoudelijk eens zijn.\n    \n    \"Het was een prettig gesprek langs de lijnen van de inhoud\", zei PvdA-leider Lilianne Ploumen na afloop. Ze heeft haar zorgen over de ongelijkheid in Nederland en over de zorg gedeeld.\n    \n    Ook Jesse Klaver (GroenLinks), die een uur eerder op gesprek kwam bij de informateur, benadrukte dat het ging over de problemen die opgelost moeten worden.\n    \n    Situatie niet veranderd in een week\n\nWat betreft de positie ten opzichte van Rutte is echter niets veranderd. Vorige week ondertekenden Ploumen en Klaver net als alle andere oppositiepartijen een motie van wantrouwen, vanwege Ruttes betrokkenheid bij de notitie over CDA-Kamerlid Pieter Omtzigt.\n\n\"Als het aan ons ligt, was Rutte geen premier meer\", zei Ploumen. Hoe Tjeenk Willink dat gedeukte vertrouwen kan herstellen, weet ze niet. \"We wachten de voorstellen van de informateur af.\"\n\n\"De vertrouwensbreuk is niet hersteld na n gesprek met de fractievoorzitters\", zei ook Klaver. \"Mijn mening over Rutte is niet veranderd.\"\n\nSP'er Lilian Marijnissen sprak zich al eerder expliciet uit tegen samenwerking met Rutte.\n\nDe partijleiders hekelen het gebrek aan openheid en transparantie waar Rutte in hun ogen voor staat. \"Als je een fout maakt, dan moet je dat toegeven en er niet over liegen\", zei Klaver. Ploumen: \"Het probleem is dat Mark Rutte heeft gelogen. Wij hebben het vertrouwen in hem opgezegd.\"\n\nWat de vervolgstappen moeten zijn, laten ze volledig over aan Tjeenk Willink. \"Ik ga geen lijstjes maken met wat er moet gebeuren\", zei Ploumen.\n\nDe informateur ontvangt later op vrijdag nog de partijleiders Wopke Hoekstra (CDA) en Sigrid Kaag (D66), en Rutte zelf.\n\nTjeenk Willink denkt niet dat Rutte zomaar door kan\n\nTjeenk Willink suggereerde woensdag op een persconferentie dat hij Rutte niet per se een sta-in-de-weg voor een verandering van de bestuursstijl in Den Haag vindt. Toen daarover vervolgens berichten in de media verschenen, voelde de informateur zich vrijdag genoodzaakt die boodschap bij te sturen.\n\nDe conclusie dat Rutte geen belemmering vormt voor de formatie, kan hij niet voor zijn rekening nemen, luidt een schriftelijke verklaring.\n\nTjeenk Willink heeft namelijk ook de opdracht om te onderzoeken \"of en zo ja onder welke voorwaarden er voldoende vertrouwen tussen partijen bestaat of weer kan ontstaan\".`,\n  },\n  {\n    title: `CU-leider Segers vindt dat uitspraak over Rutte te veel op de man was gespeeld`,\n    text: `Partijleider Gert-Jan Segers van de ChristenUnie (CU) vindt dat hij te veel op de man heeft gespeeld door coalitiedeelname uit te sluiten als VVD-leider Mark Rutte opnieuw premier zou worden. Terugblikkend zegt hij dat het niet om n persoon moet gaan, maar om \"een ongezonde politieke cultuur en een genadeloze overheid\". Daar moet volgens hem verandering in komen, zo zei hij zaterdag tijdens een congres van de partij.\n\n    \n    Segers deed zijn uitspraak over Rutte na het debat over de notitie \"functie elders\" voor CDA-Kamerlid Pieter Omtzigt. Binnen de CU is verdeeldheid ontstaan over het besluit van de fractie, erkent Segers.\n    \n    Naast steun is er ook kritiek van veel leden, die zeggen dat hij \"te veel op de man heeft gespeeld en te weinig de bal\". \"Te veel Rutte, te weinig ons allemaal. En als dat de perceptie van veel mensen is, dan moet ik me dat aantrekken\", aldus Segers tijdens het congres.\n    \n    \n    Volgens de CU-leider staat \"de politieke cultuur in Den Haag natuurlijk niet los van Mark Rutte, zeker niet\".\n    \n    \"Maar die oude cultuur staat of valt niet met n man. Ook wijzelf maken er deel van uit. Ik wil niet genadeloos zijn voor personen, maar ik wil wel hard en helder zijn over een cultuur die niet deugt en een genadeloze overheid. Daar moet cht een omslag in komen\", zei Segers.\n    \n    \n    De ChristenUnie heeft vijf zetels in de Tweede Kamer. Op het congres werden vier oude Kamerleden uitgezwaaid en trad Ankie van Tatenhove aan als nieuwe partijvoorzitter.`,\n  },\n];\n","import React, { useEffect } from \"react\";\n\nimport db from \"../apis/dexie\";\nimport { useHistory } from \"react-router-dom\";\nimport { Grid, Button, Header, Segment } from \"semantic-ui-react\";\nimport { initStoragePersistence } from \"../apis/storemanager\";\nimport { demo_articles, demo_codebook } from \"../apis/demodata\";\n\nconst Welcome = ({ items }) => {\n  const history = useHistory();\n\n  const loggin = async (addDemo, checkWelcome) => {\n    if (checkWelcome) {\n      if (!(await db.isWelcome())) return null;\n    }\n    try {\n      if (addDemo) await create_demo_job(db);\n      await db.welcome();\n      await initStoragePersistence();\n      history.push(items[0].path);\n    } catch (e) {}\n  };\n\n  useEffect(() => {\n    loggin(false, true);\n  });\n\n  return (\n    <Grid\n      inverted\n      textAlign=\"center\"\n      style={{ height: \"100vh\" }}\n      verticalAlign=\"middle\"\n    >\n      <Grid.Column style={{ maxWidth: 450 }}>\n        <Segment style={{ border: 0 }}>\n          <Header as=\"h2\" textAlign=\"center\">\n            Welcome to the AmCAT annotator\n          </Header>\n          <p>\n            This is the (early development version of the) AmCAT annotator. The\n            fact that you see this message means that you're either here for the\n            first time, or your local annotation database was reset (by you or\n            your browser).\n          </p>\n          <p>\n            The annotator stores your codingjobs and annotations on your local\n            computer in your browser's IndexedDB. Your data will only actually\n            touch the internet when you synchronize your data.\n          </p>\n          <Button primary onClick={() => loggin(true, false)}>\n            Yes, off course I trust you\n          </Button>\n        </Segment>\n      </Grid.Column>\n    </Grid>\n  );\n};\n\nconst create_demo_job = async (db) => {\n  try {\n    const job = await db.createCodingjob(\"Demo codingjob\");\n    await db.createDocuments(job, demo_articles, true);\n    await db.writeCodebook(job, demo_codebook);\n    return null;\n  } catch (e) {\n    console.log(e);\n  }\n};\n\nexport default Welcome;\n","import React, { useState } from \"react\";\nimport { Route, Redirect } from \"react-router\";\nimport db from \"../apis/dexie\";\n\nconst AuthRoute = ({ Component, homepage, ...componentProps }) => {\n  const [loading, setLoading] = useState(true);\n  const [hasdb, setHasdb] = useState(false);\n  // the trick for passing on componentProps is basically\n  // redundant now that we use Redux, but leaving it intact just in case\n\n  const connect = async () => {\n    if (await db.isWelcome()) {\n      setHasdb(true);\n    } else {\n      setHasdb(false);\n    }\n    setLoading(false);\n  };\n\n  connect();\n\n  return (\n    <Route\n      {...componentProps}\n      render={(props) =>\n        loading ? (\n          <div>loading...</div>\n        ) : hasdb ? (\n          <Component {...componentProps} {...props} />\n        ) : (\n          <Redirect to={homepage} />\n        )\n      }\n    />\n  );\n};\n\nexport default AuthRoute;\n","import React, { useEffect, useState } from \"react\";\nimport {\n  useTable,\n  useSortBy,\n  usePagination,\n  useGlobalFilter,\n} from \"react-table\";\nimport {\n  Table,\n  TableHeader,\n  TableBody,\n  TableRow,\n  TableHeaderCell,\n  TableCell,\n  Pagination,\n  Icon,\n} from \"semantic-ui-react\";\n\n// Uses react-table with semantic ui. The columns and data arguments are lists of objects\n// The 'columns' argument specifies column names (Header) and the names of the keys to get from data.\n//\n// const columns = [\n//   { Header: \"ID\", accessor: \"id\", headerClass: \"one wide\" },\n//   { Header: \"Name\", accessor: \"text\", headerClass: \"one wide\" },\n// ]\n//\n// Note that headerClass is custom, and enables setting the header cell class,\n// which is used in semantic ui to specify the width (one wide, ten wide, etc).\n\nconst SelectionTable = ({\n  columns,\n  data,\n  selectedRow,\n  setSelectedRow,\n  width = null,\n  defaultSize = 15,\n}) => {\n  const [activeRow, setActiveRow] = useState(\n    selectedRow ? selectedRow.ROW_ID : null\n  );\n  const {\n    getTableProps,\n    getTableBodyProps,\n    headerGroups,\n    prepareRow,\n    page,\n    pageCount,\n    gotoPage,\n    preGlobalFilteredRows,\n    setGlobalFilter,\n    state: { pageIndex, globalFilter },\n  } = useTable(\n    {\n      columns,\n      data,\n      initialState: { pageSize: defaultSize, globalFilter: \"\" },\n    },\n\n    useGlobalFilter,\n    useSortBy,\n    usePagination\n  );\n\n  useEffect(() => {\n    if (selectedRow) {\n      setActiveRow(selectedRow.ROW_ID);\n    } else {\n      setActiveRow(null);\n    }\n  }, [selectedRow]);\n\n  const onRowSelect = (row) => {\n    if (activeRow && activeRow === row.id) {\n      setSelectedRow(null);\n      setActiveRow(null);\n    } else {\n      setSelectedRow({ ...data[row.id], ROW_ID: row.id });\n      setActiveRow(row.id);\n    }\n  };\n\n  const createHeader = (headerGroup) => {\n    return headerGroup.headers.map((column) => {\n      return (\n        <TableHeaderCell\n          className={column.headerClass}\n          {...column.getHeaderProps(column.getSortByToggleProps())}\n        >\n          {column.render(\"Header\")}\n          <span>\n            {column.isSorted ? (column.isSortedDesc ? \" \" : \" \") : \"\"}\n          </span>\n        </TableHeaderCell>\n      );\n    });\n  };\n\n  const createBody = (page) => {\n    return page.map((row, i) => {\n      prepareRow(row);\n      return (\n        <TableRow\n          active={activeRow ? activeRow === row.id : false}\n          onClick={() => onRowSelect(row)}\n          {...row.getRowProps()}\n        >\n          {row.cells.map((cell) => {\n            return (\n              <TableCell title={cell.value} {...cell.getCellProps()}>\n                {cell.render(\"Cell\")}\n              </TableCell>\n            );\n          })}\n        </TableRow>\n      );\n    });\n  };\n\n  if (data.length === 0) return null;\n\n  return (\n    <div style={{ width: width }}>\n      <GlobalFilter\n        preGlobalFilteredRows={preGlobalFilteredRows}\n        globalFilter={globalFilter}\n        setGlobalFilter={setGlobalFilter}\n      />\n      <Table\n        compact\n        unstackable\n        fixed\n        singleLine\n        selectable\n        {...getTableProps()}\n      >\n        <TableHeader>\n          {headerGroups.map((headerGroup) => (\n            <TableRow {...headerGroup.getHeaderGroupProps()}>\n              {createHeader(headerGroup)}\n            </TableRow>\n          ))}\n        </TableHeader>\n        <TableBody {...getTableBodyProps()}>{createBody(page)}</TableBody>\n        <Table.Footer>\n          <Table.Row>\n            <Table.HeaderCell colSpan={columns.length}>\n              {data.length > defaultSize ? (\n                <Pagination\n                  floated=\"right\"\n                  style={{ border: \"0\" }}\n                  size=\"mini\"\n                  firstItem={false}\n                  lastItem={false}\n                  nextItem={false}\n                  prevItem={false}\n                  boundaryRange={1}\n                  ellipsisItem={{\n                    content: <Icon name=\"ellipsis horizontal\" />,\n                    icon: true,\n                  }}\n                  activePage={pageIndex + 1}\n                  totalPages={pageCount}\n                  onPageChange={(event, data) => {\n                    gotoPage(data.activePage - 1);\n                  }}\n                />\n              ) : null}\n            </Table.HeaderCell>\n          </Table.Row>\n        </Table.Footer>\n      </Table>\n    </div>\n  );\n};\n\nconst GlobalFilter = ({\n  preGlobalFilteredRows,\n  globalFilter,\n  setGlobalFilter,\n}) => {\n  //const count = preGlobalFilteredRows && preGlobalFilteredRows.length;\n\n  return (\n    <span>\n      <input\n        value={globalFilter || \"\"}\n        onChange={(e) => {\n          setGlobalFilter(e.target.value || undefined); // Set undefined to remove the filter entirely\n        }}\n        placeholder={`Enter search term`}\n        style={{\n          border: \"0\",\n        }}\n      />\n    </span>\n  );\n};\n\nexport default SelectionTable;\n","import React, { useState } from \"react\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport { selectCodingjob, setCodingjobs } from \"../actions\";\nimport {\n  Header,\n  Button,\n  Modal,\n  Form,\n  Loader,\n  Dimmer,\n  Icon,\n} from \"semantic-ui-react\";\nimport db from \"../apis/dexie\";\n\nconst CreateCodingjob = () => {\n  const codingjobs = useSelector((state) => state.codingjobs);\n  const dispatch = useDispatch();\n\n  const [status, setStatus] = useState(\"inactive\");\n  const [codingjobName, setCodingjobName] = useState(\"\");\n\n  const onSubmit = async (event) => {\n    event.preventDefault();\n\n    setCodingjobName(codingjobName.trim());\n    setStatus(\"pending\");\n\n    try {\n      await db.createCodingjob(codingjobName);\n      const codingjobs = await db.listCodingjobs();\n      dispatch(selectCodingjob(null));\n      dispatch(setCodingjobs(codingjobs));\n      setStatus(\"inactive\");\n    } catch (e) {\n      console.log(e);\n      setStatus(\"error\");\n    }\n  };\n\n  if (!codingjobs) return null;\n\n  return (\n    <Modal\n      as={Form}\n      trigger={\n        <Button compact>\n          <Icon name=\"plus\" />\n          Create job\n        </Button>\n      }\n      onSubmit={(e) => onSubmit(e)}\n      open={status !== \"inactive\"}\n      onClose={() => setStatus(\"inactive\")}\n      onOpen={() => {\n        setCodingjobName(\"\");\n        setStatus(\"awaiting input\");\n      }}\n      size=\"tiny\"\n    >\n      <Header icon=\"pencil\" content=\"Create new Codingjob\" as=\"h2\" />\n      <Modal.Content>\n        <Form.Group>\n          <Form.Input\n            width={12}\n            label=\"Name\"\n            required\n            type=\"text\"\n            value={codingjobName}\n            onChange={(e, d) => {\n              setStatus(\"awaiting input\");\n              setCodingjobName(d.value);\n            }}\n            placeholder=\"Enter name\"\n          />\n        </Form.Group>\n      </Modal.Content>\n      <Modal.Actions>\n        {status === \"error\" ? (\n          <div>\n            Could not create codingjob for a reason not yet covered in the error\n            handling...\n          </div>\n        ) : null}\n        {status === \"pending\" ? (\n          <Dimmer active inverted>\n            <Loader content=\"Creating codingjob\" />\n          </Dimmer>\n        ) : (\n          <Button type=\"submit\" color=\"green\" icon=\"save\" content=\"Create\" />\n        )}\n      </Modal.Actions>\n    </Modal>\n  );\n};\n\nexport default CreateCodingjob;\n","import React, { useState } from \"react\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport { selectCodingjob, setCodingjobs } from \"../actions\";\nimport { Button, Header, Icon, Modal, Dimmer, Loader } from \"semantic-ui-react\";\nimport db from \"../apis/dexie\";\n\nconst DeleteCodingjob = () => {\n  const codingjob = useSelector((state) => state.codingjob);\n  const dispatch = useDispatch();\n\n  const [status, setStatus] = useState(\"inactive\");\n\n  const onSubmit = async (event) => {\n    setStatus(\"pending\");\n    try {\n      await db.deleteCodingjob(codingjob);\n      const codingjobs = await db.listCodingjobs();\n\n      dispatch(selectCodingjob(null));\n      dispatch(setCodingjobs(codingjobs));\n\n      setStatus(\"inactive\");\n    } catch (e) {\n      console.log(e);\n      setStatus(\"error\");\n    }\n  };\n\n  if (!codingjob) return null;\n\n  return (\n    <Modal\n      closeIcon\n      open={status !== \"inactive\"}\n      trigger={\n        <Button compact>\n          <Icon name=\"minus\" /> Delete job\n        </Button>\n      }\n      onClose={() => {\n        setStatus(\"inactive\");\n      }}\n      onOpen={() => {\n        setStatus(\"awaiting input\");\n      }}\n    >\n      <Header icon=\"trash\" content={`Delete codingjob ${codingjob.name}`} />\n      <Modal.Content>\n        <p>Do you really want to delete this codingjob?</p>\n      </Modal.Content>\n      <Modal.Actions>\n        {status === \"error\" ? (\n          <div>\n            Could not delete codingjob for a reason not yet covered in the error\n            handling...\n          </div>\n        ) : null}\n        {status === \"pending\" ? (\n          <Dimmer active inverted>\n            <Loader content=\"Creating codingjob\" />\n          </Dimmer>\n        ) : (\n          <>\n            <Button\n              color=\"red\"\n              onClick={() => {\n                setStatus(\"inactive\");\n              }}\n            >\n              <Icon name=\"remove\" /> No\n            </Button>\n            <Button color=\"green\" onClick={onSubmit}>\n              <Icon name=\"checkmark\" /> Yes\n            </Button>\n          </>\n        )}\n      </Modal.Actions>\n    </Modal>\n  );\n};\n\nexport default DeleteCodingjob;\n","import React, { useState, useEffect } from \"react\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport { Button, Segment, Dropdown, Container } from \"semantic-ui-react\";\nimport { selectCodingjob, setCodingjobs } from \"../actions\";\n\nimport SelectionTable from \"./SelectionTable\";\nimport CreateCodingjob from \"./CreateCodingjob\";\nimport DeleteCodingjob from \"./DeleteCodingjob\";\nimport db from \"../apis/dexie\";\n\nconst CodingjobSelector = ({ type = \"table\" }) => {\n  const codingjobs = useSelector((state) => state.codingjobs);\n  const codingjob = useSelector((state) => state.codingjob);\n  const dispatch = useDispatch();\n\n  const [selectedCodingjob, setSelectedCodingjob] = useState(codingjob);\n\n  useEffect(() => {\n    setCodingjob(dispatch, selectedCodingjob);\n  }, [selectedCodingjob, dispatch]);\n\n  useEffect(() => {\n    if (!codingjob) setSelectedCodingjob(null);\n  }, [codingjob, dispatch]);\n\n  useEffect(() => {\n    if (codingjobs.length === 0) {\n      getCodingjobs(dispatch, setSelectedCodingjob);\n    }\n  }, [codingjobs, dispatch]);\n\n  if (type === \"table\") {\n    const tableColumns = [\n      {\n        Header: \"Coding job\",\n        accessor: \"name\",\n        headerClass: \"thirteen wide\",\n      },\n    ];\n\n    return (\n      <Segment style={{ border: \"0\" }}>\n        <Button.Group widths=\"2\">\n          <CreateCodingjob />\n          <DeleteCodingjob />\n        </Button.Group>\n\n        <Container\n          style={{ marginTop: \"30px\", overflow: \"auto\", width: \"800px\" }}\n        >\n          <SelectionTable\n            columns={tableColumns}\n            data={codingjobs ? codingjobs : []}\n            selectedRow={selectedCodingjob}\n            setSelectedRow={setSelectedCodingjob}\n            defaultSize={15}\n          />\n        </Container>\n      </Segment>\n    );\n  }\n\n  if (type === \"dropdown\") {\n    const asDropdownItems = (indices) => {\n      return indices.map((index) => {\n        return { key: index.job_id, text: index.name, value: index.name };\n      });\n    };\n\n    const onDropdownSelect = (value) => {\n      if (value && codingjobs.length > 0) {\n        const i = codingjobs.findIndex((row) => row.name === value);\n        setSelectedCodingjob({ ...codingjobs[i], ROW_ID: i.toString() });\n      } else {\n        setSelectedCodingjob(null);\n      }\n      console.log(selectedCodingjob);\n    };\n\n    return (\n      <Dropdown\n        inline\n        search\n        options={asDropdownItems(codingjobs)}\n        value={codingjob ? codingjob.name : null}\n        onChange={(e, d) => onDropdownSelect(d.value)}\n      />\n    );\n  }\n\n  return null;\n};\n\nconst setCodingjob = async (dispatch, codingjob) => {\n  if (!codingjob) {\n    dispatch(selectCodingjob(null));\n    return;\n  }\n  const ROW_ID = codingjob.ROW_ID;\n  const cj = await db.getCodingjob(codingjob);\n  cj.ROW_ID = ROW_ID;\n  dispatch(selectCodingjob(cj));\n};\n\nconst getCodingjobs = async (dispatch, setSelectedCodingjob) => {\n  // the exists check is super annoying, but if db is included in useEffect, it somehow\n  // rerenders non-stop, and if this check is not here then a new DB will be created immediately\n  // when reset is called.\n  //const exists = await Dexie.exists(\"AmCAT_Annotator\");\n  //if (!exists) return null;\n  if (!db.isWelcome()) return null;\n  try {\n    const cjs = await db.listCodingjobs();\n    if (cjs.length > 0) {\n      dispatch(setCodingjobs(cjs));\n      setSelectedCodingjob({ ...cjs[0], ROW_ID: \"0\" });\n    }\n  } catch (e) {\n    console.log(e);\n  }\n};\n\nexport default CodingjobSelector;\n","import React, { useEffect, useState } from \"react\";\nimport { useSelector } from \"react-redux\";\nimport { Container, Pagination, Table, Icon } from \"semantic-ui-react\";\nimport db from \"../apis/dexie\";\n\nconst PAGESIZE = 10;\nconst COLUMNS = [\"title\", \"text\", \"annotations\", \"meta\"];\n\nconst fetchFromDb = async (codingjob, pageSize, setPages, setData) => {\n  const n = await db.getJobDocumentCount(codingjob);\n  setPages(Math.ceil(n / pageSize));\n  let newdata = [];\n  if (n > 0) newdata = await db.getJobDocumentsBatch(codingjob, 0, pageSize);\n  console.log(newdata);\n  setData(newdata);\n};\n\nconst shortString = (string, n = 20) => {\n  if (!string) return null;\n  if (string.length < n) return string;\n  return string.slice(0, n) + \"...\";\n};\n\nconst DocumentTable = () => {\n  const codingjob = useSelector((state) => state.codingjob);\n  const [data, setData] = useState([]);\n  const [pages, setPages] = useState(1);\n\n  useEffect(() => {\n    if (!codingjob) {\n      setData([]);\n      return null;\n    }\n    fetchFromDb(codingjob, PAGESIZE, setPages, setData);\n  }, [codingjob]);\n\n  const createHeaderRow = (data) => {\n    return COLUMNS.map((colname) => {\n      return (\n        <Table.HeaderCell>\n          <span title={colname}>{colname}</span>\n        </Table.HeaderCell>\n      );\n    });\n  };\n\n  const createBodyRows = (data) => {\n    return data.map((rowObj) => {\n      return <Table.Row>{createRowCells(rowObj)}</Table.Row>;\n    });\n  };\n\n  const createRowCells = (rowObj) => {\n    return COLUMNS.map((key) => {\n      return (\n        <Table.Cell>\n          <span title={rowObj[key]}>{shortString(rowObj[key])}</span>\n        </Table.Cell>\n      );\n    });\n  };\n\n  const pageChange = async (event, data) => {\n    console.log(data.activePage);\n    const offset = (data.activePage - 1) * PAGESIZE;\n    const newdata = await db.getJobDocumentsBatch(codingjob, offset, PAGESIZE);\n    setData(newdata);\n  };\n\n  if (data.length < 1) return null;\n\n  return (\n    <Container style={{ marginTop: \"2em\" }}>\n      <Table compact celled singleLine>\n        <Table.Header>\n          <Table.Row>{createHeaderRow(data)}</Table.Row>\n        </Table.Header>\n        <Table.Body>{createBodyRows(data)}</Table.Body>\n        <Table.Footer>\n          <Table.Row>\n            <Table.HeaderCell colSpan={COLUMNS.length}>\n              {pages > 1 ? (\n                <Pagination\n                  floated=\"right\"\n                  boundaryRange={1}\n                  siblingRange={1}\n                  ellipsisItem={{\n                    content: <Icon name=\"ellipsis horizontal\" />,\n                    icon: true,\n                  }}\n                  firstItem={{\n                    content: <Icon name=\"angle double left\" />,\n                    icon: true,\n                  }}\n                  lastItem={{\n                    content: <Icon name=\"angle double right\" />,\n                    icon: true,\n                  }}\n                  prevItem={{ content: <Icon name=\"angle left\" />, icon: true }}\n                  nextItem={{\n                    content: <Icon name=\"angle right\" />,\n                    icon: true,\n                  }}\n                  pointing\n                  secondary\n                  defaultActivePage={1}\n                  totalPages={pages}\n                  onPageChange={pageChange}\n                ></Pagination>\n              ) : null}\n            </Table.HeaderCell>\n          </Table.Row>\n        </Table.Footer>\n      </Table>\n    </Container>\n  );\n};\n\nexport default DocumentTable;\n","import React from \"react\";\nimport { Container } from \"semantic-ui-react\";\nimport DocumentTable from \"./DocumentTable\";\n\nconst JobDetails = () => {\n  return (\n    <Container style={{ marginTop: \"30px\", overflow: \"auto\" }}>\n      <DocumentTable />\n    </Container>\n  );\n};\n\nexport default JobDetails;\n","import React, { useRef, useEffect, useState } from \"react\";\nimport {\n  Container,\n  Header,\n  Table,\n  Grid,\n  Select,\n  Form,\n  Button,\n  Icon,\n} from \"semantic-ui-react\";\nimport { useSelector } from \"react-redux\";\n\n//import CSVReader from \"react-csv-reader\";\n//import Papa from \"papaparse\";\nimport { CSVReader } from \"react-papaparse\";\nimport db from \"../apis/dexie\";\n\nexport const UploadCsv = ({ setActive }) => {\n  const codingjob = useSelector((state) => state.codingjob);\n  const [data, setData] = useState([]);\n  const fileRef = useRef();\n\n  if (!codingjob) return null;\n  return (\n    <Grid stackable style={{ marginTop: \"4.3em\" }}>\n      <Grid.Row>\n        <Grid.Column floated=\"right\" width={4}>\n          {\" \"}\n          <CSVReader\n            ref={fileRef}\n            onFileLoad={(data) => setData(data)}\n            addRemoveButton\n            onRemoveFile={() => setData([])}\n          >\n            <span>Click to upload</span>\n          </CSVReader>\n        </Grid.Column>\n        <Grid.Column floated=\"right\" width={10}>\n          <SubmitForm data={data} codingjob={codingjob} fileRef={fileRef} />\n        </Grid.Column>\n      </Grid.Row>\n      <Grid.Row>\n        <Grid.Column>\n          <PreviewTable data={data} />\n        </Grid.Column>\n      </Grid.Row>\n    </Grid>\n  );\n};\n\nconst SubmitForm = ({ data, codingjob, fileRef }) => {\n  const [options, setOptions] = useState([]);\n  const [titleField, setTitleField] = useState(null);\n  const [textField, setTextField] = useState(null);\n  const [annotationsField, setAnnotationsField] = useState(null);\n\n  useEffect(() => {\n    if (data.length <= 1) {\n      setTitleField(null);\n      setTextField(null);\n      setAnnotationsField(null);\n      setOptions([]);\n      return;\n    }\n\n    setOptions(\n      data[0].data.map((colname) => {\n        return { key: colname, value: colname, text: colname };\n      })\n    );\n    setTitleField(data[0].data.includes(\"title\") ? \"title\" : null);\n    setTextField(data[0].data.includes(\"text\") ? \"text\" : null);\n    setAnnotationsField(\n      data[0].data.includes(\"annotations\") ? \"annotations\" : null\n    );\n  }, [data]);\n\n  const csvToJson = (data, titleField, textField, annotationsField) => {\n    const keys = data[0].data;\n    return data.slice(1).map((row) => {\n      const datarow = row.data.reduce(\n        (obj, value, i) => {\n          let key = keys[i];\n          if (key === titleField) {\n            obj[\"title\"] = value;\n          } else if (key === textField) {\n            obj[\"text\"] = value;\n          } else if (key === annotationsField) {\n            obj[\"annotations\"] = value;\n          } else {\n            obj[\"meta\"][key] = value;\n          }\n          return obj;\n        },\n        { meta: {}, annotations: \"\" }\n      );\n      datarow.meta = JSON.stringify(datarow.meta, null, 2);\n      return datarow;\n    });\n  };\n\n  const uploadData = async () => {\n    try {\n      const preparedData = csvToJson(\n        data,\n        titleField,\n        textField,\n        annotationsField\n      );\n      await db.createDocuments(codingjob, preparedData);\n      fileRef.current.removeFile();\n    } catch (e) {\n      console.log(e);\n    }\n  };\n\n  if (data.length <= 1) return null;\n\n  return (\n    <>\n      <Form>\n        <Form.Group>\n          <Form.Field\n            control={Select}\n            placeholder=\"title column\"\n            options={options}\n            value={titleField}\n            onChange={(e, d) => setTitleField(d.value)}\n          />\n          <Form.Field\n            control={Select}\n            placeholder=\"text column\"\n            options={options}\n            value={textField}\n            onChange={(e, d) => setTextField(d.value)}\n          />\n        </Form.Group>\n        <Form.Group>\n          <Form.Field\n            control={Select}\n            clearable\n            placeholder=\"annotations (optional)\"\n            options={options}\n            value={annotationsField}\n            onChange={(e, d) => setAnnotationsField(d.value)}\n          />\n          <Form.Field\n            control={Button}\n            fluid\n            onClick={uploadData}\n            disabled={!titleField || !textField}\n          >\n            <Icon name=\"upload\" />\n            Upload\n          </Form.Field>\n        </Form.Group>\n      </Form>\n    </>\n  );\n};\n\nconst PreviewTable = ({ data }) => {\n  const n = 5;\n\n  const createHeader = (data) => {\n    return data[0].data.map((colname) => {\n      return (\n        <Table.HeaderCell>\n          <span title={colname}>{colname}</span>\n        </Table.HeaderCell>\n      );\n    });\n  };\n\n  const createRows = (data, n) => {\n    const previewdata = data.slice(0, n + 1);\n    return previewdata.slice(1).map((row) => {\n      return <Table.Row>{createRowCells(row.data)}</Table.Row>;\n    });\n  };\n\n  const createRowCells = (row) => {\n    return row.map((cell) => {\n      return (\n        <Table.Cell>\n          <span title={cell}>{cell}</span>\n        </Table.Cell>\n      );\n    });\n  };\n\n  if (data.length <= 1) return null;\n\n  return (\n    <Container style={{ marginTop: \"2em\" }}>\n      <Table fixed singleLine basic=\"very\">\n        <Table.Header>\n          <Table.Row>{createHeader(data)}</Table.Row>\n        </Table.Header>\n        <Table.Body>{createRows(data, n)}</Table.Body>\n      </Table>\n      {data.length > n ? (\n        <Header align=\"center\">{data.length - 1 - n} more rows</Header>\n      ) : null}\n    </Container>\n  );\n};\n","import React, { useState } from \"react\";\nimport { Form, Button } from \"semantic-ui-react\";\nimport { useSelector } from \"react-redux\";\n\nimport SemanticDatepicker from \"react-semantic-ui-datepickers\";\nimport \"react-semantic-ui-datepickers/dist/react-semantic-ui-datepickers.css\";\nimport db from \"../apis/dexie\";\n\nconst UploadRaw = () => {\n  const codingjob = useSelector((state) => state.codingjob);\n\n  const [fieldValues, setFieldValues] = useState({});\n\n  const documentFields = {\n    title: \"text\",\n    text: \"text\",\n    annotations: \"text\",\n  };\n\n  const onCreate = async () => {\n    let submitData = { ...fieldValues };\n\n    for (const key of Object.keys(submitData)) {\n      if (key === \"date\" || /_date$/.test(key)) {\n        submitData[key] = submitData[key].toISOString();\n      }\n    }\n\n    try {\n      await db.createDocuments(codingjob, [submitData]);\n      setFieldValues({});\n    } catch (e) {\n      console.log(e);\n    }\n  };\n\n  if (!codingjob) return null;\n\n  return (\n    <Form style={{ marginTop: \"3em\" }}>\n      <DocumentForms\n        fields={documentFields}\n        fieldValues={fieldValues}\n        setFieldValues={setFieldValues}\n      />\n      {!codingjob ? null : (\n        <Button primary onClick={onCreate}>\n          Create document\n        </Button>\n      )}\n    </Form>\n  );\n};\n\nconst DocumentForms = function ({ fields, fieldValues, setFieldValues }) {\n  const onSubmit = (key, value) => {\n    const newFieldValues = { ...fieldValues };\n    newFieldValues[key] = value;\n    setFieldValues(newFieldValues);\n  };\n\n  if (!fields) return null;\n\n  return Object.keys(fields).map((key) => {\n    if (fields[key] === \"text\") {\n      return (\n        <Form.TextArea\n          key={key}\n          value={fieldValues[key] ? fieldValues[key] : \"\"}\n          onChange={(e, d) => onSubmit(key, d.value)}\n          label={key}\n        />\n      );\n    }\n    if (fields[key] === \"date\") {\n      return (\n        <Form.Field>\n          <SemanticDatepicker\n            key={key}\n            label={key}\n            value={fieldValues[key] ? fieldValues[key] : \"\"}\n            onChange={(e, d) => onSubmit(key, d.value)}\n          />\n        </Form.Field>\n      );\n    }\n    if (fields[key] === \"keyword\") {\n      return (\n        <Form.Field key={key}>\n          <label>{key}</label>\n          <input\n            value={fieldValues[key] ? fieldValues[key] : \"\"}\n            onChange={(e) => onSubmit(key, e.target.value)}\n          />\n        </Form.Field>\n      );\n    }\n    return null;\n  });\n};\n\nexport default UploadRaw;\n","import React, { useEffect, useState } from \"react\";\nimport { Accordion, Grid, Header, Icon, Label } from \"semantic-ui-react\";\nimport { useSelector } from \"react-redux\";\nimport SelectionTable from \"./SelectionTable\";\n\nconst CodeBook = () => {\n  const codingjob = useSelector((state) => state.codingjob);\n  const [codes, setCodes] = useState([]);\n  const [selectedCode, setSelectedCode] = useState(null);\n\n  const [activeIndex, setActiveIndex] = useState(-1);\n\n  useEffect(() => {\n    if (!codingjob) return null;\n    if (!codingjob.codebook) {\n      setCodes([]);\n      return null;\n    }\n    const cb = JSON.parse(codingjob.codebook);\n    if (cb && cb.codes) setCodes(cb.codes);\n  }, [codingjob]);\n\n  const handleClick = (e, titleProps) => {\n    const { index } = titleProps;\n    const newIndex = activeIndex === index ? -1 : index;\n    setActiveIndex(newIndex);\n  };\n\n  if (!codingjob) return null;\n\n  const spanAnnotationEditor = () => {\n    const tableColumns = [\n      {\n        Header: \"Code\",\n        accessor: \"code\",\n        headerClass: \"thirteen wide\",\n      },\n    ];\n    return (\n      <>\n        <Accordion.Title\n          active={activeIndex === 0}\n          index={0}\n          onClick={handleClick}\n        >\n          <Icon name=\"dropdown\" />\n\n          <Label color=\"black\" content=\"Span Annotations\"></Label>\n        </Accordion.Title>\n        <Accordion.Content active={activeIndex === 0}>\n          <Grid>\n            <Grid.Column width={11}></Grid.Column>\n            <Grid.Column width={5}>\n              <Header as=\"h4\" textAlign=\"center\">\n                Codes\n              </Header>\n              <SelectionTable\n                columns={tableColumns}\n                data={codes ? codes : []}\n                selectedRow={selectedCode}\n                setSelectedRow={setSelectedCode}\n                defaultSize={10}\n              />\n            </Grid.Column>\n          </Grid>\n        </Accordion.Content>\n      </>\n    );\n  };\n\n  return <Accordion>{spanAnnotationEditor()}</Accordion>;\n};\n\nexport default CodeBook;\n","import React, { useState } from \"react\";\nimport { Dropdown, Grid, Menu, Segment } from \"semantic-ui-react\";\n\nimport CodingjobSelector from \"./CodingjobSelector\";\nimport JobDetails from \"./JobDetails\";\nimport { UploadCsv } from \"./UploadDocuments\";\nimport UploadRaw from \"./UploadRaw\";\nimport CodeBook from \"./CodeBook\";\n\nconst CodingJobs = () => {\n  const [activeItem, setActiveItem] = useState(\"details\");\n\n  const renderSwitch = (activeItem) => {\n    switch (activeItem) {\n      case \"details\":\n        return <JobDetails />;\n      case \"codebook\":\n        return <CodeBook />;\n      case \"upload CSV\":\n        return <UploadCsv />;\n      case \"upload Raw\":\n        return <UploadRaw />;\n      default:\n        return null;\n    }\n  };\n\n  return (\n    <Grid stackable>\n      <Grid.Column floated=\"left\" width={5}>\n        <CodingjobSelector type=\"table\" />\n      </Grid.Column>\n      <Grid.Column width={11}>\n        <Segment style={{ border: 0 }}>\n          <Menu pointing secondary>\n            <Menu.Item\n              name=\"details\"\n              active={activeItem === \"details\"}\n              onClick={(e, d) => setActiveItem(d.name)}\n            />\n\n            <Menu.Item\n              name=\"codebook\"\n              active={activeItem === \"codebook\"}\n              onClick={(e, d) => setActiveItem(d.name)}\n            />\n            <Dropdown\n              as={Menu.Item}\n              active={activeItem.includes(\"upload\")}\n              text=\"Upload Documents\"\n            >\n              <Dropdown.Menu>\n                <Dropdown.Item\n                  text=\"CSV\"\n                  onClick={(e, d) => setActiveItem(\"upload CSV\")}\n                />\n                <Dropdown.Item\n                  text=\"Raw\"\n                  onClick={(e, d) => setActiveItem(\"upload Raw\")}\n                />\n              </Dropdown.Menu>\n            </Dropdown>\n          </Menu>\n          {renderSwitch(activeItem)}\n        </Segment>\n      </Grid.Column>\n    </Grid>\n  );\n};\n\nexport default CodingJobs;\n","import React, { useCallback, useEffect, useState } from \"react\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport {\n  clearSpanAnnotations,\n  setTokenSelection,\n  setCurrentToken,\n  clearTokenSelection,\n  triggerCodeselector,\n} from \"../actions\";\nimport { toggleAnnotations } from \"../actions\";\n\nconst arrowkeys = [\"ArrowRight\", \"ArrowLeft\", \"ArrowUp\", \"ArrowDown\"];\n\nconst SpanAnnotations = ({ doc, tokens }) => {\n  const currentToken = useSelector((state) => state.currentToken);\n  const tokenSelection = useSelector((state) => state.tokenSelection);\n  const eventsBlocked = useSelector((state) => state.eventsBlocked);\n\n  const [holdMouseLeft, setHoldMouseLeft] = useState(false);\n  const [mover, setMover] = useState(null);\n  const [holdCtrl, setHoldCtrl] = useState(false);\n  const [holdArrow, setHoldArrow] = useState(null);\n\n  const dispatch = useDispatch();\n\n  useEffect(() => {\n    dispatch(clearSpanAnnotations());\n  }, [doc, dispatch]);\n\n  useEffect(() => {\n    window.addEventListener(\"mousedown\", onMouseDown);\n    window.addEventListener(\"mousemove\", onMouseMove);\n    window.addEventListener(\"mouseup\", onMouseUp);\n    window.addEventListener(\"contextmenu\", onContextMenu);\n    return () => {\n      window.removeEventListener(\"mousedown\", onMouseDown);\n      window.removeEventListener(\"mousemove\", onMouseMove);\n      window.removeEventListener(\"mouseup\", onMouseUp);\n      window.removeEventListener(\"contextmenu\", onContextMenu);\n    };\n  });\n\n  // (see useEffect with 'eventsBlocked' for details on useCallback)\n  const onKeyUp = useCallback((event) => {\n    // keep track of which buttons are pressed in the state\n    if (event.key === \"Control\" || event.key === \"Shift\") {\n      setHoldCtrl(false);\n      return;\n    }\n    if (arrowkeys.includes(event.key)) {\n      setHoldArrow(false);\n      setMover(null);\n    }\n  }, []);\n\n  // (see useEffect with 'eventsBlocked' for details on useCallback)\n  const onKeyDown = useCallback(\n    (event) => {\n      // key presses, and key holding (see onKeyUp)\n      if (event.key === \"Control\" || event.key === \"Shift\") {\n        if (event.repeat) return;\n\n        setHoldCtrl(true);\n        return;\n      }\n      if (arrowkeys.includes(event.key)) {\n        event.preventDefault();\n        if (event.repeat) return;\n        setMover({\n          position: currentToken,\n          startposition: currentToken,\n          ntokens: tokens.length,\n          counter: 1,\n        });\n        setHoldArrow(event.key);\n      }\n\n      if (tokenSelection.length > 0) {\n        // space key\n        if (event.keyCode === 32) {\n          event.preventDefault();\n          annotationFromSelection(tokens, tokenSelection, dispatch);\n        }\n        if (tokenSelection[0] === tokenSelection[1]) {\n          // enter key\n          if (event.keyCode === 13) {\n            dispatch(triggerCodeselector(\"enter_key\", tokenSelection[0]));\n          }\n        }\n      }\n    },\n    [currentToken, tokenSelection, tokens, dispatch]\n  );\n\n  // This blocks event listeners when the eventsBlocked state (in redux) is true.\n  // This lets us block the key activities in the text (selecting tokens) when\n  // the CodeSelector popup is open\n  useEffect(() => {\n    if (eventsBlocked) {\n      window.removeEventListener(\"keydown\", onKeyDown);\n      window.removeEventListener(\"keyup\", onKeyUp);\n      setHoldCtrl(false);\n      setHoldArrow(false);\n    } else {\n      window.addEventListener(\"keydown\", onKeyDown);\n      window.addEventListener(\"keyup\", onKeyUp);\n    }\n    return () => {\n      window.removeEventListener(\"keydown\", onKeyDown);\n      window.removeEventListener(\"keyup\", onKeyUp);\n    };\n  }, [eventsBlocked, onKeyDown, onKeyUp]);\n\n  useEffect(() => {\n    // When arrow key is held, walk through tokens with increasing speed\n    // this loops itself by updating mover (an object with position information)\n    // this is like setIntervall, but allows custom time intervalls,\n    // and we can interject the loop with updated keydowns (currently ctrl for starting selection)\n    if (!mover || !holdArrow) return;\n\n    let position = movePosition(tokens, holdArrow, mover, holdCtrl, dispatch);\n\n    let delay = Math.max(5, 100 / Math.ceil(mover.counter / 5));\n    if (mover.counter === 1) delay = 150;\n    setTimeout(() => {\n      setMover({\n        position: position,\n        startposition: mover.startposition,\n        ntokens: mover.ntokens,\n        counter: mover.counter + 1,\n      });\n    }, delay);\n  }, [tokens, mover, holdArrow, holdCtrl, dispatch]);\n\n  const onMouseDown = (event) => {\n    // When left button pressed, start new selection\n    if (event.which !== 1) return null;\n    event.preventDefault();\n    setHoldMouseLeft(true);\n    dispatch(clearTokenSelection());\n  };\n\n  const onMouseMove = (event) => {\n    // When selection started (mousedown), select tokens hovered over\n    if (event.which !== 1) return null;\n    if (holdMouseLeft) {\n      storeMouseSelection(event);\n    }\n  };\n\n  const onMouseUp = (event) => {\n    // When left mouse key is released, create the annotation\n    // note that in case of a single click, the token has not been selected (this happens on move)\n    // so this way a click can still be used to open\n    if (event.which !== 1) return null;\n    const currentNode = storeMouseSelection(event);\n    const selection = window.getSelection();\n    selection.empty();\n    setHoldMouseLeft(false);\n\n    // storeMouseSelection does save position to tokenSelection state, but this isn't\n    // yet updated within this scope. This results in single clicks (without mousemove)\n    // not registering. So if there is no current selection, directly use currentNode as position.\n    if (tokenSelection.length > 0) {\n      annotationFromSelection(tokens, tokenSelection, dispatch);\n    } else {\n      if (currentNode !== null)\n        annotationFromSelection(tokens, [currentNode, currentNode], dispatch);\n    }\n  };\n\n  const onContextMenu = (event) => {\n    if (event.button === 2) return null;\n    event.preventDefault();\n    event.stopPropagation();\n  };\n\n  const storeMouseSelection = (event) => {\n    // select tokens that the mouse/touch is currently pointing at\n    let currentNode = getToken(tokens, event.originalTarget);\n    if (!currentNode) return null;\n\n    dispatch(setCurrentToken(currentNode.index));\n    dispatch(setTokenSelection(currentNode.index, true));\n    return currentNode.index;\n  };\n\n  if (!doc) return null;\n\n  return <></>;\n};\n\nconst annotationFromSelection = (tokens, selection, dispatch) => {\n  let [from, to] = selection;\n  if (from > to) [from, to] = [to, from];\n\n  const annotations = [];\n  for (let i = from; i <= to; i++) {\n    annotations.push({\n      index: i,\n      group: \"Not yet assigned\",\n      offset: tokens[from].offset.start,\n      length:\n        tokens[to].offset.length +\n        tokens[to].offset.start -\n        tokens[from].offset.start,\n      span: [from, to],\n    });\n  }\n  dispatch(toggleAnnotations(annotations));\n  dispatch(clearTokenSelection());\n  dispatch(triggerCodeselector(null, null));\n  dispatch(triggerCodeselector(\"new_selection\", to));\n};\n\nconst movePosition = (tokens, key, mover, ctrl, dispatch) => {\n  let newPosition = mover.position;\n  if (key === \"ArrowRight\") newPosition++;\n  if (key === \"ArrowLeft\") newPosition--;\n  if (key === \"ArrowUp\") newPosition = moveSentence(tokens, mover, \"up\");\n  if (key === \"ArrowDown\") newPosition = moveSentence(tokens, mover, \"down\");\n\n  if (newPosition > mover.ntokens) newPosition = mover.ntokens;\n  if (newPosition < 0) newPosition = 0;\n\n  if (mover.position !== newPosition) {\n    dispatch(setCurrentToken(newPosition));\n    dispatch(setTokenSelection(newPosition, ctrl));\n  }\n  tokens[newPosition].ref.current.scrollIntoView({ block: \"center\" });\n  return newPosition;\n};\n\nconst moveSentence = (tokens, mover, direction = \"up\") => {\n  // moving sentences is a bit tricky, but we can do it via the refs to the\n  // token spans, that provide information about the x and y values\n  const current = tokens[mover.position].ref.current.getBoundingClientRect();\n  const start = tokens[mover.startposition].ref.current.getBoundingClientRect();\n  let next;\n\n  if (direction === \"up\") {\n    for (let i = mover.position; i >= 0; i--) {\n      next = tokens[i].ref.current.getBoundingClientRect();\n      if (next.y < current.y && next.x < start.x) {\n        return i;\n      }\n    }\n    return 0;\n  }\n  if (direction === \"down\") {\n    for (let i = mover.position; i < tokens.length; i++) {\n      next = tokens[i].ref.current.getBoundingClientRect();\n      if (next.y > current.y && next.x > start.x) return i;\n    }\n    return tokens.length - 1;\n  }\n};\n\nconst getTokenAttributes = (tokens, tokenNode) => {\n  const tokenindex = parseInt(tokenNode.getAttribute(\"tokenindex\"));\n\n  return {\n    index: tokenindex,\n    offset: tokens[tokenindex].offset.start,\n    length: tokens[tokenindex].offset.length,\n  };\n};\n\nconst getToken = (tokens, e) => {\n  try {\n    // sometimes e is Restricted, and I have no clue why,\n    // nor how to check this in a condition. hence the try clause\n    if (e.className === \"token\" || e.className === \"token selected\")\n      return getTokenAttributes(tokens, e);\n    if (e.parentNode) {\n      if (\n        e.parentNode.className === \"token\" ||\n        e.parentNode.className === \"token selected\"\n      )\n        return getTokenAttributes(tokens, e.parentNode);\n    }\n    return null;\n  } catch (e) {\n    console.log(e);\n    return null;\n  }\n};\n\nexport default SpanAnnotations;\n","import React, { useEffect, useState } from \"react\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport { appendCodeHistory, toggleAnnotations } from \"../actions\";\nimport db from \"../apis/dexie\";\n\n// this is a dummy component to listen for changes in annotations and code\n// and saving them to the indexed db.\n\nconst SpanAnnotationsDB = ({ doc, tokens }) => {\n  const annotations = useSelector((state) => state.spanAnnotations);\n  //const codes = useSelector((state) => state.codes);\n  const [ready, setReady] = useState(false);\n  const dispatch = useDispatch();\n\n  useEffect(() => {\n    setReady(false);\n  }, [doc]);\n\n  useEffect(() => {\n    if (tokens.length > 0 && doc.annotations && !ready) {\n      matchAnnotations(tokens, doc.annotations, dispatch);\n      setReady(true);\n    }\n  }, [ready, tokens, doc, dispatch]);\n\n  useEffect(() => {\n    if (ready) exportAnnotations(doc, annotations);\n  }, [ready, doc, annotations]);\n\n  return <div></div>;\n};\n\nconst exportAnnotations = async (doc, annotations) => {\n  let unique = new Set();\n  const uniqueAnnotations = Object.values(annotations).reduce((un_ann, ann) => {\n    for (let key of Object.keys(ann)) {\n      const ann_obj = {\n        code: key,\n        offset: ann[key].offset,\n        length: ann[key].length,\n      };\n      const json = JSON.stringify(ann_obj);\n      if (!unique.has(json)) {\n        unique.add(json);\n        un_ann.push(ann_obj);\n      }\n    }\n    return un_ann;\n  }, []);\n\n  await db.writeAnnotations({ doc_id: doc.doc_id }, uniqueAnnotations);\n};\n\nconst matchAnnotations = (tokens, importedAnnotations, dispatch) => {\n  let trackAnnotations = {};\n  let matchedAnnotations = [];\n\n  for (let token of tokens) {\n    findMatches(\n      token,\n      importedAnnotations,\n      trackAnnotations,\n      matchedAnnotations\n    );\n  }\n\n  const codeCounter = {};\n  for (let matchedAnnotation of matchedAnnotations) {\n    if (!codeCounter[matchedAnnotation.group])\n      codeCounter[matchedAnnotation.group] = 0;\n    codeCounter[matchedAnnotation.group]++;\n    addAnnotations(matchedAnnotation, dispatch);\n  }\n\n  let topCodes = Object.keys(codeCounter).sort(function (a, b) {\n    return codeCounter[a] - codeCounter[b];\n  });\n  for (const code of topCodes.slice(-5)) {\n    dispatch(appendCodeHistory(code));\n  }\n};\n\nconst findMatches = (\n  token,\n  importedAnnotations,\n  trackAnnotations,\n  matchedAnnotations\n) => {\n  const start = token.offset.start;\n  const end = token.offset.start + token.offset.length;\n\n  // loop over char offset for token. If a span annotation that\n  // starts on this offset is found, initiate a new annotation in trackAnnotations with this\n  // token index as the start of the span. If a span annotation that ends on\n  // this offset is found, set the token idnex as the end of the span,\n  // store annotation in matchedAnnotations, and remove from trackAnnotations\n  for (let i = start; i <= end; i++) {\n    if (importedAnnotations[i]) {\n      for (let code of importedAnnotations[i].start) {\n        trackAnnotations[code] = {\n          index: token.offset.index,\n          group: code,\n          offset: start,\n          length: null,\n          span: [token.offset.index],\n        };\n      }\n      for (let code of importedAnnotations[i].end) {\n        trackAnnotations[code].span.push(token.offset.index);\n        trackAnnotations[code].length =\n          token.offset.start +\n          token.offset.length -\n          trackAnnotations[code].offset;\n        matchedAnnotations.push(trackAnnotations[code]);\n        delete trackAnnotations[code];\n      }\n    }\n  }\n};\n\nconst addAnnotations = (ann, dispatch) => {\n  let newAnnotations = [];\n  for (let i = ann.span[0]; i <= ann.span[1]; i++) {\n    let newAnnotation = { ...ann };\n    newAnnotation.index = i;\n    newAnnotations.push(newAnnotation);\n  }\n  dispatch(toggleAnnotations(newAnnotations));\n};\n\nexport default SpanAnnotationsDB;\n","import React, { useState, useEffect, useRef } from \"react\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport { Button, Dropdown, Popup, Ref } from \"semantic-ui-react\";\nimport {\n  appendCodeHistory,\n  toggleAnnotations,\n  rmAnnotations,\n  blockEvents,\n  triggerCodeselector,\n  setCodes,\n} from \"../actions\";\nimport db from \"../apis/dexie\";\n\nconst arrowKeys = [\"ArrowRight\", \"ArrowLeft\", \"ArrowUp\", \"ArrowDown\"];\n\nconst CodeSelector = React.memo(\n  ({ index, children, annotations, csTrigger }) => {\n    const codes = useSelector((state) => state.codes);\n    const codingjob = useSelector((state) => state.codingjob);\n    const settings = useSelector((state) => state.codingjobSettings);\n    const codeHistory = useSelector((state) => state.codeHistory);\n\n    const textInputRef = useRef(null);\n    const [current, setCurrent] = useState(null);\n    const [hasOpened, setHasOpened] = useState(false);\n    const [popupPage, setPopupPage] = useState(0);\n    const [selectedCodeButton, setSelectedCodeButton] = useState(0);\n    const [nButtons, setNButtons] = useState(Object.keys(annotations).length);\n\n    // Placeholder: should be managed in state\n    const dispatch = useDispatch();\n\n    useEffect(() => {\n      if (!annotations) return;\n      if (current) return null;\n\n      if (annotations && annotations !== undefined) {\n        if (Object.keys(annotations).includes(\"Not yet assigned\")) {\n          setCurrent(\"Not yet assigned\");\n        } else {\n          setCurrent(Object.keys(annotations)[0]);\n        }\n      }\n    }, [current, setCurrent, index, annotations]);\n\n    const onKeydown = React.useCallback(\n      // all keydown events\n      // main events are either selecting one of the code buttons, for either choosing the old or new code\n      // and moving focus to the dropdown/search input on text input\n      (event) => {\n        // any arrowkey\n        if (arrowKeys.includes(event.key)) {\n          if (textInputRef?.current?.children[0] === document.activeElement)\n            return;\n\n          if (event.key === \"ArrowRight\") {\n            if (!nButtons) return;\n            if (selectedCodeButton < nButtons - 1)\n              setSelectedCodeButton(selectedCodeButton + 1);\n          }\n\n          if (event.key === \"ArrowLeft\" && selectedCodeButton > 0) {\n            setSelectedCodeButton(selectedCodeButton - 1);\n          }\n          return;\n        }\n\n        // space or enter\n        if (event.keyCode === 32 || event.keyCode === 13) {\n          const showCurrentCodeSelection =\n            popupPage === 0 &&\n            Object.keys(annotations).length > 1 &&\n            csTrigger !== \"new_selection\";\n\n          if (showCurrentCodeSelection) {\n            const codebuttons = Object.keys(annotations);\n            setPopupPage(1);\n            setCurrent(codebuttons[selectedCodeButton]);\n          } else {\n            const codebuttons = codeHistory.filter(\n              (e) => e !== current && e !== \"Not yet assigned\"\n            );\n\n            let value = current;\n            if (selectedCodeButton < codebuttons.length)\n              value = codebuttons[selectedCodeButton];\n            updateAnnotations(\n              annotations,\n              current,\n              value,\n              setCurrent,\n              dispatch\n            );\n          }\n          return;\n        }\n\n        // All previous key catches\n        if (textInputRef.current) textInputRef.current.click();\n      },\n      [\n        annotations,\n        current,\n        nButtons,\n        popupPage,\n        csTrigger,\n        dispatch,\n        codeHistory,\n        selectedCodeButton,\n      ]\n    );\n\n    useEffect(() => {\n      window.addEventListener(\"keydown\", onKeydown);\n      dispatch(blockEvents(true));\n\n      return () => {\n        window.removeEventListener(\"keydown\", onKeydown);\n        dispatch(blockEvents(false));\n      };\n    }, [onKeydown, dispatch]);\n\n    const createPopupPage = (popupPage) => {\n      const annotationCodes = Object.keys(annotations);\n\n      const showCurrentCodeSelection =\n        popupPage === 0 &&\n        annotationCodes.length > 1 &&\n        csTrigger !== \"new_selection\";\n\n      if (showCurrentCodeSelection) {\n        return (\n          <>\n            <h5>Select current code:</h5>\n\n            {annotationCodes.map((code, i) => {\n              return (\n                <Button\n                  style={{ backgroundColor: getColor(code, codes) }}\n                  compact\n                  size={i === selectedCodeButton ? \"medium\" : \"mini\"}\n                  onMouseOver={() => setSelectedCodeButton(i)}\n                  onClick={() => {\n                    setPopupPage(1);\n                    setCurrent(code);\n                    //selectSpan(annotations, code, dispatch);\n                  }}\n                >\n                  {code}\n                </Button>\n              );\n            })}\n          </>\n        );\n      }\n\n      return (\n        <>\n          <div>\n            <h5 style={{ display: \"inline\" }}>Set new code:</h5>\n            <Ref innerRef={textInputRef}>\n              <Dropdown\n                placeholder={\"Search\"}\n                style={{ marginLeft: \"2em\", minWidth: \"10em\" }}\n                options={codes.map((code) => {\n                  return {\n                    key: code.code,\n                    value: code.code,\n                    text: code.code,\n                  };\n                })}\n                search\n                selection\n                selectOnNavigation={false}\n                minCharacters={0}\n                autoComplete={\"on\"}\n                additionPosition=\"bottom\"\n                allowAdditions={settings.canAddCodes}\n                additionLabel={\n                  <i style={{ color: \"red\" }}>Create new code: </i>\n                }\n                onAddItem={(e, d) =>\n                  addCode(d.value, codes, codingjob, dispatch)\n                }\n                onChange={(e, d) =>\n                  updateAnnotations(\n                    annotations,\n                    current,\n                    d.value,\n                    setCurrent,\n                    dispatch\n                  )\n                }\n              />\n            </Ref>\n          </div>\n          <br />\n          <CodeButtons\n            annotations={annotations}\n            current={current}\n            codes={codes}\n            setCurrent={setCurrent}\n            codeHistory={codeHistory}\n            selectedCodeButton={selectedCodeButton}\n            setSelectedCodeButton={setSelectedCodeButton}\n            setNButtons={setNButtons}\n          />\n          &nbsp;&nbsp;\n        </>\n      );\n    };\n\n    return (\n      <Popup\n        trigger={children}\n        flowing\n        hoverable\n        wide\n        open\n        mouseLeaveDelay={1000}\n        onOpen={() => setHasOpened(true)}\n        onClose={() => {\n          if (hasOpened && csTrigger)\n            // calling dispatch directly causes a memory leak warning, because it unmounts\n            // the component. The very minor async timeout fixes this.\n            setTimeout(() => dispatch(triggerCodeselector(null)), 10);\n        }}\n        position=\"top left\"\n      >\n        {createPopupPage(popupPage)}\n      </Popup>\n    );\n  }\n);\n\nconst CodeButtons = ({\n  annotations,\n  current,\n  codes,\n  setCurrent,\n  codeHistory,\n  selectedCodeButton,\n  setSelectedCodeButton,\n  setNButtons,\n}) => {\n  const dispatch = useDispatch();\n\n  const codeHistoryValid = codeHistory.filter(\n    (e) => e !== current && e !== \"Not yet assigned\"\n  );\n  setNButtons(codeHistoryValid.length + 1); // also the delete button\n\n  const newCodeButtons = () => {\n    return codeHistoryValid.map((code, i) => {\n      return (\n        <Button\n          style={{ backgroundColor: getColor(code, codes) }}\n          key={code}\n          value={code}\n          compact\n          size={i === selectedCodeButton ? \"medium\" : \"mini\"}\n          onMouseOver={() => setSelectedCodeButton(i)}\n          onClick={(e, d) => {\n            console.log(annotations);\n            console.log(d.value);\n            updateAnnotations(\n              annotations,\n              current,\n              d.value,\n              setCurrent,\n              dispatch\n            );\n          }}\n        >\n          {code}\n        </Button>\n      );\n    });\n  };\n\n  return (\n    <>\n      {newCodeButtons()}\n\n      <Button\n        icon=\"delete\"\n        size={\n          selectedCodeButton === codeHistoryValid.length ? \"medium\" : \"mini\"\n        }\n        compact\n        color=\"red\"\n        onMouseOver={() => setSelectedCodeButton(codeHistoryValid.length)}\n        onClick={(e, d) =>\n          updateAnnotations(annotations, current, current, setCurrent, dispatch)\n        }\n      />\n    </>\n  );\n};\n\nconst addCode = (code, codes, codingjob, dispatch) => {\n  console.log(codes);\n  if (!codes.find((e) => e.code === code)) {\n    const newcodes = [...codes, { code }];\n    db.writeCodes(codingjob, newcodes);\n    dispatch(setCodes(newcodes));\n  }\n};\n\nconst updateAnnotations = (\n  annotations,\n  current,\n  value,\n  setCurrent,\n  dispatch\n) => {\n  const key = current;\n  let annotation = annotations;\n  if (!annotation) return null;\n\n  console.log(current);\n\n  let ann = {\n    index: annotation[key].index,\n    group: key,\n    offset: annotation[key].offset,\n    length: annotation[key].length,\n    span: annotation[key].span,\n  };\n\n  let oldAnnotation = { ...ann };\n  oldAnnotation.span = [oldAnnotation.index, oldAnnotation.index];\n  dispatch(rmAnnotations([oldAnnotation]));\n\n  if (value === key) {\n    dispatch(triggerCodeselector(null, null));\n    return null;\n  }\n\n  let newAnnotations = [];\n  for (let i = ann.span[0]; i <= ann.span[1]; i++) {\n    let newAnnotation = { ...ann };\n    newAnnotation.group = value;\n    newAnnotation.index = i;\n    newAnnotations.push(newAnnotation);\n  }\n  dispatch(toggleAnnotations(newAnnotations));\n  dispatch(appendCodeHistory(value));\n\n  if (Object.keys(annotation).includes(null)) {\n    setCurrent(null);\n  } else {\n    setCurrent(value);\n  }\n\n  dispatch(triggerCodeselector(null, null));\n};\n\nconst getColor = (tokenCode, codes) => {\n  const codematch = codes.find((code) => code.code === tokenCode);\n  if (codematch) {\n    return codematch.color;\n  } else {\n    return \"lightgrey\";\n  }\n};\n\nexport default CodeSelector;\n","import React from \"react\";\nimport { useDispatch, useSelector } from \"react-redux\";\n\nimport \"./style.css\";\nimport CodeSelector from \"./CodeSelector\";\nimport { triggerCodeselector } from \"../actions\";\n\nconst Token = React.forwardRef(({ token }, ref) => {\n  const selected = useSelector((state) => {\n    if (state.tokenSelection.length === 0) return false;\n\n    let [from, to] = state.tokenSelection;\n    if (from > to) [to, from] = [from, to];\n    return token.offset.index >= from && token.offset.index <= to;\n  });\n\n  let tokenClass = \"token\";\n  if (selected) tokenClass = tokenClass + \" selected\";\n\n  return (\n    <span ref={ref} className={tokenClass} tokenindex={token.offset.index}>\n      <AnnotatedToken token={token} selected={selected} />\n    </span>\n  );\n});\n\nconst AnnotatedToken = ({ token, selected }) => {\n  // If we specifically ask for the annotations for the current token within the\n  // useSelector function, rerender is only triggered if this value has changed\n  const annotations = useSelector(\n    (state) => state.spanAnnotations[token.offset.index]\n  );\n  const csTrigger = useSelector((state) => {\n    if (state.codeSelectorTrigger.index !== token.offset.index) return null;\n    return state.codeSelectorTrigger.from;\n  });\n\n  const codes = useSelector((state) => state.codes);\n  const dispatch = useDispatch();\n\n  // This is a trick required to render if at least something within this token's\n  // annotations changed (somehow 'annotations' doesn't trigger this)\n  useSelector((state) =>\n    JSON.stringify(state.spanAnnotations[token.offset.index])\n  );\n\n  // if there are no annotation codes, our life is easy\n  if (!annotations) return <>{token.pre + token.text + token.post}</>;\n\n  // create solid colors or color gradients\n  const getColor = (tokenCode, codes) => {\n    const codematch = codes.find((code) => code.code === tokenCode);\n    if (codematch) {\n      return codematch.color;\n    } else {\n      return \"lightgrey\";\n    }\n  };\n\n  const tokenSpan = (annotatedTokenClass, color) => {\n    return (\n      <span\n        className={annotatedTokenClass}\n        onContextMenu={(e) => {\n          e.preventDefault();\n          dispatch(triggerCodeselector(\"right_click\", token.offset.index));\n        }}\n        style={color ? { background: color } : null}\n      >\n        {allLeft && allRight ? token.text : null}\n        {allLeft && !allRight ? token.text + token.post : null}\n        {allRight && !allLeft ? token.pre + token.text : null}\n        {!allLeft && !allRight ? token.pre + token.text + token.post : null}\n      </span>\n    );\n  };\n\n  let tokenCodes = Object.keys(annotations);\n  let color = null;\n  if (tokenCodes.length === 1) {\n    color = getColor(tokenCodes[0], codes);\n  } else {\n    let colors = tokenCodes.map((code) => getColor(code, codes));\n    color = `linear-gradient(${colors.join(\", \")})`;\n  }\n\n  // Set specific classes for nice css to show the start/end of codes\n  const allLeft = !Object.values(annotations).some(\n    (code) => code.span[0] !== code.index\n  );\n  const allRight = !Object.values(annotations).some(\n    (code) => code.span[1] !== code.index\n  );\n  const anyLeft = Object.values(annotations).some(\n    (code) => code.span[0] === code.index\n  );\n  const anyRight = Object.values(annotations).some(\n    (code) => code.span[1] === code.index\n  );\n\n  let annotatedTokenClass = \"annotatedToken\";\n  if (allLeft) annotatedTokenClass = annotatedTokenClass + \" allLeft\";\n  if (anyLeft & !allLeft)\n    annotatedTokenClass = annotatedTokenClass + \" anyLeft\";\n  if (allRight) annotatedTokenClass = annotatedTokenClass + \" allRight\";\n  if (anyRight & !allRight)\n    annotatedTokenClass = annotatedTokenClass + \" anyRight\";\n\n  if (selected) {\n    color = null;\n    annotatedTokenClass = annotatedTokenClass + \" selected\";\n  }\n\n  return (\n    <>\n      {allLeft ? token.pre : null}\n\n      {csTrigger ? (\n        <CodeSelector\n          index={token.offset.index}\n          annotations={annotations}\n          csTrigger={csTrigger}\n        >\n          {tokenSpan(annotatedTokenClass, color)}\n        </CodeSelector>\n      ) : (\n        tokenSpan(annotatedTokenClass, color)\n      )}\n\n      {allRight ? token.post : null}\n    </>\n  );\n};\n\nexport default React.memo(Token);\n","import React, { useEffect, useState } from \"react\";\nimport { Container, Segment } from \"semantic-ui-react\";\nimport Token from \"./Token\";\n\nimport nlp from \"compromise\";\nimport paragraphs from \"compromise-paragraphs\";\nnlp.extend(paragraphs);\n\nconst Tokens = ({ text, setTokens }) => {\n  // It's imporant that the annotations to not pass by this component\n  // but are loaded into Token from redux. This prevents rerendering\n  // all the parsing stuff\n  const [tokenComponents, setTokenComponents] = useState(null);\n\n  useEffect(() => {\n    const [paragraphs, tokens] = prepareTokens(text);\n    setTokenComponents(paragraphs);\n    setTokens(tokens);\n  }, [text, setTokens]);\n\n  if (text === null) return null;\n\n  return (\n    <Container text>\n      <Segment style={{ border: \"0\" }}>{tokenComponents}</Segment>\n    </Container>\n  );\n};\n\nconst prepareTokens = (text) => {\n  let tokens = []; // make object with\n  const tokenized = nlp.tokenize(text).paragraphs().json({ offset: true });\n  const paragraphs = tokenized.map((par, par_i) => {\n    return createParagraph(par, par_i, tokens);\n  });\n\n  return [paragraphs, tokens];\n};\n\nconst createParagraph = (par, par_i, tokens) => {\n  const mapSentences = (par) => {\n    return par.sentences.map((sent) => {\n      // for some reason there's an extra array layer between sentences and paragraphs...\n      // I've only found cases where lenght is 1, but I'll map it just in case\n      return sent.map((sent2) => {\n        return createSentence(sent2, tokens);\n      });\n    });\n  };\n  return (\n    // uses span behaving like p, because p is not allowed due to nested div (for Label)\n    <span style={{ marginTop: \"1em\", display: \"table\" }} key={par_i}>\n      {par_i === 0 ? <h2>{mapSentences(par)}</h2> : mapSentences(par)}\n    </span>\n  );\n};\n\nconst createSentence = (sent, tokens) => {\n  const mapTokens = (sent) => {\n    return sent.terms.map((token) => {\n      token.ref = React.createRef();\n      tokens.push(token);\n      return <Token ref={token.ref} key={token.offset.index} token={token} />;\n    });\n  };\n\n  return (\n    <span className=\"sentence\" key={sent.offset.index}>\n      {mapTokens(sent)}\n    </span>\n  );\n};\n\nexport default React.memo(Tokens);\n","import React, { useState } from \"react\";\nimport { Grid } from \"semantic-ui-react\";\n\nimport SpanAnnotations from \"./SpanAnnotations\";\nimport SpanAnnotationsDB from \"./SpanAnnotationsDB\";\n\nimport Tokens from \"./Tokens\";\n\nconst AnnotationText = ({ doc }) => {\n  const [tokens, setTokens] = useState([]);\n\n  if (!doc) return null;\n  return (\n    <>\n      <Grid.Row>\n        <Grid.Column width={10}>\n          <Tokens text={doc.text} setTokens={setTokens} />\n        </Grid.Column>\n        <Grid.Column width={6}></Grid.Column>\n      </Grid.Row>\n\n      <SpanAnnotations doc={doc} tokens={tokens} />\n      <SpanAnnotationsDB doc={doc} tokens={tokens} />\n    </>\n  );\n};\n\nexport default AnnotationText;\n\n// title is optional. If empty, just show text nr in breadcrumb\n// annotations can be document, paragraph, sentence or token level\n// these are stored in separate keys in the annotations\n// For paragraph, sentence and token level, the specific texts are also exported with the annotations\n","import React, { useEffect, useState } from \"react\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport {\n  Breadcrumb,\n  BreadcrumbSection,\n  Grid,\n  Pagination,\n} from \"semantic-ui-react\";\n\nimport CodingjobSelector from \"./CodingjobSelector\";\nimport AnnotationText from \"./AnnotationText\";\nimport db from \"../apis/dexie\";\nimport { setCodes, setCodingjobSettings } from \"../actions\";\n\nconst Annotate = () => {\n  const codingjob = useSelector((state) => state.codingjob);\n  const dispatch = useDispatch();\n\n  const [doc, setDoc] = useState(null);\n  const [nDocuments, setNDocuments] = useState(0);\n  const [activePage, setActivePage] = useState(1);\n\n  useEffect(() => {\n    if (!codingjob) return null;\n    setActivePage(1);\n    setupCodingjob(codingjob, setDoc, setNDocuments);\n    if (codingjob.codebook) {\n      const cb = JSON.parse(codingjob.codebook);\n      if (cb && cb.codes && cb.codes.length > 0) {\n        dispatch(setCodes(cb.codes));\n      } else {\n        dispatch(setCodes([]));\n      }\n      if (cb && cb.settings) {\n        dispatch(setCodingjobSettings(cb.settings));\n      }\n    }\n  }, [codingjob, dispatch]);\n\n  const pageChange = (event, data) => {\n    documentSelector(codingjob, data.activePage - 1, setDoc);\n    setActivePage(data.activePage);\n  };\n\n  return (\n    <>\n      <Grid>\n        <Grid.Row>\n          <Grid.Column width={10}>\n            <Breadcrumb>\n              <BreadcrumbSection link style={{ minWidth: \"5em\" }}>\n                <CodingjobSelector type=\"dropdown\" />\n              </BreadcrumbSection>\n              <Breadcrumb.Divider />\n              <BreadcrumbSection>{doc ? doc.title : null}</BreadcrumbSection>\n            </Breadcrumb>\n          </Grid.Column>\n          <Grid.Column floated=\"right\" width={1}>\n            {documentPagination(activePage, nDocuments, pageChange)}\n          </Grid.Column>\n        </Grid.Row>\n        <Grid.Row>\n          <AnnotationText doc={doc ? doc : null} />\n        </Grid.Row>\n        <Grid.Row>\n          {documentPagination(activePage, nDocuments, pageChange)}\n        </Grid.Row>\n      </Grid>\n    </>\n  );\n};\n\nconst documentPagination = (activePage, nDocuments, pageChange) => {\n  return (\n    <Pagination\n      activePage={activePage}\n      size={\"mini\"}\n      firstItem={null}\n      lastItem={null}\n      siblingRange={0}\n      boundaryRange={0}\n      defaultActivePage={1}\n      ellipsisItem={null}\n      totalPages={nDocuments}\n      onPageChange={pageChange}\n    />\n  );\n};\n\nconst setupCodingjob = async (codingjob, setDoc, setNDocuments) => {\n  const n = await db.getJobDocumentCount(codingjob);\n  setNDocuments(n);\n  if (n > 0) {\n    documentSelector(codingjob, 0, setDoc);\n  } else {\n    setDoc(null);\n  }\n};\n\nconst documentSelector = async (codingjob, i, setDoc) => {\n  if (!codingjob) return null;\n  const docs = await db.getJobDocumentsBatch(codingjob, i, 1);\n  if (docs) {\n    setDoc({\n      doc_id: docs[0].doc_id,\n      title: docs[0].title,\n      text: docs[0].title + \"\\n\\n\" + docs[0].text,\n      annotations: prepareAnnotations(docs[0].annotations),\n    });\n  }\n};\n\nconst prepareAnnotations = (annotations) => {\n  if (!annotations || annotations === \"\") return {};\n  const anns = JSON.parse(annotations);\n\n  // create an object where the key is an offset, and the\n  // value is an array that tells which codes start and end there\n  // used in Tokens for matching to token indices\n  // (matching to tokenindices is needed for speed, to keep coding nice and responsive)\n  return anns.reduce((obj, ann) => {\n    if (!obj[ann.offset]) obj[ann.offset] = { start: [], end: [] };\n    if (!obj[ann.offset + ann.length])\n      obj[ann.offset + ann.length] = { start: [], end: [] };\n    obj[ann.offset].start.push(ann.code);\n    obj[ann.offset + ann.length].end.push(ann.code);\n    return obj;\n  }, {});\n};\n\nexport default Annotate;\n","import React from \"react\";\nimport { BrowserRouter, Route, Switch } from \"react-router-dom\";\nimport HeaderMenu from \"./components/HeaderMenu\";\nimport { Divider, Container } from \"semantic-ui-react\";\n\n// login and authenticated route\nimport Welcome from \"./components/Welcome\";\nimport AuthRoute from \"./components/AuthRoute\";\n\n// Main pages. Use below in items to include in header menu\nimport CodingJobs from \"./components/CodingJobs\";\nimport Annotate from \"./components/Annotate\";\n\n// Change to add new components to the header\n// The first item will be the opening page after login\nconst homepage = \"/amcat4annotator\";\nconst items = [\n  {\n    label: \"Coding Jobs\",\n    path: homepage + \"/codingjobs\",\n    Component: CodingJobs,\n  },\n  { label: \"Annotate\", path: homepage + \"/annotate\", Component: Annotate },\n];\n\nconst App = () => {\n  const createNavigation = (items) => {\n    return items.map((item) => {\n      return (\n        <AuthRoute\n          key={item.path}\n          path={item.path}\n          homepage={homepage}\n          Component={item.Component}\n        />\n      );\n    });\n  };\n\n  return (\n    <BrowserRouter>\n      <HeaderMenu items={items} homepage={homepage} />\n      <Divider />\n      <Container style={{ marginTop: \"3em\" }}>\n        <Switch>\n          <Route\n            exact\n            path={homepage}\n            render={() => <Welcome items={items} />}\n          />\n          {createNavigation(items)}\n        </Switch>\n      </Container>\n    </BrowserRouter>\n  );\n};\n\nexport default App;\n","import { combineReducers } from \"redux\";\nimport { randomColor } from \"randomcolor\";\n\nconst db = (state = null, action) => {\n  switch (action.type) {\n    case \"SET_DB\":\n      return action.payload;\n    case \"RESET_DB\":\n      return null;\n    default:\n      return state;\n  }\n};\n\nconst eventsBlocked = (state = false, action) => {\n  switch (action.type) {\n    case \"BLOCK_EVENTS\":\n      return action.payload;\n    default:\n      return state;\n  }\n};\n\nconst codingjob = (state = null, action) => {\n  switch (action.type) {\n    case \"SELECT_CODINGJOB\":\n      return action.payload;\n    case \"RESET_DB\":\n      return null;\n    default:\n      return state;\n  }\n};\n\nconst codingjobs = (state = [], action) => {\n  switch (action.type) {\n    case \"SET_CODINGJOBS\":\n      return action.payload;\n    case \"RESET_DB\":\n      return [];\n    default:\n      return state;\n  }\n};\n\nconst codingjobSettings = (state = {}, action) => {\n  switch (action.type) {\n    case \"SET_CODINGJOB_SETTINGS\":\n      return action.payload;\n    case \"RESET_DB\":\n      return {};\n    default:\n      return state;\n  }\n};\n\nconst tokenIndices = (state = [], action) => {\n  switch (action.type) {\n    case \"SET_TOKEN_INDICES\":\n      return action.payload;\n    case \"SELECT_DOCUMENT\":\n      return [];\n    case \"RESET_DB\":\n      return [];\n    default:\n      return state;\n  }\n};\n\nconst currentToken = (state = 0, action) => {\n  switch (action.type) {\n    case \"SET_CURRENT_TOKEN\":\n      return action.payload;\n    case \"SELECT_DOCUMENT\":\n      return 0;\n    case \"RESET_DB\":\n      return 0;\n    default:\n      return state;\n  }\n};\n\nconst tokenSelection = (state = [], action) => {\n  // an array of length 2, giving the start and end of the selection\n  switch (action.type) {\n    case \"SET_TOKEN_SELECTION\":\n      return toggleSelection(state, action.index, action.add);\n    case \"CLEAR_TOKEN_SELECTION\":\n      return [];\n    case \"RESET_DB\":\n      return [];\n    default:\n      return state;\n  }\n};\n\nconst codeSelectorTrigger = (state = { from: null, index: null }, action) => {\n  switch (action.type) {\n    case \"TRIGGER_CODESELECTOR\":\n      return { from: action.from, index: action.index };\n    default:\n      return state;\n  }\n};\n\nconst toggleSelection = (selection, index, add) => {\n  if (!add || selection.length === 0) return [index, index];\n  return [selection[0], index];\n};\n\nconst spanAnnotations = (state = {}, action) => {\n  switch (action.type) {\n    case \"TOGGLE_ANNOTATIONS\":\n      return toggleAnnotations({ ...state }, action.payload, false);\n    case \"RM_ANNOTATIONS\":\n      return toggleAnnotations({ ...state }, action.payload, true);\n    case \"CLEAR_SPAN_ANNOTATIONS\":\n      return {};\n    case \"RESET_DB\":\n      return {};\n    default:\n      return state;\n  }\n};\n\nconst toggleAnnotations = (annotations, annList, rm) => {\n  for (let item in annList) {\n    let a = annList[item];\n\n    // if group in annotations, remove it\n    if (annotations[a.index]) {\n      if (annotations[a.index][a.group]) {\n        const span = annotations[a.index][a.group].span;\n        for (let i = span[0]; i <= span[1]; i++) {\n          if (annotations[i]) {\n            if (annotations[i][a.group]) {\n              delete annotations[i][a.group];\n              if (Object.keys(annotations[i]).length === 0) {\n                delete annotations[i];\n              }\n            }\n          }\n        }\n        // if selection was one token (which is probably a click),\n        // just remove the annotation. But if it was a multi-token selection,\n        // we do add the new selection\n        if (a.span[0] === a.span[1]) continue;\n      }\n    }\n\n    if (!rm) {\n      if (!annotations[a.index]) annotations[a.index] = {};\n      annotations[a.index][a.group] = {\n        index: a.index,\n        span: [a.span[0], a.span[1]],\n        offset: a.offset,\n        length: a.length,\n      };\n    }\n  }\n  return annotations;\n};\n\nconst codes = (state = [], action) => {\n  switch (action.type) {\n    case \"SET_CODES\":\n      return action.payload.map((code) => {\n        if (!code.color)\n          code.color = randomColor({ seed: code.code, luminosity: \"bright\" });\n        return code;\n      });\n    case \"RESET_DB\":\n      return [];\n    default:\n      return state;\n  }\n};\n\nconst codeHistory = (state = [], action) => {\n  switch (action.type) {\n    case \"APPEND_CODE_HISTORY\":\n      let newstate = state\n        .filter((v) => v !== action.payload.code)\n        .slice(0, action.payload.n - 1);\n      newstate.unshift(action.payload.code);\n      return newstate;\n    case \"RESET_DB\":\n      return [];\n    default:\n      return state;\n  }\n};\n\nconst rootReducer = combineReducers({\n  db,\n  eventsBlocked,\n  codingjob,\n  codingjobs,\n  codingjobSettings,\n  tokenIndices,\n  currentToken,\n  codeSelectorTrigger,\n  tokenSelection,\n  spanAnnotations,\n  codes,\n  codeHistory,\n});\n\nexport default rootReducer;\n","import \"semantic-ui-css/semantic.min.css\";\nimport React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport App from \"./App\";\nimport { createStore } from \"redux\";\nimport rootReducer from \"./reducers\";\nimport { Provider } from \"react-redux\";\n\nconst store = createStore(rootReducer);\n\nReactDOM.render(\n  <React.StrictMode>\n    <Provider store={store}>\n      <App />\n    </Provider>\n  </React.StrictMode>,\n  document.querySelector(\"#root\")\n);\n"],"sourceRoot":""}