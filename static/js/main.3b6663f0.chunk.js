(this.webpackJsonpCCS_annotator=this.webpackJsonpCCS_annotator||[]).push([[0],{205:function(e,t,n){},276:function(e,t){},278:function(e,t){},294:function(e,t){},302:function(e,t,n){"use strict";n.r(t);n(238);var r=n(1),a=n.n(r),i=n(57),o=n.n(i),c=n(18),s=n(116),l=n(335),u=n(336),d=n(7),j=n.n(d),b=n(11),f=n(4),h=n(332),p=n(339),v=n(181),O=n(54),x=n(3),g=n(13),m=n(61),k=n(20),y=n(24),w=n(118),C=n(38),S=n.n(C),_=n(17),A=n(180),I=n(213);A.a.extend(I.a);var E=function(e){var t,n=[],r=null,a=0,i=0,o=0,c=null,s=null,l=!1,u=Object(g.a)(e);try{for(u.s();!(t=u.n()).done;){null!=t.value.unit_start&&(l=!0)}}catch(w){u.e(w)}finally{u.f()}var d,j=!l,b=!1,f=Object(g.a)(e);try{for(f.s();!(d=f.n()).done;){var h=d.value,p=h.name||"text",v=h.offset||0;s=h.value,c=A.a.tokenize(s).paragraphs().json({offset:!0});for(var O=0;O<c.length;O++){for(var x=0;x<c[O].sentences.length;x++){for(var m=0;m<c[O].sentences[x].length;m++)for(var k=0;k<c[O].sentences[x][m].terms.length;k++){r=c[O].sentences[x][m].terms[k],null!=h.unit_start&&r.offset.start+v>=h.unit_start&&(j=!0),null!=h.unit_end&&r.offset.start+v>h.unit_end&&(b=!0);var y={section:p,offset:r.offset.start+v,length:r.offset.length,paragraph:a,sentence:i,index:o,text:r.text,pre:r.pre,post:r.post,codingUnit:j&!b};n.push(y),o++}i++}a++}}}catch(w){f.e(w)}finally{f.f()}return n},R=function(e){for(var t=0,n=e[0].paragraph,r=0,a=e[0].sentence,i=0,o=0,c=0;c<e.length;c++){if(null==e[c].text){if(null==e[c].token)return alert("Invalid token data:\n\nimported tokens must have 'text' or 'token' field"),null;e[c].text=e[c].token}if(null==e[c].offset&&null!=e[c].start&&(e[c].offset=e[c].start),null==e[c].length&&(e[c].length=e[c].text.length),null==e[c].pre&&(e[c].pre=""),null==e[c].post&&null!=e[c].space&&(e[c].post=e[c].space),null==e[c].post&&(null!=e[c].offset&&null!=e[c].length?e[c].post=c<e[c].length-1?" ".repeat(Math.max(0,e[c+1].offset-e[c].offset-e[c].length)):"":e[c].post=" "),o=e[c].length+e[c].post.length,c<e.length-1&&(o+=e[c+1].pre.length),null==e[c].offset&&(e[c].offset=i,i+=o),c<e.length-1&&e[c].section===e[c+1].section&&e[c+1].offset<e[c].offset+o)return alert('Invalid token position data. The length of "'.concat(e[c].pre+e[c].text+e[c].post,'" on position ').concat(e[c].offset," exeeds the offset/start position of the next token")),null;null==e[c].sentence?(e[c].sentence=r,(e[c].text.includes("\n")||e[c].post.includes("\n"))&&r++):(e[c].paragraph===n&&e[c].sentence===a||(a=e[c].sentence,r++),e[c].sentence=r),null==e[c].paragraph?(e[c].paragraph=t,(e[c].text.includes("\n")||e[c].post.includes("\n"))&&t++):(e[c].paragraph!==n&&(n=e[c].paragraph,t++),e[c].paragraph=t),null==e[c].section&&(e[c].section="text"),e[c].index=c}return e},z=function(e,t){if(0===e.length)return[];for(var n=[],r={},a=e[0].section,i=0;i<e.length;i++)if(e[i].annotations){var o,c={},s=Object(g.a)(e[i].annotations);try{for(s.s();!(o=s.n()).done;){var l=o.value;if("NA"!==l.value&&"NaN"!==l.value){t[l.name]||(t[l.name]=[""]),t[l.value]?t[l.value].includes(l.name)||t[l.value].push(l.name):t[l.value]=[l.name],c[l.name]=l.value;var u=i>0?e[i-1].post:"";null==r[l.name]&&(r[l.name]={index:i,value:l.value,offset:e[i].offset,text:e[i].text,section:e[i].section,length:e[i].length}),r[l.name].value===l.value&&(r[l.name].length=e[i].offset+e[i].length-r[l.name].offset,r[l.name].text+=u+e[i].pre+e[i].post)}}}catch(w){s.e(w)}finally{s.f()}for(var d=0,j=Object.keys(r);d<j.length;d++){var b=j[d];null!=c[b]?c[b]!==r[b].value&&(n.push(r[b]),r[b]={index:i,code:c[b],offset:e[i].offset,text:e[i].text,section:e[i].section,length:e[i].length}):(n.push(r[b]),delete r[b])}if(i<e.length-1&&e[i+1].section!==a){for(var f=0,h=Object.values(r);f<h.length;f++){var p=h[f];n.push(p)}r={},a=e[i].section}else;}else{for(var v=0,O=Object.values(r);v<O.length;v++){var x=O[v];n.push(x)}r={}}for(var m=0,k=Object.values(r);m<k.length;m++){var y=k[m];n.push(y)}return n},T=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(0===e.length)return Object(x.a)({},n);var r,a=U(e),i={},o=[],c=Object(g.a)(t);try{for(c.s();!(r=c.n()).done;){var s=r.value;q(s,a,i,o)}}catch(C){c.e(C)}finally{c.f()}for(var l={},u=[],d=0,j=o;d<j.length;d++){var b=j[d];l[b.variable]||(l[b.variable]=0),l[b.variable]++,u.push(b)}for(var f=[],h=0,p=u;h<p.length;h++)for(var v=p[h],O=v.span[0];O<=v.span[1];O++){var m=Object(x.a)({},v);m.index=O,f.push(m)}for(var k=0,y=u;k<y.length;k++){var w=y[k];n=D(n,w,!1)}return n},D=function(e,t,n){for(var r=t.span[0];r<=t.span[1];r++){var a=t;if(e[r]&&e[r][a.variable])for(var i=e[r][a.variable].span,o=i[0];o<=i[1];o++)e[o]&&e[o][a.variable]&&(delete e[o][a.variable],0===Object.keys(e[o]).length&&delete e[o]);n||(e[r]||(e[r]={}),e[r][a.variable]={index:r,span:[a.span[0],a.span[1]],length:a.length,value:a.value,section:a.section,offset:a.offset})}return e},U=function(e){return e&&""!==e?e.reduce((function(e,t){return e[t.section]||(e[t.section]={}),e[t.section][t.offset]||(e[t.section][t.offset]={start:[],end:[]}),e[t.section][t.offset+t.length]||(e[t.section][t.offset+t.length]={start:[],end:[]}),e[t.section][t.offset].start.push(t),e[t.section][t.offset+t.length].end.push(t.variable),e}),{}):{}},q=function(e,t,n,r){var a=e.offset,i=e.offset+e.length;if(t[e.section])for(var o=t[e.section],c=a;c<=i;c++)if(o[c]){var s,l=Object(g.a)(o[c].start);try{for(l.s();!(s=l.n()).done;){var u=s.value;n[u.variable]=Object(x.a)({},e),n[u.variable].variable=u.variable,n[u.variable].value=u.value,n[u.variable].offset=a,n[u.variable].length=null,n[u.variable].span=[e.index]}}catch(f){l.e(f)}finally{l.f()}var d,j=Object(g.a)(o[c].end);try{for(j.s();!(d=j.n()).done;){var b=d.value;n[b]&&(n[b].span.push(e.index),n[b].length=e.offset+e.length-n[b].offset,r.push(n[b]),delete n[b])}}catch(f){j.e(f)}finally{j.f()}}},N=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"TEMP",r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=new Set(t),i=0,o={},c=e.reduce((function(e,t){var r=S()([t,n]);return a.has(r)?i++:(a.add(r),e.push(Object(x.a)({doc_uid:r,job_id:n},F(t,o)))),e}),[]);if(!r){var s="Created ".concat(e.length-i," new documents.");i>0&&(s+=" Ignored ".concat(i," duplicates")),alert(s)}return[c,o=Object.keys(o).reduce((function(e,t){if(1===o[t].length)""!==o[t][0]&&e.push({code:t,parent:o[t][0],active:!0});else{var n,r=Object(g.a)(o[t]);try{for(r.s();!(n=r.n()).done;){var a=n.value;""!==a&&e.push({code:"".concat(t," (").concat(a,")"),parent:a,active:!0})}}catch(i){r.e(i)}finally{r.f()}}return e}),[])]},F=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=Object(x.a)({},e);n.tokens?n.tokens=R(e.tokens):(!n.text_fields&&n.text&&(n.text_fields=[{name:"text",value:n.text}]),n.tokens=E(Object(_.a)(n.text_fields))),n.tokens.length>0?(n.n_paragraphs=n.tokens[n.tokens.length-1].paragraph,n.n_sentences=n.tokens[n.tokens.length-1].sentence):(n.n_paragraphs=0,n.n_sentences=0),n.annotations?n.annotations=T(Object(_.a)(n.annotations),n.tokens):n.annotations={};var r=z(n.tokens,t);return r.length>0&&(n.annotations.span=T(r,n.tokens,n.annotations)),n},M="CSSannotator_V1",L={codingjobs:"job_id, name",documents:"doc_uid, job_id",tasks:"[title+url], last_modified, url",deployedJobs:"url",localJobs:"[title+id], last_modified, id",localAnnotations:"[id+unit_id], id"},P=function(){function e(){Object(k.a)(this,e),this.idb=new w.default(M);try{this.idb.version(2).stores(L)}catch(t){this.idb.delete(),this.idb=new w.default(M),this.idb.version(2).stores(L)}}return Object(y.a)(e,[{key:"createCodingjob",value:function(){var e=Object(b.a)(j.a.mark((function e(t){var n,r=arguments;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n=r.length>1&&void 0!==r[1]?r[1]:null)||(n=S()([t,Date.now().toString()])),this.idb.codingjobs.add({job_id:n,name:t}),e.abrupt("return",{job_id:n,name:t});case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"deleteCodingjob",value:function(){var e=Object(b.a)(j.a.mark((function e(t){var n;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.idb.documents.where("job_id").equals(t.job_id);case 2:return n=e.sent,e.next=5,n.count();case 5:return e.sent>0&&n.delete(),e.abrupt("return",this.idb.codingjobs.delete(t.job_id));case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getCodingjobProp",value:function(){var e=Object(b.a)(j.a.mark((function e(t,n){var r;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.idb.codingjobs.get(t.job_id);case 2:return r=e.sent,e.abrupt("return",r[n]);case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"setCodingjobProp",value:function(){var e=Object(b.a)(j.a.mark((function e(t,n,r){var a;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.idb.codingjobs.get(t.job_id);case 2:return null==(a=e.sent).settings&&(a.settings={}),e.abrupt("return",this.idb.codingjobs.where("job_id").equals(t.job_id).modify(Object(m.a)({},n,r)));case 5:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"writeCodebook",value:function(){var e=Object(b.a)(j.a.mark((function e(t,n){return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("writing to db"),e.abrupt("return",this.idb.codingjobs.where("job_id").equals(t.job_id).modify({codebook:n}));case 2:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"writeCodes",value:function(){var e=Object(b.a)(j.a.mark((function e(t,n){var r,a,i,o,c,s,l,u,d,b=arguments;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=b.length>2&&void 0!==b[2]&&b[2],e.next=3,this.idb.codingjobs.get(t.job_id);case 3:if(a=e.sent,(i=a.codebook?a.codebook:{}).codes&&r||(i.codes=n),o=i.codes.reduce((function(e,t,n){return e.codeMap[t.code]={parent:t.parent,index:n},e.parentMap[t.parent]=!0,e}),{codeMap:{},parentMap:{}}),!r){e.next=33;break}c=Object(g.a)(n),e.prev=9,c.s();case 11:if((s=c.n()).done){e.next=25;break}if(l=s.value,!o.codeMap[l.code]){e.next=21;break}if(l.parent!==o.codeMap[l.code].parent){e.next=16;break}return e.abrupt("continue",23);case 16:u=H(l.code+" ("+l.parent+")",o.codeMap,o.parentMap),i.codes[o.codeMap[l].index].code=u,i.codes.push(Object(x.a)(Object(x.a)({},l),{},{code:u,parent:l.parent})),e.next=23;break;case 21:d=H(l.code,o.codeMap,o.parentMap,2),i.codes.push(Object(x.a)(Object(x.a)({},l),{},{code:d,parent:l.parent}));case 23:e.next=11;break;case 25:e.next=30;break;case 27:e.prev=27,e.t0=e.catch(9),c.e(e.t0);case 30:return e.prev=30,c.f(),e.finish(30);case 33:return i.codes=i.codes.filter((function(e){return""!==e.code})),e.next=36,this.writeCodebook(t,i);case 36:return e.abrupt("return",e.sent);case 37:case"end":return e.stop()}}),e,this,[[9,27,30,33]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"createDocuments",value:function(){var e=Object(b.a)(j.a.mark((function e(t,n){var r,a,i,o,c,s,l=arguments;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=l.length>2&&void 0!==l[2]&&l[2],e.t0=Set,e.next=4,this.idb.documents.where("job_id").equals(t.job_id).primaryKeys();case 4:return e.t1=e.sent,a=new e.t0(e.t1),i=N(n,a,t.job_id,r),o=Object(f.a)(i,2),c=o[0],s=o[1],this.writeCodes(t,s,!0),e.abrupt("return",this.idb.documents.bulkAdd(c));case 9:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"deleteDocuments",value:function(){var e=Object(b.a)(j.a.mark((function e(t){var n;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.map((function(e){return e.doc_uid})),e.abrupt("return",this.idb.documents.bulkDelete(n));case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getJobDocuments",value:function(){var e=Object(b.a)(j.a.mark((function e(t,n,r){var a,i;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(null!==n&&n<0)){e.next=2;break}return e.abrupt("return",null);case 2:return e.next=4,this.idb.documents.where("job_id").equals(t.job_id);case 4:return a=e.sent,e.next=7,a.count();case 7:if(i=e.sent,!(null!==n&&n>i-1)){e.next=10;break}return e.abrupt("return",null);case 10:return null!==r&&(a=a.offset(n).limit(r)),e.abrupt("return",a.toArray());case 12:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"getJobDocumentCount",value:function(){var e=Object(b.a)(j.a.mark((function e(t){return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.idb.documents.where("job_id").equals(t.job_id).count());case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getDocuments",value:function(){var e=Object(b.a)(j.a.mark((function e(t){return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.idb.documents.where("job_id").equals(t.job_id));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getDocument",value:function(){var e=Object(b.a)(j.a.mark((function e(t){return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.idb.documents.get(t));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"writeTokens",value:function(){var e=Object(b.a)(j.a.mark((function e(t,n){return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.idb.documents.where("doc_uid").equals(t.doc_uid).modify({tokens:n}));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"createDeployedJob",value:function(){var e=Object(b.a)(j.a.mark((function e(t,n){return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.idb.deployedJobs.get({url:n});case 2:e.sent?this.idb.deployedJobs.get({url:n}).modify({created:new Date}):this.idb.deployedJobs.add({title:t,url:n,created:new Date});case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"createLocalJob",value:function(){var e=Object(b.a)(j.a.mark((function e(t,n){return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.idb.localJobs.get({id:n});case 2:e.sent?alert("This job has already been created before"):this.idb.localJobs.add(Object(x.a)(Object(x.a)({},t),{},{id:n,last_modified:new Date}));case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getUnitAnnotations",value:function(){var e=Object(b.a)(j.a.mark((function e(t,n){return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.idb.localAnnotations.get({id:t,unit_id:n}));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getAllAnnotations",value:function(){var e=Object(b.a)(j.a.mark((function e(t){return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.idb.localAnnotations.where("id").equals(t).toArray());case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"postAnnotations",value:function(){var e=Object(b.a)(j.a.mark((function e(t,n,r){return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.idb.localAnnotations.put({unit_id:n,id:t,annotations:r},[t,n]));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"deleteDB",value:function(){var e=Object(b.a)(j.a.mark((function e(){return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.idb.delete();case 2:this.idb=new w.default(M),this.idb.version(2).stores(L);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}(),H=function e(t,n,r,a){if(!n[t]&&!r[t])return t;a>2&&(t=t.slice(0,t.length-t.toString().length)),e(t+=" "+a,n,a+1)},B=new P,W=n(0),G=function(){var e=Object(r.useState)(!1),t=Object(f.a)(e,2),n=t[0],a=t[1],i=Object(c.f)(),o=function(){var e=Object(b.a)(j.a.mark((function e(){return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,B.deleteDB();case 3:a(!1),i.push("/"),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),console.log(e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(){return e.apply(this,arguments)}}();return Object(W.jsxs)(h.a,{closeIcon:!0,open:n,trigger:Object(W.jsx)(l.a.Item,{icon:"rocket",name:"Reset",style:{color:"#d7a3a3"}}),onClose:function(){return a(!1)},onOpen:function(){return a(!0)},children:[Object(W.jsx)(p.a,{icon:"power off",content:"Reset Annotator Database"}),Object(W.jsx)(h.a.Content,{children:Object(W.jsx)("p",{children:"This will remove all document and annotation data from your browser. Any annotations that have not been saved/synchronized will be lost. Are you absolutely sure?"})}),Object(W.jsxs)(h.a.Actions,{children:[Object(W.jsxs)(v.a,{color:"red",onClick:function(){a(!1)},children:[Object(W.jsx)(O.a,{name:"remove"})," No"]}),Object(W.jsxs)(v.a,{color:"green",onClick:o,children:[Object(W.jsx)(O.a,{name:"checkmark"})," Yes"]})]})]})};function V(){return J.apply(this,arguments)}function J(){return(J=Object(b.a)(j.a.mark((function e(){return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,navigator.storage;case 2:if(e.t0=e.sent,!e.t0){e.next=5;break}e.t0=navigator.storage.persist;case 5:if(!e.t0){e.next=9;break}e.t1=navigator.storage.persist(),e.next=10;break;case 9:e.t1=void 0;case 10:return e.abrupt("return",e.t1);case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Y(){return K.apply(this,arguments)}function K(){return(K=Object(b.a)(j.a.mark((function e(){return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,navigator.storage;case 2:if(e.t0=e.sent,!e.t0){e.next=5;break}e.t0=navigator.storage.persisted;case 5:if(!e.t0){e.next=9;break}e.t1=navigator.storage.persisted(),e.next=10;break;case 9:e.t1=void 0;case 10:return e.abrupt("return",e.t1);case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Q=function(){var e=Object(r.useState)(!1),t=Object(f.a)(e,2),n=t[0],a=t[1],i=Object(r.useState)(!1),o=Object(f.a)(i,2),c=o[0],s=o[1];Object(r.useEffect)((function(){c||Y().then(s)}),[c]);var u=function(){var e=Object(b.a)(j.a.mark((function e(){return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,V();case 2:return e.next=4,Y();case 4:e.sent?(s(!0),alert("indexedDB set to persistent for AmCAT Annotator")):alert("Failed to set indexedDB to persistent");case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return c?null:Object(W.jsxs)(h.a,{closeIcon:!0,open:n,trigger:Object(W.jsx)(l.a.Item,{icon:"database",name:"Enable persitance",style:{color:"#d7a3a3"}}),onClose:function(){return a(!1)},onOpen:function(){return a(!0)},children:[Object(W.jsx)(p.a,{icon:"database",content:"Set database persistence"}),Object(W.jsxs)(h.a.Content,{children:[Object(W.jsx)("p",{children:"We did not have permission to automatically make the data storage for this website persistent. This means that the data could be removed automatically by your browser if it needs to free up space for another website. You can try to set this manually here, but not all browsers support this (yet)."}),Object(W.jsx)("p",{children:"If the database is not persistent the app can still be used, but you need to be more carefull in making sure that data is regularly backed up, either by manually downloading data or syncing with some backend (work in progress)."})]}),Object(W.jsx)(h.a.Actions,{children:Object(W.jsxs)(v.a,{onClick:u,children:[Object(W.jsx)(O.a,{name:"checkmark"})," Yes"]})})]})},X=n(83),Z=n.n(X);function $(e,t,n){return ee.apply(this,arguments)}function ee(){return(ee=Object(b.a)(j.a.mark((function e(t,n,r){var a;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Z.a.get("".concat(t,"/auth/token/"),{auth:{username:n,password:r}});case 2:return a=e.sent,e.abrupt("return",a.data.token);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function te(e,t,n){return new ne(e,t,n)}var ne=function(){function e(t,n,r){Object(k.a)(this,e),this.host=t,this.email=n,this.api=Z.a.create({baseURL:t,headers:{Authorization:"Bearer ".concat(r)}})}return Object(y.a)(e,[{key:"postCodingjob",value:function(e,t){return e.title=t,this.api.post("/codingjob",{title:t,units:e.units,codebook:e.codebook,provenance:e.provenance,rules:{}})}}]),e}(),re=n(340),ae=n(330),ie=n(338),oe=n(333),ce=n(344),se="blue",le=function(e){var t=e.setOpen,n=e.setCookie,a=Object(r.useState)("https://amcat4.labs.vu.nl/api"),i=Object(f.a)(a,2),o=i[0],c=i[1],s=Object(r.useState)("admin"),l=Object(f.a)(s,2),u=l[0],d=l[1],h=Object(r.useState)("admin"),O=Object(f.a)(h,2),x=O[0],g=O[1],m=Object(r.useState)("idle"),k=Object(f.a)(m,2),y=k[0],w=k[1],C=function(){var e=Object(b.a)(j.a.mark((function e(){var r;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return w("waiting"),e.prev=1,e.next=4,$(o,u,x);case 4:(r=e.sent)?(n("amcat",JSON.stringify({host:o,email:u,token:r}),{path:"/"}),w("success"),t(!1)):w("error"),e.next=12;break;case 8:e.prev=8,e.t0=e.catch(1),console.log(e.t0),w("error");case 12:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(){return e.apply(this,arguments)}}();return Object(W.jsx)(re.a,{inverted:!0,textAlign:"center",style:{height:"50%"},verticalAlign:"middle",children:Object(W.jsxs)(re.a.Column,{style:{maxWidth:450},children:[Object(W.jsx)(p.a,{as:"h2",color:se,textAlign:"center",children:"Connect to AmCAT server"}),Object(W.jsx)(ae.a,{size:"large",children:Object(W.jsxs)(ie.a,{stacked:!0,children:[Object(W.jsx)(ae.a.Input,{fluid:!0,error:"error"===y,value:o,onChange:function(e,t){var n=t.value;w("idle"),c(n)},icon:"home",iconPosition:"left",placeholder:"Host"}),Object(W.jsx)(ae.a.Input,{fluid:!0,error:"error"===y,value:u,onChange:function(e,t){var n=t.value;w("idle"),d(n)},icon:"user",iconPosition:"left",placeholder:"Email adress"}),Object(W.jsx)(ae.a.Input,{fluid:!0,error:"error"===y,value:x,onChange:function(e,t){var n=t.value;w("idle"),g(n)},icon:"lock",iconPosition:"left",placeholder:"Password",type:"password"}),Object(W.jsx)(v.a,{onClick:C,color:se,fluid:!0,size:"large",children:"Login"})]})}),Object(W.jsx)(oe.a,{children:"Don't have an account? Too bad"})]})})},ue=function(){var e=Object(r.useState)(!1),t=Object(f.a)(e,2),n=t[0],a=t[1],i=Object(ce.a)(["amcat"]),o=Object(f.a)(i,2),c=o[0],s=o[1];return Object(W.jsxs)(h.a,{closeIcon:!0,open:n,trigger:Object(W.jsx)(l.a.Item,{icon:null==c.amcat?"toggle off":"toggle on",name:"AmCAT",style:{color:null==c.amcat?"red":"green"}}),onClose:function(){return a(!1)},onOpen:function(){return a(!0)},children:[Object(W.jsx)(p.a,{icon:"database",content:"Connect to AmCAT server"}),Object(W.jsx)(h.a.Content,{children:Object(W.jsx)(le,{setOpen:a,setCookie:s})})]})},de=function(){var e=Object(r.useState)(!1),t=Object(f.a)(e,2),n=t[0],a=t[1],i=Object(r.useState)(""),o=Object(f.a)(i,2),c=o[0],s=o[1],u=Object(ce.a)(["name"]),d=Object(f.a)(u,2),j=d[0],b=d[1],O=function(){c.length<5||(b("name",c,{path:"/"}),a(!1))};return Object(r.useEffect)((function(){j.name&&s(j.name)}),[j.name]),Object(W.jsxs)(h.a,{closeIcon:!0,open:n,trigger:Object(W.jsx)(l.a.Item,{icon:null==j.name?"toggle off":"toggle on",name:"Name",style:{color:null==j.name?"red":"green"}}),style:{width:"23em"},onClose:function(){return a(!1)},onOpen:function(){return a(!0)},children:[Object(W.jsx)(p.a,{icon:"user",content:"Set user name"}),Object(W.jsx)(h.a.Content,{children:Object(W.jsx)(ae.a,{onSubmit:O,children:Object(W.jsx)(ae.a.Input,{placeholder:"username",value:c,onChange:function(e,t){t.value.length<50&&s(t.value)},autoFocus:!0,style:{width:"18em"}})})}),Object(W.jsx)(h.a.Actions,{children:Object(W.jsx)(v.a,{primary:!0,disabled:c.length<5,onClick:O,children:c.length<5?"please use 5 characters or more":"Set user name"})})]})},je=Object(c.h)((function(e){var t=e.items,n=e.children,r=Object(c.g)(),a=t.map((function(e,t){return e.menu?Object(W.jsx)(l.a.Item,{index:t,as:s.b,to:e.path,header:0===t,active:e.path===r.pathname,children:e.label},"item-"+t):null}));return"/annotator"===r.pathname?n:Object(W.jsxs)(u.a.Pushable,{style:{height:"100vh"},children:[Object(W.jsxs)(u.a,{as:l.a,inverted:!0,animation:"push",visible:!0,direction:"top",size:"mini",children:[a,Object(W.jsxs)(l.a.Menu,{position:"right",children:[Object(W.jsx)(de,{}),Object(W.jsx)(ue,{}),Object(W.jsx)(Q,{}),Object(W.jsx)(G,{})]})]}),Object(W.jsx)(u.a.Pusher,{children:n})]})})),be=n(334),fe=n(58),he=n(324),pe=n(337),ve=n(325),Oe=n(126),xe=n(219),ge=n(113),me=n(98),ke=n(343),ye=n(121),we=n(176),Ce=n(342),Se=function(e){e.preGlobalFilteredRows;var t=e.globalFilter,n=e.setGlobalFilter;return Object(W.jsx)("span",{children:Object(W.jsx)("input",{value:t||"",onChange:function(e){n(e.target.value||void 0)},placeholder:"Enter search term",style:{border:"0"}})})},_e=function(e){var t=e.columns,n=e.data,a=e.selectedRow,i=e.setSelectedRow,o=e.width,c=void 0===o?null:o,s=e.defaultSize,l=void 0===s?15:s,u=Object(r.useState)(a?a.ROW_ID:null),d=Object(f.a)(u,2),j=d[0],b=d[1],h=Object(Oe.useTable)({columns:t,data:n,initialState:{pageIndex:a?Math.floor(Number(a.ROW_ID)/l):0,pageSize:l,globalFilter:""}},Oe.useGlobalFilter,Oe.useSortBy,Oe.usePagination),p=h.getTableProps,v=h.getTableBodyProps,g=h.headerGroups,m=h.prepareRow,k=h.page,y=h.pageCount,w=h.gotoPage,C=h.preGlobalFilteredRows,S=h.setGlobalFilter,_=h.state,A=_.pageIndex,I=_.globalFilter;Object(r.useEffect)((function(){b(a?a.ROW_ID:null)}),[a]);var E=function(e){return e.headers.map((function(e){return Object(W.jsxs)(xe.a,Object(x.a)(Object(x.a)({className:e.headerClass},e.getHeaderProps(e.getSortByToggleProps())),{},{children:[e.render("Header"),Object(W.jsx)("span",{children:e.isSorted?e.isSortedDesc?" \ud83d\udd3d":" \ud83d\udd3c":""})]}))}))};return Object(W.jsxs)("div",{style:{width:c},children:[Object(W.jsx)(Se,{preGlobalFilteredRows:C,globalFilter:I,setGlobalFilter:S}),Object(W.jsxs)(ke.a,Object(x.a)(Object(x.a)({compact:!0,unstackable:!0,fixed:!0,singleLine:!0,selectable:!0},p()),{},{size:"small",style:{fontSize:"10px",overflowY:"auto"},children:[Object(W.jsx)(ye.a,{children:g.map((function(e){return Object(W.jsx)(ge.a,Object(x.a)(Object(x.a)({},e.getHeaderGroupProps()),{},{children:E(e)}))}))}),Object(W.jsx)(we.a,Object(x.a)(Object(x.a)({},v()),{},{children:function(e){return e.map((function(e,t){return m(e),Object(W.jsx)(ge.a,Object(x.a)(Object(x.a)({active:!!j&&j===e.id,onClick:function(){return function(e){if(!i)return null;j&&j===e.id||(i(Object(x.a)(Object(x.a)({},n[e.id]),{},{ROW_ID:e.id})),b(e.id))}(e)}},e.getRowProps()),{},{children:e.cells.map((function(e){return Object(W.jsx)(me.a,Object(x.a)(Object(x.a)({title:e.value},e.getCellProps()),{},{children:e.render("Cell")}))}))}))}))}(k)})),Object(W.jsx)(ke.a.Footer,{children:Object(W.jsx)(ke.a.Row,{children:Object(W.jsx)(ke.a.HeaderCell,{colSpan:t.length,children:n.length>l?Object(W.jsx)(Ce.a,{floated:"right",style:{border:"0"},size:"mini",firstItem:!1,lastItem:!1,nextItem:!1,prevItem:!1,boundaryRange:1,ellipsisItem:{content:Object(W.jsx)(O.a,{name:"ellipsis horizontal"}),icon:!0},activePage:A+1,totalPages:y,onPageChange:function(e,t){w(t.activePage-1)}}):null})})})]}))]})},Ae={codes:[{code:"VVD",parent:"Actor",active:!0},{code:"D66",parent:"Actor",active:!0},{code:"Groenlinks",parent:"Actor",active:!0},{code:"Mark Rutte",parent:"VVD",active:!0},{code:"Sigrid Kaag",parent:"D66",active:!0},{code:"Jesse Klaver",parent:"Groenlinks",active:!0},{code:"Climate change",parent:"Issue",active:!0}]},Ie=[{document_id:"Some document ID",text_fields:[{name:"title",value:"GL en PvdA hebben goed gesprek met informateur, maar wantrouwen Rutte"},{name:"text",value:'PvdA-leider Lilianne Ploumen en GroenLinks-leider Jesse Klaver hadden vrijdag een goed gesprek met informateur Herman Tjeenk Willink, zeiden ze zelf. De twee benadrukten dat, hoewel er inhoudelijke stappen zijn gezet, hun vertrouwen in VVD-leider Mark Rutte nog niet is hersteld.\n\n    Informateur Willink zette zich vrijdag aan zijn taak. Eerste punt op de agenda zijn gesprekken met de lijsttrekkers van de acht grootste partijen.\n    \n    Een week nadat een groot deel van de partijleiders bekendmaakte niet meer met Rutte verder te willen onderhandelen over een nieuwe coalitie, wordt gekeken waarover partijen het inhoudelijk eens zijn.\n    \n    "Het was een prettig gesprek langs de lijnen van de inhoud", zei PvdA-leider Lilianne Ploumen na afloop. Ze heeft haar zorgen over de ongelijkheid in Nederland en over de zorg gedeeld.\n    \n    Ook Jesse Klaver (GroenLinks), die een uur eerder op gesprek kwam bij de informateur, benadrukte dat het ging over de problemen die opgelost moeten worden.\n    \n    Situatie niet veranderd in een week\n\nWat betreft de positie ten opzichte van Rutte is echter niets veranderd. Vorige week ondertekenden Ploumen en Klaver net als alle andere oppositiepartijen een motie van wantrouwen, vanwege Ruttes betrokkenheid bij de notitie over CDA-Kamerlid Pieter Omtzigt.\n\n"Als het aan ons ligt, was Rutte geen premier meer", zei Ploumen. Hoe Tjeenk Willink dat gedeukte vertrouwen kan herstellen, weet ze niet. "We wachten de voorstellen van de informateur af."\n\n"De vertrouwensbreuk is niet hersteld na \xe9\xe9n gesprek met de fractievoorzitters", zei ook Klaver. "Mijn mening over Rutte is niet veranderd."\n\nSP\'er Lilian Marijnissen sprak zich al eerder expliciet uit tegen samenwerking met Rutte.\n\nDe partijleiders hekelen het gebrek aan openheid en transparantie waar Rutte in hun ogen voor staat. "Als je een fout maakt, dan moet je dat toegeven en er niet over liegen", zei Klaver. Ploumen: "Het probleem is dat Mark Rutte heeft gelogen. Wij hebben het vertrouwen in hem opgezegd."\n\nWat de vervolgstappen moeten zijn, laten ze volledig over aan Tjeenk Willink. "Ik ga geen lijstjes maken met wat er moet gebeuren", zei Ploumen.\n\nDe informateur ontvangt later op vrijdag nog de partijleiders Wopke Hoekstra (CDA) en Sigrid Kaag (D66), en Rutte zelf.\n\nTjeenk Willink denkt niet dat Rutte zomaar door kan\n\nTjeenk Willink suggereerde woensdag op een persconferentie dat hij Rutte niet per se een sta-in-de-weg voor een verandering van de bestuursstijl in Den Haag vindt. Toen daarover vervolgens berichten in de media verschenen, voelde de informateur zich vrijdag genoodzaakt die boodschap bij te sturen.\n\nDe conclusie dat Rutte geen belemmering vormt voor de formatie, kan hij niet voor zijn rekening nemen, luidt een schriftelijke verklaring.\n\nTjeenk Willink heeft namelijk ook de opdracht om te onderzoeken "of en zo ja onder welke voorwaarden er voldoende vertrouwen tussen partijen bestaat of weer kan ontstaan".'}]},{document_id:"Another document ID",text_fields:[{name:"title",value:"CU-leider Segers vindt dat uitspraak over Rutte te veel op de man was gespeeld"},{name:"text",value:'Partijleider Gert-Jan Segers van de ChristenUnie (CU) vindt dat hij te veel op de man heeft gespeeld door coalitiedeelname uit te sluiten als VVD-leider Mark Rutte opnieuw premier zou worden. Terugblikkend zegt hij dat het niet om \xe9\xe9n persoon moet gaan, maar om "een ongezonde politieke cultuur en een genadeloze overheid". Daar moet volgens hem verandering in komen, zo zei hij zaterdag tijdens een congres van de partij.\n\n    \n    Segers deed zijn uitspraak over Rutte na het debat over de notitie "functie elders" voor CDA-Kamerlid Pieter Omtzigt. Binnen de CU is verdeeldheid ontstaan over het besluit van de fractie, erkent Segers.\n    \n    Naast steun is er ook kritiek van veel leden, die zeggen dat hij "te veel op de man heeft gespeeld en te weinig de bal". "Te veel Rutte, te weinig ons allemaal. En als dat de perceptie van veel mensen is, dan moet ik me dat aantrekken", aldus Segers tijdens het congres.\n    \n    \n    Volgens de CU-leider staat "de politieke cultuur in Den Haag natuurlijk niet los van Mark Rutte, zeker niet".\n    \n    "Maar die oude cultuur staat of valt niet met \xe9\xe9n man. Ook wijzelf maken er deel van uit. Ik wil niet genadeloos zijn voor personen, maar ik wil wel hard en helder zijn over een cultuur die niet deugt en een genadeloze overheid. Daar moet \xe9cht een omslag in komen", zei Segers.\n    \n    \n    De ChristenUnie heeft vijf zetels in de Tweede Kamer. Op het congres werden vier oude Kamerleden uitgezwaaid en trad Ankie van Tatenhove aan als nieuwe partijvoorzitter.'}]}],Ee=function(e){var t=e.codingjob,n=e.setSelectedCodingjob,a=Object(fe.useLiveQuery)((function(){return B.idb.codingjobs.toArray()}));Object(r.useEffect)((function(){!(null===t||void 0===t?void 0:t.job_id)&&a&&n(a.length>0?Object(x.a)(Object(x.a)({},a[0]),{},{ROW_ID:"0"}):null)}),[t,a,n]);var i=[{Header:"Coding job",accessor:"name",headerClass:"thirteen wide"}];return Object(W.jsx)(re.a,{centered:!0,stackable:!0,columns:1,children:Object(W.jsxs)(re.a.Column,{width:6,children:[Object(W.jsx)(p.a,{textAlign:"center",style:{background:"#1B1C1D",color:"white"},children:"Select Codingjob"}),Object(W.jsxs)(ie.a,{style:{border:"0"},children:[Object(W.jsxs)(v.a.Group,{widths:"2",size:"mini",children:[Object(W.jsx)(ze,{setSelectedCodingjob:n}),Object(W.jsx)(Te,{codingjob:t,setCodingjob:n})]}),Object(W.jsx)(he.a,{style:{marginTop:"30px",overflow:"auto",width:"800px"},children:a?0===a.length?Object(W.jsx)("div",{style:{textAlign:"center"},children:Object(W.jsx)(v.a,{primary:!0,onClick:function(){return Re()},children:"Create Demo job"})}):Object(W.jsx)(_e,{columns:i,data:a||[],selectedRow:t,setSelectedRow:n,defaultSize:15}):null})]})]})})},Re=function(){var e=Object(b.a)(j.a.mark((function e(){var t;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,B.idb.codingjobs.get({name:"Demo codingjob"});case 3:if(!e.sent){e.next=6;break}return e.abrupt("return",null);case 6:return e.next=8,B.createCodingjob("Demo codingjob");case 8:return t=e.sent,e.next=11,B.createDocuments(t,Ie,!0);case 11:return e.next=13,B.writeCodebook(t,Ae);case 13:return e.abrupt("return",null);case 16:e.prev=16,e.t0=e.catch(0),console.log(e.t0);case 19:case"end":return e.stop()}}),e,null,[[0,16]])})));return function(){return e.apply(this,arguments)}}(),ze=function(e){var t=e.setSelectedCodingjob,n=Object(r.useState)("inactive"),a=Object(f.a)(n,2),i=a[0],o=a[1],c=Object(r.useState)(""),s=Object(f.a)(c,2),l=s[0],u=s[1],d=function(){var e=Object(b.a)(j.a.mark((function e(n){return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.preventDefault(),u(l.trim()),o("pending"),e.prev=3,e.next=6,B.createCodingjob(l);case 6:t(null),o("inactive"),e.next=14;break;case 10:e.prev=10,e.t0=e.catch(3),console.log(e.t0),o("error");case 14:case"end":return e.stop()}}),e,null,[[3,10]])})));return function(t){return e.apply(this,arguments)}}();return Object(W.jsxs)(h.a,{as:ae.a,trigger:Object(W.jsxs)(v.a,{children:[Object(W.jsx)(O.a,{name:"plus"}),"Create job"]}),onSubmit:function(e){return d(e)},open:"inactive"!==i,onClose:function(){return o("inactive")},onOpen:function(){u(""),o("awaiting input")},size:"tiny",children:[Object(W.jsx)(p.a,{icon:"pencil",content:"Create new Codingjob",as:"h2"}),Object(W.jsx)(h.a.Content,{children:Object(W.jsx)(ae.a.Group,{children:Object(W.jsx)(ae.a.Input,{width:12,label:"Name",required:!0,type:"text",value:l,onChange:function(e,t){o("awaiting input"),u(t.value)},placeholder:"Enter name"})})}),Object(W.jsxs)(h.a.Actions,{children:["error"===i?Object(W.jsx)("div",{children:"Could not create codingjob for a reason not yet covered in the error handling..."}):null,"pending"===i?Object(W.jsx)(pe.a,{active:!0,inverted:!0,children:Object(W.jsx)(ve.a,{content:"Creating codingjob"})}):Object(W.jsx)(v.a,{type:"submit",color:"green",icon:"save",content:"Create"})]})]})},Te=function(e){var t=e.codingjob,n=e.setCodingjob,a=Object(r.useState)("inactive"),i=Object(f.a)(a,2),o=i[0],c=i[1],s=function(){var e=Object(b.a)(j.a.mark((function e(r){return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c("pending"),e.prev=1,e.next=4,B.deleteCodingjob(t);case 4:n(null),c("inactive"),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),c("error");case 11:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t){return e.apply(this,arguments)}}();return(null===t||void 0===t?void 0:t.job_id)?Object(W.jsxs)(h.a,{closeIcon:!0,open:"inactive"!==o,trigger:Object(W.jsxs)(v.a,{compact:!0,children:[Object(W.jsx)(O.a,{name:"minus"})," Delete job"]}),onClose:function(){c("inactive")},onOpen:function(){c("awaiting input")},children:[Object(W.jsx)(p.a,{icon:"trash",content:"Delete codingjob ".concat(t.name)}),Object(W.jsx)(h.a.Content,{children:Object(W.jsx)("p",{children:"Do you really want to delete this codingjob?"})}),Object(W.jsxs)(h.a.Actions,{children:["error"===o?Object(W.jsx)("div",{children:"Could not delete codingjob for a reason not yet covered in the error handling..."}):null,"pending"===o?Object(W.jsx)(pe.a,{active:!0,inverted:!0,children:Object(W.jsx)(ve.a,{content:"Deleting codingjob"})}):Object(W.jsxs)(W.Fragment,{children:[Object(W.jsxs)(v.a,{color:"red",onClick:function(){c("inactive")},children:[Object(W.jsx)(O.a,{name:"remove"})," No"]}),Object(W.jsxs)(v.a,{color:"green",onClick:s,children:[Object(W.jsx)(O.a,{name:"checkmark"})," Yes"]})]})]})]}):null},De=a.a.memo(Ee),Ue=n(329),qe=n(149),Ne=function(e){var t=e.codingjob;return Object(W.jsx)(Pe,{codingjob:t,type:"texts",columns:{document_id:{required:!0,multiple:!1,defaults:["doc_id","document_id"]},text_fields:{required:!0,multiple:!0,defaults:["title","headline","body","message","text"]}}})},Fe=function(e,t,n,r){return Object(W.jsx)(W.Fragment,{children:Object(W.jsxs)(ae.a.Group,{widths:"equal",children:[We("document id","document_id",e,t,n,r),We("text fields","text_fields",e,t,n,r)]})})},Me=function(e){var t=e.codingjob;return Object(W.jsx)(Pe,{codingjob:t,type:"tokens",columns:{document_id:{required:!0,multiple:!1,defaults:["doc_id","document_id"]},token:{required:!0,multiple:!1,defaults:["token","text"]},sentence:{required:!1,multiple:!1,defaults:["sentence","sentence_id"]},paragraph:{required:!1,multiple:!1,defaults:["paragraph","paragraph_id"]},offset:{required:!1,int:!0,multiple:!1,defaults:["offset","start"]},end:{required:!1,int:!0,multiple:!1,defaults:["end"]},post:{required:!1,multiple:!1,defaults:["post","space"]},section:{required:!1,multiple:!1,defaults:["section"]},annotations:{required:!1,multiple:!0,defaults:[]}}})},Le=function(e,t,n,r){return Object(W.jsxs)(W.Fragment,{children:[Object(W.jsxs)(ae.a.Group,{widths:"equal",children:[We("document id","document_id",e,t,n,r),We("token","token",e,t,n,r),We("paragraph","paragraph",e,t,n,r),We("sentence","sentence",e,t,n,r)]}),Object(W.jsxs)(ae.a.Group,{widths:"equal",children:[We("start / offset","offset",e,t,n,r),We("end","end",e,t,n,r),We("space / post","post",e,t,n,r),We("section (title, text..)","section",e,t,n,r)]}),Object(W.jsx)(ae.a.Group,{widths:"equal",children:We("annotation columns","annotations",e,t,n,r,!0)})]})},Pe=function(e){var t=e.codingjob,n=e.type,a=void 0===n?"text":n,i=e.columns,o=Object(r.useState)([]),c=Object(f.a)(o,2),s=c[0],l=c[1],u=Object(r.useRef)();return Object(W.jsxs)(he.a,{children:[Object(W.jsxs)(re.a,{children:[Object(W.jsx)(re.a.Column,{width:5,children:Object(W.jsx)(qe.b,{ref:u,nodrag:!0,onFileLoad:function(e){return l(e)},addRemoveButton:!0,onRemoveFile:function(){return l([])},children:Object(W.jsx)("span",{children:"Click to upload"})})}),Object(W.jsx)(re.a.Column,{floated:"right",width:11,children:Object(W.jsx)(He,{type:a,data:s,codingjob:t,fileRef:u,columns:i})})]}),Object(W.jsx)(Ge,{data:s})]})},He=function(e){var t=e.type,n=e.data,a=e.codingjob,i=e.fileRef,o=e.columns,c=Object(r.useState)([]),s=Object(f.a)(c,2),l=s[0],u=s[1],d=Object(r.useState)({}),h=Object(f.a)(d,2),p=h[0],m=h[1],k=Object(r.useState)(!1),y=Object(f.a)(k,2),w=y[0],C=y[1];Object(r.useEffect)((function(){if(n.length<=1)return m({}),void u([]);u(n[0].data.map((function(e){return{key:e,value:e,text:e}})));for(var e={},t=0,r=Object.keys(o);t<r.length;t++){var a=r[t];e[a]=o[a].multiple?[]:null;var i,c=Object(g.a)(o[a].defaults);try{for(c.s();!(i=c.n()).done;){var s=i.value;n[0].data.includes(s)&&(o[a].multiple?e[a].push(s):e[a]=s)}}catch(l){c.e(l)}finally{c.f()}}m(e)}),[n,o]);var S=function(e,t){for(var n=e[0].data,r=Object(x.a)({},t),a=function(){var e=c[i];if(o[e].multiple){r[e]={};var a,s=Object(g.a)(t[e]);try{var l=function(){var t=a.value;r[e][t]=n.findIndex((function(e){return e===t}))};for(s.s();!(a=s.n()).done;)l()}catch(u){s.e(u)}finally{s.f()}}else r[e]=n.findIndex((function(n){return n===t[e]}))},i=0,c=Object.keys(t);i<c.length;i++)a();return e.slice(1).map((function(e){for(var a={original:n.map((function(t,n){return{name:t,value:e.data[n]}}))},i=0,c=Object.keys(t);i<c.length;i++){var s=c[i];if(o[s].multiple){a[s]=[];var l,u=Object(g.a)(t[s]);try{for(u.s();!(l=u.n()).done;){var d=l.value,j=r[s][d];if(!(j<0)){var b=e.data[j];o[s].int&&(b=parseInt(b)),a[s].push({name:n[j],value:b})}}}catch(p){u.e(p)}finally{u.f()}}else{var f=r[s];if(f<0)continue;var h=e.data[f];a[s]=o[s].int?parseInt(h):h}}return a}))},_=function(){var e=Object(b.a)(j.a.mark((function e(){var r;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,C(!0),r=S(n,p),"tokens"===t&&(r=Be(r)),e.next=6,B.createDocuments(a,r);case 6:return e.next=8,B.setCodingjobProp(a,"codebook.unitSettings.n",null);case 8:i.current.removeFile(),C(!1),e.next=16;break;case 12:e.prev=12,e.t0=e.catch(0),console.log(e.t0),C(!1);case 16:case"end":return e.stop()}}),e,null,[[0,12]])})));return function(){return e.apply(this,arguments)}}();return Object(W.jsx)(W.Fragment,{children:Object(W.jsxs)(ae.a,{loading:w,children:["texts"===t?Fe(o,l,p,m):null,"tokens"===t?Le(o,l,p,m):null,Object(W.jsx)(ae.a.Group,{children:Object(W.jsxs)(ae.a.Field,{control:v.a,onClick:_,disabled:!function(){for(var e=0,t=Object.keys(o);e<t.length;e++){var n=t[e];if(o[n].multiple){if(o[n].required&&0===p[n].length)return!1}else if(o[n].required&&!p[n])return!1}return!0}(),children:[Object(W.jsx)(O.a,{name:"upload"}),"Upload"]})})]})})},Be=function(e){for(var t=[],n=[e[0]],r=1;r<e.length;r++)e[r].document_id!==e[r-1].document_id&&(t.push({document_id:e[r-1].document_id,tokens:n}),n=[]),n.push(e[r]);return t},We=function(e,t,n,r,a,i){return Object(W.jsx)(ae.a.Field,{control:Ue.a,clearable:!0,selection:!0,multiple:!!n[t].multiple,label:{children:e,style:{fontSize:"10px"}},required:n[t].required,options:r,value:a[t],onChange:function(e,n){var r=Object(x.a)({},a);r[t]=n.value,i(r)},style:{minWidth:"3em",fontSize:"10px"}})},Ge=function(e){var t=e.data,n=function(e){return e.map((function(e){return Object(W.jsx)(ke.a.Cell,{children:Object(W.jsx)("span",{title:e,children:e})})}))};return t.length<=1?null:Object(W.jsxs)("div",{style:{marginTop:"3em",overflow:"auto",width:"100%",border:"solid 1px"},children:[Object(W.jsxs)(ke.a,{singleLine:!0,fixed:!0,size:"small",compact:!0,children:[Object(W.jsx)(ke.a.Header,{children:Object(W.jsx)(ke.a.Row,{children:function(e){return e[0].data.map((function(e){return Object(W.jsx)(ke.a.HeaderCell,{style:{width:"7em"},children:Object(W.jsx)("span",{title:e,children:e})})}))}(t)})}),Object(W.jsx)(ke.a.Body,{children:function(e,t){return e.slice(0,t+1).slice(1).map((function(e){return Object(W.jsx)(ke.a.Row,{children:n(e.data)})}))}(t,5)})]}),t.length>5?Object(W.jsxs)(p.a,{align:"center",children:[t.length-1-5," more rows"]}):null]})},Ve=function(e){var t=e.codingjob,n=Object(r.useState)("Documents CSV"),a=Object(f.a)(n,2),i=a[0],o=a[1];return Object(W.jsxs)(W.Fragment,{children:[Object(W.jsxs)(l.a,{attached:"top",tabular:!0,children:[Object(W.jsx)(l.a.Item,{name:"Documents CSV",active:"Documents CSV"===i,onClick:function(e,t){return o(t.name)}}),Object(W.jsx)(l.a.Item,{name:"Tokens CSV",active:"Tokens CSV"===i,onClick:function(e,t){return o(t.name)}})]}),Object(W.jsx)(ie.a,{attached:"bottom",children:function(e){switch(e){case"Documents CSV":return Object(W.jsx)(Ne,{codingjob:t});case"Tokens CSV":return Object(W.jsx)(Me,{codingjob:t});default:return null}}(i)})]})},Je=function(){var e=Object(b.a)(j.a.mark((function e(t,n,r,a,i){var o,c;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,B.getJobDocumentCount(t);case 2:if(o=e.sent,r(Math.ceil(o/n)),c=[],!(o>0)){e.next=9;break}return e.next=8,B.getJobDocuments(t,0,n);case 8:c=e.sent;case 9:a(c),i(Ye(c));case 11:case"end":return e.stop()}}),e)})));return function(t,n,r,a,i){return e.apply(this,arguments)}}(),Ye=function(e){var t=[];return e.length>0&&(t=e.reduce((function(e,t){if(t.text_fields){var n,r=Object(g.a)(t.text_fields);try{for(r.s();!(n=r.n()).done;){var a=n.value;e.add(a.name)}}catch(o){r.e(o)}finally{r.f()}}else for(var i=0;i<t.tokens.length;i++)e.add(t.tokens[i].section);return e}),new Set)),["document_id"].concat(Object(_.a)(t))},Ke=function(e){var t=e.codingjob,n=Object(r.useState)([]),a=Object(f.a)(n,2),i=a[0],o=a[1],c=Object(r.useState)(1),s=Object(f.a)(c,2),l=s[0],u=s[1],d=Object(r.useState)([]),h=Object(f.a)(d,2),p=h[0],v=h[1];Object(r.useEffect)((function(){if(!t)return o([]),v([]),null;Je(t,10,u,o,v)}),[t]);var x=function(e){return p.map((function(t,n){var r,a,i=null;return"document_id"===t?i=e.document_id:(e.text_fields&&(i=e.text_fields.find((function(e){return e.name===t})))&&(i=i.value),i||e.text_fields||!e.tokens||(r=e.tokens,a=t,i=r.reduce((function(e,t){return t.section===a&&(e=e+t.pre+t.token+t.post),e}),""))),Object(W.jsx)(ke.a.Cell,{children:Object(W.jsx)("span",{title:i,children:i})},n)}))},g=function(){var e=Object(b.a)(j.a.mark((function e(n,r){var a,i;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=10*(r.activePage-1),e.next=3,B.getJobDocuments(t,a,10);case 3:i=e.sent,o(i),v(Ye(i));case 6:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}();return i.length<1?Object(W.jsx)("h3",{style:{marginTop:"5em",textAlign:"center"},children:"This codingjob does not yet have any documents"}):Object(W.jsx)(he.a,{style:{marginTop:"2em"},children:Object(W.jsxs)(ke.a,{unstackable:!0,selectable:!0,fixed:!0,compact:!0,singleLine:!0,size:"small",style:{fontSize:"10px"},children:[Object(W.jsx)(ke.a.Header,{children:Object(W.jsx)(ke.a.Row,{children:function(e,t){return t.map((function(e,t){return Object(W.jsx)(ke.a.HeaderCell,{width:0===t?3:null,children:Object(W.jsx)("span",{title:e,children:e})},t)}))}(0,p)})}),Object(W.jsx)(ke.a.Body,{children:function(e){return e.map((function(e,t){return Object(W.jsx)(ke.a.Row,{children:x(e)},t)}))}(i)}),Object(W.jsx)(ke.a.Footer,{children:Object(W.jsx)(ke.a.Row,{children:Object(W.jsx)(ke.a.HeaderCell,{colSpan:p.length,children:l>1?Object(W.jsx)(Ce.a,{size:"mini",floated:"right",boundaryRange:1,siblingRange:1,ellipsisItem:{content:Object(W.jsx)(O.a,{name:"ellipsis horizontal"}),icon:!0},firstItem:{content:Object(W.jsx)(O.a,{name:"angle double left"}),icon:!0},lastItem:{content:Object(W.jsx)(O.a,{name:"angle double right"}),icon:!0},prevItem:{content:Object(W.jsx)(O.a,{name:"angle left"}),icon:!0},nextItem:{content:Object(W.jsx)(O.a,{name:"angle right"}),icon:!0},pointing:!0,secondary:!0,defaultActivePage:1,totalPages:l,onPageChange:g}):null})})})]})})},Qe=function(e){var t=e.codingjob;return Object(W.jsx)("div",{style:{paddingLeft:"1em"},children:Object(W.jsxs)(re.a,{stackable:!0,columns:2,children:[Object(W.jsxs)(re.a.Column,{width:8,children:[Object(W.jsx)(p.a,{textAlign:"center",style:{background:"#1B1C1D",color:"white"},children:"Upload Documents"}),Object(W.jsx)(Ve,{codingjob:t})]}),Object(W.jsxs)(re.a.Column,{width:8,children:[Object(W.jsx)(p.a,{textAlign:"center",style:{background:"#1B1C1D",color:"white"},children:"Document list"}),Object(W.jsx)(Ke,{codingjob:t})]})]})})},Xe=a.a.memo(Qe),Ze=n(321),$e=n(322),et=n(304),tt=n(328),nt=function(e){var t=e.children,n=e.header,r=e.texts,a=e.type;return Object(W.jsxs)(tt.a,{wide:!0,trigger:Object(W.jsx)(v.a,{circular:!0,icon:"warn"===a?"exclamation":"question",size:"mini",style:{position:"absolute",marginTop:"-0.6em",marginLeft:"0.2em",paddingLeft:"0.1em",paddingRight:"0.1em",paddingTop:"0.2em",paddingBottom:"0.2em",background:"warn"===a?"orange":"white",color:"black",border:"1px solid grey"}}),children:[n?Object(W.jsx)("h3",{children:n}):null,r?r.map((function(e,t){return Object(W.jsx)("p",{children:e},t)})):null,t]})},rt=n(323),at=n(177),it=n.n(at),ot=function(e){return Object(x.a)({type:e.type},e[e.type])},ct=function(e){return e.map((function(e,t){return"object"!==typeof e&&(e={code:e}),null==e.active&&(e.active=!0),null==e.tree&&(e.tree=[]),null==e.parent&&(e.parent=""),null==e.makes_irrelevant&&(e.makes_irrelevant=[]),"object"!==typeof e.makes_irrelevant&&(e.makes_irrelevant=[e.makes_irrelevant]),null==e.color&&(e.color=it()({seed:e.code,luminosity:"light"})),e}))},st=function(e){for(var t=ct(e).reduce((function(e,t){return e[t.code]=Object(x.a)(Object(x.a)({},t),{},{children:[],totalChildren:0,totalActiveChildren:0}),e}),{}),n=0,r=Object.keys(t);n<r.length;n++){var a=r[n];""===t[a].parent||t[t[a].parent]||(t[t[a].parent]={code:t[a].parent,parent:"",children:[],active:!1,totalChildren:0,totalActiveChildren:0})}for(var i=0,o=Object.keys(t);i<o.length;i++){var c=o[i],s=dt(t,c),l=Object(f.a)(s,3);t[c].tree=l[0],t[c].activeParent=l[1],t[c].foldToParent=l[2],t[c].parent&&t[t[c].parent].children.push(c);var u,d=Object(g.a)(t[c].tree);try{for(d.s();!(u=d.n()).done;){var j=u.value;t[j].totalChildren++,t[c].active&&t[c].activeParent&&t[j].totalActiveChildren++}}catch(b){d.e(b)}finally{d.f()}}return t},lt=function(e,t){var n=Object.keys(e).filter((function(t){return!e[t].parent||""===e[t].parent})),r=[];return ut(e,n,r,[],t),r.map((function(e,t){return Object(x.a)(Object(x.a)({},e),{},{i:t})}))},ut=function e(t,n,r,a,i){var o,c=Object(g.a)(n);try{for(c.s();!(o=c.n()).done;){var s=o.value,l=Object(_.a)(a);l.push(s),r.push(Object(x.a)(Object(x.a)({},t[s]),{},{code:s,codeTrail:a,level:a.length,color:t[s].color?t[s].color:it()({seed:s,luminosity:"light"})})),t[s].children&&e(t,t[s].children,r,l,i)}}catch(u){c.e(u)}finally{c.f()}},dt=function(e,t){for(var n=[],r=!0,a="",i=e[t].parent;i;)n.push(i),null!=e[i].folded&&e[i].folded&&(a=i,null==e[i].active||e[i].active||(r=!1)),i=e[i].parent;return[n.reverse(),r,a]},jt=function(e,t,n){var r,a=n.reduce((function(e,t){return"object"===typeof t?(e[t.code]=1,e[t.parent]=1):e[t]=1,e}),{}),i=[],o=Object(_.a)(n),c={},s=e.split("\n"),l=Object(g.a)(s);try{for(l.s();!(r=l.n()).done;){for(var u=r.value,d=u.search(/\S/),j=u,b=0,f=["color","disabled","folded","irrelevant"];b<f.length;b++){var h=f[b];j=j.split("#".concat(h))[0].trim()}if(""!==j){a[j]&&i.push(j),a[j]=1;var p={code:j,parent:bt(c,t,j,d),active:!u.includes("#disabled"),folded:u.includes("#folded")};if(u.includes("#irrelevant")){var v=u.split("#irrelevant(")[1].split(")")[0];p.makes_irrelevant=v.split(",")}if(u.includes("#color")){var O=u.split("#color(")[1].split(")")[0];p.color=ft(O)}o.push(p)}}}catch(x){l.e(x)}finally{l.f()}return[o,i]},bt=function(e,t,n,r){for(var a=t,i=0,o=Object.keys(e);i<o.length;i++){var c=o[i];r>(c=Number(c))?a=e[c]:(delete e[c],e[r]=n)}return e[r]=n,a},ft=function(e){if(!e)return"#FFFFFF";var t=document.createElement("canvas").getContext("2d");return t.fillStyle=e.trim(),t.fillStyle},ht=n(29),pt=function(e){return{type:"BLOCK_EVENTS",block:e}},vt=function(e){return{type:"SET_FULL_SCREEN_NODE",node:e}},Ot=n(217),xt=function(e,t,n,r){for(var a=e.findIndex((function(e){return e.code===t.code})),i=null,o=e[a].parent,c=0;c<e.length;c++)c!==a&&e[c].parent===o&&("down"===n&&c>a&&(null===i||i>c)&&(i=c),"up"===n&&c<a&&(null===i||i<c)&&(i=c));if(null===i)return null;var s=Object(_.a)(e),l=s[a];s[a]=s[i],s[i]=l,r(s)},gt=function(e){e.codeMap;var t=e.code,n=e.codes,a=e.setCodes,i=e.setOpen,o=Object(r.useState)([]),c=Object(f.a)(o,2),s=c[0],l=c[1],u=Object(r.useState)(""),d=Object(f.a)(u,2),j=d[0],b=d[1],h=function(e){if(""===e)return null;var r=jt(e,t,n),o=Object(f.a)(r,2),c=o[0],s=o[1];if(s.length>0)return l(s),null;a(c),i(!1)};return Object(W.jsxs)("div",{style:{margin:"1em",height:"200px"},children:[Object(W.jsxs)("p",{children:[""===t?"Create new codes":Object(W.jsxs)(W.Fragment,{children:["Add codes under ",Object(W.jsx)("b",{children:t})]}),Object(W.jsx)(v.a,{floated:"right",compact:!0,size:"mini",icon:"delete",onClick:function(){return i(!1)}})]}),Object(W.jsxs)(ae.a,{onSubmit:function(){return h(j)},children:[Object(W.jsxs)(tt.a,{open:s.length>0,trigger:Object(W.jsx)(rt.a,{autoFocus:!0,onChange:function(e,t){b(t.value),l([])},value:j,style:{height:"130px"},placeholder:"Every line becomes a new code"}),children:["Duplicate labels: ",Object(W.jsx)("br",{}),Object(W.jsx)("b",{children:s.join(", ")})]}),Object(W.jsx)(v.a,{fluid:!0,content:"Create",onClick:function(){return h(j)}})]})]})},mt=function(e){var t=e.codeMap,n=e.code,r=e.codes,a=e.setCodes,i=e.setOpen,o=function(e){var o=r.filter((function(e){return e.code!==n})),c=[];e?o=o.map((function(e){return t[n].children.includes(e.code)&&(e.parent=t[n].parent),e})):(yt(t,n,c),o=o.filter((function(e){return!c.includes(e.code)}))),a(o),i(!1)};return Object(W.jsxs)("div",{style:{margin:"1em"},children:[Object(W.jsxs)("p",{children:["Delete ",Object(W.jsx)("b",{children:n}),"?"]}),Object(W.jsxs)(Ot.a,{fluid:!0,children:[t[n].children.length>0?Object(W.jsxs)(W.Fragment,{children:[Object(W.jsx)(v.a,{color:"red",onClick:function(){return o(!1)},children:"Yes"}),Object(W.jsx)(v.a,{color:"red",onClick:function(){return o(!0)},children:"Yes, but keep children"})]}):Object(W.jsx)(v.a,{color:"red",onClick:function(){return o(!0)},children:"Yes"}),Object(W.jsx)(v.a,{onClick:function(){return i(!1)},children:"Cancel"})]})]})},kt=function(e){var t=e.codeMap,n=e.code,a=e.codes,i=e.setCodes,o=e.setOpen,c=Object(r.useState)(t[n].parent),s=Object(f.a)(c,2),l=s[0],u=s[1],d=Object(r.useState)(n),j=Object(f.a)(d,2),b=j[0],h=j[1],p=["ROOT"].concat(Object(_.a)(wt(t,n))),O=function(e,r){if(e!==n){if(""===e)return null;if(t[e])return null}var c=!0,s=a.map((function(t){return t.code===n&&(t.code=e,t.parent=r,c=!1),t.parent===n&&(t.parent=e),t}));c&&a.push({code:e,parent:r,active:!0}),a=a.filter((function(e){return"ROOT"!==e.parent})),i(s),o(!1)};return Object(W.jsxs)("div",{style:{margin:"1em"},children:[Object(W.jsxs)("p",{children:["Change parent and/or label",Object(W.jsx)(v.a,{floated:"right",compact:!0,size:"mini",icon:"delete",onClick:function(){return o(!1)}})]}),Object(W.jsxs)(ae.a,{onSubmit:function(){return O(b,l)},children:[Object(W.jsxs)(ae.a.Field,{inline:!0,children:[Object(W.jsx)("label",{style:{color:"white"},children:"Parent:"}),Object(W.jsx)(Ue.a,{value:l,style:{minWidth:"10em"},options:p.map((function(e,t){return{key:e,value:e,text:e}})),search:!0,selectOnNavigation:!1,minCharacters:0,autoComplete:"on",onChange:function(e,t){u(t.value)}})]}),Object(W.jsxs)(ae.a.Field,{inline:!0,children:[Object(W.jsx)("label",{style:{color:"white"},children:"Code:"}),Object(W.jsx)($e.a,{autoFocus:!0,onChange:function(e,t){h(t.value)},value:b,placeholder:"new code"})]}),Object(W.jsx)(v.a,{fluid:!0,onClick:function(){return O(b,l)},children:"Change"})]})]})},yt=function e(t,n,r){var a,i=Object(g.a)(t[n].children);try{for(i.s();!(a=i.n()).done;){var o=a.value;r.push(o),e(t,o,r)}}catch(c){i.e(c)}finally{i.f()}},wt=function(e,t){var n=[];return yt(e,t,n),Object.keys(e).filter((function(e){return!n.includes(e)&&e!==t}))},Ct=function(e){var t=e.codeMap,n=e.code,a=e.codes,i=e.setCodes,o=e.toggleActiveCode,c=e.setChangeColor,s=Object(ht.b)(),l=Object(r.useState)(!1),u=Object(f.a)(l,2),d=u[0],j=u[1],b=Object(r.useState)(null),h=Object(f.a)(b,2),p=h[0],O=h[1];Object(r.useEffect)((function(){return s(pt(d)),function(){s(pt(!1))}}),[s,d]);var g={padding:"0",margin:"0",width:"15px",borderRadius:"0",minHeight:"10px"},m=function(){return n.code||null!=n.active?Object(W.jsx)(v.a,{size:"mini",as:"Input",style:Object(x.a)(Object(x.a)({},g),{},{padding:"10px 0px",background:n.color||"white"}),onInput:function(e){return c({code:n.code,color:e.target.value})},type:"color",value:n.color||"white"}):null},k=function(e){O(Object(W.jsx)(gt,{codeMap:t,code:e?"":n.code,codes:a,setCodes:i,setOpen:j})),j(!0)},y=function(){O(Object(W.jsx)(mt,{codeMap:t,code:n.code,codes:a,setCodes:i,setOpen:j})),j(!0)},w=function(){O(Object(W.jsx)(kt,{codeMap:t,code:n.code,codes:a,setCodes:i,setOpen:j})),j(!0)},C=function(e){xt(a,n,e,i),j(!1)};return Object(W.jsx)(tt.a,{inverted:!0,size:"mini",flowing:!0,hoverable:!0,mouseLeaveDelay:99999999,open:d,onClose:function(){return j(!1)},trigger:""===n?Object(W.jsxs)(Ot.a,{fluid:!0,color:"black",children:[Object(W.jsx)(v.a,{content:"Add codes",onClick:function(){return k(!0)},style:g}),";"]}):Object(W.jsxs)(Ot.a,{color:"black",attached:!0,fluid:!0,size:"mini",style:{padding:"0",margin:"0"},children:[Object(W.jsx)(v.a,{size:"mini",icon:n.active&&n.activeParent?"toggle on":"toggle off",onClick:function(){return o(a,n.code,!n.active,i)},style:Object(x.a)(Object(x.a)({},g),{},{color:n.active&&n.activeParent?"green":"red"})}),m(),Object(W.jsx)(v.a,{icon:"plus",compact:!0,size:"mini",onClick:function(){return k(!1)},style:g}),Object(W.jsx)(v.a,{icon:"minus",compact:!0,size:"mini",onClick:y,style:g}),Object(W.jsx)(v.a,{icon:"edit",compact:!0,size:"mini",onClick:w,style:g}),Object(W.jsx)(v.a,{icon:"arrow up",compact:!0,size:"mini",onClick:function(){return C("up")},style:g}),Object(W.jsx)(v.a,{icon:"arrow down",compact:!0,size:"mini",onClick:function(){return C("down")},style:g})]}),style:{padding:"0",margin:"0"},children:p})},St=function(e){return e?Object(W.jsxs)(W.Fragment,{children:["Makes irrelevant",Object(W.jsx)(nt,{header:"Make other questions conditional on this answer",texts:['Certain answers can make other questions irrelevant. \n           For example, you might first ask if a text is relevant (for your study). \n           If it isn\'t, you don\'t need your coder to waste time answering the remaining questions.\n           In this case, you can set "makes irrelevant" to "remaining". All remaning questions in the current\n           unit will then be annotated with the value IRRELEVANT',"You can also let an answer make specific other questions irrelevant. \n           This way you can implement simple branching patterns, where certain follow-up questions\n           are only asked if certain conditions are met.","NOTE that specific other questions are referenced by the question number,\n            so be careful if you change the order of questions."]})]}):null},_t=function(e,t,n){return e?Object(W.jsx)(Ue.a,{multiple:!0,header:"Make which questions irrelevant?",direction:"right",options:At(e,t),value:t.makes_irrelevant,renderLabel:It,onChange:function(e,r){var a=r.value;n(t.code,a)},style:{paddingRight:"0"}}):null},At=function(e,t){for(var n=[{key:"remaining",text:"remaining",value:"remaining",description:"All questions after the current"}],r=e.length||5,a=0;a<r;a++)n.push({key:a+1,text:a+1,value:"".concat(a),description:"Q".concat(a+1," (").concat(e[a].name,")")});return n},It=function(e){return{content:e.text,style:{fontSize:"12px",padding:"0",background:"white",border:"0",boxShadow:"none"}}},Et=function(e){e.codes;var t=e.codeTreeArray,n=e.setCodes,a=Object(ht.b)(),i=Object(r.useState)(!1),o=Object(f.a)(i,2),c=o[0],s=o[1],l=Object(r.useState)(""),u=Object(f.a)(l,2),d=u[0],j=u[1],b=Object(r.useState)([]),p=Object(f.a)(b,2),O=p[0],x=p[1];Object(r.useEffect)((function(){return a(pt(c)),function(){a(pt(!1))}}),[a,c]),Object(r.useEffect)((function(){j(function(e){var t,n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:25,i="",o=Object(g.a)(e);try{for(o.s();!(n=o.n()).done;){var c=n.value;t="",t+=Array(1+c.level*r).join(" ");var s=a-(t+=c.code).length;s>0&&(t+=Array(s).join(" ")),t+=" #color(".concat(c.color,")"),c.active||(t+=" #disabled"),c.folded&&(t+=" #folded"),c.makes_irrelevant&&c.makes_irrelevant.length>0&&(t+=" #irrelevant(".concat(c.makes_irrelevant.join(","),")")),i+=t+"\n"}}catch(l){o.e(l)}finally{o.f()}return i}(t,2,40))}),[t]);return Object(W.jsxs)(h.a,{on:"click",open:c,style:{width:"700px",maxWidth:"100%",overflowX:"auto",padding:"0.3em"},trigger:Object(W.jsx)(v.a,{fluid:!0,onClick:function(){return s(!0)},style:{padding:"0.3em 1em",borderRadius:"0"},children:"Plain text editor"}),children:[Object(W.jsxs)(tt.a,{open:O.length>0,trigger:Object(W.jsx)(rt.a,{autoFocus:!0,rows:20,onChange:function(e,t){j(t.value)},value:d,style:{fontFamily:"monospace",height:"100%",width:"100%"},placeholder:"Every line is a code\\n\\nindent codes to make a tree, like\\nparent\\n  child\\n    grandchild\\n\\nAdd colors with:\\ncode   #color(red)"}),children:["Duplicate labels: ",Object(W.jsx)("br",{}),Object(W.jsx)("b",{children:O.join(", ")})]}),Object(W.jsxs)(h.a.Actions,{children:[Object(W.jsx)(v.a,{color:"black",onClick:function(){return s(!1)},children:"Cancel"}),Object(W.jsx)(v.a,{content:"Save changes",onClick:function(){var e=jt(d,"",[]),t=Object(f.a)(e,2),r=t[0],a=t[1];if(a.length>0)return x(a),null;n(r),s(!1)},positive:!0})]})]})},Rt=function(e,t,n,r){r(n.map((function(n){return n.code===e&&(n.color=t),n})))},zt=function(e,t,n,r){var a=Object(_.a)(e),i=a.find((function(e){return e.code===t}));i?i.active=n:a.push({code:t,parent:"",active:!0}),r(a)},Tt=function(e,t,n,r){var a=Object(_.a)(e),i=a.find((function(e){return e.code===t}));i?i.folded=!n:a.push({code:t,parent:"",active:!0,folded:!n}),r(a)},Dt=function(e){var t=e.codes,n=e.setCodes,a=e.questions,i=e.height,o=void 0===i?"100%":i,c=Object(r.useState)({}),s=Object(f.a)(c,2),l=s[0],u=s[1],d=Object(r.useState)([]),j=Object(f.a)(d,2),b=j[0],h=j[1],p=Object(r.useState)(null),v=Object(f.a)(p,2),g=v[0],m=v[1];Object(r.useEffect)((function(){if(t&&0!==t.length){var e=st(t);u(e),h(lt(e,true))}else h([])}),[t,h,u,true]),Object(r.useEffect)((function(){var e=setTimeout((function(){g&&Rt(g.code,g.color,t,n),m(null)}),500);return function(){return clearTimeout(e)}}),[t,n,g,m]);var k=function(e){var t=null==e.active||e.active?"black":"grey";return 0===e.level?{fontWeight:"bold",fontSize:"15px",color:t}:1===e.level||2===e.level?{fontSize:"12px",color:t}:{fontSize:"10px",color:t}},y=function(e,r){var a=Object(_.a)(t);a.find((function(t){return t.code===e})).makes_irrelevant=r,n(a)};return Object(W.jsx)("div",{children:Object(W.jsxs)(ke.a,{singleLine:!0,columns:3,unstackable:!0,textAlign:"left",style:{border:"0",boxShadow:"0",width:"100%"},children:[Object(W.jsx)(ke.a.Header,{className:"codes-thead"}),Object(W.jsxs)(ke.a.Body,{style:{height:o,margin:"0",overflow:"visible"},className:"codes-tbody",children:[Object(W.jsxs)(ke.a.Row,{className:"codes-tr",children:[Object(W.jsx)(ke.a.HeaderCell,{textAlign:"center",children:Object(W.jsx)(O.a,{name:"settings"})}),Object(W.jsx)(ke.a.HeaderCell,{style:{position:"relative",paddingLeft:"0.5em"},children:"Codebook"}),Object(W.jsx)(ke.a.HeaderCell,{style:{textAlign:"right"},children:St(a)})]}),Object(_.a)(b).map((function(e,r){return e.foldToParent?null:Object(W.jsxs)(ke.a.Row,{className:"codes-tr",style:{},children:[Object(W.jsx)(ke.a.Cell,{className:"codes-td",width:1,style:{border:"1px solid black",padding:"0",margin:"0",background:"#1B1C1D",borderRight:null==e.active?null:"1px solid black"},children:Object(W.jsx)(Ct,{codeMap:l,code:e,codes:t,setCodes:n,toggleActiveCode:zt,setChangeColor:m})}),Object(W.jsx)(ke.a.Cell,{className:"codes-td",style:{paddingLeft:"0.5em",borderTop:0===e.level?"1px solid black":null},children:Object(W.jsxs)("span",{style:Object(x.a)(Object(x.a)({},k(e)),{},{marginLeft:"".concat(1*e.level,"em")}),children:[e.code,0===e.totalChildren||null==e.active?null:Object(W.jsxs)(W.Fragment,{children:[Object(W.jsx)(O.a,{style:{padding:"0",margin:"0",marginLeft:"1em",cursor:"pointer"},onClick:function(){return Tt(t,e.code,null!=e.folded&&e.folded,n)},name:e.folded?"caret right":"dropdown"}),e.folded?Object(W.jsx)("span",{style:{color:"grey"},children:"".concat(e.totalActiveChildren,"/").concat(e.totalChildren)}):null]})]})}),Object(W.jsx)(ke.a.Cell,{className:"codes-td",style:{textAlign:"right",paddingLeft:"0.5em",borderTop:0===e.level?"1px solid black":null},children:_t(a,e,y)})]},r)})),Object(W.jsx)(Ct,{codeMap:l,code:"",codes:t,setCodes:n,setChangeColor:m,children:Object(W.jsx)(O.a,{name:"cog",style:{marginLeft:"0.7em",cursor:"pointer"}})}),Object(W.jsx)(Et,{codes:t,codeTreeArray:b,setCodes:n})]})]})})},Ut={textUnit:null,unitSelection:"allTextUnits",contextUnit:"document",contextWindow:[1,1],n:null,seed:42,ordered:!1,balanceDocuments:!0,balanceAnnotations:!0,validCodes:null,highlightAnnotation:!1},qt=function(e){var t=e.codingjob,n=(null===t||void 0===t?void 0:t.unitSettings)||Ut,r=function(e){B.setCodingjobProp(t,"unitSettings",e)};return n?Object(W.jsxs)("div",{style:{verticalAlign:"top",float:"top",paddingLeft:"1em"},children:[Object(W.jsxs)(re.a,{style:{paddingTop:"1em"},children:[Object(W.jsx)(re.a.Column,{width:8,children:Object(W.jsx)(Nt,{unitSettings:n,setUnitSettings:r})}),Object(W.jsx)(re.a.Column,{width:8,children:Object(W.jsx)(Ft,{unitSettings:n,setUnitSettings:r})})]}),Object(W.jsx)("br",{}),Object(W.jsx)("br",{}),Object(W.jsx)(Mt,{unitSettings:n,setUnitSettings:r}),Object(W.jsx)("br",{}),Object(W.jsx)("br",{}),Object(W.jsx)(Pt,{codingjob:t})]}):null},Nt=function(e){var t=e.unitSettings,n=e.setUnitSettings;Object(r.useEffect)((function(){null===(null===t||void 0===t?void 0:t.textUnit)&&n(Object(x.a)(Object(x.a)({},t),{},{textUnit:"document",value:"allTextUnits",n:null,totalUnits:null}))}),[t,n]);var a=function(e,r,a,i){var o=a?"annotation":"allTextUnits",c=t.textUnit===e&&t.unitSelection===o;return Object(W.jsx)(ae.a.Field,{children:Object(W.jsx)(Ze.a,{value:e,label:r,checked:c,onChange:function(r,a){return n(Object(x.a)(Object(x.a)({},t),{},{textUnit:e,unitSelection:o,n:null,totalUnits:null}))},style:{marginLeft:i?"1em":"0em"}})})};return Object(W.jsxs)(ae.a,{children:[Object(W.jsxs)(ae.a.Group,{children:[Object(W.jsx)(O.a,{name:"setting"}),Object(W.jsx)("label",{children:"Coding unit"})]}),Object(W.jsxs)(ae.a.Group,{grouped:!0,widths:"equal",children:[a("document","Document",!1),a("paragraph","Paragraph",!1),a("sentence","Sentence",!1),a("span","Span annotation",!0),a("document","incl. document",!0,!0),a("paragraph","incl.  paragraph",!0,!0),a("sentence","incl.  sentence",!0,!0)]})]})},Ft=function(e){var t=e.unitSettings,n=e.setUnitSettings,r=function(e){n(Object(x.a)(Object(x.a)({},t),{},{contextWindow:e}))},a=function(e,a){return Object(W.jsxs)(ae.a.Field,{children:[Object(W.jsx)(Ze.a,{value:e,label:a,disabled:"document"===t.textUnit,checked:t.contextUnit===e,onChange:function(r,a){return n(Object(x.a)(Object(x.a)({},t),{},{contextUnit:e}))}}),"  ","paragraph"!==e&&"sentence"!==e||e!==t.contextUnit?null:Object(W.jsx)(Lt,{contextUnit:t.contextUnit,contextWindow:t.contextWindow,setContextWindow:r})]})};return Object(W.jsxs)(ae.a,{children:[Object(W.jsxs)(ae.a.Group,{children:[Object(W.jsx)(O.a,{name:"setting"}),Object(W.jsx)("label",{children:"Context unit"})]}),Object(W.jsxs)(ae.a.Group,{grouped:!0,widths:"equal",children:[a("document","Document"),a("paragraph","Paragraph"),a("sentence","Sentence"),a("none","No context")]})]})},Mt=a.a.memo((function(e){var t=e.unitSettings,n=e.setUnitSettings,a=Object(r.useState)(null),i=Object(f.a)(a,2),o=i[0],c=i[1],s=Object(r.useState)(100),l=Object(f.a)(s,2),u=l[0],d=l[1],j=t.totalUnits||0;Object(r.useEffect)((function(){d(Math.round(100*t.n/j)),c(t)}),[j,t,c]),Object(r.useEffect)((function(){if(o===t)return null;var e=setTimeout((function(){n(o)}),300);return function(){return clearTimeout(e)}}),[o,t,n]);var b=function(e,r){n(Object(x.a)(Object(x.a)({},t),{},Object(m.a)({},e,r)))};return null===o?null:Object(W.jsxs)(ae.a,{children:[Object(W.jsxs)(ae.a.Group,{children:[Object(W.jsx)(O.a,{name:"setting"}),Object(W.jsxs)("div",{children:[Object(W.jsx)("label",{children:"Sample settings"}),Object(W.jsx)(nt,{header:"Sampling and shuffling",texts:["If % < 100, a random sample will be drawn.","If shuffle is enabled, the order of the units will be randomized.","Seed initializes the random number generator. Simply put, using the same seed gives the same 'random' results if the data is the same."]})]})]}),Object(W.jsxs)(ae.a.Group,{children:[Object(W.jsx)(ae.a.Field,{width:8,min:1,max:j,label:"N",size:"mini",control:$e.a,type:"number",value:o.n,onChange:function(e,t){var n=Number(t.value);d(Math.round(100*n/j)),c((function(e){return Object(x.a)(Object(x.a)({},e),{},{n:n})}))}}),Object(W.jsx)(ae.a.Field,{width:8,min:0,step:5,max:100,label:"%",size:"mini",control:$e.a,type:"number",value:u,onChange:function(e,t){var n=Number(t.value),r=Math.ceil(n/100*j);r>=0&&(d(n),c((function(e){return Object(x.a)(Object(x.a)({},e),{},{n:r})})))}})]}),Object(W.jsxs)(ae.a.Group,{children:[Object(W.jsxs)(ae.a.Field,{width:8,children:[Object(W.jsx)("label",{children:"Shuffle"}),Object(W.jsx)(et.a,{toggle:!0,size:"mini",checked:!t.ordered,onChange:function(e,t){b("ordered",!t.checked)}})]}),Object(W.jsxs)(ae.a.Field,{width:8,children:[Object(W.jsx)("label",{children:"Seed"}),Object(W.jsx)($e.a,{size:"mini",type:"number",min:1,value:o.seed,onChange:function(e,t){c((function(e){return Object(x.a)(Object(x.a)({},e),{},{seed:Number(t.value)})}))}})]})]}),Object(W.jsxs)(ae.a.Group,{grouped:!0,widths:"equal",children:[Object(W.jsxs)(ae.a.Field,{children:[Object(W.jsx)("b",{children:"Balance"}),Object(W.jsx)(nt,{header:"Balanced sampling",texts:["Balance sampled Units evenly over groups. Uses a simple approach where unique groups are created (documents, codes, or documentsXcodes), and samples are drawn from these groups one by one","For documents: get an equal number of paragraphs, sentences or annotations per document","For codes: if units are annotations, get an equal number annotations for each unique code. (You can toggle which codes to include in the codebook, see top-right corner)"]})]}),Object(W.jsx)(ae.a.Field,{children:Object(W.jsx)(et.a,{size:"mini",label:"documents",checked:t.balanceDocuments,onChange:function(e,t){b("balanceDocuments",t.checked)}})}),Object(W.jsx)(ae.a.Field,{children:Object(W.jsx)(et.a,{disabled:"annotations"!==t.unitSelection,size:"mini",label:"codes",checked:t.balanceAnnotations,onChange:function(e,t){b("balanceAnnotations",t.checked)}})})]}),Object(W.jsx)("br",{})]})})),Lt=function(e){var t=e.contextUnit,n=e.contextWindow,r=e.setContextWindow;return"document"===t?null:Object(W.jsx)(tt.a,{hoverable:!0,trigger:Object(W.jsx)(v.a,{style:{padding:"0em 0.2em 0em 0.2em",background:"white",border:"1px solid"},children:"".concat(n[0]," - ").concat(n[1])}),children:Object(W.jsxs)(Ue.a.Menu,{children:[Object(W.jsx)(Ue.a.Header,{content:"Set ".concat(t," window")}),Object(W.jsxs)(re.a,{style:{paddingTop:"1em",width:"20em"},children:[Object(W.jsx)(re.a.Column,{width:8,children:Object(W.jsx)($e.a,{size:"mini",value:n[0],type:"number",style:{width:"6em"},label:"before",onChange:function(e,t){return r([Number(t.value),n[1]])}})}),Object(W.jsx)(re.a.Column,{width:5,children:Object(W.jsx)($e.a,{size:"mini",value:n[1],type:"number",labelPosition:"right",style:{width:"6em"},label:"after",onChange:function(e,t){return r([n[0],Number(t.value)])}})})]})]})})},Pt=function(e){var t=e.codingjob;return(null===t||void 0===t?void 0:t.unitSettings)&&t.unitSettings.totalUnits?"span"!==t.unitSettings.textUnit?null:t.unitSettings?Object(W.jsxs)(ae.a,{children:[Object(W.jsxs)(ae.a.Group,{children:[Object(W.jsx)(O.a,{name:"setting"}),Object(W.jsxs)("div",{children:[Object(W.jsx)("label",{children:"Manage annotation codes"}),Object(W.jsx)(nt,{header:"Annotation codes",texts:["Click on the gear icon to add, remove, move, rename and change the colors of codes","You can also toggle codes off if you just want to disable them in the current unit selection"]})]})]}),Object(W.jsx)(Dt,{codingjob:t,height:"40%"})]}):null:null},Ht=a.a.memo(qt),Bt=function(e,t){for(var n=Jt(e[t].ref),r=null,a=0,i=t-1;i>=0;i--){if(null==e[i].ref||null===e[i].ref.current)return i+1;var o=Jt(e[i].ref);if(null===r){if(Gt(n,o))continue;r=o}else if(!Gt(r,o))return i+1;var c=Vt(n,o);if(a>0&&c<a)return i+1;if(n.left>o.right)return i;a=c}return 0},Wt=function(e,t){for(var n=Jt(e[t].ref),r=null,a=0,i=t+1;i<e.length;i++){if(null==e[i].ref||null===e[i].ref.current)return i-1;var o=Jt(e[i].ref);if(null===r){if(Gt(n,o))continue;r=o}else if(!Gt(r,o))return i-1;var c=Vt(n,o);if(a>0&&c<a)return i-1;if(n.right<o.left)return i;a=c}return e.length-1},Gt=function(e,t){var n=Math.max(e.top,t.top);return Math.min(e.bottom,t.bottom)-n>.5*e.height},Vt=function(e,t){var n=Math.max(e.left,t.left),r=Math.min(e.right,t.right),a=(r-n)/e.width,i=(r-n)/t.width;return Math.max(a,i)},Jt=function(e){return e?e.current.getBoundingClientRect():null},Yt=["ArrowRight","ArrowLeft","ArrowUp","ArrowDown"],Kt=function(e){var t=e.tokenSelection,n=e.currentToken,a=e.tokens,i=e.HoldSpace,o=e.setMover,c=e.setHoldSpace,s=e.setHoldArrow,l=e.triggerCodePopup;Object(r.useEffect)((function(){return window.addEventListener("keydown",d),window.addEventListener("keyup",u),function(){window.removeEventListener("keydown",d),window.removeEventListener("keyup",u)}}));var u=function(e){if(32===e.keyCode&&i)return c(!1),void(t.length>0&&Xt(a,t,l));Yt.includes(e.key)&&(s(!1),o(null))},d=function(e){if(32!==e.keyCode){if(Yt.includes(e.key)){if(e.preventDefault(),e.repeat)return;o({position:n,startposition:n,ntokens:a.length,counter:1}),s(e.key)}}else{if(e.preventDefault(),e.repeat)return;c(!0)}};return Object(W.jsx)(W.Fragment,{})},Qt=function(e){var t=e.tokenSelection,n=e.tokens,a=e.setCurrentToken,i=e.setTokenSelection,o=e.triggerCodePopup,c=Object(r.useRef)(!1),s=Object(r.useRef)(null),l=Object(r.useRef)("ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0);Object(r.useEffect)((function(){return window.addEventListener("mousedown",d),window.addEventListener("mousemove",j),window.addEventListener("mouseup",b),window.addEventListener("touchstart",u),window.addEventListener("contextmenu",f),function(){window.removeEventListener("mousedown",d),window.removeEventListener("mousemove",j),window.removeEventListener("mouseup",b),window.removeEventListener("touchstart",u),window.removeEventListener("contextmenu",f)}}));var u=function(e){var r=en(n,e);if(null===(null===r||void 0===r?void 0:r.index))return s.current=null,void i((function(e){return 0===e.length?e:[]}));if(t.length>0&&t[0]===s.current){var a=h(e);return i((function(e){return an(e,n,a,!0)})),(null===r||void 0===r?void 0:r.annotated)&&a===t[0]?Xt(n,[a,a],o):Xt(n,[t[0],a],o),void(s.current=null)}s.current!==r.index?(s.current=r.index,i((function(e){return 0===e.length?e:[]}))):i((function(e){return an(e,n,r.index,!0)}))},d=function(e){l.current||1===e.which&&(c.current=!0,i((function(e){return 0===e.length?e:[]})))},j=function(e){if(!l.current)if(c.current){if(e.preventDefault(),1!==e.which&&0!==e.which)return null;window.getSelection().empty(),h(e)}else{var t=en(n,e);null!==t.index?(a((function(e){return e===t.index?e:t.index})),i((function(e){return an(e,n,t.index,!1)}))):a((function(e){return e===t.index?e:t.index}))}},b=function(e){if(!l.current){if(1!==e.which&&0!==e.which)return null;var r=h(e);window.getSelection().empty(),c.current=!1,t.length>0&&null!==t[0]&&null!==t[1]?Xt(n,t,o):null!==r&&Xt(n,[r,r],o)}},f=function(e){if(2===e.button)return null;e.preventDefault(),e.stopPropagation()},h=function(e){var t=en(n,e);return a((function(e){return e===t.index?e:t.index})),i((function(e){return an(e,n,t.index,!0)})),t.index};return Object(W.jsx)(W.Fragment,{})},Xt=function(e,t,n){var r=Object(f.a)(t,2),a=r[0],i=r[1];if(a>i){var o=[i,a];a=o[0],i=o[1]}var c={index:e[a].index,length:e[i].length+e[i].offset-e[a].offset,span:[e[a].index,e[i].index],section:e[a].section,offset:e[a].offset};n(e[i].index,c)},Zt=function(e,t,n,r,a,i){var o,c=n.position;if("ArrowRight"===t&&c++,"ArrowLeft"===t&&c--,"ArrowUp"===t&&(c=$t(e,n,"up")),"ArrowDown"===t&&(c=$t(e,n,"down")),c>n.ntokens&&(c=n.ntokens),c<0&&(c=0),null==(null===(o=e[c])||void 0===o?void 0:o.ref)){if("ArrowRight"===t){var s=e.findIndex((function(e){return e.codingUnit}));if(s<0)return n.position;c=s}if("ArrowLeft"===t){var l=e.lastIndexOf((function(e){return e.codingUnit}));if(l<0)return n.position;c=l-1}}if(r&&e[n.position].section!==e[c].section)if(c>n.position){for(var u=c;u>=n.position;u--)if(e[u].section===e[n.position].section){c=u;break}}else for(var d=c;d<=n.position;d++)if(e[d].section===e[n.position].section){c=d;break}return n.position!==c&&(a((function(e){return e===c?e:c})),i((function(t){return an(t,e,c,r)})),rn(e[c].ref.current)),c},$t=function(e,t){var n,r,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"up";if(null==(null===(n=e[t.position])||void 0===n?void 0:n.ref)||null==(null===(r=e[t.startposition])||void 0===r?void 0:r.ref)){var i=e.findIndex((function(e){return e.codingUnit}));return i<0?0:i}return"up"===a?Bt(e,t.position):"down"===a?Wt(e,t.position):void 0},en=function(e,t){var n=tn(e,t),r=Object(f.a)(n,2),a=r[0],i=r[1];return null===a?{index:null,annotated:!1}:{index:nn(e,a),annotated:i}},tn=function(e,t){try{var n,r,a;if("mousemove"!==t.type&&"mouseup"!==t.type||(a=t.originalTarget||t.path[0]),"touchmove"===t.type||"touchstart"===t.type){var i=t.touches[0];a=document.elementFromPoint(i.clientX,i.clientY)}if("item"===(null===(n=a)||void 0===n||null===(r=n.parentNode)||void 0===r?void 0:r.className))return[null,!1];if(a){if(a.className.includes("token"))return[a,!1];if(a.parentNode&&a.parentNode.className.includes("token"))return[a.parentNode,!0]}return[null,!1]}catch(t){return[null,!1]}},nn=function(e,t){return parseInt(t.getAttribute("tokenindex"))},rn=function(e){!function(e,t){var n=e.getBoundingClientRect(),r=t.getBoundingClientRect(),a=n.top,i=n.height,o=r.top,c=o-a<50;o>a+.9*i&&(e.scrollTop=e.scrollTop+o-(.9*i+a)),c&&(e.scrollTop=e.scrollTop+o-(.1*i+a))}(e.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode,e)},an=function(e,t,n,r){if(null===n)return e;var a=Object(_.a)(e);if(!r||0===a.length)return[n,n];if(null===n)return[a[0],null];if(t[a[0]].section===t[n].section)a=[a[0],n];else if(n>a[0])for(var i=n;i>=a[0];i--)t[a[0]].section===t[i].section&&(a=[a[0],i]);else for(var o=n;o<=a[0];o++)t[a[0]].section===t[o].section&&(a=[a[0],o]);return a.length>0&&e[0]===a[0]&&e[1]===a[1]?e:a},on=function(e){var t=e.tokens,n=e.currentToken,a=e.setCurrentToken,i=e.tokenSelection,o=e.setTokenSelection,c=e.triggerCodePopup,s=e.eventsBlocked,l=Object(r.useState)(null),u=Object(f.a)(l,2),d=u[0],j=u[1],b=Object(r.useState)(!1),h=Object(f.a)(b,2),p=h[0],v=h[1],O=Object(r.useState)(null),x=Object(f.a)(O,2),g=x[0],m=x[1];return Object(r.useEffect)((function(){s?(m(!1),v(!1)):o([])}),[m,v,s,o]),Object(r.useEffect)((function(){if(d&&g){var e=Zt(t,g,d,p,a,o),n=Math.max(5,100/Math.ceil(d.counter/5));1===d.counter&&(n=150),setTimeout((function(){j({position:e,startposition:d.startposition,ntokens:d.ntokens,counter:d.counter+1})}),n)}}),[t,d,g,p,a,o]),t?s?null:Object(W.jsxs)(W.Fragment,{children:[Object(W.jsx)(Kt,{tokenSelection:i,currentToken:n,tokens:t,HoldSpace:p,setMover:j,setHoldSpace:v,setHoldArrow:m,triggerCodePopup:c}),Object(W.jsx)(Qt,{tokenSelection:i,tokens:t,setCurrentToken:a,setTokenSelection:o,triggerCodePopup:c})]}):null},cn=n(345),sn=function(e,t){if(t[e]){var n=t[e].foldToParent;return n&&t[n]?t[n].color+"50":t[e].color+"50"}return"#ffffff50"},ln=function(e){var t=null;if(1===e.length)t=e[0];else{var n=Math.floor(100/e.length),r=e.reduce((function(t,r,a){return 0===a&&t.push(r+" ".concat(n,"%")),a===e.length-1&&t.push(r+" ".concat(100-n,"%")),a>0&&a<e.length-1&&(t.push(r+" ".concat(n*a,"%")),t.push(r+" ".concat(n*(a+1),"%"))),t}),[]);t="linear-gradient(to bottom, ".concat(r.join(", "),")")}return t},un=function(e,t,n){console.log(n);var r,a=Object(g.a)(e);try{for(a.s();!(r=a.n()).done;){var i,o=r.value;if(null===(i=o.ref)||void 0===i?void 0:i.current){var c=dn(null===t||void 0===t?void 0:t[o.index],n);c&&0!==Object.keys(c).length?jn(o,c,n):o.ref.current.classList.contains("annotated")&&(o.ref.current.classList.remove("annotated"),bn(o,null,null,null))}}}catch(s){a.e(s)}finally{a.f()}},dn=function(e,t){if(!e)return null;if(e&&t){e=Object(x.a)({},e);for(var n=0,r=Object.keys(e);n<r.length;n++){var a=r[n];if(t[a]){var i=t[a].codeMap,o=e[a].value;i[o]&&i[o].active&&i[o].activeParent||delete e[a]}else delete e[a]}}return e},jn=function(e,t,n){for(var r=0,a=0,i={pre:[],text:[],post:[]},o=0,c=Object.keys(n);o<c.length;o++){var s=c[o];if(t[s]){var l=n[s].codeMap,u=t[s],d=sn(u.value,l);i.text.push(d),u.span[0]===u.index?r++:i.pre.push(d),u.span[1]===u.index?a++:i.post.push(d)}else i.text.push("#ffffff50"),i.pre.push("#ffffff50"),i.post.push("#ffffff50")}var j=r===Object.values(t).length,b=a===Object.values(t).length,f=r>0,h=a>0,p=e.ref.current.classList;p.add("annotated"),j?p.add("allLeft"):p.remove("allLeft"),f&!j?p.add("anyLeft"):p.remove("anyLeft"),b?p.add("allRight"):p.remove("allRight"),h&!b?p.add("anyRight"):p.remove("anyRight");var v=ln(i.text),O=j?"white":ln(i.pre),x=b?"white":ln(i.post);bn(e,O,v,x)},bn=function(e,t,n,r){var a=e.ref.current.children;a[0].style.background=t,a[1].style.background=n,a[2].style.background=r},fn=function(e,t){var n,r=Object(g.a)(e);try{for(r.s();!(n=r.n()).done;){var a,i=n.value;if(null===(a=i.ref)||void 0===a?void 0:a.current)if(0!==t.length&&null!==t[0]&&null!==t[1]){var o=Object(f.a)(t,2),c=o[0],s=o[1];if(c>s){var l=[c,s];s=l[0],c=l[1]}var u=i.arrayIndex>=c&&i.arrayIndex<=s,d=i.ref.current.classList;if(u&&i.codingUnit){var j=c===i.arrayIndex,b=s===i.arrayIndex;d.add("selected"),j?d.add("start"):d.remove("start"),b?d.add("end"):d.remove("end")}else d.remove("selected")}else i.ref.current.classList.remove("selected")}}catch(h){r.e(h)}finally{r.f()}},hn=function(e){var t,n,r=e.tokens,a=e.currentToken,i=e.annotations,o=e.variableMap,c=e.fullScreenNode;if(!(null===r||void 0===r||null===(t=r[a])||void 0===t?void 0:t.ref))return null;if(!(null===i||void 0===i?void 0:i[r[a].index]))return null;if(!o)return null;var s=i[r[a].index],l=Object.keys(s),u=l.map((function(e){return s[e].value}));return Object(W.jsx)(tt.a,{mountNode:c||void 0,context:null===r||void 0===r||null===(n=r[a])||void 0===n?void 0:n.ref,basic:!0,hoverable:!1,position:"top left",mouseLeaveDelay:1,open:!0,style:{margin:"0",padding:"0",border:"1px solid"},children:Object(W.jsx)(cn.a,{children:l.map((function(e,t){return o[e]?Object(W.jsxs)(cn.a.Item,{style:{backgroundColor:sn(u[t],o[e].codeMap),padding:"0.3em"},children:[Object(W.jsx)("b",{children:e}),": "+u[t]]},t):null}))})})},pn=function(e){var t=e.tokens,n=e.variableMap,a=e.annotations,i=e.triggerCodePopup,o=e.eventsBlocked,c=e.fullScreenNode,s=e.disableAnnotations,l=Object(r.useState)(0),u=Object(f.a)(l,2),d=u[0],j=u[1],b=Object(r.useState)([]),h=Object(f.a)(b,2),p=h[0],v=h[1];return Object(r.useEffect)((function(){if(!n)return null;un(t,a,n)}),[t,a,n]),Object(r.useEffect)((function(){fn(t,p)}),[t,p]),Object(W.jsxs)(W.Fragment,{children:[Object(W.jsx)(hn,{tokens:t,currentToken:d,annotations:a,variableMap:n,fullScreenNode:c}),s?null:Object(W.jsx)(on,{tokens:t,currentToken:d,setCurrentToken:j,tokenSelection:p,setTokenSelection:v,triggerCodePopup:i,eventsBlocked:o})]})},vn=n(303),On=(n(205),function(e){var t=e.tokens,n=e.centerVertical,a=e.setReady,i=e.height,o=Object(r.useState)({}),c=Object(f.a)(o,2),s=c[0],l=c[1],u=Object(r.useRef)(null);return Object(r.useEffect)((function(){var e,n=t.find((function(e){return e.codingUnit}));(null===n||void 0===n||null===(e=n.ref)||void 0===e?void 0:e.current)&&u.current&&function(e,t,n){var r=e.getBoundingClientRect(),a=t.getBoundingClientRect(),i=r.top,o=r.height,c=a.top,s=o/(1/n);e.scrollTop=e.scrollTop+c-(s+i)}(u.current,n.ref.current,1/4)})),Object(r.useEffect)((function(){if(!t)return null;l(xn(t)),a&&a((function(e){return e+1}))}),[t,a]),null===t?null:Object(W.jsx)("div",{style:{display:"flex",alignItems:n?"center":null,height:i},children:Object(W.jsx)(vn.a,{innerRef:u,children:Object(W.jsxs)("div",{style:{flex:"1 97%",width:"100%",maxHeight:i,overflowY:"auto",textAlign:"justify"},children:[Object(W.jsx)("div",{style:{padding:"20px"},children:s.text}),Object(W.jsx)("div",{style:{height:"25px"}})]})})},"tokens")}),xn=function(e){var t={text:[]};if(0===e.length)return t;for(var n=[],r=[],i=[],o=e[0].codingUnit,c=e[0].section,s=e[0].paragraph,l=e[0].sentence,u=0;u<e.length;u++)e[u].arrayIndex=u,e[u].sentence!==l&&(i.length>0&&r.push(kn(u,l,i)),i=[]),e[u].paragraph!==s&&(r.length>0&&n.push(mn(u,s,r,e[u].paragraph!==s)),r=[]),e[u].section!==c&&(n.length>0&&t.text.push(gn(u+"_"+c,n,c)),n=[]),s=e[u].paragraph,l=e[u].sentence,c=e[u].section,(o=e[u].codingUnit)&&(e[u].ref=a.a.createRef()),i.push(yn(e[u],o));return i.length>0&&r.push(kn("last",l,i)),r.length>0&&n.push(mn("last",s,r,!1)),n.length>0&&t.text.push(gn("last_"+c,n,c)),t},gn=function(e,t,n){return Object(W.jsx)("span",{className:"section",children:function(t){return"title"===n?Object(W.jsx)("p",{style:{fontSize:"1.2em",fontWeight:"bold"},children:t},n+e):t}(t)},"section"+n)},mn=function(e,t,n,r){return Object(W.jsx)("div",{style:{display:"flex"},children:Object(W.jsx)("span",{className:"paragraph",style:{flex:"1 98%",paddingBottom:r?"1.5em":"0em",display:"table",paddingLeft:"0.3em"},children:n},"par"+t)})},kn=function(e,t,n){return Object(W.jsx)("span",{className:"sentence",children:n},"sent"+t)},yn=function(e,t){var n=t?{lineHeight:"1.4em",fontSize:"1.5em",position:"relative"}:{color:"#746363",position:"relative"};return Object(W.jsxs)("span",{ref:e.ref,className:"token",tokenindex:e.arrayIndex,style:n,children:[Object(W.jsx)("span",{className:"pre",children:e.pre}),Object(W.jsx)("span",{className:"text",children:e.text}),Object(W.jsx)("span",{className:"post",children:e.post}),Object(W.jsx)("div",{className:"variable",style:{position:"absolute",top:"-0.4em",left:"0",fontSize:"0.4em"}})]},e.index)},wn=a.a.memo(On),Cn=["ArrowRight","ArrowLeft","ArrowUp","ArrowDown"],Sn=function(e){var t=e.children,n=e.variable,a=e.fullScreenNode,i=e.open,o=e.setOpen,c=e.tokenRef,s=e.overwrites,l=Object(r.useState)(!1),u=Object(f.a)(l,2),d=u[0],j=u[1];return Object(W.jsxs)(tt.a,{mountNode:a||void 0,context:c,hoverable:!0,open:i,mouseLeaveDelay:1e7,onOpen:function(){return j(!0)},onClose:function(){d&&o(!1)},style:{padding:"0px"},children:[Object(W.jsxs)("div",{style:{minWidth:"12em",textAlign:"center",background:"#1B1C1D",color:"white",border:"1px solid"},children:[n?Object(W.jsxs)(W.Fragment,{children:[Object(W.jsx)("b",{children:n})," "]}):Object(W.jsx)("b",{children:"Select variable"}),Object(W.jsx)(v.a,{compact:!0,floated:"right",icon:"delete",size:"mini",style:{background:"#80808000",margin:"0px",color:"white"},onClick:function(){o(!1)}})]}),function(){if(n&&0!==s.length){var e=1===s.length?"existing annotation":"".concat(s.length," existing annotations");return Object(W.jsxs)("div",{style:{margin:"1em",color:"red"},children:["Warning: overwrites or deletes ",e]})}}(),Object(W.jsx)("div",{style:{margin:"1em",border:"0px"},children:t})]})},_n=function(e){var t=e.variable,n=e.setVariable,r=e.setOverwrites,a=e.annotations,i=e.selection,o=e.canBeNew,c=e.setOpen,s=e.variableMap,l=function(e){for(var t=new Set,o=i.span[0];o<=i.span[1];o++){var c;if(null===a||void 0===a||null===(c=a[o])||void 0===c?void 0:c[e]){var s,l,u=(null===a||void 0===a||null===(s=a[o])||void 0===s?void 0:s[e].span[0])+"_"+(null===a||void 0===a||null===(l=a[o])||void 0===l?void 0:l[e].value);t.add(u)}}t.size>0?r(Array.from(t)):r([]),n(e)};if(t)return null;var u=function(){var e=Object.keys(s);return o||(e=e.filter((function(e){return null!=a[e]}))),e.map((function(e){return{color:"white",label:e,value:e}}))}();return 1===u.length&&l(u[0].value),Object(W.jsx)("div",{children:Object(W.jsx)(In,{active:!0,canDelete:!1,settings:{rowSize:5},options:u,setOpen:c,callback:l},"currentCodePageButtons")})},An=function(e){var t=e.variable,n=e.variableMap,i=e.codeHistory,o=e.settings,c=e.annotations,s=e.setAnnotations,l=e.selection,u=e.overwrites,d=e.setOpen,j=e.setCodeHistory,b=Object(r.useRef)(null),h=Object(r.useState)(!0),p=Object(f.a)(h,2),v=p[0],O=p[1],x=a.a.useCallback((function(e){var t;return o&&!o.searchBox?null:((null===b||void 0===b||null===(t=b.current)||void 0===t?void 0:t.children[0])===document.activeElement||O(!0),27===e.keyCode&&d(!1),Cn.includes(e.key)||e.keyCode<=46||e.keyCode>=106?null:(b.current&&b.current.click(),void O(!1)))}),[b,d,o]);Object(r.useEffect)((function(){return window.addEventListener("keydown",x),function(){window.removeEventListener("keydown",x)}}));var m=function(e){En(c,t,null===e,e,l,s,d,j)};if(!t)return null;var k,y=function(){for(var e,r=[],a=[],s=null===n||void 0===n||null===(e=n[t])||void 0===e?void 0:e.codeMap,u=0,d=Object.keys(s);u<d.length;u++){var j=d[u];if(!(null===l||(null===l||void 0===l?void 0:l.span[0])===(null===l||void 0===l?void 0:l.span[1]))||!c[j]){o&&"all"===o.buttonMode&&r.push({key:j,label:j,value:j,color:sn(j,s)});var b=s[j].tree.join(" - ");a.push({key:j,value:j,text:j+" "+b,content:Object(W.jsxs)(W.Fragment,{children:[j,Object(W.jsx)("br",{}),Object(W.jsx)("span",{style:{color:"grey"},children:b})]})})}}if(!o||"recent"===o.buttonMode){var f,h=Object(g.a)(i);try{for(h.s();!(f=h.n()).done;){var p=f.value;if(r.length>5)break;r.push({key:p,label:p,value:p,color:sn(p,s)})}}catch(v){h.e(v)}finally{h.f()}}return[r,a]}(),w=Object(f.a)(y,2),C=w[0],S=w[1];return Object(W.jsxs)(W.Fragment,{children:[function(e){var r;if(0===e.length)return null;var a=null===n||void 0===n||null===(r=n[t])||void 0===r?void 0:r.codeMap;return a?o&&!o.searchBox?null:Object(W.jsxs)(W.Fragment,{children:[Object(W.jsx)(re.a,{children:Object(W.jsx)(re.a.Column,{width:13,floated:"left",children:Object(W.jsx)(vn.a,{innerRef:b,children:Object(W.jsx)(Ue.a,{fluid:!0,placeholder:"<type to search>",style:{minWidth:"12em"},options:Object.keys(a).reduce((function(e,t){var n=a[t].tree.join(" - ");return e.push({key:t,value:t,text:t+" "+n,content:Object(W.jsxs)(W.Fragment,{children:[t,Object(W.jsx)("br",{}),Object(W.jsx)("span",{style:{color:"grey"},children:n})]})}),e}),[]),open:!v,search:!0,selection:!0,compact:!0,selectOnNavigation:!1,minCharacters:0,autoComplete:"on",onClick:function(){return O(!1)},onSearchChange:function(e,t){""===t.searchQuery&&O(!0)},onClose:function(){return O(!0)},onChange:function(e,n){a[n.value]&&En(c,t,!1,n.value,l,s,d,j)}})})})}),Object(W.jsx)("br",{})]}):null}(S),(k=C,0===k.length?null:Object(W.jsx)(In,{active:v,canDelete:u.length>0,settings:o,options:k,setOpen:d,callback:m},"newCodePageButtons"))]})},In=function(e){var t=e.active,n=e.options,i=e.canDelete,o=(e.settings,e.setOpen),c=e.callback,s=Object(r.useState)(0),l=Object(f.a)(s,2),u=l[0],d=l[1],j=Object(r.useState)([]),b=Object(f.a)(j,2),h=b[0],p=b[1];Object(r.useEffect)((function(){var e=Object(_.a)(n);i&&e.push({label:"DELETE",color:"red",value:null,textColor:"white"}),e.push({label:"CANCEL",color:"grey",value:"CANCEL",textColor:"white"});var t,r=Object(g.a)(e);try{for(r.s();!(t=r.n()).done;){t.value.ref=a.a.createRef()}}catch(o){r.e(o)}finally{r.f()}p(e)}),[n,i,p]);var O=a.a.useCallback((function(e){var t=h.length;if(Cn.includes(e.key))return e.preventDefault(),"ArrowRight"===e.key&&u<t-1&&d(u+1),"ArrowDown"===e.key&&d(Wt(h,u)),"ArrowLeft"===e.key&&u>0&&d(u-1),void("ArrowUp"===e.key&&d(Bt(h,u)));if(46===e.keyCode&&c(null),32===e.keyCode||13===e.keyCode){e.preventDefault(),e.stopPropagation();var n=h[u].value;"CANCEL"===n?o(!1):c(n)}}),[u,c,h,o]);Object(r.useEffect)((function(){return t?window.addEventListener("keydown",O):window.removeEventListener("keydown",O),function(){window.removeEventListener("keydown",O)}}),[t,O]);return Object(W.jsx)("div",{style:{display:"flex",flexWrap:"wrap"},children:h.map((function(e,t){return Object(W.jsx)(vn.a,{innerRef:e.ref,children:Object(W.jsx)(v.a,{style:{flex:"1 1 auto",backgroundColor:e.color,color:e.textColor||"black",border:"3px solid",borderColor:t===u?"black":"lightgrey",margin:"0"},value:e.value,compact:!0,size:"mini",onMouseOver:function(){return d(t)},onClick:function(e,t){console.log(t.value),"CANCEL"===t.value?o(!1):c(t.value)},children:" "+e.label},e.label)})}))})},En=function(e,t,n,r,a,i,o,c){if(!e)return o(!1),null;var s=Object(x.a)(Object(x.a)({},a),{},{variable:t});if(n)return i((function(e){return D(Object(x.a)({},e),s,!0)})),o(!1),null;var l=Object(x.a)(Object(x.a)({},a),{},{variable:t,value:r});i((function(e){var t=D(Object(x.a)({},e),s,!0);return D(t,l,!1)})),c((function(e){return[r].concat(Object(_.a)(e.filter((function(e){return e!==r})))).slice(0,5)})),o(!1)},Rn=function(e,t,n,a,i,o){var c,s=Object(r.useState)(!1),l=Object(f.a)(s,2),u=l[0],d=l[1],j=Object(r.useState)(null),b=Object(f.a)(j,2),h=b[0],p=b[1],v=Object(r.useState)([]),O=Object(f.a)(v,2),k=O[0],y=O[1],w=Object(r.useState)(null),C=Object(f.a)(w,2),S=C[0],_=C[1],A=Object(r.useState)(null),I=Object(f.a)(A,2),E=I[0],R=I[1],z=Object(r.useState)({}),T=Object(f.a)(z,2),D=T[0],U=T[1],q=Object(r.useState)([]),N=Object(f.a)(q,2),F=N[0],M=N[1],L=Object(r.useState)(null),P=Object(f.a)(L,2),H=P[0],B=P[1],G=Object(r.useState)(null),V=Object(f.a)(G,2),J=V[0],Y=V[1];if(Object(r.useEffect)((function(){if(!t||0===t.length)return null;var e,n={},r=Object(g.a)(t);try{var a=function(){var t=e.value,r=st(t.codes);r=Object.keys(r).reduce((function(e,t){return r[t].active&&r[t].activeParent?(e[t]=r[t],e):e}),{}),n[t.name]=Object(x.a)(Object(x.a)({},t),{},{codeMap:r})};for(r.s();!(e=r.n()).done;)a()}catch(i){r.e(i)}finally{r.f()}B(n),M([])}),[t,B,M]),Object(r.useEffect)((function(){null!==H&&(null===n||"ALL"===n?(Y(H),_(null)):(Y(Object(m.a)({},n,H[n])),_(n)))}),[H,n,_,Y]),Object(r.useEffect)((function(){d(!1)}),[e]),Object(r.useEffect)((function(){u||_(null)}),[u]),!t)return[null,null,null,!0];var K=Object(W.jsxs)(Sn,{variable:S,fullScreenNode:o,open:u,setOpen:d,tokenRef:E,overwrites:k,children:[Object(W.jsx)(_n,{variable:S,setVariable:_,setOverwrites:y,variableMap:J,annotations:a,selection:h,setOpen:d,canBeNew:null!==h}),Object(W.jsx)(An,{variable:S,variableMap:J,overwrites:k,codeMap:null===J||void 0===J||null===(c=J[S])||void 0===c?void 0:c.codeMap,settings:null===J||void 0===J?void 0:J[S],codeHistory:F,annotations:D,setAnnotations:i,selection:h,setOpen:d,setCodeHistory:M})]});return J&&e||(K=null),[K,function(t,n){R(e[t].ref),U(a[t]||{}),p(n),d(!0)},J,u]},zn=function(e,t,n){var a=Object(r.useState)(),i=Object(f.a)(a,2),o=i[0],c=i[1],s=Object(r.useState)(),l=Object(f.a)(s,2),u=l[0],d=l[1];return Object(r.useEffect)((function(){if(!(null===e||void 0===e?void 0:e.text)&&!e.text_fields)return null;var r=F(e);t.current={tokens:r.tokens,annotationsChanged:!1,annotations:S()(r.annotations)},c(r.tokens),d(r.annotations),n&&n(r.tokens)}),[e,n,t]),[o,u,d]},Tn=function(e){var t=e.variables,n=e.variable,a=e.setVariable,i=e.height,o=[];null!=t&&(o=t.map((function(e){return e.name}))).push("ALL");var c=function(e){var t=0;9===e.keyCode&&(e.preventDefault(),e.shiftKey?e.repeat||(t=-1):e.repeat||(t=1));var r=o.findIndex((function(e){return e===n}))+t;r>o.length-1&&(r=0),r<0&&(r=o.length-1),a(o[r])};if(Object(r.useEffect)((function(){return window.addEventListener("keydown",c),function(){window.removeEventListener("keydown",c)}})),!t||1===t.length)return null;return null===n&&a(o[0]),Object(W.jsx)(v.a.Group,{fluid:!0,style:{height:i},children:o.map((function(e){return Object(W.jsx)(v.a,{active:e===n,style:{padding:"0"},onClick:function(){return a(e)},children:e})}))})},Dn=function(e){var t=e.unit,n=e.variables,a=e.settings,i=e.onChangeAnnotations,o=e.returnTokens,c=e.setReady,s=e.blockEvents,l=Object(ht.c)((function(e){return e.fullScreenNode})),u=Object(r.useRef)(null),d=Object(r.useState)(null),j=Object(f.a)(d,2),b=j[0],h=j[1],p=Object(r.useState)(0),v=Object(f.a)(p,2),O=v[0],g=v[1],m=zn(t,u,o),k=Object(f.a)(m,3),y=k[0],w=k[1],C=k[2],_=Rn(y,n,b,w,C,l),A=Object(f.a)(_,4),I=A[0],E=A[1],R=A[2],z=A[3];return Object(r.useEffect)((function(){if(w&&u.current.tokens===y){if(!u.current.annotationsChanged){if(u.current.annotations===S()(w))return;u.current.annotationsChanged=!0}i(function(e,t){return 0===Object.keys(e).length?[]:Object.keys(e).reduce((function(t,n){for(var r=e[n],a=0,i=Object.keys(r);a<i.length;a++){var o=i[a];if("unit"===n||r[o].index===r[o].span[0]){var c={variable:o,value:r[o].value,section:r[o].section,offset:r[o].offset,length:r[o].length};t.push(c)}}return t}),[])}(w))}}),[y,w,i]),Object(r.useEffect)((function(){c&&c((function(e){return e+1})),C((function(e){return Object(x.a)({},e)}))}),[O,C,c]),y?Object(W.jsxs)(W.Fragment,{children:[Object(W.jsx)(Tn,{variables:n,variable:b,setVariable:h,height:"30px"}),Object(W.jsx)(wn,{tokens:y,centerVertical:a.centerVertical,setReady:g,height:n&&n.length>1?"calc(100% - 30px)":"100%"}),Object(W.jsx)(pn,{tokens:y,variableMap:R,annotations:w,triggerCodePopup:E,eventsBlocked:z||s,fullScreenNode:l,disableAnnotations:!i||!R}),I||null]}):null},Un=a.a.memo(Dn),qn=n(223),Nn=n.n(qn),Fn=function(e,t,n,r,a){var i=Nn()(r);null!=t&&null!==t||(t=e.length),!n&&t>e.length&&(t=e.length);var o,c,s=Object(_.a)(Array(e.length).keys());null===a?(o=[s],c=[t]):(o=Ln(s,a),c=Pn(o,t));for(var l=[],u=0;u<o.length;u++)if(n)for(var d=0;d<t;d++)l.push(o[u][Math.floor(i()*o[u].length)]);else{o[u]=Mn(o[u],c[u]<o[u].length?c[u]:o[u].length,i);var j,b=Object(g.a)(o[u]);try{for(b.s();!(j=b.n()).done;){var f=j.value;l.push(f)}}catch(h){b.e(h)}finally{b.f()}}return l.map((function(t){return e[t]}))},Mn=function(e,t,n){for(var r,a,i=e.slice(0),o=e.length,c=o-t;o-- >c;)r=i[a=Math.floor((o+1)*n())],i[a]=i[o],i[o]=r;return i.slice(c)},Ln=function(e,t){for(var n=[],r={},a=0;a<e.length;a++)null==r[t[a]]&&(r[t[a]]=n.length,n.push([])),n[r[t[a]]].push(e[a]);return n},Pn=function(e,t){for(var n=new Array(e.length).fill(0),r=new Array(e.length).fill(0),a=t,i=e.length,o=-1;a>0;){var c=++o%e.length;if(1!==r[c]&&(n[c]++,a--,n[c]===e[c].length&&(r[c]=1,i--)),0===i)break}return n},Hn=function(){var e=Object(b.a)(j.a.mark((function e(t,n){var r,a,i,o;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Bn(t);case 2:if(r=e.sent,a=Object(f.a)(r,2),i=a[0],o=a[1],n(o),null!==t.unitSettings.n&&null!=t.unitSettings.n&&t.unitSettings.totalUnits===i){e.next=10;break}return e.next=10,B.setCodingjobProp(t,"unitSettings",Object(x.a)(Object(x.a)({},t.unitSettings),{},{n:i,totalUnits:i}));case 10:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),Bn=function(){var e=Object(b.a)(j.a.mark((function e(t){var n,r,a,i,o,c,s,l,u,d,b,h,p;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null===t||void 0===t?void 0:t.unitSettings){e.next=2;break}return e.abrupt("return",null);case 2:if(n=t.unitSettings.textUnit,r=t.unitSettings,a=0,i=function(e){return r.balanceDocuments||r.statifyAnnotations?e.map((function(e){var t="";return r.balanceDocuments&&(t+=e.docIndex),e.annotation&&r.balanceAnnotations&&(t+="_"+e.annotation.variable),t})):null},"allTextUnits"!==r.unitSelection){e.next=12;break}return e.next=9,Wn(t,n,new Set([]),!0);case 9:o=e.sent,a=o.length,o=Fn(o,r.n,!1,r.seed,i(o));case 12:if("annotations"!==r.unitSelection){e.next=31;break}return e.next=15,Gn(t,n,!1,r.validCodes);case 15:if(s=e.sent,l=Object(f.a)(s,2),o=l[0],c=l[1],a=o.length,o=Fn(o,r.n,!1,r.seed,i(o)),!(r.annotationMix&&r.annotationMix>0)){e.next=31;break}return u=!1,e.next=25,Wn(t,n,c,u);case 25:d=e.sent,b=Math.ceil(o.length*(r.annotationMix/100)),h=Fn(d,b,!u,r.seed,i(o)),p=r.validCodes.length,h=h.map((function(e,t){if(r.balanceAnnotations)e.variable=r.validCodes[t%p];else{var n=o[t%o.length];(null===n||void 0===n?void 0:n.variable)&&(e.variable=n.variable)}return e.annotation={i:t,group:e.variable},Object(x.a)({},e)})),o=o.concat(h);case 31:return o=Vn(o,r),e.abrupt("return",[a,o]);case 33:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Wn=function(){var e=Object(b.a)(j.a.mark((function e(t,n,r,a){var i,o,c,s,l;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,B.getDocuments(t);case 2:return i=e.sent,o=0,c=1/0,t.unitSettings.useIndexWindow&&(o=t.unitSettings.indexWindow[0],c=t.unitSettings.indexWindow[1]),s=[],l=-1,e.next=10,i.each((function(e){if(l++,"document"===n&&!r.has(e.doc_uid)){if(a&&r.has(e.doc_uid))return;s.push({textUnit:n,unitIndex:0,doc_uid:e.doc_uid,document_id:e.document_id,docIndex:l})}if("paragraph"===n)for(var t=e.tokens[e.tokens.length-1].paragraph,i=o;i<=Math.min(c,t);i++){if(a&&r.has(e.doc_uid+"_"+i))return;s.push({textUnit:n,unitIndex:i,doc_uid:e.doc_uid,document_id:e.document_id,docIndex:l})}if("sentence"===n)for(var u=e.tokens[e.tokens.length-1].sentence,d=o;d<=Math.min(c,u);d++){if(a&&r.has(e.doc_uid+"_"+d))return;s.push({textUnit:n,unitIndex:d,doc_uid:e.doc_uid,document_id:e.document_id,docIndex:l})}}));case 10:return e.abrupt("return",s);case 11:case"end":return e.stop()}}),e)})));return function(t,n,r,a){return e.apply(this,arguments)}}(),Gn=function(){var e=Object(b.a)(j.a.mark((function e(t,n,r,a){var i,o,c,s,l;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,B.getDocuments(t);case 2:return i=e.sent,o=null,a&&(o=a.reduce((function(e,t){return e[t]=!0,e}),{})),c=[],s=new Set([]),l=-1,e.next=10,i.each((function(e){var t;if(l++,null===(t=e.annotations)||void 0===t?void 0:t.span)for(var a=0,i=Object.keys(e.annotations.span);a<i.length;a++)for(var u=i[a],d=0,j=Object.keys(e.annotations.span[u]);d<j.length;d++){var b=j[d];if(u>e.annotations.span[u][b].span[0]){if("document"===n)continue;if("span"===n)continue;if("paragraph"===n&&e.tokens[u].paragraph===e.tokens[u-1].paragraph)continue;if("sentence"===n&&e.tokens[u].sentence===e.tokens[u-1].sentence)continue}if(!o||null!=o[b]){var f={textUnit:n,doc_uid:e.doc_uid,document_id:e.document_id,docIndex:l,group:b};if("document"!==n&&"span"!==n||(f.unitIndex=Number(u)),"paragraph"===n&&(f.unitIndex=e.tokens[Number(u)].paragraph),"sentence"===n&&(f.unitIndex=e.tokens[Number(u)].sentence),r){var h=f.doc_uid+"_"+f.textUnit+"_"+f.unitIndex;if(s.has(h))continue;s.add(h)}else f.annotation=Object(x.a)(Object(x.a)({},e.annotations.span[u][b]),{},{group:b});c.push(f)}}}));case 10:return e.abrupt("return",[c,s]);case 11:case"end":return e.stop()}}),e)})));return function(t,n,r,a){return e.apply(this,arguments)}}(),Vn=function(e,t){return t.ordered?e.sort((function(e,t){return e.docIndex!==t.docIndex?e.docIndex-t.docIndex:e.unitIndex!==t.unitIndex?e.unitIndex-t.unitIndex:null!=e.annotation&&e.annotation.index!==t?e.annotation.index-t.annotation.index:0})):e},Jn=function(e){var t=Object(r.useState)(null),n=Object(f.a)(t,2),a=n[0],i=n[1];return Object(r.useEffect)((function(){if(!(null===e||void 0===e?void 0:e.unitSettings))return null;i(null),Hn(e,i)}),[e,i]),e?a:null},Yn=function(e,t,n,r){var a=[];if(0===e.length)return a;var i=[0,e.length-1],o=[0,e.length-1];"span"===t.textUnit&&(i=t.annotation.span),"paragraph"!==t.textUnit&&"sentence"!==t.textUnit||(i=Kn(e,t.textUnit,t.unitIndex,t.unitIndex)),"paragraph"!==n&&"sentence"!==n||(o=Qn(e,i,n,r)),"none"===n&&(o=i);for(var c=0;c<e.length;c++)if(e[c].codingUnit=!0,e[c].index<i[0]&&(e[c].codingUnit=!1),e[c].index>i[1]&&(e[c].codingUnit=!1),!(e[c].index<o[0])){if(e[c].index>o[1])break;a.push(e[c])}return a},Kn=function(e,t,n,r){var a=[e[0].index,e[e.length-1].index],i=e.find((function(e){return e[t]===n}));i&&(a[0]=i.index);var o=e.find((function(e){return e[t]===r+1}));return o&&(a[1]=o.index-1),a},Qn=function(e,t,n,r){var a=-e[0].index,i=[e[t[0]+a][n],e[t[1]+a][n]];return i[0]=i[0]-r[0],i[1]=i[1]+r[1],Kn(e,n,i[0],i[1])},Xn=function(){var e=Object(b.a)(j.a.mark((function e(t,n){var r,a,i,o,c,s,l,u,d,b;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=t.unitSettings,a=r.contextUnit,i=r.contextWindow,o={},c=[],s=S()(t),l=0;case 5:if(!(l<n.length)){e.next=18;break}if(u=n[l].doc_uid,o[u]){e.next=11;break}return e.next=10,B.getDocument(u);case 10:o[u]=e.sent;case 11:d=Yn(o[u].tokens,n[l],a,i),(b={text_fields:Zn(d),document_id:n[l].document_id,meta:{unit:n[l].textUnit,unit_index:n[l].unitIndex}}).unit_id=S()({jobhash:s,item:b,date:Date()}),c.push(b);case 15:l++,e.next=5;break;case 18:return e.abrupt("return",c);case 19:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),Zn=function(e){var t=[];if(0===e.length)return t;var n=null,r=null,a="",i=e[0].section,o={};e[0].offset>0&&(o.offset=e[0].offset);var c,s=!1,l=!1,u=Object(g.a)(e);try{for(u.s();!(c=u.n()).done;){var d=c.value;if(d.section!==i){var j=Object(x.a)({name:i,value:a},o);null!==n&&(j.unit_start=n),null!==r&&(j.unit_end=r),t.push(j),o={},d.offset>0&&(o.offset=d.offset),n=null,r=null,a=""}!s&&d.codingUnit&&(n=d.offset,s=!0),!s||l||d.codingUnit||(r=d.offset-1,l=!0),a=a+d.pre+d.text+d.post,i=d.section}}catch(f){u.e(f)}finally{u.f()}if(a.length>0){var b=Object(x.a)({name:i,value:a},o);null!==n&&(b.unit_start=n),null!==r&&(b.unit_end=r),t.push(b)}return t},$n=function(e){if(!e)return[];var t=[{Header:"Document ID",accessor:"document_id",headerClass:"five wide"}];return"paragraph"!==e.textUnit&&"sentence"!==e.textUnit||t.push({Header:e.textUnit,accessor:"unitIndex",headerClass:"five wide"}),"span"===e.textUnit&&(t.push({Header:"Token",accessor:"annotation.index",headerClass:"three wide"}),t.push({Header:"Code",accessor:"group",headerClass:"five wide"})),t},er=function(e){var t=e.codingjob,n=Jn(t);return t?Object(W.jsx)("div",{children:Object(W.jsxs)(re.a,{stackable:!0,celled:"internally",columns:3,children:[Object(W.jsxs)(re.a.Column,{verticalAlign:"top",stretched:!0,width:6,children:[Object(W.jsx)(p.a,{textAlign:"center",style:{background:"#1B1C1D",color:"white"},children:"Settings"}),Object(W.jsx)(Ht,{codingjob:t})]}),Object(W.jsx)(tr,{codingjob:t,units:n})]})}):null},tr=a.a.memo((function(e){var t,n=e.codingjob,a=e.units,i=Object(r.useState)(null),o=Object(f.a)(i,2),c=o[0],s=o[1],l=Object(r.useState)(null),u=Object(f.a)(l,2),d=u[0],j=u[1];return Object(r.useEffect)((function(){if(!c)return null;Xn(n,[c]).then((function(e){var t=e[0];t.post=function(e){return console.log(e)},j(t)}))}),[c,j,n]),Object(r.useEffect)((function(){a&&a.length>0?s(Object(x.a)(Object(x.a)({},a[0]),{},{ROW_ID:"0"})):s(null)}),[a,s]),Object(W.jsxs)(W.Fragment,{children:[Object(W.jsxs)(re.a.Column,{width:5,children:[Object(W.jsx)(p.a,{textAlign:"center",style:{background:"#1B1C1D",color:"white"},children:"Selected units"}),Object(W.jsx)(pe.a,{inverted:!0,active:(null===n||void 0===n||null===(t=n.unitSettings)||void 0===t?void 0:t.textUnit)&&null===a,children:Object(W.jsx)(ve.a,{})}),Object(W.jsx)(_e,{columns:$n(null===n||void 0===n?void 0:n.unitSettings),selectedRow:c,setSelectedRow:s,data:a||[],defaultSize:10})]}),Object(W.jsx)(re.a.Column,{width:5,children:Object(W.jsx)(nr,{item:d,codebook:{}})})]})})),nr=function(e){var t=e.item,n=e.codebook;return Object(W.jsx)(re.a.Column,{width:6,children:t?Object(W.jsxs)(W.Fragment,{children:[Object(W.jsx)(p.a,{textAlign:"center",style:{background:"#1B1C1D",color:"white"},children:"Unit preview"}),Object(W.jsx)(pe.a,{inverted:!0,active:null===t,children:Object(W.jsx)(ve.a,{})}),Object(W.jsx)(Un,{unit:t,codes:null===n||void 0===n?void 0:n.codes,settings:{}})]}):null})},rr=a.a.memo(er),ar=n(326),ir=function(e){var t=e.variables,n=e.setVariables,a=e.index,i=Object(r.useState)(""),o=Object(f.a)(i,2),c=o[0],s=o[1],l=Object(ht.b)();return Object(r.useEffect)((function(){if(0!==t.length&&c&&c!==t[a].name&&t[a].name!==c){var e=setTimeout((function(){!function(e,t,n,r){t[n].name!==e&&(t[n].name=sr(e,t,n),r(t))}(c.trim(),t,a,n)}),500);return function(){return clearTimeout(e)}}}),[c,t,a,n]),Object(r.useEffect)((function(){0!==t.length&&s(t[a].name)}),[t,a,s]),Object(W.jsx)(ae.a,{children:Object(W.jsxs)(ae.a.Group,{grouped:!0,children:[Object(W.jsx)("label",{children:"Name"})," ",Object(W.jsx)("span",{style:{fontSize:"10px"},children:"(keep it short)"}),Object(W.jsx)(ae.a.Field,{children:Object(W.jsx)($e.a,{value:c,style:{width:"150px"},onFocus:function(){return l(pt(!0))},onBlur:function(){return l(pt(!1))},onChange:function(e,t){return s(t.value)}})})," "]})})},or=function(e){var t=e.variables,n=e.setVariables,a=e.index,i=e.setIndex,o=Object(r.useState)(!1),c=Object(f.a)(o,2),s=c[0],u=c[1];return 0===t.length?null:Object(W.jsxs)(tt.a,{hoverable:!0,open:s,onClose:function(){return u(!1)},trigger:Object(W.jsx)(l.a.Item,{icon:"minus",position:"right",style:{background:"red"},onClick:function(){return u(!s)}}),children:[Object(W.jsxs)("p",{children:["Delete ",Object(W.jsx)("b",{children:t[a].name}),"?"]}),Object(W.jsx)(v.a,{style:{background:"red"},onClick:function(){for(var e=[],r=0;r<t.length;r++)r!==a&&e.push(t[r]);n(e),u(!1),i(Math.max(0,a-1))},children:"yes please"})]})},cr=function(e){var t=e.i,n=e.variables,r=e.setVariables,a=e.index,i=e.setIndex,o=function(e,t){var a="left"===e?Math.max(0,t-1):Math.min(n.length-1,t+1),o=n[t];n[t]=n[a],n[a]=o,r(n),i(a)};return a!==t?null:Object(W.jsxs)(v.a.Group,{children:[t>0?Object(W.jsx)(v.a,{icon:"arrow left",onClick:function(){o("left",t)},style:{borderRadius:"0",padding:"0em",background:"rgba(0,0,0,0)"}}):null,t<n.length-1?Object(W.jsx)(v.a,{icon:"arrow right",onClick:function(){return o("right",t)},style:{borderRadius:"0",padding:"0em",background:"rgba(0,0,0,0)"}}):null]})},sr=function(e,t,n){for(var r=e,a=2,i=[],o=0;o<t.length;o++)null!==n&&o===n||i.push(t[o].name);for(;i.includes(r);)r=e+" ".concat(a),a++;return r},lr=function(e){var t=e.children,n=e.variables,r=e.setVariables,a=e.index,i=e.setIndex,o=e.newVariableDefaults;return Object(W.jsxs)("div",{children:[Object(W.jsxs)(l.a,{attached:"top",children:[Array(n.length).fill(0).map((function(e,t){return Object(W.jsx)(l.a.Item,{active:a===t,style:{padding:"0em",position:"relative"},children:Object(W.jsxs)("div",{children:[Object(W.jsx)("div",{onClick:function(e,n){return i(t)},style:{padding:"0.5em",cursor:"pointer"},children:n[t].name}),Object(W.jsx)("div",{style:{position:"absolute",zIndex:10,bottom:"-1.5em"},children:Object(W.jsx)(cr,{i:t,variables:n,setVariables:r,index:a,setIndex:i})})]})})})),Object(W.jsx)(l.a.Item,{icon:"plus",style:{background:"lightblue"},onClick:function(){var e=Object(x.a)(Object(x.a)({},o),{},{name:sr(o.name,n,null)});n.push(e),r(n)}}),Object(W.jsx)(or,{variables:n,setVariables:r,index:a,setIndex:i})]}),Object(W.jsxs)(ie.a,{attached:"bottom",style:{padding:"1em"},children:[Object(W.jsx)("br",{}),Object(W.jsx)(ir,{variables:n,setVariables:r,index:a}),t]})]})},ur={type:"select code",name:"Question name",question:"The question itself",codes:["No","Skip","Yes"]},dr=function(e){var t=e.taskSettings,n=e.setTaskSettings,r=e.unitSettings,a=e.questionIndex,i=t.questions.questions;return Object(W.jsx)(jr,{questionForm:i[a],setQuestionForm:function(e){var r=Object(x.a)({},t),i=Object(x.a)({},e);r.questions.questions[a]=i,n(r)},setTaskSettings:n,questions:i,questionIndex:a,unitSettings:r})},jr=function(e){var t=e.questionForm,n=e.setQuestionForm,a=e.questions,i=e.unitSettings,o=Object(r.useState)(""),c=Object(f.a)(o,2),s=c[0],l=c[1],u=Object(r.useState)([]),d=Object(f.a)(u,2),j=d[0],b=d[1];Object(r.useEffect)((function(){if(s&&t.question!==s.question){var e=setTimeout((function(){n(Object(x.a)(Object(x.a)({},t),{},{name:s.name,question:s.question}))}),500);return function(){return clearTimeout(e)}}}),[s,t,n]),Object(r.useEffect)((function(){var e=[];t.question.search("\\[code\\]")>=0&&"allTextUnits"===(null===i||void 0===i?void 0:i.unitSelection)&&e.push("Referring to a specific code with [code] is only possible if coding units are annotations"),b(e),l({name:t.name,question:t.question})}),[l,t,b,i]);return t?Object(W.jsxs)(ae.a,{children:[Object(W.jsxs)(ae.a.Group,{grouped:!0,children:[Object(W.jsx)("br",{}),Object(W.jsxs)("label",{children:["Question",Object(W.jsx)(nt,{header:"Referring to annotation codes in a question",texts:["If unit selection is based on span annotations, you can also use the tag [code]. This will be replaced by the code label of the annotation"]})]}),j.length>0?Object(W.jsx)(nt,{type:"warn",header:"",texts:j}):null,Object(W.jsx)(ae.a.Field,{children:Object(W.jsx)(rt.a,{value:s.question,onChange:function(e,t){return l(Object(x.a)(Object(x.a)({},s),{},{question:t.value}))}})})]}),Object(W.jsxs)(ae.a.Group,{grouped:!0,children:[Object(W.jsx)("label",{children:"Type of answer"}),Object(W.jsx)(ae.a.Field,{children:Object(W.jsx)(Ze.a,{value:"search code",label:"Select code from search box",checked:"search code"===t.type,onChange:function(){return n(Object(x.a)(Object(x.a)({},t),{},{type:"search code"}))}})}),Object(W.jsx)(ae.a.Field,{children:Object(W.jsx)(Ze.a,{value:"select code",label:"Select code from buttons",checked:"select code"===t.type,onChange:function(){return n(Object(x.a)(Object(x.a)({},t),{},{type:"select code"}))}})}),Object(W.jsx)(ae.a.Field,{children:Object(W.jsx)(Ze.a,{value:"annotinder",label:"Annotinder (swipe left/right/up)",checked:"annotinder"===t.type,onChange:function(){return n(Object(x.a)(Object(x.a)({},t),{},{type:"annotinder"}))}})})]}),Object(W.jsx)("br",{}),Object(W.jsx)("br",{}),Object(W.jsx)(br,{questionForm:t,setQuestionForm:n}),Object(W.jsx)("div",{style:{margin:"-1em"},children:Object(W.jsx)(Dt,{codes:ct(t.codes),setCodes:function(e){return n(Object(x.a)(Object(x.a)({},t),{},{codes:e}))},questions:a})})]}):null},br=function(e){var t,n,a,i=e.questionForm,o=e.setQuestionForm,c=Object(r.useState)({left:null,up:null,right:null}),s=Object(f.a)(c,2),l=s[0],u=s[1];Object(r.useEffect)((function(){if("annotinder"!==i.type)return null;var e,t=Object(_.a)(i.codes),n=!0,r=Object(g.a)(t);try{for(r.s();!(e=r.n()).done;){var a=e.value;(null===a||void 0===a?void 0:a.swipe)&&(n=!1)}}catch(l){r.e(l)}finally{r.f()}if(!n)return null;for(var c=["left","up","right"],s=0;s<3;s++)t.length>s&&("object"===typeof t[s]?t[s]=Object(x.a)(Object(x.a)({},t[s]),{},{swipe:c[s]}):t[s]={code:t[s],swipe:c[s]});o(Object(x.a)(Object(x.a)({},i),{},{codes:t}))}),[i,o]),Object(r.useEffect)((function(){var e=function(e){return i.codes.find((function(t){return"object"===typeof t&&(t.swipe&&t.swipe===e)}))},t=e("left")||null,n=e("up")||null,r=e("right")||null;u({left:t,up:n,right:r})}),[i,u]);var d=function(e,t){var n=i.codes.map((function(n){var r="object"!==typeof n?{code:n}:Object(x.a)({},n);return r.code===t?Object(x.a)(Object(x.a)({},r),{},{swipe:e}):r.swipe&&r.swipe===e?Object(x.a)(Object(x.a)({},r),{},{swipe:null}):(r.swipe||(r.swipe=null),r)}));o(Object(x.a)(Object(x.a)({},i),{},{codes:n}))};if("annotinder"!==i.type)return null;var j=i.codes.map((function(e,t){return{key:t,text:e.code||e,value:e.code||e}}));return Object(W.jsxs)(ae.a,{children:[Object(W.jsxs)(re.a,{textAlign:"center",verticalAlign:"middle",children:[Object(W.jsx)(re.a.Row,{style:{paddingBottom:"0"},children:Object(W.jsx)(re.a.Column,{width:6,children:Object(W.jsxs)(ae.a.Group,{grouped:!0,children:[Object(W.jsx)("b",{children:"swipe"})," or ",Object(W.jsx)("b",{children:"arrow up"}),Object(W.jsx)("br",{}),Object(W.jsx)(Ue.a,{placeholder:"not used",clearable:!0,value:(null===(t=l.up)||void 0===t?void 0:t.code)||null,options:j,selection:!0,style:{minWidth:"10em",maxWidth:"10em"},onChange:function(e,t){return d("up",t.value)}})]})})}),Object(W.jsxs)(re.a.Row,{children:[Object(W.jsxs)(re.a.Column,{width:8,children:[Object(W.jsx)("b",{children:"swipe"})," or ",Object(W.jsx)("b",{children:"arrow left"}),Object(W.jsx)("br",{}),Object(W.jsx)(Ue.a,{placeholder:"not used",clearable:!0,value:(null===(n=l.left)||void 0===n?void 0:n.code)||null,options:j,selection:!0,style:{minWidth:"10em",maxWidth:"10em"},onChange:function(e,t){return d("left",t.value)}})]}),Object(W.jsxs)(re.a.Column,{width:8,children:[Object(W.jsx)("b",{children:"swipe"})," or ",Object(W.jsx)("b",{children:"arrow right"}),Object(W.jsx)("br",{}),Object(W.jsx)(Ue.a,{placeholder:"not used",clearable:!0,value:(null===(a=l.right)||void 0===a?void 0:a.code)||null,options:j,selection:!0,style:{minWidth:"10em",maxWidth:"10em"},onChange:function(e,t){return d("right",t.value)}})]})]})]}),Object(W.jsx)("br",{}),Object(W.jsx)("br",{})]})},fr=function(e){var t=e.taskSettings,n=e.setTaskSettings,a=e.unitSettings,i=Object(r.useState)(0),o=Object(f.a)(i,2),c=o[0],s=o[1];return Object(W.jsxs)(lr,{variables:t.questions.questions,setVariables:function(e){n(Object(x.a)(Object(x.a)({},t),{},{questions:{settings:t.questions.settings,questions:e}}))},index:c,setIndex:s,newVariableDefaults:ur,children:[Object(W.jsx)(dr,{taskSettings:t,setTaskSettings:n,unitSettings:a,questionIndex:c})," "]})},hr={name:"Variable name",buttonMode:"all",searchBox:!1,codes:["No","Skip","Yes"]},pr=function(e){var t,n,r=e.taskSettings,a=e.setTaskSettings,i=e.variableIndex,o=r.annotate.variables[i],c=function(e){var t=Object(x.a)({},r),n=Object(x.a)({},e);t.annotate.variables[i]=n,a(t)};return(null===r||void 0===r||null===(t=r.annotate)||void 0===t||null===(n=t.variables)||void 0===n?void 0:n[i])?Object(W.jsxs)(ae.a,{children:[Object(W.jsxs)(ae.a.Group,{children:[Object(W.jsx)(O.a,{name:"setting"}),Object(W.jsx)("label",{children:"Code Selector settings"})]}),Object(W.jsx)(ae.a.Group,{children:Object(W.jsx)(ae.a.Field,{children:Object(W.jsx)(et.a,{label:"Search box",disabled:"recent"===o.buttonMode,checked:o.searchBox||"recent"===o.buttonMode,onChange:function(e,t){return c(Object(x.a)(Object(x.a)({},o),{},{searchBox:t.checked}))}})})}),Object(W.jsxs)(ae.a.Group,{grouped:!0,children:[Object(W.jsx)("label",{children:"Code buttons"}),Object(W.jsxs)(ae.a.Field,{children:[Object(W.jsx)(Ze.a,{value:"all",label:"Show all codes",checked:"all"===o.buttonMode,onChange:function(){return c(Object(x.a)(Object(x.a)({},o),{},{buttonMode:"all"}))}}),Object(W.jsx)(nt,{header:"Show all active codes",texts:["Only codes that are 'active' will be shown","You can toggle which codes are active in the codebook (top-right in menu bar)"]})]}),Object(W.jsxs)(ae.a.Field,{children:[Object(W.jsx)(Ze.a,{value:"recent",label:"Show recently used",checked:"recent"===o.buttonMode,onChange:function(){return c(Object(x.a)(Object(x.a)({},o),{},{buttonMode:"recent"}))}}),Object(W.jsx)(nt,{header:"Show recently used codes",texts:["Show only (active) codes that the coder used recently","The Search box is always enabled with this option, and the buttons only serve as quick keys. This is especially usefull for very large codebooks, for instance for tagging specific named entities"]})]})]}),Object(W.jsx)("br",{}),Object(W.jsx)("div",{style:{overflow:"auto",margin:"-1em"},children:Object(W.jsx)(Dt,{codes:ct(o.codes),setCodes:function(e){return c(Object(x.a)(Object(x.a)({},o),{},{codes:e}))}})})]}):null},vr=function(e){var t=e.taskSettings,n=e.setTaskSettings,a=Object(r.useState)(0),i=Object(f.a)(a,2),o=i[0],c=i[1];return Object(W.jsxs)(lr,{variables:t.annotate.variables,setVariables:function(e){n(Object(x.a)(Object(x.a)({},t),{},{annotate:{settings:t.annotate.settings,variables:e}}))},index:o,setIndex:c,newVariableDefaults:hr,children:[Object(W.jsx)("br",{}),Object(W.jsx)(pr,{taskSettings:t,setTaskSettings:n,variableIndex:o})," "]})},Or={type:null,annotate:{settings:{},variables:[{name:"Variable name",buttonMode:"all",searchBox:!1,codes:["Some","example","options"]}]},questions:{settings:{},questions:[{name:"Question name",type:"select code",question:"[The question itself]",codes:["No","Skip","Yes"]}]}},xr=function(e){var t=e.codingjob,n=null===t||void 0===t?void 0:t.unitSettings,r=(null===t||void 0===t?void 0:t.taskSettings)||Or,a=function(e){B.setCodingjobProp(t,"taskSettings",e)};return r&&n?Object(W.jsxs)("div",{style:{verticalAlign:"top",float:"top",paddingLeft:"1em"},children:[Object(W.jsx)(gr,{taskSettings:r,setTaskSettings:a}),Object(W.jsx)(ar.a,{}),"questions"===r.type?Object(W.jsx)(fr,{taskSettings:r,setTaskSettings:a,unitSettings:n}):null,"annotate"===r.type?Object(W.jsx)(vr,{taskSettings:r,setTaskSettings:a,unitSettings:n}):null]}):null},gr=function(e){var t=e.taskSettings,n=e.setTaskSettings;Object(r.useEffect)((function(){(null===t||void 0===t?void 0:t.type)||n(Object(x.a)(Object(x.a)({},t),{},{type:"annotate"}))}),[t,n]);var a=function(e,r){return Object(W.jsx)(ae.a.Field,{children:Object(W.jsx)(Ze.a,{value:e,label:r,checked:t.type===e,onChange:function(r,a){return n(Object(x.a)(Object(x.a)({},t),{},{type:e}))}})})};return Object(W.jsxs)(ae.a,{children:[Object(W.jsxs)(ae.a.Group,{children:[Object(W.jsx)(O.a,{name:"setting"}),Object(W.jsx)("label",{children:"Set task type"})]}),Object(W.jsxs)(ae.a.Group,{grouped:!0,widths:"equal",children:[a("annotate","Annotate"),a("questions","Question")]})]})},mr=a.a.memo(xr),kr=function(e){var t=e.n,n=e.index,a=e.setIndex,i=e.canGoForward,o=void 0===i||i,c=e.canGoBack,s=void 0===c||c,l=Object(r.useRef)(0),u=Object(r.useRef)(!1),d=Object(r.useState)(!1),j=Object(f.a)(d,2),b=j[0],h=j[1],p=Object(r.useState)(1),v=Object(f.a)(p,2),O=v[0],x=v[1],g=Object(r.useState)(1),m=Object(f.a)(g,2),k=m[0],y=m[1];return Object(r.useEffect)((function(){null!==n&&x(Math.min(n+1,t+1)),null===n&&x(t+1)}),[n,t,x]),Object(r.useEffect)((function(){l.current=0,u.current=!1}),[t]),Object(r.useEffect)((function(){if(!t)return null;x(1),u.current=!0}),[t,x]),Object(r.useEffect)((function(){if(!t)return null;l.current=Math.max(O,l.current),a(O-1===t?null:O-1),y(O)}),[t,a,O]),Object(r.useEffect)((function(){if(!t)return null;if(O===k)return h(!1),null;h(!0);var e=setTimeout((function(){x(k),h(!1)}),500);return function(){return clearTimeout(e)}}),[O,k,t,h]),t?Object(W.jsxs)(ie.a,{style:{border:"none",boxShadow:"none",padding:"0",leftMargin:"0px",width:"100%",maxHeight:"35px",borderRadius:"0"},children:[Object(W.jsx)(ve.a,{active:b,content:""}),Object(W.jsx)($e.a,{style:{padding:"0 !important",margin:"0",width:"100%"},min:1,max:t+1,onChange:function(e,t){(o||Number(t.value)<l.current)&&Number(t.value)>k&&y(Number(t.value)),s&&Number(t.value)<k&&y(Number(t.value))},type:"range",labelPosition:"left",label:Object(W.jsx)(Ce.a,{secondary:!0,activePage:k,pageItem:k<=t?"".concat(k," / ").concat(t):"done / ".concat(t),size:"mini",firstItem:null,lastItem:null,prevItem:s?"back":null,nextItem:o||O<l.current?"next":"",siblingRange:0,boundaryRange:0,ellipsisItem:null,totalPages:t+1,onClick:function(e,t){return e.stopPropagation()},onPageChange:function(e,t){(o||O<l.current)&&Number(t.activePage)>O&&x(Number(t.activePage)),s&&Number(t.activePage)<O&&x(Number(t.activePage))},style:{fontSize:"9px",border:"none",boxShadow:"none",padding:0,margin:0}}),value:k})]}):null},yr=n(178),wr=[4,4,2,2],Cr=function(e,t,n){for(var r=[],a=null,i=null,o=0,c=Object.keys(n);o<c.length;o++)for(var s=c[o],l=function(){var o=d[u];if((i=n[s][o]).index!==i.span[0])return"continue";for(var c=-e[0].index,l=!0,j=i.span[0];j<=i.span[1];j++)null!=e[j+c]&&e[j+c].codingUnit&&(l=!1);if(l)return"continue";var b=e.slice(i.span[0]+c,i.span[1]+1+c);a=b.map((function(e,t){var n=t>0?e.pre:"",r=t<b.length-1?e.post:"";return n+e.text+r})).join("");var f=Object(W.jsx)(Sr,{tokens:e,variable:o,variableMap:t,annotation:i,text:a,offset:c},s+i.value);r.push(f)},u=0,d=Object.keys(n[s]);u<d.length;u++)l();return r},Sr=function(e){e.tokens;var t,n=e.variable,a=e.variableMap,i=e.annotation,o=e.text,c=(e.offset,Object(r.useRef)());if(!a)return null;var s=a[n].codeMap,l=sn(i.value,s),u=(null===(t=s[i.value])||void 0===t?void 0:t.foldToParent)?"".concat(s[i.value].foldToParent," - ").concat(i.value):i.value;return Object(W.jsx)(vn.a,{innerRef:c,children:Object(W.jsxs)(ke.a.Row,{className:"annotations-tr",children:[Object(W.jsx)(ke.a.Cell,{width:wr[0],children:Object(W.jsx)("span",{title:n,children:n})}),Object(W.jsx)(ke.a.Cell,{width:wr[1],style:l?{background:l}:null,children:Object(W.jsx)("span",{title:u,children:u})}),Object(W.jsx)(ke.a.Cell,{width:wr[2],children:i.section}),Object(W.jsx)(ke.a.Cell,{width:wr[3],cref:c,children:"".concat(i.span[0],"-").concat(i.span[1])}),Object(W.jsx)(ke.a.Cell,{children:Object(W.jsx)("span",{title:o,children:o})})]})})},_r=function(e){var t=e.tokens,n=e.variableMap,r=e.annotations;return t&&0!==t.length?Object(W.jsxs)(ke.a,{style:{fontSize:"10px"},fixed:!0,role:"grid","arioa-labelledby":"header",selectable:!0,unstackable:!0,singleLine:!0,compact:"very",size:"small",children:[Object(W.jsx)(ke.a.Header,{className:"annotations-thead",children:Object(W.jsxs)(ke.a.Row,{children:[Object(W.jsx)(ke.a.HeaderCell,{width:wr[0],children:"Variable"}),Object(W.jsx)(ke.a.HeaderCell,{width:wr[1],children:"Value"}),Object(W.jsx)(ke.a.HeaderCell,{width:wr[2],children:"Section"}),Object(W.jsx)(ke.a.HeaderCell,{width:wr[3],children:"Tokens"}),Object(W.jsx)(ke.a.HeaderCell,{children:"Text"})]})}),Object(W.jsx)(ke.a.Body,{className:"annotations-tbody",children:Cr(t,n,T(r,t))})]}):null},Ar=function(e){var t=e.unit,n=e.codebook,a=e.blockEvents,i=Object(r.useState)([]),o=Object(f.a)(i,2),c=o[0],s=o[1],l=Object(r.useState)(null),u=Object(f.a)(l,2),d=u[0],j=u[1],b=Object(r.useState)(),h=Object(f.a)(b,2),p=h[0],v=h[1];return Object(r.useEffect)((function(){var e,t={},r=Object(g.a)(n.variables);try{for(r.s();!(e=r.n()).done;){var a=e.value;if(!(null===a||void 0===a?void 0:a.codes))return null;var i=st(Object(_.a)(a.codes));t[a.name]=Object(x.a)(Object(x.a)({},a),{},{codeMap:i})}}catch(o){r.e(o)}finally{r.f()}j(t)}),[n,j]),t&&null!==(null===n||void 0===n?void 0:n.variables)?Object(W.jsxs)(re.a,{centered:!0,style:{height:"100%",width:"100%",paddingTop:"0"},verticalAlign:"top",columns:2,children:[Object(W.jsx)(re.a.Column,{width:10,style:{paddingRight:"0em",height:"100%"},children:Object(W.jsx)(Un,{unit:t,variables:null===n||void 0===n?void 0:n.variables,settings:null===n||void 0===n?void 0:n.settings,onChangeAnnotations:s,returnTokens:v,blockEvents:a})}),Object(W.jsxs)(re.a.Column,{width:6,style:{paddingRight:"0em",height:"100%",overflow:"auto"},children:[Object(W.jsx)(Ir,{codebook:n}),Object(W.jsx)(_r,{tokens:p,variableMap:d,annotations:c})]})]}):null},Ir=function(){var e=Object(r.useState)(!1),t=Object(f.a)(e,2),n=t[0],a=t[1];return Object(W.jsx)(tt.a,{flowing:!0,open:n,position:"bottom right",trigger:Object(W.jsx)(v.a,{fluid:!0,primary:!0,size:"tiny",onClick:function(){return a(!n)},style:{},children:"Instructions"}),children:Object(W.jsxs)(he.a,{style:{paddingTop:"2em",width:"500px"},children:[Object(W.jsx)(p.a,{as:"h4",align:"center",children:"Edit span annotations"}),Object(W.jsx)("p",{align:"center",children:"Assign codes to words or phrases. A word can have multiple codes."}),Object(W.jsxs)(ke.a,{unstackable:!0,children:[Object(W.jsx)(ke.a.Header,{children:Object(W.jsxs)(ke.a.Row,{children:[Object(W.jsx)(ke.a.HeaderCell,{}),Object(W.jsx)(ke.a.HeaderCell,{children:"Keyboard"}),Object(W.jsx)(ke.a.HeaderCell,{children:"Mouse"}),Object(W.jsx)(ke.a.HeaderCell,{children:"Touchpad"})]})}),Object(W.jsxs)(ke.a.Body,{children:[Object(W.jsxs)(ke.a.Row,{children:[Object(W.jsx)(ke.a.Cell,{children:Object(W.jsx)("strong",{children:"Navigate"})}),Object(W.jsx)(ke.a.Cell,{children:Object(W.jsx)("i",{children:"Arrow keys"})}),Object(W.jsx)(ke.a.Cell,{}),Object(W.jsx)(ke.a.Cell,{})]}),Object(W.jsxs)(ke.a.Row,{children:[Object(W.jsx)(ke.a.Cell,{children:Object(W.jsx)("strong",{children:"Select words"})}),Object(W.jsxs)(ke.a.Cell,{children:[Object(W.jsx)("i",{children:"spacebar"}),Object(W.jsx)("br",{}),"Hold to select mutiple"]}),Object(W.jsxs)(ke.a.Cell,{children:[Object(W.jsx)("i",{children:"Left-click"}),Object(W.jsx)("br",{}),"Hold to select multiple"]}),Object(W.jsxs)(ke.a.Cell,{children:[Object(W.jsx)("i",{children:"tab"})," first word 2 times, then last word 1 time"]})]}),Object(W.jsxs)(ke.a.Row,{children:[Object(W.jsx)(ke.a.Cell,{children:Object(W.jsx)("strong",{children:"Edit code"})}),Object(W.jsxs)(ke.a.Cell,{children:["Press ",Object(W.jsx)("i",{children:"spacebar"})," (don't hold) on an annotation"]}),Object(W.jsxs)(ke.a.Cell,{children:[Object(W.jsx)("i",{children:"Left-click"})," (don't hold) on an annotation"]}),Object(W.jsxs)(ke.a.Cell,{children:[Object(W.jsx)("i",{children:"tab"})," an annotation 3 times"]})]})]}),Object(W.jsx)(ke.a.Footer,{children:Object(W.jsxs)(ke.a.Row,{children:[Object(W.jsxs)(ke.a.HeaderCell,{children:[Object(W.jsx)("strong",{children:"Quick keys"})," ",Object(W.jsx)("br",{}),"in popup"]}),Object(W.jsx)(ke.a.HeaderCell,{colSpan:"3",children:Object(W.jsxs)(cn.a,{as:"ul",children:[Object(W.jsxs)(yr.a,{as:"li",children:[Object(W.jsx)("i",{children:"text input"})," automatically opens dropdown"," "]}),Object(W.jsxs)(yr.a,{as:"li",children:["navigate buttons with ",Object(W.jsx)("i",{children:"arrow keys"}),", select with ",Object(W.jsx)("i",{children:"spacebar"})]}),Object(W.jsxs)(yr.a,{as:"li",children:["use ",Object(W.jsx)("i",{children:"escape"})," to close popup and ",Object(W.jsx)("i",{children:"delete"})," to remove code"]})]})})]})})]})]})})},Er=a.a.memo(Ar),Rr=["ArrowRight","ArrowLeft","ArrowUp","ArrowDown"],zr=a.a.memo((function(e){var t=e.options,n=e.callback,a=e.blockEvents,i=Object(r.useRef)();return Object(W.jsx)(vn.a,{innerRef:i,children:Object(W.jsx)(Ue.a,{fluid:!0,scrolling:!0,upward:!1,placeholder:"<type to search>",searchInput:{autoFocus:!a},style:{minWidth:"12em"},options:t.map((function(e){return{key:e.code,value:e,text:e.code+(e.tree?" ("+e.tree+")":""),content:Object(W.jsxs)(W.Fragment,{children:[e.code,Object(W.jsx)("br",{}),Object(W.jsx)("span",{style:{color:"grey"},children:e.tree})]})}})),search:!0,selection:!0,compact:!0,selectOnNavigation:!1,minCharacters:0,autoComplete:"on",onChange:function(e,t){n(t.value)}})})})),Tr=a.a.memo((function(e){var t=e.options,n=e.callback,i=e.blockEvents,o=Object(r.useState)(0),c=Object(f.a)(o,2),s=c[0],l=c[1],u=a.a.useCallback((function(e){var r=t.length;if(Rr.includes(e.key))return e.preventDefault(),"ArrowRight"===e.key&&s<r-1&&l(s+1),"ArrowDown"===e.key&&l(Wt(t,s)),"ArrowLeft"===e.key&&s>0&&l(s-1),void("ArrowUp"===e.key&&l(Bt(t,s)));46===e.keyCode&&(n(null),l(0)),32!==e.keyCode&&13!==e.keyCode||(e.preventDefault(),e.stopPropagation(),s===t.length?n(null):n(t[s]),l(0))}),[s,n,t]);Object(r.useEffect)((function(){return i?window.removeEventListener("keydown",u):window.addEventListener("keydown",u),function(){window.removeEventListener("keydown",u)}}),[u,i]);return Object(W.jsx)("div",{style:{display:"flex",flexDirection:"row",alignItems:"space-eventy",maxWidth:"100%",height:"100%",flexWrap:"wrap",justifyContent:"space-around"},children:t.map((function(e,t){return Object(W.jsx)(W.Fragment,{children:Object(W.jsx)(vn.a,{innerRef:e.ref,children:Object(W.jsx)(v.a,{style:{backgroundColor:e.color,padding:"1em",margin:"0.2em",flex:"0.5 1 0",flexBasis:"0",fontWeight:"bold",fontSize:"1em",border:t===s?"3px solid black":"3px solid #ece9e9"},value:e,compact:!0,onMouseOver:function(){return l(t)},onClick:function(e,t){n(t.value),l(0)},children:e.code},e.code)})})}))})})),Dr=a.a.memo((function(e){var t,n,i,o,c,s,l,u,d,j=e.swipeOptions,b=e.callback,f=e.swipe,h=e.blockEvents;Object(r.useEffect)((function(){f&&(console.log(f),"right"===f&&b(j.right),"up"===f&&b(j.up),"left"===f&&b(j.left))}),[f,b,j]);var p=a.a.useCallback((function(e){Rr.includes(e.key)&&(e.preventDefault(),"ArrowRight"===e.key&&b(j.right),"ArrowUp"===e.key&&b(j.up),"ArrowLeft"===e.key&&b(j.left))}),[b,j]);return Object(r.useEffect)((function(){return h?window.removeEventListener("keydown",p):window.addEventListener("keydown",p),function(){window.removeEventListener("keydown",p)}}),[p,h]),Object(W.jsxs)("div",{style:{display:"flex",flexWrap:"wrap",alignContent:"stretch",height:"100%"},children:[null==j.up?null:Object(W.jsx)(v.a,{fluid:!0,disabled:null==j.up,onClick:function(e,t){return b(j.up)},style:{margin:"0",padding:"0",flex:"1 1 auto",borderRadius:"0",border:"1px solid",background:(null===(t=j.up)||void 0===t?void 0:t.color)||"white"},children:Object(W.jsxs)("div",{style:{color:"black",fontWeight:"bold",fontSize:"1em"},children:[Object(W.jsx)(O.a,{name:(null===(n=j.up)||void 0===n?void 0:n.code)?"arrow up":null}),Object(W.jsx)("span",{children:(null===(i=j.up)||void 0===i?void 0:i.code)||""})]})}),Object(W.jsx)("div",{style:{flex:"1 1 auto"},children:Object(W.jsxs)("div",{style:{padding:"0",margin:"0",display:"flex",height:"100%",flexWrap:"wrap",alignContent:"stretch"},children:[Object(W.jsx)(v.a,{disabled:null==j.left,onClick:function(e,t){return b(j.left)},style:{margin:"0",padding:"0",flex:"1 1 auto",width:"45%",borderRadius:"0",border:"1px solid",background:(null===(o=j.left)||void 0===o?void 0:o.color)||"white"},children:Object(W.jsxs)("div",{style:{color:"black",fontWeight:"bold",fontSize:"1em"},children:[Object(W.jsx)(O.a,{name:(null===(c=j.left)||void 0===c?void 0:c.code)?"arrow left":null}),Object(W.jsx)("span",{children:(null===(s=j.left)||void 0===s?void 0:s.code)||""})]})}),Object(W.jsx)(v.a,{disabled:null==j.right,onClick:function(e,t){return b(j.right)},style:{padding:"0",margin:"0",flex:"1 1 auto",width:"45%",borderRadius:"0",border:"1px solid",background:(null===(l=j.right)||void 0===l?void 0:l.color)||"white"},children:Object(W.jsxs)("div",{style:{color:"black",fontWeight:"bold",fontSize:"1em"},children:[Object(W.jsx)("span",{children:(null===(u=j.right)||void 0===u?void 0:u.code)||""}),Object(W.jsx)(O.a,{name:(null===(d=j.right)||void 0===d?void 0:d.code)?"arrow right":null})]})})]})})]})})),Ur="lightgreen",qr=function(e){var t,n=e.unit,a=e.tokens,i=e.questions,o=e.questionIndex,c=e.setQuestionIndex,s=e.setUnitIndex,l=e.swipe,u=e.blockEvents,d=Object(r.useState)(),j=Object(f.a)(d,2),b=j[0],h=j[1],v=Object(r.useRef)(!1),O=Object(r.useState)(null),x=Object(f.a)(O,2),g=x[0],m=x[1];if(Object(r.useEffect)((function(){Fr(n,a,i,m,c),v.current=!1}),[n,a,m,i,c]),!i||!n||!g)return null;if(!(null===i||void 0===i?void 0:i[o]))return c(0),null;var k=Vr(n,i[o]);return Object(W.jsxs)("div",{style:{height:"100%",width:"100%"},children:[Object(W.jsx)(Mr,{questions:i,questionIndex:o,annotations:g,setQuestionIndex:c}),Object(W.jsxs)("div",{style:{display:"flex",position:"relative",flexFlow:"column",height:"calc(100% - 30px)",width:"100%",maxHeight:"100%",padding:"10px",color:"white",backgroundColor:"#1B1C1D"},children:[Object(W.jsx)("div",{style:{width:"100%",flex:"1 1 auto",paddingBottom:"10px"},children:Object(W.jsx)(p.a,{as:"h3",style:{color:"white"},children:k})}),Object(W.jsx)(Lr,{answerTransition:b,currentAnswer:null===g||void 0===g||null===(t=g[o])||void 0===t?void 0:t.value,questions:i,questionIndex:o,onSelect:function(e){if(v.current)return null;v.current=!0,g[o].value=e.code,n.annotations=Wr(g[o],n.annotations),Nr(n,g,e.makes_irrelevant,o),n.jobServer.postAnnotations(n.unitId,n.annotations),h(e),setTimeout((function(){h(null);for(var e=null,t=o+1;t<i.length;t++)if("IRRELEVANT"!==g[t].value){e=t;break}null===e?(s((function(e){return e+1})),c(0)):c(e),v.current=!1}),250)},swipe:l,blockEvents:u})]})]})},Nr=function(e,t,n,r){if(console.log(n),null==n||null===n)return e;var a,i=new Set,o=Object(g.a)(n);try{for(o.s();!(a=o.n()).done;){var c=a.value;if("remaining"===c)for(var s=r+1;s<t.length;s++)i.add(s);isNaN(c)||i.add(Number(c))}}catch(j){o.e(j)}finally{o.f()}var l,u=Object(g.a)(i);try{for(u.s();!(l=u.n()).done;){var d=l.value;t[d].value="IRRELEVANT",e.annotations=Wr(t[d],e.annotations)}}catch(j){u.e(j)}finally{u.f()}},Fr=function(e,t,n,r,a){if(0===t.length)return null;var i=[];e.annotations||(e.annotations=[]);for(var o=0,c=0;c<n.length;c++){var s=Pr(t,n[c],c);s.value=Br(e.annotations,s),null!==s.value&&(o=c),i.push(s)}r(i),a(o)},Mr=function(e){var t=e.questions,n=e.questionIndex,a=e.annotations,i=e.setQuestionIndex,o=Object(r.useState)(),c=Object(f.a)(o,2),s=c[0],l=c[1];Object(r.useEffect)((function(){var e=Array(a.length).fill(!1);e[0]=!0,l(e)}),[a,l]),Object(r.useEffect)((function(){l((function(e){var t=Object(_.a)(e);return t[n]=!0,t}))}),[n,l]);return Object(W.jsx)("div",{children:Object(W.jsx)(v.a.Group,{fluid:!0,style:{border:"1px solid",height:"30px"},children:t.map((function(e,r){var o=function(e){return"IRRELEVANT"===a[e].value?["black","red"]:s&&e>n&&!s[e]?["white","grey"]:a[e].value?["black",Ur]:0===e||s&&s[e]?[Ur,"#1B1C1D"]:[Ur,"grey"]}(r),c=Object(f.a)(o,2),l=c[0],u=c[1];return Object(W.jsx)(v.a,{active:r===n,style:{padding:"0em 0.2em 0.2em 0.2em",minWidth:"2em",height:"30px",borderRadius:"0",fontSize:"12px",border:"1px solid darkgrey",background:u,textOverflow:"clip",overflow:"hidden",color:l},onClick:function(){s[r]&&i(r)},children:Object(W.jsx)("span",{title:t[r].name,children:t[r].name})})}))})})},Lr=function(e){var t=e.answerTransition,n=e.currentAnswer,r=e.questions,a=e.questionIndex,i=e.onSelect,o=e.swipe,c=e.blockEvents;return t?Object(W.jsx)(ie.a,{style:{display:"flex",flex:"1 1 auto",padding:"0",overflowY:"auto",height:"100%",width:"100%",margin:"0",background:t.color,justifyContent:"center",alignItems:"center"},children:Object(W.jsx)(p.a,{as:"h1",children:t.code})}):Object(W.jsxs)(W.Fragment,{children:[Gr(n||t),Object(W.jsxs)(ie.a,{style:{flex:"1 1 auto",padding:"0",overflowY:"auto",height:"100%",width:"100%",margin:"0"},children:["search code"===r[a].type?Object(W.jsx)(zr,{options:r[a].options,callback:i,blockEvents:c}):null,"select code"===r[a].type?Object(W.jsx)(Tr,{options:r[a].options,callback:i,blockEvents:c}):null,"annotinder"===r[a].type?Object(W.jsx)(Dr,{swipeOptions:r[a].swipeOptions,currentAnswer:n,callback:i,swipe:o,blockEvents:c}):null]})]})},Pr=function(e,t,n){if(0===e.length)return null;var r,a={},i=e[e.length-1],o=[0,i.offset+i.length],c=[0,e.length-1],s=!1,l=!1,u=0,d=Object(g.a)(e);try{for(d.s();!(r=d.n()).done;){var j=r.value;j.codingUnit&&!a[j.section]&&(a[j.section]=1),!s&&j.codingUnit&&(s=!0,o[0]=j.offset,c[0]=u),l||j.codingUnit||!s||(l=!0,o[1]=e[u-1].offset+e[u-1].length,c[1]=u-1),u++}}catch(f){d.e(f)}finally{d.f()}var b={length_tokens:1+c[1]-c[0],length_paragraphs:1+e[c[1]].paragraph-e[c[0]].paragraph,length_sentences:1+e[c[1]].sentence-e[c[0]].sentence};return{variable:"Q".concat(n+1,"_").concat(t.name.replace(" ","_")),value:null,section:Object.keys(a).join(" + "),offset:o[0],length:o[1]-o[0],meta:b}},Hr=function(e,t){return e.variable===t.variable&&e.section===t.section&&e.offset===t.offset&&e.length===t.length},Br=function(e,t){if(!e)return null;var n,r=Object(g.a)(e);try{for(r.s();!(n=r.n()).done;){var a=n.value;if(Hr(a,t))return a.value}}catch(i){r.e(i)}finally{r.f()}return null},Wr=function(e,t){t||(t=[]);for(var n=0;n<t.length;n++)if(Hr(t[n],e))return t[n]=e,t;return t.push(e),t},Gr=function(e){return null==e?null:Object(W.jsx)("div",{style:{backgroundColor:"white",color:"black"},children:Object(W.jsx)(ie.a,{style:{padding:"0 0 0.5em 0",margin:"0",borderRadius:"0",background:"#1B1C1D",color:Ur,textAlign:"center"},children:Object(W.jsxs)("div",{style:{marginTop:"0.3em"},children:["you answered:","  ",Object(W.jsx)("b",{style:{fontSize:"1.5em"},children:"".concat(e)})]})})})},Vr=function(e,t){var n=t.question;if(n.search("\\[code\\]")>=0&&e.annotation){var r=e.annotation.value,a="{{lightyellow###".concat(r,"}}");n=n.replace("[code]",a)}return Jr(n)},Jr=function(e){var t=new RegExp(/{{(.*?)}}/);return e=e.replace(/(\r\n|\n|\r)/gm,""),Object(W.jsx)("div",{children:e.split(t).reduce((function(e,t,n){if(n%2===0)e.push(t);else{var r=t.split("###"),a=Object(f.a)(r,2),i=a[0],o=a[1];e.push(Object(W.jsx)("mark",{style:{backgroundColor:i},children:o},n+t))}return e}),[])})},Yr=a.a.memo(qr),Kr=n(179),Qr={centerVertical:!0},Xr=function(e){var t=e.unit,n=e.codebook,a=e.setUnitIndex,i=e.blockEvents,o=Object(r.useState)([]),c=Object(f.a)(o,2),s=c[0],l=c[1],u=Object(r.useState)(0),d=Object(f.a)(u,2),j=d[0],b=d[1],h=Object(r.useState)(null),p=Object(f.a)(h,2),v=p[0],O=p[1],g={text:Object(r.useRef)(),box:Object(r.useRef)(),code:Object(r.useRef)()},m=Object(r.useState)(0),k=Object(f.a)(m,2),y=k[0],w=k[1],C=Object(ce.a)(["questionTaskSettings"]),S=Object(f.a)(C,2),_=S[0],A=S[1],I=Object(r.useState)(_.questionTaskSettings||{splitHeight:60,textSize:1}),E=Object(f.a)(I,2),R=E[0],z=E[1],T=Object(r.useRef)(null);Object(r.useEffect)((function(){A("questionTaskSettings",JSON.stringify(R),{path:"/"})}),[R,A]),Object(r.useEffect)((function(){(null===n||void 0===n?void 0:n.questions)&&O($r(n))}),[n]),Object(r.useEffect)((function(){if(!(null===g||void 0===g?void 0:g.text.current))return null;g.box.current.style.backgroundColor="white",g.text.current.style.transition="",g.box.current.style.transition="",g.box.current.style.opacity=0,g.text.current.style.transform="translateX(0%) translateY(0%)"}),[g.text,g.box,t,j]),Object(r.useEffect)((function(){if(!(null===g||void 0===g?void 0:g.text.current))return null;g.box.current.style.transition="opacity 200ms ease-out",g.box.current.style.opacity=1}),[y,g.text,g.box,j]);var D=Object(r.useState)(null),U=Object(f.a)(D,2),q=U[0],N=U[1],F=Object(Kr.useSwipeable)(ta(null===v||void 0===v?void 0:v[j],g,N,!1)),M=Object(Kr.useSwipeable)(ta(null===v||void 0===v?void 0:v[j],g,N,!0));return t?Object(W.jsxs)("div",{ref:T,style:{height:"100%"},children:[Object(W.jsxs)("div",Object(x.a)(Object(x.a)({},F),{},{style:{position:"relative",border:"1px solid",height:"".concat(R.splitHeight,"%")},children:[Object(W.jsxs)("div",{ref:g.box,style:{height:"100%",width:"100%",overflow:"hidden",position:"absolute"},children:[Object(W.jsx)("div",{ref:g.code,style:{padding:"0.6em 0.3em",width:"100%",fontSize:"3em",position:"absolute"}}),Object(W.jsx)("div",{ref:g.text,style:{border:"1px solid",height:"100%",position:"absolute",top:"0",backgroundColor:"white",overflow:"hidden",fontSize:"".concat(R.textSize,"em")},children:Object(W.jsx)(Un,{unit:t,settings:Qr,setReady:w,returnTokens:l})})]}),Object(W.jsx)(Zr,{settings:R,setSettings:z})]})),Object(W.jsx)("div",Object(x.a)(Object(x.a)({},M),{},{style:{height:"".concat(100-R.splitHeight,"%")},children:Object(W.jsx)(Yr,{unit:t,tokens:s,questions:v,questionIndex:j,setQuestionIndex:b,setUnitIndex:a,swipe:q,blockEvents:i})}))]}):null},Zr=function(e){var t=e.settings,n=e.setSettings,r=Object(ht.c)((function(e){return e.fullScreenNode}));return Object(W.jsx)(tt.a,{on:"click",mountNode:r||void 0,trigger:Object(W.jsx)(O.a,{name:"setting",style:{position:"absolute",cursor:"pointer",top:"0px",left:"0px",color:"grey",padding:"5px 3px",height:"30px"}}),children:Object(W.jsx)(ae.a,{children:Object(W.jsxs)(ae.a.Group,{grouped:!0,children:[Object(W.jsxs)(ae.a.Field,{children:[Object(W.jsxs)("label",{children:["text window size ",Object(W.jsx)("font",{style:{color:"blue"},children:"".concat(t.splitHeight,"%")})]}),Object(W.jsx)($e.a,{size:"mini",step:2,min:20,max:80,type:"range",value:t.splitHeight,onChange:function(e,t){return n((function(e){return Object(x.a)(Object(x.a)({},e),{},{splitHeight:t.value})}))}})]}),Object(W.jsxs)(ae.a.Field,{children:[Object(W.jsxs)("label",{children:["text size scaling ",Object(W.jsx)("font",{style:{color:"blue"},children:"".concat(t.textSize)})]}),Object(W.jsx)($e.a,{size:"mini",step:.025,min:.4,max:1.2,type:"range",value:t.textSize,onChange:function(e,t){return n((function(e){return Object(x.a)(Object(x.a)({},e),{},{textSize:t.value})}))}})]})]})})})},$r=function(e){return e.questions.map((function(e){var t=st(e.codes),n=lt(t),r=ea(n),a=Object(f.a)(r,2),i=a[0],o=a[1];return Object(x.a)(Object(x.a)({},e),{},{options:i,swipeOptions:o})}))},ea=function(e){var t,n=[],r={},a=Object(g.a)(e);try{for(a.s();!(t=a.n()).done;){var i=t.value;if(i.active&&i.activeParent){var o=i.tree.join(" - "),c={code:i.code,tree:o,makes_irrelevant:i.makes_irrelevant,color:i.color};i.swipe&&(r[i.swipe]=c),n.push(c)}}}catch(s){a.e(s)}finally{a.f()}return[n,r]},ta=function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:150;if(!e)return{};if("annotinder"!==e.type)return{};var i=200,o={delta:10,preventDefaultTouchmoveEvent:!1,trackTouch:!0,trackMouse:!1,rotationAngle:0},c=function(e){var t=e.deltaX,n=e.deltaY;return Math.abs(t)>Math.abs(n)+10&&(n=0),Math.abs(t)<Math.abs(n)+10&&(t=0),r||(n=0),[t,n]};return Object(x.a)({onSwiping:function(n){var r,a,i=c(n),o=Object(f.a)(i,2),s=o[0],l=o[1];if((!(s>0)||e.swipeOptions.right)&&(!(s<0)||e.swipeOptions.left)&&(!(l<0)||e.swipeOptions.up)&&!(0!==l&&l>0)){t.text.current.style.transition="",t.text.current.style.transform="translateX(".concat(s,"px) translateY(").concat(l,"px)");var u,d,j,b,h=null===(r=e.swipeOptions.up)||void 0===r?void 0:r.color,p=null===(a=e.swipeOptions.up)||void 0===a?void 0:a.code,v="0%",O="center";if(s>0)h=null===(u=e.swipeOptions.right)||void 0===u?void 0:u.color,p=null===(d=e.swipeOptions.right)||void 0===d?void 0:d.code,v="40%",O="left";if(s<0)h=null===(j=e.swipeOptions.left)||void 0===j?void 0:j.color,p=null===(b=e.swipeOptions.left)||void 0===b?void 0:b.code,v="40%",O="right";t.box.current.style.backgroundColor=h,t.code.current.innerText=p,t.code.current.style.bottom=v,t.code.current.style.textAlign=O}},onSwiped:function(r){var o=c(r),s=Object(f.a)(o,2),l=s[0],u=s[1];if((!(l>0)||e.swipeOptions.right)&&(!(l<0)||e.swipeOptions.left)&&(!(u<0)||e.swipeOptions.up)&&!(0!==u&&u>0))if(t.text.current.style.transition="transform ".concat(i,"ms ease-out, opacity ").concat(i,"ms ease-out"),Math.abs(l)<a&&Math.abs(u)<a)t.text.current.style.transform="translateX(0%) translateY(0%)";else{t.text.current.style.transform="translateX(".concat(l>0?100:l<0?-100:0,"%) translateY(").concat(u>0?100:-100,"%)"),t.box.current.style.transition="opacity ".concat(i,"ms ease-out"),t.box.current.style.opacity=0;n(l>0?"right":"left"),n(null)}}},o)},na=a.a.memo(Xr),ra=function(e){var t,n=e.codingjob,r=Jn(n);if(!n)return null;var a=[8,8];return(null===(t=n.taskSettings)||void 0===t?void 0:t.type)&&("annotate"===n.taskSettings.type&&(a=[6,10]),"questions"===n.taskSettings.type&&(a=[8,6])),Object(W.jsx)("div",{children:Object(W.jsxs)(re.a,{stackable:!0,columns:2,children:[Object(W.jsxs)(re.a.Column,{verticalAlign:"top",stretched:!0,width:a[0],children:[Object(W.jsx)(p.a,{textAlign:"center",style:{background:"#1B1C1D",color:"white"},children:"Settings"}),Object(W.jsx)(mr,{codingjob:n})]}),Object(W.jsx)(re.a.Column,{width:a[1],children:Object(W.jsx)(aa,{codingjob:n,units:r})})]})})},aa=a.a.memo((function(e){var t,n=e.codingjob,a=e.units,i=Object(r.useState)(null),o=Object(f.a)(i,2),c=o[0],s=o[1],l=Object(r.useState)(null),u=Object(f.a)(l,2),d=u[0],j=u[1],b=Object(r.useState)(null),h=Object(f.a)(b,2),p=h[0],v=h[1];if(Object(r.useEffect)((function(){(null===n||void 0===n?void 0:n.taskSettings)&&v(ot(n.taskSettings))}),[n.taskSettings]),Object(r.useEffect)((function(){return a&&null!==c?c>=a.length?null:void Xn(n,[a[c]]).then((function(e){var t=e[0];t.jobServer={postAnnotations:function(e){return console.log(e)}},t.rules={canGoBack:!0,canGoForward:!0},j(t)})):(j(null),null)}),[c,a,j,n]),!a)return null;return(null===n||void 0===n||null===(t=n.taskSettings)||void 0===t?void 0:t.type)?function(e){switch(e){case"questions":return Object(W.jsx)(ia,{codebook:p,standardizedUnit:d,setUnitIndex:s,children:Object(W.jsx)(kr,{n:null===a||void 0===a?void 0:a.length,index:c,setIndex:s})});case"annotate":return Object(W.jsx)(oa,{codebook:p,standardizedUnit:d,setUnitIndex:s,children:Object(W.jsx)(kr,{n:null===a||void 0===a?void 0:a.length,index:c,setIndex:s})});default:return null}}(n.taskSettings.type):null})),ia=a.a.memo((function(e){var t=e.children,n=e.codebook,r=e.standardizedUnit,a=e.setUnitIndex;return n?"questions"===!(null===n||void 0===n?void 0:n.type)?null:Object(W.jsxs)(W.Fragment,{children:[Object(W.jsxs)(p.a,{textAlign:"center",style:{maxWidth:"400px",background:"#1B1C1D",color:"white"},children:["Preview",t]}),Object(W.jsx)("div",{style:{padding:"0",maxWidth:"400px",height:"calc(100vh - 250px)",minHeight:"500px",maxHeight:"800px"},children:Object(W.jsx)("div",{style:{padding:"0em",paddingTop:"1em",height:"100%"},children:Object(W.jsx)(na,{unit:r,codebook:n,setUnitIndex:a,blockEvents:!0})})})]}):null})),oa=function(e){var t=e.children,n=e.codebook,r=e.standardizedUnit,a=e.setUnitIndex,i=Object(ht.c)((function(e){return e.eventsBlocked}));return n?"annotate"!==n.type?null:Object(W.jsxs)(W.Fragment,{children:[Object(W.jsx)(p.a,{textAlign:"center",style:{background:"#1B1C1D",color:"white"},children:"Preview"}),t,Object(W.jsx)("div",{style:{padding:"0",width:"100%",height:"calc(100vh - 250px)",minHeight:"500px"},children:Object(W.jsx)("div",{style:{padding:"0",height:"100%"},children:Object(W.jsx)(Er,{unit:r,codebook:n,setUnitIndex:a,blockEvents:i})})})]}):null},ca=a.a.memo(ra),sa={medium:null,nCoders:1,pctOverlap:10},la=function(e){var t,n=e.codingjob,a=e.deploySettings,i=e.setDeploySettings,o=Object(r.useState)(null),c=Object(f.a)(o,2),s=c[0],l=c[1],u=(null===n||void 0===n||null===(t=n.unitSettings)||void 0===t?void 0:t.totalUnits)||0;Object(r.useEffect)((function(){l(a)}),[a,l]),Object(r.useEffect)((function(){if(s===a)return null;var e=setTimeout((function(){i(s)}),300);return function(){return clearTimeout(e)}}),[s,a,i]);var d=function(e,t){return Object(W.jsx)(ae.a.Field,{children:Object(W.jsx)(Ze.a,{value:e,label:t,checked:a.medium===e,onChange:function(t,n){return i(Object(x.a)(Object(x.a)({},a),{},{medium:e}))}})})};return null===s?null:Object(W.jsxs)(ae.a,{children:[Object(W.jsxs)(ae.a.Group,{children:[Object(W.jsx)(O.a,{name:"setting"}),Object(W.jsx)("label",{children:"Deploy medium"})]}),Object(W.jsxs)(ae.a.Group,{grouped:!0,widths:"equal",children:[d("file","File"),d("amcat","AmCAT")]}),Object(W.jsx)("div",{}),"file"!==a.medium?null:Object(W.jsxs)(W.Fragment,{children:[Object(W.jsx)("br",{}),Object(W.jsxs)(ae.a.Group,{children:[Object(W.jsx)(O.a,{name:"setting"}),Object(W.jsx)("label",{children:"Divide jobs"})]}),Object(W.jsxs)(ae.a.Group,{children:[Object(W.jsxs)(ae.a.Field,{width:5,children:[Object(W.jsx)("label",{children:"Coders"}),Object(W.jsx)($e.a,{size:"mini",type:"number",min:1,value:s.nCoders,onChange:function(e,t){return l((function(e){return Object(x.a)(Object(x.a)({},e),{},{nCoders:t.value})}))}})]}),Object(W.jsxs)(ae.a.Field,{width:7,children:[Object(W.jsx)("label",{children:"Overlap"}),Object(W.jsx)($e.a,{size:"mini",type:"number",step:1,min:0,max:100,label:"%",labelPosition:"right",value:s.pctOverlap,onChange:function(e,t){return l((function(e){return Object(x.a)(Object(x.a)({},e),{},{pctOverlap:t.value})}))}})]}),Object(W.jsx)(ua,{totalUnits:u,settings:s})]})]})]})},ua=function(e){var t=e.totalUnits,n=e.settings;if(!n)return null;var r=Math.round(t*n.pctOverlap/100),a=r+(t-r)/n.nCoders;return Object(W.jsxs)("p",{style:{textAlign:"center",color:"blue"},children:["Avg. units per coder:"," ",Object(W.jsx)("b",{style:{fontSize:"1.3em"},children:Math.round(100*a)/100})]})},da=function(e){var t=e.codingjob,n=(null===t||void 0===t?void 0:t.deploySettings)||sa;return n?Object(W.jsx)("div",{style:{verticalAlign:"top",float:"top",paddingLeft:"1em"},children:Object(W.jsx)(la,{codingjob:t,deploySettings:n,setDeploySettings:function(e){B.setCodingjobProp(t,"deploySettings",e)}})}):null},ja=n(224),ba=n(151),fa=n.n(ba),ha=n(225),pa=n.n(ha),va=[{Header:"Title",accessor:"title",headerClass:"two wide"},{Header:"URL",accessor:"url",headerClass:"four wide"},{Header:"Created",accessor:"created",headerClass:"four wide"}],Oa=function(e){var t=e.jobKey,n=e.setJobKey,a=Object(fe.useLiveQuery)(Object(b.a)(j.a.mark((function e(){var t;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,B.idb.deployedJobs.toArray();case 2:return(t=e.sent).sort((function(e,t){return t.created-e.created})),console.log(t),e.abrupt("return",t.map((function(e){return Object(x.a)(Object(x.a)({},e),{},{created:e.created.toDateString()})})));case 6:case"end":return e.stop()}}),e)}))));return Object(r.useEffect)((function(){!t&&a&&n(a.length>0?Object(x.a)(Object(x.a)({},a[0]),{},{ROW_ID:"0"}):null)}),[t,a,n]),Object(W.jsx)(_e,{columns:va,data:a||[],selectedRow:t,setSelectedRow:n,defaultSize:15})},xa=[{Header:"document_id",accessor:"document_id",headerClass:"three wide"},{Header:"unit_id",accessor:"unit_id",headerClass:"two wide"},{Header:"Coder",accessor:"coder",headerClass:"three wide"},{Header:"Variable",accessor:"variable",headerClass:"three wide"},{Header:"Value",accessor:"value",headerClass:"three wide"}],ga=function(e){var t=e.jobKey,n=Object(r.useState)([]),a=Object(f.a)(n,2),i=a[0],o=a[1],c=Object(ce.a)(["amcat"]),s=Object(f.a)(c,1)[0];return Object(r.useEffect)((function(){if(!t)return null;if(!s.amcat)return null;var e=te(s.amcat.host,s.amcat.email,s.amcat.token);o([]),ma(t,e,o)}),[t,s,o]),Object(W.jsx)(_e,{columns:xa,data:i})},ma=function(){var e=Object(b.a)(j.a.mark((function e(t,n,r){var a,i,o;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,B.idb.deployedJobs.get({url:t.url});case 2:if(a=e.sent,console.log(a),a){e.next=6;break}return e.abrupt("return");case 6:if(n){e.next=8;break}return e.abrupt("return");case 8:return e.prev=8,e.next=11,n.api.get(t.url);case 11:i=e.sent,o=i.data.units.reduce((function(e,t,n){if(t.annotations)for(var r=0,a=Object.keys(t.annotations);r<a.length;r++){var i,o=a[r],c=Object(g.a)(t.annotations[o]);try{for(c.s();!(i=c.n()).done;){var s=i.value;e.push(Object(x.a)(Object(x.a)({document_id:t.document_id,unit_id:n,coder:o},t.meta),s))}}catch(l){c.e(l)}finally{c.f()}}return e}),[]),console.log(o),r(o),e.next=20;break;case 17:e.prev=17,e.t0=e.catch(8),console.log(e.t0);case 20:case"end":return e.stop()}}),e,null,[[8,17]])})));return function(t,n,r){return e.apply(this,arguments)}}(),ka=function(){var e=Object(c.f)(),t=Object(r.useState)(null),n=Object(f.a)(t,2),a=n[0],i=n[1],o=function(){var t=Object(b.a)(j.a.mark((function t(){return j.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.push("/annotator?url="+a.url);case 1:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();return Object(W.jsx)(re.a,{centered:!0,container:!0,children:Object(W.jsxs)(re.a.Row,{children:[Object(W.jsx)(re.a.Column,{width:8,children:Object(W.jsx)(Oa,{jobKey:a,setJobKey:i})}),Object(W.jsxs)(re.a.Column,{width:8,children:[Object(W.jsx)(v.a,{primary:!0,disabled:!a,onClick:o,children:"Open selected codingjob"}),Object(W.jsx)("br",{}),Object(W.jsx)("br",{}),function(){if(null==a)return Object(W.jsx)("div",{style:{height:"6em"}});var e="https://ccs-amsterdam.github.io/CCS_annotator/#/annotator?url="+(null===a||void 0===a?void 0:a.url),t="https://ccs-amsterdam.github.io/CCS_annotator/#/annotator?url="+(null===a||void 0===a?void 0:a.url.replace(":","%colon%"));return Object(W.jsxs)("div",{style:{height:"6em"},children:[Object(W.jsx)(rt.a,{value:e,style:{width:"100%",height:"4em",fontSize:"10px"}}),Object(W.jsx)(tt.a,{hoverable:!0,trigger:Object(W.jsx)(v.a,{children:"Show QR code"}),children:Object(W.jsx)(pa.a,{value:encodeURI(t),size:256})})]})}(),Object(W.jsx)(p.a,{children:"Current annotations"}),Object(W.jsx)(ga,{jobKey:a})]})]})})},ya=function(e){var t=e.codingjobPackage,n=Object(r.useState)(""),a=Object(f.a)(n,2),i=a[0],o=a[1];Object(r.useEffect)((function(){(null===t||void 0===t?void 0:t.title)&&o(t.title)}),[t]);var c=function(){var e=Object(b.a)(j.a.mark((function e(){var n,r,a,i,o;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(n=Ca(t),(r=new fa.a).file("AmCAT_annotator_".concat(t.title,".json"),JSON.stringify(t)),a=0;a<n.length;a++)i="set_".concat(n[a].set,"_units_").concat(n[a].units.length,"_").concat(t.title,".json"),r.file(i,JSON.stringify(n[a]));return e.next=6,r.generateAsync({type:"blob"});case 6:o=e.sent,Object(ja.saveAs)(o,"AmCAT_annotator_".concat(t.title,".zip"));case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(W.jsxs)("div",{children:[Object(W.jsx)(ae.a,{onSubmit:function(){return c()},children:Object(W.jsx)(ae.a.Input,{placeholder:"username",value:i,maxLength:30,onChange:function(e,t){return o(t.value)},autoFocus:!0,style:{width:"100%"}})}),Object(W.jsx)("br",{}),Object(W.jsxs)(v.a,{primary:!0,fluid:!0,loading:null===t,disabled:i.length<5,onClick:c,children:[i.length<5?"please use 5 characters or more":"Download codingjob files"," "]})]})},wa=function(e){var t=e.codingjobPackage,n=Object(r.useState)(""),a=Object(f.a)(n,2),i=a[0],o=a[1],c=Object(ce.a)(["amcat"]),s=Object(f.a)(c,3),l=s[0],u=s[2];Object(r.useEffect)((function(){(null===t||void 0===t?void 0:t.title)&&o(t.title)}),[t]);var d=function(){var e=Object(b.a)(j.a.mark((function e(){var n,r,a;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=te(l.amcat.host,l.amcat.email,l.amcat.token),e.prev=1,e.next=4,n.postCodingjob(t,i);case 4:r=e.sent,a="".concat(n.host,"/codingjob/").concat(r.data.id),B.createDeployedJob(i,a),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(1),console.log(e.t0),u("amcat");case 13:case"end":return e.stop()}}),e,null,[[1,9]])})));return function(){return e.apply(this,arguments)}}();return l.amcat?Object(W.jsxs)("div",{children:[Object(W.jsx)(ae.a,{onSubmit:function(){return d()},children:Object(W.jsx)(ae.a.Input,{placeholder:"username",value:i,maxLength:30,onChange:function(e,t){return o(t.value)},autoFocus:!0,style:{width:"100%"}})}),Object(W.jsx)("br",{}),Object(W.jsx)(v.a,{fluid:!0,primary:!0,disabled:i.length<5,onClick:function(){return d()},children:i.length<5?"please use 5 characters or more":"Upload to AmCAT"})]}):Object(W.jsx)("p",{children:"You need to log in to AmCAT first. (see top-right in the menu)"})},Ca=function(e){for(var t=e.provenance.unitSettings,n=e.provenance.deploySettings,r=e.units,a=Math.round(t.totalUnits*n.pctOverlap/100),i=r.slice(0,a),o=r.slice(a),c=Array(Number(n.nCoders)).fill([]).map((function(e){return Object(_.a)(i)})),s=0;s<o.length;s++)c[s%c.length].push(o[s]);return c.map((function(t,n){return{set:n+1,title:e.title,codebook:e.codebook,units:Fn(t,t.length,!1,42,null)}}))},Sa=function(){var e=Object(b.a)(j.a.mark((function e(t,n,r){var a,i,o=arguments;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=o.length>3&&void 0!==o[3]&&o[3],e.t0=t.name,e.t1={unitSettings:t.unitSettings,deploySettings:t.deploySettings},e.t2=ot(t.taskSettings),e.next=6,Xn(t,n);case 6:if(e.t3=e.sent,e.t4={},e.t5=[],i={title:e.t0,provenance:e.t1,codebook:e.t2,units:e.t3,rules:e.t4,annotations:e.t5},!a){e.next=14;break}return e.next=13,B.idb.documents.where("job_id").equals(t.job_id).toArray();case 13:i.provenance.documents=e.sent;case 14:r(i);case 15:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),_a=function(e){var t,n=e.codingjob,a=Object(r.useState)(null),i=Object(f.a)(a,2),o=i[0],c=i[1],s=Jn(n);Object(r.useEffect)((function(){if(s&&0!==s.length&&(null===n||void 0===n?void 0:n.unitSettings)&&(null===n||void 0===n?void 0:n.taskSettings)&&(null===n||void 0===n?void 0:n.deploySettings)){var e="file"===n.deploySettings.medium;Sa(n,s,c,e)}}),[n,s,c]);return n?Object(W.jsx)("div",{children:Object(W.jsxs)(re.a,{centered:!0,stackable:!0,columns:2,children:[Object(W.jsxs)(re.a.Column,{width:5,children:[Object(W.jsx)(p.a,{textAlign:"center",style:{background:"#1B1C1D",color:"white"},children:"Deploy Codingjob"}),Object(W.jsx)(da,{codingjob:n}),Object(W.jsx)("br",{}),function(e){if(!e)return null;switch(n.deploySettings.medium){case"file":return Object(W.jsx)(ya,{codingjobPackage:o});case"amcat":return Object(W.jsx)(wa,{codingjobPackage:o});default:return null}}(null===n||void 0===n||null===(t=n.deploySettings)||void 0===t?void 0:t.medium)]}),function(){var e;return(null===n||void 0===n||null===(e=n.deploySettings)||void 0===e?void 0:e.medium)?"amcat"!==n.deploySettings.medium?null:Object(W.jsxs)(re.a.Column,{width:11,children:[Object(W.jsx)(p.a,{textAlign:"center",style:{background:"#1B1C1D",color:"white"},children:"Previously deployed jobs"}),Object(W.jsx)(ka,{})]}):null}()]})}):null},Aa=function(){var e,t,n,a,i,o,c,s,l=Object(r.useState)("codingjobs"),u=Object(f.a)(l,2),d=u[0],j=u[1],b=Object(r.useState)(null),h=Object(f.a)(b,2),p=h[0],v=h[1],O=Object(fe.useLiveQuery)((function(){if(p)return B.idb.codingjobs.get(p.job_id).then((function(e){return Object(x.a)(Object(x.a)({},e),{},{ROW_ID:p.ROW_ID})})).catch((function(e){console.log(e)}))}),[p]),g=Object(fe.useLiveQuery)((function(){return(null===O||void 0===O?void 0:O.job_id)?B.idb.documents.where("job_id").equals(O.job_id).count():0}),[O]);return Object(W.jsxs)("div",{style:{margin:"1em"},children:[Object(W.jsxs)(be.a.Group,{ordered:!0,unstackable:!0,size:"tiny",style:{width:"100%",overflow:"auto"},children:[Object(W.jsx)(be.a,{title:"Codingjob",description:O?O.name:"none selected",active:"codingjobs"===d,completed:null!==O&&null!=O,onClick:function(e,t){j("codingjobs")}}),Object(W.jsx)(be.a,{title:"Documents",description:g>0?"".concat(g," documents"):"",active:"documents"===d,completed:g>0,disabled:null===O,onClick:function(e,t){return j("documents")}}),Object(W.jsx)(be.a,{title:"Units",description:(null===O||void 0===O||null===(e=O.unitSettings)||void 0===e?void 0:e.n)?"".concat(null===O||void 0===O||null===(t=O.unitSettings)||void 0===t?void 0:t.n," units"):null,active:"units"===d,completed:null===O||void 0===O||null===(n=O.unitSettings)||void 0===n?void 0:n.n,disabled:0===g,onClick:function(e,t){return j("units")}}),Object(W.jsx)(be.a,{title:"Task",description:(null===O||void 0===O||null===(a=O.taskSettings)||void 0===a?void 0:a.type)||"Define the task",active:"task"===d,completed:null===O||void 0===O||null===(i=O.taskSettings)||void 0===i?void 0:i.type,disabled:!(null===O||void 0===O||null===(o=O.unitSettings)||void 0===o?void 0:o.n),onClick:function(e,t){return j("task")}}),Object(W.jsx)(be.a,{title:"Deploy",description:"Get (others) to work",active:"deploy"===d,disabled:null===O||!(null===O||void 0===O||null===(c=O.unitSettings)||void 0===c?void 0:c.n)||!(null===O||void 0===O||null===(s=O.taskSettings)||void 0===s?void 0:s.type),onClick:function(e,t){return j("deploy")}})]}),Object(W.jsx)(ie.a,{style:{border:"0"},attached:"bottom",children:function(e){switch(e){case"codingjobs":return Object(W.jsx)(De,{codingjob:O,setSelectedCodingjob:v});case"documents":return Object(W.jsx)(Xe,{codingjob:O});case"units":return Object(W.jsx)(rr,{codingjob:O});case"task":return Object(W.jsx)(ca,{codingjob:O});case"deploy":return Object(W.jsx)(_a,{codingjob:O});default:return null}}(d)})]})},Ia=a.a.memo(Aa),Ea=n(161),Ra=function(){var e=Object(b.a)(j.a.mark((function e(t,n){return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),za=function(){var e=Object(b.a)(j.a.mark((function e(t,n){var r,a,i,o,c,s,l,u,d,b,f,h,p;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=[],a=t.codebook.questions.map((function(e,t){return"Q".concat(t+1,"_").concat(e.name.replace(" ","_"))})),i=t.units.reduce((function(e,t){return e[t.unit_id]=t,e}),{}),e.next=5,B.getAllAnnotations(t.id);case 5:o=e.sent,c=Object(g.a)(o);try{for(c.s();!(s=c.n()).done;){l=s.value,u=l.annotations,console.log(u),d=i[l.unit_id],b=Object(x.a)(Object(x.a)({document_id:d.document_id,unit_id:d.unit_id},d.meta),{},{offset:u[0].offset,length:u[0].length,section:u[0].section},u[0].meta),f=Object(g.a)(a);try{for(p=function(){var e=h.value,t=u.find((function(t){return t.variable===e}));b[e]=null==t?null:t.value},f.s();!(h=f.n()).done;)p()}catch(j){f.e(j)}finally{f.f()}r.push(b)}}catch(j){c.e(j)}finally{c.f()}n(r);case 9:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),Ta=function(e){var t=e.localJobServer,n=Object(r.useState)(null),a=Object(f.a)(n,2),i=a[0],o=a[1];return Object(r.useEffect)((function(){switch(t.codebook.type){case"annotate":Ra(t,o);break;case"questions":za(t,o);break;default:return null}}),[t]),console.log(t),Object(W.jsx)(qe.a,{filename:"CSSannotator_".concat(t.title,"_").concat(t.set,"_").concat(t.coderName,".json"),data:i,style:{cursor:"pointer"},children:Object(W.jsx)(v.a,{loading:null===i,primary:!0,content:"Download results",icon:"download",labelPosition:"left",size:"huge"})})},Da=function(e){var t=e.children,n=Object(r.useState)(null),a=Object(f.a)(n,2),i=a[0],o=a[1],c=Object(ht.b)();return Object(r.useEffect)((function(){return c(vt(i)),function(){c(vt(null))}}),[i,c]),Object(W.jsx)("div",{className:"dom-node-provider",ref:o,children:t(i)})},Ua=function(e){var t=e.handle,n=e.children;return Object(W.jsxs)(Ea.a,{handle:t,children:[Object(W.jsx)(Da,{children:function(e){return n}}),";"]})},qa=function(e){var t=e.jobServer;return t?"remote"===t.where?Object(W.jsx)(re.a,{container:!0,centered:!0,verticalAlign:"middle",style:{margin:"0",padding:"0"},children:Object(W.jsx)(re.a.Row,{style:{marginTop:"40vh"},children:Object(W.jsx)("div",{children:Object(W.jsx)(O.a,{name:"flag checkered",size:"huge",style:{transform:"scale(5)"}})})})}):Object(W.jsx)(re.a,{container:!0,centered:!0,verticalAlign:"middle",style:{margin:"0",padding:"0"},children:Object(W.jsxs)(re.a.Row,{style:{marginTop:"40vh"},children:[Object(W.jsx)(re.a.Column,{width:4,children:Object(W.jsx)(O.a,{name:"flag checkered",size:"huge",style:{transform:"scale(1)"}})}),Object(W.jsxs)(re.a.Column,{width:8,children:[Object(W.jsx)(p.a,{children:"You finished the codingjob!"}),Object(W.jsx)("p",{children:"Please download your results and send them to whoever gave you this job. "}),Object(W.jsx)(Ta,{localJobServer:t})]})]})}):null},Na=function(e){var t=e.location,n=e.handle,a=Object(r.useState)(!0),i=Object(f.a)(a,2),o=i[0],c=i[1];return Object(r.useEffect)((function(){c(!0)}),[t,c]),Object(W.jsxs)(h.a,{open:o,children:[Object(W.jsx)(h.a.Header,{children:"Fullscreen mode"}),Object(W.jsxs)(h.a.Content,{children:[Object(W.jsx)("p",{children:"We recommend working in fullscreen, especially on mobile devices. You can always change this with the button in the top-left corner"}),Object(W.jsxs)("div",{style:{display:"flex",height:"30vh"},children:[Object(W.jsx)(v.a,{primary:!0,size:"massive",onClick:function(){n.active||n.enter(),c(!1)},style:{flex:"1 1 auto"},children:"Fullscreen"}),Object(W.jsx)(v.a,{secondary:!0,size:"massive",onClick:function(){n.active&&n.exit(),c(!1)},style:{flex:"1 1 auto"},children:"Windowed"})]})]})]})},Fa=function(e){var t=e.handle;return Object(W.jsx)(O.a.Group,{size:"big",style:{padding:"3px",position:"absolute",top:"0px",left:"2px"},children:Object(W.jsx)(O.a,{link:!0,name:t.active?"compress":"expand",onClick:function(){t.active?t.exit():t.enter()}})})},Ma=function(){var e=Object(c.f)();return Object(W.jsxs)(O.a.Group,{size:"big",style:{padding:"3px",position:"absolute",top:"0px",right:0},children:[Object(W.jsx)(O.a,{link:!0,name:"window close",onClick:function(){return e.goBack()}}),Object(W.jsx)(O.a,{corner:"top right"})]})},La=function(e){var t=e.codebook,n=e.unit,r=e.setUnitIndex;if(!t||!n)return null;return(null===t||void 0===t?void 0:t.type)?function(e){switch(e){case"questions":return Object(W.jsx)(na,{unit:n,codebook:t,setUnitIndex:r});case"annotate":return Object(W.jsx)(Er,{unit:n,codebook:t,setUnitIndex:r});default:return null}}(t.type):null},Pa=function(e){var t,n=e.jobServer,a=Object(Ea.b)(),i=Object(r.useState)(0),o=Object(f.a)(i,2),s=o[0],l=o[1],u=Object(r.useState)(null),d=Object(f.a)(u,2),j=d[0],b=d[1],h=Object(c.g)();Object(r.useEffect)((function(){l(n.progressIndex)}),[n,l]),Object(r.useEffect)((function(){n&&n.getUnit(s).then((function(e){b(Object(x.a)({jobServer:n,unitId:e.id},e.unit))})).catch((function(e){var t;404===(null===(t=e.response)||void 0===t?void 0:t.status)&&(alert("Could not get unit from server"),b(null),console.log(e))}))}),[s,n,l,b]);var p="100%",v="100%";(null===n||void 0===n||null===(t=n.codebook)||void 0===t?void 0:t.type)&&("questions"===(null===n||void 0===n?void 0:n.codebook.type)&&(p="800px",v="1000px"),"annotate"===(null===n||void 0===n?void 0:n.codebook.type)&&(p="2000px",v="2000px"));return Object(W.jsx)(Ua,{handle:a,children:Object(W.jsxs)("div",{style:{maxWidth:p,maxHeight:v,background:"white",margin:"0 auto",padding:"0",height:"100vh",border:"1px solid white"},children:[Object(W.jsx)(Na,{location:h,handle:a}),Object(W.jsxs)("div",{style:{height:"50px",padding:"0",position:"relative"},children:[Object(W.jsx)("div",{style:{width:"85%",paddingLeft:"7.5%"},children:Object(W.jsx)(kr,{n:null===n||void 0===n?void 0:n.rules.n,index:s,setIndex:l,canGoBack:null===n||void 0===n?void 0:n.rules.canGoBack,canGoForward:null===n||void 0===n?void 0:n.rules.canGoForward})}),Object(W.jsxs)("div",{children:[Object(W.jsx)(Fa,{handle:a}),Object(W.jsx)(Ma,{})]})]}),Object(W.jsx)("div",{style:{height:"calc(100% - 50px)",padding:"0"},children:null===s?Object(W.jsx)(qa,{jobServer:n}):Object(W.jsx)(La,{codebook:null===n||void 0===n?void 0:n.codebook,unit:j,setUnitIndex:l})})]})})},Ha=function(){function e(t,n){Object(k.a)(this,e),this.url=t,this.coderName=n,this.where="remote"}return Object(y.a)(e,[{key:"init",value:function(){var e=Object(b.a)(j.a.mark((function e(){var t;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Z.a.get("".concat(this.url,"/codebook"));case 3:t=e.sent,e.next=10;break;case 6:return e.prev=6,e.t0=e.catch(0),this.success=!1,e.abrupt("return");case 10:this.success=!0,this.codebook=t.data,this.rules={n:20,canGoBack:!1,canGoForward:!1},this.progressIndex=0;case 14:case"end":return e.stop()}}),e,this,[[0,6]])})));return function(){return e.apply(this,arguments)}}()},{key:"getUnit",value:function(){var e=Object(b.a)(j.a.mark((function e(t){var n;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Z.a.get("".concat(this.url,"/unit?user=").concat(this.coderName));case 2:return n=e.sent,e.abrupt("return",n.data);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"postAnnotations",value:function(e,t){Z.a.post("".concat(this.url,"/unit/").concat(e,"/annotation?user=").concat(this.coderName),t)}}]),e}(),Ba=function(){function e(t,n){Object(k.a)(this,e),this.id=t,this.coderName=n,this.where="local"}return Object(y.a)(e,[{key:"init",value:function(){var e=Object(b.a)(j.a.mark((function e(){var t;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,B.idb.localJobs.get({id:this.id});case 2:if(t=e.sent){e.next=6;break}return this.success=!1,e.abrupt("return",null);case 6:this.success=!0,this.units=t.units,this.codebook=t.codebook,this.title=t.title,this.set=t.set,this.rules={n:t.units.length,canGoBack:!0,canGoForward:!1},this.progressIndex=t.progressIndex||0;case 13:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getUnit",value:function(){var e=Object(b.a)(j.a.mark((function e(t){var n,r,a;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null===t){e.next=3;break}return e.next=3,B.idb.localJobs.where("id").equals(this.id).modify({progressIndex:Math.max(t,this.progressIndex),last_modified:new Date});case 3:return r=this.units[t].unit_id,e.next=6,B.getUnitAnnotations(this.id,r);case 6:return a=e.sent,a=(null===(n=a)||void 0===n?void 0:n.annotations)||[],e.abrupt("return",{id:r,unit:Object(x.a)(Object(x.a)({},this.units[t]),{},{annotations:a})});case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"postAnnotations",value:function(){var e=Object(b.a)(j.a.mark((function e(t,n){return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:B.postAnnotations(this.id,t,n);case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}]),e}(),Wa=function(){var e=Object(b.a)(j.a.mark((function e(t,n,r){var a;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=new Ba(t,n.name),e.next=3,a.init();case 3:r(a);case 4:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),Ga=function(){var e=Object(b.a)(j.a.mark((function e(t,n,r){var a;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=new Ha(t,n.name),e.next=3,a.init();case 3:r(a);case 4:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),Va=function(e){return e.search.substring(1).split("&").reduce((function(e,t){var n=t.split("="),r=Object(f.a)(n,2),a=r[0],i=r[1];return e[decodeURIComponent(a)]=decodeURIComponent(i),e}),{})},Ja=[{Header:"Title",accessor:"title",headerClass:"two wide"},{Header:"Set",accessor:"set",headerClass:"two wide"},{Header:"progress",accessor:"progress",headerClass:"two wide"},{Header:"Last modified",accessor:"last_modified_str",headerClass:"four wide"}],Ya=function(e){var t=e.jobKey,n=e.setJobKey,a=Object(fe.useLiveQuery)(Object(b.a)(j.a.mark((function e(){var t;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[],e.next=3,B.idb.localJobs.each((function(e){t.push({id:e.id,last_modified:e.last_modified,last_modified_str:e.last_modified.toString().slice(0,24),set:e.set,progress:"".concat(e.progressIndex||0," / ").concat(e.units.length),title:e.title})}));case 3:return t.sort((function(e,t){return t.last_modified-e.last_modified})),e.abrupt("return",t);case 5:case"end":return e.stop()}}),e)}))));return Object(r.useEffect)((function(){!t&&a&&n(a.length>0?Object(x.a)(Object(x.a)({},a[0]),{},{ROW_ID:"0"}):null)}),[t,a,n]),Object(W.jsx)(_e,{columns:Ja,data:a||[],selectedRow:t,setSelectedRow:n,defaultSize:15})},Ka=function(e){var t=e.split(".");return t[t.length-1]},Qa=function(){var e=Object(c.f)(),t=Object(r.useState)(null),n=Object(f.a)(t,2),a=n[0],i=n[1],o=function(){var e=Object(b.a)(j.a.mark((function e(t){var n,r,a,i,o;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=new FileReader,r=t.target.files[0],"json"===(a=Ka(r.name))&&(n.readAsText(r,"UTF-8"),n.onload=function(e){var t=S()(e.target.result);B.createLocalJob(JSON.parse(e.target.result),t)}),"zip"!==a){e.next=10;break}return i=new fa.a,e.next=8,i.loadAsync(r);case 8:(o=e.sent).forEach(function(){var e=Object(b.a)(j.a.mark((function e(t,n){var r,a;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("set"===n.name.slice(0,3)){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,o.file(n.name).async("text");case 4:r=e.sent,a=S()(r),B.createLocalJob(JSON.parse(r),a);case 7:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}());case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),s=function(){var t=Object(b.a)(j.a.mark((function t(){return j.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.push("/annotator?id="+a.id);case 1:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();return Object(W.jsxs)(re.a,{centered:!0,stackable:!0,container:!0,style:{marginTop:"5em"},children:[Object(W.jsxs)(re.a.Column,{style:{textAlign:"center"},width:8,children:[Object(W.jsx)(p.a,{textAlign:"center",style:{background:"#1B1C1D",color:"white"},children:"Read codingjob"}),Object(W.jsx)("input",{type:"file",accept:".json,.zip",onChange:o}),Object(W.jsx)("div",{children:Object(W.jsx)("br",{})})]}),Object(W.jsxs)(re.a.Column,{width:8,children:[Object(W.jsx)(p.a,{textAlign:"center",style:{background:"#1B1C1D",color:"white"},children:"Your codingjobs"}),Object(W.jsx)(v.a,{fluid:!0,primary:!0,disabled:!a,onClick:s,children:"Open selected codingjob"}),Object(W.jsx)("br",{}),Object(W.jsx)("br",{}),Object(W.jsx)(Ya,{jobKey:a,setJobKey:i})]})]})},Xa=[{label:"Annotator",path:"/annotator",Component:function(){var e=Object(c.g)(),t=Object(r.useState)(null),n=Object(f.a)(t,2),a=n[0],i=n[1],o=Object(ce.a)(["name"]),s=Object(f.a)(o,1)[0];return Object(r.useEffect)((function(){if(e.search){var t=Va(e);(null===t||void 0===t?void 0:t.url)&&(t.url=t.url.replace("%colon%",":").replace("%25colon%25",":"),Ga(t.url,s,i)),(null===t||void 0===t?void 0:t.id)&&Wa(t.id,s,i)}else i(null)}),[e,s,i]),a?Object(W.jsx)(Pa,{jobServer:a}):null},menu:!1},{label:"Jobs",path:"/jobs",Component:Qa,menu:!0},{label:"Codingjob manager",path:"/manager",Component:Ia,menu:!0}],Za=function(){return Object(W.jsx)(s.a,{basename:"/",children:Object(W.jsx)(je,{items:Xa,children:Object(W.jsxs)(c.c,{children:[Object(W.jsx)(c.a,{exact:!0,path:"/",render:function(){return Object(W.jsx)(Ia,{})}}),(e=Xa,e.map((function(e){return Object(W.jsx)(c.a,{exact:!0,path:e.path,render:function(){return Object(W.jsx)(e.Component,{})}})})))]})})});var e},$a=n(156),ei=Object($a.a)({eventsBlocked:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1?arguments[1]:void 0;return"BLOCK_EVENTS"===t.type?t.block:e},fullScreenNode:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0;return"SET_FULL_SCREEN_NODE"===t.type?t.node:e}}),ti=ei,ni=n(327),ri=Object($a.b)(ti);o.a.render(Object(W.jsx)(a.a.StrictMode,{children:Object(W.jsx)(ni.a,{children:Object(W.jsx)(ht.a,{store:ri,children:Object(W.jsx)(Za,{})})})}),document.querySelector("#root"))}},[[302,1,2]]]);
//# sourceMappingURL=main.3b6663f0.chunk.js.map