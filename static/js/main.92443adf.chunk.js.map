{"version":3,"sources":["../node_modules/react-semantic-ui-datepickers/dist/locales sync /^/.//.*/.json$","components/Download.js","actions/index.js","components/Reset.js","apis/storemanager.js","components/Persist.js","components/HeaderMenu.js","apis/dexie.js","apis/demodata.js","components/Welcome.js","components/AuthRoute.js","components/SelectionTable.js","components/CreateCodingjob.js","components/DeleteCodingjob.js","components/CodingjobSelector.js","components/DocumentTable.js","components/JobDetails.js","components/UploadDocuments.js","components/CreateDocument.js","components/Create.js","components/ManageAnnotations.js","components/CodeSelector.js","components/Token.js","components/Tokens.js","components/AnnotationText.js","components/Annotate.js","App.js","reducers/index.js","index.js"],"names":["map","webpackContext","req","id","webpackContextResolve","__webpack_require__","o","e","Error","code","keys","Object","resolve","module","exports","progressCallback","totalRows","completedRows","console","log","Download","useState","open","setOpen","db","useSelector","state","onDownload","a","exportDB","idb","filter","table","value","key","prettyJson","blob","fileDownload","error","Modal","closeIcon","trigger","Menu","Item","icon","name","style","color","onClose","onOpen","Header","content","Content","Actions","Button","primary","onClick","setDB","type","payload","selectCodingjob","codingjob","setCodingjobs","codingjobs","setDocuments","document","toggleAnnotations","spanAnnotation","Reset","homepage","dispatch","useDispatch","history","useHistory","Icon","deleteDB","then","push","catch","initStoragePersistence","tryPersistWithoutPromtingUser","persist","navigator","storage","undefined","isStoragePersisted","persisted","permissions","query","permission","Persist","setPersisted","useEffect","alert","withRouter","items","host","location","useLocation","menuItems","item","index","as","Link","to","path","header","disabled","active","pathname","label","fixed","inverted","position","AnnotationDB","this","Dexie","version","stores","apis","documents","api","token","put","refresh_token","expiration_date","delete","get","job_id","hash","Date","now","toString","add","listDocuments","deleteDocuments","toArray","documentList","silent","Set","where","equals","primaryKeys","ids","duplicates","preparedDocuments","reduce","result","doc_id","has","annotations","length","JSON","parse","message","bulkAdd","documentIds","bulkDelete","field","modify","demo_articles","title","text","create_demo_job","createCodingjob","job","createDocuments","Welcome","loggin","addDemo","exists","Grid","textAlign","height","verticalAlign","Column","maxWidth","Segment","border","AuthRoute","Component","componentProps","loading","setLoading","hasdb","setHasdb","connect","render","props","GlobalFilter","preGlobalFilteredRows","globalFilter","setGlobalFilter","count","onChange","target","placeholder","SelectionTable","columns","data","selectedRow","setSelectedRow","width","defaultSize","sizeSelector","ROW_ID","activeRow","setActiveRow","useTable","initialState","pageSize","useGlobalFilter","useSortBy","usePagination","getTableProps","getTableBodyProps","headerGroups","prepareRow","page","pageCount","gotoPage","setPageSize","pageIndex","createHeader","headerGroup","headers","column","TableHeaderCell","className","headerClass","getHeaderProps","getSortByToggleProps","isSorted","isSortedDesc","Table","unstackable","striped","singleLine","selectable","TableHeader","TableRow","getHeaderGroupProps","TableBody","row","i","onRowSelect","getRowProps","cells","cell","TableCell","getCellProps","createBody","Dropdown","options","n","d","marginTop","display","justifyContent","Pagination","size","firstItem","lastItem","nextItem","prevItem","boundaryRange","ellipsisItem","activePage","totalPages","onPageChange","event","CreateCodingjob","status","setStatus","codingjobName","setCodingjobName","Form","onSubmit","preventDefault","trim","res","listCodingjobs","Group","Input","required","Dimmer","Loader","DeleteCodingjob","deleteCodingjob","CodingjobSelector","indices","selectedCodingjob","setSelectedCodingjob","cjs","widths","Container","overflow","accessor","inline","search","findIndex","onDropdownSelect","documentTableColumns","DocumentTable","selectDocument","JobDetails","SubmitForm","fileRef","setOptions","titleField","setTitleField","textField","setTextField","annotationsField","setAnnotationsField","colname","includes","csvToJson","slice","datarow","obj","meta","stringify","uploadData","preparedData","current","removeFile","Field","control","Select","clearable","fluid","PreviewTable","createRowCells","Cell","basic","Row","HeaderCell","Body","createRows","align","UploadDocuments","setActive","setData","useRef","stackable","floated","ref","onFileLoad","addRemoveButton","onRemoveFile","DocumentForms","fields","fieldValues","setFieldValues","newFieldValues","TextArea","CreateDocument","onCreate","submitData","test","toISOString","Create","activeItem","setActiveItem","pointing","secondary","renderSwitch","exportAnnotations","doc","unique","uniqueAnnotations","values","un_ann","ann","ann_obj","offset","json","writeValue","matchAnnotations","tokens","importedAnnotations","trackAnnotations","matchedAnnotations","findMatches","addAnnotations","start","end","group","span","newAnnotations","newAnnotation","ManageAnnotations","spanAnnotations","ready","setReady","CodeSelector","children","codes","codeHistory","textInputRef","setCurrent","userAccess","annotation","toggleListener","on","window","addEventListener","onKeydown","removeEventListener","click","getColor","tokenCode","codematch","find","updateAnnotations","oldAnnotation","appendCodeHistory","ddOptions","useValue","Popup","flowing","hoverable","wide","Step","vertical","Title","Description","backgroundColor","getCurrentOptions","compact","Ref","innerRef","selection","allowAdditions","additionPosition","onAddItem","setCodes","randomColor","seed","luminosity","selectOnNavigation","minCharacters","autoComplete","searchInput","autoFocus","Token","tokenindex","tokenoffset","tokenlength","AnnotatedToken","pre","post","tokenCodes","colors","join","allLeft","some","allRight","tokenClass","background","React","memo","nlp","extend","paragraphs","Tokens","setTokens","tokenComponents","setTokenComponents","prepareTokens","tokenize","par","par_i","createParagraph","mapSentences","sentences","sent","sent2","createSentence","terms","mapTokens","getTokenAttributes","tokenNode","parseInt","getAttribute","getToken","parentNode","AnnotationText","onMouseUp","onKeyDown","which","getSelection","anchorNode","focusNode","from","parentElement","empty","defaultValue","ctrlKey","getDocuments","setDoc","setDocumentList","prepareAnnotations","getDocument","dropdownOptions","Breadcrumb","BreadcrumbSection","link","Divider","documentSelector","App","exact","annList","rm","testCodes","rootReducer","combineReducers","action","dropbox","tokenIndices","selectedToken","newstate","v","unshift","store","createStore","ReactDOM","StrictMode","querySelector"],"mappings":"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","file":"static/js/main.92443adf.chunk.js","sourcesContent":["var map = {\n\t\"./bg-BG.json\": 287,\n\t\"./ca-ES.json\": 288,\n\t\"./cs-CZ.json\": 289,\n\t\"./de-DE.json\": 290,\n\t\"./en-US.json\": 197,\n\t\"./es-ES.json\": 291,\n\t\"./et-EE.json\": 292,\n\t\"./fi-FI.json\": 293,\n\t\"./fr-FR.json\": 294,\n\t\"./he-IL.json\": 295,\n\t\"./it-IT.json\": 296,\n\t\"./ja-JP.json\": 297,\n\t\"./ko-KR.json\": 298,\n\t\"./nb-NO.json\": 299,\n\t\"./nn-NO.json\": 300,\n\t\"./pl-PL.json\": 301,\n\t\"./pt-BR.json\": 302,\n\t\"./ru-RU.json\": 303,\n\t\"./sv-SE.json\": 304,\n\t\"./tr-TR.json\": 305,\n\t\"./zh-CN.json\": 306\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 286;","import React, { useState } from \"react\";\nimport { useSelector } from \"react-redux\";\n\nimport { Modal, Menu, Header, Button } from \"semantic-ui-react\";\nimport { exportDB } from \"dexie-export-import\";\nimport fileDownload from \"js-file-download\";\n\nconst Download = () => {\n  const [open, setOpen] = useState(false);\n  const db = useSelector((state) => state.db);\n\n  const onDownload = async () => {\n    try {\n      console.log(db);\n      const blob = await exportDB(db.idb, {\n        filter: (table, value, key) =>\n          table === \"codingjobs\" || table === \"documents\",\n        prettyJson: true,\n        progressCallback,\n      });\n      fileDownload(blob, \"AmCAT_Annotator.json\");\n    } catch (error) {\n      console.error(\"\" + error);\n    }\n  };\n\n  return (\n    <Modal\n      closeIcon\n      open={open}\n      trigger={\n        <Menu.Item\n          icon=\"download\"\n          name=\"Download\"\n          style={{ color: \"lightgreen\" }}\n        />\n      }\n      onClose={() => setOpen(false)}\n      onOpen={() => setOpen(true)}\n    >\n      <Header icon=\"dropbox\" content=\"Download everything\" />\n      <Modal.Content>\n        <p>Download all data as a single JSON dump</p>\n      </Modal.Content>\n      <Modal.Actions>\n        <Button primary onClick={onDownload}>\n          Download\n        </Button>\n      </Modal.Actions>\n    </Modal>\n  );\n};\n\nfunction progressCallback({ totalRows, completedRows }) {\n  console.log(`Progress: ${completedRows} of ${totalRows} rows completed`);\n}\n\nexport default Download;\n","export const setDB = (db) => {\n  return {\n    type: \"SET_DB\",\n    payload: db,\n  };\n};\n\nexport const resetDB = () => {\n  return {\n    type: \"RESET_DB\",\n  };\n};\n\nexport const setDropbox = (dropbox) => {\n  return {\n    type: \"SET_DROPBOX\",\n    payload: dropbox,\n  };\n};\n\nexport const selectCodingjob = (codingjob) => {\n  return {\n    type: \"SELECT_CODINGJOB\",\n    payload: codingjob,\n  };\n};\n\nexport const setCodingjobs = (codingjobs) => {\n  return {\n    type: \"SET_CODINGJOBS\",\n    payload: codingjobs,\n  };\n};\n\nexport const selectDocument = (document) => {\n  return {\n    type: \"SELECT_ARTICLE\",\n    payload: document,\n  };\n};\n\nexport const setDocuments = (document) => {\n  return {\n    type: \"SET_DOCUMENTS\",\n    payload: document,\n  };\n};\n\nexport const setTokenIndices = (tokenIndices) => {\n  return {\n    type: \"SET_TOKEN_INDICES\",\n    payload: tokenIndices,\n  };\n};\n\nexport const setSelectedToken = (selectedToken) => {\n  return {\n    type: \"SET_SELECTED_TOKEN\",\n    payload: selectedToken,\n  };\n};\n\nexport const toggleAnnotations = (spanAnnotation) => {\n  return {\n    type: \"TOGGLE_ANNOTATIONS\",\n    payload: spanAnnotation,\n  };\n};\n\nexport const rmAnnotations = (spanAnnotation) => {\n  return {\n    type: \"RM_ANNOTATIONS\",\n    payload: spanAnnotation,\n  };\n};\n\nexport const clearSpanAnnotations = () => {\n  return {\n    type: \"CLEAR_SPAN_ANNOTATIONS\",\n  };\n};\n\nexport const setCodes = (codes) => {\n  return {\n    type: \"SET_CODES\",\n    payload: codes,\n  };\n};\n\nexport const appendCodeHistory = (code, n = 5) => {\n  return {\n    type: \"APPEND_CODE_HISTORY\",\n    payload: { code: code, n: n },\n  };\n};\n","import React, { useState } from \"react\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport { resetDB } from \"../actions\";\nimport { Menu, Button, Header, Icon, Modal } from \"semantic-ui-react\";\nimport { useHistory } from \"react-router-dom\";\n\nconst Reset = ({ homepage }) => {\n  const db = useSelector((state) => state.db);\n  const dispatch = useDispatch();\n  const [open, setOpen] = useState(false);\n  const history = useHistory();\n\n  if (!db) return null;\n\n  return (\n    <Modal\n      closeIcon\n      open={open}\n      trigger={\n        <Menu.Item icon=\"rocket\" name=\"Reset\" style={{ color: \"#d7a3a3\" }} />\n      }\n      onClose={() => setOpen(false)}\n      onOpen={() => setOpen(true)}\n    >\n      <Header icon=\"power off\" content=\"Reset Annotator Database\" />\n      <Modal.Content>\n        <p>\n          This will remove all document and annotation data from your browser.\n          Any annotations that have not been saved/synchronized will be lost.\n          Are you absolutely sure?\n        </p>\n      </Modal.Content>\n      <Modal.Actions>\n        <Button\n          color=\"red\"\n          onClick={() => {\n            setOpen(false);\n          }}\n        >\n          <Icon name=\"remove\" /> No\n        </Button>\n        <Button\n          color=\"green\"\n          onClick={() => {\n            console.log(db);\n            db.deleteDB()\n              .then(() => {\n                dispatch(resetDB());\n                setOpen(false);\n                history.push(homepage);\n              })\n              .catch((e) => {\n                console.log(e);\n              });\n          }}\n        >\n          <Icon name=\"checkmark\" /> Yes\n        </Button>\n      </Modal.Actions>\n    </Modal>\n  );\n};\n\nexport default Reset;\n","// this contains functions for setting indexedDB to persistent\n// taken from: https://dexie.org/docs/StorageManager\n\n/** Check if storage is persisted already.\n  @returns {Promise<boolean>} Promise resolved with true if current origin is\n  using persistent storage, false if not, and undefined if the API is not\n  present.\n*/\n\nexport async function initStoragePersistence() {\n  const persist = await tryPersistWithoutPromtingUser();\n  switch (persist) {\n    case \"never\":\n      console.log(\"Not possible to persist storage\");\n      break;\n    case \"persisted\":\n      console.log(\"Successfully persisted storage silently\");\n      break;\n    case \"prompt\":\n      console.log(\"Not persisted, but we may prompt user when we want to.\");\n      break;\n    default:\n      console.log(\"compiler desperately wanted a default\");\n  }\n}\n\n/** Tries to convert to persisted storage.\n  @returns {Promise<boolean>} Promise resolved with true if successfully\n  persisted the storage, false if not, and undefined if the API is not present.\n*/\nexport async function persist() {\n  return (await navigator.storage) && navigator.storage.persist\n    ? navigator.storage.persist()\n    : undefined;\n}\n\nexport async function isStoragePersisted() {\n  return (await navigator.storage) && navigator.storage.persisted\n    ? navigator.storage.persisted()\n    : undefined;\n}\n\n/** Queries available disk quota.\n  @see https://developer.mozilla.org/en-US/docs/Web/API/StorageEstimate\n  @returns {Promise<{quota: number, usage: number}>} Promise resolved with\n  {quota: number, usage: number} or undefined.\n*/\n// async function showEstimatedQuota() {\n//   return (await navigator.storage) && navigator.storage.estimate\n//     ? navigator.storage.estimate()\n//     : undefined;\n// }\n\n/** Tries to persist storage without ever prompting user.\n  @returns {Promise<string>}\n    \"never\" In case persisting is not ever possible. Caller don't bother\n      asking user for permission.\n    \"prompt\" In case persisting would be possible if prompting user first.\n    \"persisted\" In case this call successfully silently persisted the storage,\n      or if it was already persisted.\n*/\nasync function tryPersistWithoutPromtingUser() {\n  if (!navigator.storage || !navigator.storage.persisted) {\n    return \"never\";\n  }\n  let persisted = await navigator.storage.persisted();\n  if (persisted) {\n    return \"persisted\";\n  }\n  if (!navigator.permissions || !navigator.permissions.query) {\n    return \"prompt\"; // It MAY be successful to prompt. Don't know.\n  }\n  const permission = await navigator.permissions.query({\n    name: \"persistent-storage\",\n  });\n  if (permission.state === \"granted\") {\n    persisted = await navigator.storage.persist();\n    if (persisted) {\n      return \"persisted\";\n    } else {\n      throw new Error(\"Failed to persist\");\n    }\n  }\n  if (permission.state === \"prompt\") {\n    return \"prompt\";\n  }\n  return \"never\";\n}\n","import React, { useEffect, useState } from \"react\";\nimport { Menu, Button, Header, Icon, Modal } from \"semantic-ui-react\";\nimport { persist, isStoragePersisted } from \"../apis/storemanager\";\n\nconst Persist = () => {\n  const [open, setOpen] = useState(false);\n  const [persisted, setPersisted] = useState(false);\n\n  useEffect(() => {\n    if (!persisted) {\n      isStoragePersisted().then(setPersisted);\n    }\n  }, [persisted]);\n\n  const onClick = async () => {\n    await persist();\n    const ispersisted = await isStoragePersisted();\n    if (ispersisted) {\n      setPersisted(true);\n      alert(\"indexedDB set to persistent for AmCAT Annotator\");\n    } else {\n      alert(\"Failed to set indexedDB to persistent\");\n    }\n  };\n\n  if (persisted) return null;\n\n  return (\n    <Modal\n      closeIcon\n      open={open}\n      trigger={\n        <Menu.Item\n          icon=\"database\"\n          name=\"Enable persitance\"\n          style={{ color: \"#d7a3a3\" }}\n        />\n      }\n      onClose={() => setOpen(false)}\n      onOpen={() => setOpen(true)}\n    >\n      <Header icon=\"database\" content=\"Set database persistence\" />\n      <Modal.Content>\n        <p>\n          We did not have permission to automatically make the data storage for\n          this website persistent. This means that the data could be removed\n          automatically by your browser if it needs to free up space for another\n          website. You can try to set this manually here, but not all browsers\n          support this (yet).\n        </p>\n        <p>\n          If the database is not persistent the app can still be used, but you\n          need to be more carefull in making sure that data is regularly backed\n          up, either by manually downloading data or syncing with Dropbox\n        </p>\n      </Modal.Content>\n      <Modal.Actions>\n        <Button onClick={onClick}>\n          <Icon name=\"checkmark\" /> Yes\n        </Button>\n      </Modal.Actions>\n    </Modal>\n  );\n};\n\nexport default Persist;\n","import React from \"react\";\nimport { useSelector } from \"react-redux\";\nimport { Menu } from \"semantic-ui-react\";\nimport { Link, withRouter, useLocation } from \"react-router-dom\";\n//import Dropbox from \"./Dropbox\";\nimport Download from \"./Download\";\nimport Reset from \"./Reset\";\nimport Persist from \"./Persist\";\n\nconst HeaderMenu = ({ items, host, homepage }) => {\n  const db = useSelector((state) => state.db);\n  const location = useLocation();\n\n  const menuItems = items.map((item, index) => {\n    return (\n      <Menu.Item\n        key={\"item-\" + index}\n        index={index}\n        as={Link}\n        to={item.path}\n        header={index === 0}\n        disabled={!db}\n        active={item.path === location.pathname}\n      >\n        {item.label}\n      </Menu.Item>\n    );\n  });\n\n  return (\n    <Menu fixed=\"top\" inverted>\n      {menuItems}\n      <Menu.Menu position=\"right\">\n        <Download />\n        <Persist />\n        <Reset homepage={homepage} />\n      </Menu.Menu>\n    </Menu>\n  );\n};\n\nexport default withRouter(HeaderMenu);\n","import Dexie from \"dexie\";\nimport hash from \"object-hash\";\n\nexport default class AnnotationDB {\n  constructor() {\n    this.idb = new Dexie(\"AmCAT_Annotator\");\n    // this.idb.delete();   // for testing: starts with clean db\n    this.idb.version(1).stores({\n      apis: \"api\", // unindexed fields: token, refresh_token, expiration_date,\n      codingjobs: \"job_id, name\", // unindexed fields: jobcreator, codingscheme, codebook, codebookEdit, returnAddress\n      documents: \"doc_id, job_id\", // unindexed fields: title, text, meta, tokens, annotations\n    });\n  }\n\n  // API TOKENS\n  addToken(api, token) {\n    return this.idb.apis.put({\n      api,\n      token: token.token,\n      refresh_token: token.refresh_token,\n      expiration_date: token.expiration_date,\n    });\n  }\n  deleteToken(api) {\n    return this.idb.apis.delete(api);\n  }\n  getToken(api) {\n    return this.idb.apis.get(api);\n  }\n\n  // CODINGJOBS\n  async createCodingjob(name) {\n    const job_id = hash([name, Date.now().toString()]);\n    this.idb.codingjobs.add({\n      job_id,\n      name,\n    });\n    return { job_id, name };\n  }\n  async deleteCodingjob(codingjob) {\n    const documents = await this.listDocuments(codingjob);\n    await this.deleteDocuments(documents);\n    return this.idb.codingjobs.delete(codingjob.job_id);\n  }\n  listCodingjobs() {\n    return this.idb.codingjobs.toArray();\n  }\n  getCodingjob(codingjob) {\n    return this.idb.codingjobs.get(codingjob.job_id);\n  }\n\n  // DOCUMENTS\n  async createDocuments(codingjob, documentList, silent = false) {\n    let ids = new Set(\n      await this.idb.documents\n        .where(\"job_id\")\n        .equals(codingjob.job_id)\n        .primaryKeys()\n    );\n\n    let duplicates = 0;\n    const preparedDocuments = documentList.reduce((result, document) => {\n      const doc_id = hash([document, codingjob]); // codingjob included for doc_id hash\n      if (!ids.has(doc_id)) {\n        ids.add(doc_id);\n        if (document.annotations && document.annotations.length > 0) {\n          console.log(document.annotations);\n          try {\n            JSON.parse(document.annotations);\n          } catch (e) {\n            alert(\"Annotations field contains invalid JSON\");\n            throw new Error(\"JSON parse error\");\n          }\n        }\n        result.push({\n          doc_id: doc_id,\n          job_id: codingjob.job_id,\n          ...document,\n        });\n      } else {\n        duplicates++;\n      }\n      return result;\n    }, []);\n\n    if (!silent) {\n      let message = `Created ${\n        documentList.length - duplicates\n      } new documents in codingjob ${codingjob.name}.`;\n      if (duplicates > 0)\n        message = message + ` Ignored ${duplicates} duplicates`;\n      alert(message);\n    }\n\n    return this.idb.documents.bulkAdd(preparedDocuments);\n  }\n  deleteDocuments(documents) {\n    const documentIds = documents.map((document) => document.doc_id);\n    return this.idb.documents.bulkDelete(documentIds);\n  }\n  listDocuments(codingjob) {\n    return this.idb.documents\n      .where(\"job_id\")\n      .equals(codingjob.job_id)\n      .toArray();\n  }\n  getDocument(doc_id) {\n    return this.idb.documents.get(doc_id);\n  }\n\n  writeValue(document, field, value) {\n    return this.idb.documents\n      .where(\"doc_id\")\n      .equals(document.doc_id)\n      .modify({ [field]: value });\n  }\n\n  // CLEANUP\n  deleteDB() {\n    return this.idb.delete();\n  }\n}\n","const demo_articles = [\n  {\n    title: `GL en PvdA hebben goed gesprek met informateur, maar wantrouwen Rutte`,\n    text: `PvdA-leider Lilianne Ploumen en GroenLinks-leider Jesse Klaver hadden vrijdag een goed gesprek met informateur Herman Tjeenk Willink, zeiden ze zelf. De twee benadrukten dat, hoewel er inhoudelijke stappen zijn gezet, hun vertrouwen in VVD-leider Mark Rutte nog niet is hersteld.\n\n    Informateur Willink zette zich vrijdag aan zijn taak. Eerste punt op de agenda zijn gesprekken met de lijsttrekkers van de acht grootste partijen.\n    \n    Een week nadat een groot deel van de partijleiders bekendmaakte niet meer met Rutte verder te willen onderhandelen over een nieuwe coalitie, wordt gekeken waarover partijen het inhoudelijk eens zijn.\n    \n    \"Het was een prettig gesprek langs de lijnen van de inhoud\", zei PvdA-leider Lilianne Ploumen na afloop. Ze heeft haar zorgen over de ongelijkheid in Nederland en over de zorg gedeeld.\n    \n    Ook Jesse Klaver (GroenLinks), die een uur eerder op gesprek kwam bij de informateur, benadrukte dat het ging over de problemen die opgelost moeten worden.\n    \n    Situatie niet veranderd in een week\n\nWat betreft de positie ten opzichte van Rutte is echter niets veranderd. Vorige week ondertekenden Ploumen en Klaver net als alle andere oppositiepartijen een motie van wantrouwen, vanwege Ruttes betrokkenheid bij de notitie over CDA-Kamerlid Pieter Omtzigt.\n\n\"Als het aan ons ligt, was Rutte geen premier meer\", zei Ploumen. Hoe Tjeenk Willink dat gedeukte vertrouwen kan herstellen, weet ze niet. \"We wachten de voorstellen van de informateur af.\"\n\n\"De vertrouwensbreuk is niet hersteld na één gesprek met de fractievoorzitters\", zei ook Klaver. \"Mijn mening over Rutte is niet veranderd.\"\n\nSP'er Lilian Marijnissen sprak zich al eerder expliciet uit tegen samenwerking met Rutte.\n\nDe partijleiders hekelen het gebrek aan openheid en transparantie waar Rutte in hun ogen voor staat. \"Als je een fout maakt, dan moet je dat toegeven en er niet over liegen\", zei Klaver. Ploumen: \"Het probleem is dat Mark Rutte heeft gelogen. Wij hebben het vertrouwen in hem opgezegd.\"\n\nWat de vervolgstappen moeten zijn, laten ze volledig over aan Tjeenk Willink. \"Ik ga geen lijstjes maken met wat er moet gebeuren\", zei Ploumen.\n\nDe informateur ontvangt later op vrijdag nog de partijleiders Wopke Hoekstra (CDA) en Sigrid Kaag (D66), en Rutte zelf.\n\nTjeenk Willink denkt niet dat Rutte zomaar door kan\n\nTjeenk Willink suggereerde woensdag op een persconferentie dat hij Rutte niet per se een sta-in-de-weg voor een verandering van de bestuursstijl in Den Haag vindt. Toen daarover vervolgens berichten in de media verschenen, voelde de informateur zich vrijdag genoodzaakt die boodschap bij te sturen.\n\nDe conclusie dat Rutte geen belemmering vormt voor de formatie, kan hij niet voor zijn rekening nemen, luidt een schriftelijke verklaring.\n\nTjeenk Willink heeft namelijk ook de opdracht om te onderzoeken \"of en zo ja onder welke voorwaarden er voldoende vertrouwen tussen partijen bestaat of weer kan ontstaan\".`,\n  },\n  {\n    title: `CU-leider Segers vindt dat uitspraak over Rutte te veel op de man was gespeeld`,\n    text: `Partijleider Gert-Jan Segers van de ChristenUnie (CU) vindt dat hij te veel op de man heeft gespeeld door coalitiedeelname uit te sluiten als VVD-leider Mark Rutte opnieuw premier zou worden. Terugblikkend zegt hij dat het niet om één persoon moet gaan, maar om \"een ongezonde politieke cultuur en een genadeloze overheid\". Daar moet volgens hem verandering in komen, zo zei hij zaterdag tijdens een congres van de partij.\n\n    \n    Segers deed zijn uitspraak over Rutte na het debat over de notitie \"functie elders\" voor CDA-Kamerlid Pieter Omtzigt. Binnen de CU is verdeeldheid ontstaan over het besluit van de fractie, erkent Segers.\n    \n    Naast steun is er ook kritiek van veel leden, die zeggen dat hij \"te veel op de man heeft gespeeld en te weinig de bal\". \"Te veel Rutte, te weinig ons allemaal. En als dat de perceptie van veel mensen is, dan moet ik me dat aantrekken\", aldus Segers tijdens het congres.\n    \n    \n    Volgens de CU-leider staat \"de politieke cultuur in Den Haag natuurlijk niet los van Mark Rutte, zeker niet\".\n    \n    \"Maar die oude cultuur staat of valt niet met één man. Ook wijzelf maken er deel van uit. Ik wil niet genadeloos zijn voor personen, maar ik wil wel hard en helder zijn over een cultuur die niet deugt en een genadeloze overheid. Daar moet écht een omslag in komen\", zei Segers.\n    \n    \n    De ChristenUnie heeft vijf zetels in de Tweede Kamer. Op het congres werden vier oude Kamerleden uitgezwaaid en trad Ankie van Tatenhove aan als nieuwe partijvoorzitter.`,\n  },\n];\n\nexport default demo_articles;\n","import React from \"react\";\nimport { useDispatch } from \"react-redux\";\nimport { setDB } from \"../actions\";\nimport Dexie from \"dexie\";\n\nimport AnnotationDB from \"../apis/dexie\";\nimport { useHistory } from \"react-router-dom\";\nimport { Grid, Button, Header, Segment } from \"semantic-ui-react\";\nimport { initStoragePersistence } from \"../apis/storemanager\";\nimport demo_articles from \"../apis/demodata\";\n\nconst Welcome = ({ items }) => {\n  const dispatch = useDispatch();\n  const history = useHistory();\n\n  const loggin = async (addDemo = true) => {\n    try {\n      const db = await new AnnotationDB();\n      if (addDemo) await create_demo_job(db);\n      dispatch(setDB(db));\n      await initStoragePersistence();\n      history.push(items[0].path);\n    } catch (e) {}\n  };\n\n  Dexie.exists(\"AmCAT_Annotator\").then((exists) => {\n    if (exists) loggin(false);\n  });\n\n  return (\n    <Grid\n      inverted\n      textAlign=\"center\"\n      style={{ height: \"100vh\" }}\n      verticalAlign=\"middle\"\n    >\n      <Grid.Column style={{ maxWidth: 450 }}>\n        <Segment style={{ border: 0 }}>\n          <Header as=\"h2\" textAlign=\"center\">\n            Welcome to the AmCAT annotator\n          </Header>\n          <p>\n            This is the (early development version of the) AmCAT annotator. The\n            fact that you see this message means that you're either here for the\n            first time, or your local annotation database was reset (by you or\n            your browser).\n          </p>\n          <p>\n            The annotator stores your codingjobs and annotations on your local\n            computer in your browser's IndexedDB. Your data will only actually\n            touch the internet when you synchronize your data. Currently we've\n            implemented syncronization with Dropbox. This way we have nothing to\n            do with your data.\n          </p>\n          <Button primary onClick={loggin}>\n            Yes, off course I trust you\n          </Button>\n        </Segment>\n      </Grid.Column>\n    </Grid>\n  );\n};\n\nconst create_demo_job = async (db) => {\n  try {\n    const job = await db.createCodingjob(\"Demo codingjob\");\n    return await db.createDocuments(job, demo_articles, true);\n  } catch (e) {\n    console.log(e);\n  }\n};\n\nexport default Welcome;\n","import React, { useState } from \"react\";\nimport { Route, Redirect } from \"react-router\";\nimport { useDispatch } from \"react-redux\";\nimport { setDB } from \"../actions\";\nimport Dexie from \"dexie\";\n\nimport AnnotationDB from \"../apis/dexie\";\n\nconst AuthRoute = ({ Component, homepage, ...componentProps }) => {\n  const [loading, setLoading] = useState(true);\n  const [hasdb, setHasdb] = useState(false);\n  const dispatch = useDispatch();\n  // the trick for passing on componentProps is basically\n  // redundant now that we use Redux, but leaving it intact just in case\n\n  const connect = async () => {\n    const exists = await Dexie.exists(\"AmCAT_Annotator\");\n    if (exists) {\n      const db = await new AnnotationDB();\n      dispatch(setDB(db));\n      setHasdb(true);\n    } else {\n      setHasdb(false);\n    }\n    setLoading(false);\n  };\n\n  connect();\n\n  return (\n    <Route\n      {...componentProps}\n      render={(props) =>\n        loading ? (\n          <div>loading...</div>\n        ) : hasdb ? (\n          <Component {...componentProps} {...props} />\n        ) : (\n          <Redirect to={homepage} />\n        )\n      }\n    />\n  );\n};\n\nexport default AuthRoute;\n","import React, { useEffect, useState } from \"react\";\nimport {\n  useTable,\n  useSortBy,\n  usePagination,\n  useGlobalFilter,\n} from \"react-table\";\nimport {\n  Table,\n  TableHeader,\n  TableBody,\n  TableRow,\n  TableHeaderCell,\n  TableCell,\n  Pagination,\n  Dropdown,\n  Icon,\n} from \"semantic-ui-react\";\n\n// Uses react-table with semantic ui. The columns and data arguments are lists of objects\n// The 'columns' argument specifies column names (Header) and the names of the keys to get from data.\n//\n// const columns = [\n//   { Header: \"ID\", accessor: \"id\", headerClass: \"one wide\" },\n//   { Header: \"Name\", accessor: \"text\", headerClass: \"one wide\" },\n// ]\n//\n// Note that headerClass is custom, and enables setting the header cell class,\n// which is used in semantic ui to specify the width (one wide, ten wide, etc).\n\nconst SelectionTable = ({\n  columns,\n  data,\n  selectedRow,\n  setSelectedRow,\n  width = null,\n  defaultSize = 15,\n  sizeSelector = false,\n}) => {\n  const [activeRow, setActiveRow] = useState(\n    selectedRow ? selectedRow.ROW_ID : null\n  );\n  const {\n    getTableProps,\n    getTableBodyProps,\n    headerGroups,\n    prepareRow,\n    page,\n    pageCount,\n    gotoPage,\n    setPageSize,\n    preGlobalFilteredRows,\n    setGlobalFilter,\n    state: { pageIndex, globalFilter },\n  } = useTable(\n    {\n      columns,\n      data,\n      initialState: { pageSize: defaultSize, globalFilter: \"\" },\n    },\n\n    useGlobalFilter,\n    useSortBy,\n    usePagination\n  );\n\n  useEffect(() => {\n    if (selectedRow) {\n      setActiveRow(selectedRow.ROW_ID);\n    } else {\n      setActiveRow(null);\n    }\n  }, [selectedRow]);\n\n  const onRowSelect = (row) => {\n    if (activeRow && activeRow === row.id) {\n      setSelectedRow(null);\n      setActiveRow(null);\n    } else {\n      setSelectedRow({ ...data[row.id], ROW_ID: row.id });\n      setActiveRow(row.id);\n    }\n  };\n\n  const createHeader = (headerGroup) => {\n    return headerGroup.headers.map((column) => {\n      return (\n        <TableHeaderCell\n          className={column.headerClass}\n          {...column.getHeaderProps(column.getSortByToggleProps())}\n        >\n          {column.render(\"Header\")}\n          <span>\n            {column.isSorted ? (column.isSortedDesc ? \" 🔽\" : \" 🔼\") : \"\"}\n          </span>\n        </TableHeaderCell>\n      );\n    });\n  };\n\n  const createBody = (page) => {\n    return page.map((row, i) => {\n      prepareRow(row);\n      return (\n        <TableRow\n          active={activeRow ? activeRow === row.id : false}\n          onClick={() => onRowSelect(row)}\n          {...row.getRowProps()}\n        >\n          {row.cells.map((cell) => {\n            return (\n              <TableCell title={cell.value} {...cell.getCellProps()}>\n                {cell.render(\"Cell\")}\n              </TableCell>\n            );\n          })}\n        </TableRow>\n      );\n    });\n  };\n\n  if (data.length === 0) return null;\n\n  return (\n    <div style={{ width: width }}>\n      <GlobalFilter\n        preGlobalFilteredRows={preGlobalFilteredRows}\n        globalFilter={globalFilter}\n        setGlobalFilter={setGlobalFilter}\n      />\n      <Table\n        unstackable\n        striped\n        fixed\n        singleLine\n        selectable\n        {...getTableProps()}\n      >\n        <TableHeader>\n          {headerGroups.map((headerGroup) => (\n            <TableRow {...headerGroup.getHeaderGroupProps()}>\n              {createHeader(headerGroup)}\n            </TableRow>\n          ))}\n        </TableHeader>\n        <TableBody {...getTableBodyProps()}>{createBody(page)}</TableBody>\n      </Table>\n      {sizeSelector ? (\n        <Dropdown\n          text=\"show per page\"\n          options={[10, 25, 50, 100, 500].map((n) => ({ value: n, text: n }))}\n          onChange={(e, d) => {\n            setPageSize(d.value);\n          }}\n        />\n      ) : null}\n      <div\n        style={{\n          marginTop: \"3em\",\n          display: \"flex\",\n          justifyContent: \"flex-end\",\n        }}\n      >\n        {data.length > defaultSize ? (\n          <Pagination\n            style={{ border: \"0\" }}\n            size=\"mini\"\n            firstItem={false}\n            lastItem={false}\n            nextItem={false}\n            prevItem={false}\n            boundaryRange={1}\n            ellipsisItem={{\n              content: <Icon name=\"ellipsis horizontal\" />,\n              icon: true,\n            }}\n            activePage={pageIndex + 1}\n            totalPages={pageCount}\n            onPageChange={(event, data) => {\n              gotoPage(data.activePage - 1);\n            }}\n          />\n        ) : null}\n      </div>\n    </div>\n  );\n};\n\nconst GlobalFilter = ({\n  preGlobalFilteredRows,\n  globalFilter,\n  setGlobalFilter,\n}) => {\n  const count = preGlobalFilteredRows && preGlobalFilteredRows.length;\n\n  return (\n    <span>\n      <input\n        value={globalFilter || \"\"}\n        onChange={(e) => {\n          setGlobalFilter(e.target.value || undefined); // Set undefined to remove the filter entirely\n        }}\n        placeholder={`Search ${count} records...`}\n        style={{\n          border: \"0\",\n        }}\n      />\n    </span>\n  );\n};\n\nexport default SelectionTable;\n","import React, { useState } from \"react\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport { selectCodingjob, setCodingjobs } from \"../actions\";\nimport {\n  Header,\n  Button,\n  Modal,\n  Form,\n  Loader,\n  Dimmer,\n  Icon,\n} from \"semantic-ui-react\";\n\nconst CreateCodingjob = () => {\n  const db = useSelector((state) => state.db);\n  const codingjobs = useSelector((state) => state.codingjobs);\n  const dispatch = useDispatch();\n\n  const [status, setStatus] = useState(\"inactive\");\n  const [codingjobName, setCodingjobName] = useState(\"\");\n\n  const onSubmit = (event) => {\n    event.preventDefault();\n\n    setCodingjobName(codingjobName.trim());\n    setStatus(\"pending\");\n\n    db.createCodingjob(codingjobName)\n      .then((res) => {\n        // maybe check for 201 before celebrating\n\n        if (db) {\n          db.listCodingjobs().then((res) => {\n            dispatch(selectCodingjob(null));\n            dispatch(setCodingjobs(res));\n          });\n        }\n\n        setStatus(\"inactive\");\n      })\n      .catch((e) => {\n        console.log(e);\n        setStatus(\"error\");\n      });\n  };\n\n  if (!codingjobs) return null;\n\n  return (\n    <Modal\n      as={Form}\n      trigger={\n        <Button>\n          <Icon name=\"plus\" />\n          Create job\n        </Button>\n      }\n      onSubmit={(e) => onSubmit(e)}\n      open={status !== \"inactive\"}\n      onClose={() => setStatus(\"inactive\")}\n      onOpen={() => {\n        setCodingjobName(\"\");\n        setStatus(\"awaiting input\");\n      }}\n      size=\"tiny\"\n    >\n      <Header icon=\"pencil\" content=\"Create new Codingjob\" as=\"h2\" />\n      <Modal.Content>\n        <Form.Group>\n          <Form.Input\n            width={12}\n            label=\"Name\"\n            required\n            type=\"text\"\n            value={codingjobName}\n            onChange={(e, d) => {\n              setStatus(\"awaiting input\");\n              setCodingjobName(d.value);\n            }}\n            placeholder=\"Enter name\"\n          />\n        </Form.Group>\n      </Modal.Content>\n      <Modal.Actions>\n        {status === \"error\" ? (\n          <div>\n            Could not create codingjob for a reason not yet covered in the error\n            handling...\n          </div>\n        ) : null}\n        {status === \"pending\" ? (\n          <Dimmer active inverted>\n            <Loader content=\"Creating codingjob\" />\n          </Dimmer>\n        ) : (\n          <Button type=\"submit\" color=\"green\" icon=\"save\" content=\"Create\" />\n        )}\n      </Modal.Actions>\n    </Modal>\n  );\n};\n\nexport default CreateCodingjob;\n","import React, { useState } from \"react\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport { selectCodingjob, setCodingjobs } from \"../actions\";\nimport { Button, Header, Icon, Modal, Dimmer, Loader } from \"semantic-ui-react\";\n\nconst DeleteCodingjob = () => {\n  const db = useSelector((state) => state.db);\n  const codingjob = useSelector((state) => state.codingjob);\n  const dispatch = useDispatch();\n\n  const [status, setStatus] = useState(\"inactive\");\n\n  const onSubmit = (event) => {\n    setStatus(\"pending\");\n    db.deleteCodingjob(codingjob)\n      .then((res) => {\n        // maybe check for 201 before celebrating\n\n        if (db) {\n          db.listCodingjobs().then((res) => {\n            dispatch(selectCodingjob(null));\n            dispatch(setCodingjobs(res));\n          });\n        }\n        setStatus(\"inactive\");\n      })\n      .catch((e) => {\n        console.log(e.message);\n        console.log(e);\n        setStatus(\"error\");\n      });\n  };\n\n  if (!codingjob) return null;\n\n  return (\n    <Modal\n      closeIcon\n      open={status !== \"inactive\"}\n      trigger={\n        <Button name=\"logout\">\n          <Icon name=\"minus\" /> Delete job\n        </Button>\n      }\n      onClose={() => {\n        setStatus(\"inactive\");\n      }}\n      onOpen={() => {\n        setStatus(\"awaiting input\");\n      }}\n    >\n      <Header icon=\"trash\" content={`Delete codingjob ${codingjob.name}`} />\n      <Modal.Content>\n        <p>Do you really want to delete this codingjob?</p>\n      </Modal.Content>\n      <Modal.Actions>\n        {status === \"error\" ? (\n          <div>\n            Could not delete codingjob for a reason not yet covered in the error\n            handling...\n          </div>\n        ) : null}\n        {status === \"pending\" ? (\n          <Dimmer active inverted>\n            <Loader content=\"Creating codingjob\" />\n          </Dimmer>\n        ) : (\n          <>\n            <Button color=\"red\" onClick={onSubmit}>\n              <Icon name=\"remove\" /> No\n            </Button>\n            <Button color=\"green\" onClick={onSubmit}>\n              <Icon name=\"checkmark\" /> Yes\n            </Button>\n          </>\n        )}\n      </Modal.Actions>\n    </Modal>\n  );\n};\n\nexport default DeleteCodingjob;\n","import React, { useState, useEffect } from \"react\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport { Button, Segment, Dropdown, Container } from \"semantic-ui-react\";\nimport { selectCodingjob, setCodingjobs, setDocuments } from \"../actions\";\n\nimport SelectionTable from \"./SelectionTable\";\nimport CreateCodingjob from \"./CreateCodingjob\";\nimport DeleteCodingjob from \"./DeleteCodingjob\";\n\nconst CodingjobSelector = ({ type = \"table\" }) => {\n  const db = useSelector((state) => state.db);\n  const codingjobs = useSelector((state) => state.codingjobs);\n  const codingjob = useSelector((state) => state.codingjob);\n  const dispatch = useDispatch();\n\n  const [selectedCodingjob, setSelectedCodingjob] = useState(codingjob);\n\n  useEffect(() => {\n    console.log(\"----------------\");\n    console.log(selectedCodingjob);\n    dispatch(selectCodingjob(selectedCodingjob));\n  }, [selectedCodingjob, dispatch]);\n\n  useEffect(() => {\n    if (db) {\n      if (codingjob) {\n        db.listDocuments(codingjob)\n          .then((documents) => {\n            dispatch(setDocuments(documents));\n          })\n          .catch((e) => {\n            console.log(e);\n          });\n      } else {\n        setSelectedCodingjob(null);\n        dispatch(setDocuments([]));\n      }\n    }\n  }, [db, codingjob, dispatch]);\n\n  useEffect(() => {\n    if (db && codingjobs.length === 0) {\n      db.listCodingjobs().then((cjs) => {\n        // add timestamp and sort cjs by timestamp to show most recent\n        dispatch(setCodingjobs(cjs));\n        if (cjs.length > 0) setSelectedCodingjob({ ...cjs[0], ROW_ID: \"0\" });\n      });\n    }\n  }, [db, codingjobs, dispatch]);\n\n  //if (!codingjob) return null;\n\n  if (type === \"table\") {\n    const tableColumns = [\n      {\n        Header: \"Select Index\",\n        accessor: \"name\",\n        headerClass: \"thirteen wide\",\n      },\n    ];\n\n    return (\n      <Segment style={{ border: \"0\" }}>\n        <Button.Group widths=\"2\">\n          <CreateCodingjob />\n          <DeleteCodingjob />\n        </Button.Group>\n\n        <Container\n          style={{ marginTop: \"30px\", overflow: \"auto\", width: \"800px\" }}\n        >\n          <SelectionTable\n            columns={tableColumns}\n            data={codingjobs ? codingjobs : []}\n            selectedRow={selectedCodingjob}\n            setSelectedRow={setSelectedCodingjob}\n            defaultSize={15}\n          />\n        </Container>\n      </Segment>\n    );\n  }\n\n  if (type === \"dropdown\") {\n    const asDropdownItems = (indices) => {\n      return indices.map((index) => {\n        return { key: index.job_id, text: index.name, value: index.name };\n      });\n    };\n\n    const onDropdownSelect = (value) => {\n      if (value && codingjobs.length > 0) {\n        console.log(\"nee?\");\n        const i = codingjobs.findIndex((row) => row.name === value);\n        setSelectedCodingjob({ ...codingjobs[i], ROW_ID: i.toString() });\n      } else {\n        setSelectedCodingjob(null);\n      }\n      console.log(\"wtf\");\n      console.log(selectedCodingjob);\n    };\n\n    return (\n      <Dropdown\n        inline\n        search\n        options={asDropdownItems(codingjobs)}\n        value={codingjob ? codingjob.name : null}\n        onChange={(e, d) => onDropdownSelect(d.value)}\n      />\n    );\n  }\n\n  return null;\n};\n\nexport default CodingjobSelector;\n","import React, { useState, useEffect } from \"react\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport SelectionTable from \"./SelectionTable\";\nimport { selectDocument } from \"../actions\";\n\nconst documentTableColumns = [\n  { Header: \"title\", accessor: \"title\", headerClass: \"six wide\" },\n  { Header: \"text\", accessor: \"text\", headerClass: \"four wide\" },\n  { Header: \"annotations\", accessor: \"annotations\", headerClass: \"four wide\" },\n  { Header: \"meta\", accessor: \"meta\", headerClass: \"four wide\" },\n];\n\nconst DocumentTable = ({ width }) => {\n  const codingjob = useSelector((state) => state.codingjob);\n  const document = useSelector((state) => state.document);\n  const documents = useSelector((state) => state.documents);\n  const dispatch = useDispatch();\n\n  const [selectedRow, setSelectedRow] = useState(document);\n\n  useEffect(() => {\n    dispatch(selectDocument(selectedRow));\n  }, [selectedRow, dispatch]);\n\n  if (!codingjob) return null;\n\n  return (\n    <SelectionTable\n      columns={documentTableColumns}\n      data={documents}\n      selectedRow={selectedRow}\n      setSelectedRow={setSelectedRow}\n      width={width}\n      defaultSize={15}\n    />\n  );\n};\n\nexport default DocumentTable;\n","import React from \"react\";\nimport { Container } from \"semantic-ui-react\";\nimport DocumentTable from \"./DocumentTable\";\n\nconst JobDetails = () => {\n  return (\n    <Container style={{ marginTop: \"30px\", overflow: \"auto\" }}>\n      <DocumentTable width=\"800px\" />\n    </Container>\n  );\n};\n\nexport default JobDetails;\n","import React, { useRef, useEffect, useState } from \"react\";\nimport {\n  Container,\n  Header,\n  Table,\n  Grid,\n  Select,\n  Form,\n  Button,\n  Icon,\n} from \"semantic-ui-react\";\nimport { useSelector, useDispatch } from \"react-redux\";\n\n//import CSVReader from \"react-csv-reader\";\n//import Papa from \"papaparse\";\nimport { CSVReader } from \"react-papaparse\";\nimport { setDocuments } from \"../actions\";\n\nconst UploadDocuments = ({ setActive }) => {\n  const codingjob = useSelector((state) => state.codingjob);\n  const [data, setData] = useState([]);\n  const fileRef = useRef();\n\n  if (!codingjob) return null;\n  return (\n    <Grid stackable style={{ marginTop: \"4.3em\" }}>\n      <Grid.Row>\n        <Grid.Column floated=\"right\" width={4}>\n          {\" \"}\n          <CSVReader\n            ref={fileRef}\n            onFileLoad={(data) => setData(data)}\n            addRemoveButton\n            onRemoveFile={() => setData([])}\n          >\n            <span>Click to upload</span>\n          </CSVReader>\n        </Grid.Column>\n        <Grid.Column floated=\"right\" width={10}>\n          <SubmitForm data={data} codingjob={codingjob} fileRef={fileRef} />\n        </Grid.Column>\n      </Grid.Row>\n      <Grid.Row>\n        <Grid.Column>\n          <PreviewTable data={data} />\n        </Grid.Column>\n      </Grid.Row>\n    </Grid>\n  );\n};\n\nconst SubmitForm = ({ data, codingjob, fileRef }) => {\n  const db = useSelector((state) => state.db);\n\n  const [options, setOptions] = useState([]);\n  const [titleField, setTitleField] = useState(null);\n  const [textField, setTextField] = useState(null);\n  const [annotationsField, setAnnotationsField] = useState(null);\n  const dispatch = useDispatch();\n\n  useEffect(() => {\n    if (data.length <= 1) {\n      setTitleField(null);\n      setTextField(null);\n      setAnnotationsField(null);\n      setOptions([]);\n      return;\n    }\n\n    setOptions(\n      data[0].data.map((colname) => {\n        return { key: colname, value: colname, text: colname };\n      })\n    );\n    setTitleField(data[0].data.includes(\"title\") ? \"title\" : null);\n    setTextField(data[0].data.includes(\"text\") ? \"text\" : null);\n    setAnnotationsField(\n      data[0].data.includes(\"annotations\") ? \"annotations\" : null\n    );\n  }, [data]);\n\n  const csvToJson = (data, titleField, textField, annotationsField) => {\n    const keys = data[0].data;\n    return data.slice(1).map((row) => {\n      const datarow = row.data.reduce(\n        (obj, value, i) => {\n          let key = keys[i];\n          if (key === titleField) {\n            obj[\"title\"] = value;\n          } else if (key === textField) {\n            obj[\"text\"] = value;\n          } else if (key === annotationsField) {\n            obj[\"annotations\"] = value;\n          } else {\n            obj[\"meta\"][key] = value;\n          }\n          return obj;\n        },\n        { meta: {}, annotations: \"\" }\n      );\n      datarow.meta = JSON.stringify(datarow.meta, null, 2);\n      return datarow;\n    });\n  };\n\n  const uploadData = async () => {\n    try {\n      const preparedData = csvToJson(\n        data,\n        titleField,\n        textField,\n        annotationsField\n      );\n      await db.createDocuments(codingjob, preparedData);\n      const documents = await db.listDocuments(codingjob);\n      await dispatch(setDocuments(documents));\n      fileRef.current.removeFile();\n    } catch (e) {\n      console.log(e);\n    }\n  };\n\n  if (data.length <= 1) return null;\n\n  return (\n    <>\n      <Form>\n        <Form.Group>\n          <Form.Field\n            control={Select}\n            placeholder=\"title column\"\n            options={options}\n            value={titleField}\n            onChange={(e, d) => setTitleField(d.value)}\n          />\n          <Form.Field\n            control={Select}\n            placeholder=\"text column\"\n            options={options}\n            value={textField}\n            onChange={(e, d) => setTextField(d.value)}\n          />\n        </Form.Group>\n        <Form.Group>\n          <Form.Field\n            control={Select}\n            clearable\n            placeholder=\"annotations (optional)\"\n            options={options}\n            value={annotationsField}\n            onChange={(e, d) => setAnnotationsField(d.value)}\n          />\n          <Form.Field\n            control={Button}\n            fluid\n            onClick={uploadData}\n            disabled={!titleField || !textField}\n          >\n            <Icon name=\"upload\" />\n            Upload\n          </Form.Field>\n        </Form.Group>\n      </Form>\n    </>\n  );\n};\n\nconst PreviewTable = ({ data }) => {\n  const n = 5;\n\n  const createHeader = (data) => {\n    return data[0].data.map((colname) => {\n      return (\n        <Table.HeaderCell>\n          <span title={colname}>{colname}</span>\n        </Table.HeaderCell>\n      );\n    });\n  };\n\n  const createRows = (data, n) => {\n    const previewdata = data.slice(0, n + 1);\n    return previewdata.slice(1).map((row) => {\n      return <Table.Row>{createRowCells(row.data)}</Table.Row>;\n    });\n  };\n\n  const createRowCells = (row) => {\n    return row.map((cell) => {\n      return (\n        <Table.Cell>\n          <span title={cell}>{cell}</span>\n        </Table.Cell>\n      );\n    });\n  };\n\n  if (data.length <= 1) return null;\n\n  return (\n    <Container style={{ marginTop: \"2em\" }}>\n      <Table fixed singleLine basic=\"very\">\n        <Table.Header>\n          <Table.Row>{createHeader(data)}</Table.Row>\n        </Table.Header>\n        <Table.Body>{createRows(data, n)}</Table.Body>\n      </Table>\n      {data.length > n ? (\n        <Header align=\"center\">{data.length - 1 - n} more rows</Header>\n      ) : null}\n    </Container>\n  );\n};\n\nexport default UploadDocuments;\n","import React, { useState } from \"react\";\nimport { Form, Button } from \"semantic-ui-react\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport { setDocuments } from \"../actions\";\n\nimport SemanticDatepicker from \"react-semantic-ui-datepickers\";\nimport \"react-semantic-ui-datepickers/dist/react-semantic-ui-datepickers.css\";\n\nconst CreateDocument = () => {\n  const db = useSelector((state) => state.db);\n  const codingjob = useSelector((state) => state.codingjob);\n  const dispatch = useDispatch();\n\n  const [fieldValues, setFieldValues] = useState({});\n\n  const documentFields = {\n    title: \"text\",\n    text: \"text\",\n    annotations: \"text\",\n  };\n\n  const onCreate = async () => {\n    let submitData = { ...fieldValues };\n\n    for (const key of Object.keys(submitData)) {\n      if (key === \"date\" || /_date$/.test(key)) {\n        submitData[key] = submitData[key].toISOString();\n      }\n    }\n\n    try {\n      await db.createDocuments(codingjob, [submitData]);\n      const documents = await db.listDocuments(codingjob);\n      await dispatch(setDocuments(documents));\n      setFieldValues({});\n    } catch (e) {\n      console.log(e);\n    }\n  };\n\n  if (!codingjob) return null;\n\n  return (\n    <Form style={{ marginTop: \"3em\" }}>\n      <DocumentForms\n        fields={documentFields}\n        fieldValues={fieldValues}\n        setFieldValues={setFieldValues}\n      />\n      {!codingjob ? null : (\n        <Button primary onClick={onCreate}>\n          Create document\n        </Button>\n      )}\n    </Form>\n  );\n};\n\nconst DocumentForms = function ({ fields, fieldValues, setFieldValues }) {\n  const onSubmit = (key, value) => {\n    const newFieldValues = { ...fieldValues };\n    newFieldValues[key] = value;\n    setFieldValues(newFieldValues);\n  };\n\n  if (!fields) return null;\n\n  return Object.keys(fields).map((key) => {\n    if (fields[key] === \"text\") {\n      return (\n        <Form.TextArea\n          key={key}\n          value={fieldValues[key] ? fieldValues[key] : \"\"}\n          onChange={(e, d) => onSubmit(key, d.value)}\n          label={key}\n        />\n      );\n    }\n    if (fields[key] === \"date\") {\n      return (\n        <Form.Field>\n          <SemanticDatepicker\n            key={key}\n            label={key}\n            value={fieldValues[key] ? fieldValues[key] : \"\"}\n            onChange={(e, d) => onSubmit(key, d.value)}\n          />\n        </Form.Field>\n      );\n    }\n    if (fields[key] === \"keyword\") {\n      return (\n        <Form.Field key={key}>\n          <label>{key}</label>\n          <input\n            value={fieldValues[key] ? fieldValues[key] : \"\"}\n            onChange={(e) => onSubmit(key, e.target.value)}\n          />\n        </Form.Field>\n      );\n    }\n    return null;\n  });\n};\n\nexport default CreateDocument;\n","import React, { useState } from \"react\";\nimport { Grid, Menu, Segment } from \"semantic-ui-react\";\n\nimport CodingjobSelector from \"./CodingjobSelector\";\nimport JobDetails from \"./JobDetails\";\nimport UploadDocuments from \"./UploadDocuments\";\nimport CreateDocument from \"./CreateDocument\";\n\nconst Create = () => {\n  const [activeItem, setActiveItem] = useState(\"details\");\n\n  const renderSwitch = (activeItem) => {\n    switch (activeItem) {\n      case \"details\":\n        return <JobDetails />;\n      case \"upload\":\n        return <UploadDocuments />;\n      case \"create\":\n        return <CreateDocument />;\n      default:\n        return null;\n    }\n  };\n\n  return (\n    <Grid stackable style={{ marginTop: \"3em\" }}>\n      <Grid.Column floated=\"left\" width={5}>\n        <CodingjobSelector type=\"table\" />\n      </Grid.Column>\n      <Grid.Column width={11}>\n        <Segment style={{ border: 0 }}>\n          <Menu pointing secondary>\n            <Menu.Item\n              name=\"details\"\n              active={activeItem === \"details\"}\n              onClick={(e, d) => setActiveItem(d.name)}\n            />\n            <Menu.Item\n              name=\"upload\"\n              active={activeItem === \"upload\"}\n              onClick={(e, d) => setActiveItem(d.name)}\n            />\n            <Menu.Item\n              name=\"create\"\n              active={activeItem === \"create\"}\n              onClick={(e, d) => setActiveItem(d.name)}\n            />\n          </Menu>\n          {renderSwitch(activeItem)}\n        </Segment>\n      </Grid.Column>\n    </Grid>\n  );\n};\n\nexport default Create;\n","import React, { useEffect, useState } from \"react\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport { toggleAnnotations } from \"../actions\";\n\n// this is a dummy component to listen for changes in annotations and code\n// and saving them to the indexed db.\n\nconst ManageAnnotations = ({ tokens, doc }) => {\n  const db = useSelector((state) => state.db);\n  const annotations = useSelector((state) => state.spanAnnotations);\n  //const codes = useSelector((state) => state.codes);\n  const [ready, setReady] = useState(false);\n  const dispatch = useDispatch();\n\n  useEffect(() => {\n    setReady(false);\n  }, [doc]);\n\n  useEffect(() => {\n    if (tokens && doc.annotations) {\n      matchAnnotations(tokens, doc.annotations, dispatch);\n      setReady(true);\n    }\n  }, [tokens, doc, dispatch]);\n\n  useEffect(() => {\n    if (db && ready) exportAnnotations(db, doc, annotations);\n  }, [ready, db, doc, annotations]);\n\n  return <div></div>;\n};\n\nconst exportAnnotations = async (db, doc, annotations) => {\n  let unique = new Set();\n  const uniqueAnnotations = Object.values(annotations).reduce((un_ann, ann) => {\n    for (let key of Object.keys(ann)) {\n      const ann_obj = {\n        code: key,\n        offset: ann[key].offset,\n        length: ann[key].length,\n      };\n      const json = JSON.stringify(ann_obj);\n      if (!unique.has(json)) {\n        unique.add(json);\n        un_ann.push(ann_obj);\n      }\n    }\n    return un_ann;\n  }, []);\n\n  await db.writeValue(\n    { doc_id: doc.doc_id },\n    \"annotations\",\n    JSON.stringify(uniqueAnnotations, null, 2)\n  );\n};\n\nconst matchAnnotations = (tokens, importedAnnotations, dispatch) => {\n  let trackAnnotations = {};\n  let matchedAnnotations = [];\n\n  for (let token of tokens) {\n    findMatches(\n      token,\n      importedAnnotations,\n      trackAnnotations,\n      matchedAnnotations\n    );\n  }\n\n  for (let matchedAnnotation of matchedAnnotations) {\n    addAnnotations(matchedAnnotation, dispatch);\n  }\n};\n\nconst findMatches = (\n  token,\n  importedAnnotations,\n  trackAnnotations,\n  matchedAnnotations\n) => {\n  const start = token.offset.start;\n  const end = token.offset.start + token.offset.length;\n\n  // loop over char offset for token. If a span annotation that\n  // starts on this offset is found, initiate a new annotation in trackAnnotations with this\n  // token index as the start of the span. If a span annotation that ends on\n  // this offset is found, set the token idnex as the end of the span,\n  // store annotation in matchedAnnotations, and remove from trackAnnotations\n  for (let i = start; i <= end; i++) {\n    if (importedAnnotations[i]) {\n      for (let code of importedAnnotations[i].start) {\n        trackAnnotations[code] = {\n          index: token.offset.index,\n          group: code,\n          offset: start,\n          length: null,\n          span: [token.offset.index],\n        };\n      }\n      for (let code of importedAnnotations[i].end) {\n        trackAnnotations[code].span.push(token.offset.index);\n        trackAnnotations[code].length =\n          token.offset.start +\n          token.offset.length -\n          trackAnnotations[code].offset;\n        matchedAnnotations.push(trackAnnotations[code]);\n        delete trackAnnotations[code];\n      }\n    }\n  }\n};\n\nconst addAnnotations = (ann, dispatch) => {\n  let newAnnotations = [];\n  for (let i = ann.span[0]; i <= ann.span[1]; i++) {\n    let newAnnotation = { ...ann };\n    newAnnotation.index = i;\n    newAnnotations.push(newAnnotation);\n  }\n  dispatch(toggleAnnotations(newAnnotations));\n};\n\nexport default ManageAnnotations;\n","import React, { useState, useEffect, useRef } from \"react\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport { Button, Dropdown, Popup, Ref, Step } from \"semantic-ui-react\";\nimport {\n  setCodes,\n  appendCodeHistory,\n  toggleAnnotations,\n  rmAnnotations,\n} from \"../actions\";\nimport randomColor from \"randomcolor\";\n\nconst CodeSelector = ({ index, children }) => {\n  const codes = useSelector((state) => state.codes);\n  const codeHistory = useSelector((state) => state.codeHistory);\n  const spanAnnotations = useSelector((state) => state.spanAnnotations);\n  const textInputRef = useRef(null);\n  const [current, setCurrent] = useState(null);\n\n  // Placeholder: should be managed in state\n  const userAccess = { editable: true };\n  const dispatch = useDispatch();\n\n  useEffect(() => {\n    let annotation = spanAnnotations[index];\n    if (annotation && annotation !== undefined) {\n      if (Object.keys(annotation).includes(\"Not yet assigned\")) {\n        setCurrent(\"Not yet assigned\");\n      } else {\n        setCurrent(Object.keys(annotation)[0]);\n      }\n    }\n  }, [index, spanAnnotations]);\n\n  const toggleListener = (on) => {\n    if (on) {\n      window.addEventListener(\"keydown\", onKeydown);\n    } else {\n      window.removeEventListener(\"keydown\", onKeydown);\n    }\n  };\n  const onKeydown = (event) => {\n    if (textInputRef.current) textInputRef.current.click();\n  };\n\n  const onAddition = (e, d) => {\n    dispatch(\n      setCodes([\n        {\n          key: d.value,\n          text: d.value,\n          value: d.value,\n          color: randomColor({ seed: d.value, luminosity: \"bright\" }),\n        },\n        ...codes,\n      ])\n    );\n  };\n\n  const getColor = (tokenCode, codes) => {\n    const codematch = codes.find((e) => e.value === tokenCode);\n    if (codematch) {\n      return codematch.color;\n    } else {\n      return \"lightgrey\";\n    }\n  };\n\n  const updateAnnotations = (value) => {\n    const key = current;\n\n    let annotation = spanAnnotations[index];\n    if (!annotation) return null;\n\n    let ann = {\n      index: annotation[key].index,\n      group: key,\n      offset: annotation[key].offset,\n      length: annotation[key].length,\n      span: annotation[key].span,\n    };\n\n    // this is a nasty hack. Sort nice solution out later\n    let oldAnnotation = { ...ann };\n    oldAnnotation.span = [oldAnnotation.index, oldAnnotation.index];\n    dispatch(rmAnnotations([oldAnnotation]));\n\n    if (value === key) return null;\n\n    let newAnnotations = [];\n    for (let i = ann.span[0]; i <= ann.span[1]; i++) {\n      let newAnnotation = { ...ann };\n      newAnnotation.group = value;\n      newAnnotation.index = i;\n      newAnnotations.push(newAnnotation);\n    }\n    dispatch(toggleAnnotations(newAnnotations));\n    dispatch(appendCodeHistory(value));\n\n    if (Object.keys(annotation).includes(null)) {\n      setCurrent(null);\n    } else {\n      setCurrent(value);\n    }\n  };\n\n  const newCodeButtons = () => {\n    return codeHistory\n      .filter((e) => e !== current && e !== \"Not yet assigned\")\n      .map((code) => {\n        return (\n          <Button\n            style={{ backgroundColor: getColor(code, codes) }}\n            key={code}\n            value={code}\n            onClick={(e, d) => updateAnnotations(d.value)}\n          >\n            {code}\n          </Button>\n        );\n      });\n  };\n\n  const ddOptions = (value) => {\n    let useValue = value;\n    if (!value || value === \"null\") useValue = \"Not yet assigned\";\n    return { key: useValue, text: useValue, value: useValue };\n  };\n\n  const getCurrentOptions = () => {\n    let annotation = spanAnnotations[index];\n    if (annotation) {\n      return Object.keys(annotation)\n        .filter((e) => e !== current)\n        .map(ddOptions);\n    } else {\n      return [ddOptions(null)];\n    }\n  };\n\n  return (\n    <Popup\n      trigger={children}\n      on=\"hover\"\n      flowing\n      hoverable\n      wide\n      onOpen={() => toggleListener(true)}\n      onClose={() => toggleListener(false)}\n      position=\"top left\"\n    >\n      <div>\n        <Step.Group vertical>\n          <Step active>\n            <Step.Content>\n              <Step.Title>Current code</Step.Title>\n              <Step.Description>\n                <Button.Group>\n                  <Button\n                    icon=\"trash\"\n                    size=\"mini\"\n                    onClick={(e, d) => updateAnnotations(current)}\n                  />\n                  <Button style={{ backgroundColor: getColor(current, codes) }}>\n                    <Dropdown\n                      text={current}\n                      options={getCurrentOptions()}\n                      value={current}\n                      onChange={(e, d) => setCurrent(d.value)}\n                    />\n                  </Button>\n                </Button.Group>\n              </Step.Description>\n            </Step.Content>\n          </Step>\n\n          <Step>\n            <Step.Content>\n              <Step.Title>Set new code</Step.Title>\n              <Step.Description>\n                <Button.Group vertical compact widths=\"1\">\n                  {newCodeButtons()}\n                </Button.Group>\n                &nbsp;&nbsp;\n                <Ref innerRef={textInputRef}>\n                  <Dropdown\n                    compact\n                    options={codes}\n                    placeholder={\n                      userAccess.editable ? \"Search or create \" : \"Search \"\n                    }\n                    widths={1}\n                    search\n                    selection\n                    allowAdditions={userAccess.editable}\n                    additionPosition={\"bottom\"}\n                    onAddItem={onAddition}\n                    selectOnNavigation={false}\n                    minCharacters={0}\n                    autoComplete={\"on\"}\n                    searchInput={{ autoFocus: false }}\n                    onChange={(e, d) => updateAnnotations(d.value)}\n                  />\n                </Ref>\n              </Step.Description>\n            </Step.Content>\n          </Step>\n        </Step.Group>\n      </div>\n    </Popup>\n  );\n};\n\nexport default CodeSelector;\n","import React from \"react\";\nimport { useSelector } from \"react-redux\";\n\nimport \"./style.css\";\nimport CodeSelector from \"./CodeSelector\";\n\nconst Token = ({ token }) => {\n  return (\n    <span\n      className=\"token\"\n      tokenindex={token.offset.index}\n      tokenoffset={token.offset.start}\n      tokenlength={token.offset.length}\n    >\n      <AnnotatedToken token={token} />\n    </span>\n  );\n};\n\nconst AnnotatedToken = ({ token }) => {\n  // If we specifically ask for the annotations for the current token within the\n  // useSelector function, rerender is only triggered if this value has changed\n  const annotations = useSelector(\n    (state) => state.spanAnnotations[token.offset.index]\n  );\n  console.log(\"test\");\n  //const selected = useSelector(state => state.selectedToken[token.offset.index])\n  const codes = useSelector((state) => state.codes);\n\n  // This is a trick required to render if at least something within this token's\n  // annotations changed (somehow 'annotations' doesn't trigger this, even though it\n  // does contain all the information)\n  useSelector((state) =>\n    JSON.stringify(state.spanAnnotations[token.offset.index])\n  );\n\n  // if there are no annotation codes, our life is easy\n  if (!annotations) return <>{token.pre + token.text + token.post}</>;\n\n  // create solid colors or color gradients\n  const getColor = (tokenCode, codes) => {\n    const codematch = codes.find((e) => e.value === tokenCode);\n    if (codematch) {\n      return codematch.color;\n    } else {\n      return \"lightgrey\";\n    }\n  };\n  let tokenCodes = Object.keys(annotations);\n  let color = null;\n  if (tokenCodes.length === 1) {\n    color = getColor(tokenCodes[0], codes);\n  } else {\n    let colors = tokenCodes.map((code) => getColor(code, codes));\n    color = `linear-gradient(${colors.join(\", \")})`;\n  }\n\n  // Set specific classes for nice css to show the start/end of codes\n  const allLeft = !Object.values(annotations).some(\n    (code) => code.span[0] !== code.index\n  );\n  const allRight = !Object.values(annotations).some(\n    (code) => code.span[1] !== code.index\n  );\n  const anyLeft = Object.values(annotations).some(\n    (code) => code.span[0] === code.index\n  );\n  const anyRight = Object.values(annotations).some(\n    (code) => code.span[1] === code.index\n  );\n\n  let tokenClass = \"TextCodeBubble\";\n  if (allLeft) tokenClass = tokenClass + \" allLeft\";\n  if (anyLeft & !allLeft) tokenClass = tokenClass + \" anyLeft\";\n  if (allRight) tokenClass = tokenClass + \" allRight\";\n  if (anyRight & !allRight) tokenClass = tokenClass + \" anyRight\";\n\n  return (\n    <>\n      {allLeft ? token.pre : null}\n      <CodeSelector index={token.offset.index}>\n        <span\n          className={tokenClass}\n          style={{\n            background: color,\n          }}\n        >\n          {allLeft && allRight ? token.text : null}\n          {allLeft && !allRight ? token.text + token.post : null}\n          {allRight && !allLeft ? token.pre + token.text : null}\n          {!allLeft && !allRight ? token.pre + token.text + token.post : null}\n        </span>\n      </CodeSelector>\n      {allRight ? token.post : null}\n    </>\n  );\n};\n\nexport default React.memo(Token);\n","import React, { useEffect, useState } from \"react\";\nimport { Container } from \"semantic-ui-react\";\nimport Token from \"./Token\";\n\nimport nlp from \"compromise\";\nimport paragraphs from \"compromise-paragraphs\";\nnlp.extend(paragraphs);\n\nconst Tokens = ({ text, setTokens }) => {\n  // It's imporant that the annotations to not pass by this component\n  // but are loaded into Token from redux. THis prevents rerendering\n  // all the parsing stuff\n  const [tokenComponents, setTokenComponents] = useState(null);\n\n  useEffect(() => {\n    const [paragraphs, tokens] = prepareTokens(text);\n    setTokenComponents(paragraphs);\n    setTokens(tokens);\n  }, [text, setTokens]);\n\n  if (text === null) return null;\n\n  return <Container text>{tokenComponents}</Container>;\n};\n\nconst prepareTokens = (text) => {\n  let tokens = [];\n  const tokenized = nlp.tokenize(text).paragraphs().json({ offset: true });\n  const paragraphs = tokenized.map((par, par_i) => {\n    return createParagraph(par, par_i, tokens);\n  });\n\n  return [paragraphs, tokens];\n};\n\nconst createParagraph = (par, par_i, tokens) => {\n  const mapSentences = (par) => {\n    return par.sentences.map((sent) => {\n      // for some reason there's an other array layer...\n      // I've only found cases where lenght is 1, but I'll map just in case\n      return sent.map((sent2) => {\n        return createSentence(sent2, tokens);\n      });\n    });\n  };\n  return (\n    // uses span behaving like p, because p is not allowed due to nested div (for Label)\n    <span style={{ marginTop: \"1em\", display: \"table\" }} key={par_i}>\n      {par_i === 0 ? <h2>{mapSentences(par)}</h2> : mapSentences(par)}\n    </span>\n  );\n};\n\nconst createSentence = (sent, tokens) => {\n  const mapTokens = (sent) => {\n    return sent.terms.map((token) => {\n      tokens.push(token);\n      return <Token key={token.offset.index} token={token} />;\n    });\n  };\n\n  return (\n    <span className=\"sentence\" key={sent.offset.index}>\n      {mapTokens(sent)}\n    </span>\n  );\n};\n\nexport default React.memo(Tokens);\n","import React, { useEffect, useState } from \"react\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport { clearSpanAnnotations } from \"../actions\";\nimport { toggleAnnotations } from \"../actions\";\nimport ManageAnnotations from \"./ManageAnnotations\";\n\nimport Tokens from \"./Tokens\";\n\nconst AnnotationText = ({ doc }) => {\n  const codeHistory = useSelector((state) => state.codeHistory);\n  const [tokens, setTokens] = useState([]);\n  const dispatch = useDispatch();\n\n  useEffect(() => {\n    dispatch(clearSpanAnnotations());\n  }, [doc, dispatch]);\n\n  // USE THIS LATER TO ENABLE DIRECT CODE SELECTION WITH MOUSE\n  // (showing current code next to line)\n  // useEffect(() => {\n  //   window.addEventListener(\"mousemove\", onMouseMove);\n  //   return () => {\n  //     window.removeEventListener(\"mousemove\", onMouseMove);\n  //   };\n  // });\n\n  // const onMouseMove = (event) => {\n  //   if (event.ctrlKey) {\n  //     console.log(event.pageX);\n  //   }\n  // };\n\n  useEffect(() => {\n    return () => {};\n  });\n\n  useEffect(() => {\n    window.addEventListener(\"mouseup\", onMouseUp);\n    //window.addEventListener(\"touchmove\", onTouchMove);\n    window.addEventListener(\"keydown\", onKeyDown);\n    return () => {\n      window.removeEventListener(\"mouseup\", onMouseUp);\n      //window.removeEventListener(\"touchmove\", onTouchMove);\n      window.removeEventListener(\"keydown\", onKeyDown);\n    };\n  });\n\n  const onKeyDown = (event) => {\n    //console.log(event.key); // for key navigation\n  };\n\n  const onMouseUp = (event) => {\n    if (event.which !== 1) return null;\n    event.preventDefault();\n    const selection = window.getSelection();\n\n    if (!(selection.anchorNode && selection.focusNode)) return null;\n    let from = getToken(selection.anchorNode.parentElement);\n    let to = getToken(selection.focusNode.parentElement);\n\n    if (!(from && to)) return null;\n    window.getSelection().empty();\n\n    if (from.index > to.index) [from, to] = [to, from];\n\n    let defaultValue = codeHistory[0] ? codeHistory[0] : null;\n    if (!event.ctrlKey) defaultValue = \"Not yet assigned\";\n\n    const annotations = [];\n    for (let i = from.index; i <= to.index; i++) {\n      annotations.push({\n        index: i,\n        group: defaultValue,\n        offset: from.offset,\n        length: to.offset + to.length - from.offset,\n        span: [from.index, to.index],\n      });\n    }\n    dispatch(toggleAnnotations(annotations));\n  };\n\n  if (!doc) return null;\n  return (\n    <>\n      <Tokens text={doc.text} setTokens={setTokens} />\n      <ManageAnnotations tokens={tokens} doc={doc} />\n    </>\n  );\n};\n\nconst getTokenAttributes = (tokenNode) => {\n  return {\n    index: parseInt(tokenNode.getAttribute(\"tokenindex\")),\n    offset: parseInt(tokenNode.getAttribute(\"tokenoffset\")),\n    length: parseInt(tokenNode.getAttribute(\"tokenlength\")),\n  };\n};\n\nconst getToken = (e) => {\n  console.log(e);\n  if (e.className === \"token\") return getTokenAttributes(e);\n  if (e.parentNode) {\n    if (e.parentNode.className === \"token\")\n      return getTokenAttributes(e.parentNode);\n  }\n  return null;\n};\n\nexport default AnnotationText;\n","import React, { useEffect, useState } from \"react\";\nimport { useSelector } from \"react-redux\";\nimport {\n  Breadcrumb,\n  BreadcrumbSection,\n  Dropdown,\n  Grid,\n} from \"semantic-ui-react\";\n\nimport CodingjobSelector from \"./CodingjobSelector\";\nimport AnnotationText from \"./AnnotationText\";\nimport CodeSelector from \"./CodeSelector\";\nimport AnnotationDB from \"../apis/dexie\";\n\nconst Annotate = () => {\n  const db = useSelector((state) => state.db);\n  const codingjob = useSelector((state) => state.codingjob);\n  const [doc, setDoc] = useState(null);\n  const [documentList, setDocumentList] = useState([]);\n\n  useEffect(() => {\n    getDocuments(codingjob, setDoc, setDocumentList);\n  }, [codingjob]);\n\n  const documentSelector = (db, setDoc, documentList) => {\n    const options = dropdownOptions(documentList);\n    return (\n      <Dropdown\n        inline\n        search\n        onChange={(e, d) => {\n          getDocument(db, setDoc, d.value);\n        }}\n        options={options}\n        value={doc ? doc.doc_id : null}\n      />\n    );\n  };\n\n  return (\n    <>\n      <Grid>\n        <Grid.Row>\n          <Breadcrumb>\n            <BreadcrumbSection link>\n              <CodingjobSelector type=\"dropdown\" />\n            </BreadcrumbSection>\n            <Breadcrumb.Divider />\n            <BreadcrumbSection link>\n              {documentSelector(db, setDoc, documentList)}\n            </BreadcrumbSection>\n          </Breadcrumb>\n        </Grid.Row>\n        <Grid.Row>\n          <Grid.Column width={12}>\n            <AnnotationText doc={doc ? doc : null} />\n          </Grid.Column>\n          <Grid.Column width={4}>\n            <CodeSelector />\n          </Grid.Column>\n        </Grid.Row>\n      </Grid>\n    </>\n  );\n};\n\nconst getDocuments = async (codingjob, setDoc, setDocumentList) => {\n  if (codingjob) {\n    const db = await new AnnotationDB();\n    const documents = await db.listDocuments(codingjob);\n    setDocumentList(documents);\n    if (documents.length > 0) {\n      setDoc({\n        doc_id: documents[0].doc_id,\n        text: documents[0].title + \"\\n\\n\" + documents[0].text,\n        annotations: prepareAnnotations(documents[0].annotations),\n      });\n    } else {\n      setDoc(null);\n    }\n  }\n};\n\nconst getDocument = async (db, setDoc, doc_id) => {\n  const document = await db.getDocument(doc_id);\n  setDoc({\n    doc_id: document.doc_id,\n    text: document.title + \"\\n\\n\" + document.text,\n    annotations: prepareAnnotations(document.annotations),\n  });\n};\n\nconst prepareAnnotations = (annotations) => {\n  if (!annotations || annotations === \"\") return {};\n  const anns = JSON.parse(annotations);\n\n  // create an object where the key is an offset, and the\n  // value is an array that tells which codes start and end there\n  // used in Tokens for matching to token indices\n  // (matching to tokenindices is needed for speed, to keep coding nice and responsive)\n  return anns.reduce((obj, ann) => {\n    if (!obj[ann.offset]) obj[ann.offset] = { start: [], end: [] };\n    if (!obj[ann.offset + ann.length])\n      obj[ann.offset + ann.length] = { start: [], end: [] };\n    obj[ann.offset].start.push(ann.code);\n    obj[ann.offset + ann.length].end.push(ann.code);\n    return obj;\n  }, {});\n};\n\nconst dropdownOptions = (documentList) => {\n  const items = documentList.map((document, i) => {\n    return {\n      key: i,\n      text: document.title,\n      value: document.doc_id,\n    };\n  });\n  return items;\n};\n\nexport default Annotate;\n","import React from \"react\";\nimport { BrowserRouter, Route, Switch } from \"react-router-dom\";\nimport HeaderMenu from \"./components/HeaderMenu\";\nimport { Divider, Container } from \"semantic-ui-react\";\n\n// login and authenticated route\nimport Welcome from \"./components/Welcome\";\nimport AuthRoute from \"./components/AuthRoute\";\n\n// Main pages. Use below in items to include in header menu\nimport Create from \"./components/Create\";\nimport Annotate from \"./components/Annotate\";\n\n// Change to add new components to the header\n// The first item will be the opening page after login\nconst host = \"https://ccs-amsterdam.github.io\"; // required for dropbox redirect\nconst homepage = \"/amcat4annotator\";\nconst items = [\n  { label: \"Create\", path: homepage + \"/create\", Component: Create },\n  { label: \"Annotate\", path: homepage + \"/annotate\", Component: Annotate },\n];\n\nconst App = () => {\n  const createNavigation = (items) => {\n    return items.map((item) => {\n      return (\n        <AuthRoute\n          key={item.path}\n          path={item.path}\n          homepage={homepage}\n          Component={item.Component}\n        />\n      );\n    });\n  };\n\n  return (\n    <BrowserRouter>\n      <HeaderMenu items={items} host={host} homepage={homepage} />\n      <Divider />\n      <Container style={{ marginTop: \"3em\" }}>\n        <Switch>\n          <Route\n            exact\n            path={homepage}\n            render={() => <Welcome items={items} />}\n          />\n          {createNavigation(items)}\n        </Switch>\n      </Container>\n    </BrowserRouter>\n  );\n};\n\nexport default App;\n","import { combineReducers } from \"redux\";\n\nconst db = (state = null, action) => {\n  switch (action.type) {\n    case \"SET_DB\":\n      return action.payload;\n    case \"RESET_DB\":\n      return null;\n    default:\n      return state;\n  }\n};\n\nconst dropbox = (state = null, action) => {\n  switch (action.type) {\n    case \"SET_DROPBOX\":\n      console.log(\"set dropbox\");\n      return action.payload;\n    case \"RESET_DB\":\n      return null;\n    default:\n      return state;\n  }\n};\n\nconst codingjob = (state = null, action) => {\n  switch (action.type) {\n    case \"SELECT_CODINGJOB\":\n      return action.payload;\n    case \"RESET_DB\":\n      return null;\n    default:\n      return state;\n  }\n};\n\nconst codingjobs = (state = [], action) => {\n  switch (action.type) {\n    case \"SET_CODINGJOBS\":\n      return action.payload;\n    case \"RESET_DB\":\n      return [];\n    default:\n      return state;\n  }\n};\n\nconst documents = (state = [], action) => {\n  switch (action.type) {\n    case \"SET_DOCUMENTS\":\n      return action.payload;\n    case \"RESET_DB\":\n      return [];\n    default:\n      return state;\n  }\n};\n\nconst document = (state = [], action) => {\n  switch (action.type) {\n    case \"SELECT_DOCUMENT\":\n      return action.payload;\n    case \"RESET_DB\":\n      return [];\n    default:\n      return state;\n  }\n};\n\nconst tokenIndices = (state = [], action) => {\n  switch (action.type) {\n    case \"SET_TOKEN_INDICES\":\n      return action.payload;\n    case \"RESET_DB\":\n      return null;\n    default:\n      return state;\n  }\n};\n\nconst selectedToken = (state = {}, action) => {\n  switch (action.type) {\n    case \"SET_SELECTED_TOKEN\":\n      return action.payload;\n    case \"RESET_DB\":\n      return null;\n    default:\n      return state;\n  }\n};\n\n// separately store the annotation in a more universal format and\n// a format that is fast to use in the app. Now store universal format in state\n// but in time figure out how to use indexedDb.\n\nconst toggleAnnotations = (annotations, annList, rm) => {\n  for (let key in annList) {\n    let a = annList[key];\n\n    // if group in annotations, remove it\n    if (annotations[a.index]) {\n      if (annotations[a.index][a.group]) {\n        const span = annotations[a.index][a.group].span;\n        for (let i = span[0]; i <= span[1]; i++) {\n          if (annotations[i]) {\n            if (annotations[i][a.group]) {\n              delete annotations[i][a.group];\n              if (Object.keys(annotations[i]).length === 0) {\n                delete annotations[i];\n              }\n            }\n          }\n        }\n        // if selection was one token (which is probably a click),\n        // just remove the annotation. But if it was a multi-token selection,\n        // we do add the new selection\n        if (a.span[0] === a.span[1]) continue;\n      }\n    }\n\n    // if not, add it\n    if (!rm) {\n      if (!annotations[a.index]) annotations[a.index] = {};\n      annotations[a.index][a.group] = {\n        index: a.index,\n        span: [a.span[0], a.span[1]],\n        offset: a.offset,\n        length: a.length,\n      };\n    }\n  }\n\n  return annotations;\n};\n\nconst spanAnnotations = (state = {}, action) => {\n  switch (action.type) {\n    case \"TOGGLE_ANNOTATIONS\":\n      return toggleAnnotations({ ...state }, action.payload, false);\n    case \"RM_ANNOTATIONS\":\n      return toggleAnnotations({ ...state }, action.payload);\n    case \"CLEAR_SPAN_ANNOTATIONS\":\n      return {};\n    case \"RESET_DB\":\n      return {};\n    default:\n      return state;\n  }\n};\n\nconst testCodes = [\n  {\n    key: \"Mark Rutte\",\n    text: \"Mark Rutte\",\n    value: \"Mark Rutte\",\n    color: \"#40a31f\",\n  },\n  {\n    key: \"Sigrid Kaag\",\n    text: \"Sigrid Kaag\",\n    value: \"Sigrid Kaag\",\n    color: \"#f2db5c\",\n  },\n];\n\nconst codes = (state = testCodes, action) => {\n  switch (action.type) {\n    case \"SET_CODES\":\n      return action.payload;\n    case \"RESET_DB\":\n      return [];\n    default:\n      return state;\n  }\n};\n\nconst codeHistory = (state = [], action) => {\n  switch (action.type) {\n    case \"APPEND_CODE_HISTORY\":\n      let newstate = state\n        .filter((v) => v !== action.payload.code)\n        .slice(0, action.payload.n - 1);\n      newstate.unshift(action.payload.code);\n      return newstate;\n    case \"RESET_DB\":\n      return [];\n    default:\n      return state;\n  }\n};\n\nconst rootReducer = combineReducers({\n  db,\n  dropbox,\n  codingjob,\n  codingjobs,\n  document,\n  documents,\n  tokenIndices,\n  selectedToken,\n  spanAnnotations,\n  codes,\n  codeHistory,\n});\n\nexport default rootReducer;\n","import \"semantic-ui-css/semantic.min.css\";\nimport React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport App from \"./App\";\nimport { createStore } from \"redux\";\nimport rootReducer from \"./reducers\";\nimport { Provider } from \"react-redux\";\n\nconst store = createStore(rootReducer);\n\nReactDOM.render(\n  <React.StrictMode>\n    <Provider store={store}>\n      <App />\n    </Provider>\n  </React.StrictMode>,\n  document.querySelector(\"#root\")\n);\n"],"sourceRoot":""}